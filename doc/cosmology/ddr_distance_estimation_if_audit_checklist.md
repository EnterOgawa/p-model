# DDR前提監査：距離推定I/Fで「空間膨張(1+z)」がどこに埋め込まれるか（チェックリスト）

## 目的
DDR（distance duality relation）の張力を「物理の棄却」へ進める前に、
公表制約（SNIa+BAO 等）が距離推定I/F（input/selection/calibration/definitions）に
**空間膨張に由来する(1+z)** を埋め込んでいないかを監査できるようにする。

ここでの「空間膨張(1+z)」とは、FRWで
`D_A = D_M/(1+z)`（横方向の comoving 距離 D_M と角径距離 D_A の変換）として現れる因子を指す。
フラックス側（光子エネルギーと到着率に由来する減衰）とは区別する。

関連：
- FRWの(1+z)因子分解：`doc/cosmology/ddr_redshift_factor_decomposition.md`
- P-modelの公理マッピング：(i)–(iii)：`doc/cosmology/ddr_pmodel_axioms_mapping.md`
- P-model距離導出：`doc/cosmology/ddr_pmodel_distance_derivation.md`

## 最小背景（監査の入口）
DDRの標準指標は
$$
\eta(z)\equiv \frac{D_L}{(1+z)^2 D_A}
$$
である。一方、本リポジトリでは「フラックス側(1+z)」のみを割り戻した指標として
$$
\eta^{(P)}(z)\equiv \frac{D_L}{(1+z)D_A}=(1+z)\eta(z)
$$
を用いる（`η^(P)`）。

重要なのは、`η^(P)` を作っても **距離推定I/Fの中で既に `D_A=D_M/(1+z)` を仮定していれば**、
`η^(P)` の比較が「前提に回収」され得る点である（循環リスク）。
したがって、`η^(P)` の反証条件は「I/F監査を通過した距離推定」でのみ有効とする。

## 監査チェックリスト（Yes/No）

### A. その制約は“距離を直接測った”のか？
1. **入力距離の正体**：論文が使う距離は `D_L` / `D_A` / `D_M` / `D_H` / `D_V` のどれか？
   - Yes（`D_M` や `D_H` が明示）：次へ
   - No（距離が暗黙、あるいは「ΛCDMフィットの距離」）：その時点で “前提依存が強い” とラベル付け
2. **距離の推定は“パラメータとしてフィット”か？**
   - Yes（`D_M`, `H` などを独立パラメータで推定）：前提監査が可能
   - No（`H(z)` や `D_A(z)` を FRW 積分で直接表現）：空間膨張前提が深く埋め込まれている可能性が高い

### B. 「空間膨張(1+z)」が入る典型ポイント（最重要）
3. **`D_A = D_M/(1+z)` を明示的に使っているか？**
   - Yes：空間膨張(1+z)が距離定義に埋め込まれている（`D_A` 側の監査が必須）
   - No：次へ（ただし暗黙に使っていないか注意）
4. **`D_M=(1+z)D_A` を使って AP 量 `F_AP=D_M H/c` を作っているか？**
   - Yes：`D_M` の段階で比較できるか（`D_A` からの変換を経由していないか）を確認
   - No：次へ

### C. フラックス側(1+z)・時間伸長の埋め込み（補助）
5. **SNe Ia の標準化で `t_rest=t_obs/(1+z)`（p_t=1）を固定しているか？**
   - Yes：時間伸長の前提が埋め込まれている（p_t の独立制約と整合しているかを確認）
   - No：まれ（要注記）
6. **K補正・バンド変換で(1+z)を使っているか？**
   - Yes：これは“スペクトルの波長シフト”として必須（距離幾何の(1+z)とは区別）

### D. 光子数保存・不透明度（別の前提）
7. **光子数保存（opacityなし）を前提にしているか？**
   - Yes：`η`（または `η^(P)`）の解釈が「幾何」へ寄る
   - No：減光（τ）を同時フィットしている場合、`η` は物理ではなく補正項へ吸収され得る

## 入力カテゴリ別：どこに(1+z)が入るか（要点）

### 1) BAO（角径距離側の代表）
よく使われる圧縮出力は `D_M/r_d`, `D_H/r_d`（または `D_V/r_d`）であり、ここでの“距離”は原理的には
角度と赤方偏移差から推定される幾何量である。

監査ポイント：
- `D_A` が入力に見える場合、ほぼ確実に `D_A=D_M/(1+z)` の変換を経由している。
- 「空間膨張(1+z)を埋め込まない」形に近づけるには、まず `D_M`（あるいは `D_M/r_d`）を一次として扱い、
  `D_A` への変換を別レイヤ（前提）として明示する。
- さらに、BAO は fiducial cosmology と window/recon/broadband 等の手続き依存を持つため、
  (1+z)だけでなく “入口I/F” の監査（本リポジトリでは一次統計のledger）とセットで扱う。

### 2) クラスター（SZ+X-ray；角径距離側）
クラスター距離推定は、表面輝度・温度・電子密度などの推定式に (1+z) を含み得る。
特に “Tolman 型の dimming” をどこまで前提に入れているかで、`D_A` の意味が変わる可能性がある。

監査ポイント（例）：
- X-ray surface brightness の (1+z) スケーリングを固定しているか？
- CMB温度スケーリング（β_T）を固定しているか（SZ側の校正に影響）？
- 幾何モデル（球対称/非等温）をどの段で選択しているか（系統として扱われているか）？

### 3) 強重力レンズ（SGL；角径距離側）
強レンズは距離組合せ（例：`D_d D_s/D_ds`）を通じて `D_A` にアクセスするが、
多くの場合 FRW の距離和則（distance sum rule）等の幾何前提が解析I/Fに入る。

監査ポイント（例）：
- `D_d, D_s, D_ds` を独立に推定しているか、FRW和則を固定しているか？
- time-delay distance に現れる `(1+z_l)` を “距離推定の定義” として固定していないか？

### 4) SNe Ia（光度距離側）
SNe Ia は `D_L` の推定そのものはフラックス（光度）と標準化から入るが、
標準化手続きで `t/(1+z)` を用いるなど、時間伸長の前提を強く含み得る。

監査ポイント：
- light-curve 標準化で `t_rest=t_obs/(1+z)` を固定しているか（通常 Yes）？
- 絶対等級（または距離ゼロ点）の校正が、どのデータ（アンカー）に依存するか？
- 高z側のトレーニングが “FRW距離” に依存していないか（手続き依存の棚卸し対象）？

## このチェックリストの使い方（運用）
1. `η^(P)` の zスコア（例：z_ref=1）だけを見て「棄却」を言わない。
2. まず、上のチェックで (1+z)（膨張側）が `D_A` の定義へ埋め込まれていないかを判定する。
3. 埋め込まれている場合は、`D_M`（あるいはより一次的な観測量）へ戻すルートがあるかを確認し、
   “前提を外した距離推定I/F” を別タスクとして切り出す。
4. 監査を通過したI/Fが確立できた段階で、`η^(P)` を反証指標として採用する。

