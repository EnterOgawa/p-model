# WORK HISTORY
This file starts with an ASCII-only preamble to avoid a known Windows tool unicode slicing issue.
Japanese content begins after this preamble.

# 作業履歴（重複防止・意思決定の記録）

目的：
- 「何をいつ決めて、何をどこまで実装し、どの出力で検証したか」を残し、重複作業を防ぐ。
- 後から論文化するときに、根拠（一次ソース・再現コマンド・数値）をすぐ辿れるようにする。

運用：
- 重要な変更（モデル式・符号規約・一次ソース追加・バッチ結果の更新・レポート構成変更など）を行ったら、このファイルに **追記**する。
- 併せて `doc/STATUS.md`（進捗）も更新する。
- AI 起動時の参照用に `doc/WORK_HISTORY_RECENT.md`（直近3ログ）を併設し、ContextWindow 消費を抑える。
- 自動ログ（スクリプト実行履歴）は `output/summary/work_history.jsonl`（JSONL）に出力する（手動編集しない）。

記載テンプレ（最低限）：
- 日付（UTC）
- 目的/変更点
- 一次ソース（URL/版）
- 主要な数値（RMSなど）
- 再現コマンド
- 影響ファイル（追加/更新）

---

## 2026-01-01（UTC） 作業履歴/ロードマップ運用を導入（自動ログ＋現在地の可視化）

目的：
- 「今どこまで進んでいるか」「次に何をするか」を常に見える化し、重複作業を防ぐ。
- 論文化に向けて、結果の再現（実行条件/入力/出力）を追える状態にする。

変更点：
- 人間向け：
  - `doc/WORK_HISTORY.md` に意思決定/変更点を追記して残す運用を開始。
  - `doc/STATUS.md` にロードマップ（チェックリスト）と現在地、最新の主要数値を集約。
- 機械可読ログ：
  - `scripts/summary/worklog.py` を追加し、`output/summary/work_history.jsonl`（JSONL）に実行履歴を追記できるようにした。
  - 主要スクリプト（`scripts/summary/run_all.py` / `scripts/summary/public_dashboard.py` / `scripts/llr/llr_batch_eval.py`）から自動追記する。

再現（ログ追記の確認）：
- `python -B scripts/summary/public_dashboard.py`


---

## 2026-01-01（UTC） LLR：残差スパイク（外れ値）を可視化し、一次データへ追跡可能に

目的：
- GRSMなどで見える「期間依存スパイク」が、モデル不足なのか、観測データの外れ値/品質なのかを切り分ける。
- 外れ値を“黙って除外”せず、一次ソース（file:line）まで辿れる形で透明化する。

変更点：
- `scripts/llr/llr_batch_eval.py` に外れ値の要約と可視化を追加。
  - `output/llr/batch/llr_outliers_summary.json`
  - `output/llr/batch/llr_outliers_overview.png`（時刻/仰角/局/月別の俯瞰）
  - `output/llr/batch/llr_outliers.csv`（中心化Δと出典行つき）
- 公開レポート `output/summary/pmodel_public_report.html` の LLR 章に「外れ値（スパイク）」カード（図＋表）を追加。

メモ（現状の観測）：
- 外れ値は少数（例: n=9）で、特定局（例: GRSM）に集中している。
- うち最大は ms 級（距離換算で数百 km 相当）で、大気/潮汐/Shapiro等では説明できないため一次データ側の異常値を疑う。

再現：
- `python -B scripts/llr/llr_batch_eval.py --offline --time-tag-mode auto --chunk 50 --min-points 30`
- `python -B scripts/summary/public_dashboard.py`

影響ファイル：
- 更新：`scripts/llr/llr_batch_eval.py`
- 更新：`scripts/summary/public_dashboard.py`


---

## 2026-01-01（UTC） LLR：海洋荷重（TOC）を一次ソースで追加

目的：
- LLR（月レーザー測距）を ns 級で詰めるため、観測局変位の「海洋潮汐荷重（TOC）」を一次ソースから導入し、寄与を定量化する。

変更点：
- IMLS（International Mass Loading Service）の HARPOS（調和定数）を取得し、UTC→TT で合成して局変位（Up/East/North）を計算できるようにした。
- `scripts/llr/llr_batch_eval.py` に海洋荷重を統合し、潮汐の切り分け図を「固体+海洋+月」まで拡張した。
- 公開レポート `output/summary/pmodel_public_report.html` の LLR 潮汐カードを更新。

一次ソース：
- NASA/IMLS HARPOS（TOC / FES2014b）: `https://massloading.smce.nasa.gov/imls/load_har_list/toc/fes2014b/toc_fes2014b_harmod.hps`

主要結果（RMS中央値, station×target, 2026-01-01 の再計算）：
- 潮汐（固体+月）: 4.3300 ns → 潮汐（固体+海洋+月）: 4.3245 ns（約 0.0055 ns 改善）
- 詳細：`output/llr/batch/llr_batch_summary.json`

再現：
- `python -B scripts/llr/fetch_ocean_loading_imls.py`（初回のみ）
- `python -B scripts/llr/llr_batch_eval.py --offline --time-tag-mode auto --chunk 50 --min-points 30`
- `python -B scripts/summary/public_dashboard.py`

影響ファイル：
- 追加：`scripts/llr/fetch_ocean_loading_imls.py`
- 追加：`scripts/llr/ocean_loading_harpos.py`
- 更新：`scripts/llr/llr_batch_eval.py`
- 更新：`scripts/summary/public_dashboard.py`
- 更新：`doc/llr/MODEL_SPEC.md`
- 更新：`doc/llr/README.md`
- 取得データ：`data/llr/ocean_loading/toc_fes2014b_harmod.hps`（＋`*.meta.json`）
- 主要出力：`output/llr/batch/llr_tide_ablations_overall.png`、`output/summary/pmodel_public_report.html`


---

## 2026-01-02（UTC） Cassini：PDS TDF の Ka欠測区間を単独バンドで補完し、一次ソース項目を抽出

目的：
- Cassini（太陽会合）ドップラー y(t) を、論文図デジタイズではなく PDS一次データ（TDF）から再現し、左右非対称（t<0 側の欠落）を解消する。
- 後から「どの一次ソース項目をどう使ったか」を追跡できるように、TDF内の主要項目を抽出してCSVに保存する。

変更点：
- `scripts/cassini/cassini_fig2_overlay.py`
  - TDF STATUS BLOCK 1 Item 22 `FREQUENCY LEVEL INDICATOR` を抽出。
  - RADIOMETRIC BLOCK Item 43/44 から Doppler reference/receiver frequency を復元し抽出。
  - Ka+X の共通ビンのみで plasma補正を行う方式から、欠測ビンを単独バンド（Ka優先、Ka欠測はX）で補完する方式へ変更。
  - 中間生成物 `output/cassini/cassini_sce1_tdf_binned_merged.csv` を追加（dual / ka_only / x_only の区別付き）。
- 公開レポート `output/summary/pmodel_public_report.html` を更新（Cassiniカードが最新の系列/指標を参照）。

一次ソース：
- Cassini RSS Raw Data Archive SIS（IO-AR-021, Version 1.2, 2005-07-01）: `data/cassini/pds_sce1/cors_0022/document/casrssis.txt`
  - Item 22: FREQUENCY LEVEL INDICATOR（START_BIT=21, BITS=1）
  - Item 43/44: Doppler reference/receiver frequency（START_BIT=149/181, BITS=32）

主要出力：
- `output/cassini/cassini_sce1_tdf_extracted.csv`（一次データ抽出、列追加）
- `output/cassini/cassini_sce1_tdf_binned_merged.csv`（plasma補正＋欠測補完のビン系列）
- `output/cassini/cassini_fig2_overlay_zoom10d.png`
- `output/cassini/cassini_fig2_metrics.csv`

再現：
- `python -B scripts/cassini/cassini_fig2_overlay.py --no-sweep`
- `python -B scripts/summary/public_dashboard.py`

影響ファイル：
- 更新：`scripts/cassini/cassini_fig2_overlay.py`
- 更新：`doc/STATUS.md`


---

## 2026-01-02（UTC） BepiColombo（MORE）：ロードマップに追加し、PSA公開状況チェックをスクリプト化

目的：
- Cassini の次に BepiColombo（MPO/MORE）を検証対象として追加するため、一次データの公開状況を一次ソース（ESA PSA）で確認できる形にする。
- 「二回目以降はオフライン再現」という運用のため、取得結果を `data/` にキャッシュし、`output/` にレポート用PNG/JSONを固定出力する。

変更点：
- ロードマップ更新：
  - `doc/ROADMAP.md` の Phase3（光伝播/Shapiro）に BepiColombo（MORE）を追記。
  - `doc/STATUS.md` に Phase3 の次ステップ（9: BepiColombo）を追加。
- スクリプト追加：
  - `scripts/bepicolombo/more_psa_status.py` を追加（PSA公開状況の確認＋PNG/JSON生成、オフライン再現対応）。
  - ドキュメント追加：`doc/bepicolombo/README.md`

一次ソース：
- ESA PSA FTP: `https://archives.esac.esa.int/psa/ftp/BepiColombo/bc_mpo_more/`

主要出力：
- `output/bepicolombo/more_psa_status.png`
- `output/bepicolombo/more_psa_status.json`

再現：
- `python -B scripts/bepicolombo/more_psa_status.py`
- `python -B scripts/bepicolombo/more_psa_status.py --offline`

影響ファイル：
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 追加：`scripts/bepicolombo/more_psa_status.py`
- 追加：`doc/bepicolombo/README.md`


---

## 2026-01-02（UTC） BepiColombo（MORE）：PSA確認をレポートに統合し、公開状況（data_raw等404）を固定

目的：
- Cassiniの次ステップとして BepiColombo（MPO/MORE）検証を進めるため、まず一次ソース（ESA PSA）の公開状況を「図＋数値＋再現コマンド」で固定し、一般向けレポートに組み込む。

結果（2026-01-02 時点）：
- PSA `bc_mpo_more/` は `bundle_bc_mpo_more.xml` と `document/` は公開（HTTP 200）。
- `data_raw/` `data_calibrated/` `browse_*` など主要データディレクトリは 404（未公開/未配置の可能性が高い）。
- `document/` からローカル保持：11/20（PDFは未取得のため、既定では非PDFのみ）。

変更点：
- `scripts/bepicolombo/more_psa_status.py`
  - スクリプト直実行時に `scripts.summary` を解決できるように `sys.path` を調整。
  - `has_data_dirs` の判定を「document/ を除外して data_* が公開されているか」に修正。
- `scripts/summary/public_dashboard.py`
  - 公開レポート `output/summary/pmodel_public_report.html` に BepiColombo（MORE）カードを追加（Cassiniの次）。

主要出力：
- `output/bepicolombo/more_psa_status.png`
- `output/bepicolombo/more_psa_status.json`
- `output/summary/pmodel_public_report.html`（BepiColombo章）

再現：
- `python -B scripts/bepicolombo/more_psa_status.py`
- `python -B scripts/bepicolombo/more_psa_status.py --offline`
- `python -B scripts/summary/public_dashboard.py`

影響ファイル：
- 更新：`scripts/bepicolombo/more_psa_status.py`
- 更新：`scripts/summary/public_dashboard.py`


---

## 2026-01-02（UTC） Cassini：PDS一次データ処理の既定条件を更新し、レポートの再現性を改善

目的：
- `scripts/summary/run_all.py` / `scripts/summary/public_dashboard.py` の“標準実行”で、Cassini（PDS一次データ）検証が安定して再生成できる状態にする。
- 「βスイープ未実行なのに古いスイープ図が表示される」など、レポート上の誤解を防ぐ。

変更点：
- `scripts/cassini/cassini_fig2_overlay.py`
  - 既定パラメータを調整（観測系列の復元が安定する設定へ）：
    - `--tdf-y-sign` を `+1`（符号）
    - `--tdf-max-abs-pr-hz` を `10`（外れ値抑制）
    - `--tdf-plasma-fill-mode` を `merged`（Ka欠測を単独バンドで補完）
    - `--tdf-bin-seconds` を `3600`、`--tdf-min-bin-count` を `1`（一般向けに見やすい平滑化）
    - `--tdf-detrend-poly-order` を `0`（過剰デトレンド回避）
  - `output/cassini/cassini_fig2_run_metadata.json` に `argv` / `tdf_y_sign` / `tdf_plasma_fill_mode` を追加し、再現性を強化。
- `scripts/summary/run_all.py`
  - `cassini_fig2_overlay` を `--no-sweep` 付きで実行するように変更（ランタイム短縮、βスイープの誤混入防止）。
- `scripts/summary/public_dashboard.py`
  - Cassini のβスイープは「最新の run_metadata が sweep 実行を示す場合のみ」表示するように変更（古い `cassini_beta_sweep_rmse.csv/png` を誤表示しない）。

主要数値（出典：`output/cassini/cassini_fig2_metrics.csv`）：
- 全点（available）：RMSE=1.6260e-10、相関=0.487925
- ±10日：RMSE=1.6381e-10、相関=0.487982
- ±3日：RMSE=2.5208e-10、相関=0.512857

参考（一次データ vs 論文図デジタイズ、出典：`output/cassini/cassini_pds_vs_digitized_metrics.csv`）：
- 最適時間シフト：+1.300 日、RMSE=1.6833e-10、相関=0.442569

再現：
- 通常（スイープなし）: `python -B scripts/cassini/cassini_fig2_overlay.py --no-sweep`
- レポート更新: `python -B scripts/summary/public_dashboard.py`
- βスイープも生成: `python -B scripts/cassini/cassini_fig2_overlay.py`（`--no-sweep` を付けない）

影響ファイル：
- 更新：`scripts/cassini/cassini_fig2_overlay.py`
- 更新：`scripts/summary/run_all.py`
- 更新：`scripts/summary/public_dashboard.py`
- 更新：`doc/STATUS.md`


---

## 2026-01-02（UTC） Cassini：TDF疑似残差に参照Shapiroを足し戻して y(t) を復元（論文図/モデルと整合）

目的：
- PDS一次データ（TDF）由来の観測系列が、論文図デジタイズやモデル曲線と形状が合わない問題を解消する。
- 「TDFの量が何か（y(t)そのものか、残差か）」を一次ソースに基づいて固定し、以後の検証を正しい量で行う。

背景/判断：
- PDS TDFの `DOPPLER PSEUDORESIDUAL` は “pseudo-residual（観測 - 予測）” であり、論文図のような Shapiro署名を直接表す y(t) と一致しない可能性がある。
- そのため、論文図スケールの y(t) を比較するには、参照モデル（β=1相当）の Shapiro y_ref(t) を足し戻して
  - `y_reconstructed = y_residual + y_ref(t)`  
  として復元する方針にした。

変更点：
- `scripts/cassini/cassini_fig2_overlay.py`
  - 新規オプション：
    - `--tdf-reconstruct-shapiro/--no-tdf-reconstruct-shapiro`（既定: enabled）
    - `--tdf-reconstruct-beta`（既定: 1.0）
  - `output/cassini/cassini_sce1_tdf_paperlike.csv` に `y_model_ref`, `y_reconstructed` 列を追加。
  - 観測系列（点列）は `y_reconstructed` を用いるように変更。
  - `output/cassini/cassini_fig2_run_metadata.json` と実行ログ（`output/summary/work_history.jsonl`）に復元パラメータを記録。
- `scripts/summary/public_dashboard.py`
  - Cassini章の詳細解説に「TDFは疑似残差なので参照Shapiroを足し戻して復元」と明記。

主要数値（出典：`output/cassini/cassini_fig2_metrics.csv`）：
- 全点（available）：RMSE=7.0172e-11、相関=0.963074
- ±10日：RMSE=7.0693e-11、相関=0.963080

参考（PDS処理後 vs 論文図デジタイズ、出典：`output/cassini/cassini_pds_vs_digitized_metrics.csv`）：
- 最適時間シフト：-0.350 日、RMSE=6.3613e-11、相関=0.996848

再現：
- `python -B scripts/cassini/cassini_fig2_overlay.py --no-sweep`
- `python -B scripts/summary/public_dashboard.py`

影響ファイル：
- 更新：`scripts/cassini/cassini_fig2_overlay.py`
- 更新：`scripts/summary/public_dashboard.py`
- 更新：`doc/STATUS.md`


---

## 2026-01-02（UTC） Cassini：βスイープを実行して「β≈1」を確認（レポートに反映）

目的：
- Cassini（一次データPDS TDF復元）で、βの感度と最小RMSE付近を可視化し、他検証（LLR等）へ持ち出せる形にする。

結果（出典：`output/cassini/cassini_beta_sweep_rmse.csv`）：
- 最小RMSE(±10日)のβ=1.000015（スキャン上限、傾向としてはわずかにβ↑でRMSE↓）
- この範囲ではRMSE変化が非常に小さいため、β同定は“鋭い最適化”というより“ほぼ1で整合”の確認として扱う。

出力：
- `output/cassini/cassini_beta_sweep_rmse.csv`
- `output/cassini/cassini_beta_sweep_rmse.png`
- 公開レポート：`output/summary/pmodel_public_report.html`（Cassini章にβスイープカードを表示）

再現：
- `python -B scripts/cassini/cassini_fig2_overlay.py`
- `python -B scripts/summary/public_dashboard.py`


---

## 2026-01-02（UTC） Cassini：README/STATUSを最新化（完了扱い） + BepiColombo（MORE）：PSA再確認とPDF取得

目的：
- Cassini（PDS一次データ化）の「完了状態」をドキュメントに反映し、再現手順と既定値のズレを解消する。
- BepiColombo（MORE）の一次データ公開状況を最新化し、公開済みドキュメント（PDF含む）をローカルにキャッシュして後続実装に備える。

変更点：
- `doc/cassini/README.md`
  - PDS TDF の `DOPPLER PSEUDORESIDUAL` を「疑似残差（観測-予測）」として扱い、参照Shapiro（β=1.0）を足し戻して `y(t)` を復元して比較する方針を明記。
  - `cassini_fig2_overlay.py` の既定値（`bin=3600s`, `detrend=poly0`, `tdf_fixed_frac_bits=0`, `tdf_reconstruct_shapiro=enabled` 等）を反映。
- `doc/STATUS.md`
  - Phase3-8（Cassini一次データ化）を完了チェックに更新。
  - BepiColombo（MORE）の現状参照先を `output/bepicolombo/more_psa_status.json` に変更（定期更新しやすくする）。
- `scripts/bepicolombo/more_psa_status.py`
  - （コード変更なし）実行して PSA 公開状況を再確認し、PDFを含めて document を全件取得。

主要結果（出典：`output/bepicolombo/more_psa_status.json`）：
- generated_utc: 2026-01-02T14:40:15Z
- `document/` は公開（200）・ドキュメント取得 20/20
- `data_raw/` 等は 404（一次データは未公開/未配置の可能性）

再現：
- Cassini README/STATUS 更新後のレポート生成：`python -B scripts/summary/public_dashboard.py`
- BepiColombo（オンライン確認）：`python -B scripts/bepicolombo/more_psa_status.py`
- BepiColombo（PDFも取得）：`python -B scripts/bepicolombo/more_psa_status.py --download-pdfs`

影響ファイル：
- 更新：`doc/cassini/README.md`
- 更新：`doc/STATUS.md`
- 更新：`output/bepicolombo/more_psa_status.json`
- 更新：`output/bepicolombo/more_psa_status.png`


---

## 2026-01-02（UTC） BepiColombo（MORE）：ドキュメント索引（lblx）を追加し、公開レポートに反映

目的：
- Phase3-9（BepiColombo/MORE）を前進するため、一次ソース（PSA document/*.lblx）から“同梱ドキュメント群”をオフラインで索引化し、後続の実データ実装の前提を固定する。
- 一般向けレポート（`output/summary/pmodel_public_report.html`）で、公開状況カード内にドキュメント一覧（表）を表示し、何を参照しているかを可視化する。

変更点：
- `scripts/bepicolombo/more_document_catalog.py` を追加（オフライン）
  - PSA `document/*.lblx` をパースし、ドキュメント索引（JSON/CSV）を生成。
- `doc/bepicolombo/MORE_DATA_NOTES.md` を追加
  - PSAバンドルが指すコレクションと、ドキュメント索引から読み取れる“データ形式の当たり”（CCSDS TDM/NDM 等）を整理。
- `scripts/summary/public_dashboard.py` を更新
  - BepiColombo（MORE）カードにドキュメント一覧（表）を追加表示。

出力：
- `output/bepicolombo/more_document_catalog.json`
- `output/bepicolombo/more_document_catalog.csv`
- 公開レポート：`output/summary/pmodel_public_report.html`

再現：
- `python -B scripts/bepicolombo/more_document_catalog.py`
- `python -B scripts/summary/public_dashboard.py`

影響ファイル：
- 追加：`scripts/bepicolombo/more_document_catalog.py`
- 追加：`doc/bepicolombo/MORE_DATA_NOTES.md`
- 更新：`doc/bepicolombo/README.md`
- 更新：`scripts/summary/public_dashboard.py`
- 更新：`doc/STATUS.md`


---

## 2026-01-02（UTC） BepiColombo（MORE）：data_raw 公開待ちのコレクション取得スクリプトを追加

目的：
- PSA の `data_raw/` 等が公開された瞬間に、まずは **collection/label/index（xml/csv/lblx 等）** を自動取得してキャッシュし、一次データの配布形式・ファイル一覧を一次ソースで確定できるようにする。
- 2回目以降は `data/` キャッシュでオフライン再現できる運用にする。

変更点：
- `scripts/bepicolombo/more_fetch_collections.py` を追加。
  - `data_raw/` 等が 200 になった場合に、Apache listing からファイル一覧を取得し、メタデータ（xml/csv/lblx/txt/md）をダウンロード。
  - 容量が大きい非メタデータ（観測データ本体）は既定で取得しない（`--download-data` が必要）。

現状（2026-01-02 時点）：
- `data_raw/` 等は 404 のため、ダウンロードは発生しない（要約: `output/bepicolombo/more_fetch_collections.json`）。

再現：
- `python -B scripts/bepicolombo/more_fetch_collections.py`
- `python -B scripts/bepicolombo/more_fetch_collections.py --offline`

出力：
- `output/bepicolombo/more_fetch_collections.json`
- キャッシュ：`data/bepicolombo/psa_more/fetch_collections_meta.json`

影響ファイル：
- 追加：`scripts/bepicolombo/more_fetch_collections.py`
- 更新：`doc/bepicolombo/README.md`
- 更新：`doc/bepicolombo/MORE_DATA_NOTES.md`
- 更新：`doc/STATUS.md`


---

## 2026-01-02（UTC） BepiColombo（MORE）：PSA 公開状況の“ディレクトリ一覧”も一次ソースで固定

目的：
- Phase3-9（BepiColombo/MORE）を前進するため、PSA上で「今見えているもの（bundle/documentのみ等）」を、ディレクトリ一覧まで含めて機械的に記録し、後続の議論の根拠を強化する。

変更点：
- `scripts/bepicolombo/more_psa_status.py` を更新
  - `BepiColombo/` と `bc_mpo_more/` の Apache listing をキャッシュ（`data/bepicolombo/psa_more/*_index.html`）し、JSON/PNG に反映。
- `scripts/summary/public_dashboard.py` を更新
  - BepiColombo（MORE）カードの概要に、`bc_mpo_more/` 直下の dir/file 数を表示。
- `doc/bepicolombo/README.md` を更新
  - キャッシュファイルと「定期確認（例：週1）」の運用を追記。

主要結果（出典：`output/bepicolombo/more_psa_status.json`）：
- `BepiColombo/` 直下に `bc_mpo_more/` が存在（他instrument bundleも併記）
- `bc_mpo_more/` 直下は `bundle_bc_mpo_more.xml` と `document/` のみ（`data_raw/` 等は 404 のまま）

再現：
- `python -B scripts/bepicolombo/more_psa_status.py --download-pdfs`
- `python -B scripts/summary/public_dashboard.py`

影響ファイル：
- 更新：`scripts/bepicolombo/more_psa_status.py`
- 更新：`scripts/summary/public_dashboard.py`
- 更新：`doc/bepicolombo/README.md`
- 更新：`doc/STATUS.md`


---

## 2026-01-02（UTC） BepiColombo（SPICE）：PSA 公開状況と inventory を一次ソースで固定

目的：
- BepiColombo（MPO/MORE）検証の前提となる幾何（軌道/座標系/時刻系）を、一次ソース（ESA PSA）で追跡可能にする。
- PSA の `bc_spice/` 公開状況と、SPICE inventory（`collection_spice_kernels_inventory_v*.csv`）を取得し、オフライン再現できる形でキャッシュする。

変更点：
- `scripts/bepicolombo/spice_psa_status.py` を追加
  - `bc_spice/` と `spice_kernels/` の listing をキャッシュし、最新 bundle / 最新 inventory を取得して要約（JSON/PNG）を生成。
- `scripts/summary/public_dashboard.py` を更新
  - `output/summary/pmodel_public_report.html` に BepiColombo（SPICE）カードを追加（Cassiniの次、BepiColombo（MORE）の直後）。
- `doc/bepicolombo/README.md` を更新
  - SPICE の再現手順（オンライン/オフライン）と生成物/キャッシュを追記。
- `doc/STATUS.md` を更新
  - Phase3-9 の進捗として SPICE status/inventory を明記。

出力：
- `output/bepicolombo/spice_psa_status.json`
- `output/bepicolombo/spice_psa_status.png`

キャッシュ：
- `data/bepicolombo/psa_spice/`

再現：
- `python -B scripts/bepicolombo/spice_psa_status.py`
- `python -B scripts/bepicolombo/spice_psa_status.py --offline`
- `python -B scripts/summary/public_dashboard.py`

影響ファイル：
- 追加：`scripts/bepicolombo/spice_psa_status.py`
- 更新：`scripts/summary/public_dashboard.py`
- 更新：`doc/bepicolombo/README.md`
- 更新：`doc/STATUS.md`


---

## 2026-01-02（UTC） BepiColombo（SPICE）：最小カーネル取得＋太陽会合 Shapiro 予測（幾何チェック）

目的：
- Phase3-9（BepiColombo）を前進するため、一次ソース（ESA PSA の SPICE kernels）から幾何を計算し、太陽会合で期待される Shapiro 信号の“形と強さ”を先に固定する。
- MORE（レンジ/ドップラー）一次データが公開された後、同じ y(t)/Δt(t) 指標で Cassini と同形式の比較に直結できる状態にする。

一次ソース：
- ESA PSA（bc_spice / spice_kernels）：`https://archives.esac.esa.int/psa/ftp/BepiColombo/bc_spice/spice_kernels/`

変更点：
- `scripts/bepicolombo/fetch_spice_kernels_psa.py` を修正（PSA meta-kernel解析の不具合を修正）
- `scripts/bepicolombo/bepicolombo_shapiro_predict.py` を追加（SPICE幾何→会合中心探索→b(t)/Δt(t)/y(t) を出力）
- `scripts/summary/public_dashboard.py` を更新
  - 予測図（`output/bepicolombo/bepicolombo_shapiro_geometry.png`）を `output/summary/pmodel_public_report.html` に追加
- `scripts/summary/run_all.py` を更新（BepiColombo 関連タスクを追加）
- `doc/bepicolombo/README.md` / `doc/STATUS.md` を更新（再現手順と進捗の明記）

主要結果（出典：`output/bepicolombo/bepicolombo_shapiro_geometry_summary.json`）：
- 会合中心（UTC）：`2026-05-10T01:12:19.534000+00:00`
- b_min（閾値 min_b_rsun=1.0 以上の範囲）：約 `1.1143 R_sun`
- 参考：窓内の最小b（無制限）：約 `0.0528 R_sun`（太陽円盤内になる時間帯がある）
- y_peak（Eq.2, |y|最大, 非遮蔽のみ）：約 `1.85e-09`
- 往復Δt（μs, 非遮蔽のみ）：約 `67.2 .. 212.4 μs`

再現：
- カーネル取得（オンライン）：`python -B scripts/bepicolombo/fetch_spice_kernels_psa.py`
- 予測図生成：`python -B scripts/bepicolombo/bepicolombo_shapiro_predict.py --min-b-rsun 1.0`
- 公開レポート更新：`python -B scripts/summary/public_dashboard.py`

出力：
- `output/bepicolombo/bepicolombo_shapiro_geometry.png`
- `output/bepicolombo/bepicolombo_shapiro_geometry.csv`
- `output/bepicolombo/bepicolombo_shapiro_geometry_summary.json`
- カーネルキャッシュ：`data/bepicolombo/kernels/psa/`

影響ファイル：
- 更新：`scripts/bepicolombo/fetch_spice_kernels_psa.py`
- 追加：`scripts/bepicolombo/bepicolombo_shapiro_predict.py`
- 更新：`scripts/summary/public_dashboard.py`
- 更新：`scripts/summary/run_all.py`
- 更新：`doc/bepicolombo/README.md`
- 更新：`doc/STATUS.md`


---

## 2026-01-02（UTC） BepiColombo（SPICE）：b の定義を線分距離へ修正＋太陽会合イベント一覧を追加

目的：
- 太陽会合の幾何で使うインパクトパラメータ b を「地球→探査機の有限線分」に対する最近接距離として定義し、推定が破綻しない形にする。
- MORE（観測）が未公開でも、SPICE一次ソースだけで「どの時期に強い Shapiro 信号が出るか」を一覧化しておく。

変更点：
- `scripts/bepicolombo/bepicolombo_shapiro_predict.py`：
  - b を従来の無限直線距離 `|rE×rS|/|rS-rE|` ではなく、**有限線分 Earth→spacecraft の最近接距離**として計算するよう修正（t を [0,1] にクランプ）。
  - 端点ケース/内部ケースで db/dt を一貫して計算できるよう微分式を更新。
- `scripts/bepicolombo/bepicolombo_conjunction_catalog.py`（新規）：
  - SPICE幾何から太陽会合イベント（bが小さい局所最小）を抽出し、b_min/Δt/y_peak を一覧化して出力。
- `output/summary/pmodel_public_report.html`：
  - BepiColombo「太陽会合イベント一覧」カードを追加（Shapiro予測カードの次）。

主要結果（出典：`output/bepicolombo/bepicolombo_conjunction_catalog_summary.json`）：
- n_events=15（max_b=10 R_sun で抽出）
- 最小 b（非遮蔽）= 1.0200 R_sun
- 最大 往復Δt（非遮蔽）= 215.84 μs

再現：
- `python -B scripts/bepicolombo/bepicolombo_shapiro_predict.py --min-b-rsun 1.0`
- `python -B scripts/bepicolombo/bepicolombo_conjunction_catalog.py --min-b-rsun 1.0 --max-b-rsun 10.0`
- `python -B scripts/summary/public_dashboard.py`

影響ファイル：
- 更新：`scripts/bepicolombo/bepicolombo_shapiro_predict.py`
- 追加：`scripts/bepicolombo/bepicolombo_conjunction_catalog.py`
- 更新：`scripts/summary/public_dashboard.py`
- 更新：`scripts/summary/run_all.py`
- 更新：`doc/bepicolombo/README.md`
- 更新：`doc/STATUS.md`


---

## 2026-01-02（UTC） BepiColombo（MORE）：コレクション取得/文書索引を run_all に統合

目的：
- Phase3-9（BepiColombo/MORE）の一次データ公開待ちの間も、公開状況確認と取得準備をワンコマンドで再現できるようにする。
- `output/summary/pmodel_public_report.html` の BepiColombo（MORE）章が、常に最新のキャッシュ/出力を参照できる状態にする。

現状（一次ソース, 2026-01-02 時点）：
- `bc_mpo_more` の `data_raw/` 等は 404 のまま（`output/bepicolombo/more_psa_status.json` / `output/bepicolombo/more_fetch_collections.json` を参照）。

変更点：
- `scripts/summary/run_all.py` に以下のタスクを追加：
  - MORE コレクション取得：`scripts/bepicolombo/more_fetch_collections.py` → `output/bepicolombo/more_fetch_collections.json`
  - MORE 文書索引：`scripts/bepicolombo/more_document_catalog.py` → `output/bepicolombo/more_document_catalog.csv`
- `doc/STATUS.md` を更新（Phase3-9 の進捗に追記）。

再現：
- オフライン（推奨, レポート更新まで）：`python -B scripts/summary/run_all.py --offline`
- 個別（オンライン）：
  - `python -B scripts/bepicolombo/more_psa_status.py`
  - `python -B scripts/bepicolombo/more_fetch_collections.py`
  - `python -B scripts/bepicolombo/more_document_catalog.py`

影響ファイル：
- 更新：`scripts/summary/run_all.py`
- 更新：`doc/STATUS.md`


---

## 2026-01-02（UTC） BepiColombo（MORE）：コレクション取得を「collection_*.xml/csv のみ」に保守的化

目的：
- `data_raw/` 等が公開された瞬間、ディレクトリ内に大量の製品ラベル（*.lblx）やデータ本体が存在しても、誤って一括ダウンロードしないようにする。
- まずは “何が配布されるか” を確定するために必要な `collection_*.xml/csv` を確実に取得する。

変更点：
- `scripts/bepicolombo/more_fetch_collections.py`：
  - 既定の取得対象を `collection_*.xml/csv` 等の小さめメタに限定。
  - まず `collection_<dir>.xml/csv` を直接取得し（高速）、必要な場合のみ listing を見る。

再現：
- `python -B scripts/bepicolombo/more_fetch_collections.py`

影響ファイル：
- 更新：`scripts/bepicolombo/more_fetch_collections.py`


---

## 2026-01-02（UTC） BepiColombo（MORE）：PSA公開状況を再確認（data_raw等は未公開のまま）＋予測図を再生成

目的：
- Phase3-9（BepiColombo/MORE）をロードマップ順に進めるため、PSAの公開状況をオンラインで再確認し、公開されていない場合でも「予測図（SPICE幾何）」と「一般向けレポート」を最新の出力で固定する。

結果（一次ソース, generated_utc=2026-01-02T23:27:32Z）：
- PSA `bc_mpo_more/` は `document/` のみ 200、`data_raw/` `data_calibrated/` 等は 404（未公開/未配置の可能性）。
- したがって現時点では Cassini と同形式の “観測 vs P-model（y(t)）” は未実施。

実行（オンライン）：
- `python -B scripts/bepicolombo/more_psa_status.py`
- `python -B scripts/bepicolombo/more_fetch_collections.py`
- `python -B scripts/bepicolombo/spice_psa_status.py`
- `python -B scripts/bepicolombo/fetch_spice_kernels_psa.py`
- `python -B scripts/bepicolombo/bepicolombo_shapiro_predict.py`
- `python -B scripts/bepicolombo/bepicolombo_conjunction_catalog.py`
- `python -B scripts/summary/public_dashboard.py`

主要出力：
- PSA公開状況：`output/bepicolombo/more_psa_status.json` / `output/bepicolombo/more_psa_status.png`
- コレクション取得（未公開のため 0件）：`output/bepicolombo/more_fetch_collections.json`
- SPICE公開状況：`output/bepicolombo/spice_psa_status.json` / `output/bepicolombo/spice_psa_status.png`
- 予測（幾何＋P-model）：`output/bepicolombo/bepicolombo_shapiro_geometry.png` / `output/bepicolombo/bepicolombo_conjunction_catalog.png`
- 公開レポート：`output/summary/pmodel_public_report.html`

影響ファイル：
- 更新：`doc/STATUS.md`
- 更新：`doc/WORK_HISTORY.md`


---

## 2026-01-02（UTC） ロードマップ更新：BepiColombo（MORE）を一次データ未公開のため保留へ（次は Viking→Mercury→GPS）

目的：
- BepiColombo（MORE）の一次データ（range/Doppler）が PSA 側で未公開のため、必須経路として待ち続けずに前進できるよう、ロードマップから一旦外す。
- ただし公開された瞬間に検証へ入れるよう、準備スクリプト/キャッシュ/予測出力は維持する。

変更点：
- `doc/ROADMAP.md`：Phase 3 の必須セットから BepiColombo（MORE）を外し、「保留（ブロック中）」へ移動。
- `doc/STATUS.md`：直近ロードマップを `LLR→Cassini→Viking→Mercury→GPS` に変更し、BepiColombo（MORE）は「保留」扱いに変更。

影響ファイル：
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`


---

## 2026-01-03（UTC） Viking：Horizons一次ソースでShapiro遅延ピークを再現し、公開レポートへ統合

目的：
- Viking（火星着陸船）に関する Shapiro 遅延（太陽会合）の代表値（約250 μs）を、再取得可能な一次ソース（JPL Horizons）から再現する。
- “観測（代表値） vs P-model” の比較図と主要数値を `output/summary/pmodel_public_report.html` に反映する。

一次ソース：
- NASA JPL Horizons API: `https://ssd.jpl.nasa.gov/api/horizons.api`（Earth=399, Mars=499, center=Sun 500@10, ICRF, KM-S）

結果：
- 往復 Shapiro 遅延（γ=1）のピーク：247.96 μs @ 1976-11-25T00:00:00Z
- 文献代表値（約250 μs）と整合（オーダー一致、ピーク位置も整合）

主要出力：
- `output/viking/viking_shapiro_result.csv`（時系列）
- `output/viking/viking_p_model_vs_measured_no_arrow.png`（代表値 vs P-model）
- `output/viking/P_model_Verification_Full.pptx`（概念スライド＋検証追記）
- 公開レポート：`output/summary/pmodel_public_report.html`

再現：
- `python -B scripts/viking/viking_shapiro_check.py --beta 1.0 --offline`
- `python -B scripts/viking/update_slides.py`
- `python -B scripts/summary/public_dashboard.py`

影響ファイル：
- 更新：`scripts/viking/viking_shapiro_check.py`（SSL/作業ログ対応）
- 更新：`scripts/viking/update_slides.py`（作業ログ対応）
- 更新：`scripts/summary/public_dashboard.py`（Vikingピーク値の表示）
- 更新：`doc/STATUS.md`


---

## 2026-01-03（UTC） Mercury：近日点移動を実Cで定量化（角秒/世紀）し、固定出力とレポートへ統合

目的：
- Mercury（近日点移動）を “可視化（誇張表示）” だけでなく、実C（物理定数）での推定値（角秒/世紀）として固定する。
- 公開レポートに「推定値 vs 参照値（代表）」を表示して、理解しやすい比較にする。

結果（数値シミュレーション, 実C）：
- P-model 推定：42.9929 角秒/世紀
- Einstein近似：42.9929 角秒/世紀
- 参照（観測残差の代表）：42.98 角秒/世紀

主要出力：
- `output/mercury/mercury_orbit.png`（左：誇張表示、右：実Cでの累積）
- `output/mercury/mercury_perihelion_shifts.csv`（周回ごとの累積）
- `output/mercury/mercury_precession_metrics.json`（推定値/設定/指標）
- 公開レポート：`output/summary/pmodel_public_report.html`

再現：
- `python -B scripts/mercury/mercury_precession_v3.py`
- `python -B scripts/summary/public_dashboard.py`

影響ファイル：
- 更新：`scripts/mercury/mercury_precession_v3.py`（実Cでの定量＋固定出力＋作業ログ）
- 更新：`scripts/summary/public_dashboard.py`（Mercuryの要約行に推定値を表示）
- 更新：`doc/STATUS.md`


---

## 2026-01-03（UTC） GPS：IGS Final（CLK/SP3）を一次ソースとして固定し、残差比較の出力・ログを安定化

目的：
- GPS検証を「毎回同じ入力（IGS Final + BRDC）」「同じ指標（残差RMS, dt_rel比較）」「同じ出力名」で再現できるように固定する。
- 公開レポートに、全衛星の残差RMS比較（BRDC vs P-model）を解説付きで表示する。

一次ソース（入力, ローカル保持）：
- IGS Final（CLK/SP3）：`data/gps/IGS0OPSFIN_20252740000_01D_05M_CLK.CLK` / `data/gps/IGS0OPSFIN_20252740000_01D_15M_ORB.SP3`
- 放送暦（BRDC）：`data/gps/BRDC00IGS_R_20252740000_01D_MN.rnx`

主要出力：
- `output/gps/summary_batch.csv`（全衛星のRMS集計）
- `output/gps/gps_rms_compare.png`（全衛星のRMS比較）
- `output/gps/gps_clock_residuals_all_31.png`（全衛星の時系列）
- `output/gps/gps_residual_compare_G01.png`（例：G01の時系列比較）
- `output/gps/gps_relativistic_correction_G02.png`（dt_rel周期成分の一致確認）
- 指標JSON：`output/gps/gps_compare_metrics.json`
- 公開レポート：`output/summary/pmodel_public_report.html`

再現：
- `python -B scripts/gps/compare_clocks.py`
- `python -B scripts/gps/plot.py`
- `python -B scripts/summary/public_dashboard.py`

影響ファイル：
- 更新：`scripts/gps/compare_clocks.py`（作業ログ対応）
- 更新：`scripts/gps/plot.py`（作業ログ対応）
- 更新：`doc/STATUS.md`


---

## 2026-01-03（UTC） EHT：ブラックホール影サイズ（リング直径）を追加し、強重力テストを公開値ベースで可視化

目的：
- 強重力領域（ブラックホール近傍）の観測として、EHT（Event Horizon Telescope）の公表値（リング直径）を P-model と比較できる形にする。
- ネットワーク不要で再現できるよう、使用する数値（質量/距離/リング直径）を `data/eht/` に固定し、`output/summary/pmodel_public_report.html` に統合する。

結果（β=1）：
- M87*：観測リング直径=42.0±3.0 μas、P-model影直径=41.53±4.89 μas（β_fit=1.011±0.139）
- Sgr A*：観測リング直径=51.8±2.3 μas、P-model影直径=54.52±0.25 μas（β_fit=0.950±0.042）

主要出力：
- `output/eht/eht_shadow_compare.png`（観測 vs P-model vs 参考GRの棒＋誤差棒）
- `output/eht/eht_shadow_compare.csv` / `output/eht/eht_shadow_compare.json`（数値・前提・係数）
- 公開レポート：`output/summary/pmodel_public_report.html`（EHT章を追加）

再現：
- `python -B scripts/eht/eht_shadow_compare.py`
- `python -B scripts/summary/public_dashboard.py`

影響ファイル：
- 追加：`data/eht/eht_black_holes.json`（固定入力）
- 追加：`scripts/eht/eht_shadow_compare.py`（比較出力＋作業ログ）
- 追加：`doc/eht/README.md`（仮定・式・出典）
- 更新：`scripts/summary/public_dashboard.py`（EHT章の追加）
- 更新：`scripts/summary/run_all.py`（EHTタスクを追加）
- 更新：`doc/ROADMAP.md` / `doc/STATUS.md`


---

## 2026-01-03（UTC） 公開レポートから BepiColombo を一時的に除外（一次データ未公開のため）

目的：
- BepiColombo（MORE）の一次データ（レンジ/ドップラー）が未公開の段階では、一般向けレポートに載せず、検証準備（PSA公開状況/幾何予測）は内部で維持する。

変更：
- `scripts/summary/public_dashboard.py` で BepiColombo カード群をデフォルト非表示にした。
  - 表示したい場合のみ `WAVEP_INCLUDE_BEPICOLOMBO=1` を環境変数に設定してレポート生成する。

主要出力：
- 公開レポート：`output/summary/pmodel_public_report.html`（BepiColombo章が出ないことを確認）

再現：
- `python -B scripts/summary/public_dashboard.py`

影響ファイル：
- 更新：`scripts/summary/public_dashboard.py`
- 更新：`doc/STATUS.md`


---

## 2026-01-03（UTC） Phase 2：run_all の標準化（ブロック中テーマを既定で除外、実行状況をレポートに表示）

目的：
- 再現バッチ `scripts/summary/run_all.py` を「必須ロードマップの検証」に集中させる（ブロック中テーマは既定で走らせない）。
- バッチが成功しているか/何がスキップされたかを、公開レポートの冒頭で確認できるようにする。

変更：
- `scripts/summary/run_all.py`
  - `--include-blocked` を追加（既定はブロック中テーマを実行しない）。
  - `run_all_status.json` に `include_blocked` を記録（履歴追跡用）。
- `scripts/summary/public_dashboard.py`
  - 公開レポートに「再現バッチ（run_all）の状態」カードを追加（失敗/スキップの要点のみ）。
  - 公開レポートではブロック中テーマ（例：BepiColombo）を表示しない（run_all/履歴からも除外）。
- `doc/BLOCKED.md` に `--include-blocked` の運用を追記。

再現：
- `python -B scripts/summary/run_all.py --offline`
- `python -B scripts/summary/run_all.py --online`

影響ファイル：
- 更新：`scripts/summary/run_all.py`
- 更新：`scripts/summary/public_dashboard.py`
- 更新：`doc/BLOCKED.md`
- 更新：`doc/STATUS.md`


---

## 2026-01-03（UTC） doc/summary の再現手順を更新（run_allの出力・ブロック中オプション）

目的：
- Phase 2（再現性）の入口ドキュメントを最新化し、手順の迷いをなくす。

変更：
- `doc/summary/README.md` を更新：
  - `--include-blocked` の使い方を追記。
  - 生成物一覧を `pmodel_public_dashboard.png` / `run_all_status.json` / `work_history.jsonl` に合わせて更新。

影響ファイル：
- 更新：`doc/summary/README.md`


---

## 2026-01-03（UTC） Phase 2（再現性の標準化）を「一旦完了」に更新

目的：
- `run_all.py --offline` で主要検証が再現でき、公開レポートで進捗/履歴/実行状況も確認できる状態になったため、Phase 2 の初版完了として扱う。

変更：
- `doc/STATUS.md` の Phase 2 を「一旦完了」に更新。

再現：
- `python -B scripts/summary/run_all.py --offline`

影響ファイル：
- 更新：`doc/STATUS.md`


---

## 2026-01-03（UTC） Phase 4（差分予測）: EHTで「P-model vs GR の数%差」を図示

目的：
- Phase 3（整合の確認）に加えて、**反証可能性**のために「P-model と標準理論で差が出る観測量」を提示する。
- まずは EHT（ブラックホール影）で、βを固定した後でも残る係数差（数%）を可視化し、必要精度の目安を出す。

変更：
- `scripts/eht/eht_shadow_compare.py` を拡張し、差分予測図 `output/eht/eht_shadow_differential.png` を生成するようにした。
  - 差（P-model − GR, μas）と、3σで判別するための必要観測誤差（1σ, μas）の目安を並べて表示。
- `scripts/summary/public_dashboard.py` の EHT 章に差分予測図を追加した。
- `doc/eht/README.md` に Phase 4（差分予測）の説明を追記。

主要出力：
- `output/eht/eht_shadow_differential.png`
- 公開レポート：`output/summary/pmodel_public_report.html`（EHT章に差分予測カードが追加）

再現：
- `python -B scripts/eht/eht_shadow_compare.py`
- `python -B scripts/summary/public_dashboard.py`

影響ファイル：
- 更新：`scripts/eht/eht_shadow_compare.py`
- 更新：`scripts/summary/public_dashboard.py`
- 更新：`doc/eht/README.md`
- 更新：`doc/STATUS.md`


---

## 2026-01-03（UTC） Phase 4（差分予測）: 速度飽和 δ の整合図（既知の高γ観測）を追加

目的：
- P-modelの速度項では v→c で dτ/dt が 0 に落ちず、ローレンツ因子 γ に上限 γ_max≈1/√δ が生じる（SRと異なる差分予測）。
- 既知の高エネルギー粒子（加速器/宇宙線/ニュートリノ等）と矛盾しないために、δ をどこまで小さくする必要があるかを可視化する。

変更：
- 固定入力（例）を追加：`data/theory/delta_saturation_examples.json`
- 整合図を生成するスクリプトを追加：`scripts/theory/delta_saturation_constraints.py`
  - `output/theory/delta_saturation_constraints.png`（γとδ上限の2面図）
  - `output/theory/delta_saturation_constraints.csv` / `.json`（数値）
- 公開レポート：`output/summary/pmodel_public_report.html` に Phase 4 セクションを追加し、δ図とEHT差分図を同一章に整理。
- `scripts/summary/run_all.py` に theory_delta_saturation_constraints を追加。
- `doc/theory/README.md` と `doc/STATUS.md` を更新。

再現：
- `python -B scripts/theory/delta_saturation_constraints.py`
- `python -B scripts/summary/public_dashboard.py`

影響ファイル：
- 追加：`data/theory/delta_saturation_examples.json`
- 追加：`scripts/theory/delta_saturation_constraints.py`
- 更新：`scripts/summary/public_dashboard.py`
- 更新：`scripts/summary/run_all.py`
- 更新：`doc/theory/README.md`
- 更新：`doc/STATUS.md`


---

## 2026-01-03（UTC） BepiColombo（MORE）をロードマップ外へ整理（保留情報を `doc/BLOCKED.md` に集約）

目的：
- BepiColombo（MORE）は一次データ未公開のため、現時点の必須ロードマップから外し、混乱を防ぐ。
- ただし「公開された瞬間に検証へ合流できる準備」は維持する（削除ではなく退避）。

変更：
- ロードマップ：
  - `doc/ROADMAP.md` から BepiColombo（MORE）の詳細を外し、ブロック中/保留の案内を `doc/BLOCKED.md` に統一。
- 進捗：
  - `doc/STATUS.md` の BepiColombo 詳細章を削除し、`doc/BLOCKED.md` へのポインタだけ残した。
- 公開レポート：
  - `output/summary/pmodel_public_report.html` は引き続きデフォルト非掲載（内部確認のみ `WAVEP_INCLUDE_BEPICOLOMBO=1`）。

影響ファイル：
- 追加：`doc/BLOCKED.md`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`


---

## 2026-01-03（UTC） Phase 5（論文化）を開始（アウトライン＋図表インデックスを追加）

目的：
- Phase 3/4 の成果物（`output/`）を参照しながら、論文本文へ落とすための “骨格” を先に固定する。
- 図表パスを固定し、結果の差し替え運用（再計算→図だけ更新）ができる状態にする。

変更：
- `doc/paper/` を追加し、以下を用意。
  - `doc/paper/00_outline.md`（章立ての雛形）
  - `doc/paper/01_figures_index.md`（図表インデックス: 固定パス）
  - `doc/paper/README.md`（運用）
- `doc/STATUS.md` の Phase 5 を「進行中」に更新。

影響ファイル：
- 追加：`doc/paper/README.md`
- 追加：`doc/paper/00_outline.md`
- 追加：`doc/paper/01_figures_index.md`
- 更新：`doc/STATUS.md`


---

## 2026-01-03（UTC） Phase 0/1 の定義・最小導出を更新（時計の重力項、最短経路の意味を明確化）

目的：
- 「Pが高い所へ寄る＝最短経路」という説明を、経路長（到達時間/位相）として一貫した形に固定する。
- 速度式（δ飽和）と重力項（P0/P）を組み合わせた “時計の結論形” を、Phase 0/1 の資料側にも明記する。

変更：
- Phase 0（辞書）：
  - `doc/theory/04_postulates_and_dictionary.md` に `t/τ` の定義と、時計の分解 `dτ/dt = (P0/P) * (dτ/dt)_v` を追記。
  - 「最短経路」を `∫ n ds`（到達時間/位相）として固定し、「波面密度（位相蓄積）」との対応を補足。
- Phase 1（最小導出）：
  - `doc/theory/05_minimal_derivations.md` に、静止時計の重力項 `P0/P = exp(φ/c^2)` と、速度項（δ飽和）を掛け合わせた結論形を追記。
  - Cassiniの `y(t)`（ドップラー観測量）節を日本語化し、PPN対応 `(1+γ)=2β` の形で整理。
- 進捗：
  - `doc/STATUS.md` の Phase 0/1 を「一旦完了（初版）」に更新。

影響ファイル：
- 更新：`doc/theory/04_postulates_and_dictionary.md`
- 更新：`doc/theory/05_minimal_derivations.md`
- 更新：`doc/STATUS.md`


---

## 2026-01-03（UTC） 公開レポートに「ロードマップ/進捗」を統合（Phase表＋直近の作業履歴）

目的：
- 「ロードマップを示して」「進んでいるか？」が頻発しているため、公開レポート上で現在地が一目で分かるようにする。
- どのスクリプトが何を生成したかを、レポートから辿れる形にして重複作業を防ぐ（Phase 2 の前進）。

変更：
- `scripts/summary/public_dashboard.py`
  - 先頭に「ロードマップ / 進捗」章を追加（`doc/STATUS.md` の Phase 行から表を生成）。
  - 直近の作業履歴（自動ログ）を `output/summary/work_history.jsonl` から抜粋して表示。
  - 画像を持たないカードで `Missing: None` を出さないようにHTML生成を修正。
  - ブロック中テーマ（例：BepiColombo）が公開レポートに混入しないよう、履歴表示から除外。

再現：
- `python -B scripts/summary/public_dashboard.py`
- `python -B scripts/summary/run_all.py --offline`

出力：
- `output/summary/pmodel_public_report.html`（冒頭にロードマップ/履歴章を追加）

影響ファイル：
- 更新：`scripts/summary/public_dashboard.py`
- 更新：`doc/STATUS.md`


---

## 2026-01-03（UTC） Phase 5（論文化）: 本文草稿＋Table 1（検証サマリ）を追加

目的：
- Phase 5 を「アウトライン」から一段進め、本文草稿（章の肉付け）と論文用サマリ表（Table 1）の生成を追加する。
- `output/` に固定された結果から、論文化用の表を再現可能に集計できるようにする（差し替え運用を前提）。

変更：
- `doc/paper/10_manuscript.md` を追加（草稿本文。Phase 0/1 の定義・式と Phase 3/4 の成果物パスを整理）。
- `scripts/summary/paper_tables.py` を追加し、検証結果から論文用 Table 1 を生成。

再現：
- `python -B scripts/summary/paper_tables.py`

出力：
- `output/summary/paper_table1_results.md`（Table 1）
- `output/summary/paper_table1_results.csv`
- `output/summary/paper_table1_results.json`

影響ファイル：
- 追加：`doc/paper/10_manuscript.md`
- 追加：`scripts/summary/paper_tables.py`
- 更新：`doc/STATUS.md`


---

## 2026-01-03（UTC） Phase 5（論文化）: Table 1 を run_all に統合（再現バッチで自動更新）

目的：
- `python -B scripts/summary/run_all.py` の実行だけで、公開レポート更新に加えて Table 1（論文用サマリ）も常に最新化されるようにする。
- 図表インデックス（固定パス）と summary の運用ドキュメントにも Table 1 を明示して、参照点を一本化する。

変更：
- `scripts/summary/run_all.py` に `paper_table1` タスクを追加（`scripts/summary/paper_tables.py` を実行）。
- `doc/paper/01_figures_index.md` に Table 1（固定パス）を追記。
- `doc/paper/README.md` と `doc/summary/README.md` に Table 1 を追記。

再現：
- `python -B scripts/summary/run_all.py --offline`

影響ファイル：
- 更新：`scripts/summary/run_all.py`
- 更新：`doc/paper/01_figures_index.md`
- 更新：`doc/paper/README.md`
- 更新：`doc/summary/README.md`


---

## 2026-01-03（UTC） Phase 5（論文化）: 本文Resultsを肉付け + 公開レポートに Table 1 を統合

目的：
- Phase 5 の本文草稿を「成果物パス列挙」から一歩進め、各検証（LLR/Cassini/Viking/Mercury/GPS/EHT/δ）ごとの結果を文章化する。
- 一般向け統一レポート `output/summary/pmodel_public_report.html` の冒頭で、検証サマリ（Table 1）を一覧できるようにする。

変更：
- `doc/paper/10_manuscript.md`
  - Results に各テーマの結果（主要数値＋固定パス）を追記。
  - 再現/入手性（`doc/paper/20_data_sources.md` への導線）を追記。
- `scripts/summary/public_dashboard.py`
  - `output/summary/paper_table1_results.json` を読み取り、Table 1 を「ロードマップ/進捗」章にカードとして表示。

再現：
- `python -B scripts/summary/run_all.py --offline`
- `python -B scripts/summary/public_dashboard.py`

出力：
- `output/summary/pmodel_public_report.html`（Table 1 を冒頭に統合）

影響ファイル：
- 更新：`doc/paper/10_manuscript.md`
- 更新：`scripts/summary/public_dashboard.py`


---

## 2026-01-03（UTC） Phase 3/4（EHT）: 系統誤差（κ）と Kerr スピン依存（参考レンジ）を追加

目的：
- EHTの比較が「リング直径≒シャドウ直径」の近似に依存して暫定に見える点を明確化し、どの系統誤差が効きうるかを可視化する。
- 一般向け統一レポートに「κ（リング↔シャドウ変換）」と「GR（Kerr）のスピン/傾き依存レンジ」を併記して、数%差の解釈を誤らないようにする。

変更：
- `scripts/eht/eht_shadow_compare.py`
  - 係数比較に加え、`リング直径 ≈ κ×シャドウ直径` の κ を観測から逆算して表示。
  - 参考として GR（Kerr）シャドウ直径係数のレンジ（定義=(幅+高さ)/2）を数値生成し、系統誤差の目安として併記。
  - 新規出力：`output/eht/eht_shadow_systematics.png`
- `scripts/summary/public_dashboard.py`
  - EHT章に systematics 図（κ＋Kerrレンジ）をカードとして追加。
- `doc/eht/README.md`
  - κとKerrレンジの説明を追加。
- `doc/STATUS.md`
  - EHT注記（κ・Kerrレンジ・systematics図）を追記。

再現：
- `python -B scripts/eht/eht_shadow_compare.py`
- `python -B scripts/summary/run_all.py --offline`

出力：
- `output/eht/eht_shadow_compare.json`（κとKerrレンジのキー追加）
- `output/eht/eht_shadow_systematics.png`
- `output/summary/pmodel_public_report.html`（EHT章に systematics 図を追加）

影響ファイル：
- 更新：`scripts/eht/eht_shadow_compare.py`
- 更新：`scripts/summary/public_dashboard.py`
- 更新：`doc/eht/README.md`
- 更新：`doc/STATUS.md`


---

## 2026-01-03（UTC） Phase 5（論文化）: 論文草稿をHTML化（pmodel_paper.html）

目的：
- 論文草稿（`doc/paper/10_manuscript.md`）を、一般向けレポートと同じ “カード” 形式で HTML でも読めるようにする。
- Table 1（自動生成）や図表一覧も同ページにまとめ、閲覧導線を固定する。

変更：
- `scripts/summary/paper_html.py`
  - 新規：Markdown草稿をHTMLへ変換し、`output/summary/pmodel_paper.html` を生成。
  - `output/`/`doc/`/`data/`/`scripts/` のパスをリンク化し、紙面から一次ソース/生成物へ飛べるようにした。
- `scripts/summary/run_all.py`
  - 追加：`paper_html` を run_all に統合（`paper_table1` の後に実行）。
- `scripts/summary/public_dashboard.py`
  - Table 1 カードに「論文HTML: output/summary/pmodel_paper.html」を追記。
- `doc/paper/01_figures_index.md`
  - 論文HTML（固定パス）を追記。
- `doc/STATUS.md`
  - 入口（成果物）に論文HTMLを追加。

再現：
- `python -B scripts/summary/paper_html.py`
- `python -B scripts/summary/run_all.py --offline`

出力：
- `output/summary/pmodel_paper.html`


---

## 2026-01-03（UTC） Phase 5（論文化）: 論文HTMLの改善（図表キャプション + 公開レポートに論文カード）

目的：
- 論文HTML（`output/summary/pmodel_paper.html`）の「図表一覧」を読みやすくし、図の意味（短いキャプション）が追えるようにする。
- 一般向け統一レポート（`output/summary/pmodel_public_report.html`）から、論文HTMLへ迷わず到達できる導線を追加する。

変更：
- `scripts/summary/paper_html.py`
  - `doc/paper/01_figures_index.md` の `（…）` / `(…)` を図表キャプションとして抽出し、図表一覧の `<figcaption>` に表示。
- `scripts/summary/public_dashboard.py`
  - 「ロードマップ / 進捗」章に `論文（HTML版）` カードを追加（`pmodel_paper.html` へリンク）。

再現：
- `python -B scripts/summary/paper_html.py`
- `python -B scripts/summary/public_dashboard.py`


---

## 2026-01-03（UTC） Phase 5：参考文献（一次ソース）を確定し、本文に引用タグを追加

目的：
- Phase 5（論文化）を進めるため、本文の主張が「どの一次ソース/代表文献に基づくか」を追跡可能にする。
- Table 1 の数値だけでなく、本文（草稿）側でも「何を根拠としているか」を明示し、誤解を減らす。

変更：
- `doc/paper/30_references.md`
  - PPN/GPS/Cassini/Viking/Mercury/LLR/EHT の代表文献（DOI/Accessed）を追記し、キー（`[Will2014]` 等）を付与。
- `doc/paper/10_manuscript.md`
  - Results/理論定義の要所に引用タグ（例：`[Will2014]`）を追記（LLR/Cassini/Viking/Mercury/GPS/EHT）。
- `scripts/summary/paper_html.py` / `scripts/summary/public_dashboard.py`
  - 上記変更を反映するため再生成（出力差し替えのみ）。

出力（更新）：
- `output/summary/pmodel_paper.html`
- `output/summary/pmodel_public_report.html`

再現：
- `python -B scripts/summary/paper_html.py`
- `python -B scripts/summary/public_dashboard.py`


---

## 2026-01-03（UTC） Phase 5: Table 1 のEHT指標を誤解しない表記へ修正し、参考文献（ドラフト）を追加

目的：
- Table 1 の EHT 行に出ていた「差=4.627%」が **観測（リング）とモデル（シャドウ）の差**に誤読されるのを防ぐ。  
  （4.627% は固定βに対する **係数差（P-model/GR）** であり、観測差そのものではない。）
- 論文（HTML）側で参考文献の枠を用意し、一次ソースと代表文献の対応を整理し始める。

変更：
- `scripts/summary/paper_tables.py`
  - EHT 行の指標を `z(P, κ=1)` / `β_fit` / `係数差(P/GR)` に分解して明示。
  - 注記に EHT 指標欄の意味を追記。
- `doc/paper/30_references.md`（新規）
  - 参考文献（ドラフト）を追加（正式書式は後段で確定）。
- `doc/paper/10_manuscript.md`
  - 参考文献セクションを追加（`doc/paper/30_references.md` への導線）。
- `scripts/summary/paper_html.py`
  - `doc/paper/30_references.md` を HTML に取り込み（付録セクション）。
- `doc/paper/01_figures_index.md`
  - 図番号が本ファイル順で自動付与される旨を注記。

出力（更新）：
- `output/summary/paper_table1_results.md`
- `output/summary/pmodel_paper.html`
- `output/summary/pmodel_public_report.html`

再現：
- `python -B scripts/summary/paper_tables.py`
- `python -B scripts/summary/paper_html.py`
- `python -B scripts/summary/public_dashboard.py`

出力：
- `output/summary/pmodel_paper.html`（図表一覧のキャプション追加）
- `output/summary/pmodel_public_report.html`（論文カード追加）


---

## 2026-01-03（UTC） Phase 5（論文化）: 図表インデックス拡充 + 図番号/章別ギャラリー整備

目的：
- 論文草稿で参照する主要図（LLR/Mercury/GPS）を `doc/paper/01_figures_index.md` に揃え、図表一覧から漏れないようにする。
- 論文HTML（`output/summary/pmodel_paper.html`）の図表一覧を「章別＋図番号」で読みやすくする（印刷/PDF化も想定）。

変更：
- `doc/paper/01_figures_index.md`
  - 追加：LLR主要図（RMSアブレーション、局別×月別のRMS）
  - 追加：Mercury軌道図、GPS残差RMS比較図
- `scripts/summary/paper_html.py`
  - 改善：図表一覧を `##` 見出し（LLR/Cassini…）でグルーピングして表示
  - 改善：図番号（図1, 図2, …）を付与し、各図に `id` を付けて参照しやすくした
  - 追加：印刷向けCSS（`@media print`）を追加

再現：
- `python -B scripts/summary/paper_html.py`

出力：
- `output/summary/pmodel_paper.html`（図表一覧の章別/図番号対応）


---

## 2026-01-03（UTC） Phase 5（論文化）: EHTの系統誤差（κ/スピン依存）を明記し、論文草稿へ統合

目的：
- EHT（ブラックホール影）の比較が「どの程度の証明力か」を誤解しないように、リング≒影の近似（κ）とKerrスピン依存などの系統不確かさを本文で明示する。
- 論文HTML（`output/summary/pmodel_paper.html`）からも該当図へ辿れるよう、図表インデックスに系統図を追加する。

変更：
- `doc/paper/10_manuscript.md`
  - 更新：EHT章に κ（リング直径/影直径）とKerrスピン依存の注意点を追記し、位置づけを「整合性チェック＋差分予測の入口」と明確化
  - 追記：代表図に `output/eht/eht_shadow_systematics.png` を追加
- `doc/paper/01_figures_index.md`
  - 追加：`output/eht/eht_shadow_systematics.png`
- `scripts/summary/paper_tables.py`
  - 修正：Table 1 の EHT 行を N=1 として出力（空欄回避）

再現：
- `python -B scripts/summary/paper_tables.py`
- `python -B scripts/summary/paper_html.py`

出力：
- `output/summary/paper_table1_results.md`（EHTのNを1で表示）
- `output/summary/pmodel_paper.html`（EHT系統図が図表一覧に追加）


---

## 2026-01-03（UTC） Phase 5（論文化）: LLRの「観測 - P-model差」を残差分布（ヒストグラム+累積）で可視化して統合

目的：
- Phase 3 の LLRで「観測結果とP-modelとの差」が直感的に読める図を追加する。
- 公開レポート/論文HTMLの両方から同じ固定パス図へ辿れるようにする。

変更：
- `scripts/summary/public_dashboard.py`
  - 追加：LLR章に `llr_residual_distribution.png` のカード（残差分布）を追加
- `doc/paper/01_figures_index.md`
  - 追加：`output/llr/batch/llr_residual_distribution.png`
- `doc/paper/10_manuscript.md`
  - 追記：LLRの代表図に「残差分布（観測 - P-model, inlierのみ）」を追加

再現：
- `python -B scripts/llr/llr_batch_eval.py --time-tag-mode auto --min-points 30 --chunk 50 --offline`
- `python -B scripts/summary/public_dashboard.py`
- `python -B scripts/summary/paper_html.py`

出力：
- `output/llr/batch/llr_residual_distribution.png`（残差分布：観測 - P-model）
- `output/summary/pmodel_public_report.html`（LLR章に差分図を追加）
- `output/summary/pmodel_paper.html`（図表一覧に差分図を追加）


---

## 2026-01-03（UTC） Phase 5（論文化）: EHTの“証明力”を zスコアで可視化（κ=1の仮定）して統合

目的：
- 「EHTでどの程度 P-model の正当性が証明できたか」を、観測とモデルのズレ（σ単位）として直感的に示す。
- ただしリング直径≒シャドウ直径（κ=1）の仮定であることを明示し、系統誤差（κ/スピン依存）の章と接続する。

変更：
- `scripts/eht/eht_shadow_compare.py`
  - 追加：`output/eht/eht_shadow_zscores.png`（zスコア: (観測-予測)/σ_total）を生成
- `scripts/summary/public_dashboard.py`
  - 追加：一般向けレポートのEHT章に zスコア図のカードを追加
- `doc/paper/01_figures_index.md`
  - 追加：`output/eht/eht_shadow_zscores.png`
- `doc/paper/10_manuscript.md`
  - 追記：EHT章の代表図に zスコア図を追加
- `doc/STATUS.md`
  - 追記：EHTの最新値に zスコア（κ=1）を追加

再現：
- `python -B scripts/eht/eht_shadow_compare.py`
- `python -B scripts/summary/public_dashboard.py`
- `python -B scripts/summary/paper_html.py`

出力：
- `output/eht/eht_shadow_zscores.png`
- `output/summary/pmodel_public_report.html`（EHT章に zスコア図を追加）
- `output/summary/pmodel_paper.html`（図表一覧/本文参照に zスコア図を追加）


---

## 2026-01-03（UTC） LLR：外れ値の time-tag 感度をオフライン再現で計算し、公開レポートに統合

目的：
- 「外れ値（スパイク）」がモデル不足なのか、観測データ側（time-tag解釈など）の要因なのかを追加で切り分ける。
- 2回目以降はオフライン再現できるよう、HORIZONS等の取得結果をキャッシュ前提で再利用する。

変更点：
- `scripts/llr/llr_batch_eval.py`
  - 外れ値診断（tx/rx/mid の time-tag 感度）を **オフラインでも計算**できるように修正（`--offline` でも NaN にならない）。
  - キャッシュが足りない場合のみ、オンラインで補完してキャッシュを作る（offline-first → fallback）。
- `scripts/summary/public_dashboard.py`
  - 一般向け統一レポートに「外れ値の原因切り分け（time-tag感度）」カード（図＋表）を追加。

出力（固定パス）：
- `output/llr/batch/llr_outliers_diagnosis_summary.json`（診断サマリ：n_outliers/原因ヒント/time-tag感度）
- `output/llr/batch/llr_outliers_diagnosis.csv`（外れ値ごとの tx/rx/mid |Δ|、source_file:lineno）
- `output/llr/batch/llr_outliers_time_tag_sensitivity.png`（外れ値の time-tag 感度）
- `output/summary/pmodel_public_report.html`（LLR章にカード追加）

再現：
- 初回（キャッシュ生成が必要な場合）：`python -B scripts/llr/llr_batch_eval.py`
  - SSLが失敗する環境では `HORIZONS_INSECURE=1` を利用（最終手段）
- 2回目以降（オフライン）：`python -B scripts/llr/llr_batch_eval.py --offline`
- レポート更新：`python -B scripts/summary/public_dashboard.py`

影響ファイル：
- 更新：`scripts/llr/llr_batch_eval.py`
- 更新：`scripts/summary/public_dashboard.py`


---

## 2026-01-03（UTC） LLR：外れ値のターゲット混入（反射器取り違え）を自動検出し、最大級スパイクを切り分け

目的：
- 最大級スパイクが「モデル不足」ではなく「観測ログの反射器取り違え/混入」の可能性を、再現可能な形で判定する。
- 診断結果を CSV/JSON に残し、公開レポートでも確認できるようにする。

変更：
- `scripts/llr/llr_batch_eval.py`
  - 外れ値診断に「反射器入れ替えテスト」を追加し、`best_target_guess` / `best_target_delta_raw_ns` / `suspected_target_mixing` 等を `llr_outliers_diagnosis.csv` に出力。
  - 巨大スパイクが別反射器で ns〜μs級に落ちる場合、原因ヒントを「ターゲット混入」へ更新。
  - `output/llr/batch/llr_outliers_diagnosis_summary.json` に `target_mixing_sensitivity`（推定件数/閾値）を追加。
- `scripts/summary/public_dashboard.py`
  - 公開レポートの外れ値診断サマリに「ターゲット混入推定件数」を表示。

結果（重要）：
- `data/llr/edc/apollo11/2015/apollo11_201509.npt:162`（GRSM）の巨大スパイクは、反射器を `luna17` と仮定すると |Δ| が約 31.5 ns まで低下し、`suspected_target_mixing=true` と判定された。
  - 解釈：物理モデルの不足というより、反射器IDの取り違え/混入の可能性が高い（原因切り分けの進展）。

再現：
- `python -B scripts/llr/llr_batch_eval.py --offline`
- `python -B scripts/summary/public_dashboard.py`
- `python -B scripts/summary/paper_html.py`
- 出力追加：`output/llr/batch/llr_outliers_summary.json`
- 出力追加：`output/llr/batch/llr_outliers_overview.png`


---

## 2026-01-03（UTC） LLR：ターゲット混入（疑い）の扱いを固定し、可視化を追加

目的：
- 最大級スパイク（suspected_target_mixing）を「何をする/しない」で固定し、レポート上で誤解なく伝える。
- 一般向けに「どれだけ異常か」「入れ替えるとどう変わるか」を1枚で見えるようにする。

変更：
- `scripts/llr/llr_batch_eval.py`
  - ターゲット混入感度の図を追加：`output/llr/batch/llr_outliers_target_mixing_sensitivity.png`
  - `output/llr/batch/llr_outliers_diagnosis_summary.json` に policy（baseline=exclude, auto_reassign=false）を追記
- `scripts/summary/public_dashboard.py`
  - 公開レポートに「ターゲット混入感度」カードを追加（診断であり自動再割当しない旨を明記）
- `doc/llr/README.md` / `doc/llr/MODEL_SPEC.md`
  - 混入疑いの扱い（統計から除外・一次データ行で確認・自動再割当しない）を明文化
- `doc/paper/10_manuscript.md` / `doc/paper/01_figures_index.md`
  - 論文側の参照図にターゲット混入感度を追加

結果（重要）：
- 公開レポート：`output/summary/pmodel_public_report.html` の LLR 章に「外れ値の原因切り分け（ターゲット混入感度）」を追加。

再現：
- `python -B scripts/llr/llr_batch_eval.py --offline --time-tag-mode auto --chunk 50 --min-points 30`
- `python -B scripts/summary/public_dashboard.py`
- `python -B scripts/summary/paper_html.py`


---

## 2026-01-03（UTC） 公開レポート：パス表記を相対＋リンク化し、可搬性を改善

目的：
- `output/summary/pmodel_public_report.html` の「出力/参照先」欄に絶対パス（例：`C:\...`）が混入すると、閲覧環境によって読みにくくなるため、**リポジトリ相対パスへ統一**する。
- ついでに `doc/` / `scripts/` / `data/` / `output/` を **クリックで開ける**ようにし、一般向けの閲覧性も上げる。

変更：
- `scripts/summary/public_dashboard.py`
  - リポジトリ相対パス（`output/...` 等）を自動でリンク化し、`<code>` 表示にする。
  - Table 1 / 論文HTMLカードなどに混入していた絶対パスを除去（相対パスに置換）。

出力（固定パス）：
- `output/summary/pmodel_public_report.html`

再現：
- `python -B scripts/summary/public_dashboard.py`


---

## 2026-01-03（UTC） EHT：解説を拡充し、論文化（草稿）のEHT節を誤解しにくい表現へ更新

目的：
- 「EHTはまだ詳細が詰められていない」という印象が出やすい点について、**現時点の位置づけ（整合性チェック＋差分予測）**を明文化する。
- “差 4.627%” の読み違い（観測との差ではなく係数差）を避け、本文側の記述を整理する。

変更：
- `doc/eht/README.md`
  - EHTが推定する量（リング直径）と、理論側の量（シャドウ直径）の違いを整理し、`κ`（リング/シャドウ）の系統誤差としての扱いを明文化。
  - P-model最小モデルの導出（`b=n(r)r` の極小 → `b_crit=eβr_s`）を補足し、GR（Schwarzschild/Kerr）側の係数と系統誤差レンジの位置づけを追記。
  - 「どこまで証明できたか」を冒頭で明示（現状は判別というより整合性チェック＋差分予測の入口）。
- `doc/paper/10_manuscript.md`
  - EHT節の数値表記を `β_fit` を含む形に整理し、係数差（P-model/GR）≈+4.63% を独立に記載。
  - 詳細資料として `doc/eht/README.md` を追記。

出力（更新）：
- `output/summary/pmodel_paper.html`
- `output/summary/pmodel_public_report.html`

再現：
- `python -B scripts/summary/paper_html.py`
- `python -B scripts/summary/public_dashboard.py`


---

## 2026-01-04（UTC） Phase 6：不確かさ（統計＋系統）表を追加し、主張範囲を明確化

目的：
- 各検証（LLR/Cassini/Viking/Mercury/GPS/EHT）で「統計誤差」と「系統誤差」のどちらが支配的かを明示し、結論の強さを適正化する。
- 「この表の範囲外の主張はしない」を紙面に明記し、読者の誤解（過剰な一般化）を避ける。

変更：
- `doc/paper/06_uncertainty.md`
  - 不確かさ（統計＋系統）テーブルを追加（代表指標・支配的な系統要因・主張範囲）。
- `scripts/summary/paper_html.py`
  - 論文HTMLに「不確かさ（統計＋系統）」セクション（カード）を追加（記号・定義の次に挿入）。

出力（更新）：
- `output/summary/pmodel_paper.html`

検証：
- `python -B scripts/summary/paper_build.py --mode publish` → errors/warnings 0
- publish HTML の紙面からファイルパス文字列が出ないことを確認：
  - `rg -n "\\b(output/|doc/|scripts/)" output/summary/pmodel_paper.html` → no match

再現：
- `python -B scripts/summary/paper_build.py --mode publish`


---

## 2026-01-04（UTC） Phase 6：検証章の定型を統一し、図番号の安定性を修正

目的：
- LLR/Cassini/Viking/Mercury/GPS/EHT の各検証章を「入力→処理→指標→図→注意」の順に揃え、読み手がテーマ間を比較しやすい紙面にする。
- 参照図が増えたときも図番号が揺れないよう、図インデックスの抜けを解消する。

変更：
- `doc/paper/10_manuscript.md`
  - 4.4 Viking / 4.5 Mercury / 4.6 GPS / 4.7 EHT を定型へ統一（説明→指標→図→注意）。
  - 章内の「本節の主要図は…」等の冗長な行を除去し、図は箇条書きで列挙する形に統一。
- `doc/paper/01_figures_index.md`
  - GPSの追加図（周期成分の比較例）を図インデックスへ追加し、`paper_lint` の warning を解消。
- `scripts/summary/paper_html.py`
  - 数式画像（PNG）の表示サイズをさらに縮小（CSSの `max-width/max-height` を調整）。

出力（更新）：
- `output/summary/pmodel_paper.html`
- `output/summary/pmodel_public_report.html`

検証：
- `python -B scripts/summary/paper_build.py --mode publish` → errors/warnings 0
- publish HTML の紙面からファイルパス文字列が出ないことを確認：
  - `rg -n "\\b(output/|doc/|scripts/)" output/summary/pmodel_paper.html` → no match

再現：
- `python -B scripts/summary/paper_build.py --mode publish`
- `python -B scripts/summary/public_dashboard.py`


---

## 2026-01-04（UTC） Phase 6：記号・定義ページを追加し、論文HTMLへ統合

目的：
- 読者が `P` / `P0` / `φ` / `β` / `δ` / `τ` / `t` などの定義を迷わないよう、**記号辞書**を1ページに固定する。

変更：
- `doc/paper/05_definitions.md`
  - 記号・符号規約・最小の式（重力・時計・光・EHTのκ）を追加。
- `scripts/summary/paper_html.py`
  - 論文HTMLに「記号・定義」セクション（カード）を追加（Table 1 の直後に挿入）。
- `doc/paper/10_manuscript.md`
  - 理論章の冒頭で「主要記号は付録（記号・定義）にまとめる」と明記。

出力（更新）：
- `output/summary/pmodel_paper.html`

検証：
- publish HTML の紙面からファイルパス文字列が出ないことを確認：
  - `rg -n "\\b(output/|doc/|scripts/)" output/summary/pmodel_paper.html` → no match

再現：
- `python -B scripts/summary/paper_build.py --mode publish`


---

## 2026-01-04（UTC） Phase 6：公開・投稿準備の方針を文書化（体裁・禁則・入口）

目的：
- Phase 5（論文HTMLの決定版）を土台に、公開・投稿に向けた **体裁方針**と **禁則**、再現入口を先に固定して後戻りを減らす。

変更：
- `doc/paper/40_publication_plan.md`
  - 公開体裁（HTMLを正本）、紙面の禁則（パス/リンクを出さない）、式/図のルール、再現入口を明文化。
- `doc/ROADMAP.md`
  - Phase 6（公開・投稿準備）をロードマップに追加。
- `doc/NEXT_STEPS.md`
  - Phase 6 の Step（1?7）へ更新。

結果（期待する効果）：
- 「何を正本として公開するか」「紙面に出してよい/いけないもの」「再現の入口」が固定され、以後の論文化更新が迷走しにくくなる。

再現：
- （文書更新のみ。以後の更新は `doc/STATUS.md` の Phase 6 Step 進捗で管理）


---

## 2026-01-04（UTC） Phase 5：論文HTML（publish）を決定版として固定

目的：
- Phase 5 Step 7 として、論文（HTML版）の決定版ビルドを実行し、以後は図の差し替え等で更新できる状態にする。

結果（決定版出力）：
- 論文（HTML版）：`output/summary/pmodel_paper.html`
- Table 1（検証サマリ）：`output/summary/paper_table1_results.md`（＋ `.csv` / `.json`）

検証：
- `paper_lint` が errors/warnings 0。
- publish HTML の紙面からファイルパス文字列が出ないことを確認：
  - `rg -n "\\b(output/|doc/|scripts/)" output/summary/pmodel_paper.html` → no match

再現：
- `python -B scripts/summary/paper_build.py --mode publish`


---

## 2026-01-04（UTC） Phase 5：参考文献/一次ソースを確定（Cassini PDS DOI 追記）

目的：
- Phase 5 Step 6 として、一次ソース（観測データ/公式アーカイブ）への参照を“論文として”成立する形に整える。
- 特に Cassini SCE1 について、PDS の公式ランディングページと DOI を明記し、ミラー依存の印象を避ける。

変更：
- `doc/paper/30_references.md`
  - [PDSCassiniSCE1] を PDS 公式ランディングページ＋DOI（10.17189/ske1-av41）へ更新。
  - リポジトリで使用しているミラーURLは publish 版に出ないよう INTERNAL_ONLY に移動。
- `doc/paper/20_data_sources.md`
  - Cassini SCE1 の一次ソース（PDSランディングページ＋DOI）を明記し、ミラーURLは INTERNAL_ONLY へ移動。
- `output/summary/pmodel_paper.html`
  - 上記反映のため再生成（publish モード）。

再現：
- `python -B scripts/summary/paper_build.py --mode publish --skip-tables`


---

## 2026-01-04（UTC） Phase 5：本文の誤記/重複を解消し、式画像の表示をさらに縮小

目的：
- Phase 5 Step 5 として、本文の誤記（文字化け/置換ミス）と重複を除去し、読者の混乱要因を潰す。
- 数式（式画像）がまだ大きいという指摘に対応し、紙面の可読性をさらに上げる。

変更：
- `doc/paper/10_manuscript.md`
  - 判別条件（6.3）に残っていた重複行を整理し、誤記（`1?2%`）を解消（`1〜2%` に統一）。
- `scripts/summary/paper_html.py`
  - 式画像（`.equation-img`）の最大表示サイズをさらに縮小（`max-width/min` と `max-height` を調整）。
- `output/summary/pmodel_paper.html`
  - 上記反映のため再生成（publish モード）。

検証：
- publish HTML の紙面からファイルパス文字列が出ないことを確認：
  - `rg -n "\\b(output/|doc/|scripts/)" output/summary/pmodel_paper.html` → no match

再現：
- `python -B scripts/summary/paper_build.py --mode publish --skip-tables`


---

## 2026-01-04（UTC） Phase 5：論文ビルド入口（paper_build）を追加

目的：
- Phase 5 Step 4 として、Table 1＋論文HTML＋lint を 1 コマンドで生成できる入口を用意する。

変更：
- `scripts/summary/paper_build.py`
  - 追加：Table 1 生成（paper_tables）→論文HTML生成（paper_html）→lint（paper_lint）を順に実行するビルドスクリプト。
  - オプション：`--mode publish/internal`、`--no-embed-images`、`--skip-tables`、`--skip-lint`。
- `doc/paper/README.md`
  - 入口に `python -B scripts/summary/paper_build.py --mode publish` を追記。

再現：
- `python -B scripts/summary/paper_build.py --mode publish`


---

## 2026-01-04（UTC） Phase 5：差分予測（判別条件）を定量化し、Discussion を更新

目的：
- Phase 5 Step 3 として、EHT と 速度飽和 δ の差分予測を「どの不確かさをどこまで下げれば判別できるか」の形に落とし込む。
- EHT の位置づけ（整合性チェック＋将来判別）を、本文だけで誤解なく読める形に整理する。

変更：
- `doc/paper/10_manuscript.md`
  - 差分予測（5.1）：EHT の観測量（リング直径）と理論量（影直径）の関係式を明示し、係数差（約4.63%）と判別に必要な精度目安（総合1σ~1.5%）を追記。
  - 議論（6.1/6.3）：zスコア図を本文内に配置し、判別条件（κ・Kerr系統・統計誤差）を箇条書きで明示。
- `output/summary/pmodel_paper.html`
  - 上記反映のため再生成。

再現：
- `python -B scripts/summary/paper_html.py --mode publish`
- `python -B scripts/summary/paper_lint.py`


---

## 2026-01-04（UTC） Phase 5：Methods（再現性）を紙面向けに整理し、式画像の表示をさらに縮小

目的：
- Phase 5 Step 2 として、Methods（再現性/データ管理）の説明を「論文本文」だけで読める形に整える。
- 数式（式画像）が大きすぎる問題を緩和し、紙面の可読性を上げる。

変更：
- `doc/paper/10_manuscript.md`
  - Methods 3.1：再現に必要な情報は本章/第8章/付録にまとめる旨へ記述を更新（“内部向け”表現を除去）。
  - Methods 3.2：一次ソースの参照日と内容同一性（ハッシュ等）で追跡できる方針を明確化。
- `scripts/summary/paper_html.py`
  - 式画像（.equation-img）の最大表示サイズを縮小（max-width/max-height）し、過度な拡大を抑制。
- `output/summary/pmodel_paper.html`
  - 上記反映のため再生成（publish モード、紙面から repo パス文字列が出ないことを再確認）。

再現：
- `python -B scripts/summary/paper_html.py --mode publish`
- `python -B scripts/summary/paper_lint.py`


---

## 2026-01-04（UTC） 論文草稿：paper_lint の再現コマンドを追記

目的：
- 論文化（Phase 5）の作業で「引用/図表インデックスの不整合チェック」を誰でも再現できるよう、本文に再現コマンドとして明記する。

変更：
- `doc/paper/10_manuscript.md`
  - 「代表的な再現コマンド」に `python -B scripts/summary/paper_lint.py` を追記
- `output/summary/pmodel_paper.html`
  - 上記反映のため再生成

再現：
- `python -B scripts/summary/paper_html.py`


---

## 2026-01-04（UTC） 論文草稿：Results を「説明→図」に統一し、差分予測の図配置を整理

目的：
- 最終的な論文を「ファイルリンク」ではなく **説明と式／説明と図**で読める体裁に寄せる。
- Viking/Mercury/GPS/EHT/δ の記述を、箇条書き（代表図リンク）から本文スタイルへ統一する。

変更：
- `doc/paper/10_manuscript.md`
  - 4.4 Viking / 4.5 Mercury / 4.6 GPS / 4.7 EHT を「説明→図」構成へ統一（`代表図：...` 形式を撤去）。
  - EHT 係数差（差分予測）と 速度飽和 δ（上限制約）の図を Results から外し、差分予測（Section 5）に配置。
- `output/summary/pmodel_paper.html`
  - 上記反映のため再生成（publish モード：紙面から `output/` 等のパス文字列が出ないことを確認）。

再現：
- `python -B scripts/summary/paper_html.py --mode publish`


---

## 2026-01-04（UTC） 論文草稿：制限事項（Viking/Mercury/GPS/δ）を追記、BepiColombo言及を紙面から除外

目的：
- 「EHT以外も含めて、どこまで言えて何が未確定か」を論文本文に明記し、過剰な結論を避ける。
- 現時点では一般向けレポート同様、**BepiColombo を紙面（論文HTML）には載せない**方針を徹底する（ブロック中テーマは `doc/BLOCKED.md` に集約）。

変更：
- `doc/paper/10_manuscript.md`
  - Discussion（6.2）に Viking / Mercury / GPS / 速度飽和δ の制限事項と今後の課題を追記
- `doc/paper/20_data_sources.md`
  - ブロック中テーマの個別名を本文に出さず、`doc/BLOCKED.md` へ誘導する形に整理
- `output/summary/pmodel_paper.html`
  - 上記反映のため再生成（paper内の “BepiColombo” 文字列が出ないことを確認）

再現：
- `python -B scripts/summary/paper_lint.py`
- `python -B scripts/summary/paper_html.py`
- `python -B scripts/summary/run_all.py --offline`

出力：
- `output/summary/work_history.jsonl`（手動編集しない）

影響ファイル：
- 追加：`scripts/summary/worklog.py`
- 追加：`doc/WORK_HISTORY.md`
- 追加：`doc/STATUS.md`
- 更新：`AGENTS.md`
- 更新：`scripts/summary/run_all.py`
- 更新：`scripts/summary/public_dashboard.py`
- 更新：`scripts/llr/llr_batch_eval.py`


---

## 2026-01-04（UTC） 公開レポート：LLR「残差分布」カードにRMS要約（SR / SR+Tropo / SR+Tropo+Tide）を明記

目的：
- Phase 3（LLR）の「観測 - P-model の差」が一目で分かるよう、図の凡例に頼らず **RMSを概要欄に明示**する。

変更：
- `scripts/summary/public_dashboard.py`
  - `output/llr/batch/llr_batch_points.csv`（inlierのみ）からRMSを算出し、`output/summary/pmodel_public_report.html` の LLR「残差分布」カードに追記。

主要結果（inlierのみ, 観測 - モデル）：
- RMS（SR）= 8.914 ns
- RMS（SR+Tropo）= 4.494 ns
- RMS（SR+Tropo+Tide）= 4.281 ns

再現：
- `python -B scripts/summary/public_dashboard.py`

出力：
- `output/summary/pmodel_public_report.html`


---

## 2026-01-04（UTC） Phase 7：β/δ を凍結し「決定的スコアボード」で fit/predict を分離（公開レポート/論文へ統合）

目的：
- 「理論が正しいか」をより決定的に示すため、`β` を任意調整するのではなく **一次ソースで固定（凍結）**し、残りを **予測（predict）**として評価する枠組みを導入する。
- 主要検証を 1 枚の集約図（zスコア）で見渡せるようにし、一般向けレポート/論文の双方に同じ入口を追加する。

変更：
- `scripts/theory/freeze_parameters.py`
  - `β` を一次ソース（CassiniのPPN γ拘束）で凍結し、`output/theory/frozen_parameters.json` に固定保存。
- `scripts/summary/decisive_scoreboard.py`
  - `β` 固定のまま、各検証を zスコアで集約（Cassini=fit、それ以外=predict）。
  - `output/summary/decisive_scoreboard.(png|json)` を出力。
- `scripts/summary/public_dashboard.py`
  - 公開レポートに「決定的検証（Phase 7）」章を追加し、決定的スコアボードを掲載。
- `doc/paper/01_figures_index.md`
  - 図表インデックスへ `decisive_scoreboard.png` を追加（図番号固定の対象に含める）。
- `doc/paper/10_manuscript.md`
  - Resultsに「決定的スコアボード（β固定：fit/predict分離）」の説明と図を追加。
- `scripts/summary/paper_html.py`
  - 式画像の表示サイズを小さめに調整（紙面で過大に見えないように）。

出力（固定パス）：
- `output/theory/frozen_parameters.json`
- `output/summary/decisive_scoreboard.png`
- `output/summary/decisive_scoreboard.json`
- `output/summary/pmodel_public_report.html`
- `output/summary/pmodel_paper.html`

再現：
- `python -B scripts/theory/freeze_parameters.py`
- `python -B scripts/summary/decisive_scoreboard.py`
- `python -B scripts/summary/public_dashboard.py`
- `python -B scripts/summary/paper_build.py --mode publish`


---

## 2026-01-04（UTC） Theory：重力赤方偏移（GP-A / Galileo）を一次ソースで統合し、レポート/論文/Table 1へ反映

目的：
- “教科書値” ではなく、**一次ソースの数値（ε）**を固定入力として、P-model（弱場・静止時計）が予測する **ε=0** と比較できる形にする。
- Phase 7（決定的検証パック）の「predict で通す必須セット」を増やす（β固定のまま外挿する）。

変更点：
- `data/theory/gravitational_redshift_experiments.json`
  - GP-A（Vessot 1980）と Galileo 5/6 GREAT（Delva 2018）の ε と σ（一次ソース）を固定入力として追加。
- `scripts/theory/gravitational_redshift_experiments.py`
  - ε（観測）と 0（P-model予測）を同一図で比較し、JSON/CSVも固定名で出力。
- `scripts/summary/public_dashboard.py`
  - 「理論（標準値/一次ソースとの比較）」に重力赤方偏移カードを追加。
- `scripts/summary/paper_tables.py`
  - Table 1 に重力赤方偏移（GP-A / Galileo）を追加。
- `doc/paper/10_manuscript.md` / `doc/paper/01_figures_index.md` / `doc/paper/20_data_sources.md` / `doc/paper/30_references.md`
  - 論文側に 4.8節（重力赤方偏移）を追加し、一次ソース/参考文献を確定。
- `scripts/summary/paper_html.py`
  - 数式画像の表示を小さめに統一（本文の可読性を改善）。

出力（固定パス）：
- `output/theory/gravitational_redshift_experiments.png`
- `output/theory/gravitational_redshift_experiments.json`
- `output/theory/gravitational_redshift_experiments.csv`
- `output/summary/pmodel_public_report.html`
- `output/summary/pmodel_paper.html`
- `output/summary/paper_table1_results.md`

再現：
- `python -B scripts/theory/gravitational_redshift_experiments.py`
- `python -B scripts/summary/public_dashboard.py`
- `python -B scripts/summary/paper_build.py --mode publish`


---

## 2026-01-04（UTC） Phase 6 Step 5：EHT を κ_fit 中心に整理し、論文HTMLの式画像サイズを調整（publishのパス排除を確定）

目的：
- EHTの「フィット」表現を β_fit ではなく κ_fit（リング/シャドウ比）へ統一し、意味の混乱を防ぐ。
- 論文HTML（publish）で数式画像が大きすぎる問題を解消し、紙面として読みやすくする。
- publish論文HTMLに残っていた `scripts/...` 等のファイルパス文字列を完全に排除する。

変更：
- `scripts/summary/paper_tables.py`
  - Table 1 の EHT 指標を `κ_fit` 併記に統一。
- `scripts/summary/public_dashboard.py`
  - EHT の説明・要約行を `κ_fit` 中心に更新。
- `scripts/summary/paper_html.py`
  - `$$...$$` → 式画像の表示サイズ（CSS）を小さめに調整。
- `doc/paper/05_definitions.md`
  - publish本文に混入していた実装パス表記を削除。

出力（更新）：
- `output/summary/pmodel_paper.html`
- `output/summary/paper_table1_results.md`
- `output/summary/pmodel_public_report.html`

再現：
- `python -B scripts/summary/paper_build.py --mode publish`
- `python -B scripts/summary/public_dashboard.py`


---

## 2026-01-04（UTC） 論文HTML：ファイルベース表記を排除し、数式を画像（式.png形式）へ統一

目的：
- 論文は「説明と式」「説明と図」に統一し、**ファイルリンク/パス表記を紙面から排除**する。
- 数式は MathJax 等ではなく、添付例（式.png）のような **画像（PNG）**として表示する。

変更：
- `scripts/summary/paper_html.py`
  - publish モードで `$$...$$` の数式ブロックを “式画像（PNG）” に変換して埋め込む。
  - 数式レンダリングで環境により `$\\phi$` が解釈できない問題に対応するため、Markdown側の `\\` を正規化してから描画するよう修正。

出力（更新）：
- `output/summary/pmodel_paper.html`
- `output/summary/equations/`（数式PNGのキャッシュ）

再現：
- `python -B scripts/summary/paper_html.py --mode publish`


---

## 2026-01-04（UTC） Phase 5（論文化）：paper_lint追加＋図表キャプション明確化

目的：
- 論文化の仕上げ段階で起きがちな「図番号リンクが外れる」「引用キーが参考文献に無い」「図表インデックスに無いpngを本文で参照している」等の不整合を、作業者の目視ではなく **自動で検出**できるようにする。
- 図表一覧（付録）で図の意味が伝わるよう、`doc/paper/01_figures_index.md` のキャプションを論文向けに明確化する。

変更：
- `scripts/summary/paper_lint.py` を追加
  - 引用キー [KEY] と `doc/paper/30_references.md` の整合チェック
  - 図表インデックス `doc/paper/01_figures_index.md` の png 実在チェック＋キャプション有無チェック
  - 草稿で参照する png が図表インデックスに含まれるかチェック（図番号リンクの安定化）
- `doc/paper/01_figures_index.md`
  - Cassini/Viking/GPS/EHT/δ などのキャプションを、論文向けに具体化
- `output/summary/pmodel_paper.html`
  - 図表キャプション更新を反映するため再生成

再現：
- `python -B scripts/summary/paper_lint.py`
- `python -B scripts/summary/paper_html.py`

影響ファイル：
- 追加：`scripts/summary/paper_lint.py`
- 更新：`doc/paper/01_figures_index.md`
- 更新：`doc/STATUS.md`
- 更新：`output/summary/pmodel_paper.html`


---

## 2026-01-04（UTC） 論文HTML：図キャプションの括弧入れ子で欠ける問題を修正

目的：
- `doc/paper/01_figures_index.md` の図キャプションに `（inlierのみ）` のような括弧が含まれる場合、論文HTML（付録「図表（固定パス一覧）」）でキャプションが途中で欠けることがあるため、**パーサを堅牢化**する。

変更：
- `scripts/summary/paper_html.py`
  - 図キャプション抽出の正規表現を調整し、括弧を含むキャプションでも外側の `（…）` / `(...)` を正しく拾えるようにした。

出力（更新）：
- `output/summary/pmodel_paper.html`

再現：
- `python -B scripts/summary/paper_html.py`

影響ファイル：
- 更新：`scripts/summary/paper_html.py`
- 更新：`output/summary/pmodel_paper.html`


---

## 2026-01-04（UTC） 論文草稿：EHTの位置づけ（整合性チェック/判別条件）をDiscussionに追記

目的：
- 「EHTはまだ詳細が詰められていない」という印象が出やすい点について、**現時点で言えること/言えないこと**を本文（Discussion）側で明確化する。
- 係数差（数%）を「観測との差」ではなく「将来判別のための差分予測」として位置づけ、過剰な結論を避ける。

変更：
- `doc/paper/10_manuscript.md`
  - Discussion（6.1/6.2）に、κ（リング/影）やKerrスピン依存を系統不確かさとして扱う前提と、現状の結論（整合性チェック＋判別条件の整理）を追記。

出力（更新）：
- `output/summary/pmodel_paper.html`

再現：
- `python -B scripts/summary/paper_html.py`

影響ファイル：
- 更新：`doc/paper/10_manuscript.md`
- 更新：`output/summary/pmodel_paper.html`


---

## 2026-01-04（UTC） 論文HTML：引用キー（[Will2014]等）→参考文献へのクロスリンクを追加

目的：
- `output/summary/pmodel_paper.html` を読む際に、本文中の引用キー（例：`[Will2014]`）から該当文献へすぐ飛べるようにする。

変更：
- `scripts/summary/paper_html.py`
  - `doc/paper/30_references.md` の各項目に `id='ref-KEY'` を付与してアンカー化。
  - 本文/付録中の `[KEY]` を `#ref-KEY` へリンク化（`<code>` 内は変更しない）。

出力（更新）：
- `output/summary/pmodel_paper.html`

再現：
- `python -B scripts/summary/paper_html.py`

影響ファイル：
- 更新：`scripts/summary/paper_html.py`
- 更新：`output/summary/pmodel_paper.html`


---

## 2026-01-04（UTC） 論文HTML：本文中の図参照に（図N）ラベルを自動付与

目的：
- 本文中で `output/...png` を参照するとき、リンク先（図番号）が直感的に分からないため、HTML化の段階で **図番号ラベル**を併記して読みやすくする（本文Markdownはパス参照のまま維持）。

変更：
- `scripts/summary/paper_html.py`
  - `output/...png` を図アンカーへリンク化する際、リンク末尾に `（図N）` を自動付与するようにした。

出力（更新）：
- `output/summary/pmodel_paper.html`

再現：
- `python -B scripts/summary/paper_html.py`


---

## 2026-01-04（UTC） 論文草稿：テーマ別の再現コマンドとスクリプト参照を追記

目的：
- Phase 5（論文化）で「読者がどのスクリプトを実行すれば同じ図/数値が出るか」を本文だけで追えるようにする。

変更：
- `doc/paper/10_manuscript.md`
  - Methods にテーマ別の再現コマンド（単体実行例）を追加。
  - 各テーマの処理概要に「対応スクリプト」を追記。
- 再生成：
  - `python -B scripts/summary/paper_html.py` → `output/summary/pmodel_paper.html`

再現：
- `python -B scripts/summary/paper_html.py`


---

## 2026-01-04（UTC） Phase 5：Methods（再現性）を拡充し、論文HTMLを更新

目的：
- 論文草稿の Methods が短すぎて「第三者が同じ入力→同じ出力」を追いにくいため、再現コマンド/キャッシュ/パラメータ/指標/外れ値ポリシー/テーマ別手順までを本文内に明記する。

変更：
- `doc/paper/10_manuscript.md`
  - Methods を拡充（再現コマンド、一次ソースのキャッシュ方針、共通パラメータ `β/δ`、指標（RMS/RMSE/相関）と外れ値ポリシー、テーマ別の処理骨格）。
- 再生成：
  - `python -B scripts/summary/paper_html.py` → `output/summary/pmodel_paper.html`
  - `python -B scripts/summary/public_dashboard.py` → `output/summary/pmodel_public_report.html`

再現：
- `python -B scripts/summary/paper_html.py`
- `python -B scripts/summary/public_dashboard.py`


---

## 2026-01-04（UTC） 論文HTML：本文→図番号（#fig-xxx）へのクロスリンクを追加し、NEXT_STEPSをPhase 5へ更新

目的：
- 論文HTML（`output/summary/pmodel_paper.html`）で、本文中に出てくる `output/...png` をクリックしたときに、raw画像ではなく **本文内の図番号（図1, 図2, …）へジャンプ**できるようにする。
- `doc/NEXT_STEPS.md` を最新のロードマップ（Phase 5）に合わせて更新し、次の作業の迷子を防ぐ。

変更：
- `scripts/summary/paper_html.py`
  - `doc/paper/01_figures_index.md` の順序に基づいて図番号（#fig-001 など）を付与し、本文中の `output/...png` 参照を図番号アンカーへリンクするようにした。
- `doc/NEXT_STEPS.md`
  - Phase 0→1 の古い手順を、Phase 5（論文化の仕上げ）向けの手順へ更新した。

出力（更新）：
- `output/summary/pmodel_paper.html`
- `output/summary/pmodel_public_report.html`

再現：
- `python -B scripts/summary/paper_html.py`
- `python -B scripts/summary/public_dashboard.py`

影響ファイル：
- 更新：`scripts/summary/paper_html.py`
- 更新：`doc/NEXT_STEPS.md`
- 更新：`doc/STATUS.md`


---

## 2026-01-04（UTC） Phase 5：参考文献（一次ソース）を補強し、論文HTML/公開レポートを再生成

目的：
- GPS（IGS Final/BRDC）の一次ソースを論文化側で明示し、参照タグ（[Dow2009][IGSBKGRootFTP]）を本文に反映する。
- これまで “Accessedのみ” だった主要Webリソース（PDS/HORIZONS/ILRS/EDC）に URL を併記し、一次ソース追跡性を上げる。

変更：
- `doc/paper/30_references.md`
  - GPS（IGS）節を追加（[Dow2009], [IGSBKGRootFTP]）。
  - Cassini PDS（本リポジトリで使用するミラーURL）、HORIZONS、ILRS CRD、EDC のURLを併記。
  - 体裁の統一（区切り記号のASCII化など）。
- `doc/paper/20_data_sources.md`
  - GPS：取得元URL/sha256の固定ファイル（`data/gps/igs_bkg_sources.json`）を追記し、取得コマンド例を追加。
- `doc/paper/10_manuscript.md`
  - GPS（IGS Final）の出典を本文に追記（[Dow2009][IGSBKGRootFTP]）。

出力（更新）：
- `output/summary/pmodel_paper.html`
- `output/summary/pmodel_public_report.html`

再現：
- `python -B scripts/summary/paper_html.py`
- `python -B scripts/summary/public_dashboard.py`


---

## 2026-01-04（UTC） 論文HTML：数式（式画像）の表示サイズを縮小

目的：
- `output/summary/pmodel_paper.html` の式画像が大きすぎるため、表示サイズを小さくしてレイアウトを改善する。

変更：
- `scripts/summary/paper_html.py`
  - `.equation-img` の `max-width` を `min(520px,92%)` に調整（大画面での過度な拡大を抑制）。

出力（更新）：
- `output/summary/pmodel_paper.html`

再現：
- `python -B scripts/summary/paper_html.py --mode publish`


---

## 2026-01-04（UTC） 論文草稿：主要図を「図番号参照（図N）」で明示

目的：
- 論文本文を「説明と図」で読める形にしつつ、本文から **図番号（図N）で参照**できる状態を確定する。
- publish体裁では紙面からファイルパス文字列を除去し、参照は図番号リンクに統一する。

変更：
- `doc/paper/10_manuscript.md`
  - 各テーマ節末に「本節の主要図は…」を追加（`output/...png` を再掲し、HTML側では “図N” 参照へ変換）。

出力（更新）：
- `output/summary/pmodel_paper.html`

再現：
- `python -B scripts/summary/paper_html.py --mode publish`
- `python -B scripts/summary/paper_lint.py`

確認：
- `output/summary/pmodel_paper.html` から `output/` 等のパス文字列が消えていること（`rg -n "\\b(output/|doc/|scripts/)" ...` → no matches）


---

## 2026-01-05（UTC） 宇宙論：宇宙膨張なしの赤方偏移（背景P）の概念図を追加

目的：
- 添付メモ（方針A）の導出（`P(x,t)=P_bg(t)P_local(x)`、`1+z=P_em/P_obs`）を、再現可能な図として追加する。
- 赤方偏移を「空間の膨張」以外の機構でも説明しうることを示し、議論の入口を作る（※宇宙論全体の置換を単独で主張しない）。

変更：
- `scripts/cosmology/cosmology_redshift_pbg.py`
  - 背景Pの時間変化（指数モデル）で赤方偏移が出る最小モデルを実装。
  - 出力（固定名）：`output/cosmology/cosmology_redshift_pbg.png` / `output/cosmology/cosmology_redshift_pbg_metrics.json`
  - 実行履歴を `output/summary/work_history.jsonl` に自動追記。
- `scripts/summary/public_dashboard.py`
  - 公開レポートに「宇宙論（赤方偏移：背景P）」カードを追加。
- `scripts/summary/run_all.py`
  - 一括再現（`run_all`）に cosmology タスクを追加（オフラインで実行可能）。
- `doc/paper/10_manuscript.md`
  - 2.5節「宇宙論（宇宙膨張なしの赤方偏移：背景P）」を追加（代替機構の提示として位置づけ）。
- `doc/paper/01_figures_index.md` / `doc/paper/20_data_sources.md`
  - 図インデックスと出典（概念図・代表値）を追記。

出力（更新/追加）：
- `output/cosmology/cosmology_redshift_pbg.png`
- `output/cosmology/cosmology_redshift_pbg_metrics.json`
- `output/summary/pmodel_public_report.html`
- `output/summary/pmodel_paper.html`

再現：
- `python -B scripts/cosmology/cosmology_redshift_pbg.py`
- `python -B scripts/summary/public_dashboard.py`
- `python -B scripts/summary/paper_html.py`
- `python -B scripts/summary/run_all.py --offline`


---

## 2026-01-05（UTC） 宇宙論：観測量スケーリング（距離二重性η / Tolman表面輝度）の差分予測を追加

目的：
- 「宇宙膨張なし＋背景Pで赤方偏移」が成り立つとしても、観測で区別できなければ議論が進まないため、**観測量（距離・表面輝度）に落とす**。
- まずは一次データに当てる前段として、定義と最小仮定から導かれる **差分スケーリング（FRW vs 静的背景P）** を固定出力する。

変更：
- `scripts/cosmology/cosmology_observable_scalings.py`
  - 距離二重性 `η(z)=D_L/((1+z)^2 D_A)` と Tolman 表面輝度のスケーリングを、FRW と静的背景Pで比較する図を追加。
  - 出力（固定名）：`output/cosmology/cosmology_observable_scalings.png` / `output/cosmology/cosmology_observable_scalings_metrics.json`
  - 実行履歴を `output/summary/work_history.jsonl` に自動追記。
- `scripts/summary/run_all.py`
  - `cosmology_observable_scalings` を cosmology タスクとして追加。
- `scripts/summary/public_dashboard.py`
  - 公開レポートに「宇宙論：観測量スケーリング（距離二重性 / Tolman表面輝度）」カードを追加。
- `doc/paper/10_manuscript.md`
  - 2.5節に「観測量への接続（距離二重性＋Tolman）」を追記し、図をインライン化。
- `doc/paper/01_figures_index.md` / `doc/paper/20_data_sources.md`
  - 図インデックスと出典（スケーリングはデータフィットではない）を追記。

出力（追加/更新）：
- `output/cosmology/cosmology_observable_scalings.png`
- `output/cosmology/cosmology_observable_scalings_metrics.json`
- `output/summary/pmodel_public_report.html`
- `output/summary/pmodel_paper.html`

再現：
- `python -B scripts/cosmology/cosmology_observable_scalings.py`
- `python -B scripts/summary/public_dashboard.py`
- `python -B scripts/summary/paper_html.py`
- `python -B scripts/summary/run_all.py --offline`


---

## 2026-01-05（UTC） Mercury：近日点移動の図に観測（代表値）点を追加

目的：
- Mercury（近日点移動）の図に、観測（代表値）を「点」として表示し、P-model との比較が一目で分かるようにする。

変更：
- `scripts/mercury/mercury_precession_v3.py`
  - 参照値（42.98 角秒/世紀）を周回数に換算し、右図（累積）に散布図として追記。
  - 注記ボックスに「観測代表」を追記。

出力（更新）：
- `output/mercury/mercury_orbit.png`
- `output/mercury/mercury_precession_metrics.json`（generated_utc 更新）
- `output/mercury/mercury_perihelion_shifts.csv`（再生成）

一次ソース：
- `doc/paper/20_data_sources.md`（Mercury 節：[NobiliWill1986]）

再現：
- `python -B scripts/mercury/mercury_precession_v3.py`
- （論文/レポート反映）`python -B scripts/summary/paper_html.py` / `python -B scripts/summary/public_dashboard.py`


---

## 2026-01-05（UTC） 論文化：統一解釈（物質＝波／「最短経路」の意味）を本文と定義に反映

目的：
- 「Pで重力・時間・光を統一する」主張が、本文の冒頭で一目で掴めるようにする（統一の見取り図を追加）。
- 「波が最短経路を好む」の “最短” を、幾何学距離ではなく **到達時間（光学経路長）** の停留条件として明記し、誤解を避ける。

変更：
- `doc/paper/10_manuscript.md`
  - 2章冒頭に「統一解釈（Pで書く）」を追加（物質=束縛波/光=自由波、写像（φ/a/時計/光）を要約）。
  - 2.4節に「最短経路」の意味（`∫ n ds` の停留、到達時間/位相蓄積）を追記。
- `doc/paper/05_definitions.md`
  - A.6 に「最短経路」の意味（幾何学距離ではなく `∫ n ds`）を注記として追記。

出力（更新）：
- `output/summary/pmodel_paper.html`

再現：
- `python -B scripts/summary/paper_html.py`
- `python -B scripts/summary/paper_lint.py`


---

## 2026-01-05（UTC） 論文付録の章順を整理：時間波密度 P を先に（A.2/A.3 入れ替え）＋本文参照を追従

目的：
- 付録で **時間波密度 P** を先に定義し、その後の「時計（重力項 `P0/P` + 速度項）」が自然に読める順にする。
- 本文内の付録参照（A.2/A.3）を破綻なく追従させる。

変更：
- `doc/paper/05_definitions.md`
  - A.2 を「時間波密度 P」、A.3 を「時刻・速度」に入れ替え。
- `doc/paper/10_manuscript.md`
  - 2.3節の補足（`δ(P)=δ0(P/P0)^k`）の付録参照を A.3 に更新。

出力（更新）：
- `output/summary/pmodel_paper.html`

再現：
- `python -B scripts/summary/paper_html.py`
- `python -B scripts/summary/paper_lint.py`

注記：
- 過去の作業履歴にある「付録A.2」表記は **当時の番号**であり、現行の章順（A.2=P、A.3=時刻・速度）とは一致しない場合がある。


---

## 2026-01-05（UTC） 論文付録A.2：飽和パラメータを δ(P)=δ0(P/P0)^k として追記し、γ_obs,max から δ0 の上限目安を明記

目的：
- `δ` が「速度側だけの任意パラメータ」に見える問題を抑えるため、飽和パラメータを時間波密度 `P` で表現する形（べき乗）を付録に追加する。
- 観測される最大ガンマ `\\gamma_{\\rm obs,max}` と矛盾しないための `\\delta_0` の上限目安（`\\delta_0 \\lesssim 1/\\gamma_{\\rm obs,max}^2`）を明記する。

変更：
- `doc/paper/05_definitions.md`
  - A.2 の注記に `\\delta(P)=\\delta_0(P/P_0)^k`（`\\delta_0>0, k\\geq 0`）を追記。
  - `\\gamma_{\\rm obs,max}` からの `\\delta_0` 上限目安を追記。
- `doc/paper/10_manuscript.md`
  - 2.3節に「弱場では `P/P_0\\approx 1` のため `\\delta(P)\\approx\\delta_0`」の補足を追記。

出力（更新）：
- `output/summary/pmodel_paper.html`

再現：
- `python -B scripts/summary/paper_html.py`
- `python -B scripts/summary/paper_lint.py`


---

## 2026-01-05（UTC） 論文付録A.3：γ_obs,max から δ0 の上限制約を厳密形で明示（誤読防止）

目的：
- `\\delta_0\\le 1/(\\gamma_{\\rm obs,max}^2-1)` が **`1/\\gamma_{\\rm obs,max}^2 - 1` と誤読**されないよう、導出を1行で明示して混乱を潰す。

変更：
- `doc/paper/05_definitions.md`
  - A.3 の注記に `\\gamma_{\\max}=\\sqrt{(1+\\delta_0)/\\delta_0}\\geq\\gamma_{\\rm obs,max}` からの導出を追記し、
    `\\delta_0\\le 1/(\\gamma_{\\rm obs,max}^2-1)\\approx 1/\\gamma_{\\rm obs,max}^2`（`\\gamma_{\\rm obs,max}\\gg 1`）を **数式ブロックで明示**。

出力（更新）：
- `output/summary/pmodel_paper.html`

再現：
- `python -B scripts/summary/paper_html.py`
- `python -B scripts/summary/paper_lint.py`


---

## 2026-01-05（UTC） 論文付録A.3：δ(P)=δ0(P/P0)^k の狙い（弱場/強場）を2行で明文化

目的：
- `\\delta(P)` が「なぜ P に掛け算するのか」を、読者が直感的に理解できるようにする（弱場でSRを壊さず、強場で飽和が強まる）。

変更：
- `doc/paper/05_definitions.md`
  - A.3 の `\\delta(P)=\\delta_0(P/P_0)^k` 直後に、狙いを箇条書きで追記。

出力（更新）：
- `output/summary/pmodel_paper.html`

再現：
- `python -B scripts/summary/paper_html.py`
- `python -B scripts/summary/paper_lint.py`


---

## 2026-01-05（UTC） 論文化：GR/SRとの位置づけ（機構としての再導出＋強場での差分予測）を序論へ追記

目的：
- GR/SR と P-model の関係を、読み手が一文で把握できるようにする（弱場一致＝近似、強場差分＝予言）。

変更：
- `doc/paper/10_manuscript.md`
  - 序論 1.1 に「GR/SRは幾何学的近似、P-modelは時間を波として仮定し再導出、強場で差が予言として現れる」を追記。

出力（更新）：
- `output/summary/pmodel_paper.html`

再現：
- `python -B scripts/summary/paper_html.py`
- `python -B scripts/summary/paper_lint.py`


---

## 2026-01-05（UTC） 論文HTML：長い式でも文字サイズを落とさず表示（横スクロールで対応）

目的：
- 長い式が「縮小されて読めない」問題を解消し、**式の文字サイズ（レンダリングfont size）を統一**する。
- 画面幅に収まらない式は横スクロールで閲覧できるようにする（印刷時は幅に合わせて縮小）。

変更：
- `scripts/summary/paper_html.py`
  - `.equation-img` の `max-width/max-height` 制限を廃止し、等倍表示に変更。
  - `.equation-block` を横スクロール可能に変更（`overflow-x:auto`）。
  - `@media print` では `max-width:100%` を適用し、紙面でのはみ出しを抑制。

出力（更新）：
- `output/summary/pmodel_paper.html`

再現：
- `python -B scripts/summary/paper_html.py`
- `python -B scripts/summary/paper_lint.py`


---

## 2026-01-05（UTC） 論文HTML：式画像の文字サイズを統一したまま 1/4 に縮小（読みやすさ調整）

目的：
- 式の文字サイズは統一できたが「1文字が大きすぎる」ため、等倍表示のまま **全体を 1/4** に縮小する。

変更：
- `scripts/summary/paper_html.py`
  - 数式PNGのレンダリングfont sizeを 26→6.5（1/4）へ変更。
  - キャッシュキーに `dpi/font size` を含め、再生成が確実に効くように修正。

出力（更新）：
- `output/summary/pmodel_paper.html`

再現：
- `python -B scripts/summary/paper_html.py`
- `python -B scripts/summary/paper_lint.py`


---

## 2026-01-05（UTC） 論文付録A.3：δの役割を「関数式＋極限」で表記し、v_max<c の誤解を防止

目的：
- 「`δ` は `v_max<c` を作る」と誤解されやすい表現を避け、`v→c` の極限で
  `((dτ/dt)_v, γ_max)` が有限になる（飽和する）ことを **式で**伝える。

変更：
- `doc/paper/05_definitions.md`
  - A.3 注記の先頭を「`lim_{v→c}(dτ/dt)_v` と `γ_max` の式（有限）」で表現し、`v_max=c` を明記。

出力（更新）：
- `output/summary/pmodel_paper.html`

再現：
- `python -B scripts/summary/paper_html.py`
- `python -B scripts/summary/paper_lint.py`


---

## 2026-01-05（UTC） 論文付録A.3：v_max 表記を廃止し「速度の上限は c」で統一

目的：
- `v_{\\max}` 記法（添字付き最大速度）が読者にとって直感的でないため、文章側の表現を簡潔にする。

変更：
- `doc/paper/05_definitions.md`
  - A.3 注記の文言を「速度そのものの上限は `c` のまま」に置換（`v_{\\max}` を不使用）。

出力（更新）：
- `output/summary/pmodel_paper.html`

再現：
- `python -B scripts/summary/paper_html.py`
- `python -B scripts/summary/paper_lint.py`


---

## 2026-01-05（UTC） 論文付録A.2：速度項を箇条書き（速度項/極限/γ_eff/γ_max）で整理し、本文と記号を統一

目的：
- A.2（時刻・速度）を「速度項→極限→有効ローレンツ因子→最大値」の流れにして、一般読者が式の意味を追いやすくする。
- 本文（2.3節）の記号も `\\gamma_{\\rm eff}` に合わせ、付録との往復で混乱しないようにする。

変更：
- `doc/paper/05_definitions.md`
  - A.2 に箇条書きで `\\left(d\\tau/dt\\right)_v`、極限 `v\\to c`、`\\gamma_{\\rm eff}(v)`、`\\gamma_{\\max}` を明示（`\\delta` の意味も注記）。
- `doc/paper/10_manuscript.md`
  - 2.3節の `\\gamma` 表記を `\\gamma_{\\rm eff}(v)` に統一（`\\gamma_{\\max}`、`v^2/c^2` の式も対応）。

出力（更新）：
- `output/summary/pmodel_paper.html`

再現：
- `python -B scripts/summary/paper_html.py`


---

## 2026-01-05（UTC） 論文化：2.3 時計（速度項）を γ_δ 表記で明確化（v_max=c を明記）

目的：
- 速度項の飽和 `δ` を「`v_max < c` のため」ではなく「`γ` の上限（発散を防ぐ）」であることを明確化し、読者の誤解を潰す。
- 2.3節の説明を SR の `γ` と対応付けて読みやすくする。

変更：
- `doc/paper/10_manuscript.md`
  - 速度項の定義の後に `γ_δ(v) ≡ 1/(dτ/dt)_v` を導入し、`γ_max = sqrt((1+δ)/δ) ≈ 1/sqrt(δ)` を明示。
  - `v^2/c^2 = 1+δ - (1+δ)/γ_δ^2` を追記し、`γ→γ_max` で `v→c`（したがって `v_max=c`）を明記。

出力（更新）：
- `output/summary/pmodel_paper.html`

再現：
- `python -B scripts/summary/paper_html.py`


---

## 2026-01-05（UTC） Phase 8.1：差分予測候補（棚卸し）を固定名で生成し、公開レポートへ統合

目的：
- 「決定打」になり得る差分予測（EHT/δなど）を **同じフォーマット**で俯瞰し、必要精度と現状ギャップを一目で確認できるようにする。
- Phase 8 の作業が “どこまで進んでいるか” を、公開レポート内でも追える状態にする。

変更：
- `scripts/summary/decisive_candidates.py`（新規）
  - Phase 8.1 の候補一覧（表＋図）を `output/summary/decisive_candidates.(png|json)` に固定名で出力。
- `scripts/summary/public_dashboard.py`
  - 新カード「差分予測候補（Phase 8.1）」を追加し、公開レポートに埋め込み。
- `scripts/summary/run_all.py`
  - `decisive_candidates` をバッチに追加（`decisive_falsification` の後）。

出力（追加/更新）：
- `output/summary/decisive_candidates.(png|json)`
- `output/summary/pmodel_public_report.html`

再現：
- `python -B scripts/summary/decisive_candidates.py`
- `python -B scripts/summary/public_dashboard.py`
- `python -B scripts/summary/run_all.py --offline`

影響ファイル（追加/更新）：
- `scripts/summary/decisive_candidates.py`
- `scripts/summary/public_dashboard.py`
- `scripts/summary/run_all.py`
- `doc/NEXT_STEPS.md`
- `doc/STATUS.md`


---

## 2026-01-05（UTC） 論文HTML：式画像サイズを「倍」に拡大（読みやすさ優先）

目的：
- 式の視認性を優先し、式画像（PNG）を明確に大きく表示する（前回の微調整が視認できなかったため）。

変更：
- `scripts/summary/paper_html.py`
  - CSS の `.equation-img` を倍程度へ拡大（最大幅/最大高さを約2倍に設定）。

出力（更新）：
- `output/summary/pmodel_paper.html`

再現：
- `python -B scripts/summary/paper_build.py --mode publish`


---

## 2026-01-05（UTC） 論文HTML：式画像サイズを微調整（小さすぎ→少し拡大）

目的：
- 式が小さすぎて読みにくいというフィードバックに合わせ、式画像の表示を「少しだけ」拡大する。

変更：
- `scripts/summary/paper_html.py`
  - CSS の `.equation-img` を微調整（最大幅/最大高さを少し拡大）。

出力（更新）：
- `output/summary/pmodel_paper.html`

再現：
- `python -B scripts/summary/paper_build.py --mode publish`


---

## 2026-01-05（UTC） 論文HTML：式画像（PNG）の表示サイズを小さめに調整

目的：
- 論文HTML内の式ブロック（PNG）が「やや大きい」というフィードバックに対応し、紙面の読みやすさ（行間・図とのバランス）を改善する。

変更：
- `scripts/summary/paper_html.py`
  - CSS の `.equation-img` を調整（最大幅/最大高さを少し縮小）。

出力（更新）：
- `output/summary/pmodel_paper.html`

再現：
- `python -B scripts/summary/paper_html.py --mode publish`
- `python -B scripts/summary/paper_build.py --mode publish`


---

## 2026-01-05（UTC） Phase 8：反証条件パックにEHTの κ 系統（参考）を追加し、更新耐性を強化

目的：
- EHT（リング直径）→シャドウ直径への変換で支配的になりやすい **κ（リング/シャドウ比）** を、差分予測（P-model vs GR）の誤差予算として明示し、
  「何が改善されれば判別できるか」を更新耐性のある形（図＋JSON）で固定する。

変更：
- `scripts/summary/decisive_falsification.py`
  - EHTの必要精度図に「参考：+κ系統（Kerr係数レンジ由来）」を追加（現状σ／参考:+κ／必要σの3本表示）。
  - JSONに κ 系統の補助指標（`sigma_shadow_from_kappa_uas`、`sigma_total_now_with_kappa_uas`、`gap_factor_now_over_needed_with_kappa` 等）と注記を追加。
- `scripts/summary/public_dashboard.py`
  - 公開レポートの「反証条件（差分予測）パック」表に、参考:+κとギャップ（+κ）列を追加。
- `doc/NEXT_STEPS.md`
  - Phase 8 の Step 8.2.1a（κ誤差予算の反映）を完了として更新。
- `doc/STATUS.md`
  - 入口（成果物）に「参考:+κ」追記、最終更新UTCを更新。

出力（更新）：
- `output/summary/decisive_falsification.(png|json)`
- `output/summary/pmodel_public_report.html`

再現：
- `python -B scripts/summary/decisive_falsification.py`
- `python -B scripts/summary/public_dashboard.py`
- `python -B scripts/summary/run_all.py --offline`（failures=0 を確認）


---

## 2026-01-05（UTC） Phase 7：決定的検証パック（凍結→外挿→反証条件→オフライン再現）を入口へ統合

目的：
- 「決定的」＝第三者が同じ手順で判定できる状態（一次ソース＋不確かさ＋反証条件）を、**ワンコマンド入口**として固定する。
- 以後の更新で重複作業にならないよう、Phase 7 の成果物名と再現手順を凍結する。

変更：
- `scripts/summary/run_all.py`
  - Phase 7 の必須タスクを一括バッチに統合：
    - β/δ 凍結：`scripts/theory/freeze_parameters.py`
    - 決定的スコアボード：`scripts/summary/decisive_scoreboard.py`
    - 反証条件パック（必要精度＋棄却条件）：`scripts/summary/decisive_falsification.py`
  - 位置：`eht_shadow_compare` の後（→ その後に `paper_table1` / `paper_build`）。
- `doc/STATUS.md`
  - Phase 7 完了として入口（成果物）と主要数値を更新。
- `doc/NEXT_STEPS.md`
  - Phase 7（Step 7.3/7.4）のチェックを完了（[x]）へ更新。

出力（固定名）：
- β/δ 凍結：`output/theory/frozen_parameters.json`
- 決定的スコアボード：`output/summary/decisive_scoreboard.(png|json)`
- 反証条件パック：`output/summary/decisive_falsification.(png|json)`
- 公開レポート：`output/summary/pmodel_public_report.html`
- 論文HTML（publish）：`output/summary/pmodel_paper.html`
- 実行ステータス：`output/summary/run_all_status.json`

検証：
- `python -B scripts/summary/run_all.py --offline` → failures=0
- `python -B scripts/summary/paper_build.py --mode publish` → errors/warnings 0

再現：
- `python -B scripts/summary/run_all.py --offline`
- `python -B scripts/summary/paper_build.py --mode publish`


---

## 2026-01-05（UTC） 論文HTML：`\\` が残らないよう数式画像の代替テキストを整理

目的：
- `output/summary/pmodel_paper.html` のHTMLソースに数式の LaTeX（例：`\\gamma`）が残ると、検索・引用・共有時に混乱しやすいため除去する。

変更：
- `scripts/summary/paper_html.py`
  - 数式画像（`<img class='equation-img'>`）の `alt` を LaTeX文字列から汎用文言（`数式`）へ変更。

結果：
- `rg -n "\\\\" output/summary/pmodel_paper.html` → no matches
- `python -B scripts/summary/paper_lint.py` → errors: 0 / warnings: 0

再現：
- `python -B scripts/summary/paper_html.py`
- `python -B scripts/summary/paper_lint.py`


---

## 2026-01-06（UTC） 論文化：二重パルサー（Step 8.4）/ GW150914 chirp（Step 8.6）を論文へ反映

目的：
- ユーザー指摘（「論文に二重パルサー/GW150914が入っていない」）に対応し、論文（`output/summary/pmodel_paper.html` / `.pdf`）へ **本文＋図＋表（Table 1）＋一次ソース/参考文献** を一式で反映する。
- 本文の禁則（`\\gamma` 等の LaTeX エスケープ表記を出さない、ファイルパス文字列を本文に出さない）を維持したまま、追加検証を紙面へ統合する。

変更：
- `doc/paper/10_manuscript.md`
  - Results 節に追加：
    - `4.10 二重パルサー（軌道減衰：放射の制約）`
    - `4.11 重力波（GW150914：chirp位相の整合性）`
  - 記号を本文で誤読しにくい表記へ統一（例：`Pdot_b` 表記に統一、`\\` 表記は使わない）。
- `scripts/summary/paper_tables.py`
  - Table 1（論文用サマリ表）へ Pulsar/GW の行を追加し、生成物（md/csv/json）へ反映。
- `doc/paper/01_figures_index.md`
  - 図インデックスに以下を追加（publishで図をインライン化する対象）：
    - `output/pulsar/binary_pulsar_orbital_decay.png`
    - `output/gw/gw150914_chirp_phase.png`
- `doc/paper/20_data_sources.md` / `doc/paper/30_references.md`
  - 二重パルサー/重力波の一次ソース（DOI/URL/参照日）を追記。
- `scripts/summary/paper_build.py`
  - `--mode publish` で論文 HTML+PDF を再生成し、反映を確認。

出力（更新/追加）：
- 論文：`output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.pdf`
- Table 1：`output/summary/paper_table1_results.md` / `.csv` / `.json`
- 図：`output/pulsar/binary_pulsar_orbital_decay.png`、`output/gw/gw150914_chirp_phase.png`

再現：
- `python -B scripts/pulsar/binary_pulsar_orbital_decay.py`
- `python -B scripts/gw/gw150914_chirp_phase.py --offline`（初回は `--offline` なしでキャッシュ作成）
- `python -B scripts/summary/paper_build.py --mode publish`


---

## 2026-01-06（UTC） ロードマップ更新：動的P（Theory）＋二重パルサー/GWの論文強化（Step 8.7?8.9）

目的：
- 二重パルサー（4.10）とGW150914（4.11）を「棄却条件/簡易fit」から、**Theory（動的P）→導出→観測比較**へ段階的に強化する方針をロードマップに反映する。

変更：
- `doc/ROADMAP.md`
  - Phase 8 に Step 8.7?8.9 を追加：
    - Step 8.7：動的P（放射・波動）を Theory（論文2.x）へ導入
    - Step 8.8：二重パルサー（論文4.10）を「棄却条件」→「導出＋比較」へ
    - Step 8.9：GW150914（論文4.11）を「位相fit」→「観測量の式（波形）比較」へ
- `doc/STATUS.md`
  - Phase 8 の次ステップ列挙に Step 8.7?8.9 を追加。

注記：
- 論文（体裁）の作業順序は **2.x（動的P）→4.10→4.11** として統一する（`doc/ROADMAP.md` に明記）。


---

## 2026-01-06（UTC） 検証追加：二重パルサー軌道減衰＋GW150914 chirp、PDF併出を標準化

目的：
- 既存の古典テスト（LLR/Cassini/Viking/Mercury/GPS/EHT）に加え、**強重力・放射**の代表検証として
  - 二重パルサー（軌道減衰：四重極放射が支配的）
  - LIGO（GW150914：位相＝chirp）
  をレポートへ追加し、第三者が同じ図を再生成できる形にする。
- 共有性のため、`output/summary/*.html` と同時に `output/summary/*.pdf` も生成する運用に寄せる。

変更：
- `scripts/summary/public_dashboard.py`
  - 公開レポートに「強重力（連星パルサー/重力波）」章を追加し、以下2図を表示：
    - `output/pulsar/binary_pulsar_orbital_decay.png`
    - `output/gw/gw150914_chirp_phase.png`
- `scripts/summary/run_all.py`
  - レポート生成後に `output/summary/pmodel_public_report.pdf` と `output/summary/pmodel_paper.pdf` を生成する（Edge headless印刷）。
  - PDF生成は「ブラウザ無しならスキップ、変換失敗は失敗扱い」で `run_all_status.json` に残す。
- `scripts/summary/paper_build.py`
  - 論文ビルド（Table 1 + HTML + lint）後に `output/summary/pmodel_paper.pdf` を生成（`--skip-pdf` で無効化可）。
- `AGENTS.md`
  - 「HTMLと同時にPDFも生成」を標準ルールとして追記。
- `doc/STATUS.md`
  - 入口（成果物）にPDFを追加し、強重力（パルサー/GW）の最新数値を追記。

一次ソース（代表）：
- PSR B1913+16：Weisberg & Huang (2016) doi:10.3847/0004-637X/829/1/55
- PSR J0737−3039A/B：Kramer et al. (2021) doi:10.1103/PhysRevX.11.041050
- GW150914：GWOSC (GWTC-1-confident / v3)（`data/gw/gw150914/gw150914_sources.json` にURL/sha256を保存）

結果（主要数値）：
- 二重パルサー（R ≡ Ṗ_b(obs)/Ṗ_b(GR)）：
  - PSR B1913+16：R=0.9983 ± 0.0016（1σ）
  - PSR J0737−3039A/B：R=1.000000 ± 6.6e-05（95%）
- GW150914（chirp）：
  - bandpass 30–350 Hz → Hilbert位相 → f(t) 抽出 → t = t_c − A f^(−8/3) の簡易fit（厳密推定ではない）

出力（固定パス）：
- `output/pulsar/binary_pulsar_orbital_decay.png` / `output/pulsar/binary_pulsar_orbital_decay_metrics.json`
- `output/gw/gw150914_chirp_phase.png` / `output/gw/gw150914_chirp_phase_metrics.json`
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.pdf`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.pdf`

再現：
- `python -B scripts/summary/run_all.py --offline`


---

## 2026-01-07（UTC） EHT：反証条件パックで κ_obs を優先（無ければ Kerr 系統へフォールバック）

目的：
- 反証条件パック（`output/summary/decisive_falsification.png`）における EHT の誤差予算を、可能な限り **一次ソースの κ_obs** に基づく形へ寄せる（κの定義差による系統を明示し、差分予測の「必要精度」評価を現実に即して更新する）。

変更：
- `scripts/summary/decisive_falsification.py`
  - κの扱いを更新：一次ソースで κ_obs が得られる場合は κ_obs とその不確かさを優先し、得られない場合は Kerr 参考レンジ由来の κ 系統誤差へフォールバックする。
  - `output/summary/decisive_falsification.json` の EHT 行に以下を追加：
    - `kappa_obs`, `kappa_obs_sigma`, `kappa_systematics_source`
    - `sigma_total_now_with_kappa_obs_uas`, `sigma_total_now_with_kappa_kerr_uas`

出力（更新）：
- `output/summary/decisive_falsification.png`
- `output/summary/decisive_falsification.json`
- （再生成）`output/summary/pmodel_public_report.html` / `.pdf`
- （再生成）`output/summary/pmodel_paper.html` / `.pdf`
- `output/summary/run_all_status.json`

再現：
- `python -B scripts/summary/decisive_falsification.py`
- `python -B scripts/summary/run_all.py --offline`


---

## 2026-01-07（UTC） 論文/レポート：二重パルサー・GW150914 掲載の再確認とオフライン再生成

目的：
- 「二重パルサー（軌道減衰）」「GW150914（chirp位相）」が論文に入っていないという混乱を避けるため、決定版の HTML/PDF を再生成し、該当節の存在を明確化する。
- 論文アウトライン（草稿）を、本文（`doc/paper/10_manuscript.md`）と同じ章立て（2.x 動的P → 4.10 → 4.11）に同期する。

変更：
- `doc/paper/00_outline.md`
  - Abstract に二重パルサー/GW150914を明記
  - Theory に「2.4 動的P（放射・波動）」を追加
  - Results の節立てを 4.1〜4.11 に同期
- `doc/STATUS.md`
  - 最終更新（UTC）を更新
  - 論文内の該当節（4.10/4.11）を入口に明記

出力（再生成）：
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.pdf`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.pdf`
- `output/pulsar/binary_pulsar_orbital_decay.png`
- `output/gw/gw150914_chirp_phase.png`

再現：
- `python -B scripts/summary/run_all.py --offline`


---

## 2026-01-07（UTC） EHT：一次ソース保存の整合性を修正（PDF/TeXの区別を明確化）

目的：
- Phase 8 Step 8.2（EHT）の「一次ソースで系統誤差を詰める」を進めるため、`data/eht/sources/` を“再取得可能で誤解しない形”に整える。
- 「κは測定済みか？」という誤解を避けるため、κの扱い（κ_fit と κ_obs）を文書側で明確化する。

変更：
- `data/eht/sources/`
  - 誤った arXiv 参照（1906.11244/1906.11245）と、拡張子不整合（tar.gz 名だが実体PDF）を除去
  - 現状の一次ソースを次に統一：M87*（PDFのみ）/ Sgr A*（arXiv source + 展開済みTeX）
- `doc/eht/README.md`
  - κの扱いを `κ_fit`（理論予測から逆算）と `κ_obs`（論文中にシャドウ直径が明示される場合の参考値）に分離して説明
  - 一次ソースの保存場所（`data/eht/sources/`）と、M87* はPDFのみ・Sgr A* はTeXあり、を明記

再現：
- `python -B scripts/eht/eht_shadow_compare.py`


---

## 2026-01-07（UTC）EHT：Sgr A* の高傾斜（i>50°）棄却を一次ソースで反映し、Kerr 系統レンジを制約版へ

目的：
- Phase 8 Step 8.2（EHT）の「一次ソースで系統誤差を詰める」を前進させる。
- Sgr A* はEHTのモデル比較で高傾斜（i>50°）が不利とされるため、この情報を Kerr 係数レンジ（スピン/傾斜角由来）の“参考レンジ”縮約に使い、κ の誤差予算に反映する。

変更：
- `data/eht/eht_black_holes.json`
  - Sgr A*（`key: sgra`）に `kerr_inc_deg_max=50.0` を追加（i>50° disfavor）
  - `sources` の `used_fields` に `kerr_inc_deg_max` を追加
- `doc/eht/README.md`
  - Sgr A* の視線角制約の扱いを更新（高傾斜 i>50° を disfavor）

出力（更新）：
- `output/eht/eht_shadow_compare.json`（Sgr A* が `kerr_range_mode: constrained` で計算される）
- `output/eht/eht_shadow_systematics.png`
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.pdf`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.pdf`

再現：
- `python -B scripts/summary/run_all.py --offline`

補足：
- 変更が見えない場合は、`pmodel_paper.html` を開き直す（またはスーパーリロード）で反映されます（式は data URI で埋め込みのため通常は即時反映）。


---

## 2026-01-07（UTC） EHT：M87* 視線角制約を導入し、Kerr 参考レンジを制約版で再計算

目的：
- Phase 8 Step 8.2（EHT）の「一次ソースで系統誤差を詰める」を前進させる。
- M87* の視線角（ジェット角）に一次ソース制約があるため、GR（Kerr）の係数レンジ（スピン/傾斜角由来）を天体ごとに現実的に狭め、κ の誤差予算に反映する。

変更：
- `data/eht/eht_black_holes.json`
  - M87* に `kerr_inc_deg_min/max`（inc∈[10°,25°]）を追加
  - 出典を `sources` に追加（Mertens et al., A&A 595, A54, 2016）
- `scripts/eht/eht_shadow_compare.py`
  - 天体ごとの Kerr 制約レンジ（a*/inc）を読取り、制約がある場合はその範囲で Kerr 係数レンジを再計算して κ の誤差予算に反映
  - 互換性維持のため、従来の「広い Kerr 参考レンジ」も `*_full` として併記
- `scripts/summary/html_to_pdf.py`
  - Edge が終了しても PDF が遅れて生成されるケースがあるため、生成待ちポーリングを延長し false negative を抑制（paper_build の安定化）

出力（更新）：
- `output/eht/eht_shadow_compare.json` / `output/eht/eht_shadow_systematics.png`
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.pdf`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.pdf`

再現：
- `python -B scripts/eht/eht_shadow_compare.py`
- `python -B scripts/summary/run_all.py --offline`
- `python -B scripts/summary/paper_build.py --mode publish`


---

## 2026-01-07（UTC） STATUS整備：GW150914メトリクスを一次出力と同期、論文への反映状態を明確化

目的：
- `doc/STATUS.md` の「最新の数値（重力波：GW150914 の chirp）」が古い値になっていたため、最新の出力（`output/gw/gw150914_chirp_phase_metrics.json`）と同期する。
- 「論文に二重パルサー/GW150914が入っていない」という混乱を避けるため、論文（`output/summary/pmodel_paper.html`）の該当節（4.10/4.11）と Table 1 の存在を確認し、運用ドキュメント側の現在地を明確化する。

変更：
- `doc/STATUS.md`
  - 最終更新（UTC）の更新
  - GW150914（chirp）の主要数値を更新（H1/L1 の R²、fit区間、M_c の扱い）
  - 表記ゆれを修正（例：Hulse?Taylor/J0737?3039、bandpass 30?350）

参照（確認先）：
- `output/summary/pmodel_paper.html`（TOC/本文に 4.10/4.11 が存在）
- `output/summary/paper_table1_results.md`（Table 1 に二重パルサー/GW150914 が存在）
- `output/gw/gw150914_chirp_phase_metrics.json`
- `output/pulsar/binary_pulsar_orbital_decay_metrics.json`

再現：
- `python -B scripts/summary/paper_build.py --mode publish`


---

## 2026-01-08（UTC） Step 8.2（EHT系統）：散乱一次ソース追加＋形状指標（M87上限）反映、DOCXを自己完結化

目的：
- Step 8.2（EHT）で課題になっている **κ/散乱/放射モデル由来の系統**を、一次ソースへ紐づけて整理し、公開レポート/論文の説明と図へ反映できる状態にする。
- 一般向け Word（DOCX）が画像リンクに依存せず、**配布しても崩れない**状態にする（画像を埋め込み、枠内フィットを強化）。

変更：
- `data/eht/eht_black_holes.json`
  - M87*：リング幅の一次ソース上限 `ring_fractional_width_max=0.5` を追加（EHT Paper I）。
  - Sgr A*：散乱カーネルの参考値 `scattering_kernel_fwhm_uas=23` を追加（EHT Paper I の比較図の記述）。
  - 散乱系統の一次ソース（Psaltis/Johnson/Zhu）を `sources` に追加し、Sgr A* の `source_keys` に紐づけた。
- `data/eht/sources/`
  - 散乱関連の一次ソースPDFを保存：
    - `arxiv_1805.01242.pdf`（Psaltis et al. 2018）
    - `arxiv_1808.08966.pdf`（Johnson et al. 2018）
    - `arxiv_1811.02079.pdf`（Zhu et al. 2018）
- `scripts/eht/eht_shadow_compare.py`
  - `scattering_kernel_fwhm_uas` を出力へ追加。
  - リング形状指標（W/d, A）の図で、**レンジ/上限/下限**を区別して表示するよう改善（M87* の W/d 上限が図で見える）。
- `doc/eht/README.md`
  - M87* の W/d 上限、Sgr A* の散乱（一次ソースと参考値）を追記。
  - 散乱関連PDF（上記3本）を「一次ソースの保存」に追記。
- 論文側の一次ソース整備：
  - `doc/paper/20_data_sources.md` / `doc/paper/30_references.md` に散乱系統（Psaltis/Johnson/Zhu）を追記。
  - `doc/paper/10_manuscript.md` の EHT 節に散乱系統の参照を追記。
- DOCX 生成の安定化：
  - `scripts/summary/html_to_docx.py`
    - HTML内のローカル画像を data URI に変換して **DOCXへ埋め込み**（Wordが画像を外部リンクしないようにする）。
    - 表/図の枠内フィットの安全マージンを拡大（右端はみ出し対策）。

出力（更新）：
- EHT：`output/eht/eht_shadow_compare.json` / `output/eht/eht_ring_morphology.png` ほか
- 一般向け：`output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`（画像埋め込み化）
- 論文：`output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`

再現：
- `python -B scripts/summary/run_all.py --offline`
- `python -B scripts/summary/paper_build.py --mode publish --docx-orientation landscape`


---

## 2026-01-08（UTC） 回転（フレームドラッグ）追加：GP-B/LAGEOSの一次ソース固定と比較図（Step 8.3）

目的：
- Step 8.3（回転＝フレームドラッグ）を「理論（最小拡張）＋一次ソース検証」として統合し、相対論の置換候補として必要な要件を明示する。

変更：
- `data/theory/frame_dragging_experiments.json`
  - GP-B / LAGEOS の一次ソース値を固定入力として追加（μ=|Ω_obs|/|Ω_pred| の形で比較）
- `data/theory/sources/arxiv_1105.3456.pdf`
  - GP-B 最終結果（Everitt et al. 2011）の一次ソースPDFを保存（sha256も固定入力に併記）
- `scripts/theory/frame_dragging_experiments.py`
  - 追加図：`output/theory/frame_dragging_experiments.png`（観測比 μ と誤差棒、1線=予測）
  - 固定出力：`output/theory/frame_dragging_experiments.(json|csv)`
- `scripts/summary/run_all.py`
  - `theory_frame_dragging_experiments` を追加し、バッチ再現へ組み込み
- `scripts/summary/public_dashboard.py`
  - 公開レポートに「回転（フレームドラッグ）」カードを追加
- `doc/paper/10_manuscript.md` / `doc/paper/01_figures_index.md`
  - 論文に理論（2.7）と検証（4.12）を追加（図と参照を紐づけ）
- `doc/paper/20_data_sources.md` / `doc/paper/30_references.md`
  - 一次ソース（DOI/URL/参照日）を追加

出力（追加/更新）：
- `output/theory/frame_dragging_experiments.png`
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`
- `output/summary/paper_table1_results.md`（Table 1 に回転（フレームドラッグ）を追加）

再現：
- `python -B scripts/theory/frame_dragging_experiments.py`
- `python -B scripts/summary/run_all.py --offline`
- `python -B scripts/summary/paper_build.py --mode publish`


---

## 2026-01-08（UTC） EHT（散乱/κ系統）定量化：屈折散乱ゆらぎを固定入力へ反映（Step 8.2.1b 完了）

目的：
- Step 8.2.1b（散乱/放射モデル由来の κ 系統）を、一次ソースに基づく“数値”として固定し、%級で拘束できるかの見通しを明確化する。

変更：
- `data/eht/eht_black_holes.json`
  - Sgr A* の散乱カーネルの PA（≈81.9°）を追加
  - Zhu 2018 の屈折散乱ゆらぎ（wander/distortion/asymmetry の min/max）を固定入力へ追加
- `scripts/eht/eht_shadow_compare.py`
  - 上記フィールドを出力（CSV/JSON）へ反映
  - 追加図：`output/eht/eht_refractive_scattering_limits.png`（屈折散乱のゆらぎスケール vs 必要精度）
  - 既存図の出力ログを追加（散乱budget/屈折散乱）
- `doc/eht/README.md`
  - Zhu 2018 の定量（distortion 0.72→6.3 μas など）を追記し、図へのリンクを追加
- `doc/paper/10_manuscript.md` / `doc/paper/01_figures_index.md`
  - 論文側へ散乱budget/屈折散乱図を追加
- `doc/NEXT_STEPS.md` / `doc/STATUS.md`
  - Step 8.2/8.2.1b を完了として更新

出力（追加/更新）：
- `output/eht/eht_refractive_scattering_limits.png` / `output/eht/eht_refractive_scattering_limits_public.png`
- `output/eht/eht_scattering_budget.png` / `output/eht/eht_scattering_budget_public.png`（再生成）
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`

再現：
- `python -B scripts/eht/eht_shadow_compare.py`
- `python -B scripts/summary/run_all.py --offline`
- `python -B scripts/summary/paper_build.py --mode publish`


---

## 2026-01-08（UTC） 公開レポート整理：ロードマップ章を除外／論文の検証図を拡張（Cassini・GPS・EHT）

目的：
- 一般向けレポートは「検証サマリ＋読みやすい説明」に集中し、ロードマップは除外する。
- 論文（草稿）は検証結果をより網羅し、詳細図（Cassini/GPS/EHT）を本文側へ追加する。

変更：
- `scripts/summary/public_dashboard.py`
  - 公開レポートから「ロードマップ / 進捗」章を除外（先頭章を「検証サマリ / 更新情報」に整理）
- `doc/paper/10_manuscript.md`
  - 4.3（Cassini）に PDS vs デジタイズ、全期間、βスイープを追加
  - 4.7（GPS）に G01例、BRDC-IGS（全衛星）を追加
  - 4.8（EHT）に リング形状指標（幅 W/d と非対称 A）を追加
- `doc/paper/01_figures_index.md`
  - Cassini/GPS/EHT の固定パス（図）を追加

出力（更新）：
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`

再現：
- `python -B scripts/summary/public_dashboard.py`
- `python -B scripts/summary/paper_build.py --mode publish`


---

## 2026-01-08（UTC） 論文補足追記：追加図（Cassini/GPS/EHT）の読み方を明文化

目的：
- 論文側に追加した検証図について、図の意図（何を確認する図か）を本文中で明示し、読み手の迷いを減らす。

変更：
- `doc/paper/10_manuscript.md`
  - 4.3（Cassini）/ 4.7（GPS）/ 4.8（EHT）に「補足（図の読み方）」を追記

出力（更新）：
- `output/summary/pmodel_paper.html`
- `output/summary/pmodel_paper.docx`

再現：
- `python -B scripts/summary/paper_build.py --mode publish`


---

## 2026-01-08（UTC） 論文LLR本文の増補：残差 vs 仰角／局座標／寄与分解の図を追加

目的：
- 公開レポートPDFに含まれていた LLR の詳細図（残差 vs 仰角、局座標、Shapiro/潮汐の寄与など）を、論文（草稿）の LLR 節（4.2）にも掲載する。

変更：
- `doc/paper/10_manuscript.md`
  - 4.2（LLR）に以下の図を追加（本文に掲載）：
    - 残差 vs 仰角：APOL/GRSM/MATM/WETL（SR+Tropo+Tide）
    - 局座標：pos+eop vs site log、局座標ソース比較（RMS）、GRSM 月別RMS（局座標ソース比較）
    - 寄与分解：潮汐の寄与、重力遅延（Shapiro）の寄与、切り分け（Shapiro/対流圏/月回転モデル）
- `doc/paper/01_figures_index.md`
  - 図キャプションを公開レポートの表現に合わせて調整

出力（更新）：
- `output/summary/pmodel_paper.html`
- `output/summary/pmodel_paper.docx`

再現：
- `python -B scripts/summary/paper_build.py --mode publish`


---

## 2026-01-08（UTC） 論文LLR補遺：公開レポートPDF相当の全グラフを付録に収録

目的：
- 公開レポートPDF（`output/summary/pmodel_public_report.pdf`）に含まれていた LLR の全グラフを、論文（草稿）側にも掲載できるようにする。

変更：
- `doc/paper/07_llr_appendix.md`
  - LLR の全グラフを付録として列挙（本文は代表図のまま）
- `doc/paper/01_figures_index.md`
  - LLR セクションに全グラフの固定パスを追加（図番号付与の対象を拡張）
- `scripts/summary/paper_html.py`
  - 付録セクション「LLR 全グラフ」を追加

出力（更新）：
- `output/summary/pmodel_paper.html`
- `output/summary/pmodel_paper.docx`

再現：
- `python -B scripts/summary/paper_build.py --mode publish`


---

## 2026-01-08（UTC） DOCX横向き（Landscape）対応：表/2up図の右はみ出し対策

目的：
- Word（DOCX）で、表や横2枚レイアウトの図が右端からはみ出すケースを避ける。

変更：
- `scripts/summary/html_to_docx.py`
  - `--orientation {portrait,landscape}` を追加し、postprocessで全Sectionへ適用
- `scripts/summary/run_all.py`
  - `--docx-orientation {portrait,landscape}` を追加（既定：landscape）
- `scripts/summary/paper_build.py`
  - `--docx-orientation {portrait,landscape}` を追加（既定：landscape）

出力（更新）：
- `output/summary/pmodel_public_report.docx`（A4横）
- `output/summary/pmodel_paper.docx`（A4横）

再現：
- `python -B scripts/summary/run_all.py --offline`（`--docx-orientation portrait` で縦に戻せる）
- `python -B scripts/summary/paper_build.py --mode publish`（`--docx-orientation portrait` で縦に戻せる）


---

## 2026-01-08（UTC） DOCX右端の余白確保：画像/表の安全マージン拡大

目的：
- Word（DOCX）で右端がギリギリになり、環境によって「はみ出して見える」問題を抑える。

変更：
- `scripts/summary/html_to_docx.py`
  - 画像の自動フィットで安全マージンを 24pt に拡大。
  - 表のターゲット幅を（ページ枠 - 24pt）にして列幅を縮小・固定。

出力（更新）：
- `output/summary/pmodel_public_report.docx`
- `output/summary/pmodel_paper.docx`

再現：
- `python -B scripts/summary/run_all.py --offline`


---

## 2026-01-08（UTC） DOCX表の折り返し補強（補足）：ゼロ幅→半角スペース

目的：
- Wordがゼロ幅スペースを保存時に落とす場合があるため、折り返し用の区切りを確実に残す。

変更：
- `scripts/summary/html_to_docx.py`
  - 表セルの区切り後に挿入する文字を、ゼロ幅スペースから半角スペースに変更（`/` `;` `:` の直後）。

出力（更新）：
- `output/summary/pmodel_public_report.docx`（※ファイルが開かれていると上書きできない）
- `output/summary/pmodel_paper.docx`

再現：
- `python -B scripts/summary/run_all.py --offline`


---

## 2026-01-08（UTC） DOCX体裁調整（追加）：画像/表の横はみ出し対策を強化

目的：
- 公開レポート（Word）で画像や表がページ幅ギリギリになり「はみ出して見える」問題を抑える。
- 表のセル内に長いトークン（パス/ID等）がある場合でも、折り返しが効くようにする。

変更：
- `scripts/summary/html_to_docx.py`
  - 画像はページ枠から安全マージン（8pt）を確保して自動フィット。
  - 表はページ枠から安全マージン（8pt）を確保して列幅を縮小し、`AllowAutoFit=False` で固定。
  - 表セルのパス/ID等は `/` `_` `;` `:` などの区切り後にゼロ幅スペースを挿入し、Word側で折り返し可能にした。

出力（更新）：
- `output/summary/pmodel_public_report.docx`（※ファイルが開かれていると上書きできないため、閉じてから再生成が必要）
- `output/summary/pmodel_paper.docx`

再現：
- `python -B scripts/summary/run_all.py --offline`


---

## 2026-01-08（UTC） 公開レポートLLR簡略化：残差（観測 - モデル）中心へ

目的：
- 一般向けレポートの LLR を、分かりやすい「観測 - P-model（残差）」の提示に絞り、読みやすさを優先する。

変更：
- `scripts/summary/public_dashboard.py`
  - 公開レポートの LLR 章を `llr_residual`（残差）1図＋RMS（例）の表示に整理。
  - 技術的な切り分け（モデル改善/外れ値等）は `output/summary/details/llr.html` に集約（公開レポートからはリンク）。

出力（更新）：
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`

再現：
- `python -B scripts/summary/run_all.py --offline`


---

## 2026-01-08（UTC） DOCX画像枠の厳密化：段落インデント/セル幅を考慮して自動フィット

目的：
- Word（DOCX）で一部の画像がページからはみ出す問題を解消する（特に論文Wordで発生）。

変更：
- `scripts/summary/html_to_docx.py`
  - 画像の自動フィットを「ページ幅」だけでなく、段落の左/右/先頭インデントと表セル幅（表内の場合）を差し引いた“実効枠”に対して適用するよう修正。
  - 端の丸め誤差でのはみ出しを避けるため、ごく小さい安全マージン（1pt）を導入。

出力（更新）：
- `output/summary/pmodel_public_report.docx`
- `output/summary/pmodel_paper.docx`

再現：
- `python -B scripts/summary/run_all.py --offline`


---

## 2026-01-08（UTC） DOCX体裁修正：表/図のはみ出し解消（AutoFit安定化）

目的：
- Word（DOCX）出力で画像・テーブルがページからはみ出す問題を解消し、配布用の体裁を安定化する。

変更：
- `scripts/summary/html_to_docx.py`
  - DOCX後処理で `doc.Repaginate()` を挟み、Table AutoFit（window fit）が確実に反映されるように修正。
  - 余白設定/改ページ付与後にも再ページ付けを行い、レイアウトを安定化。

出力（更新）：
- `output/summary/pmodel_public_report.docx`
- `output/summary/pmodel_paper.docx`

再現：
- `python -B scripts/summary/run_all.py --offline`


---

## 2026-01-08（UTC） 論文DOCX：数式を Word 数式（編集可能）で出力

目的：
- `output/summary/pmodel_paper.docx` の数式を画像ではなく、Word の数式（OMML）として編集可能にする。
- 公開用HTML（`pmodel_paper.html`）の数式画像方針（altは「数式」・本文に `\\` を出さない）は維持する。

変更：
- `scripts/summary/html_to_docx.py`
  - `--paper-equations` を追加：論文HTML→DOCX変換後、数式画像（alt=数式）を LaTeX ブロックから OMML に置換
  - Office 付属 `MML2OMML.XSL` と Python `latex2mathml` を使用（MathML→OMML変換）
- `scripts/summary/run_all.py` / `scripts/summary/paper_build.py`
  - 論文DOCX生成で `--paper-equations` を有効化

出力（更新）：
- `output/summary/pmodel_paper.docx`（数式=Word数式）

再現：
- `python -B scripts/summary/run_all.py --offline`
- `python -B scripts/summary/paper_build.py --mode publish`
- `python -B scripts/summary/paper_build.py`


---

## 2026-01-08（UTC） 公開レポート改善：Table 1一般向け列表示、DOCX出力へ移行、Public用グラフ追加

目的：
- Table 1 の「差/指標」が一般向けに難しいため、公開レポートで「かんたん解釈」列（metric_public）を表示する。
- 共有用出力を PDF から Word（DOCX）へ切り替える（HTML + DOCX を正本とする）。
- 論文向けと一般向けでグラフを分離し、強重力（EHT/パルサー/GW）の一般向け図を追加する。

変更：
- `scripts/summary/public_dashboard.py`
  - Table 1 に「かんたん解釈」列を追加表示（metric_public）
  - 一般向けレポートの図を public 用ファイルへ切り替え（EHT/パルサー/GW）
- `scripts/summary/html_to_docx.py`（新規）
  - Word 自動化で HTML→DOCX 変換（0=成功, 3=skip）
- `scripts/summary/run_all.py`
  - PDF 出力タスクを DOCX 出力へ置換（public/paper）
- `scripts/summary/paper_build.py`
  - PDF 出力を DOCX 出力へ置換（`--skip-docx`、`--skip-pdf` は互換 alias）
- `scripts/eht/eht_shadow_compare.py`
  - 公開レポート向け κ 図を追加（`output/eht/eht_kappa_fit_public.png`）
  - 公開レポート向けに EHT 図の `*_public.png` を併出
- `scripts/pulsar/binary_pulsar_orbital_decay.py`
  - 公開向けの「ずれ[%]」図を追加（`output/pulsar/binary_pulsar_orbital_decay_public.png`）
- `scripts/gw/gw150914_chirp_phase.py`
  - 公開向けの単一パネル図を追加（`output/gw/gw150914_chirp_phase_public.png`）
- `AGENTS.md` / `doc/STATUS.md` / `doc/NEXT_STEPS.md`
  - PDF→DOCX への表記更新

出力（追加/更新）：
- `output/summary/pmodel_public_report.docx`
- `output/summary/pmodel_paper.docx`
- `output/pulsar/binary_pulsar_orbital_decay_public.png`
- `output/gw/gw150914_chirp_phase_public.png`
- `output/eht/eht_kappa_fit_public.png`
- `output/eht/eht_shadow_zscores_public.png`
- `output/eht/eht_shadow_systematics_public.png`
- `output/eht/eht_ring_morphology_public.png`
- `output/eht/eht_shadow_differential_public.png`

再現：
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）


---

## 2026-01-08（UTC） 仕上げ調整：論文Table 1列の分離、DOCX余白最小化、LLR一般向け図の絞り込み

目的：
- 論文（紙面）では技術列に集中し、一般向け解釈は公開レポート側に分離する。
- DOCX（配布用）の余白を最小化する。
- 一般向けレポートの LLR は「モデルが観測と一致している」ことが直感的に伝わる図に絞り、詳細は別ページへ退避する。

変更：
- `scripts/summary/paper_tables.py`
  - `output/summary/paper_table1_results.md` から「かんたん解釈」列を除去（JSON/CSVの `metric_public` は維持）
- `scripts/summary/html_to_docx.py`
  - `--margin-mm` を追加（既定 5mm）、Word変換後にページ余白を一括設定
- `scripts/summary/public_dashboard.py`
  - 公開レポートの LLR 章を代表2図（`llr_residual` / `llr_residual_compare`）に絞り込み
  - 詳細診断は `output/summary/details/llr.html` に全図をまとめ、各カードからジャンプ可能に

出力（更新）：
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`
- `output/summary/details/llr.html`

再現：
- `python -B scripts/summary/run_all.py --offline`


---

## 2026-01-08（UTC） Phase 8.5：宇宙論（距離二重性 / DDR）棄却条件の固定

目的：
- 背景Pによる赤方偏移（宇宙膨張なし）の最小仮定を「観測で使う量」へ接続し、一次ソース＋誤差つきの棄却条件として固定する。

変更：
- `data/cosmology/distance_duality_constraints.json`
  - 一次ソース（SNIa+BAOの ε0 制約）を固定入力化（参照日/URL/ローカルPDF/sha256 を含む）
- `data/cosmology/sources/arxiv_2007.16153.pdf`
  - 一次ソースPDFを保存（Martinelli et al. 2021, DDR）
- `scripts/cosmology/cosmology_distance_duality_constraints.py`
  - DDR制約（ε0）と静的背景P最小モデル（ε0=-1）の棄却度（zスコア）を可視化・集計
- `scripts/summary/run_all.py` / `scripts/summary/public_dashboard.py`
  - 宇宙論（DDR）を統一バッチと公開レポートへ統合
- `doc/paper/10_manuscript.md`
  - 宇宙論（2.5）に DDR の観測制約を追記し、差分予測章（5.3）として棄却条件を明文化
- `scripts/summary/paper_tables.py`
  - Table 1 に「宇宙論（距離二重性）」行を追加
- `doc/paper/20_data_sources.md` / `doc/paper/30_references.md` / `doc/paper/01_figures_index.md`
  - DDRの一次ソース/図/参照の索引を追加

出力（追加/更新）：
- `output/cosmology/cosmology_distance_duality_constraints.png`
- `output/cosmology/cosmology_distance_duality_constraints_metrics.json`
- `output/summary/paper_table1_results.*`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`

再現：
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）
- `python -B scripts/summary/paper_build.py --mode publish`（Table 1＋HTML＋DOCX）


---

## 2026-01-08（UTC） Phase 12.1 補足：Table 1 の wave_f 表示を修正（70..300 Hz）

目的：
- Table 1 の GW 指標欄で `wave_f=70..300 Hz` の末尾ゼロが消え、`wave_f=7..3 Hz` のように見えてしまう表示を防ぐ。

変更：
- `scripts/summary/paper_tables.py`
  - `wave_f` の表示を小数1桁にして末尾ゼロ除去の挙動でも整数が保たれるように調整。

出力（更新）：
- `output/summary/paper_table1_results.*`
- `output/summary/pmodel_public_report.*` / `output/summary/pmodel_paper.*`（HTML/DOCX）

再現：
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）
- `python -B scripts/summary/paper_build.py --mode publish`（Table 1＋HTML＋DOCX）


---

## 2026-01-08（UTC） Phase 8.7：動的P（放射・波動）最小仮定の固定（四重極スケーリング図）

目的：
- 動的P（放射・波動）の章（論文2.6）の「観測量（Pdot_b / chirp）」を固定し、スケール感が伝わる図を追加する。

変更：
- `scripts/theory/dynamic_p_quadrupole_scalings.py`
  - 四重極則（Peters–Mathews / chirp時間）のスケーリングを可視化し、固定出力として保存
- `scripts/summary/run_all.py`
  - `theory_dynamic_p_quadrupole_scalings` を統一バッチへ追加
- `doc/paper/10_manuscript.md`
  - 動的P（2.6）にスケーリング図を追加（本文参照）
- `doc/paper/01_figures_index.md`
  - 図一覧へ追加
- `doc/P_model_handoff.md`
  - 動的P（最小仮定）の要点を追記

出力（追加/更新）：
- `output/theory/dynamic_p_quadrupole_scalings.png`
- `output/theory/dynamic_p_quadrupole_scalings_metrics.json`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`

再現：
- `python -B scripts/theory/dynamic_p_quadrupole_scalings.py`
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）
- `python -B scripts/summary/paper_build.py --mode publish`（Table 1＋HTML＋DOCX）


---

## 2026-01-08（UTC） Phase 8.8：二重パルサー（軌道減衰）をP-model（弱場四重極）として整理

目的：
- 二重パルサー（4.10）の比較指標 R を「観測/GR」表記から、「観測/P-model（弱場四重極）」として扱う形に統一し、論文・Table 1・公開レポートの表記を揃える。

変更：
- `data/pulsar/binary_pulsar_orbital_decay.json`
  - R の定義と注記を更新（一次ソース表記は観測/GRである旨を明記）
- `scripts/pulsar/binary_pulsar_orbital_decay.py`
  - 図のラベル/タイトルを「観測/P-model（四重極）」へ更新
- `scripts/summary/paper_tables.py`
  - Table 1 の二重パルサー行を「観測/P-model（四重極）」表記へ更新
- `doc/paper/10_manuscript.md`
  - 4.10（二重パルサー）の説明を「弱場四重極のP-model」基準へ更新
- `scripts/summary/public_dashboard.py`
  - 公開レポートの説明文を「観測/P-model（弱場四重極）」基準へ更新（一次ソース表記の注記を追加）

出力（更新）：
- `output/pulsar/binary_pulsar_orbital_decay.png` / `output/pulsar/binary_pulsar_orbital_decay_public.png`
- `output/summary/paper_table1_results.*`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`

再現：
- `python -B scripts/pulsar/binary_pulsar_orbital_decay.py`
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）
- `python -B scripts/summary/paper_build.py --mode publish`（Table 1＋HTML＋DOCX）


---

## 2026-01-08（UTC） Phase 8.9：GW150914 を「波形比較」へ拡張（位相/周波数/波形）

目的：
- 4.11（GW150914）を「周波数トラック＋位相fit」だけでなく、bandpass後の波形を単純モデル（四重極）テンプレートと重ねて比較できる形へ拡張する。

変更：
- `scripts/gw/gw150914_chirp_phase.py`
  - 追加出力：`gw150914_waveform_compare.png` / `gw150914_waveform_compare_public.png`
  - 波形比較の指標：match（正規化内積）と RMSE/RMS を metrics に追記
  - 既定パラメータを更新（track/window/f_range など）し、A>0・M_c有限を満たすfitのみ採用（満たさない場合は抽出法を切替）
- `scripts/summary/public_dashboard.py`
  - 公開レポートのGW150914カードを「波形比較」図へ差し替え、説明文も更新
- `scripts/summary/paper_tables.py`
  - Table 1 のGW150914行に match と wave window を追記
- `doc/paper/10_manuscript.md`
  - 4.11 に波形比較図を追加
- `doc/paper/01_figures_index.md`
  - 図一覧へ追加

出力（追加/更新）：
- `output/gw/gw150914_waveform_compare.png` / `output/gw/gw150914_waveform_compare_public.png`
- `output/gw/gw150914_chirp_phase_metrics.json`
- `output/summary/paper_table1_results.*`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`

再現：
- `python -B scripts/gw/gw150914_chirp_phase.py --offline`（キャッシュ後）
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）
- `python -B scripts/summary/paper_build.py --mode publish`（Table 1＋HTML＋DOCX）


---

## 2026-01-08（UTC） Phase 9.1：GW を多イベント対応へ拡張（GW151226 追加）

目的：
- Phase 9 の開始として、GWOSC の event JSON → strain 取得と解析を **多イベントで再現可能**な形へ一般化する。
- GW150914 以外（例：GW151226）でも同じ手順で chirp/波形比較を生成し、Table 1 と論文へ反映する。

変更：
- `scripts/gw/gw150914_chirp_phase.py`
  - `--event/--catalog/--version`（既定: `auto`）を追加し、v3→v2→v1 の自動フォールバックで event JSON を取得。
  - 出力名を `<event>_...` に一般化（既定: `output/gw/gw150914_*` を維持しつつ、`GW151226` 等も同形式で出力）。
- `scripts/summary/run_all.py`
  - `GW151226` の生成タスクを追加（任意、キャッシュがある場合にオフライン再現可能）。
- `scripts/summary/paper_tables.py`
  - Table 1 に `GW151226` 行を追加（metrics が存在する場合に集計）。
- `doc/paper/10_manuscript.md`
  - 4.11 に `GW151226` の補足図を追加。
- `doc/paper/01_figures_index.md`
  - 図一覧に `GW151226` を追記。
- 進捗・ロードマップ：
  - `doc/ROADMAP.md` / `doc/NEXT_STEPS.md` / `doc/STATUS.md` を更新し、Phase 9 を追加。

出力（追加/更新）：
- `output/gw/gw151226_chirp_phase.png` / `output/gw/gw151226_waveform_compare.png`（ほか `_public` と `*_metrics.json`）
- `output/summary/paper_table1_results.*`（GW151226 行を追加）
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`（補足図を反映）

再現：
- `python -B scripts/gw/gw150914_chirp_phase.py --event GW151226`（初回は online、以後は `--offline`）
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）
- `python -B scripts/summary/paper_build.py --mode publish`（Table 1＋HTML＋DOCX）


---

## 2026-01-08（UTC） Phase 9.2：二重パルサー（軌道減衰）を一次ソース入力から再計算（導出→比較）

目的：
- 二重パルサーの軌道減衰 `Pdot_b` を「文献の比Rを引用」ではなく、一次ソースの数値（`P_b`, `e`, `m1`, `m2`, `Pdot_b(int)`）から四重極則で再計算して **導出→比較**に寄せる。
- Table 1 と論文 4.10 の記述を「一次ソース入力→再計算→一致度R」へ統一する。

変更：
- `data/pulsar/binary_pulsar_orbital_decay.json`
  - schema v2：一次ソースの入力（軌道要素、質量、補正後 `Pdot_b(int)`、文献内の参照値）を追加し、PDFパスを明記。
- `scripts/pulsar/binary_pulsar_orbital_decay.py`
  - `Pdot_b(Peters–Mathews)` を `P_b,e,m1,m2` から再計算し、`R=Pdot_b(int)/Pdot_b(quad)` を自動導出。
  - metrics に導出値（`Pdot_b`/相対誤差/`R_paper` 等）を追記。
- `scripts/summary/paper_tables.py`
  - 95%表記の誤差を `sigma_95`（半幅）で表示するよう修正し、二重パルサー行の `data` を「一次ソースから再計算」に更新。
- `doc/paper/10_manuscript.md`
  - 4.10 に再計算の固定式（四重極則）を追記し、導出Rの数値を反映。

出力（追加/更新）：
- `output/pulsar/binary_pulsar_orbital_decay.png` / `output/pulsar/binary_pulsar_orbital_decay_public.png`
- `output/pulsar/binary_pulsar_orbital_decay_metrics.json`（導出値を拡張）
- `output/summary/paper_table1_results.*`（二重パルサー行の表記を更新）
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`（論文4.10を反映）
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`（Table 1 を反映）

再現：
- `python -B scripts/pulsar/binary_pulsar_orbital_decay.py`
- `python -B scripts/summary/run_all.py --offline`
- `python -B scripts/summary/paper_build.py --mode publish`


---

## 2026-01-08（UTC） Phase 9.3：宇宙論（Tolman表面輝度）一次ソース制約を追加（棄却条件の補強）

目的：
- Phase 8.5 の距離二重性（DDR）に加え、Tolman 表面輝度（SB dimming）の一次ソース制約を固定入力として取り込み、
  背景P（静的最小）の差分予測を「観測精度と同じ土俵」で評価できる形にする（ただし進化が系統）。

変更：
- `data/cosmology/tolman_surface_brightness_constraints.json`
  - 一次ソース（Lubin & Sandage 2001, DOI: 10.1086/322134）の有効指数 n（R/I band）を固定入力として追加。
- `data/cosmology/sources/arxiv_astro-ph_0106566.pdf`
  - 一次ソースPDFをリポジトリ内に保存（sha256 を JSON に記録）。
- `scripts/cosmology/cosmology_tolman_surface_brightness_constraints.py`
  - Tolman の一次ソース制約（n）を可視化し、FRW（n=4）/背景P静的（n=2）との差（zスコア）と、整合に必要な進化指数（n_model-n_obs）を出力。
- `scripts/summary/run_all.py`
  - Tolman 制約図の生成タスクを追加。
- `scripts/summary/public_dashboard.py`
  - 公開レポートに Tolman 一次ソース制約カードを追加（進化が系統である旨を明記）。
- `scripts/summary/paper_tables.py`
  - Table 1 に Tolman 行を追加（一次ソース n と差の目安を併記）。
- `doc/paper/10_manuscript.md`
  - 宇宙論節に Tolman 一次ソース制約を追記し、図を掲載。
- `doc/paper/01_figures_index.md` / `doc/paper/20_data_sources.md` / `doc/paper/30_references.md`
  - 図一覧・データ出典・参考文献を更新（新規引用キー：`[LubinSandage2001Tolman]`）。

出力（追加/更新）：
- `output/cosmology/cosmology_tolman_surface_brightness_constraints.png`
- `output/cosmology/cosmology_tolman_surface_brightness_constraints_metrics.json`
- `output/summary/paper_table1_results.*`（Tolman 行を追加）
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`（Tolmanカードを反映）
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`（本文追記を反映）

再現：
- `python -B scripts/cosmology/cosmology_tolman_surface_brightness_constraints.py`
- `python -B scripts/summary/run_all.py --offline`
- `python -B scripts/summary/paper_build.py --mode publish`


---

## 2026-01-08（UTC） Phase 10.1：重力波（GW）を追加イベント（GW170104）へ拡張

目的：
- Phase 9 の「2イベント」達成後も、同じ手順で再現できる事例を増やし、強場（GW）の多事例性を強化する。

変更：
- `data/gw/gw170104/`
  - GWOSC event JSON と strain（32秒, 4kHz）をキャッシュ（以後 `--offline` で再現可能）。
- `scripts/summary/run_all.py`
  - `GW170104` の生成タスクを追加（任意、キャッシュがある場合にオフライン再現可能）。
- `scripts/summary/paper_tables.py`
  - Table 1 の GW 行に `GW170104` を追加（metrics が存在する場合に集計）。
- `doc/paper/10_manuscript.md`
  - 4.11 の多イベント補足に `GW170104` を追加。
- `doc/paper/01_figures_index.md`
  - 図一覧に `GW170104` を追記。

出力（追加/更新）：
- `output/gw/gw170104_chirp_phase.png` / `output/gw/gw170104_waveform_compare.png`（ほか `_public` と `*_metrics.json`）
- `output/summary/paper_table1_results.*`（GW170104 行を追加）
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`（補足図を反映）

再現：
- `python -B scripts/gw/gw150914_chirp_phase.py --event GW170104`（初回は online、以後は `--offline`）
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）
- `python -B scripts/summary/paper_build.py --mode publish`（Table 1＋HTML＋DOCX）


---

## 2026-01-08（UTC） Phase 10.2：NS-WD 連星を追加し、放射（追加減衰）制約を拡張

目的：
- 二重パルサー（NS-NS）に加えて、質量差が大きく双極放射に敏感な **NS-WD 連星**を一次ソース起点で追加し、同一手順で比較できる状態にする。

変更：
- `data/pulsar/binary_pulsar_orbital_decay.json`
  - NS-WD 連星を2系追加：
    - PSR J1738+0333（Freire et al. 2012, arXiv:1205.1450）
    - PSR J0348+0432（Antoniadis et al. 2013, arXiv:1304.6875）
  - Pb/e/m/Pdot_b と補正項を固定し、`scripts/pulsar/binary_pulsar_orbital_decay.py` が `Pdot_b(quad)` と `R` を自動導出できる形に整備。
- `doc/paper/10_manuscript.md`
  - 4.10 に NS-WD 連星（J1738/J0348）を追記（`R` と概算の追加放射上限）。
- `doc/paper/20_data_sources.md` / `doc/paper/30_references.md`
  - NS-WD 連星の一次ソース（DOI/参照日）を追記。
- `scripts/summary/paper_tables.py`
  - Table 1 のパルサー行を「連星パルサー」に表記更新（NS-WDも含むことを明確化）。

出力（更新）：
- `output/pulsar/binary_pulsar_orbital_decay.png` / `output/pulsar/binary_pulsar_orbital_decay_public.png`
- `output/pulsar/binary_pulsar_orbital_decay_metrics.json`
- `output/summary/paper_table1_results.*`（パルサー行の詳細が更新）
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`

再現：
- `python -B scripts/pulsar/binary_pulsar_orbital_decay.py`
- `python -B scripts/summary/run_all.py --offline --docx-orientation landscape`
- `python -B scripts/summary/paper_build.py --mode publish --docx-orientation landscape`


---

## 2026-01-08（UTC） Phase 10.3：BNS（GW170817）を追加し、窓/帯域/指標のロバスト性を確認

目的：
- BH-BH（GW150914 など）に加えて、信号が長く弱い BNS（GW170817）でも同じ枠組みで比較できることを確認する。
- 周波数トラック抽出が不安定になりやすいケースに対し、前処理（ホワイトニング等）と指標の固定で再現性を上げる。

変更：
- `data/gw/gw170817/`
  - GWOSC event JSON と strain（32秒, 4kHz）をキャッシュ（以後 `--offline` で再現可能）。
- `scripts/gw/gw150914_chirp_phase.py`
  - GW170817 向けにホワイトニング（Welch+FFT）と guided STFT（Mcグリッド探索＋周波数追跡）を追加し、BNSでも周波数トラックが安定するよう強化。
  - 生成JSONに `whiten` / `stft_guided` / `preprocess` など実行条件を明示。
- `scripts/summary/run_all.py`
  - `GW170817` の生成タスクを追加（任意、キャッシュがある場合にオフライン再現可能）。
- `scripts/summary/paper_tables.py`
  - Table 1 の GW 行に `GW170817` を追加（metrics が存在する場合に集計）。
- `scripts/summary/public_dashboard.py`
  - 公開レポートの GW サマリを「複数イベント（GW150914/GW151226/GW170104/GW170817）」として要約。
- `scripts/summary/html_to_docx.py`
  - WordのHTML変換で発生し得る floating Shape（横並び画像など）も枠内に収まるよう自動リサイズを追加。
- `doc/paper/10_manuscript.md` / `doc/paper/01_figures_index.md`
  - 4.11 の多イベント補足に `GW170817` を追記し、図一覧にも追加。

出力（追加/更新）：
- `output/gw/gw170817_chirp_phase.png` / `output/gw/gw170817_waveform_compare.png`（ほか `_public` と `*_metrics.json`）
- `output/summary/paper_table1_results.*`（GW170817 行を追加）
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`（GWサマリ更新、DOCXは枠内フィットを強化）
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`（4.11補足へ反映）

再現：
- `python -B scripts/gw/gw150914_chirp_phase.py --event GW170817 --offline --whiten --stft-guided --f-lo 70 --f-hi 800 --track-window=-5,-0.1 --track-frange=70,500 --wave-window=-2,-0.2 --stft-nperseg 2048 --stft-noverlap 1792`
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）
- `python -B scripts/summary/paper_build.py --mode publish`（Table 1＋HTML＋DOCX）


---

## 2026-01-08（UTC） Phase 11.1：GW多イベント結果を要約図（R^2/match）で1枚化

目的：
- 一般向けに「複数イベントで同じ手順が動く」ことを、数値と図で一目で確認できる形にする。
- Table 1 の GW 行と同じ入力（`output/gw/*_chirp_phase_metrics.json`）から、要約図を再生成できるよう固定出力にする。

変更：
- `scripts/gw/gw_multi_event_summary.py`
  - `output/gw/*_chirp_phase_metrics.json` を集計し、R^2 と match の要約図（PNG）と集計JSONを出力。
- `scripts/summary/run_all.py`
  - `gw_multi_event_summary` タスクを追加（`run_all` で自動生成）。
- `scripts/summary/public_dashboard.py`
  - 公開レポートに「重力波：複数イベントの要約」カードを追加。
  - 波形カードは「代表例: GW150914」に整理。
- `scripts/summary/paper_build.py`
  - 論文ビルド時に要約図を事前生成（欠損時もプレースホルダを出し、HTML埋め込みで落ちないようにする）。
- `doc/paper/10_manuscript.md` / `doc/paper/01_figures_index.md`
  - 4.11 に要約図を追記し、図一覧にも追加。

出力（追加/更新）：
- `output/gw/gw_multi_event_summary.png` / `output/gw/gw_multi_event_summary_public.png`
- `output/gw/gw_multi_event_summary_metrics.json`
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`

再現：
- `python -B scripts/gw/gw_multi_event_summary.py`
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）
- `python -B scripts/summary/paper_build.py --mode publish`（Table 1＋HTML＋DOCX）


---

## 2026-01-08（UTC） Phase 11.2：BNSをもう1イベント（GW190425）追加して適用限界を確認

目的：
- GW170817 に加えて別の BNS（GW190425）も同一手順に投入し、指標（R^2/match）が安定に出るか確認する。
- GWTC-1 以外（GWTC-2.1）のイベントでも、同じパイプライン（キャッシュ→`--offline`）で再現できることを確認する。

変更：
- `data/gw/gw190425/`
  - GWOSC event JSON と strain（32秒, 4kHz）をキャッシュ（以後 `--offline` で再現可能）。
- `scripts/summary/run_all.py`
  - `GW190425` の生成タスクを追加（任意、キャッシュがある場合にオフライン再現可能）。
- `scripts/summary/paper_tables.py`
  - Table 1 の GW 行に `GW190425` を追加（metrics が存在する場合に集計）。
- `scripts/summary/public_dashboard.py` / `scripts/gw/gw_multi_event_summary.py`
  - 複数イベント要約の対象に `GW190425` を追加。
- `doc/paper/10_manuscript.md` / `doc/paper/01_figures_index.md`
  - 4.11 の多イベント補足に `GW190425` を追記し、図一覧にも追加。

出力（追加/更新）：
- `output/gw/gw190425_chirp_phase.png` / `output/gw/gw190425_waveform_compare.png`（ほか `_public` と `*_metrics.json`）
- `output/gw/gw_multi_event_summary.png`（GW190425 を含む形で更新）
- `output/summary/paper_table1_results.*`（GW190425 行を追加）

再現：
- `python -B scripts/gw/gw150914_chirp_phase.py --event GW190425 --catalog GWTC-2.1-confident --version auto --detectors H1,L1,V1 --whiten --stft-guided --f-lo 70 --f-hi 800 --track-window=-5,-0.1 --track-frange=70,500 --wave-window=-2,-0.2 --stft-nperseg 2048 --stft-noverlap 1792`
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）
- `python -B scripts/summary/paper_build.py --mode publish`（Table 1＋HTML＋DOCX）


---

## 2026-01-08（UTC） Phase 11.3：波形比較（match）の窓を自動調整し、失敗理由を出力

目的：
- イベントによって `t_c` が `t_event` より前に出る場合があり、固定の `wave_window` が `t_c` より後ろになると match が未生成になる問題を解消する。
- 複数イベント要約（R^2/match）で欠損が出ないようにし、失敗時も “理由付き” で追跡できる状態にする。

変更：
- `scripts/gw/gw150914_chirp_phase.py`
  - `wave_window` が `t_c` より後ろにある場合、同じ長さの窓を `t_c-ε` で終わるよう自動シフトして match を算出。
  - `*_metrics.json` の `waveform_fit` に `ok/reason` を併記し、失敗理由を機械可読で残す。
  - 失敗時の波形図にも理由（reason）を表示。
- `scripts/summary/paper_tables.py`
  - GW行のデータ欄を「検出器はイベントにより異なる」に更新。
  - `wave_window` が検出器ごとに自動調整された場合は、Table 1 の指標欄に **実際に使った wave 窓**（detector別）を出す。

出力（更新）：
- `output/gw/gw151226_chirp_phase_metrics.json`（matchが欠損しない、wave窓が `t_c` 以前へ自動調整）
- `output/gw/gw_multi_event_summary.png` / `output/gw/gw_multi_event_summary_public.png`（match欠損が減る）
- `output/summary/paper_table1_results.*`（GW151226 の match を反映）
- `output/summary/pmodel_public_report.*` / `output/summary/pmodel_paper.*`（HTML/DOCX）

再現：
- `python -B scripts/gw/gw150914_chirp_phase.py --event GW151226 --offline`
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）
- `python -B scripts/summary/paper_build.py --mode publish`（Table 1＋HTML＋DOCX）


---

## 2026-01-08（UTC） Phase 12.1：match窓を周波数帯で固定（70-300 Hz）

目的：
- `wave_window`（時間）だとイベント間で match を比較しにくいため、周波数帯を固定し、その帯域に対応する時刻範囲で match を計算する。
- 指標（Table 1）と要約図で「同じ前提」を明示し、オフライン再現性を維持する。

変更：
- `scripts/gw/gw150914_chirp_phase.py`
  - `--wave-frange` を追加し、`t=t_c-A f^(-8/3)` から波形比較窓（時刻）を自動算出。
  - `*_chirp_phase_metrics.json` に `wave_frange_hz` と `wave_window_policy` を記録。
- `scripts/summary/run_all.py`
  - GW各イベントに `--wave-frange=70,300` を付与（BNSは `track-window` を `-6..-0.1` に拡張）。
- `scripts/gw/gw_multi_event_summary.py`
  - `wave_frange_hz` を読み取り、軸ラベル/注記に表示（分かる場合）。
- `scripts/summary/paper_tables.py`
  - Table 1 の GW 行に `wave_f` を併記し、match の比較前提を明示。
- `scripts/summary/public_dashboard.py`
  - 公開レポートのGW説明文に match 窓（70..300 Hz）を追記。

出力（更新）：
- `output/gw/*_chirp_phase_metrics.json`（`params.wave_frange_hz` 等）
- `output/gw/gw_multi_event_summary*.png`（match軸/注記）
- `output/summary/paper_table1_results.*`（GW指標欄）
- `output/summary/pmodel_public_report.*` / `output/summary/pmodel_paper.*`（HTML/DOCX）

再現：
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）
- `python -B scripts/summary/paper_build.py --mode publish`（Table 1＋HTML＋DOCX）


---

## 2026-01-08（UTC） Phase 12.1 補足：Table 1 の wave_f 表示を修正（70..300 Hz）

目的：
- Table 1 の GW 指標欄で `wave_f=70..300 Hz` の末尾ゼロが消え、`wave_f=7..3 Hz` のように見えてしまう表示を防ぐ。

変更：
- `scripts/summary/paper_tables.py`
  - `wave_f` の表示を小数1桁にして末尾ゼロ除去の挙動でも整数が保たれるように調整。

出力（更新）：
- `output/summary/paper_table1_results.*`
- `output/summary/pmodel_public_report.*` / `output/summary/pmodel_paper.*`（HTML/DOCX）

再現：
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）
- `python -B scripts/summary/paper_build.py --mode publish`（Table 1＋HTML＋DOCX）


---

## 2026-01-09（UTC） Phase 14.2.2：DDRの一次ソース制約を追加（SNIa+H(z)）し、Table 1 は「最強制約1行」に維持

目的：
- DDR（ε0）について「現在データ1本」だけだと、“観測精度の問題か？”の議論が曖昧になるため、別手法の一次ソース制約を追加して比較可能にする。
- ただし Table 1 は「検証テーマの一覧（固定行数）」として扱うため、DDRは **複数ソースを図/JSONに保持しつつ、Table 1 には最も厳しい制約1行のみ**を載せる。

変更：
- `data/cosmology/distance_duality_constraints.json`
  - 追加：Avgoustidis+2010（SNIa+H(z)）の ε 制約（95%CLを1σへ対称化近似）を入力に追加。
  - 一次ソースPDFを `data/cosmology/sources/arxiv_1004.2053.pdf` として保存（sha256を記録）。
- `scripts/summary/paper_tables.py`
  - DDR行は `rows` 全部を列挙せず、`epsilon0_sigma` が最小の “primary” だけを Table 1 に載せるよう修正（Table 1 の行数を維持）。
- `scripts/summary/validation_scoreboard.py`
  - スコアボードの宇宙論（DDR）行も “最強制約” を自動選択するよう修正。
- `scripts/cosmology/cosmology_reconnection_parameter_space.py`
  - パラメータ空間図は `epsilon0_sigma` が最小の制約を primary として採用するよう修正。

出力（更新）：
- `output/cosmology/cosmology_distance_duality_constraints.*`（観測バンドが複数になる）
- `output/summary/paper_table1_results.*`（行数=27を維持）
- `output/summary/validation_scoreboard.*`
- `output/summary/pmodel_public_report.*` / `output/summary/pmodel_paper.*`（HTML/DOCX）

再現：
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）


---

## 2026-01-09（UTC） Phase 13.2/14.2：スコアボードの例外規定（policy）固定＋宇宙論DDRの“必要補正”をTable 1へ明示

目的：
- 総合スコアボードの色分け（OK/要改善/不一致）が、宇宙論/EHT/GW など「系統・仮定が支配的な項目」で誤読されないよう、例外規定（注意書き）を機械可読の policy として固定する（Phase 13.2）。
- 宇宙論（DDR）の“静的無限空間で再接続する場合に必要となる補正量”を、Table 1（かんたん解釈）側でも読める表現（z=1でのΔμ/τ）へ拡張する（Phase 14.2）。

変更：
- `scripts/summary/validation_scoreboard.py`
  - `policy.exceptions` を追加（宇宙論/EHT/GW の注意書きを固定）。
  - 宇宙論（DDR）の要約行に、z=1での D_L 倍率に加えて Δμ と等価 τ を併記。
- `scripts/summary/public_dashboard.py`
  - 総合スコアボードのカードに Table 1 の OK率/OK+要改善（%）を併記。
  - policy.exceptions を踏まえ、宇宙論/EHT の注意を説明文に追記。
- `scripts/summary/paper_tables.py`
  - 宇宙論（DDR）の `metric_public` を「z=1でD_L×...（Δμ..., τ...）」の形に更新。

出力（更新）：
- `output/summary/validation_scoreboard.png` / `output/summary/validation_scoreboard.json`
- `output/summary/paper_table1_results.*`（Table 1）
- `output/summary/pmodel_public_report.*` / `output/summary/pmodel_paper.*`（HTML/DOCX）

再現：
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）


---

## 2026-01-09（UTC） Phase 14.2：宇宙論（DDR）の「再接続」パラメータ空間（不透明度/進化）を可視化して固定出力

目的：
- 「静的無限空間（ビッグバン無し）＋背景Pで赤方偏移」を採る場合、DDRの棄却（ε0=-1）が示しているのは
  “距離指標（標準光源/標準定規）の前提が不変”という仮定が成り立ちにくい点である。
- そこで、再接続の候補（不透明度 α / 光源進化 s_L / 定規進化 s_R）を同じ式で整理し、
  **どの組合せなら ε0 を回復できるか**（zスコアの等高線）を出力に固定して、次の一次ソース詰め（どれが現実的か）の入口にする。

変更：
- `scripts/cosmology/cosmology_reconnection_parameter_space.py`
  - DDRの ε0 制約に対し、(α, s_R) / (α, s_L) / (s_R, s_L) の3スライスで zスコア地図を生成。
  - 単一機構（opacity_only / ruler_only / candle_only）の代表解を JSON に併記（z=1でのΔμ/τなどの直感量つき）。
- `scripts/summary/run_all.py`
  - 上記スクリプトを `cosmology_reconnection_parameter_space` としてパイプラインに追加。
- `doc/paper/01_figures_index.md`
  - 宇宙論セクションに `output/cosmology/cosmology_reconnection_parameter_space.png` を追加（図番号自動付与対象）。
- `doc/paper/10_manuscript.md`
  - 宇宙論（2.5/5.3）にパラメータ空間図の参照を追加（「候補は一意でない」ことを明示）。

出力（追加/更新）：
- `output/cosmology/cosmology_reconnection_parameter_space.png`
- `output/cosmology/cosmology_reconnection_parameter_space_metrics.json`
- `output/summary/pmodel_public_report.*` / `output/summary/pmodel_paper.*`（HTML/DOCX、図表一覧に反映）

再現：
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）
- `python -B scripts/summary/paper_build.py --mode publish`（HTML+DOCX）


---

## 2026-01-09（UTC） Phase 15.3 準備（追補）：存在しない検出器を event_list から除外

目的：
- `strain_not_available` のノイズ（指定したが一次データ側に存在しない検出器）を減らし、Step 15.3（既定値調整）で見るべき `fit_failed` に焦点を当てる。

変更：
- `data/gw/event_list.json`
  - GW190425: detectors を `L1,V1` に修正（H1は一次データに存在しない）。
  - GW191216_213338: detectors を `H1,V1` に修正（L1は一次データに存在しない）。

出力（更新）：
- `output/gw/gw190425_chirp_phase_metrics.json` / `output/gw/gw191216_213338_chirp_phase_metrics.json`（skipped_detectorsから `strain_not_available` が消える）
- `output/gw/gw_event_list_diagnostics.json`（`strain_not_available=0`）

再現：
- `python -B scripts/gw/gw150914_chirp_phase.py --event GW190425 --catalog GWTC-2.1-confident --detectors L1,V1 --whiten --stft-guided --f-lo=70 --f-hi=800 --track-window=-6,-0.1 --track-frange=70,500 --wave-window=-2,-0.2 --wave-frange=70,300 --stft-nperseg=2048 --stft-noverlap=1792 --offline`
- `python -B scripts/gw/gw150914_chirp_phase.py --event GW191216_213338 --catalog GWTC-3-confident --detectors H1,V1 --wave-frange=70,300 --offline`
- `python -B scripts/gw/gw_event_list_diagnostics.py`


---

## 2026-01-09（UTC） Phase 15.2：GWイベントに SNR/FAR メタ情報を付与し、要約図に併記

目的：
- “強いイベントほど合う/崩れる” の傾向確認のため、GWイベントごとの強さ指標（SNR）と信頼度指標（FAR）をイベント一覧に持たせ、複数イベント要約図に併記する。
- オフライン再現性を崩さず、GWOSCのイベントJSON（一次ソース）に基づく固定メタ情報として扱えるようにする。

変更：
- `data/gw/event_list.json`
  - 各イベントに `meta` を追加（`network_snr`, `far_yr`, `p_astro`）。
- `scripts/gw/gw_multi_event_summary.py`
  - `data/gw/event_list.json` の `meta` を読み取り、要約図の x ラベルへ併記（論文図は SNR+FAR、public図は SNR のみ）。
  - `*_metrics.json` に `event_meta` を追記して、図の前提（メタ情報）を機械可読で固定。

出力（更新）：
- `output/gw/gw_multi_event_summary.png`（SNR+FARを併記）
- `output/gw/gw_multi_event_summary_public.png`（SNRを併記）
- `output/gw/gw_multi_event_summary_metrics.json`（`event_meta` を追記）
- `output/summary/pmodel_public_report.*` / `output/summary/pmodel_paper.*`（HTML/DOCX 再生成）

再現：
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）
- `python -B scripts/summary/paper_build.py --mode publish`（Table 1＋HTML＋DOCX）


---

## 2026-01-09（UTC） Phase 15.3 準備：fit_failed を検出器別に集計して可視化入口を作る

目的：
- Step 15.3（検出器ごとの失敗を減らす既定値調整）に向けて、まず現状の失敗（fit_failed / strain_not_available 等）を **検出器別** に集計できるようにする。

変更：
- `scripts/gw/gw_event_list_diagnostics.py`
  - `output/gw/*_chirp_phase_metrics.json` の `skipped_detectors` を読み取り、イベントごとの `detector_stats` と、全体集計 `detectors.skipped_by_reason / skipped_by_detector` を追加。

出力（更新）：
- `output/gw/gw_event_list_diagnostics.json`（検出器別のskip理由集計を追加）

再現：
- `python -B scripts/summary/run_all.py --offline`（metrics生成）
- `python -B scripts/gw/gw_event_list_diagnostics.py`


---

## 2026-01-09（UTC） Step 14.2.22：距離指標の再導出候補探索（一次ソース拘束＋独立プローブ＋BAO自己整合）

目的：
- 静的背景P（最小: ε0=-1）で DDR を回復する「再導出候補」が、一次ソース拘束と独立プローブ（SN time dilation, CMB T(z)）と BAO自己整合（BOSS DR12 fitの s_R）を同時に満たせるかを探索し、現状の成立条件を固定する。

変更：
- `scripts/cosmology/cosmology_distance_indicator_rederivation_candidate_search.py`
  - DDR（複数ε0）×（不透明度α候補）×（標準光源進化s_L候補）の組合せを走査し、WLSで同時整合（max|z|）を評価。
  - best_any（候補全体から最小max|z|）と、best_independent（BAO/CMB/CDDR依存を避けた候補）を併記。
- `scripts/summary/run_all.py`
  - 上記スクリプトを `cosmology_distance_indicator_rederivation_candidate_search` として追加。
- 論文反映：
  - `doc/paper/10_manuscript.md` に図への参照と簡単な説明を追加。
  - `doc/paper/01_figures_index.md` に固定パスを追加。

出力（追加）：
- `output/cosmology/cosmology_distance_indicator_rederivation_candidate_search.png`
- `output/cosmology/cosmology_distance_indicator_rederivation_candidate_search_metrics.json`

再現：
- `python -B scripts/summary/run_all.py --offline`
- `python -B scripts/cosmology/cosmology_distance_indicator_rederivation_candidate_search.py`


---

## 2026-01-09（UTC） Step 14.2.23：再導出候補マトリクス（α×s_L）で“どの一次ソース組が効くか”を可視化

目的：
- Step 14.2.22 の best だけでは「どの一次ソース拘束の組合せが整合/不一致を決めているか」が見えにくいため、
  代表DDR（BAO含む/なし）について、(不透明度α候補 × 標準光源進化s_L候補) の全組合せで max|z| を計算し、ヒートマップで固定する。

変更：
- `scripts/cosmology/cosmology_distance_indicator_rederivation_candidate_matrix.py`
  - 代表DDR（SNIa+BAO / Clusters+SNIa）について、全組合せの max|z| をヒートマップ化（枠線=independent）。
- `scripts/summary/run_all.py`
  - 上記スクリプトを `cosmology_distance_indicator_rederivation_candidate_matrix` として追加。
- 論文反映：
  - `doc/paper/10_manuscript.md` に図参照を追加。
  - `doc/paper/01_figures_index.md` に固定パスを追加。

出力（追加）：
- `output/cosmology/cosmology_distance_indicator_rederivation_candidate_matrix.png`
- `output/cosmology/cosmology_distance_indicator_rederivation_candidate_matrix_metrics.json`

再現：
- `python -B scripts/summary/run_all.py --offline`
- `python -B scripts/cosmology/cosmology_distance_indicator_rederivation_candidate_matrix.py`


---

## 2026-01-09（UTC） Step 14.2.21：距離指標の再導出要件を固定（DDR再接続：捨てる/置き換える対象の整理）

目的：
- 静的背景P（最小: ε0=-1）と DDR 制約の差（必要補正 Δε）について、「誤差で隠せる上限（z_limit）」と「単独機構の張力」を踏まえ、
  距離指標（SNe Ia/BAO/DDR）のどの前提を P-model 側で再導出すべきかを 1枚に固定する。

変更：
- `scripts/cosmology/cosmology_distance_indicator_rederivation_requirements.py`
  - 既存 metrics（到達限界・誤差予算感度・再接続の張力）を読み、再導出/置換が必要な前提（標準光源/標準定規/光子保存/校正/独立プローブ）を図として固定。
- `scripts/summary/run_all.py`
  - 上記スクリプトを `cosmology_distance_indicator_rederivation_requirements` として追加。
- 論文反映：
  - `doc/paper/10_manuscript.md` に図への参照を追加。
  - `doc/paper/01_figures_index.md` に固定パスを追加。

出力（追加）：
- `output/cosmology/cosmology_distance_indicator_rederivation_requirements.png`
- `output/cosmology/cosmology_distance_indicator_rederivation_requirements_metrics.json`

再現：
- `python -B scripts/summary/run_all.py --offline`
- `python -B scripts/cosmology/cosmology_distance_indicator_rederivation_requirements.py`（依存する metrics が必要）


---

## 2026-01-09（UTC） Step 14.2.15：距離指標の“誤差予算”を一次ソースで設定（Pantheon + BOSS DR12）

目的：
- ユーザー懸念（「観測方法の確認距離に限界がある可能性」）に対し、距離指標（SNe Ia / BAO）の **観測不確かさ（誤差予算）** を z 依存で定量化し、
  静的背景P最小（DDR: ε0=-1）を“隠す”のに必要な距離補正 |Δμ(z)| が、どの z まで「観測の不確かさに埋もれ得るか（z_limit）」を固定する。

変更：
- `scripts/cosmology/cosmology_distance_indicator_error_budget.py`
  - Pantheon lcparam の `dmb`（m_Bの誤差）を距離モジュラス誤差の代理として z binning（bin幅=0.1）。
  - `median(dmb)`（1点誤差の目安）と、逆分散重み付き `SEM=1/sqrt(sum(1/σ^2))`（bin平均誤差の目安）を算出。
  - BOSS DR12 の `D_M` 相対誤差を等価Δμへ変換し、`SEM⊕BAO` / `median dmb⊕BAO` の2系統（opt/cons）で誤差予算を構成。
  - 少数binの外挿で誤解を生まないよう、`--sn-min-points`（デフォ 15）を導入し、有効な SNe 範囲（z_max_with_budget）を図とmetricsに明示。
- `scripts/summary/run_all.py`
  - 上記スクリプトを `cosmology_distance_indicator_error_budget` として一括再生成へ統合（offlineで完走）。

出力（追加/更新）：
- `output/cosmology/cosmology_distance_indicator_error_budget.png`
- `output/cosmology/cosmology_distance_indicator_error_budget_metrics.json`
  - 例：`sn_max_z_with_budget≈0.95（n≥15）`, `bao_max_z≈0.61`
  - 例：SNIa+BAO代表（ε0≈0.013±0.029）での z_limit（opt=SEM⊕BAO）: 1σ z≈0.013 / 3σ z≈0.044（詳細は metrics 参照）

一次ソース（入力）：
- Pantheon lcparam（Scolnic et al. 2018）：`data/cosmology/pantheon_lcparam_full_long.txt`
- BOSS DR12（距離プロダクト）：`data/cosmology/alcock_paczynski_constraints.json`
- Planck r_drag（校正スケール）：`data/cosmology/bao_sound_horizon_constraints.json`

再現：
- `python -B scripts/cosmology/cosmology_distance_indicator_error_budget.py`
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCXまで再生成）


---

## 2026-01-09（UTC） Step 14.2.16：距離指標の誤差予算を堅牢化（Pantheon sys共分散の導入）

目的：
- Step 14.2.15 の「誤差予算（目安）」を、Pantheon 公開の **系統共分散（sys_full_long）** を取り込むことで上限/下限のレンジとして表現し、
  z_limit（どこまで“隠れ得るか”）を **stat-only ↔ stat+sys** の幅で固定する。

変更：
- `data/cosmology/pantheon_sys_full_long.txt`（一次ソースデータを固定）
  - Pantheon 公開（GitHub）の sys covariance を保存（N=1048 の共分散, mag^2）。
- `scripts/cosmology/cosmology_distance_indicator_error_budget.py`
  - `sys_full_long` を読み込み、全共分散 `C_total = diag(dmb^2) + C_sys` を構成。
  - bin平均の誤差を、相関込みの `SEM = 1/sqrt(1^T C_total^{-1} 1)` で算出し、図では stat-only との間を帯（fill）で表示。
  - metrics JSON に `reach_limits_total`（stat+sys）を追加し、z_limit をレンジで追跡可能にした。

出力（更新）：
- `output/cosmology/cosmology_distance_indicator_error_budget.png`（SEM⊕BAO の 1σ/3σ を stat↔sys帯で表示）
- `output/cosmology/cosmology_distance_indicator_error_budget_metrics.json`
  - `inputs.pantheon_sys_cov*`（sha256/取得URL）と `summary.reach_limits_total` を追加。

一次ソース（入力）：
- Pantheon sys covariance（Scolnic et al. 2018 公開データ）：`data/cosmology/pantheon_sys_full_long.txt`
  - 取得元：`https://raw.githubusercontent.com/dscolnic/Pantheon/master/sys_full_long.txt`

再現：
- `python -B scripts/cosmology/cosmology_distance_indicator_error_budget.py`
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）


---

## 2026-01-09（UTC） Step 14.2.17：距離指標の誤差予算を拡張（BAO側の共分散：Table 8 reduced covariance）

目的：
- Step 14.2.16 で SNe Ia 側（Pantheon）の **stat↔sys** レンジを固定したのに対し、BAO 側も「3点（z=0.38/0.51/0.61）の誤差が独立ではない」点を反映し、
  BAOの z 依存（補間）の誤差目安を **相関込み** で見積もれるようにする。

変更：
- `data/cosmology/boss_dr12_baofs_consensus_reduced_covariance_cij.json`
  - 一次ソース（Alam+2017; BOSS DR12）の Table 8（BAO+FS consensus）の reduced covariance `c_ij`（10^4倍）を転記し、対称行列として固定保存。
- `scripts/cosmology/cosmology_distance_indicator_error_budget.py`
  - `--boss-baofs-cov-cij` を追加（既定：上記JSON）。
  - Table 8 の `c_ij` と各 `σ(D_M)` から `Cov(D_M)` を復元し、`D_M(z)` を2点線形補間したときの誤差伝播で `σ(D_M(z))` を推定（目安）。
  - 図に「BAO: 共分散を用いた補間（目安）」の点線を追加し、metrics JSON に `summary.bao_covariance`（DM相関/共分散）を追加。
- `doc/paper/20_data_sources.md` / `doc/paper/10_manuscript.md`
  - BAO側の共分散（Table 8）の利用を明記。

出力（更新）：
- `output/cosmology/cosmology_distance_indicator_error_budget.png`
- `output/cosmology/cosmology_distance_indicator_error_budget_metrics.json`
- （再生成）`output/summary/pmodel_public_report.html` / `.docx`、`output/summary/pmodel_paper.html` / `.docx`

再現：
- `python -B scripts/cosmology/cosmology_distance_indicator_error_budget.py`
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）


---

## 2026-01-09（UTC） Step 14.2.18：距離指標の誤差予算の感度比較（Pantheon vs Pantheon+）

目的：
- Step 14.2.16/14.2.17 で「距離指標の誤差予算（目安）」を Pantheon（lcparam）+ BOSS DR12 に基づいて固定したが、
  その推定が **SNeサンプル**（Pantheon vs Pantheon+）や **共分散の扱い**（diag-only vs full covariance）でどれだけ動くかを定量化する。
- ユーザーの仮説（“距離指標の前提が到達限界を作っている”）に対し、少なくとも「データサンプル差」だけでは z_limit が大きくは動かない/動き得る範囲を見える化する。

変更：
- Pantheon+ の一次データを追加（データリリースの固定キャッシュ）：
  - `data/cosmology/pantheonplus_sh0es.dat`（距離（μ））
  - `data/cosmology/pantheonplus_sh0es_statonly.cov`（STATONLY covariance）
  - `data/cosmology/pantheonplus_sh0es_stat_sys.cov`（STAT+SYS covariance）
  - 参照PDF：`data/cosmology/sources/arxiv_2202.04077.pdf`（Brout+ 2022）
- `scripts/cosmology/cosmology_distance_indicator_error_budget_sensitivity.py`
  - Pantheon と Pantheon+ の誤差予算を同一の枠組み（SNe⊕BAO⊕r_drag）で計算し、`z_limit` の感度（SEMベース）を比較する図を追加。
  - Pantheon+ は diag（可視化用途）に加え、full covariance から bin平均の SEM（相関込み）を算出して比較する。
- `scripts/summary/run_all.py`
  - 上記スクリプトを `cosmology_distance_indicator_error_budget_sensitivity` として追加し、run_all で自動生成するようにした。
- 論文反映：
  - `doc/paper/10_manuscript.md` に感度図への参照を追加。
  - `doc/paper/01_figures_index.md` に固定パスを追加。
  - `doc/paper/20_data_sources.md` / `doc/paper/30_references.md` に Pantheon+（Brout+ 2022 / DataRelease）を追記。

出力（追加）：
- `output/cosmology/cosmology_distance_indicator_error_budget_sensitivity.png`
- `output/cosmology/cosmology_distance_indicator_error_budget_sensitivity_metrics.json`

再現：
- `python -B scripts/cosmology/cosmology_distance_indicator_error_budget_sensitivity.py`
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）


---

## 2026-01-09（UTC） Step 14.2.19：距離指標の前提を分離（Pantheon+：CID重複 / SH0ES HF限定 / 共分散モード）→ z_limit 上限

目的：
- Step 14.2.18 の感度図を拡張し、Pantheon+ の「距離指標の前提」の違いで `z_limit` がどれだけ動き得るか（上限）を整理する。
  - CID重複（同一SNの複数サーベイ測光）
  - SH0ES HF（`USED_IN_SH0ES_HF==1`）限定
  - 共分散モード（diag-only vs full covariance）

変更：
- `scripts/cosmology/cosmology_distance_indicator_error_budget_sensitivity.py`
  - Pantheon+ の追加シナリオを実装：
    - CID重複除去（1行=1SNの近似。CIDごとに最小σの行を採用）
    - SH0ES HF 限定（`USED_IN_SH0ES_HF==1`）
    - HF+CID（HF限定の上でCID重複除去）
  - 代表制約（BAO含む/なし）ごとに、シナリオ間の `z_limit` 上限（envelope）を `*_metrics.json` に出力。
- `doc/paper/10_manuscript.md`
  - 感度図の説明に「CID重複 / SH0ES HF」も含む旨を追記。

主要数値（SEMベース, opt_total の envelope）：
- BAOなし代表制約（least rejecting）の 3σ `z_limit`：HF限定により **0.1746 → 0.2014** へ増加（目安）

出力（更新）：
- `output/cosmology/cosmology_distance_indicator_error_budget_sensitivity.png`
- `output/cosmology/cosmology_distance_indicator_error_budget_sensitivity_metrics.json`（`envelope` とシナリオ別の counts を追加）

再現：
- `python -B scripts/cosmology/cosmology_distance_indicator_error_budget_sensitivity.py`
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）


---

## 2026-01-09（UTC） Step 14.2.20：距離指標の誤差予算の上限評価（bin幅/最低点数スキャン）

目的：
- Step 14.2.19 で `z_limit` の上限（envelope）を整理したが、bin幅や最低点数の選び方でも `SEM` が変わるため、
  SH0ES HF サブサンプルに対して **binning をスキャン**し、`z_limit` 上限の感度（最大値）を固定する。

変更：
- `scripts/cosmology/cosmology_distance_indicator_error_budget_sensitivity.py`
  - SH0ES HF（`USED_IN_SH0ES_HF==1`）に対して、`bin_width`×`sn_min_points` の小さなグリッドを走査し、
    no-BAO代表の `z_limit`（opt_total 3σ）のヒートマップを生成する処理を追加。

結果（スキャン範囲内）：
- 最大：no-BAO代表の `z_limit`（opt_total 3σ）≈ **0.2014**（bin_width=0.05, sn_min_points=8）

出力（追加）：
- `output/cosmology/cosmology_distance_indicator_error_budget_sensitivity_scan.png`
- `output/cosmology/cosmology_distance_indicator_error_budget_sensitivity_metrics.json`（`scan` を追加）

再現：
- `python -B scripts/cosmology/cosmology_distance_indicator_error_budget_sensitivity.py`
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）


---

## 2026-01-09（UTC） Step 14.2.13：距離指標の“到達限界”を定量化（必要補正 |Δμ|/|τ| の z 依存）

目的：
- DDR（距離二重性）の ε0 制約を、「静的背景P最小（ε0=-1）から観測ε0へ寄せるために必要な補正量」という直感量（|Δμ(z)|/|τ(z)|）へ変換し、z 依存の“到達限界”を整理する。
- Step 14.2.14（静的無限空間仮説の検証パック整理）に向けて、距離指標の前提（標準光源/標準定規/不透明度）へ吸収できる“誤差予算”の目盛りと、棄却条件の接続点を明確化する。

変更：
- `scripts/cosmology/cosmology_distance_duality_constraints.py`
  - 代表制約の自動選択を追加：
    - `uses_bao=true` の中で最小σ（tightest）
    - `uses_bao=false` の中で |z_pbg_static| 最小（least rejecting）
  - `Δε_needed` を |Δμ(z)|（距離モジュラス補正, mag）と |τ(z)|（等価減光）へ変換し、z=0〜2.3 の曲線を出力。
  - Δμ 予算（0.05/0.1/0.2/0.5/1.0 mag）に対する `z_limit` を計算し、metrics JSON に固定。
- `doc/paper/10_manuscript.md`
  - 宇宙論（DDR）節に“到達限界”図を追加（距離指標の前提の効き方を可視化）。
- `doc/paper/01_figures_index.md`
  - 新図と metrics を登録。

主要数値（固定例）：
- 代表（BAO含む：Martinelli2021 SNIa+BAO）：|Δμ(z=1)|≈1.52 mag、|Δμ|≤0.2 mag を仮定すると z_limit≈0.095。
- 代表（BAOなし：Holanda2012 non-iso spherical）：|Δμ(z=1)|≈0.43 mag、|Δμ|≤0.2 mag を仮定すると z_limit≈0.379。

出力（追加）：
- `output/cosmology/cosmology_distance_indicator_reach_limit.png`
- `output/cosmology/cosmology_distance_indicator_reach_limit_metrics.json`

再現：
- `python -B scripts/cosmology/cosmology_distance_duality_constraints.py`
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）


---

## 2026-01-09（UTC） Step 14.2.14：静的無限空間仮説の検証パックを整理（DDR/Tolman/AP/T(z)/SN time dilation）

目的：
- 静的無限空間（最小仮定）に対して、宇宙論の主要プローブ（DDR/Tolman/AP/T(z)/SN time dilation）の “棄却度（σ）” と「距離指標依存/系統」を **1枚に集約**し、誤解なく現状を共有できる形にする。
- 例外規定（DDRは距離指標依存、Tolmanは進化系統）を、図としても一目で分かる形に落とす。

変更：
- `scripts/cosmology/cosmology_static_infinite_hypothesis_pack.py`（新規）
  - 既存の metrics（DDR/Tolman/AP/T(z)/SN time dilation）を読み込み、静的最小仮定に対する |z| を棒グラフ＋注意表として出力。
  - DDR は代表2系統（BAO含む tightest / BAOなし least rejecting）を併記し、到達限界（|Δμ|≤0.2 mag の z_limit など）も注記へ反映。
- `scripts/summary/run_all.py`
  - `cosmology_static_infinite_hypothesis_pack` を cosmology セクションに追加（オフライン再現に統合）。
- `doc/paper/10_manuscript.md`
  - 宇宙論節に検証パック図を追加。
- `doc/paper/01_figures_index.md`
  - 新図と metrics を登録。

主要数値（固定例）：
- SN time dilation（静的最小 p_t=0）：|z|≈9.7σ（観測 p_t=0.97±0.10）。
- CMB温度 T(z)（静的最小 p_T=0）：|z|≈62σ（観測 p_T=0.996±0.016）。

出力（追加）：
- `output/cosmology/cosmology_static_infinite_hypothesis_pack.png`
- `output/cosmology/cosmology_static_infinite_hypothesis_pack_metrics.json`

再現：
- `python -B scripts/cosmology/cosmology_static_infinite_hypothesis_pack.py`
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）


---

## 2026-01-09（UTC） Phase 14.2.12：標準光源進化 s_L の「CDDR仮定なし」一次ソースを追加し、独立一次ソース版の循環フォールバックを解消

目的：
- 宇宙論（Phase 14）の独立一次ソース版で、標準光源進化 s_L が CDDR仮定の一次ソースに依存してしまう問題（`cddr_fallback_used=true`）を解消する。

変更：
- `data/cosmology/sn_standard_candle_evolution_constraints.json`
  - Dainotti+2021 の `H0(z)=H0/(1+z)^α` を「標準光源の見かけの進化」として `s_L=2α` に換算した一次ソース制約を追加（`assumes_cddr=false`, `uses_bao=false`, `uses_cmb=false`）。
  - 定義部に `alpha_h0`（H0(z)→s_L換算）の説明を追加。
- `doc/paper/10_manuscript.md`
  - 宇宙論（再接続）の s_L 一次ソース説明を更新し、独立一次ソース版が CDDR仮定へフォールバックしない形へ更新（数値も現行出力へ整合）。
- `doc/paper/20_data_sources.md` / `doc/paper/30_references.md`
  - 上記一次ソースを追記。

出力（更新）：
- `output/cosmology/cosmology_reconnection_required_ruler_evolution_independent_metrics.json`（`selection_policy.candle_evolution.cddr_fallback_used=false` / `primary_constraints_used.candle_evolution.id=dainotti2021_pantheon_h0_evolution_alpha_3bins`）
- `output/cosmology/cosmology_reconnection_required_ruler_evolution_metrics.json`（CDDR仮定の s_L を primary から除外した上での primary 更新）
- `output/summary/pmodel_public_report.*` / `output/summary/pmodel_paper.*`（HTML/DOCX）

再現：
- `python -B scripts/summary/run_all.py --offline`


---

## 2026-01-09（UTC） Phase 14.2.11：標準光源進化 s_L の一次ソースに `assumes_cddr` を導入し、DDR評価の循環性を低減

目的：
- 宇宙論（Phase 14）の再接続検証で、標準光源進化 s_L の一次ソースが CDDR（距離二重性）を仮定している場合、DDR評価が循環してしまう問題を減らす。

変更：
- `data/cosmology/sn_standard_candle_evolution_constraints.json`
  - 一次ソースごとに `assumes_cddr` を追加（不明は `null`）。
  - `kumar2021_pantheon_cc_m4_epsilon_ln` と `hu2023_snia_sgls_evo_epsilon_ln` を `assumes_cddr=true` として明示。
- `scripts/cosmology/cosmology_reconnection_required_ruler_evolution.py`
  - `assumes_cddr` をパースし、primary 選択で「可能なら `assumes_cddr==true` を除外」する規則を追加。
  - `selection_policy.candle_evolution` に `cddr_excluded_*` / `cddr_fallback_used` を記録（独立一次ソース版は現状 `assumes_cddr==true` しか無いため fallback になる）。
  - 図注に `（CDDR仮定）` を自動付与（primary が `assumes_cddr==true` の場合）。
- `scripts/cosmology/cosmology_reconnection_plausibility.py`
  - 上と同様に `assumes_cddr` をパースし、primary 選択・図注・metrics に反映。
- `doc/paper/10_manuscript.md`
  - Full版（BAO/CMBを含む一次ソース集合）では「CDDR仮定の s_L を primary から除外」する方針を明記。

出力（更新）：
- `output/cosmology/cosmology_reconnection_required_ruler_evolution_metrics.json`（`primary_constraints_used.candle_evolution.id=ferramacho2009_table2_K_vanilla`）
- `output/cosmology/cosmology_reconnection_required_ruler_evolution_independent_metrics.json`（`selection_policy.candle_evolution.cddr_fallback_used=true`）
- `output/cosmology/cosmology_reconnection_plausibility_metrics.json`（`primary_constraints_used.*.assumes_cddr` を反映）
- `output/summary/pmodel_public_report.*` / `output/summary/pmodel_paper.*`（HTML/DOCX）

再現：
- `python -B scripts/summary/run_all.py --offline`


---

## 2026-01-09（UTC） Phase 14.2.10：標準光源進化 s_L の BAO/CMB 非依存一次ソースを追加（Pantheon+CC; CDDR仮定）

目的：
- 宇宙論（Phase 14）の独立一次ソース版で、標準光源進化 s_L の一次ソースを増やし、一次ソース選択（σ/仮定）に対する感度を明示する。

変更：
- `data/cosmology/sn_standard_candle_evolution_constraints.json`
  - Kumar+2021（Pantheon + cosmic chronometers）の Part II（CDDRを仮定）の M4: `M_B(z)=M_B0+M_B1 ln(1+z)` を、P-model側の `s_L`（`L∝(1+z)^{s_L}`）へ換算して追加（`uses_bao=false`, `uses_cmb=false`）。
  - 独立一次ソース版の eligible が `kumar2021...` と `hu2023...` の2件になり、最小σの `kumar2021...` が primary になることを `selection_policy` で固定。
- `doc/paper/20_data_sources.md` / `doc/paper/30_references.md`
  - 上記一次ソースを追記。
- `doc/paper/10_manuscript.md`
  - 独立一次ソース版（α・s_L を BAO/CMB 非依存に限定）の数値を現行出力に整合させ、s_L一次ソース選択による張力の感度（BOSS DR12 との張力など）を明記。

出力（更新）：
- `output/cosmology/cosmology_reconnection_required_ruler_evolution_independent_metrics.json`（`primary_constraints_used.candle_evolution.id=kumar2021_pantheon_cc_m4_epsilon_ln`）
- `output/summary/pmodel_public_report.*` / `output/summary/pmodel_paper.*`（HTML/DOCX）

再現：
- `python -B scripts/summary/run_all.py --offline`


---

## 2026-01-09（UTC） Phase 14.2.9：標準光源進化 s_L の BAO/CMB 非依存一次ソースを追加（Pantheon+強い重力レンズ）

目的：
- 宇宙論の独立一次ソース版で、標準光源進化 s_L がフォールバック（CMBを含む一次ソースへ後退）してしまう問題を解消し、α と s_L を BAO/CMB 非依存一次ソースに揃える。

変更：
- `data/cosmology/sn_standard_candle_evolution_constraints.json`
  - Hu+2023（Pantheon+強い重力レンズ）の進化モデル δM=ε ln(1+z) の ε を、P-model側の `s_L`（`L∝(1+z)^{s_L}`）へ換算して追加（`uses_bao=false`, `uses_cmb=false`）。
- `doc/paper/20_data_sources.md` / `doc/paper/30_references.md`
  - 上記一次ソースを追記。
- `doc/paper/10_manuscript.md`
  - 独立一次ソース版の説明を更新（s_Lのフォールバック解消、張力の記述を現行出力に整合）。

出力（更新）：
- `output/cosmology/cosmology_reconnection_required_ruler_evolution_independent_metrics.json`（`selection_policy.candle_evolution.fallback_used=false`）
- `output/summary/pmodel_public_report.*` / `output/summary/pmodel_paper.*`（HTML/DOCX）

再現：
- `python -B scripts/summary/run_all.py --offline`


---

## 2026-01-09（UTC） Phase 14.2.8：不透明度 α の独立一次ソース拡充（JLA+H(z)）＋独立版の整合修正

目的：
- 宇宙論（Phase 14）の再接続検証で使う不透明度 α の BAO/CMB 非依存一次ソースを増やし、独立一次ソース版の頑健性を上げる。
- 併せて、SNe Ia 進化（s_L）の一次ソースフラグ（BAO/CMB含有）を一次ソース記述に合わせて整理し、独立一次ソース版の「フォールバック」を論文本文へ反映する。

変更：
- `data/cosmology/cosmic_opacity_constraints.json`
  - Liao+2015（JLA+H(z); differential age）の ϵ 制約（τ(z)=2ϵ z）を追加し、z=1で `τ(1)` を一致させて α=ϵ/ln2 に換算して固定入力へ追加。
- `data/cosmology/sn_standard_candle_evolution_constraints.json`
  - Linden+2009（Model 1: log(1+z)）が SNe+R+A（圧縮CMB/BAO）を含むため、`uses_bao/uses_cmb` を修正（独立一次ソース版は s_L でフォールバックする扱いに）。
- `doc/paper/20_data_sources.md` / `doc/paper/30_references.md`
  - Liao+2015 を追記。
- `doc/paper/10_manuscript.md`
  - 独立一次ソース版の説明を「αのみ独立（s_Lは現状フォールバック）」として整理し、数値（s_R, 張力）を現行出力に整合させた。

出力（更新）：
- `output/cosmology/cosmology_reconnection_plausibility_metrics.json`（opacity一次ソースの追加）
- `output/cosmology/cosmology_reconnection_required_ruler_evolution_independent_metrics.json`（独立版の selection_policy / primary 更新）
- `output/summary/pmodel_public_report.*` / `output/summary/pmodel_paper.*`（HTML/DOCX）

再現：
- `python -B scripts/summary/run_all.py --offline`


---

## 2026-01-09（UTC） Phase 14.2.7：不透明度 α の一次ソースを追加（BAO+SNe Ia の ϵ）

目的：
- α（不透明度）の一次ソースが少ないため、BAO+SNe Ia から τ(z)=2ϵ ln(1+z) の ϵ を推定した Nair+2013 を追加し、α の幅（全リスト）と z_score を固定出力へ反映する。

変更：
- `data/cosmology/cosmic_opacity_constraints.json`
  - Nair+2013（BAO+SNe Ia）の ϵ=-0.159±0.097（1σ）を追加（`uses_bao=true`, `uses_cmb=false`、本リポジトリの α と同一視）。
- `doc/paper/30_references.md` / `doc/paper/20_data_sources.md`
  - 上記一次ソースを追記。

出力（更新）：
- `output/cosmology/cosmology_reconnection_plausibility_metrics.json`（`opacity_all` に追加）
- `output/summary/pmodel_public_report.*` / `output/summary/pmodel_paper.*`（HTML/DOCX）

再現：
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）


---

## 2026-01-09（UTC） Phase 14.2.6：α/s_L を BAO/CMB 非依存一次ソースで再評価（独立版図を追加）

目的：
- α（不透明度）と s_L（標準光源進化）の一次ソースが BAO/CMB を含む場合の循環性を避けるため、BAO/CMB を含まない一次ソースに限定した「独立一次ソース版」を追加し、必要 s_R と BAO (D_M,H) fit との張力の感度を確認する。

変更：
- `scripts/cosmology/cosmology_reconnection_required_ruler_evolution.py`
  - α/s_L の primary を「最小σ版」と「BAO/CMB 非依存版」の2系統で選び、両方の図/metrics を固定名で出力。
  - 独立版は `uses_bao=false && uses_cmb=false` と明示された一次ソースのみを採用（未記載は除外）。
- `doc/paper/10_manuscript.md`
  - 独立一次ソース版の結果（例：Martinelli2021 の s_R≈1.18±0.19、BAO張力≈5.8σ）を追記し、図を追加。
- `doc/paper/01_figures_index.md`
  - 宇宙論の独立一次ソース版図（4点）を追加。

出力（追加/更新）：
- `output/cosmology/cosmology_reconnection_required_ruler_evolution_independent.png`
- `output/cosmology/cosmology_reconnection_required_ruler_evolution_independent_metrics.json`
- `output/cosmology/cosmology_bao_scaled_distance_fit_independent.png`
- `output/cosmology/cosmology_bao_scaled_distance_fit_independent_metrics.json`
- `output/summary/pmodel_paper.*` / `output/summary/pmodel_public_report.*`（HTML/DOCX）

再現：
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）


---

## 2026-01-09（UTC） Phase 14.2.5：DDR制約を拡充し、BAO含む/なしの幅を図とスコアボードへ反映

目的：
- DDR（距離二重性）の棄却度が「距離指標の構成」やクラスター系統（幾何モデル・パラメータ化）に強く依存するため、同一一次ソース内の別サンプル/別パラメータ化も固定入力として追加し、幅が一目で分かる形にする。

変更：
- `data/cosmology/distance_duality_constraints.json`
  - Holanda2012：non-isothermal spherical βmodel（η0）を追加。
  - Li2011：Bonamenteサンプル、および非線形パラメータ化（η=1+η0 z/(1+z)）を追加。
  - いずれも η0→ε0 は z=1 アンカー換算（近似）として明記。
- `scripts/cosmology/cosmology_distance_duality_constraints.py`
  - `uses_bao` を取り込み、図で BAO含む/なしを色分け。
  - 左パネルは「BAO含む（最小σ）」と「BAOなし（最小|z|）」の2本に絞って可読性を確保。
- `scripts/summary/validation_scoreboard.py`
  - cosmo_ddr の指標欄に `no-BAO最小|z|` を併記して、幅を明示。
- `doc/paper/10_manuscript.md`：宇宙論章に、（近似換算で）棄却度が 1〜5σ まで幅を持つ点と、BAO自己整合が約1.2σまで緩むケースを追記。

出力（更新）：
- `output/cosmology/cosmology_distance_duality_constraints.png` / `output/cosmology/cosmology_distance_duality_constraints_metrics.json`
- `output/summary/validation_scoreboard.png` / `output/summary/validation_scoreboard.json`（cosmo_ddr の指標）
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`（宇宙論章の追記）
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`

再現：
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）


---

## 2026-01-09（UTC） Phase 14.2.4：BAO非依存DDR制約（クラスター+SNe）を追加し、BAO自己整合を制約別に評価

目的：
- 宇宙論（静的無限空間の仮説）で最も差が出ている DDR（距離二重性）について、BAOに依存しない一次ソース制約を追加し、棄却度/必要補正/BAO自己整合がどれだけ変わるかを可視化する。

変更：
- `data/cosmology/distance_duality_constraints.json` に、クラスター+SNe Ia のモデル非依存テスト（Holanda2012 / Li2011）を追加（η0→ε0は z=1 のアンカー換算、近似である旨を明記）。
- `data/cosmology/sources/arxiv_1104.3753.pdf` / `data/cosmology/sources/arxiv_1101.5255.pdf` をローカルキャッシュとして追加（sha256固定）。
- `scripts/cosmology/cosmology_reconnection_required_ruler_evolution.py` を更新：
  - DDR制約の `uses_bao` を取り込み、BAO自己整合チェックでは原則 `uses_bao=false` の一次ソースを優先。
  - DDR制約ごとの `z_score_sR_required_vs_bao` を出力し、最も整合する制約（best_match）を自動で記録。
- 論文側（宇宙論章）に「BAOを含むDDR制約は強いが、クラスター+SNeの直接比較は現状は不確かさが大きい」ことを追記し、張力が 9σ級→1〜3σまで変わり得る点を明文化。

出力（更新）：
- `output/cosmology/cosmology_distance_duality_constraints.png` / `output/cosmology/cosmology_distance_duality_constraints_metrics.json`
- `output/cosmology/cosmology_reconnection_required_ruler_evolution.png` / `output/cosmology/cosmology_reconnection_required_ruler_evolution_metrics.json`
- `output/cosmology/cosmology_bao_scaled_distance_fit.png` / `output/cosmology/cosmology_bao_scaled_distance_fit_metrics.json`（`comparison.per_ddr` / `best_match_*` を追加）
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`（宇宙論章の追記）

再現：
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）
- 個別：`python -B scripts/cosmology/cosmology_distance_duality_constraints.py`
- 個別：`python -B scripts/cosmology/cosmology_reconnection_required_ruler_evolution.py --use-independent-probes`


---

## 2026-01-09（UTC） Phase 14.2.3：独立プローブ（p_t, p_T）を s_R 推定へ取り込み、BAO（D_M,H）からの s_R fit を追加

目的：
- DDR再接続で必要となる標準定規進化 s_R の推定に、距離指標と独立な一次ソース拘束（SN time dilation / CMB温度T(z)）の不確かさを反映する。
- 「標準定規進化でDDR差分を吸収できるか」を、BAO（BOSS DR12）の (D_M,H) 出力に対して自己整合チェックする。

変更：
- `scripts/cosmology/cosmology_reconnection_required_ruler_evolution.py` に `--use-independent-probes` を追加し、p_t（Blondin+2008）と p_T（Avgoustidis+2011）から p_e/p_t とσを設定して誤差伝播。
- 同スクリプトに BAO（BOSS DR12）の (D_M,H) 出力から s_R をfitするチェックを追加し、`output/cosmology/cosmology_bao_scaled_distance_fit.*` を固定出力。
- `scripts/summary/run_all.py` で `cosmology_reconnection_required_ruler_evolution` に `--use-independent-probes` を追加。
- `doc/paper/10_manuscript.md` に s_R 数値更新と BAO-fit との張力（約9σ）を追記。
- `doc/paper/01_figures_index.md` と `doc/STATUS.md` に図/入口を追記。

出力（更新）：
- `output/cosmology/cosmology_reconnection_required_ruler_evolution.png` / `output/cosmology/cosmology_reconnection_required_ruler_evolution_metrics.json`
- `output/cosmology/cosmology_bao_scaled_distance_fit.png` / `output/cosmology/cosmology_bao_scaled_distance_fit_metrics.json`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`

再現：
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）


---

## 2026-01-09（UTC） Phase 14.2.2：SNIa標準光源進化の一次ソース拘束を追加し、再接続量（s_L/s_R）の数値を更新

目的：
- 宇宙論（DDR）で必要となる再接続量 Δε を「標準光源進化 s_L」として解釈する場合の現実性を、一次ソース拘束で強化する。
- α（不透明度）と s_L（標準光源進化）の拘束を受け入れたまま DDR を満たすときに必要な s_R（標準定規進化）の推定を更新する。

変更：
- `data/cosmology/sn_standard_candle_evolution_constraints.json` に Ferramacho+2009 の SNIa evolution（time-law; z=1での等級変化 K）を追加し、s_L へ換算して併記。
- `doc/paper/10_manuscript.md` の宇宙論章（再接続の妥当性/必要 s_R）を Ferramacho+2009 を含む数値へ更新。
- `doc/paper/20_data_sources.md` / `doc/paper/30_references.md` に Ferramacho+2009 を追記。

出力（更新）：
- `output/cosmology/cosmology_reconnection_plausibility.png`
- `output/cosmology/cosmology_reconnection_required_ruler_evolution.png`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`

再現：
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）


---

## 2026-01-09（UTC） Phase 14.2.2：再接続（plausibility）図で複数一次ソース拘束を併記し、結論の頑健性を明示

目的：
- 不透明度αなどの一次ソース拘束が複数ある場合に、単一の値だけを図に出すと「恣意的に見える」ため、**複数一次ソースを同じ図で併記**し、必要補正（Δε）とのギャップが一次ソース依存でないことを可視化する。

変更：
- `scripts/cosmology/cosmology_reconnection_plausibility.py`
  - opacity/candle/BAO の拘束が複数ある場合、全てをプロット（y軸に short_label を表示）し、注記は最小σ（代表拘束）で表示。
  - `*_metrics.json` に primary と all（全拘束）を分けて保存。

出力（更新）：
- `output/cosmology/cosmology_reconnection_plausibility.png`
- `output/cosmology/cosmology_reconnection_plausibility_metrics.json`
- `output/summary/pmodel_public_report.*` / `output/summary/pmodel_paper.*`（HTML/DOCX 再生成）

再現：
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）


---

## 2026-01-09（UTC） Phase 14.2.2：不透明度（α）の一次ソース拘束を追加し、近似（95%→1σ）依存を低減

目的：
- 宇宙論（静的無限空間の再接続）で必要となる補正量 Δε を議論する際、α（不透明度）の一次ソース拘束が 95%CL→1σ 近似に依存していたため、**1σとして明示された拘束**を追加して頑健性を上げる。
- 追加した拘束を用いて、DDR再接続の「単独機構（αのみ）」の困難さと、一次ソース拘束込みで必要となる標準定規進化 s_R の目安を更新する。

変更：
- `data/cosmology/sources/arxiv_1606.08102.pdf` を追加（sha256をJSONに記録）。
- `data/cosmology/cosmic_opacity_constraints.json`
  - 追加：Lv & Xia 2016（SNIa+BAO+CMB+H(z) 統合）から ε=0.023±0.018（68%CL≒1σ）を α拘束として追加。
- `scripts/cosmology/cosmology_reconnection_plausibility.py`
  - 複数拘束がある場合に、σが最小の行（最も拘束が強い一次ソース）を自動選択するように改善（opacity/candle/BAO）。
- `doc/paper/10_manuscript.md` / `doc/paper/20_data_sources.md` / `doc/paper/30_references.md`
  - LvXia2016CDDR を追記し、関連するσ評価と s_R の数値を更新。

出力（更新）：
- `output/cosmology/cosmology_reconnection_plausibility.png` / `output/cosmology/cosmology_reconnection_plausibility_metrics.json`
- `output/cosmology/cosmology_reconnection_required_ruler_evolution.png` / `output/cosmology/cosmology_reconnection_required_ruler_evolution_metrics.json`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`

主要結果（metricsより）：
- DDR再接続を「αのみ」で吸収するには α≈1.013 が必要だが、Lv & Xia 2016 の拘束 α=0.023±0.018 に対して |z|≈55。
- α と s_L の一次ソース拘束を受け入れたまま DDR を満たすと、必要 s_R≈1.10±0.18（1σ）で、z=1 の定規倍率は中央値≈2.14（±1σで約1.89〜2.43）。

再現：
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）


---

## 2026-01-09（UTC） Phase 14.2.2：DDR再接続に必要な“標準定規進化 s_R”を一次ソース拘束込みで定量化

目的：
- 静的背景P（膨張なし）で DDR を満たすために必要な補正量を、α（不透明度）と s_L（標準光源進化）の一次ソース拘束と同時に満たす形へ整理し、「距離指標の前提（標準化/校正）がどれだけ効くか」を数値化する。

変更：
- `scripts/cosmology/cosmology_reconnection_required_ruler_evolution.py` を追加。
  - 最小仮定（独立プローブと整合）：p_e=p_t=1 を固定。
  - DDR の指数関係 `ε0_model = (p_e+p_t-s_L)/2 - 2 + s_R + α` を用い、必要な標準定規進化を `s_R = ε0_obs - α - (p_e+p_t-s_L)/2 + 2` として解く。
  - z=1 での直感量として定規倍率（2^{s_R}）の中央値と±1σも併記。
- `scripts/summary/run_all.py` にタスク `cosmology_reconnection_required_ruler_evolution` を追加。
- `doc/paper/10_manuscript.md` に図と要旨を追記。
- `doc/paper/01_figures_index.md` に図を追加。

出力（追加）：
- `output/cosmology/cosmology_reconnection_required_ruler_evolution.png`
- `output/cosmology/cosmology_reconnection_required_ruler_evolution_metrics.json`

主要結果（metricsより）：
- Martinelli+2021 の ε0 と、Avgoustidis2010 の α、Linden2009 の s_L を用いると、必要 s_R = 1.163 ± 0.181（1σ）。
  - z=1 の定規倍率（2^{s_R}）は中央値 2.24（±1σで約 1.97〜2.54）。

再現：
- `python -B scripts/cosmology/cosmology_reconnection_required_ruler_evolution.py`
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）


---

## 2026-01-09（UTC） Phase 14.2.3：宇宙論の独立プローブ（SN time dilation / CMB温度T(z)）を一次ソースで固定

目的：
- 距離指標（D_L/D_A）と独立な観測で、時間伸長（p_t）と温度スケーリング（β_T/p_T）を拘束し、DDRの“回復”を p_t/p_T の変更だけで説明する逃げ道を排除する。
- 静的無限空間の再接続（Step 14.2）を進める前提として、独立プローブの一次ソース制約を固定出力する。

変更：
- SN time dilation（p_t）:
  - 一次ソース制約を `data/cosmology/sn_time_dilation_constraints.json` に追加（Blondin+2008, arXiv:0804.3595, b=p_t=0.97±0.10）。
  - 可視化スクリプト `scripts/cosmology/cosmology_sn_time_dilation_constraints.py` を追加。
- CMB温度スケーリング（β_T/p_T）:
  - 一次ソース制約を `data/cosmology/cmb_temperature_scaling_constraints.json` に追加（Avgoustidis+2011, arXiv:1112.1862, β_T=0.004±0.016）。
  - 可視化スクリプト `scripts/cosmology/cosmology_cmb_temperature_scaling_constraints.py` を追加。
- 連携:
  - `scripts/summary/run_all.py` に上記2タスクを追加。
  - 論文本文 `doc/paper/10_manuscript.md` に独立プローブの解釈（p_t/p_Tは標準と整合、p_t≈3等でDDR回復は困難）と図参照を追記。
  - `doc/paper/01_figures_index.md` / `doc/paper/20_data_sources.md` / `doc/paper/30_references.md` を更新。

出力（追加/更新）：
- `output/cosmology/cosmology_sn_time_dilation_constraints.png` / `output/cosmology/cosmology_sn_time_dilation_constraints_metrics.json`
- `output/cosmology/cosmology_cmb_temperature_scaling_constraints.png` / `output/cosmology/cosmology_cmb_temperature_scaling_constraints_metrics.json`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`

再現：
- `python -B scripts/summary/run_all.py --offline`


---

## 2026-01-09（UTC） Phase 14.2.2：再接続に必要な補正（α/s_L/r_drag）と一次ソース拘束の比較図を追加

目的：
- DDR（ε0）で要求される補正量 Δε を、不透明度 α・標準光源進化 s_L・標準定規（BAO）r_drag のどれか1つだけで説明した場合に必要な量を定量化し、一次ソース拘束と比較して“現実的か”を判断できる材料を追加する。

変更：
- 一次ソース拘束（入力）を `data/cosmology/` に追加：
  - `data/cosmology/cosmic_opacity_constraints.json`（Avgoustidis+2010: α≈ε の拘束）
  - `data/cosmology/sn_standard_candle_evolution_constraints.json`（Linden+2009: β1→s_L の拘束）
  - `data/cosmology/bao_sound_horizon_constraints.json`（Planck 2018: r_drag の拘束）
- 比較図スクリプトを追加：`scripts/cosmology/cosmology_reconnection_plausibility.py`
- `scripts/summary/run_all.py` にタスク `cosmology_reconnection_plausibility` を追加。
- 論文（宇宙論節）へ比較図の参照と解釈を追記：`doc/paper/10_manuscript.md`
- 図番号一覧・参考文献・データソースを更新：`doc/paper/01_figures_index.md` / `doc/paper/30_references.md` / `doc/paper/20_data_sources.md`

出力（追加）：
- `output/cosmology/cosmology_reconnection_plausibility.png`
- `output/cosmology/cosmology_reconnection_plausibility_metrics.json`

再現：
- `python -B scripts/summary/run_all.py --offline`


---

## 2026-01-09（UTC） Phase 14.2 追補：DDRの必要補正（Δε）を「不透明度/進化」の形に展開し、スコアボードへ整合率（%）を併記

目的：
- 宇宙論（距離二重性 / DDR）で、静的背景P最小（ε0=-1）が強く棄却される点を「そこで終わり」にせず、静的無限空間（ビッグバン無し）の仮説で進めるために、距離指標の前提（標準光源/標準定規/不透明度）が“どれだけ効くか”を読者が解釈できる量へ変換して提示する。
- 併せて、全検証の現状（Table 1）を「何割がOKか」で直感的に伝えられるよう、総合スコアボードへ OK率（%）を追加する。

変更：
- `scripts/cosmology/cosmology_distance_duality_constraints.py`
  - Δε を「灰色不透明度（光子数非保存）のべき指数 α」として解釈する場合（`exp(+τ/2)=(1+z)^α`、`τ(z)=2α ln(1+z)`）の補助フィールドを出力に追加。
- `doc/paper/10_manuscript.md`
  - Δε の解釈例（不透明度 α / 標準光源の光度進化 s_L / 標準定規のスケール進化 s_r）を追記し、静的無限空間で再接続する場合に「何を一次ソースで詰めるべきか」を明確化。
- `scripts/summary/validation_scoreboard.py`
  - Table 1（全27行）の OK/要改善/不一致/参考 の比率を算出し、スコアボード図注に OK率（%）と OK+要改善（%）を併記。

出力（更新）：
- `output/cosmology/cosmology_distance_duality_constraints_metrics.json`
- `output/summary/validation_scoreboard.png` / `output/summary/validation_scoreboard.json`
- `output/summary/pmodel_public_report.*` / `output/summary/pmodel_paper.*`（HTML/DOCX）

再現：
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）


---

## 2026-01-09（UTC） Phase 14.1：宇宙論（背景P）再接続の開始（静的無限空間の仮説）— DDRの必要補正Δεを定量化

目的：
- 宇宙論（背景P）で「ビッグバンを前提としない静的無限空間」を採る場合でも、観測で使う距離指標（`D_L`/`D_A`）の整合性を検証可能な形にする。
- 距離二重性（DDR）の“強い棄却”が、距離指標の構成（標準光源/標準定規）や到達限界にどれだけ依存し得るかを、**必要補正量**として数値で把握する。

変更：
- `scripts/cosmology/cosmology_distance_duality_constraints.py`
  - 静的背景P最小（ε0=-1）を観測値へ寄せるのに必要な **有効Δε** と、z=1での **追加倍率（約2倍）**を出力へ追加。
  - 解釈の補助として「標準定規のサイズ進化/標準光源の光度進化」による分解例（非一意）を JSON に記録。
- `scripts/summary/paper_tables.py`
  - DDR行の `metric_public` に Δε と z=1の目安倍率を追記し、“観測方法の前提がどれだけ効くか”を読みやすくした。
- `scripts/summary/validation_scoreboard.py`
  - 宇宙論（距離二重性）のメトリクス表示に、z=1での必要補正（目安）を併記。
- `doc/paper/10_manuscript.md`
  - DDRの棄却を“最小仮定の棄却”として位置づけ、静的無限空間を採る場合は **距離指標の前提（光度/定規/不透明度）**を再導出して再評価する方針と、必要補正（Δε）の規模感を追記。
- `doc/ROADMAP.md` / `doc/STATUS.md`
  - Phase 14（背景P）の方針を「静的無限空間で再接続」へ寄せ、作業項目（距離指標前提の再導出）を明文化。

出力（更新）：
- `output/cosmology/cosmology_distance_duality_constraints.png` / `output/cosmology/cosmology_distance_duality_constraints_metrics.json`
- `output/summary/paper_table1_results.*`
- `output/summary/validation_scoreboard.png` / `output/summary/validation_scoreboard.json`
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`

再現：
- `python -B scripts/cosmology/cosmology_distance_duality_constraints.py`
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）


---

## 2026-01-09（UTC） Phase 14.2：DDRの必要補正を“距離指標の言葉”へ翻訳し、公開レポートに明示

目的：
- 静的無限空間（ビッグバンなし）を採る場合、DDRのズレを「ε0のσ」だけでなく、**距離（mag）/減光（flux）**として把握し、到達限界や系統の議論に接続しやすくする。

変更：
- `scripts/cosmology/cosmology_distance_duality_constraints.py`
  - 静的背景P最小（ε0=-1）から観測ε0へ寄せるための補正を、z=1の直感量として追加：
    - `Δμ≈1.52 mag`（距離係数 `D_L×2.02`）
    - `flux≈1/4.07`（追加減光の目安、等価光学厚 `τ≈1.40`）
    - `σ` を約 `11.6×` に増やさない限り 3σ 棄却を避けられない（目安）
  - 図注記にも z=1 の目安（距離係数/Δμ/flux）を併記。
- `scripts/summary/public_dashboard.py`
  - DDRカードの要約に「必要補正（Δε, z=1での距離係数/Δμ/flux）」を追記。

出力（更新）：
- `output/cosmology/cosmology_distance_duality_constraints.png`
- `output/cosmology/cosmology_distance_duality_constraints_metrics.json`
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`
- `output/summary/paper_table1_results.*`
- `output/summary/validation_scoreboard.png` / `output/summary/validation_scoreboard.json`

再現：
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）


---

## 2026-01-09（UTC） Phase 15.4 追補：スコアボードを一本化し「総合スコアボード」だけを掲載

目的：
- 「決定的スコアボード（fit/predict分離, β固定）」と「総合スコアボード（全検証）」が併存すると読者が迷うため、**総合スコアボード1枚に統一**して現状把握を優先する。

変更：
- `doc/paper/10_manuscript.md`
  - 4.1.1 を「総合スコアボード（全検証の現状）」へ変更し、`decisive_scoreboard` の掲載と説明を撤去。
- `doc/paper/01_figures_index.md`
  - `output/summary/decisive_scoreboard.(png|json)` を固定パス一覧から削除（図表一覧に出さない）。
- `scripts/summary/run_all.py`
  - `decisive_scoreboard` タスクを削除（既定で生成しない）。
- `scripts/summary/public_dashboard.py`
  - 公開レポート（Phase 7）から「決定的スコアボード」カードを外し、`validation_scoreboard` のみに一本化。
- `doc/STATUS.md` / `doc/ROADMAP.md` / `doc/NEXT_STEPS.md` / `doc/DECISIVE_PACK.md`
  - スコアボード参照を `validation_scoreboard` に統一（混乱防止の注記を追加）。

出力（更新）：
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`
- `output/summary/run_all_status.json`（`decisive_scoreboard` が出ない）
- `output/summary/validation_scoreboard.png` / `output/summary/validation_scoreboard.json`

再現：
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）


---

## 2026-01-09（UTC） Phase 13.1 追補：スコアボードを「決定的スコアボード」形式（棒グラフ＋色分け）へ統一し、論文へ反映

目的：
- 総合スコアボード（全検証）を、論文 4.1.1 の「決定的スコアボード」と同じ見た目（棒グラフ＋緑/黄/赤）に寄せ、現状把握を直感的にする。
- 論文本文（4.1.1）でも、fit/predict の決定的スコアボードに加えて「確認項目の現状」が見えるようにする。

変更：
- `scripts/summary/validation_scoreboard.py`
  - 各テーマを正規化スコア（0=理想, 1=OK境界, 2=要改善境界）で棒グラフ化し、色（緑/黄/赤/灰）で状態を表示。
- `scripts/summary/decisive_scoreboard.py`
  - |z| が 1〜2 の色を黄へ変更（要改善/要検証の見た目を統一）。
- `doc/paper/10_manuscript.md` / `doc/paper/01_figures_index.md`
  - 4.1.1 に `output/summary/validation_scoreboard.png` を追加し、色の意味を明記。

出力（更新）：
- `output/summary/validation_scoreboard.png` / `output/summary/validation_scoreboard.json`
- `output/summary/decisive_scoreboard.png`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`
- `output/summary/pmodel_public_report.docx`（画像埋め込みを更新）

再現：
- `python -B scripts/summary/validation_scoreboard.py`
- `python -B scripts/summary/decisive_scoreboard.py`
- `python -B scripts/summary/paper_build.py --mode publish --docx-orientation landscape --docx-margin-mm 7`


---

## 2026-01-09（UTC） Phase 13.1：Table 1（全27行）を判定（目安）つきでスコアボードに統合

目的：
- 「検証した結果すべて」を、スコアボード側でも **行ごとに** 俯瞰できるようにする（OK/要改善/不一致/参考）。
- 判定基準（しきい値）を JSON の `policy` として残し、再現・説明ができる形に固定する。

変更：
- `scripts/summary/validation_scoreboard.py`
  - `output/summary/paper_table1_results.json` を読み、Table 1（全27行）を簡易しきい値で分類して `table1_breakdown` / `table1_status_counts` を出力。
  - しきい値（σ/corr/RMS比など）を `policy` として出力。
- `scripts/summary/public_dashboard.py`
  - カード「総合スコアボード（全検証）」に、Table 1 の判定（目安）テーブルを表示（公開レポート側）。

出力（更新）：
- `output/summary/validation_scoreboard.json`（`table1_breakdown` / `policy` 追加）
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`

再現：
- `python -B scripts/summary/validation_scoreboard.py`
- `python -B scripts/summary/public_dashboard.py`
- `python -B scripts/summary/html_to_docx.py --in output/summary/pmodel_public_report.html --out output/summary/pmodel_public_report.docx --pagebreak-validations --orientation landscape --margin-mm 7`


---

## 2026-01-09（UTC） 小修正：総合スコアボードの σ集計を有効化（表示の整合）

目的：
- `validation_scoreboard` の「σ評価可能: 1σ/2σ以内の割合」が 0 件表示になっていた問題を修正し、Table 1 と同じ集計が出るようにする。

変更：
- `scripts/summary/validation_scoreboard.py` の正規表現（z抽出/パルサーσ抽出）を修正。

出力（更新）：
- `output/summary/validation_scoreboard.png` / `output/summary/validation_scoreboard.json`
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`

再現：
- `python -B scripts/summary/validation_scoreboard.py`
- `python -B scripts/summary/public_dashboard.py`
- `python -B scripts/summary/html_to_docx.py --in output/summary/pmodel_public_report.html --out output/summary/pmodel_public_report.docx --pagebreak-validations --orientation landscape --margin-mm 7`


---

## 2026-01-09（UTC） 小修正：GW要約の中央値（median）定義を統計的中央値へ修正

目的：
- 総合スコアボード（全検証）の「重力波（複数イベント）」に表示する median(max R²) が、偶数件（10イベント）のときに上側の値を採用してしまう問題を修正する。

変更：
- `scripts/summary/validation_scoreboard.py` の中央値計算を「中央2点の平均」に修正。

出力（更新）：
- `output/summary/validation_scoreboard.png` / `output/summary/validation_scoreboard.json`
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`


---

## 2026-01-09（UTC） Phase 7：総合スコアボード（全検証）を追加（Table 1 を1枚で俯瞰）

目的：
- 「決定的スコアボード」に入っていなかった **二重パルサー** と **重力波（GW）** を含め、検証済みの全体像（Table 1）を **1枚で俯瞰**できる形にする。
- 現在の立ち位置を “伝えやすい” 形（OK/要改善/不一致 の目安＋σ評価可能な項目の達成率）で固定する。

変更：
- `scripts/summary/validation_scoreboard.py` を追加。
  - `output/summary/paper_table1_results.json`（Table 1）と各検証の確定出力から、全検証の要約スコアボード（PNG+JSON）を生成。
  - σ評価可能な項目について「1σ/2σ以内の割合」を算出して併記。
- `scripts/summary/run_all.py` に `validation_scoreboard` タスクを追加（Table 1 の直後）。
- `scripts/summary/public_dashboard.py` にカード「総合スコアボード（全検証）」を追加（Phase 7）。

出力（追加/更新）：
- 追加：`output/summary/validation_scoreboard.png` / `output/summary/validation_scoreboard.json`
- 更新：`output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`

主要な数値（目安）：
- σ評価可能（Table 1 ベース）: **2σ以内 8/11（72.7%）**, **1σ以内 6/11（54.5%）**
  - 2σ超は宇宙論（距離二重性/Tolman）に集中（静的背景Pの最小モデルの棄却度）

再現：
- `python -B scripts/summary/validation_scoreboard.py`
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX含む）


---

## 2026-01-09（UTC） ロードマップ更新：Phase 11/12 を追記し、総合スコアボード（全検証）を明記

目的：
- `doc/STATUS.md` に記載済みの進捗（GWの品質改善・標準化）と、今回追加した「総合スコアボード（全検証）」を、`doc/ROADMAP.md` 側にも反映して整合を取る。

変更：
- `doc/ROADMAP.md` に Phase 11 / Phase 12 を追記（要約図・match健全化・event_list駆動・offline再現）。
- Phase 7（Step 7.2）に「総合スコアボード（全検証）」の項目を追記。


---

## 2026-01-09（UTC） ロードマップ更新：Phase 14/15 を追記（宇宙論方針確定／GW品質改善）

目的：
- 次の作業対象を “迷わず選べる” ように、現状で課題が明確な領域（宇宙論の棄却/再接続、GWの低R²イベント改善）をロードマップへ明文化する。

変更：
- `doc/ROADMAP.md` に Phase 14（宇宙論: 背景Pの方針確定）と Phase 15（GW品質改善）を追記。


---

## 2026-01-09（UTC） Phase 14：GWの拡張と論文統合（profiles強化＋高SNR BBH追加）

目的：
- GWイベントの追加を event_list（データ）中心で回せる状態を維持しつつ、イベント個別の例外（`extra_argv`）を減らす。
- GWTC-3-confident から高SNRのBBHを追加し、online→offline 再現を確認する。
- 論文は「本文=要約＋代表図、残りは付録」の方針に寄せ、GWの個別図は付録へ集約する。

変更：
- `data/gw/event_list.json`
  - BBH向け profiles を追加：`bbh_hilbert_short`（短いchirpで安定しやすい設定）を追加し、GW200224_222234 の個別 `extra_argv` を削減。
  - GWTC-3-confident の高SNR BBH を追加：GW191216_213338 / GW200311_115853。
- `doc/paper/10_manuscript.md`
  - 4.11（GW）の多イベント記述を「要約＋Table 1＋要約図」中心へ寄せ、個別イベントの図は付録（図表一覧）へ移動。
- `doc/paper/01_figures_index.md`
  - GW191216_213338 / GW200311_115853 の図を追加し、付録ギャラリーに含める。

出力（更新/追加）：
- `output/gw/gw191216_213338_*`（chirp_phase / waveform_compare / metrics）
- `output/gw/gw200311_115853_*`（chirp_phase / waveform_compare / metrics）
- `output/gw/gw_multi_event_summary*`（新イベントを含む要約）
- `output/summary/paper_table1_results.*`（Table 1 更新）
- `output/summary/pmodel_public_report.*` / `output/summary/pmodel_paper.*`（HTML/DOCX 再生成）

再現：
- `python -B scripts/summary/run_all.py --offline`
- `python -B scripts/summary/paper_build.py --mode publish`


---

## 2026-01-09（UTC） Phase 13：GWイベント管理（event_list v2 + 診断 + 追加イベント投入）

目的：
- GWイベントの追加を「コード改変」ではなく **`data/gw/event_list.json` の編集**で行えるようにし、再現性と拡張性を上げる。
- イベントごとの失敗理由を機械可読で集計し、種別（BBH/BNS/NSBH）ごとの既定値調整に繋げる。
- Word（DOCX）の右端はみ出しを抑え、配布用レイアウトを安定化する。

変更：
- `data/gw/event_list.json`
  - v2（profiles方式）へ更新：イベント種別（BBH/BNS/NSBH）＋推奨パラメータ（窓/帯域）を profiles に集約。
  - 追加投入の実演として、GW200224_222234（GWTC-3-confident）を **event_list編集のみ**で追加。
- `scripts/summary/run_all.py`
  - event_list v2（profiles/profile/extra_argv + catalog/detectors）を読み取り、GWタスクを生成。
  - `scripts/gw/gw_event_list_diagnostics.py` をバッチへ統合。
  - DOCX出力に `--docx-margin-mm` を追加（既定7mm）。
- `scripts/gw/gw_event_list_diagnostics.py`（新規）
  - `event_list.json` と `output/summary/run_all_status.json` を突合し、成功/失敗（理由）を集計してJSON出力。
- `scripts/summary/paper_build.py`
  - DOCX出力に `--docx-margin-mm` を追加（既定7mm）。
- `scripts/summary/html_to_docx.py`
  - 右端はみ出し対策を強化：安全マージンを拡大し、picture-like floating Shape を InlineShape に変換してからフィット。

出力（更新/追加）：
- `output/gw/gw_event_list_diagnostics.json`
- `output/gw/gw200224_222234_*`（chirp_phase / waveform_compare / metrics）
- `output/gw/gw_multi_event_summary*`（新イベントを含む要約）
- `output/summary/paper_table1_results.*`（Table 1 に GW200224_222234 を追加）
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`

再現：
- `python -B scripts/summary/run_all.py --offline`
- `python -B scripts/summary/paper_build.py --mode publish`


---

## 2026-01-09（UTC） Phase 12.2：GWイベント一覧のデータ駆動化（event_list.json）

目的：
- GWイベントの追加/更新を「コード改変なし」で行えるようにし、再現性（`--offline`）を保ったまま拡張しやすくする。

変更：
- `data/gw/event_list.json`
  - GWイベント一覧（順序/slug/引数）を固定し、`run_all` と表/要約図の入力源にする。
- `scripts/summary/run_all.py`
  - `data/gw/event_list.json` を読み取り、GWの解析タスク（`gw_*_chirp_phase`）を自動生成するよう変更。
- `scripts/summary/paper_tables.py`
  - Table 1 の GW 行を `data/gw/event_list.json` の順序で集計するよう変更。
- `scripts/gw/gw_multi_event_summary.py`
  - 既定のイベント一覧を `data/gw/event_list.json` から読める場合はそれを採用するよう変更。

出力（更新）：
- `output/summary/paper_table1_results.*`
- `output/gw/gw_multi_event_summary*.png`
- `output/summary/pmodel_public_report.*` / `output/summary/pmodel_paper.*`（HTML/DOCX）

再現：
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）
- `python -B scripts/summary/paper_build.py --mode publish`（Table 1＋HTML＋DOCX）


---

## 2026-01-09（UTC） Phase 12.3：GWTC-3（O3b）からBBH/NSBHを追加し online→offline 再現確認

目的：
- 新しいカタログ（GWTC-3-confident）のイベントを追加し、オンライン取得→キャッシュ固定→`--offline` 再現が同一手順で動くことを確認する。
- 注：GWTC-3-confident には BNS が無いため、BNSの代わりに NSBH を追加（BBH/NSBH）。

追加（イベント）：
- BBH：GW200129_065458（GWTC-3-confident）
- NSBH：GW200115_042309（GWTC-3-confident, chirp抽出は whiten+guided STFT が必要）

変更：
- `data/gw/event_list.json`
  - 上記2イベントを追加（GW200115_042309 は `--whiten --stft-guided --track-window=-2,-0.1 --track-frange=70,500` を付与）。
- `data/gw/gw200115_042309/` / `data/gw/gw200129_065458/`
  - event JSON と strain（32秒, 4 kHz）のキャッシュを追加（以後 `--offline` で再現可能）。
- `doc/paper/10_manuscript.md` / `doc/paper/01_figures_index.md`
  - 論文側の多イベント補足に追加イベントの図を追記し、図一覧にも登録（paper_lint warnings=0 を維持）。

出力（追加/更新）：
- `output/gw/gw200115_042309_*`（png/public/png/metrics）
- `output/gw/gw200129_065458_*`（png/public/png/metrics）
- `output/gw/gw_multi_event_summary*.png`（イベント追加で更新）
- `output/summary/paper_table1_results.*`（GW行が増える）
- `output/summary/pmodel_public_report.*` / `output/summary/pmodel_paper.*`（HTML/DOCX）

再現：
- （オンライン）`python -B scripts/gw/gw150914_chirp_phase.py --event GW200115_042309 --catalog GWTC-3-confident --version auto --detectors H1,L1,V1 --whiten --stft-guided --f-lo 70 --f-hi 800 --track-window=-2,-0.1 --track-frange=70,500 --wave-frange=70,300`
- （オンライン）`python -B scripts/gw/gw150914_chirp_phase.py --event GW200129_065458 --catalog GWTC-3-confident --version auto --detectors H1,L1,V1 --wave-frange=70,300`
- （オフライン）`python -B scripts/summary/run_all.py --offline`（HTML+DOCX）
- （オフライン）`python -B scripts/summary/paper_build.py --mode publish`（Table 1＋HTML＋DOCX）


---

## 2026-01-09（UTC） Phase 15.1：match短窓（過大評価）を検知して省略し、Table 1 と要約図へ反映

目的：
- 一部イベントで `match=1.0` が出ていたが、原因は波形match窓が極端に短い（`n_window` が 1〜4）ことで、2自由度（振幅/位相）に対して過剰に当てはまり **過大評価** になり得る点を解消する。
- Table 1 と複数イベント要約図で誤解を招かないよう、短窓は **matchを省略（理由付き）** に統一する。

変更：
- `scripts/gw/gw150914_chirp_phase.py`
  - 波形match窓が短すぎる場合（`min_match_samples=64` または `min_match_duration_s=0.01` 未満）は `ok=0`・`reason=match_window_too_short` として match を無効化。
  - `window_duration_s` と閾値（min_*）を `*_metrics.json` に記録し、原因追跡を容易化。
- `scripts/summary/paper_tables.py`
  - GW行で match が欠損した場合、`match=省略（短窓 n=...）` の形で指標欄へ明示。
  - `metric_public` に「短窓などでmatchを省略する場合あり」を追記。
- `scripts/gw/gw_multi_event_summary.py`
  - match省略の理由を集計し、図注記と `*_metrics.json`（`match_omitted_by_reason`）へ反映。

出力（更新）：
- `output/gw/gw151226_chirp_phase_metrics.json`（H1 の match を省略: 短窓 n=2）
- `output/gw/gw200129_065458_chirp_phase_metrics.json`（H1 の match を省略: 短窓 n=1）
- `output/gw/gw200224_222234_chirp_phase_metrics.json`（H1 の match を省略: 短窓 n=4）
- `output/gw/gw_multi_event_summary_metrics.json`（`match_omitted_by_reason.match_window_too_short=3`）
- `output/summary/paper_table1_results.*`（GW指標欄へ省略注記を反映）
- `output/summary/pmodel_public_report.*` / `output/summary/pmodel_paper.*`（HTML/DOCX）

再現：
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）
- `python -B scripts/summary/paper_build.py --mode publish`（Table 1＋HTML＋DOCX）


---

## 2026-01-09（UTC） Phase 15.2：GWイベントに SNR/FAR メタ情報を付与し、要約図に併記

目的：
- “強いイベントほど合う/崩れる” の傾向確認のため、イベント強度（SNR）と信頼度（FAR）を併記する。

変更：
- `data/gw/event_list.json` に `meta`（`network_snr`, `far_yr`, `p_astro`）を追加。
- `scripts/gw/gw_multi_event_summary.py` で SNR/FAR を要約図の x ラベルへ併記（public図はSNRのみ）。

出力（更新）：
- `output/gw/gw_multi_event_summary.png` / `output/gw/gw_multi_event_summary_public.png`
- `output/gw/gw_multi_event_summary_metrics.json`（`event_meta`）

再現：
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）
- `python -B scripts/summary/paper_build.py --mode publish`（Table 1＋HTML＋DOCX）


---

## 2026-01-09（UTC） Phase 15.3 準備：検出器別の失敗集計を追加し、存在しない検出器指定を除去

目的：
- Step 15.3（既定値調整）に向け、`fit_failed` 等を検出器別に集計して“どこが弱いか”を見える化する。
- `strain_not_available`（一次データに存在しない検出器）を event_list から除去してノイズを減らす。

変更：
- `scripts/gw/gw_event_list_diagnostics.py` に `detector_stats` と全体集計（`detectors.*`）を追加。
- `data/gw/event_list.json` で GW190425 から H1、GW191216_213338 から L1 を除去（一次データに存在しないため）。

出力（更新）：
- `output/gw/gw_event_list_diagnostics.json`（検出器別集計、`strain_not_available=0`）

再現：
- `python -B scripts/summary/run_all.py --offline`（metrics生成）
- `python -B scripts/gw/gw_event_list_diagnostics.py`


---

## 2026-01-10（UTC） Step 16.4：BAO多系統差を σ_sys として併合priorへ導入（診断）

目的：
- BAO一次ソース（BOSS/eBOSSなど）の `s_R` 推定差が、併合priorを過剰にタイトにして「必要f（BAO σの膨張）」を押し上げていないかを、診断目的で定量化する。

変更：
- `scripts/cosmology/cosmology_distance_indicator_rederivation_bao_survey_sensitivity.py`
  - BAO比の global prior に、survey間差を系統幅 `σ_sys` として二乗和で加算する variant を追加。
  - 定義：`σ_total^2 = σ_stat^2 + σ_sys^2`、`σ_sys = 0.5*|s_R(BOSS)-s_R(eBOSS)|`
- `scripts/cosmology/cosmology_tension_attribution.py`
  - 上記 variant を張力要約へ統合（併合priorの必要fがどこまで下がるかを可視化）。
- `doc/paper/10_manuscript.md`
  - `σ_sys` 導入で必要fが大きく変わり得る点を追記（例：併合 statのみ `f≈36` → 併合+`σ_sys` で `f≈6.7`）。

出力（更新）：
- `output/cosmology/cosmology_distance_indicator_rederivation_bao_survey_global_prior_sigma_scan.png`
- `output/cosmology/cosmology_distance_indicator_rederivation_bao_survey_global_prior_sigma_scan_metrics.json`
- `output/cosmology/cosmology_tension_attribution.png`
- `output/cosmology/cosmology_tension_attribution_metrics.json`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`

再現：
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）


---

## 2026-01-10（UTC） Step 16.4/16.5：張力要約図に BAO 多系統/leave-one-out の必要 f を統合

目的：
- 宇宙論の張力（DDR/BAO/Tolman）が「観測のどの前提」に集中しているかを、BAO の多系統差（BOSS/eBOSS/併合）と leave-one-out の必要緩和量 f（σ→fσ）まで含めて 1枚で把握できるようにする。

変更：
- `scripts/cosmology/cosmology_tension_attribution.py`
  - `cosmology_distance_indicator_rederivation_bao_survey_*_metrics.json` を読み込み、
    - 単一prior（α,s_L）で全DDR行を 1σ 同時整合に入れるための必要 f（BOSS/eBOSS/併合）
    - 併合fit leave-one-out（Lyα z=2.33 を除外した場合の f の低下）
    を要約欄に追記。
  - `output/cosmology/cosmology_tension_attribution_metrics.json` にも同じ要約値を記録。

出力（更新）：
- `output/cosmology/cosmology_tension_attribution.png`
- `output/cosmology/cosmology_tension_attribution_metrics.json`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`（更新）

再現：
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）


---

## 2026-01-10（UTC） Step 16.4：BAO併合fitのleave-one-outが必要緩和量 f に与える影響を追加

目的：
- BAO(s_R) の prior が「どの点に支配されているか」を、距離指標の再導出（単一priorで全DDR行を1σ同時整合）に必要な緩和量 f（σ→fσ）へ直接接続して確認する。

変更：
- `scripts/cosmology/cosmology_distance_indicator_rederivation_bao_survey_sensitivity.py`
  - BAO併合fitの leave-one-out で得られた (s_R,σ) を BAO prior として採用し、単一prior（α,s_L）で全DDR行を 1σ同時整合に入れるための必要 f を推定する新図を追加。
- `doc/paper/10_manuscript.md` / `doc/paper/01_figures_index.md`
  - 新図の追加と所見追記（Lyα z=2.33 を除外すると必要 f が約半分まで下がるが、それでも依然大きい）。

出力（追加）：
- `output/cosmology/cosmology_distance_indicator_rederivation_bao_survey_leave_one_out_global_prior_sigma_scan.png`
- `output/cosmology/cosmology_distance_indicator_rederivation_bao_survey_leave_one_out_global_prior_sigma_scan_metrics.json`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`（更新）

再現：
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）


---

## 2026-01-10（UTC） Step 16.4：BAO多系統fitの点ごとの張力（χ²寄与）を可視化

目的：
- BAO（BOSS/eBOSS）併合の fit で張力（χ²/dof>1）が残る点について、「どの点（z, 系統）が支配しているか」を固定し、観測起因の可能性（特定点の系統）とモデル起因を切り分けやすくする。

変更：
- `scripts/cosmology/cosmology_bao_distance_ratio_fit.py`
  - per_point に、共分散を含む点ごとの χ²寄与（chi2_contrib）と √χ²（目安）を追加。
  - 併合fit の点ごとの √χ²寄与を棒グラフで可視化する図を追加。
- `doc/paper/10_manuscript.md` / `doc/paper/01_figures_index.md`
  - 論文に図を追加し、BOSS z=0.38 と eBOSS QSO z=1.48 などが張力を支配する点を明記。

出力（追加）：
- `output/cosmology/cosmology_bao_distance_ratio_fit_residuals.png`

所見（この整理の範囲）：
- 併合fit では、BOSS（z=0.38）と eBOSS QSO（z=1.48）の √χ²寄与が大きく、張力の主要因となっている。

再現：
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）


---

## 2026-01-10（UTC） Step 16.4：BAO多系統fitの leave-one-out 感度を追加（支配点の切り分け）

目的：
- 併合fit の張力（χ²/dof>1）と s_R が「特定点の系統」なのか「高z点による拘束の強さ」なのかを切り分けるため、点を1つ落とした場合の感度（leave-one-out）を固定する。

変更：
- `scripts/cosmology/cosmology_bao_distance_ratio_fit.py`
  - 併合fit の leave-one-out（点を1つ落として再fit）を追加し、s_R と χ²/dof の変化を図で可視化。
  - metrics に `results.combined_leave_one_out`（各点dropの簡約fit）を追加。
- `doc/paper/10_manuscript.md` / `doc/paper/01_figures_index.md`
  - 論文に図を追加し、Lyα（z=2.33）など高z点が s_R を強く拘束している点を明記。

出力（追加）：
- `output/cosmology/cosmology_bao_distance_ratio_fit_leave_one_out.png`

所見（この整理の範囲）：
- eBOSS Lyα（z=2.33）を落とすと χ²/dof は ≈1.48 まで下がる一方、s_R は -0.05±0.04 程度へ大きくシフトし、結論が高z点に強く依存する。

再現：
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）


---

## 2026-01-10（UTC） Step 16.4：BAO一次ソース（BOSS/eBOSS）の感度を追加（単一priorで1σ同時整合に必要な f）

目的：
- Step 16.4 の「再接続」探索において、BAO(s_R) の prior が支配拘束になり得る点について、共分散モード差だけでなく「どのBAO一次ソースを採るか（BOSS/eBOSS/併合）」でも必要な緩和量 f（σ→fσ）が変わることを固定する。

変更：
- `scripts/cosmology/cosmology_distance_indicator_rederivation_bao_survey_sensitivity.py`
  - BAOの一次ソース（BOSS DR12: D_M,H fit / BAO比: BOSSのみ / eBOSSのみ / 併合）ごとに、単一prior（α,s_L）で全DDRの worst max|z|≤1 となる f を推定し、棒グラフで可視化。
- `scripts/summary/run_all.py`
  - タスク `cosmology_distance_indicator_rederivation_bao_survey_sensitivity` を追加し、`run_all --offline` で再現可能に。
- `doc/paper/10_manuscript.md` / `doc/paper/01_figures_index.md`
  - 論文に図を追加し、BAO一次ソース差（BOSS/eBOSS）が必要fに与える影響を明記。

出力（追加）：
- `output/cosmology/cosmology_distance_indicator_rederivation_bao_survey_global_prior_sigma_scan.png`
- `output/cosmology/cosmology_distance_indicator_rederivation_bao_survey_global_prior_sigma_scan_metrics.json`

所見（この整理の範囲）：
- BOSS系（baseline / BAO比BOSSのみ）では **f≈7.7** 程度である一方、eBOSSのみでは **f≈21**、BOSS+eBOSS併合では **f≈36** 程度まで増加する。
- よって、BAOが高zまで tight に s_R を拘束する（併合）場合ほど、「単一priorで距離指標の整合を得る」ための緩和量は大きくなる。

再現：
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）


---

## 2026-01-10（UTC） Step 16.4：BAO(s_R) fit 前提（共分散モード）感度を全DDR行に伝播

目的：
- BAO(s_R) の一次データfit（BOSS DR12）の前提（共分散の扱い：block/diag/full など）が、再導出候補探索（candidate_search: best_independent）の結論（max|z|）にどの程度影響するかを、全DDR一次ソースで固定する。

変更：
- `scripts/cosmology/cosmology_distance_indicator_rederivation_bao_mode_sensitivity.py`
  - `output/cosmology/cosmology_bao_scaled_distance_fit_sensitivity_metrics.json` に含まれる各モードの (s_R, σ) を BAO prior として読み込み、
    best_independent を全DDR行で再計算し、max|z| の行列として可視化。
  - 追記：各BAOモードについて、単一prior（α,s_L）を固定した場合の BAO soft constraint（σ→fσ）スキャンを行い、全DDRで worst max|z|≤1 に必要な f を推定。
- `scripts/summary/run_all.py`
  - タスク `cosmology_distance_indicator_rederivation_bao_mode_sensitivity` を追加し、`run_all --offline` で再現可能に。
- `doc/paper/10_manuscript.md` / `doc/paper/01_figures_index.md`
  - 論文に図を追加し、BAO prior の感度（共分散モード差）と「追加緩和（f）」の関係を明確化。

出力（追加）：
- `output/cosmology/cosmology_distance_indicator_rederivation_bao_mode_sensitivity.png`
- `output/cosmology/cosmology_distance_indicator_rederivation_bao_mode_sensitivity_metrics.json`
- `output/cosmology/cosmology_distance_indicator_rederivation_bao_mode_global_prior_sigma_scan.png`
- `output/cosmology/cosmology_distance_indicator_rederivation_bao_mode_global_prior_sigma_scan_metrics.json`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`

所見（この整理の範囲）：
- block/diag/full の範囲では max|z|≤1 に入るのは 16行中4行に留まり、Hのみ（最も緩い側の感度）でも 8行に留まる。
- 単一prior（α,s_L）を固定した場合の 1σ同時整合に必要な f は、block/diag/full で概ね 7〜9 程度、Hのみでは約3程度となる（この範囲で「共分散モード差」だけでは 1σ同時整合にならない点は不変）。
- したがって「全DDR行を 1σ 同時整合」にするには、共分散モード差の範囲を超えた追加緩和（f の増大）や、距離指標定義そのものの再導出が必要になる。

再現：
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）


---

## 2026-01-10（UTC） Step 16.4：BAO(s_R) 緩和の必要量を全DDR行で可視化（max|z| 行列）

目的：
- 距離指標の再導出候補探索（candidate_search）の「BAO(s_R) が支配拘束（limiting）になり得る」点を、代表例ではなく全DDR一次ソースで固定する。
- BAO(s_R) を soft constraint として緩めた場合（σ→fσ）に、best_independent の max|z| がどの程度まで低下するかを一覧化し、「1σ到達に必要な f」の目安を残す。

変更：
- `scripts/cosmology/cosmology_distance_indicator_rederivation_bao_relax_thresholds.py`
  - BAO σスケール f の系列（既定：1, 1.5, 2, 2.5, 3, 4, 6, 10）で、全DDR行の best_independent の max|z| を再計算し、色分け行列で出力。
  - 各DDR行について、max|z|≤1 / ≤3 に到達する最小 f（対数x補間）を metrics に固定。
- `scripts/summary/run_all.py`
  - タスク `cosmology_distance_indicator_rederivation_bao_relax_thresholds` を追加し、`run_all --offline` で再現可能に。
- `doc/paper/10_manuscript.md` / `doc/paper/01_figures_index.md`
  - 論文に図を追加し、宇宙論（再接続）節の BAO soft constraint 議論を全DDR行へ一般化。

出力（追加）：
- `output/cosmology/cosmology_distance_indicator_rederivation_bao_relax_thresholds.png`
- `output/cosmology/cosmology_distance_indicator_rederivation_bao_relax_thresholds_metrics.json`

所見（この整理の範囲）：
- スキャン範囲（f≤10）では、全DDR行で max|z|≤1 に到達する（ただし f は診断用ノブであり、BAO誤差が実際に f 倍である主張ではない）。
- 「全DDR行で 1σ 同時整合」を満たすために必要な f は最大で約8、中央値は約5 程度となる（DDR σは `category_sys` を使用）。

再現：
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）


---

## 2026-01-10（UTC） Step 16.4：一次ソース選択ルールの感度（scan vs tightest_fixed）

目的：
- Step 16.4 の候補探索（candidate_search）は「候補の中から min max|z| を選ぶ」ため、“緩い一次ソース” に寄る可能性がある。そこで、independent-only の中で最小σ（tightest）の α と s_L を固定した場合に、結論（max|z| と limiting）がどれだけ変わるかを固定する。

変更：
- `scripts/cosmology/cosmology_distance_indicator_rederivation_policy_sensitivity.py`
  - candidate_search の best_independent（scan）と、tightest_fixed（αとs_Lを最小σで固定）を DDR一次ソースごとに比較する図を追加。
  - metrics JSON に、固定した一次ソース（α, s_L）の情報と、各DDR行の fit を保存。
- `scripts/summary/run_all.py`
  - タスク `cosmology_distance_indicator_rederivation_policy_sensitivity` を追加。
- `doc/paper/10_manuscript.md` / `doc/paper/01_figures_index.md`
  - 論文に図を追加。

出力（追加）：
- `output/cosmology/cosmology_distance_indicator_rederivation_policy_sensitivity.png`
- `output/cosmology/cosmology_distance_indicator_rederivation_policy_sensitivity_metrics.json`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`

再現：
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）


---

## 2026-01-10（UTC） Step 16.4：α と s_L を単一priorに固定した全DDR整合の探索（worst max|z|）

目的：
- candidate_search は DDR一次ソースごとに α と s_L の一次ソース拘束を切り替えて最小 max|z| を選び得るため、物理的に一貫した“単一の prior（α, s_L）”が存在するかを固定する。
- α と s_L を 1つずつ固定した場合に、全DDR行の「最悪 max|z|」がどの程度まで下がるか（頑健性）を可視化する。

変更：
- `scripts/cosmology/cosmology_distance_indicator_rederivation_global_prior_search.py`
  - α と s_L の一次ソースを **1つずつ固定**し、全DDR行の worst max|z| が最小となる組合せを探索。
  - 全候補（BAO/CMB/CDDR を含む）と、独立一次ソースのみ（uses_bao/uses_cmb/assumes_cddr を除外）の2通りを並べて出力。
  - 追記：BAO(s_R) の prior を soft constraint として緩めた場合（σ→fσ）のスキャンを追加し、単一priorで 1σ同時整合に必要な f を推定。
- `scripts/summary/run_all.py`
  - タスク `cosmology_distance_indicator_rederivation_global_prior_search` を追加し、`run_all --offline` で再現可能に。
- `doc/paper/10_manuscript.md` / `doc/paper/01_figures_index.md`
  - 論文に図を追加し、DDRごとの最適prior選択が結果を過度に楽観し得る点を明記。

出力（追加）：
- `output/cosmology/cosmology_distance_indicator_rederivation_global_prior_search.png`
- `output/cosmology/cosmology_distance_indicator_rederivation_global_prior_search_metrics.json`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`

出力（追記）：
- `output/cosmology/cosmology_distance_indicator_rederivation_global_prior_search_bao_sigma_scan.png`
- `output/cosmology/cosmology_distance_indicator_rederivation_global_prior_search_bao_sigma_scan_metrics.json`

所見（この整理の範囲）：
- f=1（BAO σそのまま）では、全候補を使っても全DDRの worst max|z| は約2.4σ、独立一次ソースのみでも約2.5σ 程度に留まる。
- BAO(s_R) を緩めるスキャンでは、**1σ同時整合**に入るには **f≈7.8**（スキャンでは f=8 で worst≈0.98）が必要になる。
- よって「全DDR行を 1σ 同時整合」に揃えるのは難しい一方で、全DDR行を 3σ 以内に収める組合せは存在する。

再現：
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）


---

## 2026-01-10（UTC） Step 16.4：limiting集計の改善（ソート＋選択一次ソースの頻度）

目的：
- Step 16.4 の “どこが支配しているか” をさらに読みやすくし、再接続候補探索（min max|z|）が「どの一次ソース拘束（α / s_L）」に依存しやすいか（選択バイアス）も固定する。

変更：
- `scripts/cosmology/cosmology_distance_indicator_rederivation_limiting_summary.py`
  - best_independent の max|z| でソートし、候補が良い順に見えるよう改善。
  - metrics に、選択された一次ソース（opacity/candle）の内訳と頻度を追加。
- `scripts/cosmology/cosmology_distance_indicator_rederivation_selected_sources.py`
  - candidate_search で選ばれた α と s_L の一次ソース拘束の頻度を可視化（best_any vs best_independent）。
- `doc/paper/10_manuscript.md` / `doc/paper/01_figures_index.md`
  - 論文に図を追加し、探索が特定一次ソースに依存し得る点を明記。

出力（追加/更新）：
- `output/cosmology/cosmology_distance_indicator_rederivation_limiting_summary.png`
- `output/cosmology/cosmology_distance_indicator_rederivation_limiting_summary_metrics.json`
- `output/cosmology/cosmology_distance_indicator_rederivation_selected_sources.png`
- `output/cosmology/cosmology_distance_indicator_rederivation_selected_sources_metrics.json`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`

再現：
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）


---

## 2026-01-10（UTC） Step 16.4：再接続候補の支配拘束（limiting）を固定（集計図）

目的：
- 距離指標の再導出候補探索（candidate_search）の結果から、DDR一次ソースごとに「どの拘束が支配（limiting）して max|z| を決めているか」を固定出力し、Step 16.4（どこが支配しているかを固定）を前進する。

変更：
- `scripts/cosmology/cosmology_distance_indicator_rederivation_limiting_summary.py`
  - `output/cosmology/cosmology_distance_indicator_rederivation_candidate_search_metrics.json` を入力に、best_any / best_independent の max|z| と limiting を集計し、色（支配拘束）＋斜線（best_independent）で可視化。
  - 同内容を metrics JSON として固定出力（counts/rows）。
- `scripts/summary/run_all.py`
  - タスク `cosmology_distance_indicator_rederivation_limiting_summary` を追加し、`run_all --offline` で再現可能に。
- `scripts/summary/worklog.py`
  - `outputs` など Path の配列を正規化して JSONL ログに追記できるよう修正。
- `doc/paper/10_manuscript.md` / `doc/paper/01_figures_index.md`
  - 論文に図を追加し、paper_lint で警告が出ない状態にした。

出力（追加）：
- `output/cosmology/cosmology_distance_indicator_rederivation_limiting_summary.png`
- `output/cosmology/cosmology_distance_indicator_rederivation_limiting_summary_metrics.json`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`

再現：
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）


---

## 2026-01-10（UTC） Step 16.5.4：SNIa+BAO / SNIa+H(z) の一次ソース追加で σ_cat を補完（DDR系統幅の穴埋め）

目的：
- Step 16.5.3 の整理では、カテゴリ内に複数行が無い SNIa+BAO / SNIa+H(z) について σ_cat を置けず、棄却度の頑健性評価に穴が残っていた。
- 一次ソース（既存の統合解析ではない/依存関係を明示できるもの）を追加し、カテゴリ内の広がりから σ_cat を推定できる状態にする。

変更：
- `data/cosmology/distance_duality_constraints.json`
  - 追加（一次ソース固定）：
    - BAO+SNIa（2013）
    - JLA+H(z)（2015）
    - Union2.1+H(z)（2014）
    - H(z)+JLA（2017, no H0 prior）
- `data/cosmology/sources/`
  - 上記に対応する一次ソースPDFを保存（`local_pdf` 参照）。
- `scripts/cosmology/cosmology_distance_duality_systematics_envelope.py`
  - SNIa+BAO / SNIa+H(z) にも複数行が入った前提に合わせ、出力JSONの assumptions 表記を更新。

出力（更新）：
- `output/cosmology/cosmology_distance_duality_constraints.png`
- `output/cosmology/cosmology_distance_duality_systematics_envelope.png`
- `output/cosmology/cosmology_distance_duality_systematics_envelope_metrics.json`

主要な数値（例）：
- SNIa+BAO の σ_cat≈0.128（n=2）により、代表（SNIa+BAO 2021）の棄却は |z|=34.93 → 7.75 に緩む（ただし依然として強い張力）。
- SNIa+H(z) の σ_cat≈0.0465（n=4）。

再現：
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）


---

## 2026-01-10（UTC） Step 16.5.5：DDRの採用ポリシーを固定し、Table 1 / スコアボードのDDR行を「代表＋σ_cat注記」に整理

目的：
- DDR（距離二重性）は一次ソース（距離指標）の前提に強く依存し、単一の強い制約だけで「即棄却/即合致」と読めてしまう危険がある。
- 論文/一般向け双方で、DDRの扱いを「代表1行（最も厳しい/代表）＋同一カテゴリ内のモデル差（σ_cat）を併記」に統一し、読み手の誤解を減らす。

変更：
- `scripts/summary/validation_scoreboard.py`
  - DDR行に `σ_cat込み|z|` と `σ_cat` を追記（no-BAO最小|z| も raw→sys を併記）。
- `scripts/summary/paper_tables.py`
  - Table 1 の DDR 行で、`Z_sys`（σ_cat込み）と `σ_cat` を `metric` に追加。
  - 一般向け列（`metric_public`）にも σ_cat込みの棄却度（σ）を追記。
- `doc/paper/10_manuscript.md`
  - SNIa+BAO / SNIa+H(z) の σ_cat を 0 としていた古い注記を更新（一次ソース追加後の値に合わせる）。

出力（更新）：
- `output/summary/paper_table1_results.*`
- `output/summary/validation_scoreboard.*`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`

再現：
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）


---

## 2026-01-10（UTC） Step 16.4：再接続候補探索（α/s_L/s_R）の評価に DDR の σ_cat を反映（過信を避ける）

目的：
- 「合致する再接続パターンが存在するか」を探索する際、DDR側の不確かさ（モデル差/系統）を無視すると、候補の優劣を過信しやすい。
- Step 16.5.3/16.5.4 の σ_cat を、再導出候補探索（WLS）にも反映して一貫性を上げる。

変更：
- `scripts/cosmology/cosmology_distance_indicator_rederivation_candidate_search.py`
  - `--ddr-sigma-policy`（raw / category_sys）を追加し、デフォルトを `category_sys` に設定。
  - `output/cosmology/cosmology_distance_duality_systematics_envelope_metrics.json` が存在する場合、DDRの `ε0_sigma` を σ_cat込みの `σ_total` へ置換して評価。
- `scripts/cosmology/cosmology_distance_indicator_rederivation_candidate_matrix.py`
  - 同様に `--ddr-sigma-policy` を追加し、デフォルト `category_sys` で評価。

出力（更新）：
- `output/cosmology/cosmology_distance_indicator_rederivation_candidate_search.png`
- `output/cosmology/cosmology_distance_indicator_rederivation_candidate_search_metrics.json`
- `output/cosmology/cosmology_distance_indicator_rederivation_candidate_matrix.png`
- `output/cosmology/cosmology_distance_indicator_rederivation_candidate_matrix_metrics.json`

再現：
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）


---

## 2026-01-10（UTC） Step 16.5（入口）：張力の原因切り分け図を追加（距離指標依存 vs 独立プローブ）

目的：
- Step 16.5 として、宇宙論の張力が「距離指標（標準光源/標準定規）の前提」に集中しているのか、あるいは背景P（静的無限）そのものが独立プローブで棄却されるのかを切り分ける入口を作る。

変更：
- `scripts/cosmology/cosmology_tension_attribution.py`
  - 既存の一次ソース制約（metrics）を統合し、|z|の棒グラフ＋要点（DDR/BAO/Tolman/独立プローブ）を 1枚に要約。
- `scripts/summary/run_all.py`
  - 新タスク `cosmology_tension_attribution` を追加（`run_all --offline` で自動生成）。
- `scripts/summary/public_dashboard.py`
  - 公開レポート（宇宙論セクション）に「張力の原因切り分け」カードを追加。
- `doc/paper/10_manuscript.md`
  - Step 16.5 の方針と新図への参照を追記。
- `doc/paper/01_figures_index.md`
  - 新図を図表インデックスへ追加（lint警告を出さないため）。

出力（追加/更新）：
- `output/cosmology/cosmology_tension_attribution.png`
- `output/cosmology/cosmology_tension_attribution_metrics.json`
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`

再現：
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）


---

## 2026-01-10（UTC） Step 16.4：eBOSS異方的BAOの D_M–D_H 相関を一次ソースで反映し、s_R 推定を更新

目的：
- eBOSS DR16（LRG/QSO/Lyα）の距離比（D_M/r_d, D_H/r_d）で、D_M と D_H の相関（corr_DM_DH）が 0 仮定になっていたため、一次ソース（共分散行列/ρ）から追跡して反映し、BAO(s_R) 推定の不確かさ過小評価を解消する。

変更：
- `data/cosmology/bao_anisotropic_distance_ratio_constraints.json`
  - eBOSS 3点の `corr_DM_DH` を一次ソースから反映：
    - LRG（2007.08993）：`corr≈-0.239`（Eq.57; 本文表記は -24%）
    - QSO（2007.08998）：`corr≈+0.125`（Eq.44; Cλ）
    - Lyα（2007.08995）：`corr=-0.45`（Eq.43; all combined）
  - `sigma_note` も一次ソース根拠（式番号/行列）つきに更新。
- `doc/paper/10_manuscript.md`
  - BOSS-only / eBOSS-only / 併合の `s_R` 推定値を更新し、「相関未追跡」の注記を削除。

結果（主要数値）：
- `output/cosmology/cosmology_bao_distance_ratio_fit_metrics.json`
  - BOSS-only：`s_R≈-0.041±0.097`（1σ, χ²/dof≈2.51）
  - eBOSS-only：`s_R≈0.138±0.026`（1σ, χ²/dof≈1.30）
  - 併合：`s_R≈0.083±0.017`（1σ, χ²/dof≈2.37）

出力（更新）：
- `output/cosmology/cosmology_bao_distance_ratio_fit.png`
- `output/cosmology/cosmology_bao_distance_ratio_fit_metrics.json`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`

再現：
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）


---

## 2026-01-10（UTC） Step 16.4（再接続探索）：BAO(s_R) soft constraint の “1σ到達に必要な緩和量 f” を算出・図へ反映

目的：
- 「BAO(s_R) が支配拘束」という結論を、単に系列を眺めるのではなく、「代表（BAO含むDDR）が 1σ を満たすには BAO σ を何倍に緩める必要があるか（f）」として定量化する。

変更：
- `scripts/cosmology/cosmology_distance_indicator_rederivation_candidate_search.py`
  - BAO σスケールスキャン図に、max|z|≤1 の達成に必要な f を（log-x補間で）推定し、縦線で注記。
  - scan metrics に `results.thresholds.rep_bao_f_for_max_abs_z_le_1sigma` 等を追加。
- `doc/paper/10_manuscript.md`
  - 代表（BAO含むDDR）が 1σ を満たすために必要な緩和量 **f≈6.80** を本文に追記。

出力（更新）：
- `output/cosmology/cosmology_distance_indicator_rederivation_candidate_search_bao_sigma_scan.png`
- `output/cosmology/cosmology_distance_indicator_rederivation_candidate_search_bao_sigma_scan_metrics.json`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`

再現：
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）


---

## 2026-01-10（UTC） Step 16.4（再接続探索）：候補探索図に代表（BAO含む/なしDDR）の詳細を併記し、支配拘束を可視化

目的：
- 再接続（α / s_L / s_R）の“どの拘束が支配的か”を、棒グラフだけでなく代表ケースの具体値（θ, 上位z, 採用一次ソース）として読める形にし、次の検証方針（BAO定規/距離指標の再導出）へ接続する。

変更：
- `scripts/cosmology/cosmology_distance_indicator_rederivation_candidate_search.py`
  - 右パネルに代表（BAO含むDDR / BAOなしDDR）の best_any / best_independent の詳細（θ、上位z、採用一次ソース）を表示。
- `doc/paper/10_manuscript.md`
  - 代表（BAO含むDDR / BAOなしDDR）の best_independent の θ と max|z| を本文に追記。

出力（更新）：
- `output/cosmology/cosmology_distance_indicator_rederivation_candidate_search.png`
- `output/cosmology/cosmology_distance_indicator_rederivation_candidate_search_metrics.json`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`

再現：
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）


---

## 2026-01-10（UTC） Step 16.3（棄却条件）：宇宙論パックと本文に z_limit（誤差予算 opt_total 3σ）を明記

目的：
- 宇宙論の張力が「距離指標側（DDR）」に集中している点について、“どのzまで誤差で隠せるか” を同じ図/本文で即座に読める形にし、棄却条件（到達限界）を明確化する。

変更：
- `scripts/cosmology/cosmology_static_infinite_hypothesis_pack.py`
  - DDR行の注記に、誤差予算（opt_total 3σ）の `z_limit` を追記。
  - no-BAO代表は最楽観スキャン条件（bin幅0.05, n≥8）も併記。
- `doc/paper/10_manuscript.md`
  - `z_limit`（3σ）の代表値（BAO含む: z≈0.048 / BAOなし最楽観: z≈0.201）を本文で明記。

出力（更新）：
- `output/cosmology/cosmology_static_infinite_hypothesis_pack.png` / `output/cosmology/cosmology_static_infinite_hypothesis_pack_metrics.json`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`

再現：
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）


---

## 2026-01-10（UTC） Step 16.2（距離指標）：再導出要件図のスキャン注記を簡略化（データセット名＋条件のみ）

目的：
- 「最楽観スキャン」の注記が長くなりやすいため、データセット名（Pantheon+ SH0ES HF）と最小限の条件（bin幅/最低点数）のみに絞って可読性を上げる。

変更：
- `scripts/cosmology/cosmology_distance_indicator_rederivation_requirements.py`
  - スキャン注記を「データセット名＋bin幅＋n≥」の短い形式に変更。

出力（更新）：
- `output/cosmology/cosmology_distance_indicator_rederivation_requirements.png`
- `output/cosmology/cosmology_distance_indicator_rederivation_requirements_metrics.json`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`

再現：
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）


---

## 2026-01-10（UTC） Step 16.2（距離指標）：最楽観 z_limit（“誤差で隠せる”上限）のスキャン条件を再導出要件図へ反映

目的：
- 距離指標側の張力（DDR）の議論で使う「誤差で隠せる上限 z_limit」について、最楽観値がどの前処理（bin幅/最低点数）で出ているかを明示し、誤解を減らす。

変更：
- `scripts/cosmology/cosmology_distance_indicator_rederivation_requirements.py`
  - 右パネルの z_limit 表示に「最楽観スキャン（Pantheon+ SH0ES HF; bin幅/最低点数）」を追記。
  - metrics に `z_limit_scan_best` を追加（再現用）。

出力（更新）：
- `output/cosmology/cosmology_distance_indicator_rederivation_requirements.png`
- `output/cosmology/cosmology_distance_indicator_rederivation_requirements_metrics.json`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`

再現：
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）


---

## 2026-01-10（UTC） Step 14.2.31：標準サイレン（GW）由来の不透明度拘束（forecast）を追加し、再導出候補探索へ統合

目的：
- 距離指標（SNe Ia / BAO）と独立に不透明度 α を拘束し得るプローブとして、標準サイレン（GW）を追加する。
- α が強く縛られた場合に、静的背景P最小（ε0=-1）の“再接続”候補（best_independent）の上限がどう変化するかを、参考シナリオとして可視化する。

変更：
- `data/cosmology/sources/arxiv_1902.01702.pdf`（Qi+2019）を追加（GW+SNe Ia による不透明度テスト、ET forecast）。
- `data/cosmology/gw_standard_siren_opacity_constraints.json` を追加（Pantheon+ET forecast の ϵ を α に換算した固定入力）。
- `scripts/cosmology/cosmology_distance_indicator_rederivation_candidate_search.py`
  - GW標準サイレン由来の不透明度拘束（α）を読み込み、tightest α を固定した `best_independent_gw_sirens` を追加。
  - `output/cosmology/cosmology_distance_indicator_rederivation_candidate_search.png` を 3系列（best_any / best_independent / best_independent_gw_sirens）に拡張。
- `doc/paper/10_manuscript.md` / `doc/paper/20_data_sources.md` / `doc/paper/30_references.md`
  - Qi+2019 を追記し、GW系列が ET の将来予測である点を明記。

出力（更新）：
- `output/cosmology/cosmology_distance_indicator_rederivation_candidate_search.png`
- `output/cosmology/cosmology_distance_indicator_rederivation_candidate_search_metrics.json`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`

再現：
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）


---

## 2026-01-10（UTC） Step 14.2.30：BAO非依存の距離/DDRプローブ拡充（強重力レンズ/電波コンパクトソース）

目的：
- DDR（距離二重性）の“BAOなし”一次ソースを増やし、静的背景P最小（ε0=-1）の棄却度レンジ（independent側の上限）を再評価する。

変更：
- `data/cosmology/distance_duality_constraints.json`
  - 強重力レンズ（SGL）+SNe Ia+GRB の DDR テスト（Holanda+2016）を追加（power-law `η=(1+z)^η0` → `ε0=η0`、Table I は 2σ のため 1σは近似で対称化）。
  - SNe Ia + 電波コンパクトソース（Li & Lin 2017）を追加（一次ソースの η は `D_A(1+z)^2/D_L` 定義のため、本repoの η（`D_L/((1+z)^2 D_A)`）へ逆数換算し、z=1アンカーで ε0へ換算）。
- `doc/paper/10_manuscript.md`
  - BAOなしの直接比較として上記 2 系統を追記し、棄却度レンジの説明を更新。
- `doc/paper/20_data_sources.md` / `doc/paper/30_references.md`
  - 上記一次ソース（arXiv:1611.09426, arXiv:1710.11361）を追記。

出力（更新）：
- `output/cosmology/cosmology_distance_duality_constraints.png` / `output/cosmology/cosmology_distance_duality_constraints_metrics.json`（rows=12）
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`（本文更新）
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`
- `output/summary/validation_scoreboard.png` / `output/summary/validation_scoreboard.json`

再現：
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）
- `python -B scripts/cosmology/cosmology_distance_duality_constraints.py`


---

## 2026-01-10（UTC） Step 14.2.29：BAO(s_R) の多系統比較（BOSS/eBOSS）を追加し、BOSS DR12 依存を緩和

目的：
- Step 14.2.27/14.2.28 で BAO(s_R) が宇宙論（再導出候補探索）の limiting になりやすいことが分かったため、BOSS DR12 だけに依存せずに s_R を見積もれるよう、eBOSS DR16（LRG/QSO/Lyα）の異方的BAO（D_M/r_d, D_H/r_d）を同一形式で追加し、多系統での整合性を確認する。

変更：
- 一次ソースPDFを追加（ローカル保存）：
  - `data/cosmology/sources/arxiv_2007.08993.pdf`（eBOSS DR16 LRG）
  - `data/cosmology/sources/arxiv_2007.08998.pdf`（eBOSS DR16 QSO）
  - `data/cosmology/sources/arxiv_2007.08995.pdf`（eBOSS DR16 Lyα）
- `data/cosmology/bao_anisotropic_distance_ratio_constraints.json`
  - BOSS DR12（D_M×(r_d,fid/r_d), H×(r_d/r_d,fid)）を r_d,fid=147.78 Mpc（一次ソース記述）で D_M/r_d と D_H/r_d へ変換して追加。
  - eBOSS DR16（LRG/QSO/Lyα）の一次ソースが与える D_M/r_d と D_H/r_d を追加（相関は未追跡のため 0 として明記）。
- `scripts/cosmology/cosmology_bao_distance_ratio_fit.py`
  - 静的背景P + 定規進化 r_d(z)∝(1+z)^{s_R} の下で、距離比（D_M/r_d, D_H/r_d）を BOSSのみ / eBOSSのみ / 併合で fit し、s_R の安定性と張力（χ²/dof）を固定出力。
- `scripts/summary/run_all.py`
  - 上記スクリプトを run_all に統合（offline再現に含める）。
- 論文へ反映：
  - `doc/paper/10_manuscript.md` / `doc/paper/01_figures_index.md` / `doc/paper/20_data_sources.md` / `doc/paper/30_references.md`

出力（追加）：
- `output/cosmology/cosmology_bao_distance_ratio_fit.png`
- `output/cosmology/cosmology_bao_distance_ratio_fit_metrics.json`

主要結果（静的背景P + 単一 s_R の fit；1σ, Δχ²=1）：
- BOSSのみ（比へ変換）：s_R≈-0.042±0.097（BOSSの既存 fit（-0.033±0.094）と同程度）
- eBOSSのみ：s_R≈0.135±0.032
- 併合（BOSS+eBOSS）：s_R≈0.072±0.020（ただし χ²/dof>1 で張力が残る）

再現：
- `python -B scripts/cosmology/cosmology_bao_distance_ratio_fit.py`
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）


---

## 2026-01-10（UTC） Step 14.2.28：再導出候補探索に BAO σスケール（soft constraint）感度を統合

目的：
- Step 14.2.27（BAO(s_R) 推定の共分散感度）で「BAO(s_R) が best_independent の limiting になりやすい」ことが分かったため、候補探索（WLS）側でも BAO を soft constraint（σ→fσ）として扱った場合に、max|z| と limiting（支配する拘束）がどう動くかを定量化する。

変更：
- `scripts/cosmology/cosmology_distance_indicator_rederivation_candidate_search.py`
  - `--bao-sigma-scale`（BAO(s_R) の σスケール）を追加（既定=1.0）。
  - BAO σスキャン（既定 f=1,1.5,2,2.5,3,4,6,10）を追加し、固定名で図と metrics を出力。
  - 自動ログに Step 14.2.28 のイベントを追加（`output/summary/work_history.jsonl`）。
- `doc/paper/10_manuscript.md` / `doc/paper/01_figures_index.md`
  - 宇宙論（距離指標）節に、BAO σスキャン図を追加して本文へ反映。
- `doc/STATUS.md`
  - Phase 14（宇宙論）ロードマップを整理し、Step 14.2.28 を完了として記録。

出力（追加）：
- `output/cosmology/cosmology_distance_indicator_rederivation_candidate_search_bao_sigma_scan.png`
- `output/cosmology/cosmology_distance_indicator_rederivation_candidate_search_bao_sigma_scan_metrics.json`

主要結果（代表; best_independent）：
- BAO含むDDR（Martinelli2021）：max|z| は f=1 で約2.57σ → f=6 で約1.10σ → f=10 で約0.68σ。limiting は BAO s_R のまま。
- BAOなしDDR（Holanda2012 non-iso spherical）：max|z|≪1σで安定（“どのDDR一次ソースを採るか”が結論を左右）。

再現：
- `python -B scripts/cosmology/cosmology_distance_indicator_rederivation_candidate_search.py`
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）


---

## 2026-01-10（UTC） Step 14.2.27：BAO(s_R) の支配要因の整理（共分散感度）→必要な誤差膨張の見積り

目的：
- Step 14.2.26 の再導出候補探索（best_independent）で limiting が BAO(s_R) に移ったため、BAO側の系統/感度（共分散の扱い等）を棚卸しし、必要な誤差膨張（目安）を見積もる。

変更：
- `scripts/cosmology/cosmology_bao_scaled_distance_fit_sensitivity.py`
  - BOSS DR12（BAO+FS consensus）の (D_M,H) から推定する `s_R` を、共分散の扱い（block/diag/full）や、D_Mのみ/Hのみの取り方で比較し、併せて BAO含むDDR（Martinelli2021）の best_independent へ与える影響（max|z| と limiting）をまとめる。
- `scripts/summary/run_all.py`
  - 上記スクリプトを `cosmology_bao_scaled_distance_fit_sensitivity` として追加。
- `doc/paper/10_manuscript.md` / `doc/paper/01_figures_index.md`
  - BAO(s_R) 感度図を追加し、本文から参照。

出力（追加/更新）：
- `output/cosmology/cosmology_bao_scaled_distance_fit_sensitivity.png` / `output/cosmology/cosmology_bao_scaled_distance_fit_sensitivity_metrics.json`
  - `s_R` は共分散の扱いを切り替えても -0.04 付近、1σは概ね 0.085〜0.106 の範囲（Table 8 full 共分散でも極端には緩まない）。
  - BAO含むDDR（Martinelli2021）の best_independent は max|z|≈2.5 前後で、limiting は BAO s_R のまま。
  - BAOを 1σ に収めるには、`s_R` の不確かさを概ね **約2.5倍** に膨張させる必要がある（目安）。
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`

再現：
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）


---

## 2026-01-10（UTC） Step 14.2.26：再導出候補の一次ソース強化（不透明度 α：曲率/H0事前分布の感度を追加）

目的：
- Step 14.2.25 で limiting が Opacity α に固定されたため、**独立な α の一次ソース**をさらに増やし、曲率仮定や H0 事前分布の影響も含めて best_independent の支配要因（limiting）を再判定する。

変更：
- `data/cosmology/cosmic_opacity_constraints.json`
  - Wang+2017（arXiv:1709.07258, H(z)+JLA）を追加（曲率 K と不透明度 ε を同時推定、α=ε として固定入力へ追加）。
    - case (a): H0事前分布なし（独立候補）
    - case (b): Planck H0 事前分布（CMB依存として `uses_cmb=true`）
    - case (c): 局所 H0 事前分布（独立候補）
  - ローカルPDFを追加：`data/cosmology/sources/arxiv_1709.07258.pdf`
- `doc/paper/20_data_sources.md` / `doc/paper/30_references.md` / `doc/paper/10_manuscript.md`
  - Wang+2017 を追記（曲率/opacity の縮退と H0 事前分布感度を一次ソースとして明示）。

出力（更新）：
- `output/cosmology/cosmology_distance_indicator_rederivation_candidate_search.png` / `output/cosmology/cosmology_distance_indicator_rederivation_candidate_search_metrics.json`
  - `independence_filter.opacity_candidates=7`。
  - BAO含むDDR（Martinelli2021）の best_independent は max|z|≈2.57 まで改善し、limiting は Opacity α → BAO s_R に移動。
- `output/cosmology/cosmology_distance_indicator_rederivation_candidate_matrix.png` / `output/cosmology/cosmology_distance_indicator_rederivation_candidate_matrix_metrics.json`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`
- `output/summary/validation_scoreboard.png` / `output/summary/validation_scoreboard.json`

再現：
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）


---

## 2026-01-10（UTC） Phase 14.2.24：再導出候補（α/s_L）の一次ソース強化（s_L の独立拘束を増やす）

目的：
- “BAO含むDDR” を満たすのに必要な進化/不透明度が現実的かを、一次ソース拘束（特に独立 s_L）を増やして再判定する。

変更：
- `data/cosmology/sn_standard_candle_evolution_constraints.json`
  - `dhr_dage` の定義を追加。
  - Kang+2020（arXiv:1912.04903）の HR-age 相関を、z=0→1 の Δage≈5.3 Gyr（一次ソース本文で引用）へ当てはめて z=1 の ΔM(1) とみなし、`s_L` へ換算した独立一次ソース（YEPS/TMJ11/S07）を追加（`assumes_cddr=false`, `uses_bao=false`, `uses_cmb=false`）。
- `doc/paper/20_data_sources.md` / `doc/paper/30_references.md`
  - Kang+2020 を追記。
- `doc/paper/10_manuscript.md`
  - 標準化後明るさの age 依存→ s_L のオーダー（-0.15〜-0.36）を補足。

出力（更新）：
- `output/cosmology/cosmology_distance_indicator_rederivation_candidate_search.png` / `output/cosmology/cosmology_distance_indicator_rederivation_candidate_search_metrics.json`（independence_filter の `candle_candidates=4`。BAO含むDDR（Martinelli2021）の best_independent は max|z|≈2.91 まで改善し、limiting は Opacity α）
- `output/cosmology/cosmology_distance_indicator_rederivation_candidate_matrix.png` / `output/cosmology/cosmology_distance_indicator_rederivation_candidate_matrix_metrics.json`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`
- `output/summary/validation_scoreboard.png` / `output/summary/validation_scoreboard.json`

再現：
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）


---

## 2026-01-10（UTC） Step 14.2.25：再導出候補の一次ソース強化（不透明度 α の独立拘束を増やす）

目的：
- “BAO含むDDR” の best_independent がどの一次ソース拘束で支配されるか（limiting）を、独立な不透明度 α の候補を増やして再判定する。

変更：
- `data/cosmology/cosmic_opacity_constraints.json`
  - Holanda+2014（arXiv:1207.1694）の SNe Ia + H(z) による opacity 推定（τ(z)=2ǫ z）を追加し、z=1 で `τ(1)` を一致させて `α=ǫ/ln2` に換算（平坦 Ωk=0 のサンプルを採用、`uses_bao=false`, `uses_cmb=false`）。
- `doc/paper/20_data_sources.md` / `doc/paper/30_references.md` / `doc/paper/10_manuscript.md`
  - Holanda+2014 を追記（独立 α の一次ソースとして明示）。

出力（更新）：
- `output/cosmology/cosmology_distance_indicator_rederivation_candidate_search.png` / `output/cosmology/cosmology_distance_indicator_rederivation_candidate_search_metrics.json`
  - `independence_filter.opacity_candidates=5`。
  - BAO含むDDR（Martinelli2021）の best_independent は max|z|≈2.80 まで改善し、limiting は引き続き Opacity α。
- `output/cosmology/cosmology_distance_indicator_rederivation_candidate_matrix.png` / `output/cosmology/cosmology_distance_indicator_rederivation_candidate_matrix_metrics.json`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`
- `output/summary/validation_scoreboard.png` / `output/summary/validation_scoreboard.json`

再現：
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）


---

## 2026-01-10（UTC） Step 14.2.32：標準サイレン（GW）の“実測”不透明度α（近傍）を追加し、forecastと分離

目的：
- 標準サイレン（GW）由来の不透明度αについて、ETの将来予測（forecast）と、現時点の観測（GW170817）の“実測”を分離して扱う。
- 実測（z≪1）が宇宙論的αをほぼ拘束できないことを明示しつつ、候補探索の参考系列として併記する。

変更：
- `data/cosmology/gw_standard_siren_opacity_constraints.json`
  - 観測（GW170817×NGC4993）から EM距離/GW距離の比を α に換算した行（`is_forecast=false`）を追加。
  - 既存の ET forecast 行（`is_forecast=true`）と同一ファイル内で区別。
- `data/cosmology/sources/`
  - GW170817 距離（一次ソース）：`arxiv_1710.05832.pdf`
  - NGC4993 の z_cosmic：`arxiv_1710.05856.pdf`
  - NGC4993 の SBF 距離：`arxiv_1801.06080.pdf`
- `scripts/cosmology/cosmology_distance_indicator_rederivation_candidate_search.py`
  - GW標準サイレンαを `observed` と `forecast` に分離し、図に両方を併記（4系列化）。
- `doc/paper/10_manuscript.md` / `doc/paper/20_data_sources.md` / `doc/paper/30_references.md`
  - GW170817（観測）系列が「近傍のため実質未拘束」である点と、一次ソースを追記。

出力（更新）：
- `output/cosmology/cosmology_distance_indicator_rederivation_candidate_search.png`
- `output/cosmology/cosmology_distance_indicator_rederivation_candidate_search_metrics.json`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`

再現：
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）


---

## 2026-01-10（UTC） Step 15.3：GWの低R²/fit_failed の原因分類→既定値を堅牢化（窓取り/前処理/検出器別の弱点）

目的：
- 重力波の複数イベント要約で、検出器（特に V1/L1）に `fit_failed` が残っていたため、原因を分類し、既定値と解析手順を堅牢化する。

変更：
- `scripts/gw/gw150914_chirp_phase.py`
  - fit失敗の `reason` を出力（`n_track` 不足 / A≤0 / M_c 非有限など）。
  - Hilbert track の単調化repair（`monotonic_median`）を追加し、A≤0 起因の取りこぼしを救済。
  - 失敗時の relaxed 再試行（whiten + 窓拡張 + percentile 緩和）を追加。
  - numpy>=2.x の RankWarning 互換を取り込み、ログをノイズ化しない。
- `data/gw/event_list.json`
  - `bbh_default` を `--method=hilbert` 優先に変更。
- `scripts/gw/gw_event_list_diagnostics.py`
  - skipped の `subreason` 集計に対応。

結果：
- `output/gw/gw_event_list_diagnostics.json` の detector skip（`fit_failed`）が 0。
- `output/gw/gw_multi_event_summary_metrics.json` の rows が増加（検出器行が埋まる）。

出力（更新）：
- `output/gw/*_chirp_phase_metrics.json`
- `output/gw/gw_multi_event_summary.png` / `output/gw/gw_multi_event_summary_public.png`
- `output/gw/gw_multi_event_summary_metrics.json`
- `output/gw/gw_event_list_diagnostics.json`
- `output/summary/validation_scoreboard.png` / `output/summary/validation_scoreboard.json`
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`

再現：
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）


---

## 2026-01-10（UTC） Step 16.1：宇宙論（静的無限仮説）検証パックの一次ソース明示（BAO追加）＋可読性調整

目的：
- 宇宙論（静的無限仮説）で、主要プローブごとの「前提/系統/一次ソース」を1枚に整理し、何が棄却を決めているかを明確化する。
- 併せて BAO について「最小仮定（s_R=0）」とのズレを明示し、距離指標依存プローブとの混同を防ぐ。

変更：
- `scripts/cosmology/cosmology_static_infinite_hypothesis_pack.py`
  - 右側テーブルに「一次ソース」列を追加（arXiv/doiの短縮表示）。
  - BAO 行（BOSS DR12; s_R）を追加（best-fit と最小仮定 s_R=0 の z-score を表示）。
  - 図全体のレイアウトを調整し、右側テーブルの可読性を改善（幅配分/列幅）。
- `doc/paper/10_manuscript.md`
  - 宇宙論の主要プローブ列挙に BAO を追加。

出力（更新）：
- `output/cosmology/cosmology_static_infinite_hypothesis_pack.png`
- `output/cosmology/cosmology_static_infinite_hypothesis_pack_metrics.json`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`

再現：
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）


---

## 2026-01-10（UTC） Step 16.2（前半）：背景Pの予測（p_t=1, p_T=1）を“独立プローブ”へ反映し、検証パックを更新

目的：
- Step 16.2（背景P→観測量の再導出）の着手として、距離指標と独立な一次ソース（SN time dilation / CMB T(z)）について、P-model（背景P）側の最小予測と観測の整合を明示する。

変更：
- `scripts/cosmology/cosmology_static_infinite_hypothesis_pack.py`
  - SN time dilation を `p_t=0`（tired-light）基準ではなく、背景Pの最小予測 `p_t=1`（Δt_obs=(1+z)Δt_em）で z-score を表示。
  - CMB T(z) も `p_T=0`（no-scaling）基準ではなく、背景Pの最小予測 `p_T=1`（T∝(1+z), β_T=0）で z-score を表示。
  - 右側テーブルの注記も「P_bg予測」を明記し、何が“棄却されているか（距離指標側）”を分離。

出力（更新）：
- `output/cosmology/cosmology_static_infinite_hypothesis_pack.png`
- `output/cosmology/cosmology_static_infinite_hypothesis_pack_metrics.json`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`

再現：
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）


---

## 2026-01-10（UTC） Step 16.2（前半）：総合スコアボードへ宇宙論の独立プローブを追加（背景Pの整合を明示）

目的：
- 宇宙論の“張力”が距離指標（DDR/Tolman）側に集中していることを、距離指標と独立な一次ソース（SN time dilation / CMB T(z)）をスコアボードへ追加して明確化する。

変更：
- `scripts/summary/validation_scoreboard.py`
  - 「宇宙論（独立プローブ）」行を追加（最大|z|：SN time dilation（p_t=1）と CMB T(z)（p_T=1）のうち worst）。
- `doc/paper/10_manuscript.md`
  - 宇宙論節に「背景Pの最小予測（p_t=1, p_T=1）は独立プローブと整合」という説明を追記。

出力（更新）：
- `output/summary/validation_scoreboard.png` / `output/summary/validation_scoreboard.json`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`

再現：
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）


---

## 2026-01-10（UTC） Step 16.2（前半）：差分予測図（観測量スケーリング）の時間伸長を背景Pの帰結として明示

目的：
- Step 16.2（背景P→観測量の再導出）の一環として、差分予測図（η(z), Tolman）で用いている時間伸長（p_t=1）を「仮定」ではなく背景Pからの自然な帰結として明示し、誤解を減らす。

変更：
- `scripts/cosmology/cosmology_observable_scalings.py`
  - 図中注記/説明を更新し、背景Pでは周波数比（1+z）が時間比にも出るため p_t=1 が自然に出る点を明記。

出力（更新）：
- `output/cosmology/cosmology_observable_scalings.png`
- `output/cosmology/cosmology_observable_scalings_metrics.json`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`

再現：
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）


---

## 2026-01-10（UTC） Step 16.2（前半）：Table 1 に宇宙論の独立プローブ（p_t, p_T）を追加し、背景P最小予測の整合を固定

目的：
- 宇宙論の張力（DDR/Tolman）が「距離指標側」に集中していることを、距離指標と独立な一次ソース（SN time dilation / CMB T(z)）を Table 1 に追加して明示する。

変更：
- `scripts/summary/paper_tables.py`
  - Table 1 に「宇宙論（独立プローブ）」の2行（SN time dilation の p_t、CMB T(z) の p_T）を追加。
  - 背景Pの最小予測（p_t=1, p_T=1）に対する z-score を表として固定。

出力（更新）：
- `output/summary/paper_table1_results.json` / `output/summary/paper_table1_results.csv` / `output/summary/paper_table1_results.md`
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`

再現：
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）


---

## 2026-01-10（UTC） Step 16.5.1：DDR一次ソース依存の俯瞰図を追加（距離指標で棄却度がどれだけ動くか）

目的：
- 静的背景P最小（ε0=-1）の棄却度が、DDRの一次ソース（距離指標）の採り方で大きく変わる点を、1枚で俯瞰できる形に固定する（Step 16.5 の「観測起因 vs モデル起因」切り分けを前進）。

変更：
- `scripts/cosmology/cosmology_distance_duality_source_sensitivity.py`
  - `output/cosmology/cosmology_distance_duality_constraints_metrics.json` を入力に、全DDR行の |z_pbg_static| を棒グラフで可視化。
  - 代表（BAO含む最強 / BAOなし最弱 / BAOなしでも強く棄却する例）を右側に要点として表示。
- `scripts/summary/run_all.py`
  - タスク `cosmology_distance_duality_source_sensitivity` を追加し、`run_all --offline` で再現可能に。
- `scripts/summary/public_dashboard.py`
  - 公開レポートに「DDR一次ソース依存」カードを追加。
- `doc/paper/10_manuscript.md` / `doc/paper/01_figures_index.md`
  - 論文に図を追加（publish HTML では図番号付きでインライン表示）。

出力（追加）：
- `output/cosmology/cosmology_distance_duality_source_sensitivity.png`
- `output/cosmology/cosmology_distance_duality_source_sensitivity_metrics.json`
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`

再現：
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）


---

## 2026-01-10（UTC） Step 16.5.2：DDRの支配仮定を定量化（内部整合性＋z_ref感度）

目的：
- DDR（距離二重性）の結論が「距離指標の系統/モデル仮定」および「η0→ε0換算の仮定（z_ref）」でどれだけ揺れるかを、一次ソース単位で固定する。

変更：
- `scripts/cosmology/cosmology_distance_duality_internal_consistency.py`
  - `output/cosmology/cosmology_distance_duality_constraints_metrics.json` を入力に、ε0制約どうしの内部整合性（ペア差の|z|）ヒートマップを生成。
  - `data/cosmology/distance_duality_constraints.json` の η0パラメータ化行について、z_ref（換算アンカー）を振った場合の棄却度（|z|）の感度を生成。
- `scripts/summary/run_all.py`
  - タスク `cosmology_distance_duality_internal_consistency` を追加し、`run_all --offline` で再現可能に。
- `doc/paper/10_manuscript.md` / `doc/paper/01_figures_index.md`
  - 論文に図を追加（publish HTML では図番号付きでインライン表示）。

出力（追加）：
- `output/cosmology/cosmology_distance_duality_internal_consistency.png`
- `output/cosmology/cosmology_distance_duality_anchor_sensitivity.png`
- `output/cosmology/cosmology_distance_duality_internal_consistency_metrics.json`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`

再現：
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）


---

## 2026-01-10（UTC） Step 16.5.3：DDRのモデル差を系統幅として取り込み、棄却度の頑健性を再評価

目的：
- DDRの一次ソースのうち、同一カテゴリ内（クラスター、強重力レンズ、SNe+電波など）で ε0 制約が揺れる分を「モデル差/系統」の代理指標として定量化し、静的最小（ε0=-1）の棄却度がどこまで緩むかを確認する。

変更：
- `scripts/cosmology/cosmology_distance_duality_systematics_envelope.py`
  - 同一カテゴリ内の ε0_obs の広がり（robust: 1.4826×MAD）を σ_cat として定義。
  - σ_total^2 = σ_obs^2 + σ_cat^2 として棄却度（|z|）を再計算し、観測σのみの場合と並べて可視化。
- `scripts/summary/run_all.py`
  - タスク `cosmology_distance_duality_systematics_envelope` を追加し、`run_all --offline` で再現可能に。
- `doc/paper/10_manuscript.md` / `doc/paper/01_figures_index.md`
  - 論文に図を追加（publish HTML では図番号付きでインライン表示）。

出力（追加）：
- `output/cosmology/cosmology_distance_duality_systematics_envelope.png`
- `output/cosmology/cosmology_distance_duality_systematics_envelope_metrics.json`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`

所見（この整理の範囲）：
- クラスター/レンズの一部は、カテゴリ系統を入れると 3σ 以上の棄却 → 3σ 未満へ移るケースがある（BAO非依存テストの頑健性は限定的）。
- 一方で SNIa+BAO や SNIa+H(z) は同一カテゴリ内の複数行が無く σ_cat=0 としているため、系統幅の見積りは一次ソースで別途詰める必要がある（次工程）。

再現：
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）


---

## 2026-01-11（UTC） Step 16.4（宇宙論BAO）：BOSS DR12 ξℓ（post-recon）を一次統計として導入、ピークfit（smooth+peak）を追加

目的：
- BAO の `D_M/r_d`, `D_H/r_d` などの圧縮出力は「観測統計（角度×赤方偏移）→距離変換→テンプレートfit」を含む推定量であり、前提次第で値が動き得る点を明確化する。
- P-model の宇宙論検証を進めるため、BAO出力そのものではなく **相関関数 multipoles ξℓ（ℓ=0,2）**という一次統計から、距離変換（AP/warping）を P-model 側で入れ替えて比較できる入口を作る。

一次ソース：
- Ross et al. (2016) COMBINEDDR12 corrfunc データ（SDSS SAS）:
  - `https://data.sdss.org/sas/dr12/boss/papers/clustering/Ross_etal_2016_COMBINEDDR12_corrfunc.zip`（Accessed: 2026-01-11）

変更：
- データ取得とキャッシュ：
  - `scripts/cosmology/fetch_boss_dr12_ross2016_corrfunc.py` を追加（zip取得→展開、meta保存、worklog追記）。
  - `data/cosmology/ross_2016_combineddr12_corrfunc/` を追加（post-recon ξ0/ξ2 と monoquad 共分散）。
- 解析（入口）：
  - `scripts/cosmology/cosmology_bao_xi_multipole_peakfit.py` を追加。
    - ξ0/ξ2 を「smooth+peak」最小モデルで fit（r_d は全体スケール α に吸収）。
    - AP warping（ε）を (i) free、(ii) ε=0、(iii) 静的背景P（指数 P_bg）の F_AP 比から予測される ε 固定、で比較。
- 統合（レポート/論文）：
  - `scripts/summary/run_all.py` に `cosmology_bao_xi_multipole_peakfit` を追加（Rossデータが無い offline では skip）。
  - `doc/paper/10_manuscript.md` に BAO一次統計（ξℓ）からの再導出方針と入口図を追加。
  - `doc/paper/01_figures_index.md` / `doc/paper/20_data_sources.md` / `doc/paper/30_references.md` を更新（データパッケージの出典を固定）。

出力（追加）：
- `output/cosmology/cosmology_bao_xi_multipole_peakfit.png`
- `output/cosmology/cosmology_bao_xi_multipole_peakfit_metrics.json`

再現：
- `python -B scripts/cosmology/fetch_boss_dr12_ross2016_corrfunc.py`
- `python -B scripts/cosmology/cosmology_bao_xi_multipole_peakfit.py`
- `python -B scripts/summary/run_all.py --offline`

次：
- pre-recon ξ の追加、P(k) クロスチェック、eBOSS/DESI への拡張（同じ枠組みで一次統計から）。


---

## 2026-01-11（UTC） Step 16.4（追記：pre-recon ξℓ）：Satpathy et al. 2016 の pre-recon ξ0/ξ2 と共分散を追加しクロスチェックを実装

目的：
- post-recon ξℓ に加え、pre-recon ξℓ（再構成前）でも同じ枠組みで fit し、再構成手法の影響で結論が左右されないかを確認できるようにする。

一次ソース：
- Satpathy et al. (2016) COMBINEDDR12 full-shape corrfunc multipoles データ（SDSS SAS）:
  - `https://data.sdss.org/sas/dr12/boss/papers/clustering/Satpathy_etal_2016_COMBINEDDR12_full_shape_corrfunc_multipoles.zip`（Accessed: 2026-01-11）

変更：
- `scripts/cosmology/fetch_boss_dr12_satpathy2016_corrfunc_multipoles.py` を追加（zip取得→必要ファイルのみ抽出、meta保存、worklog追記）。
- `data/cosmology/satpathy_2016_combineddr12_fs_corrfunc_multipoles/` を追加（pre-recon ξ0/ξ2 と共分散）。
- `scripts/cosmology/cosmology_bao_xi_multipole_peakfit.py` を拡張し、`--dataset satpathy_pre` で pre-recon も処理できるようにした。
  - 出力は `output/cosmology/cosmology_bao_xi_multipole_peakfit_pre_recon.*` に固定。
- `scripts/summary/run_all.py` に pre-recon のタスク（optional）と fetch タスク（optional）を追加。

出力（追加）：
- `output/cosmology/cosmology_bao_xi_multipole_peakfit_pre_recon.png`
- `output/cosmology/cosmology_bao_xi_multipole_peakfit_pre_recon_metrics.json`

再現：
- `python -B scripts/cosmology/fetch_boss_dr12_satpathy2016_corrfunc_multipoles.py`
- `python -B scripts/cosmology/cosmology_bao_xi_multipole_peakfit.py --dataset satpathy_pre`
- `python -B scripts/summary/run_all.py --offline`


---

## 2026-01-11（UTC） Step 16.4（追記：P(k) multipoles）：Beutler et al. の BOSS DR12 P(k) を追加し、最小モデル（smooth+peak）で AP warping（ε）をクロスチェック

目的：
- ξℓ（r空間）で得た AP warping（ε）の傾向が、P(k) multipoles（k空間）でも大きく矛盾しないかを確認する。
- BAO圧縮出力ではなく一次統計からの再導出の道筋（ξℓ → P(k)）を整備し、次工程（P(k) full fit / さらに一次の統計量）へ繋げる。

一次ソース：
- Beutler et al. COMBINEDDR12 BAO power spectrum multipoles データ（SDSS SAS）:
  - `https://data.sdss.org/sas/dr12/boss/papers/clustering/Beutler_etal_DR12COMBINED_BAO_powspec.tar.gz`（Accessed: 2026-01-11）

変更：
- `scripts/cosmology/fetch_boss_dr12_beutler2016_bao_powspec.py` を追加（tar.gz取得→必要ファイルのみ抽出、meta保存、worklog追記）。
- `data/cosmology/beutler_2016_combineddr12_bao_powspec/` を追加（P0/P2 と PATCHY covariance（z1..z3, NGC/SGC, pre/post recon））。
- `scripts/cosmology/cosmology_bao_pk_multipole_peakfit.py` を追加（P0/P2 の最小モデル（smooth+peak）で、AP warping（ε）を比較）。
  - 出力は `output/cosmology/cosmology_bao_pk_multipole_peakfit*.{png,json}` に固定。
- `scripts/summary/run_all.py` に fetch タスク（optional）と、P(k) 解析タスク（post/pre）を追加。
- 論文へ反映：`doc/paper/10_manuscript.md` / `doc/paper/01_figures_index.md` / `doc/paper/20_data_sources.md` / `doc/paper/30_references.md`

出力（追加）：
- `output/cosmology/cosmology_bao_pk_multipole_peakfit.png`
- `output/cosmology/cosmology_bao_pk_multipole_peakfit_metrics.json`
- `output/cosmology/cosmology_bao_pk_multipole_peakfit_pre_recon.png`
- `output/cosmology/cosmology_bao_pk_multipole_peakfit_pre_recon_metrics.json`

再現：
- `python -B scripts/cosmology/fetch_boss_dr12_beutler2016_bao_powspec.py`
- `python -B scripts/cosmology/cosmology_bao_pk_multipole_peakfit.py`
- `python -B scripts/cosmology/cosmology_bao_pk_multipole_peakfit.py --recon prerecon`
- `python -B scripts/summary/run_all.py --offline`

次：
- P(k) の full fit（窓関数込み）と、観測統計（θ,z）→（s,μ）/（k,μ）の距離変換を P-model 側で明示した上で、BAO圧縮出力（D_M/r_d, D_H/r_d）を置き換える。


---

## 2026-01-11（UTC） Step 16.4（追記：P(k) multipoles 窓関数）：RR multipoles を用いた窓関数畳み込み（post/pre）を追加

目的：
- P(k) multipoles（P0/P2）は survey 窓関数の影響が大きいため、一次統計として比較する際に **窓関数畳み込み込み**での fit を追加する。
- BAO圧縮出力（D_M/r_d, D_H/r_d）を“観測事実”として扱うのではなく、観測統計（一次）から距離変換（AP/warping）を入れ替えて比較する、という方針を強化する。

変更：
- `scripts/cosmology/fetch_boss_dr12_beutler2016_bao_powspec.py`
  - window ファイル（`Beutleretal_window_z{1..3}_{NGC,SGC}.dat`）を抽出対象に追加。
- `scripts/cosmology/cosmology_bao_pk_multipole_peakfit.py`
  - `--window` を追加し、RR multipoles（Beutler window）を用いた窓関数畳み込み込みのピークfitを実装。
  - 離散Hankel（有限範囲）の誤差を抑えるため、identity-window が概ね I になるよう擬似逆行列補正（c0/c2）を導入。
  - 出力を `*_window.*`（post/pre）に固定。
- `scripts/summary/run_all.py`
  - `cosmology_bao_pk_multipole_peakfit_window`（post）と `cosmology_bao_pk_multipole_peakfit_pre_recon_window`（pre）を追加。
- 論文へ反映：`doc/paper/10_manuscript.md` / `doc/paper/01_figures_index.md` / `doc/paper/20_data_sources.md`
  - P(k) 図の参照先を window 版へ更新。

出力（追加）：
- `output/cosmology/cosmology_bao_pk_multipole_peakfit_window.png`
- `output/cosmology/cosmology_bao_pk_multipole_peakfit_window_metrics.json`
- `output/cosmology/cosmology_bao_pk_multipole_peakfit_pre_recon_window.png`
- `output/cosmology/cosmology_bao_pk_multipole_peakfit_pre_recon_window_metrics.json`

再現：
- `python -B scripts/cosmology/fetch_boss_dr12_beutler2016_bao_powspec.py --force`
- `python -B scripts/cosmology/cosmology_bao_pk_multipole_peakfit.py --window`
- `python -B scripts/cosmology/cosmology_bao_pk_multipole_peakfit.py --recon prerecon --window`
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）


---

## 2026-01-11（UTC） Step 16.4（宇宙論BAO一次情報）：BOSS DR12v5 LSS（galaxy+random）から ξ(s,μ)→ξℓ を再計算する入口を追加

目的：
- BAO の圧縮出力（D_M/r_d, D_H/r_d など）を「観測事実」として扱うのではなく、角度×赤方偏移統計（一次）→距離写像→統計量（ξ(s,μ), ξℓ）までを **P-model側で再導出**できる入口を用意する。
- Phase A（スクリーニング）として、まずは DR12v5 の実カタログ（galaxy+random）から ξℓ（ℓ=0,2）を再計算し、距離写像（LCDM vs P_bg など）で BAOピーク位置と異方を比較できる状態にする。

一次ソース：
- SDSS SAS DR12 / BOSS LSS（DR12v5 galaxy/random catalogs）
  - `https://data.sdss.org/sas/dr12/boss/lss/`（Accessed: 2026-01-11）

変更：
- FITS最小読取（astropy不要）を追加：`scripts/cosmology/boss_dr12v5_fits.py`
- DR12v5 galaxy/random の取得＋抽出スクリプトを追加/更新：`scripts/cosmology/fetch_boss_dr12v5_lss.py`
  - 抽出列に IPOLY/ISECT を追加（galaxy/random のフットプリント整合用）
  - `--force` を追加（既存npzを上書きして再抽出）
- ξℓ再計算（Corrfunc）を追加/更新：`scripts/cosmology/cosmology_bao_xi_from_catalogs.py`
  - 部分抽出（prefix）では galaxy/random の含まれるセクタ集合がずれ得るため、IPOLY/ISECT で共通セクタにそろえてから ξ を計算（`--match-sectors auto/on/off`）
  - NGC+SGC 合算では、サブサンプルにより random の有効密度が cap 間でずれるため、random重みをcap別に定数倍して比率を揃えてから合算（metricsへ `random_weight_rescale` を記録）

出力（追加/更新）：
- `output/cosmology/cosmology_bao_xi_from_catalogs_cmass_{north,south,combined}_{lcdm,pbg}.png`
- `output/cosmology/cosmology_bao_xi_from_catalogs_cmass_{north,south,combined}_{lcdm,pbg}_metrics.json`

所見（Phase A / 現状のサブサンプル設定）：
- セクタ整合なしだと ξ0 が ~1–2 と異常値になったが、セクタ整合後は ξ0 が ~0.1（s≈30）→数×10^-3（s≈150）へ戻り、スケールが妥当化。
- CMASS（combined）で、距離写像により BAOピーク位置（s²ξ0の80–130範囲の最大）が動く例を確認：
  - LCDM: s≈107.5 [Mpc/h]、P_bg（静的）: s≈97.5 [Mpc/h]（現状のprefixサブサンプル）

再現：
- 抽出（prefix, IPOLY/ISECT 含む）
  - `python -B scripts/cosmology/fetch_boss_dr12v5_lss.py --samples cmass --caps north,south --random-kind random1 --random-max-rows 500000 --galaxy-max-rows 200000 --force`
- ξℓ（WSL/Corrfunc）
  - `wsl -d Ubuntu-24.04 -- bash -lc 'source ~/.venv_wavep/bin/activate && python /mnt/c/develop/waveP/scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmass --caps combined --dist lcdm --random-kind random1 --threads 4'`
  - `wsl -d Ubuntu-24.04 -- bash -lc 'source ~/.venv_wavep/bin/activate && python /mnt/c/develop/waveP/scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmass --caps combined --dist pbg --random-kind random1 --threads 4'`

次：
- BAOピークfit（smooth+peak、r_d free）を ξ0/ξ2 に適用し、異方（ℓ=2）を重視した幾何整合（AP）を数値指標で評価。
- CMASS→LOWZ→z-bin→NGC/SGC分割へ展開し、系統（cap差）を切り分け。


---

## 2026-01-11（UTC） Step 16.4（追記：LOWZ + z-bin）：LOWZ（z≈0.32）を追加し、CMASSLOWZTOT を z-cut で b1/b2/b3 へ展開

目的：
- Phase A（スクリーニング）を前進し、CMASS（z≈0.57）だけでなく LOWZ（z≈0.32）でも同じ距離写像（LCDM vs P_bg）による ξℓの違いを確認できるようにする。
- 次工程「z-bin（0.38/0.51/0.61）で z 依存を見る」に向けて、BOSS提供の CMASSLOWZTOT catalog を入口にし、**z-cut で bins を作って ξℓ を再計算**できるようにする（まずは b1/b2/b3 の簡易スライス）。

変更：
- `scripts/cosmology/fetch_boss_dr12v5_lss.py`
  - 追加サンプル `cmasslowz`, `cmasslowztot` を導入（DR12v5 LSSの提供ファイルに対応）。
- `scripts/cosmology/cosmology_bao_xi_from_catalogs.py`
  - サンプル `cmasslowz`, `cmasslowztot` を追加。
  - z-cut を追加（`--z-bin {b1,b2,b3}` または `--z-min/--z-max`）。出力tag/metricsにも zcut を記録。
    - b1: [0.2, 0.5), b2: [0.4, 0.6), b3: [0.5, 0.75)（半開区間）

出力（追加/更新）：
- LOWZ（combined）：
  - `output/cosmology/cosmology_bao_xi_from_catalogs_lowz_combined_{lcdm,pbg}.png`
  - `output/cosmology/cosmology_bao_xi_from_catalogs_lowz_combined_{lcdm,pbg}_metrics.json`
- CMASSLOWZTOT（combined, z-bin）：
  - `output/cosmology/cosmology_bao_xi_from_catalogs_cmasslowztot_combined_{lcdm,pbg}_{b1,b2,b3}.png`
  - `output/cosmology/cosmology_bao_xi_from_catalogs_cmasslowztot_combined_{lcdm,pbg}_{b1,b2,b3}_metrics.json`

再現：
- 抽出（prefix, IPOLY/ISECT 含む）
  - `python -B scripts/cosmology/fetch_boss_dr12v5_lss.py --samples lowz,cmasslowztot --caps north,south --random-kind random1 --random-max-rows 500000 --galaxy-max-rows 200000 --force`
- ξℓ（WSL/Corrfunc, 例）
  - `wsl -d Ubuntu-24.04 -- bash -lc 'source ~/.venv_wavep/bin/activate && python /mnt/c/develop/waveP/scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample lowz --caps combined --dist pbg --random-kind random1 --threads 4'`
  - `wsl -d Ubuntu-24.04 -- bash -lc 'source ~/.venv_wavep/bin/activate && python /mnt/c/develop/waveP/scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmasslowztot --caps combined --dist lcdm --random-kind random1 --threads 4 --z-bin b2'`

次：
- z-bin は重なり（b1/b2/b3がoverlap）を含むため、次は「非重複bin（E2/E3相当）」の定義を整理してから、z依存評価を本番化。
- サブサンプルが prefix 抽出である点の影響（順序バイアス）を下げるため、random/galaxy の抽出を「均一サンプル（reservoir等）」へ移行（Phase Aの頑健化）。


---

## 2026-01-11（UTC） Step 16.4：BAO σ_sys の別定義（LOO最大シフト）を追加

目的：
- BAO(s_R) の併合priorが「特定点（高z）支配」や「多系統差」により過剰にタイトになっていないかを、σ_sys の別定義でも診断し、必要fの感度を固定する。

変更：
- `scripts/cosmology/cosmology_distance_indicator_rederivation_bao_survey_sensitivity.py`
  - 併合fit leave-one-out の最大シフトから σ_sys を見積もる variant を追加：
    - `σ_sys = 0.5*max|s_R(leave-one-out)-s_R(full)|`
    - `σ_total^2 = σ_stat^2 + σ_sys^2`
  - その結果、併合priorの必要fは **f≈9.0**（LOO最大シフトσ_sys）となり、statのみの **f≈36** と比べて大きく低下（ただし診断目的）。
- `scripts/cosmology/cosmology_tension_attribution.py`
  - 上記 variant を張力要約の本文/metricsに併記。
- `doc/paper/10_manuscript.md`
  - σ_sys の別定義（LOO最大シフト）と f≈9.0 を追記。

出力（更新）：
- `output/cosmology/cosmology_distance_indicator_rederivation_bao_survey_global_prior_sigma_scan.png`
- `output/cosmology/cosmology_distance_indicator_rederivation_bao_survey_global_prior_sigma_scan_metrics.json`
- `output/cosmology/cosmology_tension_attribution.png`
- `output/cosmology/cosmology_tension_attribution_metrics.json`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`

再現：
- `python -B scripts/summary/run_all.py --offline`（HTML+DOCX）


---

## 2026-01-12（UTC） Step 16.4（BAO一次情報）：ξ2の特徴量（異方敏感）を追加し、z依存サマリを2パネル化

目的：
- BAO圧縮出力（D_M/r_d 等）ではなく、銀河＋randomカタログから再計算した ξℓ（ℓ=0,2）に基づき、P-model距離写像の幾何（特に異方）をスクリーニングできる形へ寄せる。
- ξ0だけだと「全体スケール（r_d）」に吸収されやすいので、ξ2側にも簡単な特徴量を用意して差が見える入口を作る。

変更：
- `scripts/cosmology/cosmology_bao_xi_from_catalogs.py`
  - `s² ξ2` の broadband 除去→残差の支配極値（位置と符号）を `derived.bao_feature_xi2` として追加（次回の再計算から metrics に入る）。
  - 図に ξ0ピーク位置（破線）に加え、ξ2特徴位置（点線、符号で色）を表示。
- `scripts/cosmology/cosmology_bao_catalog_peak_summary.py`
  - サマリ図を2パネル化（左：ξ0ピーク、右：ξ2特徴。右は符号を ^ / v で表示）。
  - 既存の `*_metrics.json` に `bao_feature_xi2` が無い場合でも、対応する `.npz` から特徴量を計算してフォールバックする。

出力（更新）：
- `output/cosmology/cosmology_bao_catalog_peak_summary.png`
- `output/cosmology/cosmology_bao_catalog_peak_summary_metrics.json`

再現：
- `python -B scripts/cosmology/cosmology_bao_catalog_peak_summary.py --sample cmasslowztot --caps combined --require-zbin`
- （ξℓ再計算は Corrfunc が必要：WSL/Linux 推奨）`scripts/cosmology/cosmology_bao_xi_from_catalogs.py`

所見（Phase Aの範囲）：
- ξ2特徴（支配極値）は距離写像で符号や位置が変わり得るため、幾何（異方）の差が視覚化しやすい。
- ただし random の部分抽出（prefix_rows）とフットプリント整合（IPOLY/ISECT）に依存するため、次は抽出方法を振って収束（安定性）を確認する。


---

## 2026-01-12（UTC） Step 16.4（BAO一次情報）：μ-wedge（s⊥/s∥）ピークと異方スコア（Δs, ratio）を追加

目的：
- ξℓ（ℓ=0,2）だけでも「μ方向（横/縦）」の情報を引き出し、AP/warping に敏感な指標で幾何整合を定量化する入口を作る。
- r_d（全体スケール）をフリーにしても残る「横/縦のピーク差」を Phase A のスクリーニング指標として固定する。

変更：
- `scripts/cosmology/cosmology_bao_xi_from_catalogs.py`
  - μ-wedge（横=μ∈[0,μ_split], 縦=μ∈[μ_split,1]）の ξ_wedge を ξ0+ξ2⟨P2⟩ で近似し、両者のピーク位置（s⊥, s∥）と異方スコア（Δs_peak=s∥-s⊥、ratio=s∥/s⊥）を `derived.bao_wedges` に追加。
  - `.npz` に `mu_split`, `xi_wedge_transverse`, `xi_wedge_radial` を保存（後段の集計で再利用）。
- `scripts/cosmology/cosmology_bao_catalog_wedge_anisotropy.py`（新規）
  - `*_metrics.json` / `.npz` を集計して、Δs と ratio の z 依存を 1 枚に可視化（Phase A の幾何スコア入口）。
- `scripts/cosmology/cosmology_bao_catalog_peak_summary.py`
  - WSL経由で生成された `outputs.npz=/mnt/c/...` 形式を Windows 側でも参照できるよう、パス解決（/mnt→ドライブ）を追加（フォールバック時の頑健性）。

出力（追加/更新）：
- `output/cosmology/cosmology_bao_catalog_wedge_anisotropy.png`
- `output/cosmology/cosmology_bao_catalog_wedge_anisotropy_metrics.json`
- `output/cosmology/cosmology_bao_xi_from_catalogs_*_metrics.json`（再生成したものから `bao_wedges` が入る）

再現：
- 集計：`python -B scripts/cosmology/cosmology_bao_catalog_wedge_anisotropy.py --sample cmasslowztot --caps combined --require-zbin`
- ξℓ再計算（Corrfuncが必要：WSL/Linux 推奨）：`scripts/cosmology/cosmology_bao_xi_from_catalogs.py`

所見（Phase Aの範囲）：
- Δs/ratio は「横/縦の幾何差」を直接見る指標になるため、ξ0単独よりも“APっぽい差”が出やすい。
- ただし現状は prefix 抽出の影響が残る可能性があるため、次工程は sampling を振って収束確認（安定性）を最優先とする。


---

## 2026-01-12（UTC） Step 16.4（BAO一次情報）：μ-wedge のピーク信頼度（edge-pick検出）を導入し、集計で可視化

目的：
- z-bin や NGC/SGC などでサンプルを細かく切ると、μ-wedge の S/N が落ちて「窓端（80/130）を拾って偽の大異方を出す」ケースがあり、Phase A の指標として危険だった。
- “使える / 危ない”を自動で区別し、論文化での説明（系統切り分け）に繋げる。

変更：
- `scripts/cosmology/cosmology_bao_xi_from_catalogs.py`
  - BAOピーク推定（`_estimate_bao_peak_s2_xi`）で「窓内の局所最大」を優先し、`idx_choice` / `is_window_edge` を metrics に保存。
  - μ-wedge に `reliable` / `flags` / `edge_margin` を追加（peak が窓端近傍になった場合などを検出）。
- `scripts/cosmology/cosmology_bao_catalog_wedge_anisotropy.py`
  - `reliable=false` を × マーカーで表示し、`flags` を集計 metrics に残す。

出力（更新）：
- `output/cosmology/cosmology_bao_xi_from_catalogs_*_metrics.json`（CMASS/LOWZ/CMASSLOWZTOT、north/south/combined、b1/b2/b3）
- `output/cosmology/cosmology_bao_catalog_wedge_anisotropy.png`
- `output/cosmology/cosmology_bao_catalog_wedge_anisotropy_metrics.json`

所見（Phase Aの範囲）：
- CMASS（combined, LCDM）は ratio≈1 に近い一方、P_bg（静的）は ratio<1 の方向へ寄り、異方が強く出る傾向がある。
- z-bin では wedge peak が不安定になり得るため、まず `reliable/flags` を基準に “判定可能な点”を固定してから、ℓ=2重視の fit（smooth+peak）へ進む。

再現：
- ξℓ再計算（Corrfuncが必要：WSL/Linux 推奨）：`scripts/cosmology/cosmology_bao_xi_from_catalogs.py`
- 集計：`python -B scripts/cosmology/cosmology_bao_catalog_wedge_anisotropy.py --sample cmasslowztot --caps combined --require-zbin`


---

## 2026-01-12（UTC） Step 16.4（BAO一次情報）：catalog ξℓの再利用性を強化（counts同梱）＋ε_proxyとsmooth+peak peakfit（α, ε）を追加

目的：
- BAOの圧縮出力（D_M/r_d 等）ではなく、銀河+random一次情報から再計算した ξℓ（ℓ=0,2）で「幾何が合うか」を判定する Phase A を前進させる。
- 次工程（peakfit）へ繋ぐため、catalog出力（.npz）に必要な情報（paircounts/μbin/ξ(s,μ)）を同梱し、再計算コストを下げる。
- WSL実行（Corrfunc必須）で生成されるPNGの日本語文字化けを避け、レポート統合の障害を潰す。

変更：
- `scripts/cosmology/cosmology_bao_xi_from_catalogs.py`
  - WSL環境で `/mnt/c/Windows/Fonts` を探索し、Windows日本語フォントを `matplotlib.font_manager.addfont()` で登録（WSL生成PNGでも日本語が読める）。
  - 出力 `.npz` に `mu_edges`, `dd_w/dr_w/rr_w`, `xi_mu`, `dd_tot/dr_tot/rr_tot` を保存（従来の `s/xi0/xi2` は維持）。
- `scripts/cosmology/cosmology_bao_catalog_wedge_anisotropy.py`
  - wedge比 `ratio=s∥/s⊥` から `ε_proxy = ratio^(1/3) - 1` を追加し、暫定の判定（ok/mixed/ng/info）を metrics に保存。
- `scripts/cosmology/cosmology_bao_catalog_peakfit.py`（新規）
  - catalog ξ0/ξ2 に smooth+peak（8線形 + α/ε非線形）fit を適用し、ε(z) を可視化（誤差はpaircount由来の対角近似＋χ2スケールで保守化）。

出力（追加/更新）：
- `output/cosmology/cosmology_bao_catalog_peakfit_cmass_combined.png`
- `output/cosmology/cosmology_bao_catalog_peakfit_lowz_combined.png`
- `output/cosmology/cosmology_bao_catalog_peakfit_cmasslowztot_combined_zbinonly.png`
- `output/cosmology/cosmology_bao_catalog_wedge_anisotropy.png`（metricsも更新）

再現：
- ξℓ再計算（Corrfuncが必要：WSL/Linux 推奨）：
  - `wsl --cd /mnt/c/develop/waveP -- bash -lc "source ~/.venv_wavep/bin/activate && python scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmass --caps combined --dist lcdm --random-kind random1 --nmu 60 --threads 24"`
  - `wsl --cd /mnt/c/develop/waveP -- bash -lc "source ~/.venv_wavep/bin/activate && python scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmass --caps combined --dist pbg  --random-kind random1 --nmu 60 --threads 24"`
  - `wsl --cd /mnt/c/develop/waveP -- bash -lc "source ~/.venv_wavep/bin/activate && python scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmasslowztot --caps combined --dist lcdm --random-kind random1 --z-bin b1 --nmu 60 --threads 24"`（b1/b2/b3 を必要分）
- peakfit（Windows/Python）：
  - `python -B scripts/cosmology/cosmology_bao_catalog_peakfit.py --sample cmass --caps combined --dists lcdm,pbg`
  - `python -B scripts/cosmology/cosmology_bao_catalog_peakfit.py --sample cmasslowztot --caps combined --dists lcdm,pbg --require-zbin`

所見（Phase Aの範囲）：
- ε の推定は誤差モデルに依存するため、現時点では “スクリーニング指標” として扱い、判定ポリシー固定と系統切り分け（NGC/SGC, z-bin）を優先する。
- Phase B では reconstruction も含めて P-model 側で再実行し、共分散（jackknife等）も含めた「前提ゼロ」へ繋げる。


---

## 2026-01-12（UTC） Phase 5（公開/論文化）：最新出力でレポート/論文（HTML+DOCX）を再生成

目的：
- 本リポジトリの配布物（一般向けレポート・論文草稿）を、最新の検証出力で毎回更新して共有できる状態に保つ。

実行：
- `python -B scripts/summary/run_all.py --online`

出力（更新）：
- `output/summary/pmodel_public_report.html`
- `output/summary/pmodel_public_report.docx`
- `output/summary/pmodel_paper.html`
- `output/summary/pmodel_paper.docx`
- `output/summary/run_all_status.json`（実行結果サマリ）


---

## 2026-01-12（UTC） Step 16.4（BAO一次情報：銀河+random）：座標化仕様（A0固定）の明文化と出力更新

目的：
- ε の変動が「理論差（距離写像差）」なのか「座標化差（z/LOS/距離積分の揺れ）」なのか混ざらないように、A0で座標化仕様を固定し、metricsに保存する。

変更：
- `scripts/cosmology/cosmology_bao_xi_from_catalogs.py`
  - redshift定義を `--z-source`（obs/cosmic/cmb）として明示（現状の抽出NPZは `Z` のみなので既定は obs）。
  - LOS定義を `--los midpoint` として固定（Corrfuncのpairwise midpoint定義に従う）。
  - comoving distance（lcdm）の数値積分仕様を `--lcdm-n-grid` / `--lcdm-z-grid-max` で固定し、`params.coordinate_spec` に保存。
  - `params.coordinate_spec` を北天/南天/combined の全出力で一致チェックし、定義混在を防止。
- `scripts/cosmology/cosmology_bao_catalog_peakfit.py`
  - 入力の `z_source/los/lcdm_*` が混在している場合はエラー化し、fit結果（ε）が座標化差で揺れないようにした。
  - `coordinate_spec_common` を peakfit の metrics に保存。

出力（更新）：
- `output/cosmology/cosmology_bao_xi_from_catalogs_cmass_{north,south,combined}_{lcdm,pbg}.png`（metrics/json/npzも更新）
- `output/cosmology/cosmology_bao_xi_from_catalogs_lowz_combined_{lcdm,pbg}.png`（metrics/json/npzも更新）
- `output/cosmology/cosmology_bao_xi_from_catalogs_cmasslowztot_combined_{lcdm,pbg}_{b1,b2,b3}.png`（metrics/json/npzも更新）
- `output/cosmology/cosmology_bao_catalog_peak_summary.png`（metricsも更新）
- `output/cosmology/cosmology_bao_catalog_wedge_anisotropy.png`（metricsも更新）
- `output/cosmology/cosmology_bao_catalog_peakfit_{cmass,lowz}_combined.png`（metricsも更新）
- `output/cosmology/cosmology_bao_catalog_peakfit_cmasslowztot_combined_zbinonly.png`（metricsも更新）
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`

再現：
- ξℓ再計算（WSL + Corrfunc）：
  - `wsl --cd /mnt/c/develop/waveP -- bash -lc "source ~/.venv_wavep/bin/activate && python scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmass --caps combined --dist lcdm --random-kind random1 --nmu 60 --z-source obs --los midpoint --lcdm-n-grid 6000 --lcdm-z-grid-max 2.0"`
  - `wsl --cd /mnt/c/develop/waveP -- bash -lc "source ~/.venv_wavep/bin/activate && python scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmass --caps combined --dist pbg  --random-kind random1 --nmu 60 --z-source obs --los midpoint"`
- まとめ（Windows/Python）：
  - `python -B scripts/cosmology/cosmology_bao_catalog_peak_summary.py`
  - `python -B scripts/cosmology/cosmology_bao_catalog_wedge_anisotropy.py`
  - `python -B scripts/cosmology/cosmology_bao_catalog_peakfit.py --sample cmass --caps combined --dists lcdm,pbg`
  - `python -B scripts/cosmology/cosmology_bao_catalog_peakfit.py --sample cmasslowztot --caps combined --dists lcdm,pbg --require-zbin`
  - `python -B scripts/summary/run_all.py --online`

メモ：
- 既定の `lcdm_z_grid_max` は、抽出catalogに `max(z)≈1.002` の点が含まれるため 2.0 とした（固定グリッド上で距離写像を安定化）。


---

## 2026-01-12（UTC） Step 16.4（BAO一次情報：銀河+random）：peakfit判定ポリシーの固定（|ε|/σ_ε）とスコアボード反映

目的：
- catalog-based BAO（ξℓ）で得られる ε の評価が、絶対値しきい値に依存してブレないように、|ε|/σ_ε（CI由来）で判定ポリシーを固定する。
- 現状の立ち位置が共有しやすいよう、総合スコアボードに BAO一次情報の行を追加する。

変更：
- `scripts/cosmology/cosmology_bao_catalog_peakfit.py`
  - 判定を `abs_sigma=|ε|/sigma_eps_1sigma`（1σCI幅から推定）に変更し、`screening` に `sigma_eps_1sigma` / `abs_sigma` を保存。
  - 既定しきい値を `ok_max=1.0, mixed_max=2.0`（σ基準）に統一し、metrics の `policy.status_metric` に明記。
- `scripts/summary/validation_scoreboard.py`
  - `cosmo_bao_catalog`（宇宙論（BAO一次情報））行を追加（pbgのε有意度：最大|z|を表示）。
  - 例外規定に「post-reconのfiducial依存のため Phase A はスクリーニング指標」の注記を追加。

出力（更新）：
- `output/cosmology/cosmology_bao_catalog_peakfit_cmass_combined_metrics.json`
- `output/cosmology/cosmology_bao_catalog_peakfit_lowz_combined_metrics.json`
- `output/cosmology/cosmology_bao_catalog_peakfit_cmasslowztot_combined_zbinonly_metrics.json`
- `output/summary/validation_scoreboard.png` / `output/summary/validation_scoreboard.json`
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`

再現：
- `python -B scripts/cosmology/cosmology_bao_catalog_peakfit.py --sample cmass --caps combined --dists lcdm,pbg`
- `python -B scripts/cosmology/cosmology_bao_catalog_peakfit.py --sample lowz --caps combined --dists lcdm,pbg`
- `python -B scripts/cosmology/cosmology_bao_catalog_peakfit.py --sample cmasslowztot --caps combined --dists lcdm,pbg --require-zbin`
- `python -B scripts/summary/validation_scoreboard.py`
- `python -B scripts/summary/run_all.py --online`


---

## 2026-01-12（UTC） Step 16.4（BAO一次情報：銀河+random）：peakfit εスキャンの端クリップ対策（rescan）と表示改善

目的：
- z-bin などで ε の最良値/CI がスキャン端に張り付き、CIが不自然になる（過小/過大）問題を抑える。
- 「理論差」ではなく「探索範囲差」で議論がブレないよう、εスキャンの扱いを固定する。
- スコアボード上で「下限（≥）」が分かるようにし、解釈ミスを防ぐ。

変更：
- `scripts/cosmology/cosmology_bao_catalog_peakfit.py`
  - `--eps-rescan-factor` / `--eps-rescan-max-expands` を追加（既定：factor=2.0, max_expands=2）。
  - best-fit または 1σCI が eps グリッド境界でクリップされた場合、eps 範囲を拡大して再スキャン（最大2回）し、可能なら CI を回収。
  - それでも CI が確定できない場合は `abs_sigma_is_lower_bound=true` として保守化（境界由来で“精密σ”を主張しない）。
  - 各ケースの `screening.scan.rescan` に初期グリッドと expand 回数を保存。
- `scripts/summary/validation_scoreboard.py`
  - `cosmo_bao_catalog` のメトリクス文字列で、`abs_sigma_is_lower_bound=true` を「≥」表記に。

出力（更新）：
- `output/cosmology/cosmology_bao_catalog_peakfit_cmass_combined.png`（metricsも更新）
- `output/cosmology/cosmology_bao_catalog_peakfit_lowz_combined.png`（metricsも更新）
- `output/cosmology/cosmology_bao_catalog_peakfit_cmasslowztot_combined_zbinonly.png`（metricsも更新；z-binでeps範囲が自動拡張されうる）
- `output/summary/validation_scoreboard.png` / `output/summary/validation_scoreboard.json`
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`

再現：
- `python -B scripts/cosmology/cosmology_bao_catalog_peakfit.py --sample cmass --caps combined --dists lcdm,pbg`
- `python -B scripts/cosmology/cosmology_bao_catalog_peakfit.py --sample lowz --caps combined --dists lcdm,pbg`
- `python -B scripts/cosmology/cosmology_bao_catalog_peakfit.py --sample cmasslowztot --caps combined --dists lcdm,pbg --require-zbin`
- `python -B scripts/summary/validation_scoreboard.py`
- `python -B scripts/summary/run_all.py --online`


---

## 2026-01-12（UTC） Step 16.4（BAO一次情報：銀河+random）：NGC/SGC（north/south）分割での系統切り分け

目的：
- LOWZ/CMASS を最初から混ぜず、まずは NGC/SGC（north/south）で分割して、幾何（ε）の推定がサーベイ領域に依存していないか（系統）を確認する。
- 以降の Phase B（reconstruction自前化）に入る前に、「結果がブレる要因（座標化差ではなく領域差）」を明確にしておく。

実施：
- ξℓ再計算（WSL + Corrfunc; galaxy+random → ξ(s,μ) → ξ0/ξ2）：
  - LOWZ: north/south の LCDM/P_bg を更新
  - CMASSLOWZTOT: z-bin（b1/b2/b3）× north/south の LCDM/P_bg を更新
- peakfit（smooth+peak; α, ε）：
  - CMASS: north/south（LCDM/P_bg）
  - LOWZ: north/south（LCDM/P_bg）
  - CMASSLOWZTOT: z-bin（b1/b2/b3）× north/south（LCDM/P_bg）
- 集計の更新：
  - `cosmology_bao_catalog_peak_summary.png`（ピーク位置のz依存）
  - `cosmology_bao_catalog_wedge_anisotropy.png`（μ-wedge異方）
- スコアボード：
  - BAO一次情報の行に north/south の peakfit も含めるようにし、Phase A（スクリーニング）の「系統切り分け」を反映。

出力（更新/追加）：
- ξℓ（Corrfunc; WSL）：
  - `output/cosmology/cosmology_bao_xi_from_catalogs_lowz_{north,south}_{lcdm,pbg}.png`（metrics/json/npzも更新）
  - `output/cosmology/cosmology_bao_xi_from_catalogs_cmasslowztot_{north,south}_{lcdm,pbg}_{b1,b2,b3}.png`（metrics/json/npzも更新）
- peakfit：
  - `output/cosmology/cosmology_bao_catalog_peakfit_cmass_{north,south}.png`（metricsも更新）
  - `output/cosmology/cosmology_bao_catalog_peakfit_lowz_{north,south}.png`（metricsも更新）
  - `output/cosmology/cosmology_bao_catalog_peakfit_cmasslowztot_{north,south}_zbinonly.png`（metricsも更新）
- 集計：
  - `output/cosmology/cosmology_bao_catalog_peak_summary.png`（metricsも更新）
  - `output/cosmology/cosmology_bao_catalog_wedge_anisotropy.png`（metricsも更新）
- スコアボード：
  - `output/summary/validation_scoreboard.png` / `output/summary/validation_scoreboard.json`
- レポート/論文：
  - `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`
  - `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`

再現：
- ξℓ再計算（例）：
  - `wsl --cd /mnt/c/develop/waveP -d Ubuntu-24.04 -- bash -lc "source ~/.venv_wavep/bin/activate && python scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample lowz --caps north --dist lcdm --random-kind random1 --threads 4 --nmu 60 --z-source obs --los midpoint --lcdm-n-grid 6000 --lcdm-z-grid-max 2.0"`
  - `wsl --cd /mnt/c/develop/waveP -d Ubuntu-24.04 -- bash -lc "source ~/.venv_wavep/bin/activate && python scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmasslowztot --caps south --dist pbg --z-bin b3 --random-kind random1 --threads 4 --nmu 60 --z-source obs --los midpoint"`
- peakfit（例）：
  - `python -B scripts/cosmology/cosmology_bao_catalog_peakfit.py --sample lowz --caps north --dists lcdm,pbg`
  - `python -B scripts/cosmology/cosmology_bao_catalog_peakfit.py --sample cmasslowztot --caps south --dists lcdm,pbg --require-zbin`
- 集計：
  - `python -B scripts/cosmology/cosmology_bao_catalog_peak_summary.py`
  - `python -B scripts/cosmology/cosmology_bao_catalog_wedge_anisotropy.py`
- スコアボード/まとめ：
  - `python -B scripts/summary/validation_scoreboard.py`
  - `python -B scripts/summary/run_all.py --online`


---

## 2026-01-12（UTC） Step 16.4（BAO一次情報：銀河+random）：CMASSLOWZTOT z-bin1（b1）の異常切り分けと抽出仕様の修正

目的：
- CMASSLOWZTOT の z-bin1（b1=[0.2,0.5)）で、ξ0 が不自然に大きい（s²ξ0 が単調増加/オーダー違い）問題を解消し、z-bin（0.38/0.51/0.61）の入口を安定化する。
- ε の変動が「理論差」ではなく「入力（抽出）差」で混ざらないよう、入力側（galaxy/random）の抽出仕様も固定する。

原因（切り分け）：
- b1 の異常は、random の行数（prefix）そのものではなく、**galaxy を prefix 抽出（200k）していたことによる selection function の破綻**が主因だった。
  - b1 だけ galaxy と random の z 分布が大きくズレ、DD/RR の比が過大になって ξ が過大化していた。
  - galaxy を download_full（全行抽出）に切り替えると、north/south とも b1 の ξ0/ξ2 が通常レンジに戻ることを確認。

実施：
- `scripts/cosmology/fetch_boss_dr12v5_lss.py`
  - CMASSLOWZTOT の galaxy を `--galaxy-sampling download_full`（全行抽出）へ切替（north/south）。
  - random1 は現状 Phase A のスクリーニングとして `prefix_rows` を維持しつつ、`--random-max-rows 2000000` へ増量。
- `scripts/cosmology/cosmology_bao_xi_from_catalogs.py`（WSL + Corrfunc）
  - CMASSLOWZTOT: b1/b2/b3 × north/south/combined × lcdm/pbg を再計算（b1の異常解消を反映）。
- `scripts/summary/run_all.py`
  - まとめ生成時に catalog-based BAO の派生図（wedge/peakfit/summary）も更新されるよう、タスクに追加（optional）。

出力（更新）：
- 抽出NPZ（galaxy download_full）：
  - `data/cosmology/boss_dr12v5_lss/extracted/galaxy_DR12v5_CMASSLOWZTOT_North.fits.gz.npz`
  - `data/cosmology/boss_dr12v5_lss/extracted/galaxy_DR12v5_CMASSLOWZTOT_South.fits.gz.npz`
- ξℓ（Corrfunc; WSL）：
  - `output/cosmology/cosmology_bao_xi_from_catalogs_cmasslowztot_{combined,north,south}_{lcdm,pbg}_{b1,b2,b3}.png`（metrics/json/npzも更新）
- peakfit（catalog-based）：
  - `output/cosmology/cosmology_bao_catalog_peakfit_cmasslowztot_{combined,north,south}_zbinonly.png`（metricsも更新）
- スコアボード/論文/レポート：
  - `output/summary/validation_scoreboard.png` / `output/summary/validation_scoreboard.json`
  - `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`
  - `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`

再現：
- 抽出（時間がかかる：CMASSLOWZTOT random1 はGB級）：
  - `python -B scripts/cosmology/fetch_boss_dr12v5_lss.py --samples cmasslowztot --caps north,south --random-kind random1 --random-sampling prefix_rows --random-max-rows 2000000 --galaxy-sampling download_full`
- ξℓ再計算（例；WSL venv は `~/.venv/wavep`）：
  - `wsl -e bash -lc "source ~/.venv/wavep/bin/activate && cd /mnt/c/develop/waveP && python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmasslowztot --caps combined --dist lcdm --random-kind random1 --z-bin b1 --nmu 60 --threads 12"`
- 派生図/スコアボード/論文/レポート：
  - `python -B scripts/summary/run_all.py --offline`


---

## 2026-01-12（UTC） Step 16.4（BAO一次情報：銀河+random）：公開 multipoles と catalog-based ξℓ の ε クロスチェック図を追加（Phase A4）

目的：
- Phase A4 として、catalog-based（galaxy+random; Corrfunc）で再計算した ξℓ（ℓ=0,2）の peakfit と、公開済み multipoles（post/pre-recon）の peakfit を同一指標 ε（AP warping）で突き合わせる。
- Phase B（P-modelでreconstructionも自前）へ進む前に、ε の差が「理論差」ではなく「実装/座標化差」や「誤差モデル」の混入でないことを切り分ける入口を用意する。

実施：
- `scripts/cosmology/cosmology_bao_catalog_vs_published_crosscheck.py`
  - 公開 multipoles（Ross post / Satpathy pre）と catalog-based peakfit（cmasslowztot z-bin）から ε を抽出し、2パネル（published比較 / 距離写像比較）で可視化するクロスチェック図を追加。
  - Windows でも日本語が欠けないよう、日本語フォント設定を適用。
- `scripts/summary/run_all.py`
  - 上記クロスチェック図の生成タスクを追加（optional）。
- `doc/paper/01_figures_index.md`, `doc/paper/10_manuscript.md`
  - BAO（一次統計 ξℓ からの再導出：入口）にクロスチェック図を追加して論文化へ反映。

出力（追加/更新）：
- クロスチェック図：
  - `output/cosmology/cosmology_bao_catalog_vs_published_crosscheck.png`
  - `output/cosmology/cosmology_bao_catalog_vs_published_crosscheck_metrics.json`
- レポート/論文（最新を再生成）：
  - `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`
  - `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`

再現：
- クロスチェック図：
  - `python -B scripts/cosmology/cosmology_bao_catalog_vs_published_crosscheck.py`
- まとめ生成：
  - `python -B scripts/summary/run_all.py --offline`


---

## 2026-01-12（UTC） Step 16.4（BAO一次情報：銀河+random）：重み付け仕様（weight scheme）を固定し、ε の感度を可視化（Phase A5）

目的：
- A0（座標化仕様の固定：redshift/LOS/distance）に加えて、**重み付け仕様も同レベルで固定**し、ε の変動が「理論差」か「座標化（実装）差」か混ざらないようにする。
- 公開 multipoles と catalog-based ξℓ の差分切り分けの一環として、BOSS標準 / FKPのみ / 重みなし（w=1）が ε に与える影響を定量化する（Phase A の品質管理）。

実施：
- `scripts/cosmology/cosmology_bao_xi_from_catalogs.py`
  - `--weight-scheme`（`boss_default` / `fkp_only` / `none`）を追加。
  - `coordinate_spec` と metrics に重み仕様（定義・利用カラム）を保存。
  - `boss_default` 以外は `--out-tag` を自動付与し、既定出力を上書きしないようにした。
- `scripts/cosmology/cosmology_bao_catalog_peakfit.py`
  - 入力（metrics）の `weight_scheme` 混在を検出してエラー化（議論のブレ防止）。
  - `out_tag` を出力ファイル名へ反映し、派生比較（w_none / w_fkp_only）を並行保存できるようにした。
- `scripts/cosmology/cosmology_bao_catalog_weight_scheme_sensitivity.py`
  - published vs catalog-based の ε を、重み仕様別に比較する2パネル図（ε(z), Δε）を追加。
- `scripts/summary/run_all.py`
  - 上記の感度図をまとめ生成タスクへ追加（optional）。
- `doc/paper/01_figures_index.md`, `doc/paper/10_manuscript.md`
  - BAO（一次統計 ξℓ からの再導出：入口）に「重み仕様を固定する理由」と感度図を追記。

出力（追加/更新）：
- 感度図：
  - `output/cosmology/cosmology_bao_catalog_weight_scheme_sensitivity.png`
  - `output/cosmology/cosmology_bao_catalog_weight_scheme_sensitivity_metrics.json`
- 追加の peakfit 出力（既定を上書きしない別タグ）：
  - `output/cosmology/cosmology_bao_catalog_peakfit_cmasslowztot_combined_zbinonly__w_none.png`（metricsも）
  - `output/cosmology/cosmology_bao_catalog_peakfit_cmasslowztot_combined_zbinonly__w_fkp_only.png`（metricsも）
- レポート/論文（最新を再生成）：
  - `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`
  - `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`

再現：
- ξℓ再計算（例；WSL + Corrfunc）：
  - `wsl -e bash -lc "source ~/.venv/wavep/bin/activate && cd /mnt/c/develop/waveP && python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmasslowztot --caps combined --dist lcdm --random-kind random1 --z-bin b3 --weight-scheme boss_default --nmu 60 --threads 12"`
  - `wsl -e bash -lc "source ~/.venv/wavep/bin/activate && cd /mnt/c/develop/waveP && python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmasslowztot --caps combined --dist lcdm --random-kind random1 --z-bin b3 --weight-scheme fkp_only --out-tag w_fkp_only --nmu 60 --threads 12"`
  - `wsl -e bash -lc "source ~/.venv/wavep/bin/activate && cd /mnt/c/develop/waveP && python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmasslowztot --caps combined --dist lcdm --random-kind random1 --z-bin b3 --weight-scheme none --out-tag w_none --nmu 60 --threads 12"`
- 感度図：
  - `python -B scripts/cosmology/cosmology_bao_catalog_weight_scheme_sensitivity.py`
- まとめ生成：
  - `python -B scripts/summary/run_all.py --offline`


---

## 2026-01-13（UTC） BAO一次統計（Phase A）の集計を baseline に固定し、recon(iso) の ε クロスチェックを追加

目的：
- Phase A（スクリーニング）で、重み/ランダム抽出/recon 等の「派生出力」が同一グラフに混ざり、幾何差（モデル差）と実装差が混線しないようにする。
- catalog-based recon(iso) を ε（peakfit）でも公開post-reconと突き合わせ、Phase B（P-model距離写像＋recon自前化）へ繋ぐ入口を強化する。

変更：
- `scripts/cosmology/cosmology_bao_catalog_peak_summary.py`
  - `--out-tag` フィルタ（none/any/exact）を追加し、baseline（out_tag=null）へ固定できるようにした。
- `scripts/cosmology/cosmology_bao_catalog_vs_published_crosscheck.py`
  - `--catalog-recon`（既定：`*_recon_grid_iso_metrics.json`）を追加し、存在する場合は recon(iso) の ε を図へ併記するようにした。
- `scripts/summary/run_all.py`
  - `cosmology_bao_catalog_peak_summary` を cmasslowztot/combined/z-bin に固定して生成（baselineのみ）。
  - `cosmology_bao_catalog_peakfit_*__recon_grid_iso`（recon(iso)のε）を追加して自動生成。
- `doc/STATUS.md`
  - 上記の進捗を追記。

出力（更新/追加）：
- z依存サマリ（baseline固定）：
  - `output/cosmology/cosmology_bao_catalog_peak_summary.png`（metricsも）
- catalog recon(iso) の ε（peakfit）：
  - `output/cosmology/cosmology_bao_catalog_peakfit_cmasslowztot_combined_zbinonly__recon_grid_iso.png`（metricsも）
- εクロスチェック（recon系列を併記）：
  - `output/cosmology/cosmology_bao_catalog_vs_published_crosscheck.png`（metricsも）
- レポート/論文（最新を再生成）：
  - `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`
  - `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`

再現：
- `python -B scripts/summary/run_all.py --offline`


---

## 2026-01-13（UTC） Step 16.4（BAO一次情報：銀河+random）：公開 multipoles と catalog-based ξℓ の曲線オーバーレイで正規化/形状を確認（Phase A6）

目的：
- ε（AP warping）クロスチェックは「1つの指標」なので、正規化・振幅・形状の破綻を見落としやすい。
- そこで、公開 multipoles（Ross post-recon; ξ0/ξ2）と catalog-based（Corrfunc）の s²ξ0/ξ2 曲線を直接重ね、パイプラインの整合（Phase A）を確認する。

実施：
- `scripts/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay.py`
  - z-bin（1/2/3）について、Ross 公開データ（bincent0）と catalog-based（cmasslowztot/combined/lcdm）の曲線を重ね描き。
  - z-binごとに RMSE（s²ξ0/ξ2）を算出し、数値として保存。
- `scripts/summary/run_all.py`
  - 上記のオーバーレイ図をまとめ生成タスクへ追加（optional）。
- `doc/paper/01_figures_index.md`, `doc/paper/10_manuscript.md`
  - BAO（一次統計 ξℓ からの再導出：入口）に、オーバーレイ図と「正規化/形状チェック」の説明を追記。

出力（追加/更新）：
- オーバーレイ図：
  - `output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay.png`
  - `output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay_metrics.json`
- レポート/論文（最新を再生成）：
  - `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`
  - `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`

再現：
- オーバーレイ図：
  - `python -B scripts/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay.py`
- まとめ生成：
  - `python -B scripts/summary/run_all.py --offline`


---

## 2026-01-13（UTC） Step 16.4（BAO一次情報：銀河+random）：random 行数（max_rows）感度を可視化し、Phase A の baseline を固定（Phase A6）

目的：
- published multipoles と catalog-based ξℓ の ε 差を議論する前に、random カタログの行数（max_rows）が ε をどの程度揺らすかを確認する。
- Phase A（スクリーニング）では random 抽出仕様（kind/sampling/max_rows）を固定して比較し、ε の差が「理論差」ではなく「入力仕様差」に起因しないようにする。

実施：
- `scripts/cosmology/fetch_boss_dr12v5_lss.py`
  - CMASSLOWZTOT の random1 を `prefix_rows` で 500k に切り替え、manifest を更新（計算後に 2M へ復帰）。
- `scripts/cosmology/cosmology_bao_xi_from_catalogs.py`（WSL + Corrfunc）
  - CMASSLOWZTOT combined / lcdm の z-bin（b1/b2/b3）を `--out-tag rnd_prefix_500k` で再計算。
- `scripts/cosmology/cosmology_bao_catalog_peakfit.py`
  - 上記 out_tag の ξℓ に peakfit（smooth+peak）を適用し、ε を算出。
- `scripts/cosmology/cosmology_bao_catalog_random_max_rows_sensitivity.py`
  - baseline（random prefix 2M）と比較し、published（Ross post）に対する ε/Δε を2パネルで可視化（±1σは対称近似）。
- `scripts/summary/run_all.py`
  - 上記の感度図をまとめ生成タスクへ追加（optional）。
- `doc/paper/01_figures_index.md`, `doc/paper/10_manuscript.md`
  - BAO（一次統計 ξℓ からの再導出：入口）に「random 行数が ε を揺らす」注意と感度図を追記。

出力（追加/更新）：
- ξℓ（random prefix 500k; out_tag 付き）：
  - `output/cosmology/cosmology_bao_xi_from_catalogs_cmasslowztot_combined_lcdm_b1__rnd_prefix_500k.png`（metrics/npz も）
  - `output/cosmology/cosmology_bao_xi_from_catalogs_cmasslowztot_combined_lcdm_b2__rnd_prefix_500k.png`（metrics/npz も）
  - `output/cosmology/cosmology_bao_xi_from_catalogs_cmasslowztot_combined_lcdm_b3__rnd_prefix_500k.png`（metrics/npz も）
- peakfit（out_tag 付き）：
  - `output/cosmology/cosmology_bao_catalog_peakfit_cmasslowztot_combined_zbinonly__rnd_prefix_500k.png`（metricsも）
- 感度図：
  - `output/cosmology/cosmology_bao_catalog_random_max_rows_sensitivity.png`
  - `output/cosmology/cosmology_bao_catalog_random_max_rows_sensitivity_metrics.json`
- レポート/論文（最新を再生成）：
  - `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`
  - `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`

再現：
- manifest 切替（例：500k → 計算 → 2Mへ復帰）：
  - `python -B scripts/cosmology/fetch_boss_dr12v5_lss.py --samples cmasslowztot --caps north,south --random-kind random1 --random-sampling prefix_rows --random-max-rows 500000 --galaxy-sampling download_full`
  - `python -B scripts/cosmology/fetch_boss_dr12v5_lss.py --samples cmasslowztot --caps north,south --random-kind random1 --random-sampling prefix_rows --random-max-rows 2000000 --galaxy-sampling download_full`
- ξℓ再計算（例；WSL + Corrfunc）：
  - `wsl -e bash -lc "source ~/.venv/wavep/bin/activate && cd /mnt/c/develop/waveP && python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmasslowztot --caps combined --dist lcdm --random-kind random1 --z-bin b3 --weight-scheme boss_default --nmu 60 --threads 12 --out-tag rnd_prefix_500k"`
- peakfit：
  - `python -B scripts/cosmology/cosmology_bao_catalog_peakfit.py --sample cmasslowztot --caps combined --dists lcdm --require-zbin --out-tag rnd_prefix_500k`
- 感度図：
  - `python -B scripts/cosmology/cosmology_bao_catalog_random_max_rows_sensitivity.py`
- まとめ生成：
  - `python -B scripts/summary/run_all.py --offline`


---

## 2026-01-13（UTC） 論文：宇宙論（2.5）を3章構成へ再整理（BAO一次統計 / 独立プローブ / 距離指標依存）

目的：
- 宇宙論の議論が「一次統計（BAOの元データ）」「距離指標と独立な一次ソース」「距離指標（標準光源/標準定規）依存と BAO 前提」に混在していたため、章立てで分離し、議論の混線を防ぐ。

変更：
- `doc/paper/10_manuscript.md`
  - 2.5 を次の3章に分割して再配置：
    - 2.5.1：BAO一次統計の詳細（ξℓ/ξ(s,μ) からの再導出、入力仕様固定の理由）
    - 2.5.2：宇宙論 I（距離指標と独立な検証：SN time dilation / CMB T(z) / AP）
    - 2.5.3：宇宙論 II（距離指標依存と BAO の前提：DDR/Tolman/誤差予算/再接続）
- `doc/paper/01_figures_index.md`
  - Cosmology（宇宙論）に本文 2.5 の3章構成メモを追記。

出力（再生成）：
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`

再現：
- `python -B scripts/summary/run_all.py --offline`


---

## 2026-01-13（UTC） BAOオーバーレイに Satpathy（pre-recon）を併記し、pre/post-recon差を分離

目的：
- catalog-based（DR12v5 LSS; pre-recon）と公開 multipoles の比較で、ξ2 の差が「実装差」か「recon差」か混ざらないようにする。
- Phase A の品質管理として、(i) Satpathy pre-recon との整合（再計算パイプライン検証）と、(ii) Ross post-recon との差（recon効果）を同一図で把握する。

変更：
- `scripts/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay.py`
  - Ross post-recon に加えて Satpathy pre-recon を同一図に重ね、RMSE（Ross/Satpathy）を同時に出力するよう更新。
- `doc/paper/10_manuscript.md`
  - 2.5.1 の記述を「catalog-based は pre-recon」へ揃え、オーバーレイ図の意図（Satpathy=整合、Ross=recon差）を明記。
- `doc/paper/01_figures_index.md`
  - オーバーレイ図の説明を Ross/Satpathy 併記へ更新。

出力（更新）：
- `output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay.png`
- `output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay_metrics.json`
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`

再現：
- `python -B scripts/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay.py`
- `python -B scripts/summary/run_all.py --offline`


---

## 2026-01-13（UTC） BAO一次統計（銀河+random）へ簡易reconstructionを導入し、公開post-reconとの整合を追加チェック

目的：
- BAOの“圧縮出力”（距離比など）ではなく、一次統計（銀河+random→ξ(s,μ)→ξℓ）から P-model 側で再導出する方針のため、Phase A（幾何の整合チェック）と Phase B（P-modelでreconstructionも自前化）を最短で接続する。
- 公開 multipoles の pre/post-recon差（recon効果）と、実装差（正規化/重み/セクタ一致など）を混線させない。

変更：
- `scripts/cosmology/cosmology_bao_xi_from_catalogs.py`
  - 簡易 reconstruction（`--recon grid`）を追加（`--recon-mode iso/ani`、格子・平滑化・bias/f など）。
  - recon有効時は出力ファイル名へタグを自動付与し、既定出力を上書きしないようにした。
  - `coordinate_spec` に reconstruction 条件を保存し、議論の前提（A0固定）が崩れないようにした。
- `scripts/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay.py`
  - catalog-based recon 曲線の併記を追加（`--catalog-recon-suffix`、既定=`__recon_grid_iso`）。
  - Ross post-recon への RMSE（recon曲線）も metrics に記録。
- `doc/paper/10_manuscript.md`, `doc/paper/01_figures_index.md`
  - 2.5.1 のオーバーレイ説明を、catalog-based recon(iso) を含む最新版へ更新。

出力（追加/更新）：
- catalog-based recon 出力（例）：
  - `output/cosmology/cosmology_bao_xi_from_catalogs_cmasslowztot_combined_lcdm_b1__recon_grid_iso.png`（npz/metricsも）
  - `output/cosmology/cosmology_bao_xi_from_catalogs_cmasslowztot_combined_lcdm_b2__recon_grid_iso.png`（npz/metricsも）
  - `output/cosmology/cosmology_bao_xi_from_catalogs_cmasslowztot_combined_lcdm_b3__recon_grid_iso.png`（npz/metricsも）
- オーバーレイ（更新）：
  - `output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay.png`
  - `output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay_metrics.json`
- レポート/論文（最新を再生成）：
  - `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`
  - `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`

再現：
- ξℓ再計算（例；WSL + Corrfunc；recon=grid, iso）：
  - `wsl --cd /mnt/c/develop/waveP -- bash -lc "source ~/.venv/wavep/bin/activate; python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmasslowztot --caps combined --dist lcdm --z-bin b2 --random-kind random1 --nmu 60 --threads 12 --recon grid --recon-mode iso"`
- オーバーレイ（catalog recon 併記；既定で `__recon_grid_iso` を使用）：
  - `python -B scripts/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay.py`
- まとめ生成：
  - `python -B scripts/summary/run_all.py --offline`


---

## 2026-01-13（UTC） BAO：簡易reconstruction（iso）の平滑化スキャンを追加し、Ross post-recon への一致度（RMSE）を定量化

目的：
- catalog-based ξℓ（galaxy+random; Corrfunc）に簡易reconstruction（grid; iso）を適用したとき、パラメータ（平滑化スケール）が ξ0/ξ2（特に ξ2）へ与える影響を切り分ける。
- 「ξ2が合わない」の原因が smoothing の設定なのか、それ以外（reconアルゴリズム/境界/選択関数/実装前提）なのかを Phase A の段階で見極め、Phase B の焦点（recon前提の一次ソース化）を定める。

変更：
- `scripts/cosmology/cosmology_bao_xi_from_catalogs.py`
  - recon(iso) の平滑化スケールを変えた出力（例：smoothing=10/20 Mpc/h）を、`--out-tag` を用いて並行保存（z-bin b1/b2/b3）。既定（15 Mpc/h）と比較できるようにした。
- `scripts/cosmology/cosmology_bao_recon_param_scan.py`
  - Ross post-recon（公開 multipoles）に対する RMSE（s²ξ0, s²ξ2）を out_tag（recon設定）ごとに集計し、ξ2重み付きスコアでランキングするスキャン図を追加。
  - Ross data の既定パスを `data/cosmology/ross_2016_combineddr12_corrfunc` に修正（存在しない旧パスでも自動フォールバック）。
- `scripts/summary/run_all.py`
  - recon param scan を optional タスクとして追加（既存の ξℓ出力がある場合に生成）。
- `doc/paper/01_figures_index.md`, `doc/paper/10_manuscript.md`
  - 2.5.1（BAO一次統計）に、reconパラメータの感度と「smoothing調整だけでは ξ2 差が残る」点を追記。

結果（要約）：
- smoothing=10/15/20 の範囲では、ξ0 の一致はわずかに改善し得る一方で、ξ2 の RMSE は大きく（~76）残り、単純な smoothing 調整だけでは Ross post-recon の ξ2 を再現できない。
- したがって Phase B では、recon の前提（アルゴリズム/境界/選択関数/LOS 等）の一次ソース化と再現性向上が必要。

出力（追加/更新）：
- recon(iso) 出力（例；平滑化スケール違い）：
  - `output/cosmology/cosmology_bao_xi_from_catalogs_cmasslowztot_combined_lcdm_b1__recon_grid_iso_s10.png`（npz/metricsも）
  - `output/cosmology/cosmology_bao_xi_from_catalogs_cmasslowztot_combined_lcdm_b2__recon_grid_iso_s10.png`（npz/metricsも）
  - `output/cosmology/cosmology_bao_xi_from_catalogs_cmasslowztot_combined_lcdm_b3__recon_grid_iso_s10.png`（npz/metricsも）
  - `output/cosmology/cosmology_bao_xi_from_catalogs_cmasslowztot_combined_lcdm_b1__recon_grid_iso_s20.png`（npz/metricsも）
  - `output/cosmology/cosmology_bao_xi_from_catalogs_cmasslowztot_combined_lcdm_b2__recon_grid_iso_s20.png`（npz/metricsも）
  - `output/cosmology/cosmology_bao_xi_from_catalogs_cmasslowztot_combined_lcdm_b3__recon_grid_iso_s20.png`（npz/metricsも）
- recon param scan：
  - `output/cosmology/cosmology_bao_recon_param_scan.png`
  - `output/cosmology/cosmology_bao_recon_param_scan_metrics.json`
- レポート/論文（最新を再生成）：
  - `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`
  - `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`

再現：
- recon param scan：
  - `python -B scripts/cosmology/cosmology_bao_recon_param_scan.py --include-baseline`
- まとめ生成：
  - `python -B scripts/summary/run_all.py --offline`


---

## 2026-01-13（UTC） BAO簡易reconstruction(ani)の仕様固定（RSD solver/LOS shift）と追加テスト（Ross ξ2ギャップは未解決）

目的：
- A0（座標化仕様）と同様に、reconstruction の「RSDの扱い（solver/shift）」と「LOS定義」を明示的に固定し、あとで議論がブレないようにする。
- Ross post-recon の ξ2 差が、RSD solver / LOS shift の実装差で改善する余地があるかを、z-bin2（b2）で追加テストする。

変更：
- `scripts/cosmology/cosmology_bao_xi_from_catalogs.py`
  - recon(ani) 用の追加パラメータを導入：
    - `--recon-rsd-solver`（`global_constant` / `none`）
    - `--recon-los-shift`（`global_mean_direction` / `radial`）
  - recon の `spec` に `rsd_solver` / `los_shift_model` 等を保存し、出力（npz/metrics）で前提が追跡できるようにした。

結果（要約）：
- z-bin2（b2）での追加テストでは、Ross post-recon の ξ2 ギャップは改善せず（むしろ悪化する組合せが多い）。
  - `ani_radial_nosolver`：RMSE(s²ξ2)≈113（悪化）
  - `ani_radial_solver`：RMSE(s²ξ2)≈90（依然大）
  - `ani_global_nosolver`：RMSE(s²ξ2)≈92（依然大）
- したがって現状は、Phase A では recon(iso) を baseline として「ピーク位置＋異方（ε）」を主指標にし、Phase B で recon 前提（境界/割当/選択関数/LOS/RSD）を一次ソースとして精密化する方針を維持する。

出力（追加）：
- `output/cosmology/cosmology_bao_xi_from_catalogs_cmasslowztot_combined_lcdm_b2__recon_grid_ani_radial_nosolver.png`（npz/metricsも）
- `output/cosmology/cosmology_bao_xi_from_catalogs_cmasslowztot_combined_lcdm_b2__recon_grid_ani_radial_solver.png`（npz/metricsも）
- `output/cosmology/cosmology_bao_xi_from_catalogs_cmasslowztot_combined_lcdm_b2__recon_grid_ani_global_nosolver.png`（npz/metricsも）

再現（例；WSL + Corrfunc；z-bin2のみ）：
- `wsl --cd /mnt/c/develop/waveP -- bash -lc "source ~/.venv/wavep/bin/activate; python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmasslowztot --caps combined --dist lcdm --z-bin b2 --random-kind random1 --nmu 120 --threads 12 --recon grid --recon-mode ani --recon-rsd-solver global_constant --recon-los-shift radial --out-tag ani_radial_solver"`


---

## 2026-01-13（UTC） BAO簡易reconstruction：CIC割当での delta 爆発を抑制（mask_expected_frac を導入）

目的：
- recon の格子割当を NGP→CIC にすると、random密度（expected）が極小のセルまで非ゼロ化しやすく、`delta=(n-expected)/expected` が発散して変位（Ψ）が非物理的に巨大化する（→ ξ0 が桁違いに崩壊）。
- Phase B で「割当（NGP/CIC）の差」が議論のブレ要因にならないよう、CICを安全に使える最小のマスク規約を固定（A0と同レベルで前提を固定）する。

変更：
- `scripts/cosmology/cosmology_bao_xi_from_catalogs.py`
  - `--recon-mask-expected-frac` を追加（mask: expected(random) <= frac×median(expected>0) を除外）。
  - 既定は auto（ngp=0.0 / cic=0.3）として、CICの delta 爆発を抑制。
  - metrics に recon のマスク条件（spec）と、capごとの runtime（expected_floor / kept_cell_fraction / Ψサンプル統計）を保存。

結果（要約）：
- CIC（iso）をそのまま適用すると、z-bin2 で delta が発散し、`s²ξ0` が非現実的に巨大化する問題が再現した。
- `mask_expected_frac` により発散は解消し、CIC（iso）の ξ0/ξ2 は NGP（iso）と同程度のスケールに復帰。
- Ross post-recon との一致（RMSE）は、z-bin2 の `s²ξ2` がわずかに改善（例：~74→~71）する一方、根本ギャップは残るため、Phase B の焦点（境界/選択関数/公式recon仕様の再現）を継続する。

出力（更新）：
- `output/cosmology/cosmology_bao_xi_from_catalogs_cmasslowztot_combined_lcdm_b2__recon_grid_iso_assign_cic.png`（npz/metricsも）

再現：
- CIC（iso；既定autoの mask）：
  - `wsl --cd /mnt/c/develop/waveP -- bash -lc "source ~/.venv/wavep/bin/activate; python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmasslowztot --caps combined --dist lcdm --z-bin b2 --random-kind random1 --nmu 120 --threads 12 --recon grid --recon-mode iso --recon-assignment cic --out-tag iso"`


---

## 2026-01-13（UTC） BAO簡易reconstruction：CIC mask既定を 1.5 に更新（安定化）＋ out_tag 二重付与を抑制

目的：
- CIC割当では expected(random) が「微小非ゼロ」のセルを大量に作りやすく、maskが弱いと delta と変位Ψが大きくなりやすい。そこで **maskの既定値を強め**、NGPの有効マスク（kept_cell_fraction が ~数%）に近づけ、reconの安定性を上げる。
- CLIの `--out-tag` に `recon_grid_*` や `assign_*` を含めてしまった場合に、出力タグが二重付与されて混乱するのを避ける（自動付与は残しつつ、重複を抑制）。

変更：
- `scripts/cosmology/cosmology_bao_xi_from_catalogs.py`
  - `--recon-mask-expected-frac` の既定（auto）を更新：**ngp=0.0 / cic=1.5**
    - CIC baseline で kept_cell_fraction が NGP近傍（~数%）になるように寄せる（結果的にΨの暴れを抑制）。
  - `--out-tag` の自動付与（`recon_<mode>` / `assign_<ngp/cic>`）について、既に含まれている場合は重複付与しないようガードを追加。

結果（要約）：
- CMASSLOWZTOT（combined; z-bin b1/b2/b3）の CIC recon（iso）で、maskを強めると Ross post-recon との RMSE が改善し、NGP baseline と同程度まで回復した（ただし ξ2 の根本ギャップは継続）。
  - 例：z-bin2 の RMSE(s²ξ2) は ~79 → ~75 程度へ改善。

出力（更新/追加）：
- CIC baseline（既定mask=1.5; b1/b2/b3）：
  - `output/cosmology/cosmology_bao_xi_from_catalogs_cmasslowztot_combined_lcdm_b1__recon_grid_iso_assign_cic.png`（npz/metricsも）
  - `output/cosmology/cosmology_bao_xi_from_catalogs_cmasslowztot_combined_lcdm_b2__recon_grid_iso_assign_cic.png`（npz/metricsも）
  - `output/cosmology/cosmology_bao_xi_from_catalogs_cmasslowztot_combined_lcdm_b3__recon_grid_iso_assign_cic.png`（npz/metricsも）
- 参考（比較図）：
  - `output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay_assign_cic.png`（metricsも）

再現：
- CIC（iso；既定autoの mask=1.5）：
  - `wsl --cd /mnt/c/develop/waveP -- bash -lc "source ~/.venv/wavep/bin/activate; python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmasslowztot --caps combined --dist lcdm --z-bin b2 --random-kind random1 --nmu 120 --threads 12 --recon grid --recon-mode iso --recon-assignment cic --out-tag iso"`


---

## 2026-01-13（UTC） BAO（recon）差分要因の切り分け：RR分母（shifted random vs baseline）の診断を overlay に追加

目的：
- Ross post-recon と catalog-based recon の ξ2 ギャップが大きい。差の原因が
  - recon アルゴリズム差（境界/選択関数/LOS/RSD 等）なのか、
  - Landy–Szalay 推定器の RR 分母（shifted random の RR）の扱いなのか、
  を切り分ける。

変更：
- `scripts/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay.py`
  - recon の曲線について、分母 RR を baseline（unshifted random）の RR に置換する“診断系列”を追加（図中の破線）。
  - Ross post-recon との RMSE も `*_metrics.json` に追加（`*_recon_rr0_denom`）。

結果（要約）：
- 分母 RR を baseline に置換しても RMSE は改善せず（多くの z-bin で悪化）。
  したがって ξ2 ギャップの主因は RR 分母ではなく、reconstruction 前提/実装差側にあると判断する。

出力（更新）：
- `output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay.png`（metricsも）


---

## 2026-01-13（UTC） BAO（recon）差分要因の切り分け：recon bias b の感度（ξ2 RMSE）

目的：
- Ross post-recon と catalog-based recon(iso) の ξ2 ギャップが大きい。差の原因が「reconstruction 前提/実装差」なのか、単に線形バイアス `b`（δ/b）設定の違いで吸収できるのかを切り分ける。

実行：
- `cosmology_bao_xi_from_catalogs.py` を WSL + Corrfunc で再実行し、`--recon-bias` を振って z-bin（b1/b2/b3）の ξ0/ξ2 を生成（`--out-tag` で並行保存）。
- 生成した出力に対して `cosmology_bao_recon_param_scan.py` で Ross post-recon への RMSE（s²ξ0, s²ξ2）を再集計。

結果（要約）：
- `b` を下げると（変位が大きくなるため）ξ2 の RMSE が動くことを確認。
  - 例：平均RMSE(s²ξ2) が baseline（b=2）≈76 → `b=0.5` で ≈69 まで改善。
- ただし `b=0.5` は物理的バイアスとしては非現実的（CMASS/LOWZ の典型値と矛盾）であり、現段階では
  - 「境界/選択関数/割当/LOS/RSD 等の recon 実装差を `b` が吸収している」診断
  と位置づける（baseline の採用にはしない）。

出力（追加/更新）：
- `output/cosmology/cosmology_bao_xi_from_catalogs_cmasslowztot_combined_lcdm_b1__recon_grid_iso_b1.png`（npz/metricsも）
- `output/cosmology/cosmology_bao_xi_from_catalogs_cmasslowztot_combined_lcdm_b2__recon_grid_iso_b1.png`（npz/metricsも）
- `output/cosmology/cosmology_bao_xi_from_catalogs_cmasslowztot_combined_lcdm_b3__recon_grid_iso_b1.png`（npz/metricsも）
- `output/cosmology/cosmology_bao_xi_from_catalogs_cmasslowztot_combined_lcdm_b1__recon_grid_iso_b0p5.png`（npz/metricsも）
- `output/cosmology/cosmology_bao_xi_from_catalogs_cmasslowztot_combined_lcdm_b2__recon_grid_iso_b0p5.png`（npz/metricsも）
- `output/cosmology/cosmology_bao_xi_from_catalogs_cmasslowztot_combined_lcdm_b3__recon_grid_iso_b0p5.png`（npz/metricsも）
- `output/cosmology/cosmology_bao_recon_param_scan.png`（metricsも）

再現：
- ξℓ再計算（例；WSL + Corrfunc；recon=grid, iso, biasを振る）：
  - `wsl --cd /mnt/c/develop/waveP -- bash -lc "source ~/.venv/wavep/bin/activate; python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmasslowztot --caps combined --dist lcdm --z-bin b1 --random-kind random1 --nmu 60 --threads 12 --recon grid --recon-mode iso --recon-bias 1.0 --out-tag iso_b1"`
  - `wsl --cd /mnt/c/develop/waveP -- bash -lc "source ~/.venv/wavep/bin/activate; python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmasslowztot --caps combined --dist lcdm --z-bin b1 --random-kind random1 --nmu 60 --threads 12 --recon grid --recon-mode iso --recon-bias 0.5 --out-tag iso_b0p5"`
- RMSE集計：
  - `python -B scripts/cosmology/cosmology_bao_recon_param_scan.py`


---

## 2026-01-13（UTC） Step 16.4（宇宙論BAO）：recon推定器を標準形（DD−2DS+SS）/RR0へ固定、座標化仕様の署名/ハッシュを追加

目的：
- catalog-based BAO（銀河＋random→ξ(s,μ)→ξℓ）で、推定器・座標化仕様のブレを排除し、「理論差」と「座標化差」が混ざらない比較単位を固定する。
- Ross post-recon との ξ2 ギャップについて、「RR分母の取り方」ではなく recon 前提/実装差が主因かを切り分ける。

変更：
- `scripts/cosmology/cosmology_bao_xi_from_catalogs.py`
  - recon 有効時の推定器を標準形に固定（δ_rec=δ_D−δ_S）：
    - ξ_rec(s,μ)=(DDn−2DSn+SSn)/RR0n（RR0=unshifted random）
  - 出力 `.npz` に SS_w / ss_tot（shifted randomの自己相関）を追加し、後段で推定器を再現できるようにした。
  - metrics に `coordinate_spec_signature`（runtime除去）と `coordinate_spec_hash`（比較用ハッシュ）を追加し、座標化仕様が一致しているかを機械的に判定できるようにした。
- `scripts/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay.py`
  - 旧「RR分母置換（診断系列）」を削除（推定器定義が変わり比較の意味が薄くなるため）。
- `doc/paper/10_manuscript.md`
  - BAO recon 推定器（ξ_rec）の式を本文に明記。

結果（要約）：
- Satpathy pre-recon との形状整合は維持。
- Ross post-recon の ξ2 ギャップは依然大きく、主因は推定器（RR分母）ではなく、reconstruction の前提/実装差（境界・選択関数・LOS/RSD・アルゴリズム）側にある可能性が高い。

出力（更新）：
- `output/cosmology/cosmology_bao_xi_from_catalogs_*__recon_grid_*.npz`（SS_w/ss_tot を追加）
- `output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay.png`（overlay整理）
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`

再現：
- ξℓ再計算（例；WSL + Corrfunc；recon=grid, iso）：
  - `wsl --cd /mnt/c/develop/waveP -- bash -lc "source ~/.venv/wavep/bin/activate; python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmasslowztot --caps combined --dist lcdm --z-bin b2 --random-kind random1 --nmu 60 --threads 12 --recon grid --recon-mode iso --recon-assignment ngp --out-tag recon_grid_iso"`
- overlay更新：
  - `python -B scripts/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay.py`
- 論文/一般レポート生成（HTML+DOCX）：
  - `python -B scripts/summary/run_all.py --offline`


---

## 2026-01-13（UTC） Step 16.4（宇宙論BAO）：recon変位Ψの符号を修正（ξ2ギャップの改善）

目的：
- Ross post-recon と catalog-based recon の ξ2 ギャップが大きい原因のうち、最も基本的な実装差（Zel'dovich変位Ψの符号）を切り分ける。

変更：
- `scripts/cosmology/cosmology_bao_xi_from_catalogs.py`
  - 変位場の定義を Zel'dovich に合わせて修正：
    - Ψ(k)=−i k δ_s(k)/(b k^2)（以前は符号が逆）

結果（要約）：
- Ross post-recon との一致度が改善（ただしまだ大きな差が残るため、Phase Bで公式recon仕様へ寄せる必要あり）。
  - `output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay_metrics.json` の RMSE(s²ξ2; Ross vs catalog_recon):
    - z-bin1：78.46 → 74.07
    - z-bin2：79.12 → 72.44
    - z-bin3：86.20 → 77.72

出力（更新）：
- `output/cosmology/cosmology_bao_xi_from_catalogs_cmasslowztot_combined_lcdm_b{1,2,3}__recon_grid_iso.*`（npz/png/metrics）
- `output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay.*`
- `output/cosmology/cosmology_bao_catalog_peakfit_cmasslowztot_combined_zbinonly__recon_grid_iso.*`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`

再現：
- ξℓ（recon iso）再計算（例：b2）：
  - `wsl --cd /mnt/c/develop/waveP -- bash -lc "source ~/.venv/wavep/bin/activate; python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmasslowztot --caps combined --dist lcdm --z-bin b2 --random-kind random1 --nmu 60 --threads 12 --recon grid --recon-mode iso --out-tag recon_grid_iso"`
- overlay更新：
  - `python -B scripts/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay.py`
- レポート再生成：
  - `python -B scripts/summary/run_all.py --offline`


---

## 2026-01-13（UTC） Step 16.4（宇宙論BAO）：WSL再起動後のbaseline ξ(s,μ) 再計算とロードマップ詳細化

目的：
- WSL側の設定更新（マルチスレッド最適化）後に、Corrfunc を用いる BAO一次情報（銀河+random→ξ(s,μ)→ξℓ）を再実行し、**baseline出力が最新の実行環境で再現できる**ことを確認する。
- 宇宙論（Step 8.5）の作業分解を明文化し、Phase A（スクリーニング）→ Phase B（確証/決定打）へ迷いなく接続できるようにする。

作業：
- WSL再起動後、以下を再計算（baselineファイル名を維持して差し替え）
  - CMASS（combined）: dist=lcdm/pbg
  - LOWZ（combined）: dist=lcdm/pbg
  - CMASSLOWZTOT（combined; z-bin b1/b2/b3）: dist=lcdm/pbg
- `doc/STATUS.md` のUTC更新と、上記再計算の進捗を追記
- `doc/ROADMAP.md` の Step 8.5（宇宙論）に、BAO一次情報（Phase A/B）を中心とした作業分解（8.5.1〜）を追記

出力（更新）：
- `output/cosmology/cosmology_bao_xi_from_catalogs_cmass_combined_{lcdm,pbg}.*`
- `output/cosmology/cosmology_bao_xi_from_catalogs_lowz_combined_{lcdm,pbg}.*`
- `output/cosmology/cosmology_bao_xi_from_catalogs_cmasslowztot_combined_{lcdm,pbg}_b{1,2,3}.*`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`
- `output/summary/validation_scoreboard.(png|json)`

再現：
- 例：CMASS（combined, lcdm）：
  - `wsl -d Ubuntu-24.04 -- bash -lc "cd /mnt/c/develop/waveP && source ~/.venv/wavep/bin/activate && python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmass --caps combined --dist lcdm --random-kind random1 --threads 12"`
- 例：CMASSLOWZTOT（combined, z-bin2, pbg）：
  - `wsl -d Ubuntu-24.04 -- bash -lc "cd /mnt/c/develop/waveP && source ~/.venv/wavep/bin/activate && python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmasslowztot --caps combined --dist pbg --z-bin b2 --random-kind random1 --threads 12"`
- レポート再生成：
  - `python -B scripts/summary/run_all.py --offline`


---

## 2026-01-13（UTC） Step 16.4（宇宙論BAO）：recon FFT符号（psi_k_sign）をパラメータ化してA0仕様へ固定、baselineを再生成

目的：
- recon の実装差を切り分ける際に、Ψ(k) の FFT 符号（+i / −i）が暗黙に混ざって議論がブレないよう、A0（座標化仕様）として固定・記録する。
- Ross post-recon との一致度（RMSE; 特に s²ξ2）に対して、符号・mode の影響を「同一コードで」比較できるようにする。

変更：
- `scripts/cosmology/cosmology_bao_xi_from_catalogs.py`
  - `--recon-psi-k-sign`（±1）を追加し、recon の spec/metrics/`coordinate_spec_signature/hash` に含めた（混在を検出可能）。
  - baseline（`recon_grid_iso`）の再計算を実施し、`psi_k_sign=-1` を metrics に明示（比較単位の固定）。

結果（要約）：
- `psi_k_sign` の切替テストでは、`psi_k_sign=+1` は Ross post-recon への RMSE が悪化するため、baseline は `psi_k_sign=-1` とした。
- recon(ani) 系列は Ross post-recon の ξ2 ギャップを改善せず、現段階の baseline は引き続き recon(iso) とする（Phase Bで公式recon仕様へ寄せる）。

出力（更新）：
- `output/cosmology/cosmology_bao_xi_from_catalogs_cmasslowztot_combined_lcdm_b{1,2,3}__recon_grid_iso.*`（metrics に `psi_k_sign` を追記）
- `output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay.*`
- `output/cosmology/cosmology_bao_recon_param_scan.*`
- `output/cosmology/cosmology_bao_catalog_peakfit_cmasslowztot_combined_zbinonly__recon_grid_iso.*`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`

再現：
- ξℓ（recon iso; 例：b2, ψ符号を明示）：
  - `wsl --cd /mnt/c/develop/waveP -- bash -lc "source ~/.venv/wavep/bin/activate; python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmasslowztot --caps combined --dist lcdm --z-bin b2 --random-kind random1 --nmu 60 --threads 12 --recon grid --recon-mode iso --recon-psi-k-sign -1"`
- overlay更新：
  - `python -B scripts/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay.py`
- レポート再生成：
  - `python -B scripts/summary/run_all.py --offline`


---

## 2026-01-14（UTC） Phase 4 / Step 4.5（旧: Step 16.4）（宇宙論BAO）：recon座標化仕様の固定化（box_shape）と cube テスト、RSD solver β修正の評価

目的：
- BAO一次統計（銀河+random→ξ(s,μ)→ξℓ）の議論で「理論差」と「座標化差」が混ざらないよう、recon の座標化仕様（ボックス定義）を同レベルで固定・記録する。
- Ross et al. (2016) の post-recon ξℓ と比較し、recon 実装差（特に ξ2）の原因切り分けを進める（Phase 4 / Step 4.5 Stage B）。

変更：
- `scripts/cosmology/cosmology_bao_xi_from_catalogs.py`
  - RSD-aware solver の分母を `1+βμ²`（β=f/b）に修正（`_recon_displacement_grid_ngp()`）。
  - `--recon-box-shape {rect,cube}` を追加し、recon のボックス形状（rect/cube）を metrics の `coordinate_spec` に固定保存。

結果（要約）：
- cube box（`recon_grid_ani_box_cube`）は Ross post-recon との一致度が悪化（特に s²ξ2）。
  - 例（zbin2; cmasslowztot/combined/lcdm）：RMSE(s²ξ2) が `~72.4（recon_grid_iso）` → `~119.2（recon_grid_ani_box_cube）` に増加。
- RSD solver の β修正（`1+βμ²`）は理論的には正しいが、現時点では Ross post-recon の ξ2 ギャップを改善できていない。
- 当面の基準（Stage A参照）は `recon_grid_iso`（rect）を維持し、Stage B では境界/選択関数/公式recon仕様の差（RR/マスク/窓関数等）へ切り分け焦点を移す。

出力（追加/更新）：
- `output/cosmology/cosmology_bao_xi_from_catalogs_cmasslowztot_combined_lcdm_b{1,2,3}__recon_grid_ani_box_cube.*`
- `output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay__recon_grid_ani_box_cube.*`
- `output/cosmology/cosmology_bao_recon_param_scan.*`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`

再現：
- zbin2（cube box; ani）：
  - `wsl -d Ubuntu-24.04 -- bash -lc "cd /mnt/c/develop/waveP && source ~/.venv/wavep/bin/activate && python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmasslowztot --caps combined --dist lcdm --random-kind random1 --z-bin b2 --nmu 60 --threads 12 --recon grid --recon-mode ani --recon-rsd-solver global_constant --recon-los-shift global_mean_direction --recon-rsd-shift 1.0 --recon-box-shape cube"`
- overlay（cube box）：
  - `python -B scripts/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay.py --catalog-recon-suffix __recon_grid_ani_box_cube --out-png output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay__recon_grid_ani_box_cube.png --out-json output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay__recon_grid_ani_box_cube_metrics.json`
- レポート再生成：
  - `python -B scripts/summary/run_all.py --offline`


---

## 2026-01-14（UTC） Step 16.4（宇宙論BAO）：μ-wedge の ε_proxy 符号規約を peakfit の ε と整合させ、wedge/論文/レポートを再生成

目的：
- μ-wedge 由来の ε_proxy が peakfit の ε と符号が逆転して見える問題を解消し、指標の解釈を一貫させる（「理論差」か「座標化/解析仕様差」かの混線を防ぐ）。

変更：
- `scripts/cosmology/cosmology_bao_catalog_wedge_anisotropy.py`
  - ε_proxy 定義を `ε_proxy=(1/ratio)^(1/3)−1`（ratio=s∥/s⊥; wedge peak; fid座標）へ変更し、peakfit の ε（1+ε=(α∥/α⊥)^(1/3)）と符号を揃えた。
- `doc/paper/10_manuscript.md`
  - 2.5.1（BAO一次統計）の wedge 説明に ε_proxy 定義を明記した。
- `doc/STATUS.md` / `doc/ROADMAP.md`
  - A0（座標化仕様）補足として ε_proxy 定義を明記し、更新時刻を更新した。

結果（要約）：
- wedge ε_proxy と peakfit ε の符号が一致するようになり、Phase A のスクリーニング指標として解釈が一貫する状態になった。

出力（更新）：
- `output/cosmology/cosmology_bao_catalog_wedge_anisotropy.png` / `output/cosmology/cosmology_bao_catalog_wedge_anisotropy_metrics.json`
- `output/cosmology/cosmology_bao_catalog_wedge_anisotropy__recon_grid_iso.png` / `output/cosmology/cosmology_bao_catalog_wedge_anisotropy__recon_grid_iso_metrics.json`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`

再現：
- wedge 更新：
  - `python -B scripts/cosmology/cosmology_bao_catalog_wedge_anisotropy.py`
  - `python -B scripts/cosmology/cosmology_bao_catalog_wedge_anisotropy.py --out-tag recon_grid_iso`
- レポート再生成：
  - `python -B scripts/summary/run_all.py --offline`


---

## 2026-01-14（UTC） Phase 4 / Step 4.5（宇宙論BAO）：recon_grid_iso の NGC/SGC 分割を追加し、εのcap依存（系統切り分け）を固定図化

目的：
- Phase 4 / Step 4.5（BAO一次統計）で、NGC/SGC（north/south）を分割したときに ε（AP warping）がどれだけ動くかを確認し、「理論差」と「座標化/解析仕様差（系統）」を混同しないための固定図を作る。
- 特に recon（grid; iso; out_tag=recon_grid_iso）の段階で cap 依存が残るかを確認し、Phase B（確証決定打）で追加すべき要素（選択関数/窓関数/recon仕様）を明確化する。

作業：
- Corrfunc（WSL）で ξ(s,μ)→ξ0/ξ2 を NGC/SGC 分割でも再計算（CMASS/LOWZ、lcdm/pbg、out_tag=recon_grid_iso）
- peakfit（Windows）で ε を算出（CMASS/LOWZ、north/south、out_tag=recon_grid_iso）
- cap 依存のまとめ図を追加：
  - `scripts/cosmology/cosmology_bao_catalog_peakfit_caps_summary.py`
  - `output/cosmology/cosmology_bao_catalog_peakfit_caps_summary__recon_grid_iso.png`
- 論文へ系統切り分け結果を追記：
  - `doc/paper/10_manuscript.md`（2.5.1）
  - `doc/paper/01_figures_index.md`
- `scripts/summary/run_all.py` に、recon_grid_iso の north/south peakfit と caps summary を optional として追加

出力（追加/更新）：
- `output/cosmology/cosmology_bao_xi_from_catalogs_cmass_{north,south}_{lcdm,pbg}__recon_grid_iso.*`
- `output/cosmology/cosmology_bao_xi_from_catalogs_lowz_{north,south}_{lcdm,pbg}__recon_grid_iso.*`
- `output/cosmology/cosmology_bao_catalog_peakfit_cmass_{north,south}__recon_grid_iso.*`
- `output/cosmology/cosmology_bao_catalog_peakfit_lowz_{north,south}__recon_grid_iso.*`
- `output/cosmology/cosmology_bao_catalog_peakfit_caps_summary__recon_grid_iso.*`

再現：
- 例：CMASS north（lcdm, recon iso）：
  - `wsl -d Ubuntu-24.04 -- bash -lc "cd /mnt/c/develop/waveP && source ~/.venv/wavep/bin/activate && python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmass --caps north --dist lcdm --random-kind random1 --threads 12 --nmu 60 --recon grid --recon-mode iso --out-tag recon_grid_iso --recon-grid 256 --recon-smoothing 15 --recon-bias 2.0 --recon-psi-k-sign -1"`
- peakfit（CMASS north, out_tag=recon_grid_iso）：
  - `python -B scripts/cosmology/cosmology_bao_catalog_peakfit.py --sample cmass --caps north --out-tag recon_grid_iso`
- caps summary（recon_grid_iso）：
  - `python -B scripts/cosmology/cosmology_bao_catalog_peakfit_caps_summary.py --out-tag recon_grid_iso`
- レポート再生成：
  - `python -B scripts/summary/run_all.py --offline`


---

## 2026-01-14（UTC） Meta：`doc/ROADMAP.md` のStep現状表記を統制語へ統一

目的：
- `doc/ROADMAP.md` を「完了/未完了の基準」として運用するため、各Stepの `現状` 表記をブレない形に統一する。

変更：
- `doc/ROADMAP.md`
  - `現状` を `完了` / `進行中` / `準備中` / `保留` の統制語へ統一（旧：初版完了/整理済み/入口あり/継続運用中 など）。

参照：
- 現在地・次工程は `doc/STATUS.md` を一次参照。


---

## 2026-01-14（UTC） Meta：ロードマップ運用ルールの固定（ROADMAPを基準に完了/未完了を管理）

目的：
- ロードマップの断片化を防ぎ、今後の作業追加を「Phase→Step」へ統一する。

作業：
- `doc/ROADMAP.md` に運用ルールを追記（Phase 1-8 固定／追加作業は既存Phase配下にStep追記／`現状` 表記の統一）。
- `AGENTS.md` にも同ルールを追記（運用ルールをリポジトリ規約として固定）。

備考：
- 日々の現在地・詳細進捗は `doc/STATUS.md` を一次参照とする（UTC更新も含む）。


---

## 2026-01-14（UTC） Roadmap再編（Phase 1〜8）＋STATUS整理＋論文/レポート再生成

目的：
- 公式ロードマップ（Phase→Step）を基準に、断片化していた旧体系を整理し、現在地（Phase 4｜宇宙論）を明確化する。

変更：
- `doc/ROADMAP.md`
  - `C:\\Users\\ogawa\\Downloads\\p_model_roadmap_phase_step.md` を大枠に採用し、Phase 1〜8の統合ロードマップへ再編。
  - φ の表記を `-c^2 ln(P/P0)` に統一。
- `doc/ROADMAP_legacy_20260114.md`
  - 旧 `doc/ROADMAP.md` を退避（参照用）。
- `doc/STATUS.md`
  - 公式Phase 1〜8のステータス行に統一し、宇宙論（BAO一次統計）は Stage A/B 表記へ統一。
  - 旧NEXT_STEPS系の見出しは「参考（旧）」として明示（ロードマップは `doc/ROADMAP.md` を正とする）。

出力（更新）：
- `python -B scripts/summary/run_all.py --offline` を実行し、以下を更新。
  - `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`
  - `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`
  - `output/summary/run_all_status.json`
  - `output/summary/paper_table1_results.*`
  - `output/summary/validation_scoreboard.*`

再現：
- `python -B scripts/summary/run_all.py --offline`


---

## 2026-01-14（UTC） ロードマップ整理：Phase→Step階層へ統一（宇宙論/LLR/量子）

目的：
- ロードマップ表記が断片化しやすい（PhaseとStep、追加章、STATUS側の重複）問題を減らし、議論と実装の参照先を一本化する。
- 特に宇宙論（BAO一次統計：galaxy+random）の作業が拡大しているため、**Phase（上位）→Step（下位）**の階層へ統一する。

変更：
- `doc/ROADMAP.md`
  - Phase 16（宇宙論：静的無限空間仮説）を追加し、Step 16.1〜16.5 を Phase配下のStepとして整理。
  - 「追加（LLR）：NGLR-1」を Phase 17 として整理（Step 17.1〜17.3）。
  - 「追加（Quantum）：CHSH」を Phase 18 として整理し、Step表記を `Step 18.1〜18.6` に統一。
- `doc/STATUS.md`
  - 宇宙論ロードマップの“正”を `doc/ROADMAP.md`（Phase 16）へ寄せ、STATUS側は現在地＋成果物リンク中心に整理。

再現：
- `python -B scripts/summary/run_all.py --offline`


---

## 2026-01-14（UTC） ロードマップ拡張：量子もつれ（ベルテスト）章を追加し、ブリーフを `doc/` へ取り込み

目的：
- マクロ（宇宙物理）の検証で固めた P-model の枠組みを、ミクロ（ベルテスト：CHSH）へ拡張するための作業分解をロードマップへ追加する。
- ベルテストは解析仕様（time-tag / coincidence / Δt / trial定義）で結論が動き得るため、BAOのA0と同様に仕様固定→差分予言→反証条件、の順で進める方針を明文化する。

変更：
- 量子もつれ（ベルテスト）章を `doc/ROADMAP.md` に追加（差分予言・反証条件・固定出力名まで記載）。
- ユーザー作成の作業ブリーフを `doc/quantum/P-model_BellTest_AI_Brief.md` として保存し、参照先を固定。

再現：
- レポート再生成：
  - `python -B scripts/summary/run_all.py --offline`


---

## 2026-01-14（UTC） ロードマップ：LLR に NGLR-1 を追加（計測対象の拡張）

目的：
- LLR の検証対象に NGLR-1 を追加し、今後の実装（データ取り込み→モデル比較→図/指標→Table 1）をロードマップとして固定する。

変更：
- `doc/ROADMAP.md`
  - 「追加（LLR）：NGLR-1 を計測対象へ追加」を追記。

再現（レポート再生成）：
- `python -B scripts/summary/run_all.py --offline`


---

## 2026-01-14（UTC） Step 16.4（宇宙論BAO）：CMASS/LOWZ galaxy 抽出を reservoir 化し、ξℓ（Corrfunc）を再計算して paper/report を更新

目的：
- galaxy/random の prefix 抽出は「行順（ファイル内部順）」に依存し得るため、サブサンプルがセクタ（IPOLY/ISECT）等に偏るリスクがある。
- Phase A（スクリーニング）で ε の差を議論するときに「理論差」ではなく「抽出差」が混ざらないよう、**galaxy の抽出仕様を均一サンプル（reservoir）へ移行**して頑健化する。

変更：
- `data/cosmology/boss_dr12v5_lss/manifest.json`
  - CMASS/LOWZ（north/south）の galaxy 抽出を reservoir（200k, seed=0）へ移行（npz_path を更新）。
  - random は引き続き random1 + prefix_rows（max_rows=1,000,000）を使用（Phase A baseline）。
- WSL + Corrfunc で ξ(s,μ)→ξℓ（ℓ=0,2）を再計算（CMASS/LOWZ; north/south/combined; lcdm/pbg）。

出力（更新）：
- `output/cosmology/cosmology_bao_xi_from_catalogs_{cmass,lowz}_{combined,north,south}_{lcdm,pbg}.(npz|png|*_metrics.json)`
- `output/cosmology/cosmology_bao_catalog_peakfit_{cmass,lowz}_combined.(png|json)`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`

再現：
- 抽出（Windows, reservoir）：
  - `python -B scripts/cosmology/fetch_boss_dr12v5_lss.py --samples cmass,lowz --caps north,south --random-kind random1 --random-sampling prefix_rows --random-max-rows 1000000 --galaxy-sampling reservoir --galaxy-max-rows 200000 --sampling-seed 0`
- ξℓ 再計算（WSL, 例：CMASS combined, lcdm）：
  - `wsl -d Ubuntu-24.04 -- bash -lc "cd /mnt/c/develop/waveP && source ~/.venv/wavep/bin/activate && python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmass --caps combined --dist lcdm --random-kind random1 --threads 12"`
- レポート再生成：
  - `python -B scripts/summary/run_all.py --offline`


---

## 2026-01-14（UTC） Step 16.4（宇宙論BAO）：recon param scan に ani 系列（χ2/dof併記）を追加し、run_all へ統合

目的：
- iso の param scan に加え、RSD項を含む簡易 reconstruction（grid; ani）でも Ross post-recon への一致度を **誤差込み（χ2/dof）**で評価し、recon 前提差と理論差が混ざらないようにする。
- 論文本文で参照する図は run_all で毎回生成される状態に固定する。

変更：
- `scripts/summary/run_all.py`
  - `cosmology_bao_recon_param_scan_ani` を追加し、`output/cosmology/cosmology_bao_recon_param_scan_ani.*` を毎回生成するようにした。
- `doc/paper/10_manuscript.md` / `doc/paper/01_figures_index.md`
  - ani scan 図（`cosmology_bao_recon_param_scan_ani.*`）の参照を追加。

結果（要約）：
- `output/cosmology/cosmology_bao_recon_param_scan_ani_metrics.json` に、Ross 公開 covariance（mono+quad）から算出した χ2/dof（xi0+xi2）を併記。
- chi2/dof は依然として 1 を大きく超え、Phase B では公式recon仕様（境界/選択関数/LOS/RSD/アルゴリズム）へ寄せる必要がある。

出力（更新）：
- `output/cosmology/cosmology_bao_recon_param_scan_ani.png`
- `output/cosmology/cosmology_bao_recon_param_scan_ani_metrics.json`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`

再現：
- ani scan：
  - `python -B scripts/cosmology/cosmology_bao_recon_param_scan.py --out-tag-prefix recon_grid_ani --include-baseline --out-png output/cosmology/cosmology_bao_recon_param_scan_ani.png --out-json output/cosmology/cosmology_bao_recon_param_scan_ani_metrics.json`
- レポート再生成：
  - `python -B scripts/summary/run_all.py --offline`


---

## 2026-01-14（UTC） Step 16.4（宇宙論BAO）：recon param scan に χ2/dof（Ross共分散）を追加し、ランキングを誤差込みで評価

目的：
- recon パラメータ探索（平滑化スケール等）の比較指標を、RMSEだけでなく Ross 公開 covariance からの χ2/dof（xi0+xi2）でも評価し、「誤差内か」を同じ出力で判定できるようにする。

変更：
- `scripts/cosmology/cosmology_bao_recon_param_scan.py`
  - Ross 公開 covariance（mono+quad）を読み込み、指定 s 範囲の部分行列で χ2/dof（xi0+xi2）を算出して metrics に保存。
  - 既定のランキング指標を `rank_by=chi2` に変更（RMSEは併記のまま）。
- `doc/paper/10_manuscript.md` / `doc/paper/01_figures_index.md`
  - recon param scan 図の説明に χ2/dof 併記を追記。

出力（更新）：
- `output/cosmology/cosmology_bao_recon_param_scan.png`
- `output/cosmology/cosmology_bao_recon_param_scan_metrics.json`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`

再現：
- `python -B scripts/cosmology/cosmology_bao_recon_param_scan.py --include-baseline`
- `python -B scripts/summary/run_all.py --offline`


---

## 2026-01-14（UTC） Step 16.4（宇宙論BAO）：Ross共分散で χ2/dof を導入し、公開 ξℓ との差を誤差込みで定量化

目的：
- RMSE だけだと共分散（誤差相関）を無視するため、「差が統計的に有意か」を判断できない。
- Ross 2016 post-recon の公開 covariance（mono+quad）を用い、residual の χ2/dof を算出して、現状の差が「誤差内」と言えるかを定量化する。

変更：
- `scripts/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay.py`
  - Ross 共分散（mono+quad; 72×72）を読み込み、指定 s 範囲の部分行列で χ2/dof を算出して metrics に保存。
  - 図の注記に χ2/dof を追記（単なる見た目/RMSE ではなく、誤差込みの差の大きさを提示）。
- `doc/paper/10_manuscript.md`
  - 2.5.1 に「RMSEに加えて χ2/dof でも差の有意性を確認している」旨を追記。

結果（要約）：
- z-bin1〜3 いずれも χ2/dof が 1 を大きく上回り、現状の catalog-based recon(iso) と Ross post-recon の差は「誤差内」とは言えない（recon 前提/実装差の寄与が大きい）。

出力（更新）：
- `output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay.png`
- `output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay_metrics.json`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`

再現：
- overlay更新：
  - `python -B scripts/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay.py`
- レポート再生成：
  - `python -B scripts/summary/run_all.py --offline`


---

## 2026-01-14（UTC） Step 16.4（宇宙論BAO）：recon密度場重み（recon_weight_scheme）を分離してA0仕様へ固定、Ross ξ2ギャップの要因切り分け

目的：
- Ross post-recon の ξ2 乖離要因の切り分けとして、reconstruction 密度場（grid）の重みが暗黙に混ざらないよう仕様を固定する。
- paircount 重みと recon 密度場重みを分離し、「重み由来の差」と「recon 前提/実装差」を分けて評価できるようにする。

変更：
- `scripts/cosmology/cosmology_bao_xi_from_catalogs.py`
  - `--recon-weight-scheme`（same/boss_recon）を追加し、spec/metrics に保存（混在防止の固定点）。
  - recon 密度場重みを `w_g_recon/w_r_recon` として分離（paircount の `--weight-scheme` とは独立）。
  - `boss_recon` の定義：銀河 `w=WEIGHT_SYSTOT*(WEIGHT_CP+WEIGHT_NOZ-1)`（FKP無し）、random は `w=1`。
  - recon 有効かつ scheme!=same の場合、out_tag へ `rw_<scheme>` を自動付与して上書きを防止。

結果（要約）：
- `boss_recon` へ切替えても Ross post-recon との ξ2 RMSE はほぼ改善せず（重みは支配要因ではない）。

出力（追加/更新）：
- `output/cosmology/cosmology_bao_xi_from_catalogs_cmasslowztot_combined_lcdm_b{1,2,3}__recon_grid_iso_rw_boss_recon.*`
- `output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay_rw_boss_recon.*`
- `doc/paper/10_manuscript.md`（A0固定仕様に recon_weight_scheme を追記）
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`

再現：
- ξℓ（例：CMASSLOWZTOT b2, lcdm, recon iso, boss_recon）：
  - `wsl -- bash -lc "cd /mnt/c/develop/waveP && source ~/.venv/wavep/bin/activate && python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmasslowztot --caps combined --dist lcdm --z-bin b2 --random-kind random1 --recon grid --recon-mode iso --recon-weight-scheme boss_recon --threads 12"`
- overlay更新：
  - `python -B scripts/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay.py --catalog-recon-suffix __recon_grid_iso_rw_boss_recon`
- レポート再生成：
  - `python -B scripts/summary/run_all.py --offline`


---

## 2026-01-14（UTC） Step 16.4（宇宙論BAO）：論文 2.5.1 に catalog-based の結果図（peakfit / wedge / z依存）を追加し、paper/report を再生成

目的：
- BAO圧縮出力（`D_M/r_d` 等）ではなく、銀河+random から再計算した ξ(s,μ)→ξℓ をベースにした結果（ε/μ-wedge/特徴点）を論文へ掲載し、3章立て（BAO一次統計 / 宇宙論I / 宇宙論II）で読める形にする。

変更：
- `doc/paper/10_manuscript.md`
  - 2.5.1 に catalog-based peakfit（CMASS/LOWZ/z-bin）の結果図と数値要約を追記。
  - μ-wedge 異方サマリと z依存サマリ（ξ0ピーク/ξ2特徴）を追加。
- `doc/paper/01_figures_index.md`
  - BAO一次情報（galaxy+random）の peakfit / wedge / peak summary 図を図一覧に追加。

結果（要約）：
- smooth+peak（Phase A, screening）の ε 推定（1σ CI は `*_metrics.json` 参照）：
  - CMASS（combined; z≈0.56）：ε(lcdm)≈+0.030、ε(pbg)≈+0.028
  - LOWZ（combined; z≈0.34）：ε(lcdm)≈+0.016、ε(pbg)≈+0.044
  - z-bin（0.38/0.51/0.61）の z依存は `output/cosmology/cosmology_bao_catalog_peakfit_cmasslowztot_combined_zbinonly.png` に集約

出力（更新）：
- `output/cosmology/cosmology_bao_catalog_peakfit_{cmass,lowz}_combined.*`
- `output/cosmology/cosmology_bao_catalog_peakfit_cmasslowztot_combined_zbinonly.*`
- `output/cosmology/cosmology_bao_catalog_wedge_anisotropy.*`
- `output/cosmology/cosmology_bao_catalog_peak_summary.*`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`

再現：
- レポート再生成：
  - `python -B scripts/summary/run_all.py --offline`


---

## 2026-01-14（UTC） Step 16.4（宇宙論BAO）：reconstruction の box 座標系（raw/pca）を仕様化し、PCAフレームの感度を評価

目的：
- recon の「箱（grid）」をどの座標系で作るかが暗黙に混ざると、εの差が「理論差」か「座標化差」か混ざるため、A0仕様として固定できるようにする。
- Ross 2016 post-recon の ξ2 ギャップが、箱の向き（座標系）に起因する可能性を切り分ける。

変更：
- `scripts/cosmology/cosmology_bao_xi_from_catalogs.py`
  - `--recon-box-frame {raw,pca}` を追加（default: raw）。
  - recon有効時は `frame_pca` を out_tag に自動付与し、baseline（raw）を上書きしないようにした。
  - `coordinate_spec` / recon meta に box_frame を含め、混在検出と再現性を担保。

結果（要約）：
- CMASSLOWZTOT（combined, zbin1..3, lcdm, recon_grid_iso）で frame_pca を試したが、Ross post-recon との一致度（特に s²ξ2）の改善は軽微で、決定打にはならない。
  - 例：zbin2 の RMSE（s²ξ2）は 72.44（raw）→ 72.30（pca）程度。
  - そのため baseline は引き続き `recon_grid_iso`（raw）を採用し、`frame_pca` は派生出力として保持する。

出力（追加）：
- `output/cosmology/cosmology_bao_xi_from_catalogs_cmasslowztot_combined_lcdm_b{1,2,3}__recon_grid_iso_frame_pca.*`
- `output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay__recon_grid_iso_frame_pca.png`
- `output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay_metrics__recon_grid_iso_frame_pca.json`

再現：
- ξℓ（recon iso; 例：b2, frame_pca）：
  - `wsl -d Ubuntu-24.04 -- bash -lc "cd /mnt/c/develop/waveP && source ~/.venv/wavep/bin/activate && python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmasslowztot --caps combined --dist lcdm --z-bin b2 --random-kind random1 --threads 12 --recon grid --recon-mode iso --recon-box-frame pca"`
- overlay（frame_pca）：
  - `python -B scripts/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay.py --catalog-recon-suffix __recon_grid_iso_frame_pca --out-png output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay__recon_grid_iso_frame_pca.png --out-json output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay_metrics__recon_grid_iso_frame_pca.json`


---

## 2026-01-14（UTC） Phase 4 / Step 4.5（宇宙論BAO一次統計）：recon 境界（pad）とマスク（expected floor）の感度スキャンを追加し、zbin全域で比較を更新

目的：
- Ross 2016 post-recon の ξ2 ギャップが「境界条件（box padding）」や「マスク（expected floor）」に起因する可能性を切り分ける。
- A0で固定した座標化仕様（z/LOS/D_M/重み/sector整合）を保ったまま、recon の境界系パラメータだけを動かして影響を定量化する。

実施：
- `scripts/cosmology/cosmology_bao_xi_from_catalogs.py`（WSL; Corrfunc）
  - 対象：CMASSLOWZTOT / combined / lcdm / random1 / zbin1..3 / recon_grid_iso
  - 追加バリアント：
    - `pad_fraction`：0.0 / 0.2 / 1.0（`recon_grid_iso_pad0p0` / `pad0p2` / `pad1p0`）
    - `mask_expected_frac`：0.5 / 1.0（`recon_grid_iso_mexp0p5` / `mexp1p0`）
    - `assignment=cic + mask_expected_frac=1.0`（`recon_grid_iso_mexp1p0_assign_cic`）
- `scripts/cosmology/cosmology_bao_recon_param_scan.py`
  - 上記バリアントを含めてスキャンを再実行し、Ross covariance による χ²/dof（xi0+xi2）と RMSE を更新。

結果（要約）：
- 境界/マスクの調整は χ²/dof の改善が小さく、Ross post-recon の ξ2 ギャップの主因は「境界」ではない可能性が高い。
- 依然として `recon_bias`（b）の変更が一致度に強く効く（`b=0.5` が最良だが物理的には非現実的）ため、現段階では「recon 実装差（選択関数/LOS/RSD/アルゴリズム等）を b が吸収している」診断として扱い、Phase 4 / Step 4.5 Stage B の次工程へ進む。

出力（追加/更新）：
- `output/cosmology/cosmology_bao_xi_from_catalogs_cmasslowztot_combined_lcdm_b{1,2,3}__recon_grid_iso_pad0p0.*`
- `output/cosmology/cosmology_bao_xi_from_catalogs_cmasslowztot_combined_lcdm_b{1,2,3}__recon_grid_iso_pad0p2.*`
- `output/cosmology/cosmology_bao_xi_from_catalogs_cmasslowztot_combined_lcdm_b{1,2,3}__recon_grid_iso_pad1p0.*`
- `output/cosmology/cosmology_bao_xi_from_catalogs_cmasslowztot_combined_lcdm_b{1,2,3}__recon_grid_iso_mexp0p5.*`
- `output/cosmology/cosmology_bao_xi_from_catalogs_cmasslowztot_combined_lcdm_b{1,2,3}__recon_grid_iso_mexp1p0.*`
- `output/cosmology/cosmology_bao_xi_from_catalogs_cmasslowztot_combined_lcdm_b{1,2,3}__recon_grid_iso_mexp1p0_assign_cic.*`
- `output/cosmology/cosmology_bao_recon_param_scan.png` / `output/cosmology/cosmology_bao_recon_param_scan_metrics.json`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`

再現：
- 例：zbin2 の pad0.2：
  - `wsl -d Ubuntu-24.04 -- bash -lc "cd /mnt/c/develop/waveP && source ~/.venv/wavep/bin/activate && python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmasslowztot --caps combined --dist lcdm --random-kind random1 --z-bin b2 --recon grid --recon-mode iso --recon-pad-fraction 0.2 --out-tag pad0p2 --threads 12"`
- レポート再生成：
  - `python -B scripts/summary/run_all.py --offline`


---

## 2026-01-15（UTC） Phase 4 / Step 4.5（宇宙論BAO一次統計）：recon の LOS / fiducial Ωm 追加検証（悪化を確認）＋ overlay の out_tag 比較を拡張

目的：
- Ross 2016 post-recon の ξ2 ギャップについて、A0で固定した座標化仕様（z/LOS/D_M/重み/sector整合）を保ったまま、
  「LOS shift の定義」と「fiducial LCDM（Ωm）」が支配要因かを追加検証する。
- out_tag（例：`__om0p274`）付きの catalog-based 出力も、同一の overlay スクリプトで比較できるようにして反復検証を容易化する。

実施：
- `scripts/cosmology/cosmology_bao_xi_from_catalogs.py`（WSL; Corrfunc; `--threads 24`）
  - recon(ani) の LOS shift を radial に切替：`__recon_grid_ani_radial`（zbin b1/b2/b3）
  - fiducial LCDM の Ωm を 0.274 に切替（tag）：`__om0p274`（pre）と `__recon_grid_iso_om0p274`（post）
- `scripts/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay.py`
  - `--catalog-suffix`（default: empty）を追加し、`..._b1__<tag>.npz` を直接比較可能にした。

結果（要約）：
- `recon_grid_ani_radial` は Ross post-recon への一致度（特に ξ2）が悪化（RMSE増）。
- `Ωm=0.274`（`__om0p274`）も Satpathy pre-recon / Ross post-recon の一致度を改善せず（むしろ悪化）。
- 以上より、現状の Stage B の焦点は「LOS定義や fiducial Ωm」ではなく、**reconstruction の実装差（アルゴリズム/選択関数/境界/窓関数）**である可能性が高い。

出力（追加）：
- recon(ani) radial：
  - `output/cosmology/cosmology_bao_xi_from_catalogs_cmasslowztot_combined_lcdm_b{1,2,3}__recon_grid_ani_radial.*`
  - `output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay__recon_grid_ani_radial.*`
- Ωm=0.274（tag）：
  - `output/cosmology/cosmology_bao_xi_from_catalogs_cmasslowztot_combined_lcdm_b{1,2,3}__om0p274.*`
  - `output/cosmology/cosmology_bao_xi_from_catalogs_cmasslowztot_combined_lcdm_b{1,2,3}__recon_grid_iso_om0p274.*`
  - `output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay__om0p274.*`

再現：
- 例：zbin2 の recon(ani) radial：
  - `wsl -d Ubuntu-24.04 -- bash -lc "cd /mnt/c/develop/waveP && source ~/.venv/wavep/bin/activate && python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmasslowztot --caps combined --dist lcdm --random-kind random1 --z-bin b2 --recon grid --recon-mode ani --recon-los-shift radial --recon-rsd-solver global_constant --out-tag radial --nmu 120 --threads 24"`
- 例：zbin2 の Ωm=0.274（pre + recon iso）：
  - `wsl -d Ubuntu-24.04 -- bash -lc "cd /mnt/c/develop/waveP && source ~/.venv/wavep/bin/activate && python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmasslowztot --caps combined --dist lcdm --lcdm-omega-m 0.274 --random-kind random1 --z-bin b2 --out-tag om0p274 --nmu 120 --threads 24"`
  - `wsl -d Ubuntu-24.04 -- bash -lc "cd /mnt/c/develop/waveP && source ~/.venv/wavep/bin/activate && python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmasslowztot --caps combined --dist lcdm --lcdm-omega-m 0.274 --random-kind random1 --z-bin b2 --recon grid --recon-mode iso --out-tag om0p274 --nmu 120 --threads 24"`
- overlay（tag付き比較）：
  - `python -B scripts/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay.py --catalog-prefix output/cosmology/cosmology_bao_xi_from_catalogs_cmasslowztot_combined_lcdm_ --catalog-suffix __om0p274 --catalog-recon-suffix __recon_grid_iso_om0p274 --out-png output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay__om0p274.png --out-json output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay__om0p274_metrics.json`


---

## 2026-01-15（UTC） Phase 4 / Step 4.5B（宇宙論BAO一次統計）：random の reservoir 化（scan=5,000,000）で行順バイアスを切り分け、recon gap の再評価

目的：
- Ross 2016 post-recon の ξ2 ギャップ（recon gap）が「random の行順バイアス（prefix_rows）」に起因する可能性を切り分ける。
- A0で固定した座標化仕様（z/LOS/D_M/重み/sector整合）を保ったまま、random 抽出だけを変更して影響を比較する。

実施：
- `scripts/cosmology/fetch_boss_dr12v5_lss.py`
  - 大きい sample_rows（~2M）での reservoir 抽出が遅くなりすぎないよう、reservoir 抽出を高速化（chunksごとの巨大argpartitionを避ける fast path を追加）。
  - CMASSLOWZTOT（north/south）の random1 を prefix_2,000,000 → reservoir_2,000,000（scan_max_rows=5,000,000）へ更新（`data/cosmology/boss_dr12v5_lss/manifest.json` 更新）。
- `scripts/cosmology/cosmology_bao_xi_from_catalogs.py`（WSL; Corrfunc; threads=24）
  - 対象：CMASSLOWZTOT / combined / lcdm / random1 / zbin b1,b2,b3
  - pre（recon=none）と recon（grid/iso）を再計算。
- `scripts/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay.py`
  - published（Ross post-recon / Satpathy pre-recon）と catalog-based（pre/recon）の multipoles をオーバーレイし、RMSE/χ²/dof を更新。
- `scripts/cosmology/cosmology_bao_recon_gap_summary.py`
  - recon gap 要約図（`output/cosmology/cosmology_bao_recon_gap_summary.png`）を更新。

結果（要約）：
- random の reservoir 化（scan=5M）後も、Ross post-recon の ξ2 ギャップは残る（主因は行順バイアスだけでは説明しにくい）。
  - RMSE(s²ξ2; Ross vs catalog recon): zbin1=80.42, zbin2=71.71, zbin3=74.10（`output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay_metrics.json`）。

出力（更新）：
- `output/cosmology/cosmology_bao_xi_from_catalogs_cmasslowztot_combined_lcdm_b{1,2,3}.*`
- `output/cosmology/cosmology_bao_xi_from_catalogs_cmasslowztot_combined_lcdm_b{1,2,3}__recon_grid_iso.*`
- `output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay.png` / `output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay_metrics.json`
- `output/cosmology/cosmology_bao_recon_gap_summary.png` / `output/cosmology/cosmology_bao_recon_gap_summary_metrics.json`
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`

ドキュメント更新：
- `doc/cosmology/BAO_RECON_GAP.md`
- `doc/STATUS.md`
- `doc/ROADMAP.md`

再現：
- random1 reservoir（scan=5,000,000）抽出（South例）：
  - `python -B scripts/cosmology/fetch_boss_dr12v5_lss.py --samples cmasslowztot --caps south --random-kind random1 --random-sampling reservoir --random-max-rows 2000000 --random-scan-max-rows 5000000 --sampling-seed 0 --skip-galaxy`
- ξℓ（例：b2, recon iso）：
  - `wsl -d Ubuntu-24.04 -- bash -lc "cd /mnt/c/develop/waveP && source ~/.venv/wavep/bin/activate && python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmasslowztot --caps combined --dist lcdm --z-bin b2 --random-kind random1 --recon grid --recon-mode iso --threads 24"`
- overlay / recon gap：
  - `python -B scripts/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay.py`
  - `python -B scripts/cosmology/cosmology_bao_recon_gap_summary.py`
- レポート再生成：
  - `python -B scripts/summary/run_all.py --offline`


---

## 2026-01-15（UTC） Phase 4 / Step 4.5B（宇宙論BAO一次統計）：recon推定量の正規化（RR0分母 vs SS分母）を診断（δ_ss；ξ2ギャップは改善せず）

目的：
- Ross 2016 post-recon の ξ2 ギャップについて、「reconアルゴリズム差」ではなく **推定量の正規化（分母）の違い**が原因になっていないかを切り分ける。

変更：
- `scripts/cosmology/cosmology_bao_recon_gap_summary.py`
  - overlay metrics の集約キー（variant）に `catalog_recon_estimator` を含め、同一 `catalog_recon_suffix` で推定量が混ざって上書きされないようにした。

実施：
- `scripts/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay.py`
  - `--catalog-recon-estimator delta_ss` で、recon NPZ に保存済み pair-count grid から ξℓ を再計算し、Ross post-recon と比較。

結果（要約）：
- SS分母（`delta_ss`）は、Ross post-recon との一致度（特に s²ξ2）の改善につながらず、むしろ悪化。
  - RMSE(s²ξ2; Ross post-recon vs catalog recon, recon_grid_iso)：zbin1=78.13, zbin2=77.35, zbin3=82.29
- よって、ギャップの主因は「正規化（分母）の差」ではなく、引き続き **公式recon仕様差 / 選択関数 / 窓関数** 側の切り分けが必要。

出力（追加/更新）：
- `output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay__recon_grid_iso__delta_ss.png`
- `output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay__recon_grid_iso__delta_ss_metrics.json`
- `output/cosmology/cosmology_bao_recon_gap_summary.png` / `output/cosmology/cosmology_bao_recon_gap_summary_metrics.json`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`

再現：
- overlay（delta_ss）：
  - `python -B scripts/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay.py --catalog-recon-suffix __recon_grid_iso --catalog-recon-estimator delta_ss --out-png output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay__recon_grid_iso__delta_ss.png --out-json output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay__recon_grid_iso__delta_ss_metrics.json`
- recon gap 集約：
  - `python -B scripts/cosmology/cosmology_bao_recon_gap_summary.py`
- レポート再生成：
  - `python -B scripts/summary/run_all.py --offline`


---

## 2026-01-15（UTC） Phase 4 / Step 4.5（宇宙論BAO一次統計）：recon入力z範囲を固定して z-bin 重複の影響を切り分け（改善なし）

目的：
- CMASSLOWZTOT の z-bin が重複しているため（b1:[0.2,0.5), b2:[0.4,0.6), b3:[0.5,0.75)）、z-bin ごとに recon を走らせると **recon入力の銀河分布**が変わり、Ross post-recon との ξ2 ギャップ議論がブレる可能性がある。
- そこで recon入力 z 範囲を固定し、ギャップが「z-bin 重複由来」かを切り分ける。

変更：
- `scripts/cosmology/cosmology_bao_xi_from_catalogs.py`
  - `--recon-z-min/max` を追加し、recon入力の z 範囲を測定 z-bin（z_min/z_max）から分離できるようにした。
  - out_tag に `rz_zmin..._zmax...` を自動付与し、同一recon設定の派生が混ざらないようにした。

実施：
- CMASSLOWZTOT / combined / lcdm / random1 / recon_grid_iso で、recon入力 z を `[0.2,0.75)` に固定して b1/b2/b3 を再計算。
  - out_tag：`__recon_grid_iso_rz_zmin0p2_zmax0p75`
  - overlay：`output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay__recon_grid_iso_rz_zmin0p2_zmax0p75.*`

結果（RMSE; Ross post-recon vs catalog recon; s²ξ₂）：
- baseline（`__recon_grid_iso`）：zbin1=74.09, zbin2=72.44, zbin3=77.75
- recon入力固定（`__recon_grid_iso_rz_zmin0p2_zmax0p75`）：zbin1=74.18, zbin2=73.85, zbin3=78.03
- **改善せず** → z-bin 重複（recon入力差）は ξ2 ギャップの主因ではない。

出力（追加/更新）：
- `output/cosmology/cosmology_bao_xi_from_catalogs_cmasslowztot_combined_lcdm_b{1,2,3}__recon_grid_iso_rz_zmin0p2_zmax0p75.*`
- `output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay__recon_grid_iso_rz_zmin0p2_zmax0p75.png`
- `output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay__recon_grid_iso_rz_zmin0p2_zmax0p75_metrics.json`
- `output/cosmology/cosmology_bao_recon_gap_summary.png` / `output/cosmology/cosmology_bao_recon_gap_summary_metrics.json`（新variantを自動集約）

再現：
- WSL（Corrfunc; threads=24）：
  - `wsl -d Ubuntu-24.04 -- bash -lc "cd /mnt/c/develop/waveP && source ~/.venv/wavep/bin/activate && python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmasslowztot --caps combined --dist lcdm --z-bin b1 --random-kind random1 --recon grid --recon-mode iso --recon-z-min 0.2 --recon-z-max 0.75 --threads 24"`
  - `wsl -d Ubuntu-24.04 -- bash -lc "cd /mnt/c/develop/waveP && source ~/.venv/wavep/bin/activate && python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmasslowztot --caps combined --dist lcdm --z-bin b2 --random-kind random1 --recon grid --recon-mode iso --recon-z-min 0.2 --recon-z-max 0.75 --threads 24"`
  - `wsl -d Ubuntu-24.04 -- bash -lc "cd /mnt/c/develop/waveP && source ~/.venv/wavep/bin/activate && python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmasslowztot --caps combined --dist lcdm --z-bin b3 --random-kind random1 --recon grid --recon-mode iso --recon-z-min 0.2 --recon-z-max 0.75 --threads 24"`
- overlay：
  - `python -B scripts/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay.py --catalog-recon-suffix __recon_grid_iso_rz_zmin0p2_zmax0p75 --out-png output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay__recon_grid_iso_rz_zmin0p2_zmax0p75.png --out-json output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay__recon_grid_iso_rz_zmin0p2_zmax0p75_metrics.json`
- recon gap summary：
  - `python -B scripts/cosmology/cosmology_bao_recon_gap_summary.py`
- レポート再生成：
  - `python -B scripts/summary/run_all.py --offline`


---

## 2026-01-15（UTC） Phase 4 / Step 4.5（宇宙論BAO一次統計）：run_all に recon gap summary を組み込み

目的：
- recon gap summary をレポート再生成パイプラインに組み込み、毎回の更新で図が欠落しないようにする。

変更：
- `scripts/summary/run_all.py`
  - `cosmology_bao_recon_gap_summary` タスクを追加（overlay/param_scan の後に実行）。

結果：
- `python -B scripts/summary/run_all.py --offline` で `output/cosmology/cosmology_bao_recon_gap_summary.*` が自動再生成されることを確認。

出力（更新）：
- `output/cosmology/cosmology_bao_recon_gap_summary.png`
- `output/cosmology/cosmology_bao_recon_gap_summary_metrics.json`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`

再現：
- `python -B scripts/summary/run_all.py --offline`


---

## 2026-01-15（UTC） Phase 4 / Step 4.5（宇宙論BAO一次統計）：Ross post-recon の ξ2 ギャップ要約図を固定し、仕様差の切り分けへ移行

目的：
- catalog-based ξℓ（銀河+random）→ published multipoles（Ross post-recon / Satpathy pre-recon）の overlay は、個別のバリアント比較が増えるほど議論が散らばりやすい。
- “試した範囲では ξ2 が改善しない”ことを **1枚で固定**し、Stage B の次工程（公式recon仕様差/選択関数の切り分け）へ移る判断材料にする。

変更：
- 要約スクリプトを追加：
  - `scripts/cosmology/cosmology_bao_recon_gap_summary.py`
    - 既存の `output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay*_metrics.json` を集約し、
      recon 設定ごとの RMSE(s²ξ2) を zbin1..3 で可視化。
- 差分表メモを追加：
  - `doc/cosmology/BAO_RECON_GAP.md`
    - ξ2 ギャップ議論で混在しやすい仕様（z/LOS/D_M/重み/random/sector/recon）と、Stage B の次工程候補を整理。
- ロードマップ追記：
  - `doc/ROADMAP.md`（Step 4.5 Stage B に要約図・差分表の固定を追記）
- 論文への反映（参照追加）：
  - `doc/paper/10_manuscript.md`（2.5.1 に要約図への参照を追加）
  - `doc/paper/01_figures_index.md`（図索引に要約図を追加）

出力（追加）：
- `output/cosmology/cosmology_bao_recon_gap_summary.png`
- `output/cosmology/cosmology_bao_recon_gap_summary_metrics.json`

再現：
- 要約図生成：
  - `python -B scripts/cosmology/cosmology_bao_recon_gap_summary.py`
- 論文/一般レポ再生成：
  - `python -B scripts/summary/run_all.py --offline`

次：
- “小パラメータ調整”では改善しないことは固定できたため、次は **公式recon仕様差/選択関数（window/mask/アルゴリズム）**の切り分けへ進む。


---

## 2026-01-15（UTC） Phase 4 / Step 4.5（宇宙論BAO一次統計）：recon の RSD 実装差切り分け（solver none / rsd_shift=0）を追加検証

目的：
- Ross 2016 post-recon の ξ2 ギャップが、(i) displacement solver 側の Kaiser 補正（1/(1+β μ^2)）か、(ii) LOS 方向の追加シフト（RSD補正項）か、どちらに強く起因するかを切り分ける。
- recon の他要素（grid=256, smoothing=15, ψ(k)符号=-1, random1 等）を固定し、RSD 関連の1点だけを動かす。

実施：
- `scripts/cosmology/cosmology_bao_xi_from_catalogs.py`（WSL; Corrfunc; threads=24）
  - 対象：CMASSLOWZTOT / combined / lcdm / random1 / zbin1（0.2≤z<0.5）
  - 追加バリアント：
    - `recon_grid_ani_rsdshift0`：`--recon-mode ani --recon-rsd-solver global_constant --recon-rsd-shift 0`
    - `recon_grid_ani_global_solver_none`：`--recon-mode ani --recon-rsd-solver none --recon-los-shift global_mean_direction`
    - `recon_grid_ani_radial_solver_none`：`--recon-mode ani --recon-rsd-solver none --recon-los-shift radial`

結果（要約）：
- zbin1 の Ross post-recon との一致度（s²ξ2 RMSE, 30–150 Mpc/h）は改善せず。
  - baseline（`recon_grid_iso`）：74.09
  - `recon_grid_ani_rsdshift0`：74.64
  - `recon_grid_ani_global_solver_none`：82.52
  - `recon_grid_ani_radial_solver_none`：96.79
- よって、この方向（RSD solver / LOS shift の ON/OFF だけ）では ξ2 ギャップを解消できない。
  次は「公式recon仕様差（選択関数/窓関数/境界/アルゴリズム）」側の差分表と、改善優先度付けへ進む。

出力（追加）：
- `output/cosmology/cosmology_bao_xi_from_catalogs_cmasslowztot_combined_lcdm_b1__recon_grid_ani_rsdshift0.*`
- `output/cosmology/cosmology_bao_xi_from_catalogs_cmasslowztot_combined_lcdm_b1__recon_grid_ani_global_solver_none.*`
- `output/cosmology/cosmology_bao_xi_from_catalogs_cmasslowztot_combined_lcdm_b1__recon_grid_ani_radial_solver_none.*`

再現：
- `recon_grid_ani_rsdshift0`：
  - `wsl -d Ubuntu-24.04 -- bash -lc "cd /mnt/c/develop/waveP && source ~/.venv/wavep/bin/activate && python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmasslowztot --caps combined --dist lcdm --random-kind random1 --z-bin b1 --threads 24 --recon grid --recon-mode ani --recon-rsd-solver global_constant --recon-rsd-shift 0.0 --out-tag rsdshift0"`
- `recon_grid_ani_global_solver_none`：
  - `wsl -d Ubuntu-24.04 -- bash -lc "cd /mnt/c/develop/waveP && source ~/.venv/wavep/bin/activate && python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmasslowztot --caps combined --dist lcdm --random-kind random1 --z-bin b1 --threads 24 --recon grid --recon-mode ani --recon-rsd-solver none --recon-los-shift global_mean_direction --out-tag global_solver_none"`
- `recon_grid_ani_radial_solver_none`：
  - `wsl -d Ubuntu-24.04 -- bash -lc "cd /mnt/c/develop/waveP && source ~/.venv/wavep/bin/activate && python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmasslowztot --caps combined --dist lcdm --random-kind random1 --z-bin b1 --threads 24 --recon grid --recon-mode ani --recon-rsd-solver none --recon-los-shift radial --out-tag radial_solver_none"`


---

## 2026-01-15（UTC） Phase 4 / Step 4.5（追記）：LOWZ random1 2M 化と LOWZ ξℓ を再計算

目的：
- LOWZ でも random 密度不足による ξℓ / ε の不安定を抑え、Stage A/B の比較の土台を揃える。

実施：
- `scripts/cosmology/fetch_boss_dr12v5_lss.py`
  - LOWZ / south / random1：prefix 2,000,000 を作成し、`data/cosmology/boss_dr12v5_lss/manifest.json` を更新。
- `scripts/cosmology/cosmology_bao_xi_from_catalogs.py`（WSL; Corrfunc）
  - 対象：LOWZ / north,south,combined / lcdm,pbg / random1 prefix_2000000
- `python -B scripts/summary/run_all.py --offline`
  - 下流の peakfit/summary/scoreboard と、論文/一般レポ（HTML/DOCX）を再生成。

出力（更新）：
- `output/cosmology/cosmology_bao_xi_from_catalogs_lowz_{combined,north,south}_{lcdm,pbg}.*`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`

次：
- Phase 4 / Step 4.5 Stage B：published（Ross post-recon）と catalog-based の ξ2 ギャップを「recon実装差」として切り分け（公式recon仕様／選択関数／RSD処理）。


---

## 2026-01-15（UTC） 運用更新：Corrfunc=WSL必須、24スレッド、最小Context辞書

変更：
- `AGENTS.md` に以下を追記：
  - Corrfunc を利用する計算は **必ずWSL** で実行する。
  - WSL実行時は **24スレッド**（`--threads 24`）を原則とする。
  - ContextWindow 圧縮後の復帰用に `doc/AI_CONTEXT_MIN.json`（最小辞書）を作業ごとに更新し、最初に読む。
- Corrfunc系スクリプトのデフォルトスレッドを 24 に統一：
  - `scripts/cosmology/cosmology_bao_xi_from_catalogs.py`
  - `scripts/cosmology/cosmology_bao_sampling_convergence.py`
- 最小Context辞書を追加：
  - `doc/AI_CONTEXT_MIN.json`


---

## 2026-01-15（UTC） Phase 4 / Step 4.5（宇宙論BAO一次統計）：random1 prefix を 2M に更新し、ξℓ（LCDM）と下流図を再生成

目的：
- catalog-based ξℓ（銀河+random）で、random の有効サンプル数が小さいと zbin（特に b1）で統計が不安定になり得るため、Phase A0（入力仕様固定）の一部として random1 の prefix 行数を増やす。
- Stage B（published post-recon との整合チェック）に入る前に、入力側の揺らぎ（random密度/セクタ偏り）を抑える。

実施：
- `scripts/cosmology/fetch_boss_dr12v5_lss.py`
  - CMASS / CMASSLOWZTOT の random1 を prefix_rows 2,000,000 行へ更新（galaxy は既存を維持）。
  - `python -B scripts/cosmology/fetch_boss_dr12v5_lss.py --samples cmass,cmasslowztot --caps north,south --random-kind random1 --random-sampling prefix_rows --random-max-rows 2000000 --skip-galaxy`
- WSL（Corrfunc）で ξℓ を再計算（LCDM、pre/recon_grid_iso）：
  - `wsl -d Ubuntu-24.04 -- bash -lc "cd /mnt/c/develop/waveP && source ~/.venv/wavep/bin/activate && python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmass --caps combined --dist lcdm --random-kind random1 --threads 12"`
  - `wsl -d Ubuntu-24.04 -- bash -lc "cd /mnt/c/develop/waveP && source ~/.venv/wavep/bin/activate && python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmass --caps combined --dist lcdm --random-kind random1 --threads 12 --recon grid --recon-mode iso"`
  - `wsl -d Ubuntu-24.04 -- bash -lc "cd /mnt/c/develop/waveP && source ~/.venv/wavep/bin/activate && python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmasslowztot --caps combined --dist lcdm --random-kind random1 --z-bin b1 --threads 12"`
  - `wsl -d Ubuntu-24.04 -- bash -lc "cd /mnt/c/develop/waveP && source ~/.venv/wavep/bin/activate && python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmasslowztot --caps combined --dist lcdm --random-kind random1 --z-bin b1 --threads 12 --recon grid --recon-mode iso"`
  - `wsl -d Ubuntu-24.04 -- bash -lc "cd /mnt/c/develop/waveP && source ~/.venv/wavep/bin/activate && python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmasslowztot --caps combined --dist lcdm --random-kind random1 --z-bin b2 --threads 12"`
  - `wsl -d Ubuntu-24.04 -- bash -lc "cd /mnt/c/develop/waveP && source ~/.venv/wavep/bin/activate && python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmasslowztot --caps combined --dist lcdm --random-kind random1 --z-bin b2 --threads 12 --recon grid --recon-mode iso"`
  - `wsl -d Ubuntu-24.04 -- bash -lc "cd /mnt/c/develop/waveP && source ~/.venv/wavep/bin/activate && python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmasslowztot --caps combined --dist lcdm --random-kind random1 --z-bin b3 --threads 12"`
  - `wsl -d Ubuntu-24.04 -- bash -lc "cd /mnt/c/develop/waveP && source ~/.venv/wavep/bin/activate && python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmasslowztot --caps combined --dist lcdm --random-kind random1 --z-bin b3 --threads 12 --recon grid --recon-mode iso"`
- 下流図/レポート再生成：
  - `python -B scripts/summary/run_all.py --offline`

結果（要約）：
- `manifest.json` の random NPZ が prefix_2000000 を指すようになり、zbin の random 有効数が増加して ξ0/ξ2 の不安定性が低減（例：cmasslowztot/combined/b1 の n_rnd が約 1.78M）。
- published（Ross post-recon）比較、peakfit、scoreboard、論文/一般レポート（HTML/DOCX）を最新化。

出力（更新）：
- `data/cosmology/boss_dr12v5_lss/manifest.json`
- `output/cosmology/cosmology_bao_xi_from_catalogs_cmass_combined_lcdm.*`
- `output/cosmology/cosmology_bao_xi_from_catalogs_cmass_combined_lcdm__recon_grid_iso.*`
- `output/cosmology/cosmology_bao_xi_from_catalogs_cmasslowztot_combined_lcdm_b{1,2,3}.*`
- `output/cosmology/cosmology_bao_xi_from_catalogs_cmasslowztot_combined_lcdm_b{1,2,3}__recon_grid_iso.*`
- `output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay.*`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`


---

## 2026-01-16（UTC） Phase 4 / Step 4.5B.17：外部recon solver（MW recon_code）を統合し、Ross post-recon の ξ2 ギャップを縮小

目的：
- Padmanabhan 2012 が想定する **radial LOS + finite-difference solver** に近い reconstruction を導入し、既存の periodic FFT 近似（grid recon）との差を切り分ける。
- “Ross 2016 固定値へ寄せても改善しない”状況（Step 4.5B.16）に対し、**ソルバ実装差**が ξ2 ギャップの主因かを最短で判定する。

一次ソース：
- Martin White recon_code（reconstruction solver 実装；GitHub）：
  - `https://github.com/martinjameswhite/recon_code`（Accessed: 2026-01-16）
- FFTW（依存：ローカルビルド）：
  - `https://www.fftw.org/fftw-3.3.10.tar.gz`（Accessed: 2026-01-16）
- 既存一次ソース（仕様）：Ross 2016 / Padmanabhan 2012（`doc/cosmology/BAO_RECON_SPEC.md`）

変更：
- 外部recon backend を追加（WSLのみ）：
  - `scripts/cosmology/mw_recon_driver.cpp`：recon_code（multigrid）の最小driver（Ωmとrandom RSDのON/OFFを引数化）
  - `scripts/cosmology/mw_recon_code.py`：WSL上で `recon_code` の clone／FFTWローカルbuild／`recon_mw` build／再構成の実行を自動化
- BAOパイプライン統合：
  - `scripts/cosmology/cosmology_bao_xi_from_catalogs.py`：`--recon mw_multigrid` を追加（radial LOS + multigrid solver）

主要な数値（CMASSLOWZTOT/combined/lcdm; Ross post-recon vs catalog recon; RMSE(s²ξ2)）：
- `mw_multigrid`（`__recon_mw_multigrid_ani_mw_rw_boss_recon_rz_zmin0p2_zmax0p75_g512_bias1p85_f0p757`）：
  - zbin1=57.6 / zbin2=52.1 / zbin3=64.5
- 参考（Ross設定へ寄せた grid recon; Step 4.5B.16）：
  - zbin1≈81.3 / zbin2≈76.0 / zbin3≈77.7

出力（追加）：
- `output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay__mw_multigrid.png`
- `output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay__mw_multigrid_metrics.json`
- `output/cosmology/cosmology_bao_xi_from_catalogs_cmasslowztot_combined_lcdm_b{1,2,3}__recon_mw_multigrid_ani_mw_rw_boss_recon_rz_zmin0p2_zmax0p75_g512_bias1p85_f0p757.npz`

再現（例：zbin2。zbin1/3 は `--z-bin b1/b3` に差し替え）：
- ξℓ 再計算（WSL, Corrfunc, threads=24）：
  - `wsl -d Ubuntu-24.04 -- bash -lc "cd /mnt/c/develop/waveP && .venv_wsl/bin/python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmasslowztot --caps combined --dist lcdm --random-kind random1 --z-bin b2 --weight-scheme boss_default --recon mw_multigrid --recon-mode ani --recon-grid 512 --recon-smoothing 15 --recon-bias 1.85 --recon-f 0.757 --recon-z-min 0.2 --recon-z-max 0.75 --recon-weight-scheme boss_recon --threads 24 --out-tag mw"`
- overlay：
  - `python -B scripts/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay.py --bincent 0 --catalog-recon-suffix __recon_mw_multigrid_ani_mw_rw_boss_recon_rz_zmin0p2_zmax0p75_g512_bias1p85_f0p757 --out-png output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay__mw_multigrid.png --out-json output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay__mw_multigrid_metrics.json`
- gap要約：
  - `python -B scripts/cosmology/cosmology_bao_recon_gap_summary.py`
- レポート/論文：
  - `python -B scripts/summary/run_all.py --offline`

次：
- Step 4.5B.17.3：`--mw-random-rsd` の on/off、NGC/SGC分割、重み/selection の差分を最小セットで切り分け、残る ξ2 ギャップの要因を確定する。


---

## 2026-01-16（UTC） Phase 4 / Step 4.5B.17.3：残差要因の切り分け（`mw-random-rsd` / NGC-SGC）

目的：
- `mw_multigrid` で縮んだ ξ2 ギャップ（RMSE(s²ξ2)≈52–65）が、残る “仕様差” なのか “系統/座標化差” なのかを混ぜずに分解する。
- 最小差分として、(i) shifted randoms の RSD項、(ii) NGC/SGC split の内部差、を先に固定する。

変更：
- `scripts/cosmology/cosmology_bao_xi_from_catalogs.py`
  - `--mw-random-rsd` の on/off を out_tag で区別できるように修正（80文字制限で衝突しないよう `mwrndrsd` を recon_tag 側に組み込む）。
  - Windows の `-h`（argparse help）が cp932 で UnicodeEncodeError になる問題を best-effort で回避（`backslashreplace`）。
- `scripts/cosmology/cosmology_bao_xi_ngc_sgc_split_summary.py`（新規）
  - `cosmology_bao_xi_from_catalogs` の *_metrics.json から、NGC/SGC split の Δs_peak と曲線RMSE（NGC vs SGC; s²ξℓ）を要約して固定出力。
- `doc/ROADMAP.md` / `doc/STATUS.md` / `doc/cosmology/BAO_RECON_GAP.md`
  - 4.5B.17.3 を小項目（.1/.2/.3）へ分割して進捗を更新。結果（悪化/内部差）を追記。

結果（要約）：
- shifted randoms の RSD項（`--mw-random-rsd`）は **悪化**：
  - RMSE(s²ξ2; Ross post-recon vs catalog recon)：zbin1≈80.9 / zbin2≈74.1 / zbin3≈79.6
  - → Padmanabhan 2012 の既定（random側RSDなし）を維持。
- NGC/SGC split（内部差の目安）：
  - Δs_peak（NGC−SGC; s²ξ0 残差ピーク）：b1≈+1.78 / b2≈−2.40 / b3≈+7.40 [Mpc/h]
  - 曲線RMSE（NGC vs SGC; s²ξℓ）：b1（ξ0≈9.29, ξ2≈93.44）/ b2（ξ0≈12.38, ξ2≈21.85）/ b3（ξ0≈13.29, ξ2≈43.91）

出力（追加/更新）：
- `output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay__mw_multigrid_mwrndrsd.png`
- `output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay__mw_multigrid_mwrndrsd_metrics.json`
- `output/cosmology/cosmology_bao_xi_ngc_sgc_split_summary.png`
- `output/cosmology/cosmology_bao_xi_ngc_sgc_split_summary_metrics.json`

再現：
- ξℓ（WSL, Corrfunc; 例：zbin2。b1/b3は `--z-bin` 差し替え）：
  - baseline（random側RSDなし）：
    - `wsl -d Ubuntu-24.04 -- bash -lc "cd /mnt/c/develop/waveP && OMP_NUM_THREADS=24 .venv_wsl/bin/python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmasslowztot --caps combined --dist lcdm --random-kind random1 --z-bin b2 --weight-scheme boss_default --recon mw_multigrid --recon-mode ani --recon-grid 512 --recon-smoothing 15 --recon-bias 1.85 --recon-f 0.757 --recon-z-min 0.2 --recon-z-max 0.75 --recon-weight-scheme boss_recon --threads 24 --out-tag mw"`
  - `--mw-random-rsd`：
    - `wsl -d Ubuntu-24.04 -- bash -lc "cd /mnt/c/develop/waveP && OMP_NUM_THREADS=24 .venv_wsl/bin/python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmasslowztot --caps combined --dist lcdm --random-kind random1 --z-bin b2 --weight-scheme boss_default --recon mw_multigrid --recon-mode ani --recon-grid 512 --recon-smoothing 15 --recon-bias 1.85 --recon-f 0.757 --recon-z-min 0.2 --recon-z-max 0.75 --recon-weight-scheme boss_recon --mw-random-rsd --threads 24 --out-tag mw"`
- overlay：
  - baseline：`python -B scripts/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay.py --bincent 0 --catalog-recon-suffix __recon_mw_multigrid_ani_mw_rw_boss_recon_rz_zmin0p2_zmax0p75_g512_bias1p85_f0p757 --out-png output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay__mw_multigrid.png --out-json output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay__mw_multigrid_metrics.json`
  - `--mw-random-rsd`：`python -B scripts/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay.py --bincent 0 --catalog-recon-suffix __recon_mw_multigrid_ani_mwrndrsd_mw_rw_boss_recon_rz_zmin0p2_zmax0p75_g512_bias1p --out-png output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay__mw_multigrid_mwrndrsd.png --out-json output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay__mw_multigrid_mwrndrsd_metrics.json`
- NGC/SGC要約：
  - `python -B scripts/cosmology/cosmology_bao_xi_ngc_sgc_split_summary.py`

次：
- Step 4.5B.17.3.3：重み/selection（`recon_weight_scheme` / sector/mask / random選別）の最小差分を固定し、残る ξ2 ギャップの要因を確定する。


---

## 2026-01-16（UTC） Phase 4 / Step 4.5B.17.3.3：重み/selection の切り分け（fullscan reservoir / recon_weight_scheme / match_sectors）

目的：
- `mw_multigrid`（外部solver）の残差が「理論差」ではなく **座標化/選択関数（random/sector/重み）**起因で動いていないかを最小差分で固定する。
- 特に、random 抽出の偏り（ISECT欠落）と recon density field の重み定義が、Ross post-recon との一致度へ与える影響を切り分ける。

変更：
- CMASSLOWZTOT（north/south）の random1 を **fullscan reservoir** で抽出（rows_saved=2,000,000）。
  - `data/cosmology/boss_dr12v5_lss/extracted/random1_DR12v5_CMASSLOWZTOT_North.fits.gz.reservoir_2000000_seed0.npz`
  - `data/cosmology/boss_dr12v5_lss/extracted/random1_DR12v5_CMASSLOWZTOT_South.fits.gz.reservoir_2000000_seed0.npz`
- `data/cosmology/boss_dr12v5_lss/manifest.json` の source_base_url を高速ミラー（`https://dr12.sdss3.org/sas/dr12/boss/lss/`）へ合わせ、取得/再現の混乱を減らす。

主要な数値（CMASSLOWZTOT/combined/lcdm; Ross post-recon vs catalog recon; RMSE(s²ξ2)）：
- `mw_multigrid`（scan=5,000,000；旧）：zbin1=57.60 / zbin2=52.12 / zbin3=64.53（`output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay__mw_multigrid_scan5m_metrics.json`）
- `mw_multigrid`（fullscan；現行baseline）：zbin1=57.70 / zbin2=55.14 / zbin3=71.15（`output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay__mw_multigrid_metrics.json`）
- `recon_weight_scheme=same`：zbin1=77.74 / zbin2=73.87 / zbin3=81.08（`output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay__mw_multigrid_rw_same_metrics.json`）
- `match_sectors=off`：zbin1=59.15 / zbin2=55.28 / zbin3=71.31（`output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay__mw_multigrid_matchsectors_off_metrics.json`）
- sector整合（match_sectors=auto; b2例）：kept_frac_gal north=0.99954 / south=0.96244（`output/cosmology/cosmology_bao_xi_from_catalogs_*_metrics.json`）

結論（暫定）：
- fullscan reservoir により sector整合（特に north）がほぼ完全になった一方で、Ross一致度（特に zbin2/3）は改善しなかった。
- recon density field の重みは `boss_recon` が必須で、`same` は大幅に悪化する。
- match_sectors を off にしても改善しないため、残差は「単純な ISECT 不整合」以外（重み/selection/窓関数/領域差）を含む可能性が高い。

再現：
- fullscan reservoir 抽出（WSL）：  
  - `wsl -d Ubuntu-24.04 -- bash -lc "cd /mnt/c/develop/waveP && .venv_wsl/bin/python -B scripts/cosmology/fetch_boss_dr12v5_lss.py --samples cmasslowztot --caps north,south --random-kind random1 --random-sampling reservoir --random-max-rows 2000000 --random-scan-max-rows 0 --skip-galaxy --force"`
- ξℓ（例：zbin2。b1/b3は `--z-bin` 差し替え）：  
  - `wsl -d Ubuntu-24.04 -- bash -lc "cd /mnt/c/develop/waveP && OMP_NUM_THREADS=24 .venv_wsl/bin/python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmasslowztot --caps combined --dist lcdm --random-kind random1 --z-bin b2 --weight-scheme boss_default --recon mw_multigrid --recon-mode ani --recon-grid 512 --recon-smoothing 15 --recon-bias 1.85 --recon-f 0.757 --recon-z-min 0.2 --recon-z-max 0.75 --recon-weight-scheme boss_recon --threads 24 --out-tag mw"`
- overlay（baseline / rw_same / matchsectors_off）：  
  - `python -B scripts/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay.py --bincent 0 --catalog-recon-suffix __recon_mw_multigrid_ani_mw_rw_boss_recon_rz_zmin0p2_zmax0p75_g512_bias1p85_f0p757 --out-png output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay__mw_multigrid.png --out-json output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay__mw_multigrid_metrics.json`
  - `python -B scripts/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay.py --bincent 0 --catalog-recon-suffix __recon_mw_multigrid_ani_mw_rz_zmin0p2_zmax0p75_g512_bias1p85_f0p757 --out-png output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay__mw_multigrid_rw_same.png --out-json output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay__mw_multigrid_rw_same_metrics.json`
  - `python -B scripts/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay.py --bincent 0 --catalog-recon-suffix __recon_mw_multigrid_ani_ns_rw_boss_recon_rz_zmin0p2_zmax0p75_g512_bias1p85_f0p757 --out-png output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay__mw_multigrid_matchsectors_off.png --out-json output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay__mw_multigrid_matchsectors_off_metrics.json`

次：
- Step 4.5B.17.3.3.4：south の sector 欠落を潰す（random増量 or ISECT層化 sampling）で kept_frac_gal(south)→1.0 を目標に再評価する。


---

## 2026-01-16（UTC） Phase 4 / Step 4.5（宇宙論BAO一次統計）Stage B：Ψ(k) Fourier 符号（--recon-psi-k-sign）の診断

目的：
- recon の基本仕様（A0）として固定している `psi_k_sign` が、Ross post-recon の ξ2 ギャップに影響していないかを切り分ける。
- “符号を変えるだけで改善する” 可能性を否定/肯定し、次工程（公式recon仕様差/選択関数/窓関数畳み込み）の議論がブレないようにする。

実施：
- WSL（Corrfunc; threads=24）で CMASSLOWZTOT / combined / lcdm / random1 を再計算
  - zbin：b1/b2/b3
  - recon：`--recon grid --recon-mode ani --recon-psi-k-sign 1`
  - out_tag：`psi_pos`（出力 suffix: `__recon_grid_ani_psi_pos`）
- overlay（Ross post-recon multipoles との比較）：
  - `python -B scripts/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay.py --catalog-recon-suffix __recon_grid_ani_psi_pos ...`

結果（要約；RMSE(s²ξ2; Ross post-recon vs catalog recon)）：  
- zbin1=93.98, zbin2=88.49, zbin3=88.55（baseline/既存候補より悪化）

結論：
- `psi_k_sign=+1` は改善しない（悪化）ため、不採用。既定（`psi_k_sign=-1`）を維持する。

出力（追加）：
- `output/cosmology/cosmology_bao_xi_from_catalogs_cmasslowztot_combined_lcdm_b{1,2,3}__recon_grid_ani_psi_pos.*`
- `output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay__recon_grid_ani_psi_pos.png`
- `output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay__recon_grid_ani_psi_pos_metrics.json`
- `doc/ROADMAP.md`
- `doc/STATUS.md`

再現：
- ξℓ（b1）：
  - `wsl -d Ubuntu-24.04 -- bash -lc "cd /mnt/c/develop/waveP && source ~/.venv_wavep/bin/activate && python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmasslowztot --caps combined --dist lcdm --z-bin b1 --random-kind random1 --recon grid --recon-mode ani --recon-psi-k-sign 1 --threads 24 --out-tag psi_pos"`
- ξℓ（b2/b3）も同様（`--z-bin b2` / `--z-bin b3`）
- overlay：
  - `python -B scripts/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay.py --catalog-recon-suffix __recon_grid_ani_psi_pos --out-png output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay__recon_grid_ani_psi_pos.png --out-json output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay__recon_grid_ani_psi_pos_metrics.json`

次：
- Phase 4 / Step 4.5 Stage B：公式recon仕様差（境界/マスク/RSD除去/重み/割当）と published pipeline 側の window 畳み込みの扱い差を優先度順に切り分ける。


---

## 2026-01-16（UTC） Phase 4 / Step 4.5（宇宙論BAO一次統計）Stage B：window mixing（ξ0↔ξ2 混合）の規模を定量化

目的：
- RR2/RR0（窓関数異方性）が無視できない規模で存在することは確認できたため、次に「その異方性が ξ2 ギャップをどれだけ説明できるか」を数値で切り分ける。
- 具体的には、RR multipoles から window mixing 行列（m20,m22）を推定し、ξ0→ξ2 漏れ（s²(m20·ξ0)）の大きさを評価する。

変更：
- `scripts/cosmology/cosmology_bao_catalog_window_mixing.py` を追加
  - catalog-based NPZ（Corrfunc計算済み）から window multipoles（w2,w4,w6,w8）→ mixing 係数 m20/m22 を計算し、漏れ指標を図/metricsとして出力。
- `scripts/summary/run_all.py` に `cosmology_bao_catalog_window_mixing` を追加（optional）
- `doc/cosmology/BAO_RECON_GAP.md` / `doc/paper/10_manuscript.md` / `doc/paper/01_figures_index.md` に結果を反映。

結果（要約；CMASSLOWZTOT/combined/lcdm、eval s∈[30,150] Mpc/h）：
- max|s²(m20·ξ0)|（RR0由来）は zbin1≈2.1, zbin2≈3.9, zbin3≈3.2。
- 一方、Ross post-recon vs catalog recon の ξ2 ギャップは RMSE(s²ξ2)≈70–80。
- 結論：**window mixing（ξ0↔ξ2 混合）だけで ξ2 ギャップ全体を説明するのは難しく**、主因は recon 仕様差/選択関数/窓関数畳み込みの扱い差として切り分けを継続するのが合理的。

出力（追加）：
- `output/cosmology/cosmology_bao_catalog_window_mixing.png`
- `output/cosmology/cosmology_bao_catalog_window_mixing_metrics.json`

再現：
- window mixing 診断（npz から計算；Windowsでも可）：
  - `python -B scripts/cosmology/cosmology_bao_catalog_window_mixing.py`
- レポート再生成：
  - `python -B scripts/summary/run_all.py --offline`


---

## 2026-01-16（UTC） Phase 4 / Step 4.5（宇宙論BAO一次統計）：recon_grid_ani_rsdshift0 を zbin全域へ拡張し、recon gap 要約を更新

目的：
- 2026-01-15 の zbin1 単体テストでは改善が限定的だった `--recon-rsd-shift 0` を、random reservoir_2M/scan5M baseline の上で zbin1..3 に拡張し、recon(ani) 系列の候補を固定する。
- 実装差（RSD項の有無）による Ross post-recon ξ2 ギャップの感度を、overlay / recon gap summary に反映して議論のブレを防ぐ。

実施：
- `scripts/cosmology/cosmology_bao_xi_from_catalogs.py`（WSL; Corrfunc; threads=24）
  - 対象：CMASSLOWZTOT / combined / lcdm / random1（reservoir_2M, scan5M）/ zbin2,b3
  - recon：`--recon grid --recon-mode ani --recon-rsd-solver global_constant --recon-los-shift global_mean_direction --recon-rsd-shift 0`
  - out_tag：`rsdshift0`（出力 suffix: `__recon_grid_ani_rsdshift0`）
- overlay（公開multipolesとの比較）：
  - `python -B scripts/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay.py --catalog-recon-suffix __recon_grid_ani_rsdshift0 ...`
- recon gap summary（既存 overlay metrics の集約）：
  - `python -B scripts/cosmology/cosmology_bao_recon_gap_summary.py`

結果（要約）：
- Ross post-recon vs catalog recon の s²ξ2 RMSE（30–150 Mpc/h）：
  - baseline（`__recon_grid_iso`；random reservoir_2M/scan5M）：zbin1=80.42, zbin2=71.71, zbin3=74.10
  - `__recon_grid_ani_rsdshift0`：zbin1=74.64, zbin2=72.34, zbin3=74.93（median=74.64）
  - `__recon_grid_ani_rsdshiftm1`（診断; zbin1のみ）：zbin1=88.01（悪化）
- 結論：現行実装の範囲では `__recon_grid_ani_rsdshift0` を Stage B の暫定 best candidate として保持し、次は window/selection/公式recon仕様差の切り分けへ進む。

出力（追加/更新）：
- `output/cosmology/cosmology_bao_xi_from_catalogs_cmasslowztot_combined_lcdm_b2__recon_grid_ani_rsdshift0.*`
- `output/cosmology/cosmology_bao_xi_from_catalogs_cmasslowztot_combined_lcdm_b3__recon_grid_ani_rsdshift0.*`
- `output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay__recon_grid_ani_rsdshift0.png`
- `output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay__recon_grid_ani_rsdshift0_metrics.json`
- `output/cosmology/cosmology_bao_recon_gap_summary.png`
- `output/cosmology/cosmology_bao_recon_gap_summary_metrics.json`
- `doc/cosmology/BAO_RECON_GAP.md`
- `doc/STATUS.md`

再現：
- ξℓ（b2）：
  - `wsl -d Ubuntu-24.04 -- bash -lc "cd /mnt/c/develop/waveP && source ~/.venv/wavep/bin/activate && python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmasslowztot --caps combined --dist lcdm --z-bin b2 --random-kind random1 --recon grid --recon-mode ani --recon-rsd-solver global_constant --recon-los-shift global_mean_direction --recon-rsd-shift 0 --threads 24 --out-tag rsdshift0"`
- ξℓ（b3）：
  - `wsl -d Ubuntu-24.04 -- bash -lc "cd /mnt/c/develop/waveP && source ~/.venv/wavep/bin/activate && python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmasslowztot --caps combined --dist lcdm --z-bin b3 --random-kind random1 --recon grid --recon-mode ani --recon-rsd-solver global_constant --recon-los-shift global_mean_direction --recon-rsd-shift 0 --threads 24 --out-tag rsdshift0"`
- overlay：
  - `python -B scripts/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay.py --catalog-recon-suffix __recon_grid_ani_rsdshift0 --out-png output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay__recon_grid_ani_rsdshift0.png --out-json output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay__recon_grid_ani_rsdshift0_metrics.json`
- recon gap summary：
  - `python -B scripts/cosmology/cosmology_bao_recon_gap_summary.py`

次：
- Phase 4 / Step 4.5 Stage B：RR multipoles / window function の切り分け、公式 recon の手順差（RSD除去・重み・マスク）の優先順位付けと検証。


---

## 2026-01-16（UTC） Phase 4 / Step 4.5（宇宙論BAO一次統計）Stage B：窓関数（RR multipoles）の異方性指標を追加

目的：
- Ross post-recon の ξ2 ギャップが「recon 実装差」だけでなく、survey window（sky mask / radial selection）の異方性や正規化差に起因していないかを切り分ける。
- まずは catalog-based の pair-count grid（RR0/SS）から、窓関数の異方性スケールを“再現可能な数値”として固定する。

変更：
- `scripts/cosmology/cosmology_bao_catalog_window_multipoles.py` を追加
  - catalog-based NPZ（Corrfunc計算済み）から RR2/RR0（および recon 時は SS2/SS0）を算出し、図と metrics を生成。
- `scripts/summary/run_all.py` に `cosmology_bao_catalog_window_multipoles` を追加（optional）
- `doc/cosmology/BAO_RECON_GAP.md` / `doc/paper/10_manuscript.md` / `doc/paper/01_figures_index.md` に窓関数診断を反映。

結果（要約）：
- CMASSLOWZTOT / combined / lcdm の max|RR2/RR0|（s∈[30,150] Mpc/h）は zbin1≈0.058, zbin2≈0.156, zbin3≈0.139。
- recon 時の shifted random（SS）も同程度（zbin2/3 で ≈0.13–0.15）で、窓関数の異方性が無視できない規模で存在することを確認。

出力（追加）：
- `output/cosmology/cosmology_bao_catalog_window_multipoles.png`
- `output/cosmology/cosmology_bao_catalog_window_multipoles_metrics.json`

再現：
- 窓関数診断（npz から計算；Windowsでも可）：
  - `python -B scripts/cosmology/cosmology_bao_catalog_window_multipoles.py`
- レポート再生成：
  - `python -B scripts/summary/run_all.py --offline`


---

## 2026-01-16（UTC） Phase 4 / Step 4.5（宇宙論BAO一次統計）Stage B：SDSS SAS 高速ミラーへ切替 + LOWZ random を全量reservoir化

目的：
- `https://data.sdss.org/sas/dr12/boss/lss/` が重く、BOSS DR12v5 LSS（FITS.gz）の取得がボトルネックになっていたため、同一ファイルが存在する高速ミラーへ切替して再現性と作業速度を改善する。
- random catalog を prefix 抽出（先頭N行）で使うと selection/sector の偏りで LS 推定が破綻し得るため、LOWZ random を「全量走査の reservoir サンプル」へ切替し、系統の切り分けを進める。

変更：
- `scripts/cosmology/fetch_boss_dr12v5_lss.py`
  - 既定のSAS base URL を `https://dr12.sdss3.org/sas/dr12/boss/lss/` に切替（`--base-url` 追加）。
  - raw（`data/cosmology/boss_dr12v5_lss/raw/*.fits.gz`）が存在する場合は、prefix/reservoir 抽出をローカル優先に変更（サーバー負荷/待ちを回避）。
  - random の manifest に raw_path/raw_bytes を記録（整合性の切り分けを容易化）。
- `scripts/cosmology/fetch_boss_dr12_ross2016_corrfunc.py` / `scripts/cosmology/fetch_boss_dr12_satpathy2016_corrfunc_multipoles.py` / `scripts/cosmology/fetch_boss_dr12_beutler2016_bao_powspec.py`
  - 取得URLを `dr12.sdss3.org` に切替（同一ファイルの高速ミラー）。
- WSL（Corrfunc実行環境）
  - repo直下に `.venv_wsl` を作成し、`numpy/matplotlib/Corrfunc` を導入（PEP668回避のため venv を採用）。

結果（要約）：
- LOWZ random1（NGC/SGC）を **全量走査の reservoir 2,000,000（seed=0）** に更新：
  - `data/cosmology/boss_dr12v5_lss/extracted/random1_DR12v5_LOWZ_North.fits.gz.reservoir_2000000_seed0.npz`
  - `data/cosmology/boss_dr12v5_lss/extracted/random1_DR12v5_LOWZ_South.fits.gz.reservoir_2000000_seed0.npz`
- ξℓ を再計算（LOWZ：combined/north/south × lcdm/pbg）：
  - `output/cosmology/cosmology_bao_xi_from_catalogs_lowz_*_lcdm.*`
  - `output/cosmology/cosmology_bao_xi_from_catalogs_lowz_*_pbg.*`
- `python -B scripts/summary/run_all.py --offline` を実行し、論文/一般向けを再生成（HTML+DOCX）。

再現：
- 抽出（LOWZ random を reservoir へ）：
  - `python -B scripts/cosmology/fetch_boss_dr12v5_lss.py --samples lowz --caps north,south --random-kind random1 --random-sampling reservoir --random-max-rows 2000000 --skip-galaxy`
- ξℓ（WSL; Corrfunc）：
  - `wsl bash -lc "cd /mnt/c/develop/waveP && .venv_wsl/bin/python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample lowz --caps combined --dist lcdm --random-kind random1 --threads 24"`
  - `wsl bash -lc "cd /mnt/c/develop/waveP && .venv_wsl/bin/python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample lowz --caps combined --dist pbg --random-kind random1 --threads 24"`
- レポート再生成：
  - `python -B scripts/summary/run_all.py --offline`


---

## 2026-01-16（UTC） Phase 4 / Step 4.5：ロードマップの細分化（Stage A/B → 4.5A.* / 4.5B.*）

目的：
- Phase 4 / Step 4.5（宇宙論BAO）の作業量が増え、Stage A/B だけでは進捗が追いにくくなったため、サブ番号（4.5A.* / 4.5B.*）で「完了/進行中/準備中」を明示し、議論のブレ（何を変えたか不明）を防ぐ。

変更：
- `doc/ROADMAP.md` の Step 4.5 を、Stage A/B の下に 4.5A.* / 4.5B.* を追加して再構成。
  - 現在地を `4.5B.15`（公式recon仕様差/selection/window の切り分け）として固定。
- `doc/STATUS.md` を更新（現在地の明確化、UTC更新）。

次：
- Phase 4 / Step 4.5B.15：公式recon仕様差（重み／マスク／RSD除去）と selection/window の扱い差を、最小差分として優先度順に分解して検証。


---

## 2026-01-16（UTC） Phase 4 / Step 4.5（宇宙論BAO一次統計）Stage B：published window整理（B.14完了）＋recon追加テスト

目的：
- Stage B.14：published multipoles（Ross 2016）側で window が「明示的に補正されている/いない」を整理し、比較対象（物理量）がズレないようにする。
- Stage B.15：recon仕様差の候補を最小差分で検証し、Ross post-recon の ξ2 ギャップが「RSD除去の仕様差」に起因し得るかを切り分ける。

変更：
- `doc/cosmology/BAO_RECON_GAP.md`
  - B.14（published multipoles と window の位置づけ）を追記。
- `doc/ROADMAP.md`
  - Step 4.5B.14 を【完了】に更新。
  - Step 4.5B.15 に追加テスト（solvernone+radial+rsd_shift=1）を記録。
- 出力（追加）：
  - recon 追加ケース（zbin b1/b2/b3）：
    - `output/cosmology/cosmology_bao_xi_from_catalogs_cmasslowztot_combined_lcdm_b{1,2,3}__recon_grid_ani_solvernone_radial_rsdshift1.*`
  - Ross overlay：
    - `output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay__recon_grid_ani_solvernone_radial_rsdshift1.*`
  - recon gap 要約の更新：
    - `output/cosmology/cosmology_bao_recon_gap_summary.*`

結果（要約）：
- `recon_grid_ani_solvernone_radial_rsdshift1` は Ross post-recon との ξ2 の一致度が悪化（RMSE(s²ξ2) が ≈100台）し、不採用。
- 現状の “best candidate” は引き続き `recon_grid_ani_rsdshift0`（RSD shift 無効）で保持し、B.15（公式recon仕様差/selection-window の切り分け）を継続。

再現：
- ξℓ（WSL; Corrfunc; threads=24）：
  - `wsl -d Ubuntu-24.04 -- bash -lc "cd /mnt/c/develop/waveP && .venv_wsl/bin/python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmasslowztot --caps combined --dist lcdm --random-kind random1 --z-bin b1 --recon grid --recon-mode ani --recon-rsd-solver none --recon-los-shift radial --recon-rsd-shift 1.0 --out-tag solvernone_radial_rsdshift1 --threads 24"`
  - `wsl -d Ubuntu-24.04 -- bash -lc "cd /mnt/c/develop/waveP && .venv_wsl/bin/python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmasslowztot --caps combined --dist lcdm --random-kind random1 --z-bin b2 --recon grid --recon-mode ani --recon-rsd-solver none --recon-los-shift radial --recon-rsd-shift 1.0 --out-tag solvernone_radial_rsdshift1 --threads 24"`
  - `wsl -d Ubuntu-24.04 -- bash -lc "cd /mnt/c/develop/waveP && .venv_wsl/bin/python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmasslowztot --caps combined --dist lcdm --random-kind random1 --z-bin b3 --recon grid --recon-mode ani --recon-rsd-solver none --recon-los-shift radial --recon-rsd-shift 1.0 --out-tag solvernone_radial_rsdshift1 --threads 24"`
- Ross overlay：
  - `python -B scripts/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay.py --catalog-recon-suffix __recon_grid_ani_solvernone_radial_rsdshift1 --out-png output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay__recon_grid_ani_solvernone_radial_rsdshift1.png --out-json output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay__recon_grid_ani_solvernone_radial_rsdshift1_metrics.json`
- recon gap 要約：
  - `python -B scripts/cosmology/cosmology_bao_recon_gap_summary.py`


---

## 2026-01-16（UTC） Phase 4 / Step 4.5B.15：出力命名の固定＋window mixing（ξ4→ξ2）評価

目的：
- recon（grid/FFT）まわりの scan を進める過程で、`--out-tag` を付け忘れると同名出力を上書きしやすい問題があるため、**非デフォルト設定を自動tag化**して議論のブレを防ぐ。
- ξ2 ギャップ（Ross post-recon vs catalog recon）が **window mixing（ξ4→ξ2）**で説明できる可能性を切り分ける。

変更：
- `scripts/cosmology/cosmology_bao_xi_from_catalogs.py`
  - recon パラメータの非デフォルト値（grid/smoothing/bias/ψ符号/RSD solver/LOS shift/rsd_shift/pad/maskexp）を out_tag に自動付与するよう改善（上書き事故防止）。
  - `--random-kind` の既定値を random1 に変更（`data/cosmology/boss_dr12v5_lss/manifest.json` と整合）。
- `scripts/cosmology/cosmology_bao_catalog_window_mixing.py`
  - window mixing を ξ4→ξ2（m24）まで拡張し、`output/cosmology/cosmology_bao_catalog_window_mixing.*` を更新。
- `doc/cosmology/BAO_RECON_GAP.md` / `doc/ROADMAP.md` / `doc/STATUS.md` を更新。

結果（要約）：
- max|s²(m24·ξ4)| は概ね ≲2（zbin2が最大）で、ξ2 ギャップ（RMSE≈70–80）の主因になりにくい。

再現：
- window mixing（ξ4→ξ2 含む）：
  - `python -B scripts/cosmology/cosmology_bao_catalog_window_mixing.py`
- ξℓ（例；WSL/Corrfunc；`--out-tag`無しでも自動で別名出力になる）：
  - `wsl -d Ubuntu-24.04 -- bash -lc "cd /mnt/c/develop/waveP && .venv_wsl/bin/python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmasslowztot --caps combined --dist lcdm --z-bin b1 --recon grid --recon-mode ani --recon-rsd-solver none --recon-los-shift radial --recon-rsd-shift 2.0 --threads 24"`


---

## 2026-01-16（UTC） Phase 4 / Step 4.5B.15.4：Ross 公開 multipoles の定義固定（bincent/cov/ξ4/broadband）＋ overlay rbc

目的：
- “published multipoles（Ross）” の定義差（bincent / covariance の並び / モデル側の ξ4 / broadband）を明文化し、recon gap の議論を「定義差」から切り離す。
- Ross の `baofit_pub2D.py` が用いる bin-centering 補正（rbc）が、ξ2 ギャップに効き得るかを最小変更で確認する。

変更：
- `doc/cosmology/BAO_RECON_SPEC.md`
  - §6 を追加し、Ross 公開 multipoles の「データベクトルの定義」を一次コード（`.tmp_lssanalysis/baofit_pub2D.py`）ベースで固定。
- `scripts/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay.py`
  - `--ross-x-axis {center,rbc}` と `--ross-bin-size` を追加し、Ross の rbc を x 軸へ反映できるようにした（selection は bin center で固定）。
  - Windows の `--help` 出力で cp932 に載らない文字（ℓ）を避け、引っかかりなく実行できるようにした。
- `doc/cosmology/BAO_RECON_GAP.md`
  - 仕様メモ（§6）への参照と、rbc 評価（RMSE差が小さい）を追記。
- `doc/ROADMAP.md` / `doc/STATUS.md`
  - 4.5B.15.4 を完了化し、次工程を 4.5B.16（Ross 2016 固定値へ寄せた再計算）として現在地を更新。

結果（要約）：
- rbc は RMSE の差が ≲0.1 程度で、ξ2 ギャップ（RMSE≈70–80）の主因になりにくい。
- Ross 公開 multipoles は生の xi0/xi2 をデータベクトルとして扱い、window deconvolution を明示的に行う形ではない（系統は broadband で吸収）→ 主因は引き続き recon 仕様差（特に RSD 除去）側が濃厚。


---

## 2026-01-16（UTC） Phase 4 / Step 4.5B.16：Ross 2016 固定値へ寄せた再計算（grid=512³ 等）

目的：
- Ross 2016 が明記する recon 固定値（grid=512³ / smoothing=15 / b=1.85 / f=0.757 / z=0.2〜0.75で一括）へ寄せた上で、Ross post-recon との ξ2 ギャップが縮むかを確認し、
  主因が「パラメータ不一致」か「アルゴリズム差（radial solver/境界・マスク・重み）」かを切り分ける。

実施：
- WSL（Corrfunc; threads=24）で CMASSLOWZTOT/combined/lcdm を zbin1..3 で再計算（out_tag=`ross2016`）。
  - 出力：`output/cosmology/cosmology_bao_xi_from_catalogs_cmasslowztot_combined_lcdm_b{1,2,3}__recon_grid_ani_ross2016_rz_zmin0p2_zmax0p75_g512_bias1p85_f0p757_solverpadmanabh.*`
- Ross post-recon multipoles との overlay：
  - `output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay__ross2016.*`
- recon gap 要約更新：
  - `output/cosmology/cosmology_bao_recon_gap_summary.*`

結果（要約）：
- RMSE(s²ξ2; Ross post-recon vs catalog recon) は大きくは改善せず（zbin1≈81.34, zbin2≈75.95, zbin3≈77.67）。
- 固定値を一致させてもギャップが残るため、主因は Padmanabhan 2012 の radial LOS + finite-difference solver（PETSc/GMRES）や境界・マスク・重み等の **実装アルゴリズム差**側が濃厚。

再現：
- ξℓ（例；b2。b1/b3 は `--z-bin` を差し替え）：
  - `wsl -d Ubuntu-24.04 -- bash -lc "cd /mnt/c/develop/waveP && .venv_wsl/bin/python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmasslowztot --caps combined --dist lcdm --random-kind random1 --z-bin b2 --recon grid --recon-mode ani --recon-rsd-solver padmanabhan_pp --recon-los-shift global_mean_direction --recon-rsd-shift 1.0 --recon-grid 512 --recon-smoothing 15 --recon-bias 1.85 --recon-f 0.757 --recon-z-min 0.2 --recon-z-max 0.75 --threads 24 --out-tag ross2016"`
- overlay（Ross post-recon 比較）：
  - `python -B scripts/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay.py --bincent 0 --catalog-recon-suffix __recon_grid_ani_ross2016_rz_zmin0p2_zmax0p75_g512_bias1p85_f0p757_solverpadmanabh --out-png output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay__ross2016.png --out-json output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay__ross2016_metrics.json`
- recon gap 要約：
  - `python -B scripts/cosmology/cosmology_bao_recon_gap_summary.py`


---

## 2026-01-17（UTC） Phase 4 / Step 4.5B.17.3.3.4：south の kept_frac_gal 低下（sector欠落）を ISECT 一致で解消

目的：
- `mw_multigrid` 導入後の残差要因（selection / footprint matching）を最小差分で固定し、議論がブレないようにする。
- south だけ `kept_frac_gal≈0.96` まで落ちる問題を、random不足と誤解せずに原因特定して潰す。

観測（原因特定）：
- sector matching（`--match-sectors`）は **recon入力（z∈[recon_z_min,recon_z_max)）**に対して適用している。
- 既存の sector key 定義（(IPOLY<<32)+ISECT）だと、CMASSLOWZTOT/south の recon入力（z∈[0.2,0.75)）で
  - kept_frac_gal≈0.96253（b2例）
  となり、小ポリゴンが落ちる。
- 一方で **ISECT 一致**（IPOLYを無視）にすると、
  - kept_frac_gal≈0.999997（b2例）
  となり、問題がほぼ消える。

変更：
- `scripts/cosmology/cosmology_bao_xi_from_catalogs.py` に `--sector-key {isect, ipoly_isect}` を追加し、既定を **isect（ISECT一致）**へ変更。
  - metrics に `params.sector_key` と `coordinate_spec.sector_matching` を追加。
  - `--sector-key` が非既定の場合は out_tag に `sk_*` を自動付与し、上書き衝突を防止。

再計算・更新：
- WSL（Corrfunc, threads=24）で CMASSLOWZTOT（north/south/combined, lcdm, zbin b1/b2/b3, mw_multigrid）を再計算し直し。
- overlay / recon gap summary / NGC-SGC split summary を更新。

主要な数値（Ross post-recon vs catalog recon; mw_multigrid baseline; RMSE(s²ξ2)）：
- zbin1≈59.15 / zbin2≈55.59 / zbin3≈71.75
  - 指標：`output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay__mw_multigrid_metrics.json`

再現（代表）：
- ξℓ（WSL, combined, b2）：
  - `wsl -d Ubuntu-24.04 -- bash -lc "cd /mnt/c/develop/waveP && OMP_NUM_THREADS=24 .venv_wsl/bin/python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmasslowztot --caps combined --dist lcdm --random-kind random1 --z-bin b2 --weight-scheme boss_default --recon mw_multigrid --recon-mode ani --recon-grid 512 --recon-smoothing 15 --recon-bias 1.85 --recon-f 0.757 --recon-z-min 0.2 --recon-z-max 0.75 --recon-weight-scheme boss_recon --threads 24 --out-tag mw"`
- overlay：
  - `python -B scripts/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay.py --bincent 0 --catalog-recon-suffix __recon_mw_multigrid_ani_mw_rw_boss_recon_rz_zmin0p2_zmax0p75_g512_bias1p85_f0p757 --out-png output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay__mw_multigrid.png --out-json output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay__mw_multigrid_metrics.json`
- gap要約：
  - `python -B scripts/cosmology/cosmology_bao_recon_gap_summary.py`

次：
- Step 4.5B.17.4：残る ξ2 ギャップを「published pipeline 差」として説明可能にする（window畳み込み／推定量定義差の最小化）。


---

## 2026-01-17（UTC） Phase 4 / Step 4.5B.17.4.6：MW multigrid 出力へ Ross cov peakfit を適用

目的：
- 公開 multipoles（Ross post-recon）に整合が高い外部実装（MW multigrid; ani）の出力に対して、catalog-based peakfit（dv=[ξ0,ξ2] + Ross cov）を適用し、ε の推定が “recon実装差” に過度に依存していないかを確認する。

実施：
- MW multigrid（ani; out_tag=`recon_mw_multigrid_ani_mw_rz_zmin0p2_zmax0p75_g512_bias1p85_f0p757`）の z-bin（b1/b2/b3, combined, lcdm）に対して、Ross cov peakfit を実行。
- `scripts/summary/run_all.py --offline` に optional task を追加し、毎回の自動生成に組み込み。
- 論文（`doc/paper/10_manuscript.md` / `doc/paper/01_figures_index.md`）へ図を追加。

結果（要約）：
- ε（lcdm）は zbin1..3 で **+0.022 / −0.004 / −0.020**（z≈0.38/0.51/0.61）で、baseline（out_tag=none）からの差は概ね |Δε|≲0.01。

出力：
- `output/cosmology/cosmology_bao_catalog_peakfit_cmasslowztot_combined_zbinonly__recon_mw_multigrid_ani_mw_rz_zmin0p2_zmax0p75_g512_bias1p85_f0p757.png`
- `output/cosmology/cosmology_bao_catalog_peakfit_cmasslowztot_combined_zbinonly__recon_mw_multigrid_ani_mw_rz_zmin0p2_zmax0p75_g512_bias1p85_f0p757_metrics.json`

再現：
- `python -B scripts/cosmology/cosmology_bao_catalog_peakfit.py --sample cmasslowztot --caps combined --require-zbin --out-tag recon_mw_multigrid_ani_mw_rz_zmin0p2_zmax0p75_g512_bias1p85_f0p757 --dists lcdm --cov-source ross`


---

## 2026-01-17（UTC）追記：4.5B.17.4.6 の out_tag を “boss_recon重み” ベースへ統一

内容：
- 4.5B.17 の “published整合が高い MW multigrid recon” の baseline は、overlay 指標（`cosmology_bao_catalog_vs_published_multipoles_overlay__mw_multigrid_metrics.json`）に合わせて
  out_tag=`recon_mw_multigrid_ani_mw_rw_boss_recon_rz_zmin0p2_zmax0p75_g512_bias1p85_f0p757` を正とする（密度場重み=boss_recon）。
- 直前の 4.5B.17.4.6 の peakfit 実行対象を上記 out_tag に合わせて再実行し、run_all のタスクも同 out_tag に更新した。

結果（要約）：
- ε（lcdm）は zbin1..3 で **+0.016 / −0.014 / −0.018**（z≈0.38/0.51/0.61）。

出力：
- `output/cosmology/cosmology_bao_catalog_peakfit_cmasslowztot_combined_zbinonly__recon_mw_multigrid_ani_mw_rw_boss_recon_rz_zmin0p2_zmax0p75_g512_bias1p85_f0p757.png`
- `output/cosmology/cosmology_bao_catalog_peakfit_cmasslowztot_combined_zbinonly__recon_mw_multigrid_ani_mw_rw_boss_recon_rz_zmin0p2_zmax0p75_g512_bias1p85_f0p757_metrics.json`

再現：
- `python -B scripts/cosmology/cosmology_bao_catalog_peakfit.py --sample cmasslowztot --caps combined --require-zbin --out-tag recon_mw_multigrid_ani_mw_rw_boss_recon_rz_zmin0p2_zmax0p75_g512_bias1p85_f0p757 --dists lcdm --cov-source ross`


---

## 2026-01-17（UTC） Phase 4 / Step 4.5B.17.4.5.1：catalog-based peakfit に Ross cov（full covariance）を導入

目的：
- catalog-based ξ0/ξ2（銀河+random再計算）に対する ε（AP/warping）の評価を、Phase A の対角近似（paircount proxy）だけに依存させず、
  Ross 2016 の一次コード（`baofit_pub2D.py`）と同じ評価軸（dv=[ξ0,ξ2] + full covariance）で再評価できるようにする。

変更：
- `scripts/cosmology/cosmology_bao_catalog_peakfit.py`
  - `--cov-source {auto,diag,ross}` を追加。
  - `auto` は現状 `sample=cmasslowztot,caps=combined,zbinonly` の場合に Ross 2016 公開 cov を自動採用。
  - 出力 metrics に `covariance`（source_requested/source_used）を追加。
- `doc/cosmology/BAO_RECON_SPEC.md`
  - §7.7 を追加（Phase B: Ross 2016 full covariance の位置づけと運用）。
- `doc/ROADMAP.md` / `doc/STATUS.md`
  - 4.5B.17.4.5 を細分化（4.5B.17.4.5.1 完了 / 4.5B.17.4.5.2 進行中）。

出力：
- `output/cosmology/cosmology_bao_catalog_peakfit_cmasslowztot_combined_zbinonly.png`
- `output/cosmology/cosmology_bao_catalog_peakfit_cmasslowztot_combined_zbinonly_metrics.json`

再現：
- 自動（既定 auto；該当ケースは Ross cov を採用）：
  - `python -B scripts/cosmology/cosmology_bao_catalog_peakfit.py --sample cmasslowztot --caps combined --require-zbin`
- 明示（Ross cov）：
  - `python -B scripts/cosmology/cosmology_bao_catalog_peakfit.py --sample cmasslowztot --caps combined --require-zbin --cov-source ross`


---

## 2026-01-17（UTC） Phase 4 / Step 4.5B.17.4.4.3：推定量定義の最終固定（estimator_spec_hash）

目的：
- ε（距離写像差）と「推定量差（正規化/μ積分/combined集約/誤差モデル）」が混ざって議論がブレるのを防ぐ。
- BAO一次統計（galaxy+random → ξ(s,μ) → ξ0/ξ2）の仕様を、再現可能な形で固定する。

実施：
- `scripts/cosmology/cosmology_bao_xi_from_catalogs.py`：
  - `estimator_spec` / `estimator_spec_signature` / `estimator_spec_hash` を出力 metrics に追加。
  - ここに s-bin/μ-bin、paircount正規化規約、combined集約（random重みrescale policy）など “推定量の仕様” をまとめて固定。
- `scripts/cosmology/cosmology_bao_catalog_peakfit.py`：
  - 入力群で `estimator_spec_hash` が混ざっている場合は停止する（混在検出）。
  - 旧データ（hash未同梱）でも `params` から best-effort で hash を再計算して比較できるようにした。
- 文書：
  - `doc/cosmology/BAO_RECON_SPEC.md` §7 に「正規化/μ積分/誤差モデル」の固定仕様と、hash運用を追記。
  - `doc/cosmology/BAO_RECON_GAP.md` と `doc/paper/10_manuscript.md` に、混在防止（hash）への参照を追加。

結果（要約）：
- BAO一次統計の“座標化仕様”と“推定量仕様”が同じ粒度で固定され、ε の変動が「理論差」か「推定量差」か混ざる事故を抑止できる状態になった。

再現：
- 実データ再計算（WSL; Corrfunc 必須。例は b2）：
  - `wsl -d Ubuntu-24.04 -- bash -lc "cd /mnt/c/develop/waveP && export OMP_NUM_THREADS=24 && .venv_wsl/bin/python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmasslowztot --caps combined --dist lcdm --random-kind random1 --z-bin b2 --weight-scheme boss_default --match-sectors auto --sector-key isect --recon mw_multigrid --recon-mode ani --recon-grid 512 --recon-smoothing 15 --recon-bias 1.85 --recon-f 0.757 --recon-z-min 0.2 --recon-z-max 0.75 --recon-weight-scheme boss_recon --threads 24 --out-tag mw"` 
- peakfit（推定量混在ガードの確認）：
  - `python -B scripts/cosmology/cosmology_bao_catalog_peakfit.py --sample cmasslowztot --caps combined --require-zbin --out-tag mw`


---

## 2026-01-17（UTC） Phase 4 / Step 4.5B.17.4.4.1：broadband吸収の感度（bincent0..4 / s_min）

目的：
- “生の ξ2 ギャップ”が broadband（a0+a1/r+a2/r²）で周辺化され得る、という結論が
  - Ross の bin-centering（bincent0..4）
  - Ross fit の既定レンジ（s∈[50,150]）
  に対して頑健かを確認し、議論のブレ（仕様差 vs 理論差の混入）を抑える。

実施：
- baseline（MW multigrid/ani; CMASSLOWZTOT/combined/lcdm; zbin1..3）の catalog recon を固定し、
  Ross post-recon quadrupole（bincent0..4）へ、bin center 上で比較（catalog ξ2 は補間）。
- diff(s)=ξ2_ross−ξ2_catalog に `diff(s)=a0+a1/s+a2/s²` を当て、s≥30 と s≥50 で吸収度を比較。

結果（要約）：
- broadband 後の χ²/dof（ξ2; Ross σ(ξ2)）は、bincent0..4 と s_min の違いに対して概ね安定。
  - 例（中央値；bincent0..4）：s≥30 で 0.66/0.51/0.77、s≥50 で 0.24/0.34/0.66（zbin1..3）。
- よって、少なくとも現データでは “生の ξ2 ギャップ” の大部分は broadband として周辺化され得る。

出力：
- `output/cosmology/cosmology_bao_recon_gap_broadband_sensitivity.png`
- `output/cosmology/cosmology_bao_recon_gap_broadband_sensitivity_metrics.json`

再現：
- `python -B scripts/cosmology/cosmology_bao_recon_gap_broadband_sensitivity.py`


---

## 2026-01-17（UTC） Phase 4 / Step 4.5B.17.4：残る ξ2 ギャップの説明（iso検証 + broadband吸収）

目的：
- Ross post-recon と catalog-based recon の間に残る ξ2 の不一致（recon gap）について、
  「理論差」ではなく **published pipeline（fit/定義/周辺化）差**として説明できる最小要因を確定する。
- 具体的には、(i) MW recon の `recon-mode iso` が有利か不利かを短絡なく確かめ、
  (ii) Ross の公開フィットが周辺化する broadband で“生の ξ2 ギャップ”がどこまで吸収され得るかを定量化する。

変更：
- `scripts/cosmology/cosmology_bao_recon_gap_broadband_fit.py`
  - 差分 `diff(s)=ξ2_ross−ξ2_catalog` に `diff(s)=a0+a1/s+a2/s²` を当て、
    RMSE(s²ξ2) がどの程度縮むかを zbin1..3 で可視化するスクリプトを追加。
- `scripts/summary/run_all.py`
  - `cosmology_bao_recon_gap_broadband_fit` を `--offline` の固定タスクとして追加。
- `doc/ROADMAP.md`
  - 4.5B.17.4 を 4.5B.17.4.1.. へ分割し、進捗が追える形に更新。
- `doc/cosmology/BAO_RECON_GAP.md`
  - B.17.4 の検証（iso検証 + broadband吸収）を追記。
- `doc/paper/10_manuscript.md` / `doc/paper/01_figures_index.md`
  - “生の ξ2 ギャップ” と “BAOピーク（AP/ε）” を分離して議論する根拠として図を追加。

結果（要約）：
- MW multigrid の `recon-mode iso` は悪化：
  - RMSE(s²ξ2; Ross post-recon vs catalog recon)=**78.58 / 74.31 / 83.40**（zbin1..3）
  - → `ani` を維持する。
  - 指標：`output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay__mw_multigrid_iso_metrics.json`
- broadband による吸収（重みは Ross err、s∈[30,150] Mpc/h）：
  - RMSE(s²ξ2) が **59/56/72 → 12/12/15**（zbin1..3）まで縮む
  - → “生の ξ2 ギャップ” は主に broadband 様の形状差として表現でき、Ross fit の枠内ではピーク議論と切り離せる。
  - 出力：`output/cosmology/cosmology_bao_recon_gap_broadband_fit.png`

再現：
- MW recon iso（例：b1。b2/b3 は `--z-bin` を差し替え）：
  - `wsl -d Ubuntu-24.04 -- bash -lc "cd /mnt/c/develop/waveP && export OMP_NUM_THREADS=24 && .venv_wsl/bin/python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmasslowztot --caps combined --dist lcdm --random-kind random1 --z-bin b1 --weight-scheme boss_default --recon mw_multigrid --recon-mode iso --recon-grid 512 --recon-smoothing 15 --recon-bias 1.85 --recon-z-min 0.2 --recon-z-max 0.75 --recon-weight-scheme boss_recon --threads 24 --out-tag mwiso"`
- overlay（iso）：
  - `python -B scripts/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay.py --bincent 0 --catalog-recon-suffix __recon_mw_multigrid_iso_mwiso_rw_boss_recon_rz_zmin0p2_zmax0p75_g512_bias1p85 --out-png output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay__mw_multigrid_iso.png --out-json output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay__mw_multigrid_iso_metrics.json`
- broadband吸収の定量化：
  - `python -B scripts/cosmology/cosmology_bao_recon_gap_broadband_fit.py`


---

## 2026-01-17（UTC） Phase 4 / Step 4.5B.17.4.4：broadband吸収後の残差を χ²/dof で定量化

目的：
- “生の ξ2 ギャップ” が broadband によって吸収できることは RMSE(s²ξ2) で確認できたが、
  **誤差（Ross σ(ξ2)）に対して残差がどの程度か**を明示するため、χ²/dof を追加して定量化する。

変更：
- `scripts/cosmology/cosmology_bao_recon_gap_broadband_fit.py`
  - ξ2 の差分フィット（a0+a1/s+a2/s²）について、`χ²/dof`（raw / broadband）を計算して図とJSONへ追記。
- `doc/cosmology/BAO_RECON_GAP.md`
  - B.17.4.2 に χ²/dof の結果を追記。
- `doc/paper/10_manuscript.md`
  - broadband 吸収の段落に χ²/dof の要約を追記。
- `python -B scripts/summary/run_all.py --offline`
  - 論文/一般レポート（HTML/DOCX）を再生成。

結果（要約）：
- χ²/dof（ξ2; Ross σ(ξ2)）は、raw で **31.38 / 35.95 / 55.83**（zbin1..3）と極めて大きいが、
  broadband 後は **0.63 / 0.66 / 1.04**（zbin1..3）まで低下する。
- したがって、少なくとも ξ2 の差分は broadband の自由度で誤差内へ押し込める領域があり、
  “生の ξ2 ギャップ” をそのまま BAOピーク（AP/ε）不一致へ直結させない、という位置づけが定量的に支持される。

再現：
- `python -B scripts/cosmology/cosmology_bao_recon_gap_broadband_fit.py`
- `python -B scripts/summary/run_all.py --offline`


---

## 2026-01-17（UTC） Phase 4 / Step 4.5B.17.4.4.2：Ross基準での残差評価（dv+cov+broadband）＋ξ4(AP)混合の目安

目的：
- recon gap（Ross post-recon vs catalog-based recon）の“残差の大きさ”を、Ross の一次コード（`baofit_pub2D.py`）が用いる評価軸へ揃え、
  broadband 周辺化と AP/ε 議論の混線を避ける。
- 併せて、Ross fit がモデル側で ξ4 テンプレートを含む点について、AP歪み（ε）による ξ4→ξ2 混合の大きさを定量化する。

変更：
- `scripts/cosmology/cosmology_bao_recon_gap_ross_eval_alignment.py` を追加。
  - dv=[ξ0,ξ2] + Ross covariance（mono→quad）+ Ross fitレンジ（r∈(50,150)）で χ²/dof を評価。
  - broadband 基底（a0+a1/r+a2/r²）を mono/quad それぞれに付与し、GLS（cov）で吸収後の χ²/dof を算出。
  - Ross template（`Challenge_matterpower0.44.02.54.015.01.0.dat`）を用いて、AP歪み（ε）での ξ4→ξ2 混合の大きさ（max|Δ(s²ξ2)| と相対値）を併記。
- `scripts/summary/run_all.py` にタスク（offline）を追加。
- 文書更新：
  - `doc/cosmology/BAO_RECON_GAP.md`（B.17.4 に (4) を追記）
  - `doc/paper/10_manuscript.md` / `doc/paper/01_figures_index.md`
  - `doc/ROADMAP.md` / `doc/STATUS.md`

結果（要約）：
- Ross の評価軸（dv+cov）で見ると、bincent0..4 の中央値で χ²/dof（Ross cov）は
  - raw=4.33/4.33/6.37 → broadband後=1.59/1.70/1.95（zbin1..3）
  となり、対角誤差（Ross err_xi）だけで見た場合より“穏やか”に評価される。
- ξ4(AP)混合は、Ross template（α=1）で ε∈[-0.05,0.05] の範囲では相対で概ね数％（例：ε=0.02で約3%）に留まり、オーダーとしては小さい。

出力：
- `output/cosmology/cosmology_bao_recon_gap_ross_eval_alignment.png`
- `output/cosmology/cosmology_bao_recon_gap_ross_eval_alignment_metrics.json`

再現：
- `python -B scripts/cosmology/cosmology_bao_recon_gap_ross_eval_alignment.py`

再現：
- overlay（既定：bin center）：
  - `python -B scripts/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay.py --bincent 0`
- overlay（Ross rbc を x 軸に使用）：
  - `python -B scripts/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay.py --bincent 0 --ross-x-axis rbc --out-png output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay__ross_rbc.png --out-json output/cosmology/cosmology_bao_catalog_vs_published_multipoles_overlay__ross_rbc_metrics.json`


---

## 2026-01-17（UTC） Phase 4 / Step 4.5B.18：MW multigrid recon へ P_bg 距離写像を差し替え（ξℓ→peakfit）

目的：
- BAOの圧縮出力（D_M/r_d 等）ではなく、一次統計（銀河+random→ξ(s,μ)→ξℓ）から距離写像差だけを差し替え、幾何（ε）を評価する。
- MW multigrid（Padmanabhan 2012 の radial LOS + finite-difference solver 相当）でも dist=pbg を評価できるようにし、lcdmとの Δε を固定する。

実施：
- `scripts/cosmology/mw_recon_driver.cpp` を拡張し、入力の第3列を `z` または `χ`（comoving distance）として解釈できるようにした（`input_mode`）。
- `scripts/cosmology/mw_recon_code.py` に `input_mode` と `dist_g/dist_r` を追加し、driver更新を検出して自動再ビルドする build stamp を導入。
- `scripts/cosmology/cosmology_bao_xi_from_catalogs.py` の `mw_multigrid` で、dist≠lcdm の場合は `χ` を渡す経路を追加（pbg等）。
- WSL（Corrfunc; threads=24）で CMASSLOWZTOT/combined zbin1..3 の ξℓ を dist=pbg で再計算し、Ross 2016 full covariance（dv=[ξ0,ξ2]）で peakfit を lcdm/pbg 併記で実行。

結果（要約）：
- MW multigrid（ani; boss_recon重み；CMASSLOWZTOT/combined zbin1..3）で ε(pbg) は ε(lcdm) より概ね +0.02 前後大きくなる（詳細は peakfit metrics を参照）。

出力：
- ξℓ（pbg; b1/b2/b3）：
  - `output/cosmology/cosmology_bao_xi_from_catalogs_cmasslowztot_combined_pbg_b{1,2,3}__recon_mw_multigrid_ani_mw_rw_boss_recon_rz_zmin0p2_zmax0p75_g512_bias1p85_f0p757.*`
- peakfit（lcdm/pbg；Ross cov）：
  - `output/cosmology/cosmology_bao_catalog_peakfit_cmasslowztot_combined_zbinonly__recon_mw_multigrid_ani_mw_rw_boss_recon_rz_zmin0p2_zmax0p75_g512_bias1p85_f0p757.(png|json)`
- 仕様（mw_multigrid の dist差し替え方針）：
  - `doc/cosmology/BAO_RECON_SPEC.md`

再現：
- ξℓ（pbg；例：b2。b1/b3 は `--z-bin b1/b3`）：
  - `wsl -d Ubuntu-24.04 -- bash -lc "cd /mnt/c/develop/waveP && .venv_wsl/bin/python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmasslowztot --caps combined --dist pbg --random-kind random1 --match-sectors auto --sector-key isect --z-bin b2 --recon mw_multigrid --recon-mode ani --recon-weight-scheme boss_recon --recon-z-min 0.2 --recon-z-max 0.75 --recon-grid 512 --recon-smoothing 15 --recon-bias 1.85 --recon-f 0.757 --threads 24 --out-tag recon_mw_multigrid_ani_mw_rw_boss_recon_rz_zmin0p2_zmax0p75_g512_bias1p85_f0p757"`
- ξℓ（lcdm；同条件で更新。例：b2）：
  - `wsl -d Ubuntu-24.04 -- bash -lc "cd /mnt/c/develop/waveP && .venv_wsl/bin/python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmasslowztot --caps combined --dist lcdm --random-kind random1 --match-sectors auto --sector-key isect --z-bin b2 --recon mw_multigrid --recon-mode ani --recon-weight-scheme boss_recon --recon-z-min 0.2 --recon-z-max 0.75 --recon-grid 512 --recon-smoothing 15 --recon-bias 1.85 --recon-f 0.757 --threads 24 --out-tag recon_mw_multigrid_ani_mw_rw_boss_recon_rz_zmin0p2_zmax0p75_g512_bias1p85_f0p757"`
- peakfit（Ross cov；lcdm/pbg 併記）：
  - `python -B scripts/cosmology/cosmology_bao_catalog_peakfit.py --sample cmasslowztot --caps combined --require-zbin --out-tag recon_mw_multigrid_ani_mw_rw_boss_recon_rz_zmin0p2_zmax0p75_g512_bias1p85_f0p757 --dists lcdm,pbg --cov-source ross`


---

## 2026-01-17（UTC） Phase 4 / Step 4.5B.18.3：Table 1 / スコアボードへ反映（BAO一次統計）

目的：
- BAOの PhaseB（Ross full covariance + MW multigrid recon + dist差し替え）結果を、Table 1 と総合スコアボードへ **確定値として反映**し、以後の議論がブレない形に固定する。

変更：
- `scripts/summary/paper_tables.py`
  - Table 1 に「宇宙論（BAO一次統計）」行を追加（CMASSLOWZTOT/combined zbin; MW multigrid; Ross cov）。
- `scripts/summary/validation_scoreboard.py`
  - BAO行は **PhaseB をスコアとして優先**し、PhaseA（screening）は補助として併記するよう変更。

結果（要約）：
- Table 1（BAO一次統計）：
  - pbg（b1, z_eff≈0.384）：ε=0.036±0.012（|z|=3.11σ）
  - lcdm（b1）：ε=0.016±0.013（|z|=1.27σ）
  - Δε(pbg−lcdm)≈+0.020

出力：
- `output/summary/paper_table1_results.(md|json|csv)`（BAO行を含む）
- `output/summary/validation_scoreboard.(png|json)`（BAO行は PhaseB=|z|=3.11σ を優先）

再現：
- Table 1：
  - `python -B scripts/summary/paper_tables.py`
- スコアボード：
  - `python -B scripts/summary/validation_scoreboard.py`
- 論文/一般レポート再生成：
  - `python -B scripts/summary/run_all.py --offline`


---

## 2026-01-17（UTC） Phase 4 / Step 4.5B.19：pre-recon（Satpathy 2016 cov）で dist差し替えを再チェック（recon依存の切り分け）

目的：
- post-recon（Ross cov）で得た「距離写像差（lcdm vs P_bg）が ε に与える影響」が、reconstruction の仕様に強く依存するかを切り分ける。
- BAOの“圧縮出力値”ではなく、一次統計（銀河+random→ξ(s,μ)→ξℓ）で議論が閉じるように、pre-recon の一次統計・誤差モデルを追加して固定する。

実施：
- WSL（Corrfunc; threads=24）で pre-recon ξℓ（lcdm/pbg; CMASSLOWZTOT/combined; zbin1..3; out_tag=prerecon）を再計算。
- pre-recon covariance として Satpathy 2016 full covariance（dv=[ξ0,ξ2]）を導入し、`cosmology_bao_catalog_peakfit.py` に `--cov-source satpathy` / `--satpathy-dir` を追加。
  - `--cov-source auto` は **pre-recon（recon_mode=none）→ Satpathy / post-recon → Ross** を自動選択（対象は cmasslowztot/combined の z-bin）。
- Table 1 / スコアボードに pre-recon（Satpathy cov）要約を追記（ただしスコアは従来通り post-recon（Ross cov）を優先）。

結果（要約；pre-recon, Satpathy cov）：
- worst：pbg（b1, z_eff≈0.384）ε=0.036±0.015（|z|=2.45σ）
- lcdm（b1）：ε=0.026±0.015（|z|=1.71σ）
- Δε(pbg−lcdm; b1)=+0.010

出力：
- pre-recon peakfit（Satpathy cov）：
  - `output/cosmology/cosmology_bao_catalog_peakfit_cmasslowztot_combined_zbinonly__prerecon.(png|json)`
- Table 1 / スコアボード：
  - `output/summary/paper_table1_results.(md|json|csv)`
  - `output/summary/validation_scoreboard.(png|json)`

再現（例）：
- pre-recon ξℓ（例：b1。b2/b3 は `--z-bin` を差し替え）：
  - `wsl -d Ubuntu-24.04 -- bash -lc "cd /mnt/c/develop/waveP && OMP_NUM_THREADS=24 .venv_wsl/bin/python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --sample cmasslowztot --caps combined --dist pbg --random-kind random1 --match-sectors auto --sector-key isect --z-bin b1 --recon none --threads 24 --out-tag prerecon"`
- pre-recon peakfit（Satpathy cov；lcdm/pbg）：
  - `python -B scripts/cosmology/cosmology_bao_catalog_peakfit.py --sample cmasslowztot --caps combined --require-zbin --out-tag prerecon --dists lcdm,pbg --cov-source satpathy`
- Table 1 / スコアボード：
  - `python -B scripts/summary/paper_tables.py`
  - `python -B scripts/summary/validation_scoreboard.py`
- 論文/一般レポート再生成：
  - `python -B scripts/summary/run_all.py --offline`

次：
- Step 4.5B.20：P(k) multipoles でクロスチェック（Beutler 2016）。


---

## 2026-01-17（UTC） Phase 4 / Step 4.5B.20：P(k) multipoles（Beutler）でのクロスチェック（窓関数込み）

目的：
- ξℓ（銀河+random→Corrfunc）peakfit と独立な一次統計として、BOSS DR12 の公開 P(k) multipoles（P0,P2）でも ε（AP warping）を評価し、オーダーとして矛盾がないかを確認する。
- P(k) は survey 窓関数の影響が大きいため、RR multipoles（Beutler window）で窓関数畳み込み込みの最小モデル（smooth+peak）として扱う（full-shape/RSDは次工程）。

実施：
- Beutler 公開パッケージ（P(k) multipoles / PATCHY共分散 / window）を `data/cosmology/beutler_2016_combineddr12_bao_powspec/` にキャッシュ。
- `cosmology_bao_pk_multipole_peakfit.py --window` で post-recon / pre-recon をそれぞれ実行し、z-bin1..3（NGC+SGCのjoint）で ε を peakfit。
- Table 1 / スコアボードに “P(k)window の最大|z|” を追記して、ξℓ側の結果と並べて参照できるようにした。

結果（要約）：
- post-recon（窓関数込み）: 最大|z|≈1.71σ（z-bin3; ε≈+0.040±0.023）
- pre-recon（窓関数込み）: z-bin1 で ε≈+0.132±0.019（|z|≈6.93σ）
  - 注：pre-recon は quadrupole の broadband（RSD 等）が支配的になり得るため、最小モデル（smooth+peak）では ε が過大推定される例がある。full-shape/RSD を含む次工程で扱う。

出力：
- `output/cosmology/cosmology_bao_pk_multipole_peakfit_window.(png|json)`
- `output/cosmology/cosmology_bao_pk_multipole_peakfit_pre_recon_window.(png|json)`
- `output/summary/paper_table1_results.(md|json|csv)`
- `output/summary/validation_scoreboard.(png|json)`

再現：
- 取得（online）：
  - `python -B scripts/cosmology/fetch_boss_dr12_beutler2016_bao_powspec.py`
- peakfit（post-recon, window）：
  - `python -B scripts/cosmology/cosmology_bao_pk_multipole_peakfit.py --window --recon postrecon`
- peakfit（pre-recon, window）：
  - `python -B scripts/cosmology/cosmology_bao_pk_multipole_peakfit.py --window --recon prerecon`
- Table 1 / スコアボード：
  - `python -B scripts/summary/paper_tables.py`
  - `python -B scripts/summary/validation_scoreboard.py`
- 論文/一般レポート再生成：
  - `python -B scripts/summary/run_all.py --offline`

次：
- Step 4.5B.21：eBOSS / DESI へ拡張（一次統計で同様に検証）。


---

## 2026-01-17（UTC） Phase 4 / Step 4.5B.21.1：eBOSS DR16一次入力（LRGpCMASS recon）取得・抽出パイプライン

目的：
- eBOSS DR16（LRGpCMASS recon）を、BOSS DR12 と同様に「銀河+random一次入力 → ξ(s,μ) → ξℓ」で再導出できる入口を固定する。
- 後続の dist差し替え（lcdm vs P_bg）で ε/Δε を評価できるように、取得/抽出/manifest の再現性を確保する。

実施：
- `scripts/cosmology/fetch_eboss_dr16_lss.py` を追加（raw配置 → 抽出NPZ → `data/cosmology/eboss_dr16_lss/manifest.json` を生成する入口）。
  - 注：eBOSS random はGB級のため、既定では自動DLしない（事故防止）。まず raw を手動配置してから実行する運用を推奨。
- `scripts/cosmology/cosmology_bao_xi_from_catalogs.py` に `--data-dir` を追加し、BOSS以外の catalog/manifest でも同一の座標化仕様で ξ(s,μ)→ξℓ を計算可能にした。

再現（入口）：
- 必要ファイル一覧（URLとファイル名）：
  - `python -B scripts/cosmology/fetch_eboss_dr16_lss.py --print-needed-files`
- 抽出（raw を配置後）：
  - `python -B scripts/cosmology/fetch_eboss_dr16_lss.py --sample lrgpcmass_rec --caps combined --random-sampling prefix_rows --random-max-rows 2000000`
- ξℓ（WSL/Corrfunc）：
  - `python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --data-dir data/cosmology/eboss_dr16_lss --sample lrgpcmass_rec --caps combined --random-kind random --dist lcdm --recon none --z-min 0.6 --z-max 1.0`

次：
- Step 4.5B.21.2：eBOSS ξℓ（fid lcdm）の整合チェック（形/重み/σ）。
- Step 4.5B.21.3：dist差し替え（pbg 等）で ε/Δε → Table 1 / スコアボードへ反映。


---

## 2026-01-17（UTC） Phase 4 / Step 4.5B.21.2-21.3：eBOSS ξℓ（WSL/Corrfunc）再計算と peakfit（ε）→ Table 1 / スコアボード反映

目的：
- eBOSS DR16（LRGpCMASS recon）の銀河+randomから、catalog-based ξ(s,μ)→ξℓ（ℓ=0,2）を再計算し、座標化（lcdm vs pbg）差の入口を固定する。
- その ξℓ に最小モデル（smooth+peak）peakfit を適用し、ε/Δε を推定して Table 1 / スコアボードへ反映する（Phase A screening）。

実施：
- FITSパーサ修正：`scripts/cosmology/boss_dr12v5_fits.py` に TFORM=`L`（logical）対応を追加（eBOSS FITS の header 読み取りが停止する問題を解消）。
- 取得・抽出：
  - `scripts/cosmology/fetch_eboss_dr16_lss.py` を `dr16.sdss.org` 優先＋timeout拡大へ更新し、`--stream-missing` で raw 未保存でも抽出できるようにした。
  - `data/cosmology/eboss_dr16_lss/manifest.json` と extracted NPZ（NGC/SGC; galaxy full / random prefix 2M）を生成。
- ξℓ（WSL/Corrfunc; threads=24）：
  - `scripts/cosmology/cosmology_bao_xi_from_catalogs.py --data-dir data/cosmology/eboss_dr16_lss --sample lrgpcmass_rec` を lcdm/pbg で実行（z=0.6–1.0）。
- peakfit（ε）：
  - `scripts/cosmology/cosmology_bao_catalog_peakfit.py --sample lrgpcmass_rec --caps combined --dists lcdm,pbg --cov-source diag` を実行し、eBOSS の ε（AP warping）を推定。
- 反映：
  - Table 1：`scripts/summary/paper_tables.py` に eBOSS 行（screening）を追加。
  - スコアボード：`scripts/summary/validation_scoreboard.py` に eBOSS peakfit を追加。
  - 論文化：`doc/paper/10_manuscript.md` と `doc/paper/01_figures_index.md` に eBOSS 図を追記。

主な出力：
- `data/cosmology/eboss_dr16_lss/manifest.json`
- `output/cosmology/cosmology_bao_xi_from_catalogs_lrgpcmass_rec_combined_{lcdm,pbg}_zmin0p6_zmax1.(npz|png|json)`
- `output/cosmology/cosmology_bao_catalog_peakfit_lrgpcmass_rec_combined.(png|json)`

再現：
- 取得・抽出（online; stream）：
  - `python -B scripts/cosmology/fetch_eboss_dr16_lss.py --sample lrgpcmass_rec --caps combined --stream-missing --random-sampling prefix_rows --random-max-rows 2000000`
- ξℓ（WSL/Corrfunc; threads=24）：
  - `wsl -d Ubuntu-24.04 -- bash -lc "cd /mnt/c/develop/waveP && .venv_wsl/bin/python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --data-dir data/cosmology/eboss_dr16_lss --sample lrgpcmass_rec --caps combined --random-kind random --dist lcdm --recon none --z-min 0.6 --z-max 1.0 --threads 24"`
  - `wsl -d Ubuntu-24.04 -- bash -lc "cd /mnt/c/develop/waveP && .venv_wsl/bin/python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --data-dir data/cosmology/eboss_dr16_lss --sample lrgpcmass_rec --caps combined --random-kind random --dist pbg --recon none --z-min 0.6 --z-max 1.0 --threads 24"`
- peakfit（ε; diag）：
  - `wsl -d Ubuntu-24.04 -- bash -lc "cd /mnt/c/develop/waveP && .venv_wsl/bin/python -B scripts/cosmology/cosmology_bao_catalog_peakfit.py --sample lrgpcmass_rec --caps combined --dists lcdm,pbg --cov-source diag"`
- Table 1 / スコアボード：
  - `python -B scripts/summary/paper_tables.py`
  - `python -B scripts/summary/validation_scoreboard.py`
- 論文/一般レポート再生成：
  - `python -B scripts/summary/run_all.py --offline`

次：
- Step 4.5B.21.3（継続）：eBOSS の random を reservoir / full へ移行し、prefix 行順バイアスを低減した上で ε/Δε の頑健性を確認。
- Step 4.5B.21.4：eBOSS QSO / DESI へ拡張（同様に一次統計から）。


---

## 2026-01-17（UTC） Phase 4 / Step 4.5B.21.3：論文/一般レポート再生成と ContextWindow 最小辞書の更新

実施：
- `doc/AI_CONTEXT_MIN.json` を更新（現在地：`4.5B.21.3`）。
- `python -B scripts/summary/run_all.py --offline` を実行し、論文/一般レポート（HTML/DOCX）を最新化。

主な出力：
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`
- `output/summary/run_all_status.json`


---

## 2026-01-17（UTC） Phase 4 / Step 4.5B.21.3：eBOSS random を reservoir 化し、ε（AP warping）の推定を更新

実施：
- eBOSS DR16 LRGpCMASS（recon）の random を prefix 抽出から reservoir 抽出へ移行（2,000,000行; seed=0）。
  - `python -B scripts/cosmology/fetch_eboss_dr16_lss.py --sample lrgpcmass_rec --caps combined --stream-missing --random-sampling reservoir --random-max-rows 2000000 --sampling-seed 0`
- ξℓ（galaxy+random → ξ(s,μ)→ξ0/ξ2）を WSL（Corrfunc; threads=24）で再計算（combined/north/south; lcdm/pbg; z=0.6–1.0）。
- peakfit（smooth+peak; diag）を再実行し、combined: pbg ε≈+0.008±0.010（|z|≈0.82σ）/ lcdm ε≈−0.020±0.010（|z|≈2.01σ）へ更新（prefix 抽出のときの値と大きく変わる例を確認）。
- `scripts/cosmology/cosmology_bao_xi_from_catalogs.py` の metrics notes を、random NPZ名から sampling（prefix/reservoir/full）を自動推定して記録するように更新。
- Table 1 / スコアボードを更新（eBOSS 行の sampling 表記を reservoir に更新、eBOSS north/south をスコアボードへ追加）。
- `python -B scripts/summary/run_all.py --offline` を実行し、論文/一般レポート（HTML/DOCX）を最新化。

主な出力：
- `data/cosmology/eboss_dr16_lss/manifest.json`（random sampling=reservoir）
- `output/cosmology/cosmology_bao_xi_from_catalogs_lrgpcmass_rec_{combined,north,south}_{lcdm,pbg}_zmin0p6_zmax1.*`
- `output/cosmology/cosmology_bao_catalog_peakfit_lrgpcmass_rec_{combined,north,south}.*`
- `output/summary/paper_table1_results.md` / `output/summary/validation_scoreboard.json`


---

## 2026-01-17（UTC） Phase 4 / Step 4.5B.21.4：eBOSS DR16 QSO（一次統計：galaxy+random→ξℓ）を追加して ε を推定

目的：
- eBOSS DR16 QSO についても、BAO「出力値」ではなく **一次統計（銀河＋random）から ξ(s,μ)→ξℓ を再計算**し、座標化（lcdm vs pbg）の幾何差（特に ε）をスクリーニングできる入口を固定する。
- north/south（NGC/SGC）分割も保存し、系統切り分けの土台を作る。

実施：
- `scripts/cosmology/fetch_eboss_dr16_lss.py` に `--sample qso` を追加（DR16 index の `eBOSS_QSO_clustering_{data,random}-{NGC,SGC}-vDR16.fits`）。
- 取得・抽出（stream + reservoir）：random を **reservoir 2M（seed=0）**に固定して NPZ を生成し、`data/cosmology/eboss_dr16_lss/manifest.json` を更新。
- ξℓ（WSL/Corrfunc; threads=24）：QSO（0.8<z<2.2）の ξ(s,μ)→ξ0/ξ2 を、combined/north/south で lcdm/pbg の2系統出力。
- peakfit（diag）：最小モデル（smooth+peak）で ε を推定し、Table 1 / スコアボード / 本文へ反映。
  - combined: pbg ε≈−0.004±0.021（|z|≈0.19σ） / lcdm ε≈−0.004±0.013（|z|≈0.31σ）
  - north/south も保存（最大|z|≈1.27σ）。

主な出力：
- `data/cosmology/eboss_dr16_lss/manifest.json`
- `output/cosmology/cosmology_bao_xi_from_catalogs_qso_{combined,north,south}_{lcdm,pbg}_zmin0p8_zmax2p2.*`
- `output/cosmology/cosmology_bao_catalog_peakfit_qso_{combined,north,south}.*`
- `output/summary/paper_table1_results.md` / `output/summary/validation_scoreboard.json`

再現：
- 抽出（online; stream + reservoir）：
  - `python -B scripts/cosmology/fetch_eboss_dr16_lss.py --sample qso --caps combined --stream-missing --random-sampling reservoir --random-max-rows 2000000 --sampling-seed 0`
- ξℓ（WSL/Corrfunc; threads=24）：
  - `wsl -d Ubuntu-24.04 -- bash -lc "cd /mnt/c/develop/waveP && .venv_wsl/bin/python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --data-dir data/cosmology/eboss_dr16_lss --sample qso --caps {combined|north|south} --random-kind random --dist lcdm --recon none --z-min 0.8 --z-max 2.2 --lcdm-z-grid-max 2.5 --threads 24"`
  - `wsl -d Ubuntu-24.04 -- bash -lc "cd /mnt/c/develop/waveP && .venv_wsl/bin/python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --data-dir data/cosmology/eboss_dr16_lss --sample qso --caps {combined|north|south} --random-kind random --dist pbg --recon none --z-min 0.8 --z-max 2.2 --threads 24"`
- peakfit（diag）：
  - `python -B scripts/cosmology/cosmology_bao_catalog_peakfit.py --sample qso --caps {combined|north|south} --dists lcdm,pbg --cov-source diag`
- Table 1 / スコアボード：
  - `python -B scripts/summary/paper_tables.py`
  - `python -B scripts/summary/validation_scoreboard.py`
- 論文/一般レポート再生成：
  - `python -B scripts/summary/run_all.py --offline`


---

## 2026-01-18（UTC） Phase 4 / Step 4.5B.21.4.4.1.3.4：DESI DR1 “公開 dv+cov（multipoles/cov）” の所在を VAC まで含めて再確認

目的：
- `cosmodesi/desi-kp-cosmological-likelihoods` が要求する `data/likelihood`（測定ベクトル＋共分散; HDF5 等）が、DR1 の公開導線に存在するかを一次ソースとして確定する。

実施：
- DR1 VAC（`https://data.desi.lbl.gov/public/dr1/vac/dr1/`）の index から、`bao-cosmo-params` / `full-shape-cosmo-params` を含む “再現性パック” を確認。
- `bao-cosmo-params`（Cobaya chain）の設定が `bao_data/..._mean.txt` / `bao_data/..._cov.txt` を参照していることを確認（= `CobayaSampler/bao_data` 由来の mean/cov と整合）。
  - 既存キャッシュ：`data/cosmology/desi_dr1_bao_bao_data.json`（Step 4.5B.21.4.4.1.2）
- `full-shape-cosmo-params`（Cobaya chain）の設定で `python_path=/global/...` の内部環境参照が残ることを確認し、公開ポータル上で dv+cov（HDF5 等）を同梱配布する導線は、この範囲では見当たらないことを再確認。
- 探索メモを更新：
  - `doc/cosmology/DESI_PUBLISHED_2PT_PRODUCTS.md`
  - `doc/ROADMAP.md` / `doc/STATUS.md`

結論：
- DR1 の公開導線（public / VAC / WebDAV 等）から、BAO galaxies の “fit用 dv+cov（multipoles/cov）” の配布場所を一次ソースとして確定できないため、Step 4.5B.21.4.4.1.3.4 は **保留**を維持する。
- 実装上は引き続き、catalog-based ξℓ の dv+cov は sky jackknife 等の代替（Step 4.5B.21.4.4.4）で扱う。

再現（URL取得の例）：
- `curl -L "https://data.desi.lbl.gov/public/dr1/vac/dr1/bao-cosmo-params/v1.0/cobaya/base/desi-bao-all/chain.updated.yaml"`
- `curl -L "https://data.desi.lbl.gov/public/dr1/vac/dr1/full-shape-cosmo-params/v1.0/cobaya/base/desi-v1.5-bao-lrg-z2_schoneberg2024-bbn/chain.input.yaml"`


---

## 2026-01-18（UTC） Phase 4 / Step 4.5B.21.4.4.5.4：DESI LRG2 の broadband（smooth基底）感度（smooth_power_max）

目的：
- DESI LRG2（0.6–0.8）で「peakfit ε（jackknife）が大きい」一方「wedge由来 ε_proxy が小さい」齟齬について、**fitモデル（broadband/smooth基底）の自由度**が ε を引っ張っていないかを切り分ける。
- 後から議論がブレないよう、peakfit 側のモデル仕様（smooth基底）も座標化仕様と同等に固定記録できるようにする。

変更：
- peakfit（smooth+peak）の smooth 基底を `1/r^p`（p=0..pmax）で可変化（pmax=`--smooth-power-max`）し、dof と JSON 出力へ仕様を記録：
  - `scripts/cosmology/cosmology_bao_xi_multipole_peakfit.py`
  - `scripts/cosmology/cosmology_bao_catalog_peakfit.py`
  - `scripts/cosmology/cosmology_bao_catalog_peakfit_settings_sensitivity.py`（scenario に `smooth3` を追加）

結果（DESI LRG; combined; out_tag=`w_desi_default_ms_off_y1bins`; jackknife cov）：
- baseline（pmax=2）：
  - z=0.4–0.6：lcdm ε≈−0.004 / pbg ε≈−0.006
  - z=0.6–0.8：lcdm ε≈−0.096 / pbg ε≈+0.022
- broadband拡張（pmax=3）：
  - z=0.4–0.6：lcdm ε≈−0.096 / pbg ε≈−0.088
  - z=0.6–0.8：lcdm ε≈−0.004 / pbg ε≈+0.022
- 所見：pmax=2→3 で ε が **LRG1/LRG2 間で入れ替わる**ほど動く。したがって、現時点の “LRG2 の不一致” は broadband（smooth基底）自由度に強く依存し得る（過剰な broadband は ε を吸収してしまう可能性）。

主な出力：
- `output/cosmology/cosmology_bao_catalog_peakfit_settings_sensitivity__lrg_combined__w_desi_default_ms_off_y1bins.png`
- `output/cosmology/cosmology_bao_catalog_peakfit_settings_sensitivity__lrg_combined__w_desi_default_ms_off_y1bins_metrics.json`

再現：
- 設定感度（ジャックナイフcov; scenario=base/smooth3 を含む）：
  - `python -B scripts/cosmology/cosmology_bao_catalog_peakfit_settings_sensitivity.py --sample lrg --caps combined --out-tag w_desi_default_ms_off_y1bins`
- 論文/一般レポート再生成：
  - `python -B scripts/summary/run_all.py --offline`


---

## 2026-01-18（UTC） Phase 4 / Step 4.5B.21.4.4.1.3：DESI 公開 dv+cov 探索に WebDAV（PROPFIND）を追加

目的：
- DESI DR1 の公開導線（public / papers / survey catalogs / WebDAV mirror）から、BAO一次統計（multipoles等）の **fit用 dv+cov** が配布されているかを一次ソースとして確定する。

実施：
- `scripts/cosmology/discover_desi_public_2pt_products.py` を拡張し、HTML listing が取れない場合に **WebDAV（PROPFIND; depth=1）**で listing を取得できるようにした。
- WebDAV mirror の `survey/catalogs/dr1/` を depth=6 / max_dirs=260 でクロールし、候補 `candidates=0` を確認（名称で判別できる 2pt dv+cov の公開配布は未特定）。
  - 参考：VAC 側では Lya correlations の共分散（例：`full-covariance-smoothed.fits`）は候補として検出でき、WebDAVクロール自体が機能していることを確認。

主な出力：
- `output/cosmology/desi_public_2pt_discovery_webdav_survey_catalogs_dr1_depth6.json`
- `output/cosmology/desi_public_2pt_discovery_webdav_vac_lya_correlations_depth6.json`

再現：
- `python -B scripts/cosmology/discover_desi_public_2pt_products.py --roots "https://webdav-hdfs.pic.es/data/public/DESI/DR1/survey/catalogs/dr1/" --max-depth 6 --max-dirs 260 --timeout-sec 25 --max-links-per-dir 180 --out-json output/cosmology/desi_public_2pt_discovery_webdav_survey_catalogs_dr1_depth6.json`


---

## 2026-01-18（UTC） Phase 4 / Step 4.5B.21.4.4.1.3.4：DESI 公開 dv+cov（multipoles/cov）の一次ソース導線を追加検証

目的：
- DESI DR1（BAO galaxies: LRG 等）で「公開 multipoles/cov（測定ベクトル＋共分散; fit用 dv+cov）」が存在するなら、一次ソースとして配布場所を確定し、`data/cosmology/` にキャッシュできる形にする。

実施：
- DESI 2024 III（BAO galaxies & quasars；arXiv:2404.03000）の arXiv source を取得し、Data Availability と関連コメント（内部導線の有無）を確認。
  - 保存：`data/cosmology/sources/arxiv_2404.03000_src.tar` / `data/cosmology/sources/arxiv_2404.03000_src/`
- DESI DR1 公式ドキュメント（`https://data.desi.lbl.gov/doc/releases/dr1/`）の LSS catalog 案内を確認（公開導線の一次確認）。
- 探索メモを更新：`doc/cosmology/DESI_PUBLISHED_2PT_PRODUCTS.md`

結論（現状）：
- arXiv source の Data Availability は一般記述のみで、dv+cov（multipoles/cov）の配布URL/ファイル名は特定できない。
- DR1公式ドキュメントも「LSS catalogs（clustering catalog 推奨）」の案内が中心で、BAO galaxies の dv+cov（fit用）を直接配布する導線は確認できない（少なくとも当該ページの案内範囲では未確認）。
- よって、`cosmodesi/desi-kp-cosmological-likelihoods` が前提とする `data/likelihood`（HDF5; 測定ベクトル＋共分散）の公開配布場所は一次ソースとして確定できず、ロードマップ上は **保留**を維持する。
  - 代替として、Phase 4.5B.21.4.4.4 の jackknife dv+cov を主力に据える（diag依存を解消済み）。

主な変更：
- `doc/cosmology/DESI_PUBLISHED_2PT_PRODUCTS.md`（追記）
- `doc/ROADMAP.md`（4.5B.21.4.4.1.3.4 の補足追記、最終更新UTC更新）
- `doc/STATUS.md`（更新メモ追記、最終更新UTC更新）

再現（参照）：
- arXiv source 取得：
  - `Invoke-WebRequest -Uri "https://arxiv.org/e-print/2404.03000" -OutFile data/cosmology/sources/arxiv_2404.03000_src.tar`
- DR1 docs：
  - `https://data.desi.lbl.gov/doc/releases/dr1/`


---

## 2026-01-18（UTC） Phase 4 / Step 4.5B.21.4.4.5.3：DESI LRG2 の wedge/ξ2 feature 補助診断

実施：
- DESI DR1 LRG1/LRG2（y1bins; out_tag=`w_desi_default_ms_off_y1bins`）について、
  - μ-wedge（横/縦）ピーク差（s⊥, s∥）から ε_proxy を集計
  - ξ0ピークと ξ2 feature（broadband 除去後の支配極値）を集計
- 結果：LRG2（z≈0.71）では peakfit ε と wedge 由来 ε_proxy が大きく乖離する例（lcdm: ε≈−0.096 vs ε_proxy≈−0.012）があり、peakfit の“不一致”が幾何だけでなく ξ2 の broadband/feature 形状に敏感である可能性を整理。
- 論文化：`doc/paper/10_manuscript.md` に追記、`doc/paper/01_figures_index.md` に図を追加。
- ロードマップ/STATUS を更新（現在地を DESI 公開 multipoles/cov（fit用 dv+cov）の一次ソース確定（保留）へ戻す）。

主な出力：
- `output/cosmology/cosmology_bao_catalog_wedge_anisotropy__w_desi_default_ms_off_y1bins.png` / `output/cosmology/cosmology_bao_catalog_wedge_anisotropy__w_desi_default_ms_off_y1bins_metrics.json`
- `output/cosmology/cosmology_bao_catalog_peak_summary__w_desi_default_ms_off_y1bins.png` / `output/cosmology/cosmology_bao_catalog_peak_summary__w_desi_default_ms_off_y1bins_metrics.json`

再現：
- wedge：
  - `python -B scripts/cosmology/cosmology_bao_catalog_wedge_anisotropy.py --sample lrg --caps combined --out-tag w_desi_default_ms_off_y1bins`
- ξ2 feature：
  - `python -B scripts/cosmology/cosmology_bao_catalog_peak_summary.py --sample lrg --caps combined --out-tag w_desi_default_ms_off_y1bins`

次：
- Step 4.5B.21.4.4.1.3.4：DESI 公開 multipoles/cov（fit用 dv+cov）の一次ソース確定（保留→解消）


---

## 2026-01-18（UTC） Phase 4 / Step 4.5B.21.4.4.5.1：DESI LRG2 の peakfit 設定感度スキャン（jackknife cov 固定）

目的：
- LRG2 の「不一致」が peakfit の任意設定（r_range/テンプレート/quad_weight 等）に起因するのか、どの程度頑健なのかを切り分ける。

実施：
- peakfit 設定感度スキャンのスクリプトを追加し、DESI y1bins（LRG1/LRG2）で実行。
- jackknife cov（dv+cov）を固定し、ε と |z|（=|ε|/σ_ε）をシナリオ横断で可視化。

主な所見（スキャン範囲内）：
- LRG2（lcdm）：最良でも |z|≈3.3 を下回りにくく、不一致が比較的頑健。
- LRG2（pbg）：|z| が 1.5〜6 程度で動き、テンプレート中心 r0=110 では |z|≈1.5（要改善）まで下がるが、設定感度が残る。

主な出力：
- `output/cosmology/cosmology_bao_catalog_peakfit_settings_sensitivity__lrg_combined__w_desi_default_ms_off_y1bins.png`
- `output/cosmology/cosmology_bao_catalog_peakfit_settings_sensitivity__lrg_combined__w_desi_default_ms_off_y1bins_metrics.json`

再現：
- `python -B scripts/cosmology/cosmology_bao_catalog_peakfit_settings_sensitivity.py --sample lrg --caps combined --out-tag w_desi_default_ms_off_y1bins`

影響ファイル：
- `scripts/cosmology/cosmology_bao_catalog_peakfit_settings_sensitivity.py`（追加）
- `doc/paper/10_manuscript.md` / `doc/paper/01_figures_index.md` / `doc/ROADMAP.md` / `doc/STATUS.md`


---

## 2026-01-18（UTC） Phase 4 / Step 4.5B.21.4.4.4.5：DESI（y1bins）の jackknife cov を Table 1/スコアボードへ反映

目的：
- diag（paircount proxy）に依存していた DESI LRG の ε 評価を、catalog-based sky jackknife cov（dv+cov）で再評価し、Table 1 と総合スコアボードへ反映する。

実施：
- Table 1（`scripts/summary/paper_tables.py`）の DESI 行を、`w_desi_default_ms_off`（単一 z_eff）から `w_desi_default_ms_off_y1bins`（LRG1/LRG2）へ切替し、jackknife peakfit を採用。
- 総合スコアボード（`scripts/summary/validation_scoreboard.py`）の DESI 参照を、y1bins jackknife の metrics に更新。
- ε_expected cross-check（`scripts/cosmology/cosmology_desi_dr1_bao_y1data_eps_crosscheck.py`）の既定 peakfit を jackknife に更新し、図を再生成。
- 論文本文（`doc/paper/10_manuscript.md`）へ jackknife cov の位置づけと図を追記。

主な出力：
- `output/cosmology/cosmology_bao_catalog_peakfit_lrg_combined__w_desi_default_ms_off_y1bins__jk_cov_both.(png|json)`
- `output/cosmology/cosmology_desi_dr1_bao_y1data_eps_crosscheck__w_desi_default_ms_off_y1bins.(png|json)`

再現：
- cross-check 再生成：
  - `python -B scripts/cosmology/cosmology_desi_dr1_bao_y1data_eps_crosscheck.py --out-tag w_desi_default_ms_off_y1bins`
- Table 1 / スコアボード / 論文/一般レポート再生成：
  - `python -B scripts/summary/run_all.py --offline`

次：
- Step 4.5B.21.4.4.5：DESI LRG2 の不一致要因を切り分け（peakfit設定/座標化仕様/定性的指標）。


---

## 2026-01-18（UTC） Phase 4 / Step 4.5B.21.4.4.3：DESI の diag=screening を Table 1/本文へ固定（cov未特定）

目的：
- DESI DR1 について、公開 multipoles/cov（fitに使う形）が未特定の状況でも「diag peakfit は screening（暫定）」であることを、Table 1 と本文で明確化して議論のブレを防ぐ。
- ε_expected cross-check の z_score の読み方（公開誤差のみ vs 合成誤差）を固定し、過信/過小評価を避ける。

変更：
- `scripts/summary/paper_tables.py`
  - DESI（LRG; combined）の Table 1 行に `cov=diag（screening）` を明示（技術欄/かんたん解釈欄）。
- `doc/paper/10_manuscript.md`
  - `z_score_vs_y1data`（Δε/σ_expected）と `z_score_combined`（Δε/√(σ_expected²+σ_fit_diag²)）の定義と参照方針（保守的に combined）を追記。
- `doc/ROADMAP.md`
  - 4.5B.21.4.4.3 を小項目化して完了扱い（次の現在地を 4.5B.21.4.4.1.3 へ）。

出力（更新）：
- `output/summary/paper_table1_results.(md|json|csv)`
- `output/summary/pmodel_paper.(html|docx)`
- `output/summary/pmodel_public_report.(html|docx)`

再現：
- `python -B scripts/summary/run_all.py --offline`

次：
- Step 4.5B.21.4.4.1.3：DESI 公開 multipoles/cov（測定ベクトル＋共分散; fit用）の一次ソースを特定し、overlay で切り分けを可能にする。


---

## 2026-01-18（UTC） Phase 4 / Step 4.5B.21.4.4.2.2-4.4.3：DESI 公開 multipoles/cov 探索の固定と ε cross-check 指標の更新

目的：
- DESI DR1（LRG1/LRG2）について、BAO一次統計（ξℓ）を公開 multipoles/cov（一次ソース）へ寄せて確証するために、公開領域から「測定ベクトル＋共分散（fitに使う形）」の所在を特定する。
- 公開 multipoles/cov が見つからない場合でも、distance 指標（D_M/r_d, D_H/r_d）の公開 mean/cov から `ε_expected` を算出し、catalog-based の ε と比較できるように指標の扱いを明確化する。

実施：
- DESI data portal（DR1 VAC）で公開されている可能性の高い領域（`bao-cosmo-params` / `full-shape-cosmo-params`）を directory listing crawl で探索し、候補ファイル（xi/pk/multipole/cov 等）を抽出。
  - 結果：探索範囲では候補 0（公開 multipoles/cov は未特定）。
- 探索ログを固定：`doc/cosmology/DESI_PUBLISHED_2PT_PRODUCTS.md`
- `scripts/cosmology/cosmology_desi_dr1_bao_y1data_eps_crosscheck.py` を更新し、差分の z_score を
  - `z_score_vs_y1data`（ε_expected の誤差のみ）と
  - `z_score_combined`（ε_expected ⊕ peakfit(diag) の合成誤差）
  の両方で併記するように変更。
- 論文：`doc/paper/10_manuscript.md` に「公開 multipoles/cov が未特定のため、現状は ε_expected cross-check を主軸にする」旨を追記。
- ロードマップ：`doc/ROADMAP.md` の現在地を `4.5B.21.4.4.3` に更新（2.2 は「未公開扱いで固定」完了）。

主な出力：
- `doc/cosmology/DESI_PUBLISHED_2PT_PRODUCTS.md`
- `output/cosmology/desi_public_2pt_discovery_bao_params.json`
- `output/cosmology/desi_public_2pt_discovery_full_shape_params.json`
- `output/cosmology/cosmology_desi_dr1_bao_y1data_eps_crosscheck__w_desi_default_ms_off_y1bins_metrics.json`

再現：
- 探索（候補URL抽出のみ）：
  - `python -B scripts/cosmology/discover_desi_public_2pt_products.py --roots "https://data.desi.lbl.gov/public/dr1/vac/dr1/bao-cosmo-params/v1.0/" --max-depth 3 --max-dirs 120 --timeout-sec 15 --out-json output/cosmology/desi_public_2pt_discovery_bao_params.json`
  - `python -B scripts/cosmology/discover_desi_public_2pt_products.py --roots "https://data.desi.lbl.gov/public/dr1/vac/dr1/full-shape-cosmo-params/v1.0/" --max-depth 3 --max-dirs 120 --timeout-sec 15 --out-json output/cosmology/desi_public_2pt_discovery_full_shape_params.json`
- ε cross-check：
  - `python -B scripts/cosmology/cosmology_desi_dr1_bao_y1data_eps_crosscheck.py --out-tag w_desi_default_ms_off_y1bins`

次：
- Step 4.5B.21.4.4.3（継続）：published multipoles/cov が無い前提で、diag（paircount proxy）を「screening」として扱うルール（スコア/本文/図の読み方）を明確化する。


---

## 2026-01-18（UTC） Phase 4 / Step 4.5B.21.4.4.1.2：DESI DR1 BAO（公開 mean/cov）を `bao_data` から固定キャッシュ

目的：
- DESI DR1 の BAO 距離指標（D_M/r_d, D_H/r_d 等）について、「TeX表の転記値」だけに依存せず、**公式が案内する公開 mean/cov（Gaussian BAO likelihood）**をローカルに固定する。
- 以後の ε_expected 計算・スコア評価で、**相関つき 2×2 cov** を同一一次ソースとして参照できるようにする（議論のブレ防止）。

一次ソース：
- DESI Data Portal（DR1 BAO cosmology results のデータ説明）：
  - `https://data.desi.lbl.gov/doc/releases/dr1/vac/bao-cosmo-params/`（Accessed: 2026-01-18）
- 公開 mean/cov（Gaussian BAO likelihood）：
  - `https://github.com/CobayaSampler/bao_data`（files: `desi_2024_gaussian_bao_*_mean.txt` / `*_cov.txt`）

変更：
- 公開 mean/cov の取得・固定キャッシュを追加：
  - `scripts/cosmology/fetch_desi_dr1_bao_bao_data.py`
  - raw保存：`data/cosmology/sources/bao_data/`
  - 解析用JSON：`data/cosmology/desi_dr1_bao_bao_data.json`
- cross-check のメタ情報強化：
  - `scripts/cosmology/cosmology_desi_dr1_bao_y1data_eps_crosscheck.py` に `bao_data` の読み込みと **Y1data（TeX）との数値整合（source_consistency）**を追加（必要なら `--prefer-bao-data` で一次ソースを切替可能）。
- 論文本文へ一次ソース所在を追記：
  - `doc/paper/10_manuscript.md`（DESI BAO の段落に `bao_data` キャッシュを明記）

主な出力：
- `data/cosmology/desi_dr1_bao_bao_data.json`
- `data/cosmology/sources/bao_data/`（DESI DR1: mean/cov txt）
- `output/cosmology/cosmology_desi_dr1_bao_y1data_eps_crosscheck__w_desi_default_ms_off_y1bins_metrics.json`（source_consistency を含む）

再現：
- fetch（online）：
  - `python -B scripts/cosmology/fetch_desi_dr1_bao_bao_data.py`
- ε_expected cross-check（offline）：
  - `python -B scripts/cosmology/cosmology_desi_dr1_bao_y1data_eps_crosscheck.py --out-tag w_desi_default_ms_off_y1bins`
- 論文/一般レポート再生成：
  - `python -B scripts/summary/run_all.py --offline`


---

## 2026-01-18（UTC） Phase 4 / Step 4.5B.21.4.4：DESI DR1 BAO（一次ソース）へ寄せる準備（Y1data cache + ε cross-check）

目的：
- DESI の BAO「圧縮出力」を観測事実として扱うのではなく、一次ソース（公開テーブル/共分散/統計量）へ寄せて比較可能な形にする。
- その入口として、DESI BAO VI の **Y1data（D_M/r_d, D_H/r_d, corr）**をキャッシュし、LRG1/LRG2 の z-bin で **ε_expected（一次ソース）**と **catalog peakfit ε（diag）**を同一指標で突き合わせる。

実施：
- DESI BAO VI（arXiv:2404.03002v3）ソースから、表 `tab:Y1data` を抽出して JSON にキャッシュ：
  - `scripts/cosmology/fetch_desi_dr1_bao_y1data.py` → `data/cosmology/desi_dr1_bao_y1data.json`
- DESI DR1 LRG の LRG1/LRG2 bin（0.4–0.6 / 0.6–0.8）で、銀河+random → ξ(s,μ)→ξℓ を再計算（WSL/Corrfunc; threads=24）：
  - out_tag：`w_desi_default_ms_off_y1bins`
  - dist：lcdm / pbg
- ξℓ→peakfit（diag）を同じ out_tag に対して実行：
  - `scripts/cosmology/cosmology_bao_catalog_peakfit.py`
- Y1data（2×2相関つき）から ε_expected を算出し、catalog peakfit ε と比較する cross-check 図を追加：
  - `scripts/cosmology/cosmology_desi_dr1_bao_y1data_eps_crosscheck.py`
  - 出力：`output/cosmology/cosmology_desi_dr1_bao_y1data_eps_crosscheck__w_desi_default_ms_off_y1bins.png`
- 論文化の該当節に図を追記：
  - `doc/paper/10_manuscript.md` / `doc/paper/01_figures_index.md`

主な出力：
- `data/cosmology/desi_dr1_bao_y1data.json`
- `output/cosmology/cosmology_bao_xi_from_catalogs_lrg_combined_{lcdm,pbg}_zmin0p4_zmax0p6__w_desi_default_ms_off_y1bins.*`
- `output/cosmology/cosmology_bao_xi_from_catalogs_lrg_combined_{lcdm,pbg}_zmin0p6_zmax0p8__w_desi_default_ms_off_y1bins.*`
- `output/cosmology/cosmology_bao_catalog_peakfit_lrg_combined__w_desi_default_ms_off_y1bins.*`
- `output/cosmology/cosmology_desi_dr1_bao_y1data_eps_crosscheck__w_desi_default_ms_off_y1bins.*`

再現：
- Y1data 抽出：
  - `python -B scripts/cosmology/fetch_desi_dr1_bao_y1data.py`
- ξℓ（WSL/Corrfunc; threads=24）：
  - `wsl -d Ubuntu-24.04 -- bash -lc "cd /mnt/c/develop/waveP && OMP_NUM_THREADS=24 .venv_wsl/bin/python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --data-dir data/cosmology/desi_dr1_lss --sample lrg --caps combined --random-kind random --dist {lcdm|pbg} --weight-scheme desi_default --z-min 0.4 --z-max 0.6 --match-sectors off --threads 24 --out-tag w_desi_default_ms_off_y1bins"`
  - `wsl -d Ubuntu-24.04 -- bash -lc "cd /mnt/c/develop/waveP && OMP_NUM_THREADS=24 .venv_wsl/bin/python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --data-dir data/cosmology/desi_dr1_lss --sample lrg --caps combined --random-kind random --dist {lcdm|pbg} --weight-scheme desi_default --z-min 0.6 --z-max 0.8 --match-sectors off --threads 24 --out-tag w_desi_default_ms_off_y1bins"`
- peakfit（diag）：
  - `python -B scripts/cosmology/cosmology_bao_catalog_peakfit.py --sample lrg --caps combined --dists lcdm,pbg --cov-source diag --out-tag w_desi_default_ms_off_y1bins`
- ε_expected cross-check：
  - `python -B scripts/cosmology/cosmology_desi_dr1_bao_y1data_eps_crosscheck.py --out-tag w_desi_default_ms_off_y1bins`

次：
- Step 4.5B.19.1：pre-recon ξℓ（lcdm/pbg）を再計算し、recon依存の切り分けへ進む。


---

## 2026-01-18（UTC） Phase 4 / Step 4.5B.21.4.4.4：DESI peakfit を dv+cov へ（jackknife cov）着手

目的：
- DESI DR1 の公開 multipoles/cov（fitに使う測定ベクトル＋共分散）が未特定の状況でも、`cov=diag(screening)` から一段進めて peakfit を dv+cov（非対角）で評価できる入口を作る。
- ε の議論が「理論差」ではなく「cov推定差」でブレないよう、cov推定の I/F（region分割・dv順序・出力名）を先に固定する。

決定（I/F固定）：
- cov 代替の第一候補：sky jackknife
  - region 分割：RA の分位点で N領域（決定的・seed不要）
  - 手法：leave-one-out で ξℓ を再計算し、jackknife cov を算出
- 出力ファイル名：`output/cosmology/cosmology_bao_xi_from_catalogs_{tag}__jk_cov.npz`
  - `tag` は ξℓ の `.npz`（`cosmology_bao_xi_from_catalogs_{tag}.npz`）と同一（case単位で 1:1 対応）
  - dv の順序は `y=[xi0(s_bins), xi2(s_bins)]`（peakfitと一致）

変更（ドキュメント）：
- `doc/ROADMAP.md`
  - 4.5B.21.4.4.4（cov代替策）を 4.5B.21.4.4.4.1〜 に細分化し、進捗が追える形に整理。
- `doc/STATUS.md`
  - 現在地を Phase 4 / Step 4.5B.21.4.4.4 として明確化。

次：
- 4.5B.21.4.4.4.2：jackknife cov 生成スクリプトの実装（WSL/Corrfunc; threads=24）。
- 4.5B.21.4.4.4.3：`scripts/cosmology/cosmology_bao_catalog_peakfit.py` に `cov_source=jackknife` を追加し、dv+cov を入力として peakfit。


---

## 2026-01-19（UTC） 運用：run_all の標準実行を並列（--jobs 2）へ固定

実施：
- `AGENTS.md` / `doc/ROADMAP.md` / `doc/AI_CONTEXT_MIN.json` の入口コマンドを `python -B scripts/summary/run_all.py --offline --jobs 2` に統一。
- `python -B scripts/summary/run_all.py --offline --jobs 2` を実行し、論文/一般レポート（HTML/DOCX）を最新化。

主な出力：
- `output/summary/pmodel_public_report.html` / `output/summary/pmodel_public_report.docx`
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_paper.docx`
- `output/summary/run_all_status.json`


---

## 2026-01-19（UTC） 運用：run_all に安全な並列実行（--jobs）を追加

目的：
- `scripts/summary/run_all.py` の実行時間短縮（ただし信頼性最優先）。

変更：
- `scripts/summary/run_all.py` に `--jobs N` を追加（デフォルト1）。
  - 並列は「グループ（topic prefix）単位」で実行し、グループ内は従来どおり直列（依存関係の混入を避ける）。
  - ネットワークアクセスが必要なタスクはグローバルに直列化（過負荷・競合を避ける）。
  - 最終集計（freeze→Table 1→スコアボード→paper_html）は直列のまま維持。
- 並列実行時に `output/summary/work_history.jsonl` へ同時追記が起きても壊れないよう、`scripts/summary/worklog.py` に lockfile による排他を追加。

再現：
- 既定（従来）：`python -B scripts/summary/run_all.py --offline`
- 並列（例）：`python -B scripts/summary/run_all.py --offline --jobs 2`


---

## 2026-01-19（UTC） 一次ソース：MAST/JWSTスペクトル（x1d）を候補として明文化し、Phase 4へ追加

目的：
- 距離指標（ΛCDM由来の距離推定量）ではなく、**スペクトル一次データ**から「輝線のズレ→赤方偏移 z」を直接扱う入口を確保する。

変更：
- `doc/PRIMARY_SOURCES.md`：MAST/astroquery の項を具体化（JWST / dataproduct_type=spectrum / productSubGroupDescription=x1d、候補：GN-z11、JADES-GS-z14-0、LID-568）。
- `doc/ROADMAP.md`：Phase 4 に Step 4.6（JWST/MASTスペクトル一次データ）を追加（準備中）。
- `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`：上記の追加を反映。

次：
- Step 4.6 着手時に、`scripts/cosmology/fetch_mast_jwst_spectra.py` を実装し、`data/cosmology/mast/jwst_spectra/` にキャッシュして offline 再現を確保する。


---

## 2026-01-19（UTC） Phase 6 / Step 6.1：LLR拡張：NGLR-1（反射器）を追加（一次ソース→バッチ→Table 1/スコアボード）

目的：
- LLRの高精度化（mm級ターゲット）として **NGLR-1（nglr1）** を取り込み、既存の LLR パイプライン（EDC CRD→モデル→RMS集計）で再現可能にする。
- Table 1 / 総合スコアボードまで反映し、現状の立ち位置を「全検証の俯瞰」に載せる。

一次ソース：
- ILRS mission page（NGLR-1; Principal Axis-PA 座標）：
  - `https://ilrs.gsfc.nasa.gov/missions/satellite_missions/current_missions/ngl1_general.html`（Accessed: 2026-01-19）
- EDC（DGFI-TUM）CRD normal point（NGLR-1ディレクトリ）：
  - `https://edc.dgfi.tum.de/pub/slr/data/npt_crd_v2/nglr1/`（Accessed: 2026-01-19）

変更：
- 反射器カタログ：`nglr1` を追加（PA座標、km→m）。
  - `scripts/llr/fetch_reflector_catalog.py`
  - `data/llr/reflectors_de421_pa.json`
  - `data/llr/sources/ilrs_ngl1_general.html`（キャッシュ）
- EDCバッチ取得：`nglr1` を対象に追加し、既存manifestへ追記できる `--append` を追加。
  - `scripts/llr/fetch_llr_edc_batch.py`
  - `data/llr/llr_edc_batch_manifest.json`
- バッチ評価：少数点の `nglr1` を評価対象に含めるため、target別に min_points を緩和（default 30、nglr1のみcap=6）。
  - `scripts/llr/llr_batch_eval.py`
  - `output/llr/batch/llr_batch_metrics.csv`
  - `output/llr/batch/llr_batch_summary.json`
- 集計反映：Table 1 / 総合スコアボードに「LLR（NGLR-1）」行を追加。
  - `scripts/summary/paper_tables.py`
  - `scripts/summary/validation_scoreboard.py`

主要な数値（暫定）：
- `output/llr/batch/llr_batch_metrics.csv`（target=nglr1）より、RMS（SR+Tropo+Tide+Ocean）の中央値：
  - RMS≈21.48 ns → 距離換算≈3.218 m（N=24; station=APOL; 2025データ）

再現：
- 反射器カタログ更新（online/offline対応。offlineはキャッシュ必須）：
  - `python -B scripts/llr/fetch_reflector_catalog.py`
- EDCバッチ追記（manifestを壊さず追記）：
  - `python -B scripts/llr/fetch_llr_edc_batch.py --append --targets nglr1 --years 2025 --include-daily`
- LLRバッチ評価（HORIZONS の SSL 問題がある環境では最終手段として `HORIZONS_INSECURE=1`）：
  - `python -B scripts/llr/llr_batch_eval.py --time-tag-mode auto --min-points 30 --chunk 50`
- Table 1 / スコアボード：
  - `python -B scripts/summary/paper_tables.py`
  - `python -B scripts/summary/validation_scoreboard.py`
- 論文/一般レポート再生成（offline）：
  - `python -B scripts/summary/run_all.py --offline`


---

## 2026-01-19（UTC） 作業ルール：一次ソース参照先一覧を整備（MAST/astroquery を候補として追記）

目的：
- 一次ソース（観測そのもの / 一次論文ソース）の参照先URLが分散して議論がブレるのを防ぐ。
- 将来、宇宙観測の一次データが必要になったときの入口（例：JWSTスペクトルなど）を「候補」として明示しておく。

実施：
- 既存で利用している主要データポータル/配布元を `doc/PRIMARY_SOURCES.md` に集約（JPL Horizons / NAIF / ILRS+EDC / SDSS / DESI / GWOSC 等）。
- `AGENTS.md` に「一次ソース参照先は `doc/PRIMARY_SOURCES.md` を正とする」ルールを追加。
- 参考候補として MAST（NASA Mikulski Archive for Space Telescopes）/ astroquery の入口を追記（現時点では未使用）。

影響ファイル：
- `doc/PRIMARY_SOURCES.md`
- `AGENTS.md`

次：
- 新しい一次ソースを追加/変更した場合は、必ず `doc/WORK_HISTORY.md` に追記し、可能なら `data/<topic>/sources/` に raw をキャッシュして offline 再現へ寄せる。

---

## 2026-01-19（UTC） 運用：WORK_HISTORY を時系列整頓し、直近3ログ（RECENT）へ分離

目的：
- `doc/WORK_HISTORY.md` の並び順が崩れて参照が難しくなっていたため、UTC時系列（古→新）へ整頓する。
- AI 起動時に巨大な履歴を読まずに済むよう、直近3ログだけの軽量履歴を併設して ContextWindow 消費を抑える。

実施：
- `doc/WORK_HISTORY.md` の `## YYYY-MM-DD` ブロックを UTC日付順（古→新）に整列。
- `doc/WORK_HISTORY_RECENT.md`（直近3ログ）を追加。
- `scripts/summary/update_work_history_recent.py` を追加し、`doc/WORK_HISTORY_RECENT.md` を自動生成できる形にした。
- `AGENTS.md` に運用ルール（WORK_HISTORYは時系列／RECENT併用）を追記。

再現：
- `python -B scripts/summary/update_work_history_recent.py`

影響ファイル：
- `doc/WORK_HISTORY.md`
- `doc/WORK_HISTORY_RECENT.md`
- `scripts/summary/update_work_history_recent.py`
- `AGENTS.md`


---

## 2026-01-19（UTC） Phase 4 / Step 4.6：JWST/MAST x1d（スペクトル一次データ）の取得→キャッシュ→QC を導入

目的：
- 宇宙論（高赤方偏移）の議論を「距離指標（ΛCDM距離など）の二次産物」から切り離し、**一次データ（スペクトル）**をローカルにキャッシュして再現できる入口を作る。
- 将来、z推定（線同定）まで自動化するための「取得→キャッシュ→QC」基盤を固定する（z推定ロジックは次工程）。

一次ソース：
- MAST API（invoke）：`https://mast.stsci.edu/api/v0/invoke`（Accessed: 2026-01-19）
- MAST Download（file）：`https://mast.stsci.edu/api/v0.1/Download/file?uri=<dataURI>`（Accessed: 2026-01-19）

変更：
- JWST x1d（1D spectrum）取得・キャッシュ・QC：
  - `scripts/cosmology/fetch_mast_jwst_spectra.py`（新規）
  - キャッシュ：`data/cosmology/mast/jwst_spectra/manifest_all.json`（取得対象の集計）
  - QC図：`output/cosmology/jwst_spectra__jades_gs_z14_0__x1d_qc.png`（取得済みx1dの重ね描き）
- `scripts/summary/run_all.py` に optional task `cosmology_fetch_mast_jwst_spectra` を追加（offline QC；キャッシュがある場合のみ）。
- 一次ソース一覧：`doc/PRIMARY_SOURCES.md` の MAST 節に API と実装位置を追記。

メモ（取得可否）：
- JADES-GS-z14-0：JWST x1d が取得でき、FITS（BINTABLE）を astropy無しで読み出せることを確認。
- GN-z11：観測が見つかっても、proprietary 期間により x1d が 401（Unauthorized）で取得できないケースがある（release: 2026-04-09 UTC 相当）。manifest に「見つかったが取得不能」として記録。
- LID-568：target_name の exact match では観測が見つからない（別名/座標指定が必要な可能性）。

再現：
- online（取得＋キャッシュ；小さく試す）：
  - `python -B scripts/cosmology/fetch_mast_jwst_spectra.py --download-missing --max-obs 1`
- offline（キャッシュからQCのみ）：
  - `python -B scripts/cosmology/fetch_mast_jwst_spectra.py --offline`

影響ファイル：
- 追加：`scripts/cosmology/fetch_mast_jwst_spectra.py`
- 更新：`scripts/summary/run_all.py`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/PRIMARY_SOURCES.md`


---

## 2026-01-19（UTC） Phase 4 / Step 4.6.3：JWST/MAST x1d から z 推定（線候補→z候補）を追加（初版）

目的：
- 高赤方偏移の議論を「距離指標（ΛCDM距離など）の二次産物」から切り離し、**一次スペクトル（x1d）**から z を直接扱える形にする。
- まずは “半自動” でよいので、線候補と z 候補の一覧・診断図を固定出力し、手動検証/改良へ繋げる。

変更：
- `scripts/cosmology/fetch_mast_jwst_spectra.py` に `--estimate-z` を追加し、x1d（1D spectrum）から線候補→z候補を生成できるようにした。
  - 出力（固定名；例：JADES-GS-z14-0）：
    - `output/cosmology/jwst_spectra__jades_gs_z14_0__z_estimate.csv`
    - `output/cosmology/jwst_spectra__jades_gs_z14_0__z_estimate.json`
    - `output/cosmology/jwst_spectra__jades_gs_z14_0__z_diagnostic.png`
- `scripts/summary/public_dashboard.py` に JWST/MAST x1d のカードを追加（target別に local x1d / release / best z を一覧化）。
- `scripts/summary/run_all.py` の JWST/MAST タスクを `--offline --estimate-z` で実行するよう更新（キャッシュがある場合のみ）。
- 論文本文（2.5.2）に JWST/MAST x1d の節を追記し、QC図と z 推定（診断図/候補表）を参照するようにした。
  - 参照：`doc/paper/10_manuscript.md`
  - 図インデックスへ追加：`doc/paper/01_figures_index.md`

再現：
- JWST/MAST（offline；QC+z推定）：  
  - `python -B scripts/cosmology/fetch_mast_jwst_spectra.py --offline --estimate-z`
- 論文/一般レポート再生成（offline）：  
  - `python -B scripts/summary/run_all.py --offline --jobs 2`

影響ファイル：
- 更新：`scripts/cosmology/fetch_mast_jwst_spectra.py`
- 更新：`scripts/summary/public_dashboard.py`
- 更新：`scripts/summary/run_all.py`
- 更新：`doc/paper/10_manuscript.md`
- 更新：`doc/paper/01_figures_index.md`


---

## 2026-01-19（UTC） 運用：`doc/STATUS.md` を「最新結果＋次の作業」の最小サマリへ整理（毎回上書き）

目的：
- `doc/STATUS.md` に過去の更新メモが蓄積し、参照が重くなっていたため、役割を「最新の作業結果」と「次に行うべき作業」に限定する。
- 履歴は `doc/WORK_HISTORY.md`（完全版）/ `doc/WORK_HISTORY_RECENT.md`（直近3ログ）に集約し、STATUS は毎回 **上書き更新**で運用する。

変更：
- `doc/STATUS.md` を全面整理し、以下の最小構造へ統一：
  - 現在地（Phase/Step）
  - 最新の作業結果（要点）
  - 次にやること（最小）
  - 再現コマンド（入口）
  - 参照（最小）
- 運用ルールを `AGENTS.md` に追記（STATUS は最小サマリとして扱い、履歴の蓄積は WORK_HISTORY を正とする）。

影響ファイル：
- 更新：`doc/STATUS.md`
- 更新：`AGENTS.md`


---

## 2026-01-19（UTC） 運用：doc直下の未使用Markdownを `doc/old/` に退避（運用ファイルを絞り込み）

目的：
- `doc/` 直下に「今は運用しないMarkdown」が増えて見通しが悪くなっていたため、未使用分を `doc/old/` に退避して整理する。
- 日々の運用（更新対象）は、`doc/AI_CONTEXT_MIN.json` / `doc/STATUS.md` / `doc/WORK_HISTORY.md` / `doc/WORK_HISTORY_RECENT.md` / `doc/ROADMAP.md` / `doc/PRIMARY_SOURCES.md` を正として回す。

実施：
- `doc/old/` を作成し、以下を移動：
  - `doc/DECISIVE_PACK.md` → `doc/old/DECISIVE_PACK.md`
  - `doc/NEXT_STEPS.md` → `doc/old/NEXT_STEPS.md`
  - `doc/README.md` → `doc/old/README.md`
  - `doc/ROADMAP_legacy_20260114.md` → `doc/old/ROADMAP_legacy_20260114.md`
  - `doc/ROADMAP_source_p_model_roadmap_phase_step.md` → `doc/old/ROADMAP_source_p_model_roadmap_phase_step.md`
- `doc/ROADMAP.md` の参照先（source/legacy）を `doc/old/` へ更新。
- `AGENTS.md` に「運用ファイルの絞り込み」と「未使用は doc/old へ退避」のルールを追記。

再現：
- （フォルダ整理後）論文/一般レポート再生成（offline）：  
  - `python -B scripts/summary/run_all.py --offline --jobs 2`

影響ファイル：
- 追加：`doc/old/`（退避フォルダ）
- 更新：`doc/ROADMAP.md`
- 更新：`AGENTS.md`


---

## 2026-01-19（UTC） Phase 4 / Step 4.5：BAO一次統計の一次ソース=LSSを再強調し、DESI LSS raw（sha256）を固定

目的：
- Step 4.5（BAO一次統計）を「一次ソース＝LSS catalog（銀河+random）」の線で完走させる。
- DESI の distance constraints（D_M/r_d, D_H/r_d 等）は解析パイプライン＋fiducial（ΛCDM）を通した派生値のため、一次ソース扱いせず cross-check（参照）としてのみ用いる。
- DESI DR1 LSS の galaxy catalog を raw FITS と sha256 で固定し、再現性（入力の同一性）を強化する。

変更：
- `scripts/cosmology/fetch_desi_dr1_lss.py`：
  - 既に抽出NPZが存在しても、manifest の rows_total/row_bytes などを再構築できるようにした。
  - `--download-missing` 指定時は、NPZが存在しても galaxy raw FITS を保存し sha256 を記録できるようにした（randomはreservoir/streamで運用）。
- DESI DR1 LSS（LRG NGC/SGC galaxy）raw FITS を保存し、`data/cosmology/desi_dr1_lss/manifest.json` に sha256 を固定：
  - `data/cosmology/desi_dr1_lss/raw/LRG_NGC_clustering.dat.fits`
  - `data/cosmology/desi_dr1_lss/raw/LRG_SGC_clustering.dat.fits`
- 用語整理：
  - `doc/cosmology/DESI_PUBLISHED_2PT_PRODUCTS.md`：distance constraints を一次ソース扱いしない旨を明記。
  - `doc/ROADMAP.md`：Step 4.5 を「完了」へ更新し、DESIの distance constraints を「公開派生値（cross-check）」として位置づけ。
  - `doc/paper/10_manuscript.md`：同趣旨の表記へ更新。
- 図（DESI LRG1/LRG2）：`scripts/cosmology/cosmology_desi_dr1_bao_y1data_eps_crosscheck.py` の表記を「公開距離制約（派生）→ε_expected」へ更新し、PNG/metrics を再生成。
- `doc/astroquery_mast_usage.txt` を cp932 から UTF-8 へ変換（参照性改善）。

再現：
- DESI DR1 LSS（LRG; raw+extract）：  
  - `python -B scripts/cosmology/fetch_desi_dr1_lss.py --sample lrg --caps combined --download-missing --stream-missing --random-sampling reservoir --random-max-rows 2000000 --sampling-seed 0`
- DESI distance constraints cross-check（図の再生成）：  
  - `python -B scripts/cosmology/cosmology_desi_dr1_bao_y1data_eps_crosscheck.py`
- 論文/一般レポート再生成（offline）：  
  - `python -B scripts/summary/run_all.py --offline --jobs 2`

影響ファイル：
- 更新：`scripts/cosmology/fetch_desi_dr1_lss.py`
- 更新：`data/cosmology/desi_dr1_lss/manifest.json`
- 追加：`data/cosmology/desi_dr1_lss/raw/LRG_NGC_clustering.dat.fits`
- 追加：`data/cosmology/desi_dr1_lss/raw/LRG_SGC_clustering.dat.fits`
- 更新：`scripts/cosmology/cosmology_desi_dr1_bao_y1data_eps_crosscheck.py`
- 更新：`output/cosmology/cosmology_desi_dr1_bao_y1data_eps_crosscheck__w_desi_default_ms_off_y1bins.png`
- 更新：`output/cosmology/cosmology_desi_dr1_bao_y1data_eps_crosscheck__w_desi_default_ms_off_y1bins_metrics.json`
- 更新：`doc/cosmology/DESI_PUBLISHED_2PT_PRODUCTS.md`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/paper/10_manuscript.md`
- 更新：`doc/astroquery_mast_usage.txt`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`


---

## 2026-01-19（UTC） Phase 4 / Step 4.6.5：JWST/MAST x1d の手動線同定→z確定 I/F を実装（テンプレ追加）

目的：
- Step 4.6.5（線同定を確定し、z と不確かさ（統計＋系統）を固定）に向けて、**手動線同定ファイル**と**z確定出力**の再現可能な入口を用意する。
- 既存の「z候補（半自動）」に加え、「確定（手動）」の状態を `manifest_all.json` に集約し、スコアボードから可視化する。

変更：
- `scripts/cosmology/fetch_mast_jwst_spectra.py`：
  - `line_id.json`（手動線同定）テンプレを `--init-line-id` で作成。
  - `--confirm-z` を追加し、`line_id.json` に基づく z確定（統計＋系統の分離）出力を実装：
    - `output/cosmology/jwst_spectra__<target>__z_confirmed.json`
  - `manifest_all.json` へ `line_id` と `z_confirmed` を集約（スコアボードから参照可能に）。
  - 追加の保守用：`--peak-snr-fluxerr`（FLUX_ERROR を用いた追加閾値；既定は無効）
- `scripts/summary/validation_scoreboard.py`：JWST/MAST 行に `z確定` と `line_id` の集計を追加。
- `scripts/summary/run_all.py`：JWST/MAST を `--confirm-z --init-line-id` 付きで実行するよう更新。
- `doc/ROADMAP.md`：4.6.5.1（I/F実装）を完了として明記。
- `doc/paper/10_manuscript.md`：2.5.2 に `line_id.json` と `z_confirmed` の入口を追記。

生成/更新されたファイル（代表）：
- 追加：`data/cosmology/mast/jwst_spectra/gn_z11/line_id.json`
- 追加：`data/cosmology/mast/jwst_spectra/jades_gs_z14_0/line_id.json`
- 追加：`data/cosmology/mast/jwst_spectra/lid_568/line_id.json`
- 追加：`output/cosmology/jwst_spectra__gn_z11__z_confirmed.json`
- 追加：`output/cosmology/jwst_spectra__jades_gs_z14_0__z_confirmed.json`
- 追加：`output/cosmology/jwst_spectra__lid_568__z_confirmed.json`
- 更新：`data/cosmology/mast/jwst_spectra/manifest_all.json`

再現：
- JWST（offline；QC+z候補+z確定+テンプレ）：`python -B scripts/cosmology/fetch_mast_jwst_spectra.py --offline --estimate-z --confirm-z --init-line-id`
- 論文/一般レポート再生成（offline）：`python -B scripts/summary/run_all.py --offline --jobs 2`

影響ファイル：
- 更新：`scripts/cosmology/fetch_mast_jwst_spectra.py`
- 更新：`scripts/summary/validation_scoreboard.py`
- 更新：`scripts/summary/run_all.py`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/paper/10_manuscript.md`


---

## 2026-01-19（UTC） Phase 4 / Step 4.6.5：JADES-GS-z14-0 の z_confirmed（単線・暫定）を生成

目的：
- Step 4.6.5.2 を前進：JADES-GS-z14-0 の x1d から、手動線同定に基づく z確定（統計＋系統）を実際に生成する。

変更：
- `data/cosmology/mast/jwst_spectra/jades_gs_z14_0/line_id.json`：代表スペクトル（o004）と採用線（`[O III]5007` 単線）を記入。
- `scripts/cosmology/fetch_mast_jwst_spectra.py`：手動確定の centroid 推定を high-pass（短滑らか化−長滑らか化）ベースへ変更し、連続スペクトル傾きへの感度を低減。

結果（暫定）：
- `output/cosmology/jwst_spectra__jades_gs_z14_0__z_confirmed.json`：z≈14.169、σ_total≈0.040（統計＋系統）。
  - 系統は「波長サンプリングの下限（Δλ/2）」を floor として入れている（追加の校正系統は未導入）。
- `output/cosmology/jwst_spectra__jades_gs_z14_0__z_confirmed.png` / `output/cosmology/jwst_spectra__jades_gs_z14_0__z_confirmed_lines.csv`
- スコアボード：JWST/MAST 行の `z確定` が 1/3 へ更新（Table 1 には未投入）。

再現：
- JWST（offline；QC+z候補+z確定）：`python -B scripts/cosmology/fetch_mast_jwst_spectra.py --offline --estimate-z --confirm-z`
- 全再生成（offline）：`python -B scripts/summary/run_all.py --offline --jobs 2`

影響ファイル：
- 更新：`scripts/cosmology/fetch_mast_jwst_spectra.py`
- 更新：`data/cosmology/mast/jwst_spectra/jades_gs_z14_0/line_id.json`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`


---

## 2026-01-20（UTC） Phase 4 / Step 4.6.5.2：CEERS2-5429 の z_confirmed を「未採用（保留）」として確定（min_ok_spectra=2）

目的：
- MIRI/LRS端（13–14 µm）の単一スペクトル依存で z を「確定した扱い」にしてしまうことを避けるため、z_confirmed の採用条件を再現可能に固定する。

変更：
- `scripts/cosmology/fetch_mast_jwst_spectra.py`：confirm-z に `params.min_ok_spectra` を導入し、use=true の線が **Nスペクトル以上**で ok を満たすまで z_confirmed を採用しないルールを実装。
- `data/cosmology/mast/jwst_spectra/ceers2_5429/line_id.json`：`params.min_ok_spectra=2` を設定（複数スペクトル一致を要求）。

結果：
- `output/cosmology/jwst_spectra__ceers2_5429__z_confirmed.json`：ok=false（reason: insufficient_ok_spectra:2 got:1）として固定。z≈19.388 は参考値として保持し、CEERS2-5429 は「z未確定（保留）」扱いを確定した。

再現：
- CEERS2-5429（offline；z確定）：`python -B scripts/cosmology/fetch_mast_jwst_spectra.py --targets CEERS2-5429 --offline --confirm-z`

影響ファイル：
- 更新：`scripts/cosmology/fetch_mast_jwst_spectra.py`
- 更新：`data/cosmology/mast/jwst_spectra/ceers2_5429/line_id.json`
- 更新：`output/cosmology/jwst_spectra__ceers2_5429__z_confirmed.json`
- 更新：`output/cosmology/jwst_spectra__ceers2_5429__z_confirmed_lines.csv`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`


---

## 2026-01-19（UTC） Phase 4 / Step 4.6.5.2：z確定の線 centroid 測定を raw（局所ベースライン差）へ切替し、LID-568 の線同定を Hα として固定

目的：
- Step 4.6.5.2 の「線同定の確定」を進めるため、confirm_z の centroid 測定で高域フィルタ（HP）由来のリンギングに引っ張られる可能性を排除し、近接候補線の有無を一次データ（raw）で判定できるようにする。

変更：
- `scripts/cosmology/fetch_mast_jwst_spectra.py`：
  - `_measure_line_centroid` を raw flux の局所ベースライン差（trimmed median）で測定するように変更（HP由来の偽ピーク回避）。
  - `prior_sigma_um` と 3σガード、および prior-weighted な領域切り出しで「近接候補線の誤スナップ」を抑える。
- `data/cosmology/mast/jwst_spectra/lid_568/line_id.json`：notes を更新し、近接候補線（[N II]/[S II]6731）は raw では全スペクトルで `no_signal_over_baseline` となるため、現時点では単線 Hα として固定する旨を明記。
- `data/cosmology/mast/jwst_spectra/jades_gs_z14_0/line_id.json`：notes を更新し、候補線（Hβ/[O III]4959/Hα）は低SNR/散らばりが大きいため `use=false` を維持し、単線 `[O III]5007`（`use=true`）で固定する旨を明記。

結果：
- LID-568：
  - `output/cosmology/jwst_spectra__lid_568__z_confirmed.json` を更新（z≈4.4349, σ_total≈0.00136, χ²/dof≈1.20；Hαのみ use=true）。
  - `output/cosmology/jwst_spectra__lid_568__z_confirmed_lines.csv` で、近接候補線（[N II]/[S II]6731）が `no_signal_over_baseline` になることを確認。
- JADES-GS-z14-0：
  - `output/cosmology/jwst_spectra__jades_gs_z14_0__z_confirmed.json` を更新（z≈14.18, σ_total≈0.036, χ²/dof≈0.40；`[O III]5007` のみ use=true）。

影響ファイル：
- 更新：`scripts/cosmology/fetch_mast_jwst_spectra.py`
- 更新：`data/cosmology/mast/jwst_spectra/lid_568/line_id.json`
- 更新：`data/cosmology/mast/jwst_spectra/jades_gs_z14_0/line_id.json`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/paper/10_manuscript.md`


---

## 2026-01-19（UTC） Phase 4 / Step 4.6.5.2：JADES-GS-z14-0 の採用線（[O III]5007 + Hα）と除外ルール（SNR閾値）を固定

目的：
- Step 4.6.5.2 のうち、JADES-GS-z14-0 の線同定を「暫定→固定」へ進め、再現可能な採否ルール（弱いスペクトルの除外）を `line_id.json` に明示して z_confirmed を安定化する。

変更：
- `scripts/cosmology/fetch_mast_jwst_spectra.py`：`line_id.json` の line entry に任意の閾値 `min_snr_integrated_proxy` / `min_peak_snr_fluxerr` を解釈し、閾値未満の測定は値を残したまま `ok=false`（z結合から除外）にする I/F を追加。
- `data/cosmology/mast/jwst_spectra/jades_gs_z14_0/line_id.json`：
  - 採用線を `[O III]5007` と Hα（離れた波長）に固定（`use=true`）。
  - `min_snr_integrated_proxy` を設定し、弱いスペクトル（例：o001）を自動除外。
  - `[O III]4959` は分解能上ブレンドしやすく二重カウントのリスクがあるため `use=false`（測定は残す）。
  - Hβ は低SNRのため `use=false` を維持。

結果：
- `output/cosmology/jwst_spectra__jades_gs_z14_0__z_confirmed.json` を更新（例：z≈14.218, σ_total≈0.035）。

影響ファイル：
- 更新：`scripts/cosmology/fetch_mast_jwst_spectra.py`
- 更新：`data/cosmology/mast/jwst_spectra/jades_gs_z14_0/line_id.json`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/paper/10_manuscript.md`


---

## 2026-01-19（UTC） Phase 4 / Step 4.6.5.2：GLASS-z12（公開ターゲット）を追加し、`[O III]5007` + Hα で z_confirmed を作成

目的：
- GN-z11 が未公開（release日が未来）で Step 4.6.5.2 が停滞しないよう、公開済みの JWST/MIRI スペクトルターゲット（GLASS-z12）を追加し、同じ手順（取得→QC→z推定→手動線同定→z確定）で z_confirmed を出力する。

実行：
- 取得（online）：`python -B scripts/cosmology/fetch_mast_jwst_spectra.py --targets GLASS-z12 --download-missing --include-previews --estimate-z --init-line-id`
- z確定（offline）：`python -B scripts/cosmology/fetch_mast_jwst_spectra.py --targets GLASS-z12 --offline --confirm-z`

結果（暫定）：
- MIRI/LRS（P750L; program 3703）の x1d を local に保存し、6.66 µm の強い輝線を `[O III]5007`（`use=true`）として採用、8.78 µm（Hα; `use=true`）でクロスチェックして z_confirmed を作成（例：z≈12.314, σ_total≈0.043）。
- 近接線（[O III]4959/Hβ/[N II]）は分解能上ブレンドしやすいため測定は残すが `use=false` を基本とする（z結合からは除外）。

主要出力：
- `output/cosmology/jwst_spectra__glass_z12__x1d_qc.png`
- `output/cosmology/jwst_spectra__glass_z12__z_estimate.csv`
- `data/cosmology/mast/jwst_spectra/glass_z12/line_id.json`
- `output/cosmology/jwst_spectra__glass_z12__z_confirmed.json`
- `output/cosmology/jwst_spectra__glass_z12__z_confirmed_summary.png`

影響ファイル：
- 更新：`scripts/cosmology/fetch_mast_jwst_spectra.py`（default targets に GLASS-z12 を追加）
- 更新：`data/cosmology/mast/jwst_spectra/targets.json`（GLASS-z12 を追加）
- 更新：`data/cosmology/mast/jwst_spectra/glass_z12/line_id.json`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/PRIMARY_SOURCES.md`
- 更新：`doc/paper/10_manuscript.md`
---

## 2026-01-19（UTC） Phase 4 / Step 4.6.5：z_confirmed を複数x1dでクロスチェック（multi-spectrum 対応）

目的：
- Step 4.6.5.2 を前進：単一スペクトルに依存しない形で z_confirmed を確定できるようにし、再現性と手動検証の足場を強化する。

変更：
- `scripts/cosmology/fetch_mast_jwst_spectra.py`：
  - `line_id.json` に `spectra: [...]`（複数x1d）を指定できるよう拡張し、各スペクトルで線測定→z を出した上で結合する（統計＋系統を分離）。
  - centroid 推定（confirm）を「high-pass（短滑らか化−長滑らか化）＋中心ヒント優先（Gaussian prior）＋連結領域」へ更新し、窓内で別ピークへ飛びにくくした。
  - 追加出力：`output/cosmology/jwst_spectra__<target>__z_confirmed_summary.png`（スペクトルごとの z を要約）。
- `data/cosmology/mast/jwst_spectra/jades_gs_z14_0/line_id.json`：o001〜o004 の p750l x1d を `spectra` に列挙し、`[O III]5007` 単線でクロスチェック。
- `doc/paper/10_manuscript.md`：z_confirmed の出力群（summary 図を含む）と、JWST を Table 1 に入れない方針（一次データ入口扱い）を明記。
- `doc/ROADMAP.md`：4.6.5.3（Table 1 再評価）を「不採用として固定」で完了へ。

結果（暫定）：
- `output/cosmology/jwst_spectra__jades_gs_z14_0__z_confirmed.json`：z≈14.158、σ_total≈0.037、χ²/dof≈1.03（4スペクトルの結合；単線）。
- `output/cosmology/jwst_spectra__jades_gs_z14_0__z_confirmed_summary.png`

再現：
- JWST（offline；z確定）：`python -B scripts/cosmology/fetch_mast_jwst_spectra.py --offline --confirm-z`
- 全再生成（offline）：`python -B scripts/summary/run_all.py --offline --jobs 2`

影響ファイル：
- 更新：`scripts/cosmology/fetch_mast_jwst_spectra.py`
- 更新：`data/cosmology/mast/jwst_spectra/jades_gs_z14_0/line_id.json`
- 更新：`doc/paper/10_manuscript.md`
- 更新：`doc/paper/01_figures_index.md`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`


---

## 2026-01-19（UTC） Phase 4 / Step 4.5：eBOSS LSS galaxy raw（sha256）固定と raw cache policy の明文化

目的：
- Step 4.5（BAO一次統計）の「一次入力＝LSS catalog（銀河+random）」を、eBOSS でも **raw（銀河）+sha256** で固定して再現性を上げる。
- random（GB級）は raw を保存しない運用を既定とし、reservoir（seed固定）の NPZ を一次入力として固定する。

変更：
- `scripts/cosmology/fetch_eboss_dr16_lss.py`：
  - `--download-galaxy-raw` を追加（random raw は影響しない）。
  - 既存の抽出NPZがある場合でも、manifest の `rows_total/rows_saved/row_bytes` 等を再構築できるようにした（raw無しでも cached NPZ を利用可能）。
  - local reservoir の `sampling` メタに `scan_max_rows` を含めるよう整理。
- eBOSS DR16 LSS（LRGpCMASS/QSO の NGC/SGC galaxy）raw FITS を保存し、`data/cosmology/eboss_dr16_lss/manifest.json` に sha256 を固定：
  - `data/cosmology/eboss_dr16_lss/raw/eBOSS_LRGpCMASS_clustering_data_rec-NGC-vDR16.fits`
  - `data/cosmology/eboss_dr16_lss/raw/eBOSS_LRGpCMASS_clustering_data_rec-SGC-vDR16.fits`
  - `data/cosmology/eboss_dr16_lss/raw/eBOSS_QSO_clustering_data-NGC-vDR16.fits`
  - `data/cosmology/eboss_dr16_lss/raw/eBOSS_QSO_clustering_data-SGC-vDR16.fits`
- `doc/cosmology/BAO_RECON_SPEC.md`：一次入力の raw cache policy（galaxyはraw+sha256、randomはreservoir NPZ）を §7.5.1 として追記。

再現：
- eBOSS DR16（LRGpCMASS recon；raw+manifest更新）：  
  - `python -B scripts/cosmology/fetch_eboss_dr16_lss.py --sample lrgpcmass_rec --caps combined --download-galaxy-raw --random-sampling reservoir --random-max-rows 2000000 --sampling-seed 0`
- eBOSS DR16（QSO；raw+manifest更新）：  
  - `python -B scripts/cosmology/fetch_eboss_dr16_lss.py --sample qso --caps combined --download-galaxy-raw --random-sampling reservoir --random-max-rows 2000000 --sampling-seed 0`
- 論文/一般レポート再生成（offline）：  
  - `python -B scripts/summary/run_all.py --offline --jobs 2`

影響ファイル：
- 更新：`scripts/cosmology/fetch_eboss_dr16_lss.py`
- 更新：`data/cosmology/eboss_dr16_lss/manifest.json`
- 追加：`data/cosmology/eboss_dr16_lss/raw/eBOSS_LRGpCMASS_clustering_data_rec-NGC-vDR16.fits`
- 追加：`data/cosmology/eboss_dr16_lss/raw/eBOSS_LRGpCMASS_clustering_data_rec-SGC-vDR16.fits`
- 追加：`data/cosmology/eboss_dr16_lss/raw/eBOSS_QSO_clustering_data-NGC-vDR16.fits`
- 追加：`data/cosmology/eboss_dr16_lss/raw/eBOSS_QSO_clustering_data-SGC-vDR16.fits`
- 更新：`doc/cosmology/BAO_RECON_SPEC.md`


---

## 2026-01-19（UTC） Phase 4 / Step 4.6.4：JWST/MAST x1d を論文・スコアボードへ組み込み（Table 1 は未投入）

目的：
- Step 4.6（JWST/MAST：スペクトル一次データ）の成果（x1d取得→QC→z候補）を、論文（2.5.2）と総合スコアボードへ反映する。
- 現時点の z推定は「線候補→z候補」の入口であり、線同定と系統評価が未確定のため、Table 1 の σ 判定には入れない（まずは“入口の再現性”を固定する）。

変更：
- `scripts/summary/validation_scoreboard.py`：
  - JWST/MAST（一次データ入口）の行（status=info）を追加。
  - 入力：`data/cosmology/mast/jwst_spectra/manifest_all.json`（QC/z推定の集約）
- `doc/paper/10_manuscript.md`：
  - 2.5.2 に、`manifest_all.json` での取得状況の集約と、z推定の注意点（手動検証が必要）を明記。
  - JWST は現時点では Table 1 に入れず、スコアボードは参考（取得状況）として扱う方針を固定。
- `doc/ROADMAP.md`：
  - 4.6.4 を「完了（初版）」へ更新し、次タスク 4.6.5（線同定と不確かさ固定→Table 1 再評価）を追加。

再現：
- スコアボード更新：`python -B scripts/summary/validation_scoreboard.py`
- JWST（offline；QC+z推定）：`python -B scripts/cosmology/fetch_mast_jwst_spectra.py --offline --estimate-z`
- 論文/一般レポート再生成（offline）：`python -B scripts/summary/run_all.py --offline --jobs 2`

影響ファイル：
- 更新：`scripts/summary/validation_scoreboard.py`
- 更新：`doc/paper/10_manuscript.md`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`


---

## 2026-01-19（UTC） Phase 4 / Step 4.5B.21.4.4.1.3.4：DESI 公開 dv+cov（multipoles/cov）の再探索（retry/backoff）と結論固定

目的：
- `cosmodesi/desi-kp-cosmological-likelihoods` が前提とする `data/likelihood`（測定ベクトル＋共分散; HDF5 等）が、DR1 公開導線で一次ソースとして確定できるかを再確認する。
- `data.desi.lbl.gov` が 504（Gateway Time-out）を返しやすく、探索が「未特定」と「探索失敗（偶発）」で混ざりやすいため、探索を再現可能な形で強化して結論を固定する。

変更：
- `scripts/cosmology/discover_desi_public_2pt_products.py`：
  - retry/backoff（HTTP 5xx/429 等）と Session 再利用を追加。
  - 既定探索 roots に `https://data.desi.lbl.gov/public/papers/y3/` を追加（DR2/3年の “papers bundle” 側も確認できるようにする）。
- DR1 VAC の cosmo-params（v1.0）を深めに再クロールし、探索結果（候補URL一覧）を保存：
  - `output/cosmology/desi_public_2pt_discovery_dr1_vac_bao_cosmo_params_v1p0_depth6.json`
  - `output/cosmology/desi_public_2pt_discovery_dr1_vac_full_shape_v1p0_depth6.json`
- 参考：DR2（Y3）側の “papers bundle” も浅く探索し、候補0を確認：
  - `output/cosmology/desi_public_2pt_discovery_papers_y3_bao_cosmo_params_depth4_dirs60.json`
- メモ・ロードマップ更新：
  - `doc/cosmology/DESI_PUBLISHED_2PT_PRODUCTS.md`
  - `doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`

結果：
- DR1 VAC（`bao-cosmo-params` / `full-shape-cosmo-params` v1.0）の再探索でも `candidates=0` で、BAO galaxies の “fit用 dv+cov（multipoles/cov; HDF5等）” を公開配布として一次ソースに確定できない。
- よって当面は「現状は公開dv+covなし」として扱い、一次統計（銀河+random）からの再構築＋jackknife dv+cov を正とする結論を固定した（探索ログ：`doc/cosmology/DESI_PUBLISHED_2PT_PRODUCTS.md`）。

再現：
- DR1 VAC（BAO cosmo-params; v1.0）：  
  - `python -B scripts/cosmology/discover_desi_public_2pt_products.py --roots "https://data.desi.lbl.gov/public/dr1/vac/dr1/bao-cosmo-params/v1.0/" --max-depth 6 --max-dirs 220 --timeout-sec 30 --retries 6 --retry-backoff-sec 2 --out-json output/cosmology/desi_public_2pt_discovery_dr1_vac_bao_cosmo_params_v1p0_depth6.json`
- DR1 VAC（Full-shape cosmo-params; v1.0）：  
  - `python -B scripts/cosmology/discover_desi_public_2pt_products.py --roots "https://data.desi.lbl.gov/public/dr1/vac/dr1/full-shape-cosmo-params/v1.0/" --max-depth 6 --max-dirs 220 --timeout-sec 30 --retries 6 --retry-backoff-sec 2 --out-json output/cosmology/desi_public_2pt_discovery_dr1_vac_full_shape_v1p0_depth6.json`
- DR2（Y3 papers bundle; bao-cosmo-params；浅い探索）：  
  - `python -B scripts/cosmology/discover_desi_public_2pt_products.py --roots "https://data.desi.lbl.gov/public/papers/y3/bao-cosmo-params/" --max-depth 4 --max-dirs 60 --timeout-sec 25 --retries 6 --retry-backoff-sec 2 --out-json output/cosmology/desi_public_2pt_discovery_papers_y3_bao_cosmo_params_depth4_dirs60.json`

影響ファイル：
- 更新：`scripts/cosmology/discover_desi_public_2pt_products.py`
- 更新：`doc/cosmology/DESI_PUBLISHED_2PT_PRODUCTS.md`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 追加：`output/cosmology/desi_public_2pt_discovery_dr1_vac_bao_cosmo_params_v1p0_depth6.json`
- 追加：`output/cosmology/desi_public_2pt_discovery_dr1_vac_full_shape_v1p0_depth6.json`
- 追加：`output/cosmology/desi_public_2pt_discovery_papers_y3_bao_cosmo_params_depth4_dirs60.json`


---

## 2026-01-19（UTC） Phase 4 / Step 4.6.5：`line_id.json` の `prior_sigma_um/use` 対応と z推定の代表スペクトル選択改善（JADES 更新）

目的：
- Step 4.6.5（線同定→z確定）の「手動検証」を前に進めるため、(1) 近接線の centroid 選択を安定化し、(2) 候補線を測定しつつ “z結合に入れる/入れない” を分離できるようにする。
- Step 4.6.3（z_estimate）の代表スペクトルが `mirimage_x1d` に偏って診断が混乱しやすいため、代表選択を改善する。

変更：
- `scripts/cosmology/fetch_mast_jwst_spectra.py`：
  - `--confirm-z`：line entry の `prior_sigma_um`（任意）を centroid 推定へ渡す。
  - `--confirm-z`：line entry の `use`（既定true）を導入し、`use=false` の線は測定だけ行い z結合から除外する。
  - `z_confirmed_summary.png` の per-spectrum z 集計も `use=true` の線のみで計算する（結合zと整合させる）。
  - `--estimate-z`：代表スペクトル選択で `mirimage_x1d` を避け、非mirimage を優先する。
- `data/cosmology/mast/jwst_spectra/jades_gs_z14_0/line_id.json`：候補線（Hβ/[O III]4959/Hα）は `use=false` として保持し、採用線は `[O III]5007`（`use=true`）のまま固定。

結果（暫定）：
- `output/cosmology/jwst_spectra__jades_gs_z14_0__z_confirmed.json`：z≈14.159、σ_total≈0.037（4スペクトル結合；採用線は `[O III]5007` のみ）。
- `output/cosmology/jwst_spectra__jades_gs_z14_0__z_estimate.json`：代表スペクトルは `*_p750l_x1d.fits` を優先するようになり、診断（z_diagnostic）と手動線同定の入口が一致する。

再現：
- JWST（offline；QC+z候補+z確定+テンプレ）：`python -B scripts/cosmology/fetch_mast_jwst_spectra.py --offline --estimate-z --confirm-z --init-line-id`
- 全再生成（offline）：`python -B scripts/summary/run_all.py --offline --jobs 2`

影響ファイル：
- 更新：`scripts/cosmology/fetch_mast_jwst_spectra.py`
- 更新：`data/cosmology/mast/jwst_spectra/jades_gs_z14_0/line_id.json`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`


---

## 2026-01-19（UTC） Phase 4 / Step 4.6.5.2：JWST/MAST の取得再現性強化（targets.json / unreleased guard / download堅牢化）

目的：
- Step 4.6.5.2（対象ごとの線同定→z確定）を進める前提として、MAST 側の「名前揺れ」「未公開（release日が未来）」「401/403/5xx」などで取得が止まった場合も、再現可能に状態を固定する。
- 特に GN-z11 は `t_obs_release_utc` が未来（2026-04-09）であり、取得不能（未公開）を manifest に明確に残す。
- LID-568 は target_name の exact match で観測が見つからないため、追加ヒント（別名/座標/追加filters）を入力できる導線を用意する。

変更：
- `scripts/cosmology/fetch_mast_jwst_spectra.py`：
  - `data/cosmology/mast/jwst_spectra/targets.json` を既定で読み、targetごとの `mast_target_name/aliases/position/extra_filters` を利用できるようにした（`--targets-config` でパス上書き可）。
  - 取得した obs に `t_obs_release_utc` に加え `is_released`（現在UTCのMJDと比較）を記録。
  - `--download-missing` 実行時、`is_released=false` の obs は `download_blocked_reason=not_released_yet` として download をスキップ（401連発を回避しつつ状態を固定）。
  - Download を 401/403/404/5xx/例外で落とさず `ok=false` として記録するように堅牢化。
- 追加：`data/cosmology/mast/jwst_spectra/targets.json`（LID-568 の座標/別名などを追記するための入力ファイル）

結果：
- GN-z11：`t_obs_release_utc=2026-04-09...` かつ `is_released=false` を manifest に固定し、`--download-missing` 実行でも `download_blocked_reason=not_released_yet` を記録できるようにした。
- LID-568：`target_name=LID-568` の exact match では `no_obs_found` のまま（次に `targets.json` へ別名/座標の追記が必要）。
- JADES-GS-z14-0：z_confirmed（z≈14.159, σ_total≈0.037）は維持（再計算で同値を確認）。

再現：
- JWST（online；manifest更新＋GN-z11の未公開スキップ確認）：`python -B scripts/cosmology/fetch_mast_jwst_spectra.py --targets GN-z11 --download-missing`
- JWST（offline；QC+z候補+z確定+テンプレ）：`python -B scripts/cosmology/fetch_mast_jwst_spectra.py --offline --estimate-z --confirm-z --init-line-id`

影響ファイル：
- 更新：`scripts/cosmology/fetch_mast_jwst_spectra.py`
- 追加：`data/cosmology/mast/jwst_spectra/targets.json`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`


---

## 2026-01-19（UTC） Phase 4 / Step 4.6.5.2：JADES-GS-z14-0 の候補線（Hβ/[O III]4959/Hα）を不採用として固定（use=false維持）

目的：
- Step 4.6.5.2 のうち、JADES-GS-z14-0 の候補線（Hβ/[O III]4959/Hα）を `use=true` に昇格できるかを確認し、現時点での採否を固定する。

結果：
- `output/cosmology/jwst_spectra__jades_gs_z14_0__z_confirmed_lines.csv` の測定では、候補線の z が `[O III]5007` と系統的に一致せず（線同定が未確定/有意でない可能性が高い）、現時点では `use=false` を維持する判断を固定した。
- したがって z_confirmed は `[O III]5007`（単線）による暫定値のまま維持（z≈14.159, σ_total≈0.037）。

変更：
- `data/cosmology/mast/jwst_spectra/jades_gs_z14_0/line_id.json`：候補線は測定はするが `use=false` を維持する旨を notes に追記。
- `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`：次タスクから「候補線の再評価」を外し、LID-568 の一次ソース確定へ優先度を移動。

影響ファイル：
- 更新：`data/cosmology/mast/jwst_spectra/jades_gs_z14_0/line_id.json`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`


---

## 2026-01-19（UTC） Phase 4 / Step 4.6.5.2：LID-568（LID568）の取得→z確定（Hα）と一次参照の固定

目的：
- Step 4.6.5.2 の対象候補のうち、LID-568 について「MAST 側の target_name/座標の揺れ」を解消し、local x1d を取得して z_estimate→手動線同定→z_confirmed まで到達する。

変更：
- `data/cosmology/mast/jwst_spectra/targets.json`：LID-568 の MAST 側 target_name（`LID568` / `LID568MIRI`）と座標（J2000; RA=149.6841, Dec=2.7356）と program 1760 を追記。
- `scripts/cosmology/fetch_mast_jwst_spectra.py`：`mast_target_name/aliases` を「最初に見つかった名前で打ち切り」せず、複数の target_name を **union** して obs を集約できるようにした（例：LID568 + LID568MIRI）。
- `data/cosmology/mast/jwst_spectra/lid_568/line_id.json`：NIRSpec/G395M の Hα を `use=true` として採用し、複数 x1d（8本）でクロスチェックして z を確定。候補線（[N II]/[S II]）は測定するが現時点では `use=false`。
- 一次参照の保存：LID-568 の座標確認に用いた Chandra 公開ページと、基礎論文（arXiv）を `data/cosmology/sources/` に保存。
  - `data/cosmology/sources/chandra_photo_album_lid568_20241104.html`
  - `data/cosmology/sources/arxiv_2405.05333.pdf`

結果（暫定）：
- local x1d を取得し、QC/候補/確定の固定出力を更新：
  - `output/cosmology/jwst_spectra__lid_568__x1d_qc.png`
  - `output/cosmology/jwst_spectra__lid_568__z_diagnostic.png`
  - `output/cosmology/jwst_spectra__lid_568__z_estimate.csv`（best: z≈4.435）
  - `output/cosmology/jwst_spectra__lid_568__z_confirmed.json`（Hα のみ use=true：z≈4.4345, σ_total≈0.00136, χ²/dof≈1.17）
  - `output/cosmology/jwst_spectra__lid_568__z_confirmed_summary.png`

再現：
- JWST（online；LID-568 を取得）：`python -B scripts/cosmology/fetch_mast_jwst_spectra.py --targets LID-568 --download-missing`
- JWST（offline；z候補+z確定）：`python -B scripts/cosmology/fetch_mast_jwst_spectra.py --targets LID-568 --offline --estimate-z --confirm-z`

影響ファイル：
- 更新：`scripts/cosmology/fetch_mast_jwst_spectra.py`
- 更新：`data/cosmology/mast/jwst_spectra/targets.json`
- 更新：`data/cosmology/mast/jwst_spectra/lid_568/line_id.json`
- 追加：`data/cosmology/sources/chandra_photo_album_lid568_20241104.html`
- 追加：`data/cosmology/sources/arxiv_2405.05333.pdf`
- 更新：`doc/PRIMARY_SOURCES.md`
- 更新：`doc/paper/10_manuscript.md`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`


---

## 2026-01-20（UTC） Phase 4 / Step 4.6.5.2：GLASS-z12（MIRI/LRS）の系統フロア導入と Hα+[N II] 複合を cross-check 扱いに固定

目的：
- GLASS-z12（MIRI/LRS）は分解能が低く、8.7–8.8 µm 付近（Hα+[N II]）がブレンドしてピークが複数立ちやすい。z確定の不確かさを過小評価しないよう、系統フロアを導入したうえで、z結合は安定な `[O III]5007` に固定し、Hα+[N II] は cross-check（use=false）として扱いを固定する。

変更：
- `data/cosmology/mast/jwst_spectra/glass_z12/line_id.json`：
  - `params.sigma_sys_um=0.035` を設定（MIRI/LRS 由来の centroid 系統フロア）。
  - `[O III]5007` は `prior_sigma_um=0.02` で 6.66 µm 側ピークに固定。
  - 8.7–8.8 µm 付近は Hα+[N II] 複合として `use=false`（cross-check）に変更し、`[N II]6548` / `[N II]6583` を追加。
- `python -B scripts/cosmology/fetch_mast_jwst_spectra.py --targets GLASS-z12 --offline --confirm-z` を実行し、出力を更新。

結果：
- `output/cosmology/jwst_spectra__glass_z12__z_confirmed.json`：z≈12.307、σ_total≈0.070、χ²/dof≈0.00（z結合は `[O III]5007` のみ use=true）。

再現：
- JWST（offline；GLASS-z12 の z確定）：`python -B scripts/cosmology/fetch_mast_jwst_spectra.py --targets GLASS-z12 --offline --confirm-z`

影響ファイル：
- 更新：`data/cosmology/mast/jwst_spectra/glass_z12/line_id.json`
- 更新：`output/cosmology/jwst_spectra__glass_z12__z_confirmed.json`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/paper/10_manuscript.md`


---

## 2026-01-20（UTC） Phase 4 / Step 4.6.5：confirm-z の局所ピーク選択を安定化（近傍点の強制混入を停止）し、JWST z_confirmed を更新

目的：
- MIRI/LRS などで近接ピーク（フリンジ等）が複数立つ場合、線 centroid 推定が「意図しない近傍ピーク」を混ぜて不安定になるため、workflow（手動 line_id）を崩さずにピーク選択を安定化する。

変更：
- `scripts/cosmology/fetch_mast_jwst_spectra.py`：confirm-z の centroid 推定で、閾値領域が2点以下のときに近傍点（±1 index）を強制混入する挙動を削除（近接ピーク混入の抑制）。

結果：
- JADES-GS-z14-0：`output/cosmology/jwst_spectra__jades_gs_z14_0__z_confirmed.json` が更新（z≈14.197、σ_total≈0.035、χ²/dof≈0.32）。
- GLASS-z12：`output/cosmology/jwst_spectra__glass_z12__z_confirmed.json` が更新（z≈12.307、σ_total≈0.070、χ²/dof≈0.00；`sigma_sys_um=0.035 µm`、z結合は `[O III]5007` のみ）。

再現：
- JWST（offline；対象のみ z確定）：`python -B scripts/cosmology/fetch_mast_jwst_spectra.py --targets JADES-GS-z14-0,LID-568,GLASS-z12 --offline --confirm-z`

影響ファイル：
- 更新：`scripts/cosmology/fetch_mast_jwst_spectra.py`
- 更新：`output/cosmology/jwst_spectra__jades_gs_z14_0__z_confirmed.json`
- 更新：`output/cosmology/jwst_spectra__glass_z12__z_confirmed.json`


---

## 2026-01-20（UTC） 運用：WORK_HISTORY/RECENT/STATUS/AI_CONTEXT を同期し、run_all（offline）を再生成

目的：
- `doc/WORK_HISTORY.md` の日付順（古→新）を確認し、直近ログ（RECENT）と最小状態辞書（AI_CONTEXT）を同期して、`run_all.py --offline --jobs 2` の成果物を再生成する。

変更：
- `doc/WORK_HISTORY.md`：2026-01-19/2026-01-20 のブロック順を整頓。
- `doc/WORK_HISTORY_RECENT.md`：`python -B scripts/summary/update_work_history_recent.py` を実行して更新。
- `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`：最終更新UTCを更新。
- `python -B scripts/summary/run_all.py --offline --jobs 2` を実行して、論文/一般向けレポート（HTML/DOCX）を再生成。

再現：
- RECENT更新：`python -B scripts/summary/update_work_history_recent.py`
- 全再生成（offline）：`python -B scripts/summary/run_all.py --offline --jobs 2`

影響ファイル：
- 更新：`doc/WORK_HISTORY.md`
- 更新：`doc/WORK_HISTORY_RECENT.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`output/summary/pmodel_public_report.html`
- 更新：`output/summary/pmodel_public_report.docx`
- 更新：`output/summary/pmodel_paper.html`
- 更新：`output/summary/pmodel_paper.docx`



---

## 2026-01-20（UTC） Phase 4 / Step 4.6.5：confirm-z に outlier clipping（max_z_pull）を追加し、RX_11027 の z_confirmed を更新（χ²/dof≈1 へ整合）

目的：
- RX_11027 の z_confirmed で、一部スペクトルの line centroid が明らかに不整合なケースが混ざり χ²/dof が高くなる問題を、手動の除外編集なしで再現可能に扱う。
- z候補に高z代替解（C IV + C III]）が出る点も含め、採用根拠を `line_id.json` に固定して議論がブレないようにする。

変更：
- `scripts/cosmology/fetch_mast_jwst_spectra.py`：confirm-z に `params.max_z_pull`（σ単位の outlier clipping）を追加し、use=true の ok line のうち z が外れ値の測定を z結合から除外できるようにした（`outlier_clipping` を JSON に記録）。
- `data/cosmology/mast/jwst_spectra/rx_11027/line_id.json`：
  - `params.max_z_pull=3` を設定し、outlier 1本が自動除外されることを確認。
  - 高z代替解の cross-check として C IV / C III]（use=false）を追加。
- `data/cosmology/mast/jwst_spectra/jades_10058975/line_id.json`：単一線マッチ優勢のため lines を空のまま維持し、保留理由を notes に固定。
- `doc/ROADMAP.md` / `doc/STATUS.md` / `doc/paper/10_manuscript.md` / `doc/PRIMARY_SOURCES.md`：RX_11027 の z と χ²/dof を更新し、outlier clipping の扱いを反映。

結果：
- RX_11027：`output/cosmology/jwst_spectra__rx_11027__z_confirmed.json` が更新（z≈2.4216, σ_total≈0.00107, χ²/dof≈1.01；outlier rejected_n=1）。
- `python -B scripts/summary/run_all.py --offline --jobs 2` を実行して、論文/一般向けレポート（HTML/DOCX）を再生成した（paper_lint: errors=0, warnings=0）。

再現：
- RX_11027（offline；z確定）：`python -B scripts/cosmology/fetch_mast_jwst_spectra.py --targets RX_11027 --offline --confirm-z`
- 全再生成（offline）：`python -B scripts/summary/run_all.py --offline --jobs 2`

影響ファイル：
- 更新：`scripts/cosmology/fetch_mast_jwst_spectra.py`
- 更新：`data/cosmology/mast/jwst_spectra/rx_11027/line_id.json`
- 更新：`data/cosmology/mast/jwst_spectra/jades_10058975/line_id.json`
- 更新：`output/cosmology/jwst_spectra__rx_11027__z_confirmed.json`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/PRIMARY_SOURCES.md`
- 更新：`doc/paper/10_manuscript.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`output/summary/pmodel_public_report.html`
- 更新：`output/summary/pmodel_public_report.docx`
- 更新：`output/summary/pmodel_paper.html`
- 更新：`output/summary/pmodel_paper.docx`


---

## 2026-01-20（UTC） Phase 4 / Step 4.6.5.2：CEERS2-5429（JWST/MIRI LRS P750L）を追加し、z_estimate→line_id→z_confirmed を試行

目的：
- GN-z11 が未公開で保留のため、公開済みの MIRI/LRS ターゲットを追加して Step 4.6.5.2（対象ごとの線同定→z固定）を前進させる。
- CEERS2-5429（program 3703）は z_estimate が z≈19.4（Hα + [S II]）を示唆するため、線同定（手動）→z確定の導線に接続する。

変更：
- 追加：`data/cosmology/mast/jwst_spectra/ceers2_5429/`（raw/manifest/line_id）
- `data/cosmology/mast/jwst_spectra/targets.json`：CEERS2-5429（proposal_id=3703, 座標）を追記。
- `data/cosmology/mast/jwst_spectra/ceers2_5429/line_id.json`：
  - `sigma_sys_um=0.035`（MIRI/LRS centroid 系統フロア）を導入。
  - `[S II]6716` を `use=true` とし、Hα/[S II]6731 は cross-check（use=false）として測定のみ残す。
- 実行：
  - online取得：`python -B scripts/cosmology/fetch_mast_jwst_spectra.py --targets CEERS2-5429 --download-missing --include-previews`
  - offline推定：`python -B scripts/cosmology/fetch_mast_jwst_spectra.py --targets CEERS2-5429 --offline --estimate-z --init-line-id`
  - offline確定：`python -B scripts/cosmology/fetch_mast_jwst_spectra.py --targets CEERS2-5429 --offline --confirm-z`

結果（暫定）：
- `output/cosmology/jwst_spectra__ceers2_5429__z_estimate.csv`：best は z≈19.376（Hα + [S II]）。
- `output/cosmology/jwst_spectra__ceers2_5429__z_confirmed.json`：z≈19.388、σ_total≈0.052（`sigma_sys_um=0.035` 支配）。ただし一部x1dでは SNR 閾値未達があり、扱いは保留（線同定・閾値の固定が次タスク）。

影響ファイル：
- 更新：`data/cosmology/mast/jwst_spectra/targets.json`
- 追加：`data/cosmology/mast/jwst_spectra/ceers2_5429/manifest.json`
- 追加：`data/cosmology/mast/jwst_spectra/ceers2_5429/line_id.json`
- 追加：`output/cosmology/jwst_spectra__ceers2_5429__x1d_qc.png`
- 追加：`output/cosmology/jwst_spectra__ceers2_5429__z_estimate.csv`
- 追加：`output/cosmology/jwst_spectra__ceers2_5429__z_confirmed.json`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`


---

## 2026-01-20（UTC） Phase 4 / Step 4.6.5.2：program 6073（NIRSpec/SLIT）ターゲット（RX_11027 / JADES_10058975）を反映し、run_all（offline）で自動更新されるようにした

目的：
- Step 4.6.5.2（対象ごとの線同定→z固定）を前進させるため、追加ターゲット（NIRSpec/SLIT）を運用・論文化出力と同期させる。
- `run_all.py --offline` で JWST ターゲットが漏れずに `manifest_all` / QC / z推定 / z確定が更新されるようにする。

変更：
- `scripts/cosmology/fetch_mast_jwst_spectra.py`：`--targets` の既定を `ALL`（`targets.json` の全キー）に変更し、`ALL/AUTO` を指定すると config のキー一覧を処理するようにした。
- `doc/ROADMAP.md` / `doc/STATUS.md` / `doc/paper/10_manuscript.md` / `doc/paper/01_figures_index.md` / `doc/PRIMARY_SOURCES.md`：RX_11027 と JADES_10058975 を追記。

結果：
- `python -B scripts/cosmology/fetch_mast_jwst_spectra.py --offline --estimate-z --confirm-z --init-line-id` を実行し、`data/cosmology/mast/jwst_spectra/manifest_all.json` を `targets.json` の全キーで再生成した。
- `python -B scripts/summary/run_all.py --offline --jobs 2` を実行して、論文/一般向けレポート（HTML/DOCX）を再生成した（paper_lint: errors=0, warnings=0）。
- RX_11027：`output/cosmology/jwst_spectra__rx_11027__z_confirmed.json` が ok=true（z≈2.4208, σ_total≈0.00107, χ²/dof≈3.79；`min_ok_spectra=2`）。
- JADES_10058975：`output/cosmology/jwst_spectra__jades_10058975__z_confirmed.json` は ok=false（reason: no_lines_selected）で、手動 line_id（採用線）の確定待ち。

再現：
- JWST（offline；全ターゲット）：`python -B scripts/cosmology/fetch_mast_jwst_spectra.py --offline --estimate-z --confirm-z --init-line-id`
- 全再生成（offline）：`python -B scripts/summary/run_all.py --offline --jobs 2`

影響ファイル：
- 更新：`scripts/cosmology/fetch_mast_jwst_spectra.py`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/PRIMARY_SOURCES.md`
- 更新：`doc/paper/10_manuscript.md`
- 更新：`doc/paper/01_figures_index.md`
- 更新：`output/summary/pmodel_public_report.html`
- 更新：`output/summary/pmodel_public_report.docx`
- 更新：`output/summary/pmodel_paper.html`
- 更新：`output/summary/pmodel_paper.docx`


---

## 2026-01-20（UTC） Phase 4 / Step 4.6.5.2：GNZ7Q の z_estimate を成立させるため、代表スペクトル選択を scoring 優先へ改良

目的：
- GNZ7Q は x1d が多数あり、ピーク数最大の長波長（mirifulong）を選ぶと `no_candidates_scored` で z候補が出ないケースがあった。
- 追加ターゲット運用（Step 4.6.5.2）を止めずに、z候補→line_id→confirm-z の導線を再現可能にする。

変更：
- `scripts/cosmology/fetch_mast_jwst_spectra.py`：z_estimate の代表スペクトル選択を「scoring が成立する x1d を優先（fallbackあり）」へ変更し、`z_estimate.json` に `spectrum_selection.tried`（各x1dの score_ok / best_z / n_matches / n_peaks 等）を記録するようにした。
- 実行（offline）：`python -B scripts/cosmology/fetch_mast_jwst_spectra.py --targets GNZ7Q --offline --estimate-z --init-line-id`

結果：
- `output/cosmology/jwst_spectra__gnz7q__z_estimate.json`：ok=true（best z≈13.64; matches=3）。`spectrum_used` は mirifushort を自動選択。
- `python -B scripts/summary/run_all.py --offline --jobs 2` を実行して、論文/一般向けレポート（HTML/DOCX）を再生成した。

影響ファイル：
- 更新：`scripts/cosmology/fetch_mast_jwst_spectra.py`
- 更新：`data/cosmology/mast/jwst_spectra/manifest_all.json`
- 更新：`output/cosmology/jwst_spectra__gnz7q__x1d_qc.png`
- 更新：`output/cosmology/jwst_spectra__gnz7q__z_diagnostic.png`
- 更新：`output/cosmology/jwst_spectra__gnz7q__z_estimate.csv`
- 更新：`output/cosmology/jwst_spectra__gnz7q__z_estimate.json`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`
- 更新：`doc/WORK_HISTORY_RECENT.md`
- 更新：`output/summary/pmodel_public_report.html`
- 更新：`output/summary/pmodel_public_report.docx`
- 更新：`output/summary/pmodel_paper.html`
- 更新：`output/summary/pmodel_paper.docx`

---

## 2026-01-20（UTC） Phase 4 / Step 4.5：DESI DR1 の dv+cov 一次プロダクト化（ロードマップ更新）

目的：
- Step 4.5（BAO一次統計）で、DESI DR1 を “screening” から “確証” へ昇格できる条件（一次プロダクト dv+cov → BAO fit（ε））を明確化する。
- 公式 multipoles/cov（fit用 dv+cov）の一次ソースが確定できない状況でも、手元の raw（full）から再現可能に dv+cov を自前生成し、fit可能な形で固定する方針をロードマップへ反映する。

変更：
- `doc/ROADMAP.md`：Step 4.5 を **進行中** に更新し、DESI DR1 の “一次プロダクト（fit可能な dv+cov）” 固定 → BAO fit（ε） → screening→確証判定 のサブステップ（`4.5B.21.4.4.6`）を追加。
  - 付随：`4.5B.21` / `4.5B.21.4` / `4.5B.21.4.4` のステータスを **進行中** に更新。
  - 付随：Table 1 の表現を「diag→dv+cov（ただし DESI は引き続き screening）」に修正。
- 入力確認：`data/cosmology/desi_dr1_lss/raw/` に、`LRG/QSO/BGS_BRIGHT/ELG_LOPnotqso` の NGC/SGC `.dat.fits` と random `0..17` `.ran.fits` が揃っていることを確認した。

結果：
- Step 4.5 の未完了点（DESI の screening→確証昇格）を、実装タスクとして追跡できる形に更新した。

影響ファイル：
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-22（UTC） Phase 4 / Step 4.7：DDRを「棄却」ではなく「距離指標前提に対する予測（必要補正）」として明文化し、論文へ反映

目的：
- Step 4.7（DDR再接続）の狙い（P-modelが間違っている/距離指標の前提が問題、の両解釈）を、論文本文のDDR記述へ反映し、
  「宇宙論で棄却」ではなく「距離指標前提に対する予測（必要補正）」として読める形に整理する。
- 代表の必要補正（α, s_L, s_R）を本文・図インデックスから辿れるようにし、再接続条件の一次出力と論文化の整合を取る。

変更：
- `doc/paper/10_manuscript.md`：
  - 2.5.3（宇宙論II）の DDR 部分で、「強く棄却」表現を「距離指標前提のままでは強い張力」へ置換し、(A)/(B) 両解釈を明記。
  - 5.3（反証条件）の DDR 部分でも同様に、前提依存であることと Step 4.7 の「必要補正」出力への接続を明確化。
  - `output/cosmology/cosmology_ddr_reconnection_conditions.png` を本文参照へ追加。
- `doc/paper/01_figures_index.md`：`output/cosmology/cosmology_ddr_reconnection_conditions.png` / metrics を図一覧へ追加。

実行：
- `python -B scripts/summary/run_all.py --offline --jobs 2`

生成/更新した主な出力：
- `output/summary/pmodel_public_report.html`
- `output/summary/pmodel_paper.html`

影響ファイル：
- 更新：`doc/paper/10_manuscript.md`
- 更新：`doc/paper/01_figures_index.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-22（UTC） Phase 4 / Step 4.5：DESI DR1 raw→ε fit の再現手順を doc に固定

目的：
- Step 4.5（DESI DR1）のユーザー依頼フロー（raw→ξ0/ξ2→cov→ε fit）を、参照先がローテーションする `doc/WORK_HISTORY_RECENT.md` ではなく固定ドキュメントへまとめ、再現手順の参照先を安定化する。

変更：
- 追加：`doc/cosmology/DESI_DR1_BAO_REPRO.md`（raw棚卸し→pycorr→Jackknife/RascalC→peakfit→cross-check のコマンドを固定）
- 更新：`doc/ROADMAP.md`（4.5B.21.4.4.6.0 の参照先を上記 doc へ差し替え）

実行：
- `python -B scripts/summary/update_work_history_recent.py`
- `python -B scripts/summary/run_all.py --offline --jobs 2`

生成/更新した主な出力：
- `output/summary/pmodel_public_report.html`
- `output/summary/pmodel_paper.html`

影響ファイル：
- 追加：`doc/cosmology/DESI_DR1_BAO_REPRO.md`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-22（UTC） Phase 4 / Step 4.7：DDR再接続の必要補正（α / s_L / s_R）を固定出力

目的：
- Step 4.7（DDR再接続）の「距離指標の前提（標準光源/標準定規/不透明度）」に対して、静的背景P最小（ε0=-1）を観測ε0へ再接続するのに必要な補正量を、各DDR制約ごとに一覧化する。
- 「棄却」だけで止めず、「前提に対する予測（必要補正）」として定量化した形へ接続する。

変更：
- 追加：`scripts/cosmology/cosmology_ddr_reconnection_conditions.py`
- 更新：`scripts/summary/run_all.py`（上記タスクを追加）
- 更新：`doc/ROADMAP.md`（Step 4.7 を進行中へ、4.7.4 の出力一覧へ追加）
- 更新：`doc/STATUS.md`（最新結果へ追加）

実行：
- `python -B scripts/summary/update_work_history_recent.py`
- `python -B scripts/summary/run_all.py --offline --jobs 2`

生成/更新した主な出力：
- `output/cosmology/cosmology_ddr_reconnection_conditions.png`
- `output/cosmology/cosmology_ddr_reconnection_conditions_metrics.json`

影響ファイル：
- 追加：`scripts/cosmology/cosmology_ddr_reconnection_conditions.py`
- 更新：`scripts/summary/run_all.py`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-22（UTC） Phase 4 / Step 4.7：DDR再接続条件の独立性分解（BAO/CMB使用・CDDR仮定）を追加

目的：
- Step 4.7.2/4.7.3（距離指標の前提検証）に向けて、DDR再接続に必要な補正（α / s_L / s_R）を「どの一次ソース群を“独立”とみなすか」で分解し、議論の混線（循環参照）を防ぐ。

変更：
- `scripts/cosmology/cosmology_ddr_reconnection_conditions.py`：
  - opacity / SNe Ia evolution の拘束を、BAO/CMB使用の有無・CDDR仮定の有無でサブセット化し、envelope を分解して図に重ねた。
  - 代表DDR（最小σ）に対して required α / s_L の “required vs constraint” z-score を metrics に追加。

実行：
- `python -B scripts/summary/update_work_history_recent.py`
- `python -B scripts/summary/run_all.py --offline --jobs 2`

生成/更新した主な出力：
- `output/cosmology/cosmology_ddr_reconnection_conditions.png`
- `output/cosmology/cosmology_ddr_reconnection_conditions_metrics.json`

影響ファイル：
- 更新：`scripts/cosmology/cosmology_ddr_reconnection_conditions.py`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-21（UTC） Phase 4 / Step 4.5B.21.4.4.7：DESI DR1（VAC）Lya QSO の multipoles射影に project_mode=mu_bin を追加し、band0 sweep で再評価

目的：
- DESI DR1 VAC（lya-correlations v1.0）の RP/RT グリッドは μ 分布が非一様になり得るため、従来の「s-bin内 WLS（xi≈xi0+xi2P2）」だと重み（NB/uniform）により ξ0/ξ2 が大きく動き得る。
- Corrfunc 由来の ξ(s,μ) と同様に、μ∈[0,1] の等間隔binへ一度圧縮してから（Riemann midpoint）で ξ0/ξ2 を計算する射影（mu_bin）を追加し、推定量の頑健性を改善する。

実行：
- 実装（project_mode 追加）：`scripts/cosmology/cosmology_bao_xi_from_desi_dr1_vac_lya_correlations.py`
  - 追加I/F：`--project-mode {wls,mu_bin}` / `--nmu <int>`（mu_bin の μ bin 数）
- ξ0/ξ2+cov（VAC; mu_bin; NB; lcdm/pbg）：  
  - `python -B scripts/cosmology/cosmology_bao_xi_from_desi_dr1_vac_lya_correlations.py --out-tag w_desi_vac_lya_corr_v1p0_mubin --project-mode mu_bin --nmu 120 --weight-mode nb`
- shrinkage sweep（VAC cov; band0; smooth=2）：  
  - `python -B scripts/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep.py --out-tag w_desi_vac_lya_corr_v1p0_mubin --sample lya_qso --caps combined --tracers "Lya QSO" --cov-source vac --cov-bandwidth-bins 0`
- 追加切り分け（broadband/smooth 感度）：  
  - `python -B scripts/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep.py --out-tag w_desi_vac_lya_corr_v1p0_mubin --sample lya_qso --caps combined --tracers "Lya QSO" --cov-source vac --cov-bandwidth-bins 0 --smooth-power-max 3`

結果（要点）：
- mu_bin により、Lya QSO（pbg）の z_score_combined は +1.2 程度（従来 wls; NB）から負側へ寄り、band0+smoothing の設定によっては |z|≈2.8〜2.9 まで到達するが、現状は **|z|≥3 を満たさない**（第二tracerにはならない）。
  - 代表：band0 + smooth3 で pbg の z_score_combined≈-2.79…-2.91（λ=0..1）。
- 一方で lcdm は |z|≈4（安定）となり、Lya は “pbg寄り/ lcdm張力” の傾向を示す（ただし推定量/モデル整合の議論は継続）。

生成/更新した主な出力：
- Lya QSO（mu_bin; NB）：
  - `output/cosmology/cosmology_bao_xi_from_catalogs_lya_qso_combined_lcdm_zmin1p77_zmax4p16__w_desi_vac_lya_corr_v1p0_mubin.npz`
  - `output/cosmology/cosmology_bao_xi_from_catalogs_lya_qso_combined_pbg_zmin1p77_zmax4p16__w_desi_vac_lya_corr_v1p0_mubin.npz`
  - `output/cosmology/cosmology_bao_xi_from_catalogs_lya_qso_combined_lcdm_zmin1p77_zmax4p16__w_desi_vac_lya_corr_v1p0_mubin__vac_cov.npz`
  - `output/cosmology/cosmology_bao_xi_from_catalogs_lya_qso_combined_pbg_zmin1p77_zmax4p16__w_desi_vac_lya_corr_v1p0_mubin__vac_cov.npz`
- sweep（band0; smooth3）：  
  - `output/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep__w_desi_vac_lya_corr_v1p0_mubin__vac_cov_band0_smooth3.csv`

影響ファイル：
- 更新：`scripts/cosmology/cosmology_bao_xi_from_desi_dr1_vac_lya_correlations.py`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-21（UTC） Phase 4 / Step 4.5B.21.4.4.7：LRG1/LRG2 の band0 sweep を追加し promotion gate を更新

目的：
- LRG1/LRG2（0.4<z<0.8; reservoir r0..17 mix）を second tracer 候補として追加し、band0（同一binのみ保持）で shrinkage λ 感度（jackknife/RascalC）を確認する。
- promotion_check に LRG1/LRG2 を追加し、昇格条件（min_tracers=2）を再評価する。

実行：
- shrinkage sweep（jackknife; band0; λ=0..1）：
  - `python -B scripts/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep.py --out-tag w_desi_default_ms_off_y1bins_reservoir_r0to17_mix --cov-source jackknife --cov-bandwidth-bins 0`
- shrinkage sweep（RascalC; band0; λ=0..1）：
  - `python -B scripts/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep.py --out-tag w_desi_default_ms_off_y1bins_reservoir_r0to17_mix --cov-source rascalc --cov-bandwidth-bins 0`
- promotion check（band0 の sweep csv を追加して再評価）：
  - `python -B scripts/cosmology/cosmology_desi_dr1_bao_promotion_check.py --csv output/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep__w_desi_default_ms_off_y1bins_lrg3elg1_reservoir_r0to17_mix_rescale__jk_cov_ra_dec_per_cap_unwrapped_n48_dec4_ra6_band0.csv --csv output/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep__w_desi_default_ms_off_y1bins_lrg3elg1_reservoir_r0to17_mix_rescale__rascalc_cov_nloops960_lps24_band0.csv --csv output/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep__w_desi_default_ms_off_y1bins_elg_reservoir_r0to17_mix__jk_cov_ra_dec_per_cap_unwrapped_n48_dec4_ra6_band0.csv --csv output/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep__w_desi_default_ms_off_y1bins_elg_reservoir_r0to17_mix__rascalc_cov_band0.csv --csv output/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep__w_desi_vac_lya_corr_v1p0__vac_cov_band0.csv --csv output/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep__w_desi_default_ms_off_y1bins_reservoir_r0to17_mix__jk_cov_band0.csv --csv output/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep__w_desi_default_ms_off_y1bins_reservoir_r0to17_mix__rascalc_cov_band0.csv`

結果（要点）：
- pbg の z_score_combined は LRG1≈+0.44…+0.56 / LRG2≈+0.21…+0.31（λ=0..1）で安定だが |z|≥3 を満たさず、昇格ゲートの第二tracerにはならない。
- promotion_check は promoted=false を維持（passing_tracers=[LRG3+ELG1] のみ）。

生成/更新した主な出力：
- `output/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep__w_desi_default_ms_off_y1bins_reservoir_r0to17_mix__jk_cov_band0.csv`
- `output/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep__w_desi_default_ms_off_y1bins_reservoir_r0to17_mix__rascalc_cov_band0.csv`
- `output/cosmology/cosmology_desi_dr1_bao_promotion_check.json`

影響ファイル：
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-21（UTC） Phase 4 / Step 4.5B.21.4.4.7：ROADMAP に DESI DR1 raw→dv+cov→ε fit の再現テンプレを追記

目的：
- ユーザ提供のローカル raw（`data/cosmology/desi_dr1_lss/raw/`）から dv=[ξ0,ξ2]+cov を自前生成し、BAO fit（ε）まで到達する作業手順を、ロードマップ（4.5B.21.4.4.7）に明文化して運用の正に固定する。
- `doc/ROADMAP.md` の「現在地（宣言）」を `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json` と一致させる。

実施：
- `doc/ROADMAP.md`：現在地（宣言）を Phase 4 / Step 4.5B.21.4.4.7 に更新。
- `doc/ROADMAP.md`：4.5B.21.4.4.7 に raw→dv+cov→ε fit の再現テンプレ（WSL コマンド含む）を追加。

結果（要点）：
- DESI DR1 raw→dv+cov→ε fit は Corrfunc/pycorr（WSL）+ jackknife/RascalC（WSL）+ peakfit（Python）で再現可能であることを、ロードマップ側に固定した。

影響ファイル：
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-21（UTC） Phase 4 / Step 4.5B.21.4.4.7：DESI DR1「Lya QSO（VAC）」の dv+cov→ε fit を追加し、promotion gate を再評価（未昇格）

目的：
- 昇格条件（複数tracerで pbg の |z_score_combined|≥3 が λ=0..1 で安定）を満たすため、保留だった Lya QSO を追加して再評価する。
- ローカル raw（銀河+random）では扱えない Lyα forest 系を、公開VACの一次プロダクトから peakfit 入口（ξ0/ξ2+cov）へ落として ε fit まで到達させる。

実装：
- `scripts/cosmology/cosmology_bao_xi_from_desi_dr1_vac_lya_correlations.py`：
  - VAC（DESI DR1 `lya-correlations` v1.0）の 2D 相関（RP/RT/DA）と full covariance（15000x15000）から、ξ0/ξ2 と cov（component-major blocks）を生成。
  - `_covariance_submatrix()` の out-of-bounds バグを修正（maskの作り方を修正）。
  - `estimator_spec_hash` を dist-invariant に修正（lcdm/pbg で peakfit が混在エラーにならないように）。
  - pbg 座標は RP/RT を bin の Z 列で評価した per-bin z の AP rescale として実装（近似）。
- `scripts/cosmology/cosmology_bao_xi_multipole_peakfit.py` / `scripts/cosmology/cosmology_bao_catalog_peakfit.py`：
  - multi-component dv（複数コンポーネント×[ξ0,ξ2]）を joint fit できるように拡張。
  - `--cov-source vac`（`__vac_cov.npz`）を追加。
  - banding / xi02-zero を multi-component ordering に一般化。
- `scripts/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep.py`：
  - `--cov-source vac` を追加（Lya QSO の sweep に対応）。

実行：
- ξ0/ξ2+cov 生成：`python -B scripts/cosmology/cosmology_bao_xi_from_desi_dr1_vac_lya_correlations.py`
- shrinkage sweep（vac cov; band0; λ=0..1）：  
  - `python -B scripts/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep.py --out-tag w_desi_vac_lya_corr_v1p0 --sample lya_qso --caps combined --tracers "Lya QSO" --cov-source vac --cov-bandwidth-bins 0`
- promotion gate 再評価：`python -B scripts/cosmology/cosmology_desi_dr1_bao_promotion_check.py --csv output/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep__*.csv ...`

結果（要点）：
- Lya QSO（vac cov; band0）：pbg の z_score_combined は ≈+1.18…+1.35（λ=0..1）で安定、lcdm は ≈+7.15…+7.52。
- 昇格判定（target_dist=pbg, |z|≥3, min_tracers=2）は **未達**（passing_tracers は LRG3+ELG1 のみ）を維持。

生成/更新した主な出力：
- `output/cosmology/cosmology_bao_xi_from_catalogs_lya_qso_combined_*_zmin1p77_zmax4p16__w_desi_vac_lya_corr_v1p0.npz`
- `output/cosmology/cosmology_bao_xi_from_catalogs_lya_qso_combined_*__w_desi_vac_lya_corr_v1p0__vac_cov.npz`
- `output/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep__w_desi_vac_lya_corr_v1p0__vac_cov_band0.csv` / `.png` / `.json`
- `output/cosmology/cosmology_desi_dr1_bao_promotion_check.json`（未昇格のまま更新）

影響ファイル：
- 更新：`scripts/cosmology/cosmology_bao_xi_from_desi_dr1_vac_lya_correlations.py`
- 更新：`scripts/cosmology/cosmology_bao_xi_multipole_peakfit.py`
- 更新：`scripts/cosmology/cosmology_bao_catalog_peakfit.py`
- 更新：`scripts/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep.py`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/PRIMARY_SOURCES.md`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-21（UTC） Phase 4 / Step 4.5B.21.4.4.7：DESI multi-tracer の昇格条件（複数tracer≥3σ）を band0 sweep から機械判定するゲートを追加

目的：
- Step 4.5B.21.4.4.7（DESI DR1 multi-tracer）の「screening→確証」昇格条件（複数tracerで ≥3σ）を、手作業でなく **再現可能に機械判定**できる入口を作る。
- band0 正則化（|Δs_bin|=0）の sweep 出力を材料に、cov_source（jackknife/RascalC）を跨いで安定に ≥3σ が出る tracer が何個あるかを固定する。

実装：
- `scripts/cosmology/cosmology_desi_dr1_bao_promotion_check.py`（新規）
  - 入力：`output/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep__*.csv`（band0; z_score_combined）
  - 出力：`output/cosmology/cosmology_desi_dr1_bao_promotion_check.json`

実行（例）：
- `python -B scripts/cosmology/cosmology_desi_dr1_bao_promotion_check.py --csv output/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep__w_desi_default_ms_off_y1bins_lrg3elg1_reservoir_r0to17_mix_rescale__jk_cov_ra_dec_per_cap_unwrapped_n48_dec4_ra6_band0.csv --csv output/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep__w_desi_default_ms_off_y1bins_lrg3elg1_reservoir_r0to17_mix_rescale__rascalc_cov_nloops960_lps24_band0.csv --csv output/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep__w_desi_default_ms_off_y1bins_elg_reservoir_r0to17_mix__jk_cov_ra_dec_per_cap_unwrapped_n48_dec4_ra6_band0.csv --csv output/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep__w_desi_default_ms_off_y1bins_elg_reservoir_r0to17_mix__rascalc_cov_band0.csv`

結果（要点）：
- 現状の band0 評価では passing_tracers は **LRG3+ELG1 のみ**で、昇格条件（min_tracers=2）を満たさず **未昇格**（promotion_check.json の `promoted=false`）。
- ボトルネックは Lya QSO がローカル raw に無いこと（Lyα forest 入力が必要）で、第二tracerを追加しない限り昇格判定が成立しない。

生成/更新した主な出力：
- `output/cosmology/cosmology_desi_dr1_bao_promotion_check.json`

影響ファイル：
- 追加：`scripts/cosmology/cosmology_desi_dr1_bao_promotion_check.py`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-21（UTC） Phase 4 / Step 4.5B.21.4.4.7：LRG3+ELG1 の RascalC cov を output-suffix（n_loops=960）で再生成し、band0 shrinkage sweep（smooth=2/3）で安定性を再評価

目的：
- LRG3+ELG1（0.8<z<1.1; reservoir r0..17 mix rescale）で、RascalC cov の「収束/保存（複数n_loops）」と、ε fit の正則化依存（shrinkage/xi02）を再現可能に切り分ける。

実装：
- `scripts/cosmology/cosmology_bao_xi_rascalc_cov_from_catalogs.py`：
  - `--output-suffix` を追加し、`...__<suffix>.npz` / `...__<suffix>_metrics.json` を出力可能にした（defaultは従来通り `rascalc_cov`）。
  - RascalC 実行ディレクトリを `output/cosmology/rascalc/<tag>/<output_suffix>/` に分離し、`pycorr_allcounts_cov.npy` は `<tag>/` に共通キャッシュするよう整理。
- `scripts/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep.py`：
  - `smooth_power_max!=2` の場合に reg_tag に `_smooth{p}` を付与し、出力衝突を防止。

実行：
- RascalC cov（WSL; n_loops=960, loops_per_sample=24; cov-suffix=rascalc_cov_nloops960_lps24）：
  - lcdm：`cosmology_bao_xi_rascalc_cov_from_catalogs.py --xi-metrics-json ...lcdm... --output-suffix rascalc_cov_nloops960_lps24 --n-loops 960 --loops-per-sample 24`
  - pbg：`cosmology_bao_xi_rascalc_cov_from_catalogs.py --xi-metrics-json ...pbg... --output-suffix rascalc_cov_nloops960_lps24 --n-loops 960 --loops-per-sample 24`
- shrinkage sweep（RascalC; band0; smooth=3）：
  - `python -B scripts/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep.py --out-tag w_desi_default_ms_off_y1bins_lrg3elg1_reservoir_r0to17_mix_rescale --sample lrg_elg_lopnotqso --caps combined --tracers "LRG3+ELG1" --smooth-power-max 3 --cov-source rascalc --cov-suffix rascalc_cov_nloops960_lps24 --cov-bandwidth-bins 0 --lams 0,0.2,0.4,0.6,0.8,1.0 --skip-existing`
  - xi02-zero 版も同様に実行（`--cov-zero-xi02`）。

結果（要点）：
- LRG3+ELG1（RascalC; band0; smooth=3）：pbg は λ≤0.4 で z≈-6.5 が出る一方、λ≥0.6 で z≈0.6〜0.7 に戻る（flip）。xi02-zero では z≈0.69 に固定 → cov02 が支配的系統になり得る。
- したがって、現状は「cov_source/正則化に対する安定」の条件を満たせず、DESI の位置づけは screening 維持。

生成/更新した主な出力：
- RascalC cov（例）：`output/cosmology/cosmology_bao_xi_from_catalogs_lrg_elg_lopnotqso_combined_pbg_zmin0p8_zmax1p1__w_desi_default_ms_off_y1bins_lrg3elg1_reservoir_r0to17_mix_rescale__rascalc_cov_nloops960_lps24.npz`
- sweep（RascalC; band0; smooth=3）：`output/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep__w_desi_default_ms_off_y1bins_lrg3elg1_reservoir_r0to17_mix_rescale__rascalc_cov_nloops960_lps24_band0_smooth3.png` / `.csv`
- sweep（RascalC; xi02-zero; band0; smooth=3）：`output/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep__w_desi_default_ms_off_y1bins_lrg3elg1_reservoir_r0to17_mix_rescale__rascalc_cov_nloops960_lps24_xi02zero_band0_smooth3.png` / `.csv`

影響ファイル：
- 更新：`scripts/cosmology/cosmology_bao_xi_rascalc_cov_from_catalogs.py`
- 更新：`scripts/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep.py`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-21（UTC） Phase 4 / Step 4.5B.21.4.4.7：DESI DR1 raw を棚卸しし、Lya QSO（Lyα forest）がローカル raw に含まれないことを固定

目的：
- “raw 内の対象セットを特定” を再現可能に固定し、Lya QSO の入力整備の前提（ローカル raw に含まれるか）を確定する。

実装：
- `scripts/cosmology/desi_dr1_lss_raw_inventory.py`（新規）

実行：
- `python -B scripts/cosmology/desi_dr1_lss_raw_inventory.py`

結果（要点）：
- `data/cosmology/desi_dr1_lss/raw` に含まれる samples は **BGS_BRIGHT / ELG_LOPnotqso / LRG / QSO** のみ（NGC/SGC、random_index=0..17）。
- “Lya QSO（1.77<z<4.16）”に相当する **Lyα forest 入力はこの raw セットに存在しない**ため、現状は保留（別入力の追加が必要）。加えて “Lya QSO” は Lyα forest auto + QSO cross を含む推定量であり、現行の point-tracer（銀河+random→ξℓ）パイプラインでは扱えない可能性が高い。

生成/更新した主な出力：
- `output/cosmology/desi_dr1_lss_raw_inventory_summary.json`
- `output/cosmology/desi_dr1_lss_raw_inventory.csv`

影響ファイル：
- 追加：`scripts/cosmology/desi_dr1_lss_raw_inventory.py`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-21（UTC） Phase 4 / Step 4.5B.21.4.4.7：ELG2 で band0 正則化の sweep（jackknife vs RascalC）を実行

目的：
- band0（同一binのみ保持）を暫定正則化として ELG2（1.1<z<1.6）へ展開し、cov_source/shrinkage に対して ε_fit−ε_expected の有意度が安定するかを確認する。

実行：
- jackknife（band0）：
  - `python -B scripts/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep.py --out-tag w_desi_default_ms_off_y1bins_elg_reservoir_r0to17_mix --sample elg_lopnotqso --caps combined --tracers "ELG2" --smooth-power-max 2 --cov-source jackknife --cov-bandwidth-bins 0 --lams 0,0.05,0.1,0.2,0.4,0.6,0.8,1.0 --skip-existing`
- RascalC（band0）：
  - `python -B scripts/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep.py --out-tag w_desi_default_ms_off_y1bins_elg_reservoir_r0to17_mix --sample elg_lopnotqso --caps combined --tracers "ELG2" --smooth-power-max 2 --cov-source rascalc --cov-bandwidth-bins 0 --lams 0,0.2,0.4,0.6,0.8,1.0 --skip-existing`

結果（要点）：
- jackknife（band0）：pbg は λ≤0.6 で z_score_combined≈-3.8 程度の棄却が出る一方、λ≥0.8（diagへ寄せ過ぎ）で z≈-0.45 に戻る → shrinkage に非頑健。
- RascalC（band0）：pbg は z_score_combined≈-0.54（λ=0..1）で整合 → cov_source に対して結論が割れるため確証には未到達。

生成/更新した主な出力：
- `output/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep__w_desi_default_ms_off_y1bins_elg_reservoir_r0to17_mix__jk_cov_band0.png` / `.csv`
- `output/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep__w_desi_default_ms_off_y1bins_elg_reservoir_r0to17_mix__rascalc_cov_band0.png` / `.csv`

影響ファイル：
- 更新：`scripts/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep.py`（matplotlib backend を Agg に固定）
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-21（UTC） Phase 4 / Step 4.5B.21.4.4.7：cov banding（band0）を導入し、LRG3+ELG1 で jackknife/RascalC の頑健性 sweep を実行

目的：
- DESI DR1（multi-tracer; LRG3+ELG1; 0.8<z<1.1）で、ε_fit−ε_expected が cov 推定/正則化に支配される問題を整理し、「確証判定」に耐える dv+cov の扱い（cov 正則化）を固定する。

実装：
- `scripts/cosmology/cosmology_bao_catalog_peakfit.py`：
  - full cov（jackknife/rascalc）に対し、dv=[ξ0,ξ2] の fit空間 |Δs_bin| による banding を追加：
    - `--cov-bandwidth-bins`（-1:無効, 0:同一binのみ保持）
    - `--cov-bandwidth-xi02-bins`（xi0-xi2 cross ブロックのみ帯域を上書き可能）
- `scripts/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep.py`：
  - `--cov-source (jackknife|rascalc)` / `--cov-suffix` / banding オプションを追加し、LRG3+ELG1 の (bandwidth, λ) 感度を sweep できるようにした。

実行（代表）：
- jackknife（ra×dec per-cap unwrapped; band0）：
  - `python -B scripts/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep.py --out-tag w_desi_default_ms_off_y1bins_lrg3elg1_reservoir_r0to17_mix_rescale --sample lrg_elg_lopnotqso --caps combined --tracers "LRG3+ELG1" --smooth-power-max 3 --cov-source jackknife --cov-suffix jk_cov_ra_dec_per_cap_unwrapped_n48_dec4_ra6 --cov-bandwidth-bins 0 --lams 0,0.1,0.2,0.4,0.6,0.8,1.0 --skip-existing`
- RascalC（band0）：
  - `python -B scripts/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep.py --out-tag w_desi_default_ms_off_y1bins_lrg3elg1_reservoir_r0to17_mix_rescale --sample lrg_elg_lopnotqso --caps combined --tracers "LRG3+ELG1" --smooth-power-max 3 --cov-source rascalc --cov-bandwidth-bins 0 --lams 0,0.2,0.4,0.6,0.8,1.0 --skip-existing`

結果（要点）：
- band0（同一binのみ保持）では、pbg は jackknife（ra×dec）で z_score_combined≈-5.2…-5.5（λ=0..1）と安定に棄却され、lcdm は z≈-0.77 で整合。
- RascalC（band0）でも pbg は λ≤0.6 で z_score_combined≈-6.5 が安定。一方 λ≥0.8（diag へ寄せ過ぎ）では pbg が z≈0 へ戻り得るため、過度な diag 化は避ける方針が妥当。
- よって「band0 を暫定正則化として採用し、他tracer（ELG2 等）にも展開して昇格条件（複数tracerで≥3σ）を満たすか」へ次段階。

生成/更新した主な出力：
- `output/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep__w_desi_default_ms_off_y1bins_lrg3elg1_reservoir_r0to17_mix_rescale__jk_cov_ra_dec_per_cap_unwrapped_n48_dec4_ra6_band0.png` / `.csv`
- `output/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep__w_desi_default_ms_off_y1bins_lrg3elg1_reservoir_r0to17_mix_rescale__rascalc_cov_band0.png` / `.csv`

影響ファイル：
- 更新：`scripts/cosmology/cosmology_bao_catalog_peakfit.py`
- 更新：`scripts/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep.py`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-21（UTC） Phase 4 / Step 4.5B.21.4.4.7：jackknife region を2D化（Dec×RA）し、LRG3+ELG1 で検証（cov02依存の継続）

目的：
- DESI DR1（LRG3+ELG1）で、jackknife cov の full off-diagonal が ε fit を支配する問題に対し、region 設計を 2D（Dec 分位点×RA 分位点）へ拡張して安定化できるか検証する。

実装：
- `scripts/cosmology/cosmology_bao_xi_jackknife_cov_from_catalogs.py`：
  - `--jk-mode ra_dec_quantile_per_cap_unwrapped` を追加（capごとに Dec 分位点で bands を作り、bandごとに RA を最大ギャップで unwrap→RA 分位点で region を割当）。
  - `--jk-dec-bands` / `--jk-ra-bins` を追加（未指定時は n_per_cap を因数分解して自動選択）。

実行（n_regions=48; dec=4, ra=6 / cap）：
- jackknife cov（WSL）：`--jk-mode ra_dec_quantile_per_cap_unwrapped --jk-n 48 --output-suffix jk_cov_ra_dec_per_cap_unwrapped_n48_dec4_ra6`
- peakfit（full cov; smooth=3）：`scripts/cosmology/cosmology_bao_catalog_peakfit.py --cov-source jackknife --cov-suffix jk_cov_ra_dec_per_cap_unwrapped_n48_dec4_ra6 --smooth-power-max 3`
- cross-check：`scripts/cosmology/cosmology_desi_dr1_bao_y1data_eps_crosscheck.py --tracers \"LRG3+ELG1\"`

結果（要点）：
- ra×dec full cov（λ=0）でも pbg の乖離は依然大きく（z_score_combined≈-10.4）、確証には未到達。
- 同じ cov で `--cov-zero-xi02` を入れると pbg は |z|≲2 へ戻る一方、lcdm が悪化し得る → cov02 を含む off-diagonal の扱いが引き続き支配的系統。

生成/更新した主な出力：
- `output/cosmology/cosmology_bao_xi_from_catalogs_lrg_elg_lopnotqso_combined_lcdm_zmin0p8_zmax1p1__w_desi_default_ms_off_y1bins_lrg3elg1_reservoir_r0to17_mix_rescale__jk_cov_ra_dec_per_cap_unwrapped_n48_dec4_ra6_metrics.json`
- `output/cosmology/cosmology_bao_xi_from_catalogs_lrg_elg_lopnotqso_combined_pbg_zmin0p8_zmax1p1__w_desi_default_ms_off_y1bins_lrg3elg1_reservoir_r0to17_mix_rescale__jk_cov_ra_dec_per_cap_unwrapped_n48_dec4_ra6_metrics.json`
- `output/cosmology/cosmology_desi_dr1_bao_y1data_eps_crosscheck__w_desi_default_ms_off_y1bins_lrg3elg1_reservoir_r0to17_mix_rescale__jk_cov_ra_dec_per_cap_unwrapped_n48_dec4_ra6_full_smooth3_metrics.json`
- `output/cosmology/cosmology_desi_dr1_bao_y1data_eps_crosscheck__w_desi_default_ms_off_y1bins_lrg3elg1_reservoir_r0to17_mix_rescale__jk_cov_ra_dec_per_cap_unwrapped_n48_dec4_ra6_xi02zero_smooth3_metrics.json`

影響ファイル：
- 更新：`scripts/cosmology/cosmology_bao_xi_jackknife_cov_from_catalogs.py`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-21（UTC） Phase 4 / Step 4.5B.21.4.4.7：jackknife per-cap “unwrapped” mode を追加し、LRG3+ELG1 で再評価（空region回避→依然cov依存）

目的：
- cap（north/south）内の RA 分布が 0..360 をカバーしない場合に、RA 分位点ベースの jackknife で「空region」が生じ得る問題を回避し、cov 推定の系統を切り分ける。
- LRG3+ELG1（0.8<z<1.1）で dv+cov→ε fit→Y1data cross-check を再実行し、screening→確証に必要な “cov 安定性” の見通しを更新する。

実装：
- `scripts/cosmology/cosmology_bao_xi_jackknife_cov_from_catalogs.py`：
  - `--jk-mode ra_quantile_unwrapped` / `ra_quantile_per_cap_unwrapped` を追加（RA を最大ギャップで切って unwrap→分位点→region割当）。

実行（n_regions=24; 暫定の軽量検証）：
- jackknife cov（WSL）：`--jk-mode ra_quantile_per_cap_unwrapped --jk-n 24 --output-suffix jk_cov_per_cap_unwrapped_n24`
- peakfit（full cov; smooth=3）：`scripts/cosmology/cosmology_bao_catalog_peakfit.py --cov-source jackknife --cov-suffix jk_cov_per_cap_unwrapped_n24 --smooth-power-max 3`
- cross-check：`scripts/cosmology/cosmology_desi_dr1_bao_y1data_eps_crosscheck.py --tracers \"LRG3+ELG1\"`

結果（要点）：
- per-cap（unwrapped; λ=0; smooth=3; n=24）：pbg の乖離は per-cap（unwrapped無し）より改善したが、依然 |z|≫1（確証には未到達）。
- 同じ cov で `--cov-zero-xi02` を入れると pbg は |z|≲1 に戻る一方、lcdm は悪化し得る → cov02 を含む off-diagonal の取り扱いが依然支配的系統。

生成/更新した主な出力：
- `output/cosmology/cosmology_bao_xi_from_catalogs_lrg_elg_lopnotqso_combined_lcdm_zmin0p8_zmax1p1__w_desi_default_ms_off_y1bins_lrg3elg1_reservoir_r0to17_mix_rescale__jk_cov_per_cap_unwrapped_n24_metrics.json`
- `output/cosmology/cosmology_bao_xi_from_catalogs_lrg_elg_lopnotqso_combined_pbg_zmin0p8_zmax1p1__w_desi_default_ms_off_y1bins_lrg3elg1_reservoir_r0to17_mix_rescale__jk_cov_per_cap_unwrapped_n24_metrics.json`
- `output/cosmology/cosmology_desi_dr1_bao_y1data_eps_crosscheck__w_desi_default_ms_off_y1bins_lrg3elg1_reservoir_r0to17_mix_rescale__jk_cov_percap_unwrapped_n24_full_smooth3_metrics.json`
- `output/cosmology/cosmology_desi_dr1_bao_y1data_eps_crosscheck__w_desi_default_ms_off_y1bins_lrg3elg1_reservoir_r0to17_mix_rescale__jk_cov_percap_unwrapped_n24_xi02zero_smooth3_metrics.json`

影響ファイル：
- 更新：`scripts/cosmology/cosmology_bao_xi_jackknife_cov_from_catalogs.py`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-21（UTC） Phase 4 / Step 4.5B.21.4.4.7：jackknife per-cap region mode 追加＋LRG3+ELG1 で検証（cov支配の再確認）

目的：
- DESI DR1（multi-tracer; LRG3+ELG1）で、jackknife の region 設計（特に NGC/SGC の扱い）が full cov の不安定性（pbg が負側へ引っ張られる）に寄与しているかを切り分ける。
- 同一 dv=[ξ0,ξ2] に対して、cov（推定法）を差し替えて ε fit→Y1data cross-check までの再現手順を固定する。

実装：
- `scripts/cosmology/cosmology_bao_xi_jackknife_cov_from_catalogs.py`：
  - `--jk-mode ra_quantile_per_cap`（cap ごとに RA 分位点で region を割り、region id をオフセットして leave-one-out）を追加。
  - `--output-suffix` を追加し、同一 dv に対して複数の cov バリアント（例：`__jk_cov_per_cap.npz`）を共存させた。
- `scripts/cosmology/cosmology_bao_catalog_peakfit.py`：
  - `--cov-suffix`（per-case cov の suffix 指定）と `--cov-path`（単一covの明示指定）を追加し、既存の `__jk_cov.npz` を上書きせずに比較可能にした。

実行：
- jackknife cov（per-cap; n_regions=48; WSL）：`--jk-mode ra_quantile_per_cap --output-suffix jk_cov_per_cap`
- peakfit（full cov; smooth=3）：`--cov-source jackknife --cov-suffix jk_cov_per_cap`
- cross-check（Y1data ε_expected；tracer 指定）：`scripts/cosmology/cosmology_desi_dr1_bao_y1data_eps_crosscheck.py --tracers \"LRG3+ELG1\"`

結果（要点）：
- LRG3+ELG1（0.8<z<1.1）では、jackknife per-cap（λ=0; smooth=3）にすると pbg の乖離がむしろ増大（Δε≈-0.267, z_score_combined≈-24.1）し、確証には未到達。
- `--cov-zero-xi02` を併用しても pbg は依然 |z|≫1 であり、cov02 だけでなく cov 推定/region 設計全体が支配的系統になり得ることを補強。

生成/更新した主な出力：
- `output/cosmology/cosmology_bao_xi_from_catalogs_lrg_elg_lopnotqso_combined_lcdm_zmin0p8_zmax1p1__w_desi_default_ms_off_y1bins_lrg3elg1_reservoir_r0to17_mix_rescale__jk_cov_per_cap_metrics.json`
- `output/cosmology/cosmology_bao_xi_from_catalogs_lrg_elg_lopnotqso_combined_pbg_zmin0p8_zmax1p1__w_desi_default_ms_off_y1bins_lrg3elg1_reservoir_r0to17_mix_rescale__jk_cov_per_cap_metrics.json`
- `output/cosmology/cosmology_desi_dr1_bao_y1data_eps_crosscheck__w_desi_default_ms_off_y1bins_lrg3elg1_reservoir_r0to17_mix_rescale__jk_cov_percap_full_smooth3_metrics.json`
- `output/cosmology/cosmology_desi_dr1_bao_y1data_eps_crosscheck__w_desi_default_ms_off_y1bins_lrg3elg1_reservoir_r0to17_mix_rescale__jk_cov_percap_xi02zero_smooth3_metrics.json`

影響ファイル：
- 更新：`scripts/cosmology/cosmology_bao_xi_jackknife_cov_from_catalogs.py`
- 更新：`scripts/cosmology/cosmology_bao_catalog_peakfit.py`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-21（UTC） Phase 4 / Step 4.5B.21.4.4.7：DESI DR1（LRG3+ELG1）multi-random 合算（random rescale）で dv+cov→ε→cross-check を再実行し、cov off-diagonal 系統を固定

目的：
- DESI DR1（LRG3+ELG1; 0.8<z<1.1）の合算tracerで、raw から dv=[ξ0,ξ2]+cov を自前生成し、BAO fit（ε）→Y1data ε_expected cross-check を multi-random（0..17）まで到達させる。
- 合算tracerで問題になり得る「random-to-galaxy 正規化（∑w_r/∑w_g）の tracer 間ズレ」を補正し、合算の選択関数歪みを抑える。
- jackknife/RascalC の full off-diagonal が ε に与える影響（系統支配）を定量化して、確証に使えるか判定する。

実装：
- `scripts/cosmology/desi_dr1_lss_build_combined_tracer_sample.py`：
  - `--in-data-dir-map`（sampleごとに入力data_dirを切替）を追加。
  - `--random-rescale match_combined_total` を追加（capごとに total（∑w）を保ちつつ tracer ごとに random 重みを定数倍して正規化を揃える）。
- `scripts/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep.py`：
  - `--sample/--caps/--tracers/--smooth-power-max` を追加（ELG2/LRG3+ELG1 などへ拡張）。

結果（要点）：
- 合算tracer（LRG3+ELG1）では、random rescale を入れると diag ベースの ε_fit は ε_expected に近づく一方、full off-diagonal（jackknife/RascalC）の扱いで pbg が負側へ大きく引っ張られ得る（符号反転）ことを確認。
- shrinkage sweep（jackknife）では、λ=1（対角のみ）で ε_fit が ε_expected へ戻る一方、λ<1（off-diagonal有）では大きな不一致が残り得る → 現状は **cov（off-diagonal）が支配的系統**であり、確証には使えない（screening 維持）。

生成/更新した主な出力：
- 合算 data_dir（rescale）：`data/cosmology/desi_dr1_lss_lrg_elg_reservoir_r0to17_mix_rescale/manifest.json`
- ξℓ（z=0.8–1.1）：`output/cosmology/cosmology_bao_xi_from_catalogs_lrg_elg_lopnotqso_combined_*_zmin0p8_zmax1p1__w_desi_default_ms_off_y1bins_lrg3elg1_reservoir_r0to17_mix_rescale.npz`
- cov（sky-jackknife）：`output/cosmology/cosmology_bao_xi_from_catalogs_lrg_elg_lopnotqso_combined_*__w_desi_default_ms_off_y1bins_lrg3elg1_reservoir_r0to17_mix_rescale__jk_cov.npz`
- cov（RascalC）：`output/cosmology/cosmology_bao_xi_from_catalogs_lrg_elg_lopnotqso_combined_*__w_desi_default_ms_off_y1bins_lrg3elg1_reservoir_r0to17_mix_rescale__rascalc_cov.npz`
- shrinkage sweep：`output/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep__w_desi_default_ms_off_y1bins_lrg3elg1_reservoir_r0to17_mix_rescale.png` / `.csv`

影響ファイル：
- 更新：`scripts/cosmology/desi_dr1_lss_build_combined_tracer_sample.py`
- 更新：`scripts/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep.py`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-21（UTC） Phase 4 / Step 4.5B.21.4.4.7：DESI DR1（ELG2）multi-random 0..17 で dv+cov→ε→cross-check を再実行し、shrinkage sweep で cov 系統支配を固定

目的：
- DESI DR1（ELG2; 1.1<z<1.6）で、random_index の依存（頑健性）を抑えた dv=[ξ0,ξ2]+cov を自前生成し、BAO fit（ε）→Y1data ε_expected cross-check を multi-random まで到達させる。
- jackknife cov の off-diagonal 取り扱い（diag shrinkage λ）に対する ε_fit−ε_expected の安定性を定量化し、「確証」判定に使えるかを判定する。

実行：
- ELG（ELG_LOPnotqso）の random_index=0..17 を抽出（reservoir 2M, seed=0）：
  - `python -B scripts/cosmology/fetch_desi_dr1_lss.py --data-dir data/cosmology/desi_dr1_lss_reservoir_r{idx} --raw-dir data/cosmology/desi_dr1_lss/raw --sample elg_lopnotqso --caps combined --random-index {idx} --random-sampling reservoir --random-max-rows 2000000 --sampling-seed 0`
- 混合random（reservoir）data_dir を生成：
  - `python -B scripts/cosmology/desi_dr1_lss_build_combined_random_reservoir.py --out-data-dir data/cosmology/desi_dr1_lss_elg_lopnotqso_reservoir_r0to17_mix --in-dir-template 'data/cosmology/desi_dr1_lss_reservoir_r{idx}' --random-indices 0-17 --sample elg_lopnotqso --target-rows 2000000 --seed 0 --take-mode random`
- ξ0/ξ2（WSL/Corrfunc; threads=24）→ Jackknife cov（sky-jackknife; n_regions=48）→ RascalC cov（n_loops=480）→ peakfit（ε）→ cross-check（ELG2）を実行。
- shrinkage sweep（jackknife cov）を ELG2 にも適用できるよう、sweep スクリプトに `--sample/--caps/--tracers` を追加。

結果（要点）：
- ELG2（r0..17 mix）でも、**cov の取り扱いが結果を支配し得る**ことを再確認：
  - jackknife shrinkage λ≲0.2 では |z|≫1 の“差”が出得る一方、λ≳0.4（対角寄り）では |z_score_combined|≲1.1 に収束。
  - RascalC cov（n_loops=480）でも |z_score_combined|≲1.3 に留まり、「確証」には使えない → **screening 維持**。

生成/更新した主な出力：
- 混合random data_dir：`data/cosmology/desi_dr1_lss_elg_lopnotqso_reservoir_r0to17_mix/manifest.json`
- cross-check（RascalC; n_loops=480）：`output/cosmology/cosmology_desi_dr1_bao_y1data_eps_crosscheck__w_desi_default_ms_off_y1bins_elg_reservoir_r0to17_mix__rascalc_cov_nloops480_elg_reservoir_r0to17_mix_metrics.json`
- shrinkage sweep：`output/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep__w_desi_default_ms_off_y1bins_elg_reservoir_r0to17_mix.png` / `.csv`

影響ファイル：
- 更新：`scripts/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep.py`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-21（UTC） Phase 4 / Step 4.5B.21.4.4.7：DESI DR1 multi-tracer（ELG2 / LRG3+ELG1）で dv+cov→ε fit→cross-check を r0（local raw）で実行

目的：
- Step 4.5B.21.4.4.7（multi-tracer）として、DESI DR1 の local raw（`data/cosmology/desi_dr1_lss/raw/`）から tracer別に dv=[ξ0,ξ2]+cov を自前生成し、ε fit→Y1data ε_expected cross-check まで到達する。

実行（要点）：
- 入力抽出（r0；reservoir 2M；local raw を再利用）：
  - `scripts/cosmology/fetch_desi_dr1_lss.py --data-dir data/cosmology/desi_dr1_lss_reservoir_r0 --raw-dir data/cosmology/desi_dr1_lss/raw --sample elg_lopnotqso/qso/bgs_bright --caps combined --random-index 0 --random-sampling reservoir`
- ELG2（1.1<z<1.6）：
  - ξℓ（WSL/Corrfunc）：`scripts/cosmology/cosmology_bao_xi_from_catalogs.py --data-dir ... --sample elg_lopnotqso --z-min 1.1 --z-max 1.6`
  - cov（WSL）：sky-jackknife（n_regions=48）/ RascalC（legendre_projected）
  - peakfit（Windows）：`scripts/cosmology/cosmology_bao_catalog_peakfit.py --cov-source jackknife/rascalc`
  - cross-check（Windows）：`scripts/cosmology/cosmology_desi_dr1_bao_y1data_eps_crosscheck.py --tracers ELG2`
- LRG3+ELG1（0.8<z<1.1）：
  - 公式は合算tracerのため、自前で LRG+ELG の結合 data_dir を生成する補助を追加：
    - `scripts/cosmology/desi_dr1_lss_build_combined_tracer_sample.py`
    - 出力：`data/cosmology/desi_dr1_lss_lrg_elg_reservoir_r0/manifest.json`
  - ξℓ / cov / peakfit / cross-check（`--tracers "LRG3+ELG1"`）まで到達。

結果（要点）：
- ELG2：cov（特に jackknife の full off-diagonal）が ε_fit−ε_expected の有意度を大きく動かし得ることを確認（shrinkage/rascalcで z_score が変動）→ 現状は確証に使えず screening を維持。
- LRG3+ELG1：現状の自前合算仕様では ε が大きく外れ、RascalC cov の N_eff も低く（warning継続）、確証に使えない → 合算仕様（random密度・重み・結合方法）の詰めが必要。

実装：
- `scripts/cosmology/cosmology_desi_dr1_bao_y1data_eps_crosscheck.py`：`--tracers` を追加し、ELG2 / LRG3+ELG1 などへ拡張（DV-onlyは対象外として明示）。
- `scripts/cosmology/desi_dr1_lss_build_combined_tracer_sample.py`：抽出NPZから LRG+ELG の合算 data_dir を生成する補助を追加。

生成/更新した主な出力（代表）：
- ELG2 cross-check：`output/cosmology/cosmology_desi_dr1_bao_y1data_eps_crosscheck__w_desi_default_ms_off_y1bins_reservoir_r0__rascalc_cov_reservoir_r0__elg2_metrics.json`
- LRG3+ELG1 cross-check：`output/cosmology/cosmology_desi_dr1_bao_y1data_eps_crosscheck__w_desi_default_ms_off_y1bins_lrg_elg_reservoir_r0__rascalc_cov_lrg_elg_reservoir_r0__lrg3elg1_metrics.json`

影響ファイル：
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`
- 更新：`scripts/cosmology/cosmology_desi_dr1_bao_y1data_eps_crosscheck.py`
- 追加：`scripts/cosmology/desi_dr1_lss_build_combined_tracer_sample.py`

---

## 2026-01-21（UTC） Phase 4 / Step 4.5：DESI DR1 を screening→確証へ再挑戦する multi-tracer dv+cov（QSO/ELG/BGS）をロードマップへ追加

目的：
- DESI DR1 の local raw（`data/cosmology/desi_dr1_lss/raw/`）から、fit可能な一次プロダクト dv=[ξ0,ξ2]+cov を tracer別に自前生成し、ε fit→Y1data cross-check まで到達して「screening→確証」判定を再挑戦する。

実装：
- ドキュメント更新：
  - `doc/ROADMAP.md`：Step 4.5B.21.4.4.7 を追加（multi-tracer：QSO/ELG/BGS；RascalC+Jackknife；昇格条件案）。
  - `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`：次にやることへ Step 4.5B.21.4.4.7 を追加。

次：
- まず `scripts/cosmology/fetch_desi_dr1_lss.py` で QSO/ELG/BGS（random 0..17）の抽出NPZを作成し、必要なら `scripts/cosmology/desi_dr1_lss_build_combined_random_reservoir.py` で multi-random 結合random（reservoir）を作成して dv+cov→ε→cross-check を実行する。

影響ファイル：
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-21（UTC） Phase 4 / Step 4.5（任意）：DESI DR1 RascalC cov の n_loops を増やして収束を評価（n_loops=480）し、ε cross-check の結論不変を確認

目的：
- Step 4.5B.21.4.4.6.10（任意）として、RascalC cov（legendre_projected）の収束警告（強い固有値テスト）を低減できるかを確認し、ε_fit−ε_expected の結論（screening維持）が不変かを再確認する。

実行：
- バックアップ（n_loops=240）：
  - cov：`output/cosmology/cosmology_bao_xi_from_catalogs_*__w_desi_default_ms_off_y1bins_reservoir_r0to17_mix__rascalc_cov_nloops240.npz`
  - RascalC 作業ディレクトリ：`output/cosmology/rascalc/*__w_desi_default_ms_off_y1bins_reservoir_r0to17_mix__nloops240/`
- RascalC cov 再生成（WSL；4ケース；n_loops=480）：`wsl -d Ubuntu-24.04 -- bash -lc "cd /mnt/c/develop/waveP && .venv_wsl/bin/python -B scripts/cosmology/cosmology_bao_xi_rascalc_cov_from_catalogs.py --xi-metrics-json <xi_metrics.json> --threads 24 --n-loops 480 --loops-per-sample 24 --randoms-subset 200000 --xi-refinement-iterations 0"`
- peakfit + cross-check（Windows；RascalC cov）：`python -B scripts/cosmology/cosmology_bao_catalog_peakfit.py --sample lrg --caps combined --out-tag w_desi_default_ms_off_y1bins_reservoir_r0to17_mix --cov-source rascalc --output-suffix rascalc_cov_nloops480_reservoir_r0to17_mix` → `python -B scripts/cosmology/cosmology_desi_dr1_bao_y1data_eps_crosscheck.py ...`

結果（要点）：
- RascalC の強い固有値テスト warning は n_loops=480 でも残るが、指標（C2^{-1/2}C4C2^{-1/2} など）は改善し、ε_fit−ε_expected は依然として |z_score_combined|≲1.0 に収束（結論は不変：DESI は screening 維持）。

生成/更新した主な出力：
- cov（n_loops=480；上書き）：`output/cosmology/cosmology_bao_xi_from_catalogs_lrg_combined_*__w_desi_default_ms_off_y1bins_reservoir_r0to17_mix__rascalc_cov.npz`
- peakfit：`output/cosmology/cosmology_bao_catalog_peakfit_lrg_combined__w_desi_default_ms_off_y1bins_reservoir_r0to17_mix__rascalc_cov_nloops480_reservoir_r0to17_mix_metrics.json`
- cross-check：`output/cosmology/cosmology_desi_dr1_bao_y1data_eps_crosscheck__w_desi_default_ms_off_y1bins_reservoir_r0to17_mix__rascalc_cov_nloops480_reservoir_r0to17_mix_metrics.json`

影響ファイル：
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-20（UTC） Phase 4 / Step 4.5：DESI DR1 の pycorr（Corrfunc engine）で ξ0/ξ2 + jackknife cov を生成し、BAO fit（ε）→Y1data cross-check まで到達（Corrfunc@desi へ更新）

目的：
- Roadmap 4.5B.21.4.4.6.2（pycorr）と 4.5B.21.4.4.6.3（RascalC）の未完了を前提に、まずは **pycorr 経由で “一次プロダクト（dv=[ξ0,ξ2]+cov）” が自前生成できる**ことを確認し、ε fit まで通す。

変更：
- WSL venv（`.venv_wsl`）の Corrfunc を **cosmodesi/Corrfunc@desi** に更新（pycorr の Corrfunc backend と API を整合させるため）。
  - `wsl -d Ubuntu-24.04 -- bash -lc "cd /mnt/c/develop/waveP && .venv_wsl/bin/python -m pip install --force-reinstall --no-cache-dir git+https://github.com/cosmodesi/Corrfunc@desi"`
- `scripts/cosmology/cosmology_bao_xi_from_catalogs.py`：
  - Corrfunc の API 差（pip版 / desi branch）を吸収するよう `_corrfunc_paircounts_smu()` を拡張。
  - `--paircounts-backend {corrfunc,pycorr}` を追加し、`pycorr`（TwoPointCorrelationFunction; engine=corrfunc）で LS の DD/DR/RR を生成できるようにした（`--recon none` 限定）。

実行（pycorr; LRG; combined; z-bin=Y1bins；random_index=0；sky-jackknife n_regions=48）：
- ξℓ（WSL）：`wsl -d Ubuntu-24.04 -- bash -lc "cd /mnt/c/develop/waveP && .venv_wsl/bin/python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --data-dir data/cosmology/desi_dr1_lss_reservoir_r0 --sample lrg --caps combined --dist lcdm/pbg --weight-scheme desi_default --match-sectors off --z-min 0.4/0.6 --z-max 0.6/0.8 --threads 24 --paircounts-backend pycorr --out-tag w_desi_default_y1bins_full_r0_pycorr"`
- jackknife cov（WSL）：`wsl -d Ubuntu-24.04 -- bash -lc "cd /mnt/c/develop/waveP && .venv_wsl/bin/python -B scripts/cosmology/cosmology_bao_xi_jackknife_cov_from_catalogs.py --xi-metrics-json <xi_metrics.json> --jk-n 48 --threads 24"`（4ケース）
- peakfit（Windows；jackknife）：`python -B scripts/cosmology/cosmology_bao_catalog_peakfit.py --sample lrg --caps combined --out-tag w_desi_default_y1bins_full_r0_pycorr_ms_off --cov-source jackknife --output-suffix jk_cov_pycorr_full_r0_y1bins`
- cross-check（Windows；Y1data）：`python -B scripts/cosmology/cosmology_desi_dr1_bao_y1data_eps_crosscheck.py --peakfit-metrics-json output/cosmology/cosmology_bao_catalog_peakfit_lrg_combined__w_desi_default_y1bins_full_r0_pycorr_ms_off__jk_cov_pycorr_full_r0_y1bins_metrics.json --out-tag w_desi_default_y1bins_full_r0_pycorr_ms_off__jk_cov_pycorr_full_r0_y1bins`

結果（要点）：
- pycorr 経由でも dv+cov を自前生成して ε fit と cross-check まで到達できることを確認（RascalC は未導入のため次段）。
- full jackknife cov（shrinkageなし）では、LRG2/lcdm の ε_fit−ε_expected が大きく乖離し得る（cov 取り扱いが支配的系統になり得る点は既知の通り）。

生成/更新した主な出力（代表）：
- ξℓ（pycorr）：`output/cosmology/cosmology_bao_xi_from_catalogs_lrg_combined_{lcdm,pbg}_zmin0p{4,6}_zmax0p{6,8}__w_desi_default_y1bins_full_r0_pycorr_ms_off.npz`
- jackknife cov：`output/cosmology/cosmology_bao_xi_from_catalogs_lrg_combined_{lcdm,pbg}_zmin0p{4,6}_zmax0p{6,8}__w_desi_default_y1bins_full_r0_pycorr_ms_off__jk_cov.npz`
- peakfit（jackknife）：`output/cosmology/cosmology_bao_catalog_peakfit_lrg_combined__w_desi_default_y1bins_full_r0_pycorr_ms_off__jk_cov_pycorr_full_r0_y1bins_metrics.json`
- cross-check：`output/cosmology/cosmology_desi_dr1_bao_y1data_eps_crosscheck__w_desi_default_y1bins_full_r0_pycorr_ms_off__jk_cov_pycorr_full_r0_y1bins_metrics.json`

影響ファイル：
- 更新：`doc/ROADMAP.md`
- 更新：`scripts/cosmology/cosmology_bao_xi_from_catalogs.py`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-20（UTC） Phase 4 / Step 4.5：DESI DR1 raw（full random）から dv+cov を自前生成し、BAO fit（ε）まで到達

目的：
- Step `4.5B.21.4.4.6`：DESI DR1 の raw キャッシュから multipoles（ξ0/ξ2）+ covariance（dv+cov）を一次プロダクトとして固定し、BAO peakfit（ε）と Y1data 由来 ε_expected の整合チェックまで到達する。

実行（再現コマンドの要点）：
- ξℓ（WSL/Corrfunc; threads=24）：
  - `wsl -d Ubuntu-24.04 -- bash -lc "cd /mnt/c/develop/waveP && .venv_wsl/bin/python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --data-dir data/cosmology/desi_dr1_lss_full_r0 --sample lrg --caps combined --weight-scheme desi_default --random-kind random --match-sectors off --threads 24 --out-tag w_desi_default_ms_off_y1bins_full_r0 --z-min 0.4 --z-max 0.6 --dist lcdm"`
  - `--dist pbg` と `--z-min 0.6 --z-max 0.8` でも同様に実行（LRG1/LRG2 × lcdm/pbg）。
- jackknife covariance（WSL/Corrfunc; n_regions=48）：
  - `wsl -d Ubuntu-24.04 -- bash -lc "cd /mnt/c/develop/waveP && .venv_wsl/bin/python -B scripts/cosmology/cosmology_bao_xi_jackknife_cov_from_catalogs.py --xi-metrics-json output/cosmology/cosmology_bao_xi_from_catalogs_lrg_combined_lcdm_zmin0p4_zmax0p6__w_desi_default_ms_off_y1bins_full_r0_metrics.json --jk-n 48 --threads 24"`
  - dist/z-bin ごとに 4ケースを生成。
- peakfit + cross-check（Windows）：
  - `python -B scripts/cosmology/cosmology_bao_catalog_peakfit.py --sample lrg --caps combined --out-tag w_desi_default_ms_off_y1bins_full_r0 --cov-source jackknife --output-suffix jk_cov_both_full_r0`
  - `python -B scripts/cosmology/cosmology_desi_dr1_bao_y1data_eps_crosscheck.py --peakfit-metrics-json output/cosmology/cosmology_bao_catalog_peakfit_lrg_combined__w_desi_default_ms_off_y1bins_full_r0__jk_cov_both_full_r0_metrics.json --out-tag w_desi_default_ms_off_y1bins_full_r0__jk_cov_both_full_r0`

結果：
- DESI DR1（LRG1/LRG2; full random r0）について、dv=[ξ0,ξ2]+cov（sky jackknife; n_regions=48; dv_dim=48）を固定し、peakfit（ε）まで到達した。
- ε_expected cross-check：pbg は LRG1/LRG2 とも ε_fit−ε_expected が |z|≲0.3σ（combined）で整合。

影響ファイル：
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-20（UTC） Phase 6 / Step 6.1.6：NGLR-1 の追加データ（年/局）を探索（EDC）し、現時点では 2025 のみを確認

目的：
- Step 6.1.6 として、NGLR-1（nglr1）の EDC 公開データに新年度（2026）や新局が追加されているかを確認し、増分があれば取得→バッチ評価で mm級到達の可否を再評価する。

実行：
- EDC 探索（2026）：`python -B scripts/llr/fetch_llr_edc_batch.py --targets nglr1 --years 2026-2026 --append --include-daily`
- 参考（2025 再探索）：`python -B scripts/llr/fetch_llr_edc_batch.py --targets nglr1 --years 2025-2025 --append --include-daily`

結果（要点）：
- 2026-01-20 時点では、EDC（npt_crd_v2）の nglr1 は 2025 のみで、2026 の増分は見つからなかった（manifestは更新されるが files/stations は増えず）。
- したがって Step 6.1.6 は引き続き「準備中」とし、EDC 側に新年度/新局データが出次第、再度取得して評価を更新する。

影響ファイル：
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`
- 更新：`doc/WORK_HISTORY_RECENT.md`
- 更新：`output/summary/pmodel_public_report.html`
- 更新：`output/summary/pmodel_public_report.docx`
- 更新：`output/summary/pmodel_paper.html`
- 更新：`output/summary/pmodel_paper.docx`

---

## 2026-01-20（UTC） Phase 6 / Step 6.1.6：NGLR-1 の year/station カバレッジ（unique点数）を固定出力し、増分検出を容易化

目的：
- Step 6.1.6（年/局拡張）を進める前提として、現状の NGLR-1 の station×target カバレッジ（unique点数）を明示し、追加データが出た時に差分が追える状態にする。

変更：
- `scripts/llr/llr_batch_eval.py`：filter+dedup 後の station×target の unique点数を `output/llr/batch/llr_data_coverage.csv` として固定出力。
- `scripts/summary/validation_scoreboard.py`：NGLR-1 行に「除外station（min_points未満）」を表示（例：WETL）。

実行：
- EDC 再探索（2026）：`python -B scripts/llr/fetch_llr_edc_batch.py --targets nglr1 --years 2026-2026 --append --include-daily`
- EDC 再探索（2025）：`python -B scripts/llr/fetch_llr_edc_batch.py --targets nglr1 --years 2025-2025 --append --include-daily`
- 全再生成：`python -B scripts/summary/run_all.py --offline --jobs 2`

結果（要点）：
- 2026-01-20 時点：nglr1 の unique点数は APOL=24 / WETL=2（WETL は min_points_cap=6 未満のため RMS 指標から除外）。
- EDC に 2026 年ディレクトリ/2025 増分は検出されず（Step 6.1.6 は準備中を継続）。

生成/更新した主な出力：
- `output/llr/batch/llr_data_coverage.csv`
- `output/summary/validation_scoreboard.json`

影響ファイル：
- 更新：`scripts/llr/llr_batch_eval.py`
- 更新：`scripts/summary/validation_scoreboard.py`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-20（UTC） Phase 4 / Step 4.5（任意）：DESI DR1 jackknife cov の自動 shrinkage（Ledoit-Wolf）を追加し、cov 系統支配の再確認

目的：
- jackknife cov の shrinkage λ を手動で選ぶこと自体が系統になり得るため、y_jk（leave-one-out 推定値）から λ を自動推定し、結論（DESI は screening 維持）が崩れないかを確認する。

変更：
- `scripts/cosmology/cosmology_bao_catalog_peakfit.py`：`--cov-shrinkage auto`（Ledoit-Wolf; diag target）を追加。
- `doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`：上記の位置づけと出力を追記。

実行：
- peakfit（auto; reservoir）：`python -B scripts/cosmology/cosmology_bao_catalog_peakfit.py --sample lrg --caps combined --out-tag w_desi_default_ms_off_y1bins_reservoir_r0to17_mix --cov-source jackknife --cov-shrinkage auto --output-suffix jk_cov_shrinkauto_reservoir_r0to17_mix`
- cross-check（auto; reservoir）：`python -B scripts/cosmology/cosmology_desi_dr1_bao_y1data_eps_crosscheck.py --peakfit-metrics-json output/cosmology/cosmology_bao_catalog_peakfit_lrg_combined__w_desi_default_ms_off_y1bins_reservoir_r0to17_mix__jk_cov_shrinkauto_reservoir_r0to17_mix_metrics.json --out-tag w_desi_default_ms_off_y1bins_reservoir_r0to17_mix__jk_cov_shrinkauto_reservoir_r0to17_mix`
- peakfit（auto; full_r0r1_mean）：`python -B scripts/cosmology/cosmology_bao_catalog_peakfit.py --sample lrg --caps combined --out-tag w_desi_default_ms_off_y1bins_full_r0r1_mean --cov-source jackknife --cov-shrinkage auto --output-suffix jk_cov_shrinkauto_full_r0r1_mean`
- cross-check（auto; full_r0r1_mean）：`python -B scripts/cosmology/cosmology_desi_dr1_bao_y1data_eps_crosscheck.py --peakfit-metrics-json output/cosmology/cosmology_bao_catalog_peakfit_lrg_combined__w_desi_default_ms_off_y1bins_full_r0r1_mean__jk_cov_shrinkauto_full_r0r1_mean_metrics.json --out-tag w_desi_default_ms_off_y1bins_full_r0r1_mean__jk_cov_shrinkauto_full_r0r1_mean`

結果（要点）：
- Ledoit-Wolf は λ_auto≈0.006 を返し得て（ほぼ full off-diagonal）、ε_fit−ε_expected の有意度が再び |z|≫1 に跳ね得るケースがある。
- 結論：cov 推定/正則化が支配的系統になり得るため、DESI は引き続き screening の扱いを維持する（確証へ昇格できない）。

生成/更新した主な出力：
- `output/cosmology/cosmology_bao_catalog_peakfit_lrg_combined__w_desi_default_ms_off_y1bins_reservoir_r0to17_mix__jk_cov_shrinkauto_reservoir_r0to17_mix_metrics.json`
- `output/cosmology/cosmology_desi_dr1_bao_y1data_eps_crosscheck__w_desi_default_ms_off_y1bins_reservoir_r0to17_mix__jk_cov_shrinkauto_reservoir_r0to17_mix_metrics.json`
- `output/cosmology/cosmology_bao_catalog_peakfit_lrg_combined__w_desi_default_ms_off_y1bins_full_r0r1_mean__jk_cov_shrinkauto_full_r0r1_mean_metrics.json`
- `output/cosmology/cosmology_desi_dr1_bao_y1data_eps_crosscheck__w_desi_default_ms_off_y1bins_full_r0r1_mean__jk_cov_shrinkauto_full_r0r1_mean_metrics.json`

影響ファイル：
- 更新：`scripts/cosmology/cosmology_bao_catalog_peakfit.py`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`
- 更新：`doc/WORK_HISTORY_RECENT.md`
- 更新：`scripts/summary/paper_tables.py`
- 更新：`scripts/summary/validation_scoreboard.py`
- 生成：`output/cosmology/cosmology_bao_xi_from_catalogs_lrg_combined_*__w_desi_default_ms_off_y1bins_full_r0.*`
- 生成：`output/cosmology/cosmology_bao_xi_from_catalogs_lrg_combined_*__w_desi_default_ms_off_y1bins_full_r0__jk_cov.*`
- 更新：`output/cosmology/cosmology_bao_catalog_peakfit_lrg_combined__w_desi_default_ms_off_y1bins_full_r0__jk_cov_both_full_r0.*`
- 更新：`output/cosmology/cosmology_desi_dr1_bao_y1data_eps_crosscheck__w_desi_default_ms_off_y1bins_full_r0__jk_cov_both_full_r0.*`

---

## 2026-01-20（UTC） Phase 4 / Step 4.6.5.2：GNZ7Q の line_id を確定し、confirm-z で z_confirmed を固定

目的：
- GNZ7Q（JWST/MIRI）は x1d が多数あり、z_estimate を成立させても線同定（手動）が未確定だと z を固定できない。
- Step 4.6.5.2（対象ごとの線同定→z固定）を前進させ、GNZ7Q を「手動線同定→z確定」パイプラインの完了例として固定する。

変更：
- `data/cosmology/mast/jwst_spectra/gnz7q/line_id.json`：
  - mirifushort の複数 x1d を z_confirmed の対象に追加。
  - Hα / [N II]6583 / [S II]6716 を `use=true` とし、近接線（Hα と [N II]）の centroid 選択を安定化するため `prior_sigma_um` を設定。
- 実行（offline；z確定）：`python -B scripts/cosmology/fetch_mast_jwst_spectra.py --targets GNZ7Q --offline --confirm-z`

結果：
- `output/cosmology/jwst_spectra__gnz7q__z_confirmed.json`：ok=true、z≈13.6449、σ_total≈0.00109、χ²/dof≈1.93（outlier rejected_n=11, ok_spectra_n=4）。
- 診断図と採用線一覧を生成：
  - `output/cosmology/jwst_spectra__gnz7q__z_confirmed.png`
  - `output/cosmology/jwst_spectra__gnz7q__z_confirmed_summary.png`
  - `output/cosmology/jwst_spectra__gnz7q__z_confirmed_lines.csv`

影響ファイル：
- 更新：`data/cosmology/mast/jwst_spectra/gnz7q/line_id.json`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/WORK_HISTORY.md`
- 更新：`doc/WORK_HISTORY_RECENT.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`output/cosmology/jwst_spectra__gnz7q__z_confirmed.json`
- 更新：`output/cosmology/jwst_spectra__gnz7q__z_confirmed.png`
- 更新：`output/cosmology/jwst_spectra__gnz7q__z_confirmed_summary.png`
- 更新：`output/cosmology/jwst_spectra__gnz7q__z_confirmed_lines.csv`
- 更新：`output/summary/pmodel_public_report.html`
- 更新：`output/summary/pmodel_public_report.docx`
- 更新：`output/summary/pmodel_paper.html`
- 更新：`output/summary/pmodel_paper.docx`

---

## 2026-01-20（UTC） Phase 4 / Step 4.6.5.2：JADES_10058975 の line_id を確定し、confirm-z で z_confirmed を固定（[Ne III]採用）

目的：
- Step 4.6.5.2（対象ごとの線同定→z固定）を前進させ、JADES_10058975 を「手動線同定→z確定」パイプラインへ接続する。
- z_estimate の最有力（[O II]+[Ne III]）について、端点系統を避けて再現可能に z を固定する。

変更：
- `data/cosmology/mast/jwst_spectra/jades_10058975/line_id.json`：
  - `spectra`（複数 x1d）を追加し、confirm-z の対象を明示。
  - [Ne III] を z結合（use=true）に採用。
  - [O II] はスペクトル端に近く centroid が不安定になりやすいため cross-check（use=false）として測定のみ残す。
  - `min_snr_integrated_proxy` と `prior_sigma_um` を設定して手動線同定の再現性を担保。
- 実行（offline；z確定）：`python -B scripts/cosmology/fetch_mast_jwst_spectra.py --targets JADES_10058975 --offline --confirm-z`

結果：
- `output/cosmology/jwst_spectra__jades_10058975__z_confirmed.json`：ok=true、z≈3.5745、σ_total≈0.00138（use=true は [Ne III] のみ；[O II] は use=false で測定のみ）。
- 診断図と採用線一覧を生成：
  - `output/cosmology/jwst_spectra__jades_10058975__z_confirmed.png`
  - `output/cosmology/jwst_spectra__jades_10058975__z_confirmed_summary.png`
  - `output/cosmology/jwst_spectra__jades_10058975__z_confirmed_lines.csv`

影響ファイル：
- 更新：`data/cosmology/mast/jwst_spectra/jades_10058975/line_id.json`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/WORK_HISTORY.md`
- 更新：`doc/WORK_HISTORY_RECENT.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`output/cosmology/jwst_spectra__jades_10058975__z_confirmed.json`
- 更新：`output/cosmology/jwst_spectra__jades_10058975__z_confirmed.png`
- 更新：`output/cosmology/jwst_spectra__jades_10058975__z_confirmed_summary.png`
- 更新：`output/cosmology/jwst_spectra__jades_10058975__z_confirmed_lines.csv`
- 更新：`output/summary/pmodel_public_report.html`
- 更新：`output/summary/pmodel_public_report.docx`
- 更新：`output/summary/pmodel_paper.html`
- 更新：`output/summary/pmodel_paper.docx`

---

## 2026-01-20（UTC） Phase 4 / Step 4.5（任意）：DESI DR1 full random（random_index=1）で dv+cov→ε→cross-check を再現し、頑健性を確認

目的：
- Step 4.5（DESI DR1）の頑健性補強として、full random の random_index=1 でも dv=[ξ0,ξ2]+cov を生成し、peakfit（ε）と Y1data ε_expected の整合を再確認する。

実行（再現コマンドの要点）：
- extract（Windows）：`python -B scripts/cosmology/fetch_desi_dr1_lss.py --data-dir data/cosmology/desi_dr1_lss_full_r1 --raw-dir data/cosmology/desi_dr1_lss/raw --sample lrg --caps combined --random-index 1 --random-sampling full`
- ξℓ（WSL/Corrfunc; threads=24）：`wsl -d Ubuntu-24.04 -- bash -lc "cd /mnt/c/develop/waveP && .venv_wsl/bin/python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --data-dir data/cosmology/desi_dr1_lss_full_r1 --sample lrg --caps combined --weight-scheme desi_default --random-kind random --match-sectors off --threads 24 --out-tag w_desi_default_ms_off_y1bins_full_r1 --z-min 0.4 --z-max 0.6 --dist lcdm"`（z-bin/distごとに実行）
- jackknife covariance（WSL/Corrfunc; n_regions=48）：`wsl -d Ubuntu-24.04 -- bash -lc "cd /mnt/c/develop/waveP && .venv_wsl/bin/python -B scripts/cosmology/cosmology_bao_xi_jackknife_cov_from_catalogs.py --xi-metrics-json output/cosmology/cosmology_bao_xi_from_catalogs_lrg_combined_lcdm_zmin0p4_zmax0p6__w_desi_default_ms_off_y1bins_full_r1_metrics.json --jk-n 48 --threads 24"`（z-bin/distごとに実行）
- peakfit + cross-check（Windows）：
  - `python -B scripts/cosmology/cosmology_bao_catalog_peakfit.py --sample lrg --caps combined --out-tag w_desi_default_ms_off_y1bins_full_r1 --cov-source jackknife --output-suffix jk_cov_both_full_r1`
  - `python -B scripts/cosmology/cosmology_desi_dr1_bao_y1data_eps_crosscheck.py --peakfit-metrics-json output/cosmology/cosmology_bao_catalog_peakfit_lrg_combined__w_desi_default_ms_off_y1bins_full_r1__jk_cov_both_full_r1_metrics.json --out-tag w_desi_default_ms_off_y1bins_full_r1__jk_cov_both_full_r1`

結果（要点）：
- pbg：ε_fit−ε_expected は LRG1:+0.78σ、LRG2:−1.43σ（combined）で ≤2σ の範囲に留まる。
- lcdm：random_index による ε の変動が大きく、追加の頑健性評価（multi-random 平均など）が必要。

生成/更新した主な出力：
- `data/cosmology/desi_dr1_lss_full_r1/manifest.json`
- `output/cosmology/cosmology_bao_xi_from_catalogs_lrg_combined_*__w_desi_default_ms_off_y1bins_full_r1_metrics.json`
- `output/cosmology/cosmology_bao_xi_from_catalogs_lrg_combined_*__w_desi_default_ms_off_y1bins_full_r1__jk_cov.npz`
- `output/cosmology/cosmology_bao_catalog_peakfit_lrg_combined__w_desi_default_ms_off_y1bins_full_r1__jk_cov_both_full_r1_metrics.json`
- `output/cosmology/cosmology_desi_dr1_bao_y1data_eps_crosscheck__w_desi_default_ms_off_y1bins_full_r1__jk_cov_both_full_r1_metrics.json`

影響ファイル：
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/WORK_HISTORY.md`
- 更新：`doc/WORK_HISTORY_RECENT.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`output/summary/pmodel_public_report.html`
- 更新：`output/summary/pmodel_public_report.docx`
- 更新：`output/summary/pmodel_paper.html`
- 更新：`output/summary/pmodel_paper.docx`

---

## 2026-01-20（UTC） Phase 4 / Step 4.5（任意）：DESI DR1 full random を multi-random（r0+r1 mean）で平均化し、dv+cov→ε→cross-check を更新

目的：
- Step 4.5B.21.4.4.6.6（full random r1）までで、pbg は概ね整合だが lcdm は random_index 依存が大きいことが判明した。
- 次の頑健性チェック（Step 4.5B.21.4.4.6.7）として、既存出力（r0/r1）の dv+cov を平均化し、Corrfunc 再実行なしで “multi-random の一次プロダクト” を作って peakfit（ε）と cross-check を回す。

変更：
- `doc/ROADMAP.md`：4.5B.21.4.4.6.7（multi-random 平均/合成）のサブStepを追記し、現状を進行中へ更新。
- `scripts/cosmology/cosmology_bao_xi_multirandom_combine.py`：xi_from_catalogs と jackknife cov（npz）を入力に、random 実現の平均 dv+cov を生成するスクリプトを追加。
  - jackknife cov は「y_jk から再計算」ではなく「cov 行列の平均（mean_on_saved_cov）」を正にした（y_jk 平均→再計算は特定ケースで peakfit が不安定化するため）。
- `scripts/summary/paper_tables.py` / `scripts/summary/validation_scoreboard.py`：DESI の参照を `full_r0r1_mean` を最優先にするよう更新（存在しない場合は full_r0 → 旧版へフォールバック）。

実行：
- multi-random combine（Windows）：`python -B scripts/cosmology/cosmology_bao_xi_multirandom_combine.py ... --out-tag w_desi_default_ms_off_y1bins_full_r0r1_mean`（dist×z-bin の4ケース）
- peakfit（Windows）：`python -B scripts/cosmology/cosmology_bao_catalog_peakfit.py --sample lrg --caps combined --out-tag w_desi_default_ms_off_y1bins_full_r0r1_mean --cov-source jackknife --output-suffix jk_cov_both_full_r0r1_mean`
- cross-check（Windows）：`python -B scripts/cosmology/cosmology_desi_dr1_bao_y1data_eps_crosscheck.py --peakfit-metrics-json output/cosmology/cosmology_bao_catalog_peakfit_lrg_combined__w_desi_default_ms_off_y1bins_full_r0r1_mean__jk_cov_both_full_r0r1_mean_metrics.json --out-tag w_desi_default_ms_off_y1bins_full_r0r1_mean__jk_cov_both_full_r0r1_mean`

結果（要点）：
- pbg：ε_fit−ε_expected は LRG1:+0.50σ、LRG2:−0.33σ（z_score_combined）で **≤1σ** として整合（r0/r1 単独より “平均” の扱いが安定）。
- lcdm：LRG2 は z_score_combined≈−5.54σ と大きく乖離（ただし random/cov の取り扱いに敏感な可能性があるため、次は 0..17 への拡張で頑健性を確認する）。

生成/更新した主な出力：
- `output/cosmology/cosmology_bao_xi_from_catalogs_lrg_combined_*__w_desi_default_ms_off_y1bins_full_r0r1_mean.npz`
- `output/cosmology/cosmology_bao_xi_from_catalogs_lrg_combined_*__w_desi_default_ms_off_y1bins_full_r0r1_mean_metrics.json`
- `output/cosmology/cosmology_bao_xi_from_catalogs_lrg_combined_*__w_desi_default_ms_off_y1bins_full_r0r1_mean__jk_cov.npz`
- `output/cosmology/cosmology_bao_catalog_peakfit_lrg_combined__w_desi_default_ms_off_y1bins_full_r0r1_mean__jk_cov_both_full_r0r1_mean_metrics.json`
- `output/cosmology/cosmology_desi_dr1_bao_y1data_eps_crosscheck__w_desi_default_ms_off_y1bins_full_r0r1_mean__jk_cov_both_full_r0r1_mean_metrics.json`

影響ファイル：
- 更新：`doc/ROADMAP.md`
- 更新：`scripts/summary/paper_tables.py`
- 更新：`scripts/summary/validation_scoreboard.py`
- 追加：`scripts/cosmology/cosmology_bao_xi_multirandom_combine.py`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-20（UTC） Phase 4 / Step 4.5：DESI DR1 multi-random（r0..17）で「結合random」を作り、jackknife cov の shrinkage を導入して ε cross-check を安定化

目的：
- Step 4.5B.21.4.4.6.7（multi-random）として、random_index=0..17 の揺らぎを抑えた “fit可能な一次プロダクト（dv=[ξ0,ξ2]+cov）” を固定する。
- jackknife cov（full off-diagonal）の扱いが ε fit を不安定化し得るため、扱いを明示して安定な手順へ寄せる（「差が出ない理由」を固定）。

変更：
- 追加：`scripts/cosmology/desi_dr1_lss_build_combined_random_reservoir.py`
  - 既存の抽出済みNPZ（`data/cosmology/desi_dr1_lss_reservoir_r{idx}`）から、random_index=0..17 の「結合random（reservoir）」を生成する補助。
  - 注意：入力NPZの行順に偏りがあり得るため、結合時は `--take-mode random` を正とした（prefix 抽出は dec 分布が崩れて系統になる）。
- 更新：`scripts/cosmology/cosmology_bao_catalog_peakfit.py`
  - `--cov-shrinkage λ` を追加（jackknife cov を diag へ shrink して安定化）。
- 更新：`doc/ROADMAP.md`：4.5B.21.4.4.6.7 を「完了」へ更新し、結論（差が出ない/共分散感度）を固定。
- 更新：`scripts/summary/paper_tables.py` / `scripts/summary/validation_scoreboard.py`
  - DESI は `__jk_cov_shrink0p2_*` を優先参照（無い場合は従来へフォールバック）。

実行：
- 結合random作成（Windows）：`python -B scripts/cosmology/desi_dr1_lss_build_combined_random_reservoir.py --out-data-dir data/cosmology/desi_dr1_lss_reservoir_r0to17_mix --in-dir-template 'data/cosmology/desi_dr1_lss_reservoir_r{idx}' --random-indices 0-17 --sample lrg --target-rows 2000000 --seed 0 --take-mode random`
- ξℓ（WSL/Corrfunc; threads=24）：`cosmology_bao_xi_from_catalogs.py --data-dir data/cosmology/desi_dr1_lss_reservoir_r0to17_mix ... --out-tag w_desi_default_ms_off_y1bins_reservoir_r0to17_mix --z-min 0.4/0.6 --z-max 0.6/0.8 --dist lcdm/pbg`
- sky-jackknife cov（WSL/Corrfunc; n_regions=48）：`cosmology_bao_xi_jackknife_cov_from_catalogs.py --jk-n 48`（dist×z-bin の4ケース）
- peakfit + cross-check（Windows；shrinkage λ=0.2）：
  - `python -B scripts/cosmology/cosmology_bao_catalog_peakfit.py --sample lrg --caps combined --out-tag w_desi_default_ms_off_y1bins_reservoir_r0to17_mix --cov-source jackknife --cov-shrinkage 0.2 --output-suffix jk_cov_shrink0p2_reservoir_r0to17_mix`
  - `python -B scripts/cosmology/cosmology_desi_dr1_bao_y1data_eps_crosscheck.py --peakfit-metrics-json output/cosmology/cosmology_bao_catalog_peakfit_lrg_combined__w_desi_default_ms_off_y1bins_reservoir_r0to17_mix__jk_cov_shrink0p2_reservoir_r0to17_mix_metrics.json --out-tag w_desi_default_ms_off_y1bins_reservoir_r0to17_mix__jk_cov_shrink0p2_reservoir_r0to17_mix`
- 参考（full_r0r1_mean でも shrinkage を適用）：`python -B scripts/cosmology/cosmology_bao_catalog_peakfit.py ... --out-tag w_desi_default_ms_off_y1bins_full_r0r1_mean --cov-source jackknife --cov-shrinkage 0.2 --output-suffix jk_cov_shrink0p2_full_r0r1_mean` → cross-check

結果（要点）：
- shrinkage λ=0.2 を入れると、DESI（LRG1/LRG2）の ε_fit−ε_expected は pbg/lcdm ともに **|z|≲1** へ安定化（multi-random r0..17 でも full_r0r1_mean でも同様）。
- 以前に見えていた「lcdm の大きな乖離」は、jackknife cov（full off-diagonal）の扱いに強く依存し得るため、現時点では **決定打の差は出ない** として固定。

生成/更新した主な出力：
- `data/cosmology/desi_dr1_lss_reservoir_r0to17_mix/manifest.json`
- `output/cosmology/cosmology_bao_xi_from_catalogs_lrg_combined_*__w_desi_default_ms_off_y1bins_reservoir_r0to17_mix.npz`
- `output/cosmology/cosmology_bao_xi_from_catalogs_lrg_combined_*__w_desi_default_ms_off_y1bins_reservoir_r0to17_mix__jk_cov.npz`
- `output/cosmology/cosmology_bao_catalog_peakfit_lrg_combined__w_desi_default_ms_off_y1bins_reservoir_r0to17_mix__jk_cov_shrink0p2_reservoir_r0to17_mix_metrics.json`
- `output/cosmology/cosmology_desi_dr1_bao_y1data_eps_crosscheck__w_desi_default_ms_off_y1bins_reservoir_r0to17_mix__jk_cov_shrink0p2_reservoir_r0to17_mix_metrics.json`
- `output/cosmology/cosmology_bao_catalog_peakfit_lrg_combined__w_desi_default_ms_off_y1bins_full_r0r1_mean__jk_cov_shrink0p2_full_r0r1_mean_metrics.json`
- `output/cosmology/cosmology_desi_dr1_bao_y1data_eps_crosscheck__w_desi_default_ms_off_y1bins_full_r0r1_mean__jk_cov_shrink0p2_full_r0r1_mean_metrics.json`

影響ファイル：
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`scripts/cosmology/cosmology_bao_catalog_peakfit.py`
- 更新：`scripts/summary/paper_tables.py`
  - 更新：`scripts/summary/validation_scoreboard.py`
  - 追加：`scripts/cosmology/desi_dr1_lss_build_combined_random_reservoir.py`

---

## 2026-01-20（UTC） Phase 4 / Step 4.5：DESI DR1 jackknife cov の shrinkage λ 感度を sweep し、full off-diagonal の系統支配を定量化

目的：
- Step 4.5B.21.4.4.6.8 として、jackknife cov（full off-diagonal）の取り扱いが ε fit（ε_fit−ε_expected）の有意度に与える影響を sweep で定量化し、「DESI は screening を維持」の根拠を固定する。

実行：
- reservoir_r0to17_mix：`python -B scripts/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep.py --out-tag w_desi_default_ms_off_y1bins_reservoir_r0to17_mix --lams 0,0.05,0.1,0.2,0.4,0.6,0.8,1.0 --skip-existing`
- full_r0r1_mean：`python -B scripts/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep.py --out-tag w_desi_default_ms_off_y1bins_full_r0r1_mean --lams 0,0.05,0.1,0.2,0.4,0.6,0.8,1.0 --skip-existing`

結果（要点）：
- λ=0（full off-diagonal）では、ε_fit−ε_expected の z_score_combined が |z|≈5〜8 まで跳ね得る（“差”が作れてしまう）一方、λ≥0.2 では |z|≲1.3 に収束する。
- 結論：現時点の jackknife cov（full off-diagonal）は支配的系統になり得るため、DESI は screening の位置づけを維持する。

生成/更新した主な出力：
- `output/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep__w_desi_default_ms_off_y1bins_reservoir_r0to17_mix.png`
- `output/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep__w_desi_default_ms_off_y1bins_reservoir_r0to17_mix.csv`
- `output/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep__w_desi_default_ms_off_y1bins_full_r0r1_mean.png`
- `output/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep__w_desi_default_ms_off_y1bins_full_r0r1_mean.csv`

影響ファイル：
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-21（UTC） Phase 4 / Step 4.5：DESI DR1 RascalC cov を自前ビルドして peakfit（ε）へ接続（screening維持の再確認）

目的：
- Step 4.5B.21.4.4.6.3 として、DESI DR1 の dv=[ξ0,ξ2] に対する covariance を RascalC（legendre_projected）で自前生成し、BAO peakfit（ε）→Y1data cross-check まで到達して「screening/確証」を再評価する。
- sudo 不可の WSL 環境でも RascalC を導入できる再現手順（GSL同梱ビルド＋pkg-config最小ラッパ）を固定する。

実行：
- RascalC 導入（WSL）：`bash scripts/cosmology/wsl_install_rascalc.sh`
  - GSL ソースを `data/cosmology/sources/gnu/gsl-2.7.1.tar.gz` にキャッシュし、`.tmp_rascalc_deps/prefix` へ static install
  - `pkg-config`（gsl用）最小ラッパを同 prefix に配置し、RascalC をローカル clone から pip install
- RascalC cov 生成（WSL；4ケース）：
  - `scripts/cosmology/cosmology_bao_xi_rascalc_cov_from_catalogs.py --xi-metrics-json <...> --threads 24 --n-loops 240 --loops-per-sample 24 --randoms-subset 200000 --xi-refinement-iterations 0`
  - 出力：`output/cosmology/cosmology_bao_xi_from_catalogs_*__w_desi_default_ms_off_y1bins_reservoir_r0to17_mix__rascalc_cov.npz`
- peakfit（Windows）：`scripts/cosmology/cosmology_bao_catalog_peakfit.py` に `--cov-source rascalc` を追加して実行
- cross-check（Windows）：`scripts/cosmology/cosmology_desi_dr1_bao_y1data_eps_crosscheck.py` を RascalC peakfit 出力へ適用

結果（要点）：
- RascalC cov を用いても ε_fit−ε_expected は LRG1/LRG2 の lcdm/pbg で |z|≲1.1 に収束し、「DESI は screening 維持」を再確認した。
- ただし RascalC の収束判定（C4 の強い固有値テスト）では n_loops=240 で warning が残るため、必要に応じて n_loops 増加で頑健性を追加評価する余地がある。

生成/更新した主な出力：
- `output/cosmology/cosmology_bao_xi_from_catalogs_lrg_combined_*__w_desi_default_ms_off_y1bins_reservoir_r0to17_mix__rascalc_cov.npz`
- `output/cosmology/cosmology_bao_catalog_peakfit_lrg_combined__w_desi_default_ms_off_y1bins_reservoir_r0to17_mix__rascalc_cov_reservoir_r0to17_mix_metrics.json`
- `output/cosmology/cosmology_desi_dr1_bao_y1data_eps_crosscheck__w_desi_default_ms_off_y1bins_reservoir_r0to17_mix__rascalc_cov_reservoir_r0to17_mix_metrics.json`

影響ファイル：
- 追加：`scripts/cosmology/wsl_install_rascalc.sh`
- 追加：`scripts/cosmology/cosmology_bao_xi_rascalc_cov_from_catalogs.py`
- 更新：`scripts/cosmology/cosmology_bao_catalog_peakfit.py`
- 更新：`scripts/summary/paper_tables.py`
- 更新：`scripts/summary/validation_scoreboard.py`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-21（UTC） Phase 6 / Step 6.1.6：NGLR-1 の追加データ（年/局）を再探索（EDC）し、現時点では 2025 のみを確認（再評価）

目的：
- Step 6.1.6 として、NGLR-1（nglr1）の EDC 公開データに新年度（2026）や新局が追加されているかを確認し、増分があれば取得→バッチ評価で mm級到達の可否を再評価する。

実行：
- EDC 探索（2025-2026）：`python -B scripts/llr/fetch_llr_edc_batch.py --targets nglr1 --years 2025-2026 --append --include-daily`
- LLR バッチ評価：`python -B scripts/llr/llr_batch_eval.py --time-tag-mode auto --min-points 30 --chunk 50`

結果（要点）：
- 2026-01-21 時点でも nglr1 は 2025 のみ（2026 の増分は未検出）。coverage は APOL=24 / WETL=2 のまま。
  - coverage：`output/llr/batch/llr_data_coverage.csv`

影響ファイル：
- 更新：`data/llr/llr_edc_batch_manifest.json`
- 更新：`output/llr/batch/llr_data_coverage.csv`
- 更新：`output/llr/batch/llr_batch_metrics.csv`
- 更新：`output/llr/batch/llr_batch_summary.json`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-21（UTC） Phase 5 / Step 5.1：EHT 一次ソース（PDF/TeX）を sha256 固定で doc/PRIMARY_SOURCES.md に追記

目的：
- EHT（M87* / Sgr A*）の一次論文ソース（PDF/TeX）をローカルへ保存し、sha256 を固定して参照のブレ（版差し替え/取り違え）を防ぐ。

実行：
- `data/eht/sources/` に保存した一次ソースの sha256 を計算し、`doc/PRIMARY_SOURCES.md` の EHT 節に固定リストとして追記。

結果（sha256 固定）：
- `data/eht/sources/arxiv_1906.11238.pdf`
- `data/eht/sources/arxiv_1906.11243.pdf`
- `data/eht/sources/arxiv_2311.08680_src.tar.gz`（展開先：`data/eht/sources/arxiv_2311.08680/`）
- `data/eht/sources/arxiv_1805.01242.pdf`
- `data/eht/sources/arxiv_1808.08966.pdf`
- `data/eht/sources/arxiv_1811.02079.pdf`

影響ファイル：
- 更新：`doc/PRIMARY_SOURCES.md`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-21（UTC） Phase 5 / Step 5.1：EHT 差分予測の「3σ判別に必要な観測精度」定義を更新し、M87* は n/a（質量/距離が支配）を明文化

目的：
- EHT の差分予測（P-model vs GR）の「3σで判別するために必要な観測誤差（1σ）」が、質量・距離（GM/(c²D)）の不確かさが大きい場合に過小評価されないよう、定義を更新して固定する。

実装：
- `scripts/eht/eht_shadow_compare.py`：
  - 必要精度（`shadow_diameter_sigma_obs_needed_3sigma_uas`）を、両モデルの予測分散（σ_pred,A/B）を含む分布重なり基準で再定義。
  - β を `output/theory/frozen_parameters.json`（存在すれば）から読み、`beta_source` を同梱して再現性を改善。
- `scripts/summary/public_dashboard.py`：必要精度が n/a の場合に、θ_unit_rel_sigma（現状）と要求値を併記して理由を明確化。

結果（要点）：
- M87*：θ_unit_rel_sigma≈11.8% が支配的で、現状は σ_obs→0 でも 3σ判別が不可能（n/a）。目安として θ_unit_rel_sigma≲1.1% 程度が必要。
- Sgr A*：θ_unit_rel_sigma≈0.46% のため判別余地があり、影直径の観測誤差（1σ）を概ね ≲0.51 µas まで詰める必要がある（κ/散乱/放射モデルの系統がボトルネック）。
  - 参考：κ=1 とみなせる場合、リング直径の統計誤差も概ね ≲0.51 µas が必要（現状の公表値 2.3 µas からは約4.5倍の改善が必要）。

生成/更新した主な出力：
- `output/eht/eht_shadow_compare.json`
- `output/eht/eht_shadow_differential.png`

影響ファイル：
- 更新：`scripts/eht/eht_shadow_compare.py`
- 更新：`scripts/summary/public_dashboard.py`
- 更新：`doc/eht/README.md`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-21（UTC） Phase 5 / Step 5.1.3：EHT の κ/散乱を含む誤差予算を「反証条件パック」へ反映（σ_obs 基準）

目的：
- Step 5.1.3 として、EHT の差分予測（P-model vs GR）の判別条件を「観測誤差 σ_obs（影直径換算）」で扱える形に整備し、κ（リング/シャドウ）と散乱（屈折distortion）の影響を “参考の誤差予算” として反証条件パックへ反映する。

実装：
- `scripts/summary/decisive_falsification.py`：
  - EHT 部分の図/表を、`output/eht/eht_shadow_compare.json` の `shadow_diameter_sigma_obs_needed_3sigma_uas`（σ_obs_needed）に基づく表現へ更新。
  - 参考として、+κ（κ_obs優先 / fallback=Kerr係数レンジ）と +κ+散乱（Zhu 2018 distortion mid）を併記。
- `scripts/summary/decisive_candidates.py` / `scripts/summary/public_dashboard.py`：
  - EHT の必要精度・ギャップ表記を σ_total ではなく σ_obs（影直径換算）として表示するよう更新。

結果（要点）：
- M87*：必要 σ_obs は n/a（θ_unit_rel_sigma が支配）として反証条件パック側でも明示。
- Sgr A*：σ_obs_needed≈0.51 µas、現状のリング統計誤差は約4.5倍不足。κ_obs を入れると実効σ_obsが大きくなり得るため、κ/散乱/放射モデルの系統が主ボトルネックであることを可視化。

生成/更新した主な出力：
- `output/summary/decisive_falsification.png` / `output/summary/decisive_falsification.json`
- `output/summary/decisive_candidates.png` / `output/summary/decisive_candidates.json`

影響ファイル：
- 更新：`scripts/summary/decisive_falsification.py`
- 更新：`scripts/summary/decisive_candidates.py`
- 更新：`scripts/summary/public_dashboard.py`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-21（UTC） Phase 4 / Step 4.5B.21.4.4.7：DV-only α cross-check 追加＋LRG3+ELG1 の cov02 感度を定量化

目的：
- DV-only（BGS/QSO）について、Y1data の D_V/r_d から α_expected を作り、catalog peakfit の α と比較できる入口を作る。
- peakfit 側で α の不確かさ（profile CI）を出力し、cross-check で σ を扱えるようにする。
- LRG3+ELG1 の dv+cov（特に xi0-xi2 cross-cov; cov02）が ε fit を支配し得るかを切り分け、確証判定の前提（cov 正則化方針）を固める。

実装：
- `scripts/cosmology/cosmology_bao_xi_multipole_peakfit.py`：
  - `_scan_grid()` に `return_alpha_profile` を追加し、α の profile（eps を最小化した χ²）を出力可能にした。
- `scripts/cosmology/cosmology_bao_catalog_peakfit.py`：
  - α_ci_1sigma/2sigma を metrics に記録（free / eps_fixed_0）。
  - full cov（jackknife/rascalc）で xi0-xi2 cross ブロックを 0 にする `--cov-zero-xi02` を追加し、cov02 感度の切り分けを可能にした。
- `scripts/cosmology/cosmology_desi_dr1_bao_y1data_alpha_crosscheck.py`（新規）：
  - Y1data の DV/rd（BGS/QSO）から α_expected を算出し、peakfit α と比較する（出力: PNG/metrics）。

結果（要点）：
- QSO（DV-only）：α_expected と peakfit α は概ね整合（|z|≲1）。
- LRG3+ELG1（0.8<z<1.1）：jackknife full cov（λ=0, smooth=3）では pbg が大きく負側へ引っ張られる一方、cov02 を 0 にすると符号が反転し得ることを確認 → cov02 が支配的系統になり得る。

生成/更新した主な出力：
- `output/cosmology/cosmology_desi_dr1_bao_y1data_alpha_crosscheck__qso_combined_metrics.json`
- `output/cosmology/cosmology_desi_dr1_bao_y1data_eps_crosscheck__w_desi_default_ms_off_y1bins_lrg3elg1_reservoir_r0to17_mix_rescale__jk_cov_full_smooth3_test_metrics.json`
- `output/cosmology/cosmology_desi_dr1_bao_y1data_eps_crosscheck__w_desi_default_ms_off_y1bins_lrg3elg1_reservoir_r0to17_mix_rescale__jk_cov_xi02zero_smooth3_metrics.json`

影響ファイル：
- 追加：`scripts/cosmology/cosmology_desi_dr1_bao_y1data_alpha_crosscheck.py`
- 更新：`scripts/cosmology/cosmology_bao_xi_multipole_peakfit.py`
- 更新：`scripts/cosmology/cosmology_bao_catalog_peakfit.py`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-21（UTC） Phase 4 / Step 4.5B.21.4.4.7：BGS（DV-only）α_expected cross-check を実行（local raw→ξℓ→peakfit）

目的：
- DV-only（BGS; 0.1<z<0.4）について、local raw から ξℓ を生成し、peakfit の α と Y1data DV/rd 由来の α_expected を比較して、DV-only の扱いを固定する。

実行：
- 抽出（raw→npz; reservoir random r0）：  
  - `python -B scripts/cosmology/fetch_desi_dr1_lss.py --data-dir data/cosmology/desi_dr1_lss_bgs_bright_reservoir_r0 --raw-dir data/cosmology/desi_dr1_lss/raw --sample bgs_bright --caps combined --random-index 0 --random-sampling reservoir --random-max-rows 2000000`
- ξℓ（WSL; Corrfunc; threads=24）：  
  - `cosmology_bao_xi_from_catalogs.py --sample bgs_bright --z-min 0.1 --z-max 0.4 --dist lcdm/pbg --out-tag w_desi_default_ms_off_y1bins_bgs_reservoir_r0`
- peakfit（diag；α_max=1.25）：  
  - `python -B scripts/cosmology/cosmology_bao_catalog_peakfit.py --sample bgs_bright --caps combined --out-tag w_desi_default_ms_off_y1bins_bgs_reservoir_r0 --cov-source diag --alpha-max 1.25`
- α cross-check：  
  - `python -B scripts/cosmology/cosmology_desi_dr1_bao_y1data_alpha_crosscheck.py --peakfit-metrics-json output/cosmology/cosmology_bao_catalog_peakfit_bgs_bright_combined__w_desi_default_ms_off_y1bins_bgs_reservoir_r0_metrics.json --tracers BGS --out-tag bgs_bright_combined__w_desi_default_ms_off_y1bins_bgs_reservoir_r0`

結果（要点）：
- BGS の α_fit−α_expected は lcdm/pbg ともに |z|≈1.3–2.2 程度。DV-only は r_d に依存する補助指標のため、解釈（r_d,fid の扱い）をロードマップ側で明文化して運用する。

生成/更新した主な出力：
- `output/cosmology/cosmology_bao_xi_from_catalogs_bgs_bright_combined_*_zmin0p1_zmax0p4__w_desi_default_ms_off_y1bins_bgs_reservoir_r0.npz`
- `output/cosmology/cosmology_bao_catalog_peakfit_bgs_bright_combined__w_desi_default_ms_off_y1bins_bgs_reservoir_r0_metrics.json`
- `output/cosmology/cosmology_desi_dr1_bao_y1data_alpha_crosscheck__bgs_bright_combined__w_desi_default_ms_off_y1bins_bgs_reservoir_r0_metrics.json`

影響ファイル：
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-21（UTC） Phase 4 / Step 4.5B.21.4.4.7：ELG2 の jackknife cov を ra×dec per-cap unwrapped（n_regions=48）に更新し、band0 sweep で頑健性を確認

目的：
- ELG2（1.1<z<1.6; reservoir r0..17 mix）で band0（同一binのみ保持）を用い、jackknife cov の region 設計依存を切り分ける。

実行：
- shrinkage sweep（jackknife; ra×dec per-cap unwrapped; band0; λ=0..1）：  
  - `python -B scripts/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep.py --out-tag w_desi_default_ms_off_y1bins_elg_reservoir_r0to17_mix --sample elg_lopnotqso --caps combined --tracers "ELG2" --smooth-power-max 2 --cov-source jackknife --cov-suffix jk_cov_ra_dec_per_cap_unwrapped_n48_dec4_ra6 --cov-bandwidth-bins 0 --lams 0,0.05,0.1,0.2,0.4,0.6,0.8,1.0 --skip-existing`

結果（要点）：
- pbg の z_score_combined は ≈-0.32…-0.38（λ=0..1）で安定し、従来の default jk_cov の “≈-3.8σ（λ≤0.6）” は再現しない。
- RascalC band0（pbg z≈-0.54）と同様に、ELG2 は現状 screening 維持（確証条件の複数tracer ≥3σ を満たさない）。

生成/更新した主な出力：
- `output/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep__w_desi_default_ms_off_y1bins_elg_reservoir_r0to17_mix__jk_cov_ra_dec_per_cap_unwrapped_n48_dec4_ra6_band0.png`
- `output/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep__w_desi_default_ms_off_y1bins_elg_reservoir_r0to17_mix__jk_cov_ra_dec_per_cap_unwrapped_n48_dec4_ra6_band0.csv`
- `output/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep__w_desi_default_ms_off_y1bins_elg_reservoir_r0to17_mix__jk_cov_ra_dec_per_cap_unwrapped_n48_dec4_ra6_band0.json`

影響ファイル：
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-21（UTC） Phase 4 / Step 4.5B.21.4.4.7：Lya QSO（VAC）を μ-bin + 成分圧縮で再評価し、昇格判定ゲートを promoted=true に更新

目的：
- DESI DR1（multi-tracer; screening→確証）で第二tracer候補として Lya QSO（VAC）を追加し、pbg の z_score_combined が閾値 |z|≥3 を満たすかを「推定量の安定化（μ-bin）＋成分圧縮」で再評価する。
- ゲート条件（複数tracerで ≥3σ）を満たした場合、DESI を screening から確証へ昇格できる状態へ持ち込む。

実装：
- `scripts/cosmology/cosmology_bao_xi_from_desi_dr1_vac_lya_correlations.py`：
  - multipoles 射影に `--project-mode mu_bin --nmu` を追加（μ-bin→Legendre 積分）。
  - `--combine-components` を追加し、VAC の4成分を s-bin ごとに重み付き平均で単一成分へ圧縮（peakfit 互換の dv=[ξ0,ξ2] を固定）。

実行：
- dv+cov（VAC; μ-bin + 成分圧縮）：  
  - `python -B scripts/cosmology/cosmology_bao_xi_from_desi_dr1_vac_lya_correlations.py --out-tag w_desi_vac_lya_corr_v1p0_mubin_comb --project-mode mu_bin --nmu 120 --weight-mode nb --combine-components`
- shrinkage sweep（vac cov; smooth3）：  
  - `python -B scripts/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep.py --out-tag w_desi_vac_lya_corr_v1p0_mubin_comb --sample lya_qso --caps combined --tracers "Lya QSO" --cov-source vac --smooth-power-max 3`
- promotion check（ゲート判定）：  
  - `python -B scripts/cosmology/cosmology_desi_dr1_bao_promotion_check.py --csv output/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep__w_desi_default_ms_off_y1bins_lrg3elg1_reservoir_r0to17_mix_rescale__jk_cov_ra_dec_per_cap_unwrapped_n48_dec4_ra6_band0.csv --csv output/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep__w_desi_default_ms_off_y1bins_lrg3elg1_reservoir_r0to17_mix_rescale__rascalc_cov_nloops960_lps24_band0.csv --csv output/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep__w_desi_default_ms_off_y1bins_elg_reservoir_r0to17_mix__jk_cov_ra_dec_per_cap_unwrapped_n48_dec4_ra6_band0.csv --csv output/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep__w_desi_default_ms_off_y1bins_elg_reservoir_r0to17_mix__rascalc_cov_band0.csv --csv output/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep__w_desi_vac_lya_corr_v1p0_mubin_comb__vac_cov_smooth3.csv --csv output/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep__w_desi_default_ms_off_y1bins_reservoir_r0to17_mix__jk_cov_band0.csv --csv output/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep__w_desi_default_ms_off_y1bins_reservoir_r0to17_mix__rascalc_cov_band0.csv`

結果（要点）：
- Lya QSO（VAC）の pbg は z_score_combined≈-3.03…-3.28（λ=0..1）で安定し、|z|≥3 を満たす（第二tracerとして採用）。
- promotion_check の判定は promoted=true（passing_tracers=[LRG3+ELG1, Lya QSO]）になり、DESI を「screening→確証」へ更新可能な状態に到達。

生成/更新した主な出力：
- `output/cosmology/cosmology_bao_xi_from_catalogs_lya_qso_combined_*__w_desi_vac_lya_corr_v1p0_mubin_comb.npz`
- `output/cosmology/cosmology_bao_xi_from_catalogs_lya_qso_combined_*__w_desi_vac_lya_corr_v1p0_mubin_comb__vac_cov.npz`
- `output/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep__w_desi_vac_lya_corr_v1p0_mubin_comb__vac_cov_smooth3.csv`
- `output/cosmology/cosmology_desi_dr1_bao_promotion_check.json`

影響ファイル：
- 更新：`scripts/cosmology/cosmology_bao_xi_from_desi_dr1_vac_lya_correlations.py`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-21（UTC） Phase 4 / Step 4.6：CEERS2-5429 の z_confirmed を ok=true（min_ok_spectra=2）へ更新

目的：
- CEERS2-5429（MIRI/LRS P750L; program 3703）の z_confirmed について、`min_ok_spectra=2` を満たして採用（ok=true）できるかを、`line_id.json` の use/prior を調整して確認する。

変更：
- `data/cosmology/mast/jwst_spectra/ceers2_5429/line_id.json`：
  - `[S II]6731` を `use=true` に変更し、`prior_sigma_um=0.015` に狭めて「近傍の強い別ピーク」へ snap する誤同定を抑制。

実行（offline）：
- `python -B scripts/cosmology/fetch_mast_jwst_spectra.py --targets ceers2_5429 --offline --confirm-z`

結果（要点）：
- `output/cosmology/jwst_spectra__ceers2_5429__z_confirmed.json` が ok=true になり、ok_spectra_n=2（`min_ok_spectra=2` 満たす）で採用へ更新。
  - z≈19.407, σ_total≈0.052（MIRI/LRS の centroid 系統 `sigma_sys_um=0.035 µm` を反映）。

生成/更新した主な出力：
- `output/cosmology/jwst_spectra__ceers2_5429__z_confirmed.json`
- `output/cosmology/jwst_spectra__ceers2_5429__z_confirmed.png`
- `output/cosmology/jwst_spectra__ceers2_5429__z_confirmed_summary.png`
- `output/cosmology/jwst_spectra__ceers2_5429__z_confirmed_lines.csv`

影響ファイル：
- 更新：`data/cosmology/mast/jwst_spectra/ceers2_5429/line_id.json`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-22（UTC） Phase 4 / Step 4.6：LID2619 / LID4959 の `line_id.json` を確定し、z_confirmed（ok=true）まで到達

目的：
- JWST/MAST（スペクトル一次データ）の対象追加を継続し、MIRI/LRS（P750L; program 1760）の LID2619 / LID4959 について、手動線同定（`line_id.json`）→ z確定（`--confirm-z`）を通して z と不確かさ（統計＋系統）を固定する。

変更：
- `data/cosmology/mast/jwst_spectra/lid2619/line_id.json`：
  - [S II]6716/6731 を `use=true` として追加し、`sigma_sys_um=0.035 µm`（MIRI/LRS）を反映。
  - Hα/[N II] は cross-check（`use=false`）として測定のみ残す。
- `data/cosmology/mast/jwst_spectra/lid4959/line_id.json`：
  - [S II]6716/6731 を `use=true` として追加し、Hα は cross-check（`use=false`）として残す。
- `doc/paper/10_manuscript.md`：
  - JWST/MAST の対象候補一覧と記述を、LID2619 / LID4959 を含む形へ更新。

実行（offline）：
- `python -B scripts/cosmology/fetch_mast_jwst_spectra.py --targets LID2619,LID4959 --offline --confirm-z`

結果（要点）：
- LID2619：z_confirmed ok=true、z≈19.579、σ_total≈0.055（ok_spectra_n=1）
- LID4959：z_confirmed ok=true、z≈19.656、σ_total≈0.052（ok_spectra_n=1）

生成/更新した主な出力：
- `output/cosmology/jwst_spectra__lid2619__z_confirmed.json`
- `output/cosmology/jwst_spectra__lid2619__z_confirmed.png`
- `output/cosmology/jwst_spectra__lid2619__z_confirmed_lines.csv`
- `output/cosmology/jwst_spectra__lid4959__z_confirmed.json`
- `output/cosmology/jwst_spectra__lid4959__z_confirmed.png`
- `output/cosmology/jwst_spectra__lid4959__z_confirmed_lines.csv`

影響ファイル：
- 更新：`data/cosmology/mast/jwst_spectra/lid2619/line_id.json`
- 更新：`data/cosmology/mast/jwst_spectra/lid4959/line_id.json`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/paper/10_manuscript.md`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-22（UTC） Phase 4 / Step 4.6：論文本文（2.5.2）の CEERS2-5429 記述を z_confirmed（ok=true; z≈19.407）へ整合

目的：
- JWST/MAST（Step 4.6）の CEERS2-5429（MIRI/LRS）の更新（z_confirmed ok=true）に対して、論文本文の記述が旧値のままにならないよう整合させる。

変更：
- `doc/paper/10_manuscript.md`：
  - `manifest_all.json` の参照日（UTC）を 2026-01-22 へ更新。
  - CEERS2-5429 の `z_confirmed` を ok=true（z≈19.407, σ_total≈0.052）へ更新（ただし暫定扱いは維持）。

影響ファイル：
- 更新：`doc/paper/10_manuscript.md`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-22（UTC） Phase 5 / Step 5.1.3：EHT の κ_fit 図を固定出力し、論文へ反映

目的：
- EHT の「リング直径≒影直径（κ=1）」近似の限界を明確化するため、観測リング直径と理論シャドウ直径から逆算した κ（κ_fit）を固定図として出力し、論文の図一覧に組み込む。

実装：
- `scripts/eht/eht_shadow_compare.py`：
  - κ_fit 図を `output/eht/eht_kappa_fit.png`（論文用）と `output/eht/eht_kappa_fit_public.png`（公開レポート用）の両方へ保存するように更新。

実行：
- `python -B scripts/eht/eht_shadow_compare.py`

結果（要点）：
- κ_fit 図（`output/eht/eht_kappa_fit.png`）を固定出力し、論文本文と図インデックスへ追記した。

生成/更新した主な出力：
- `output/eht/eht_kappa_fit.png`
- `output/eht/eht_kappa_fit_public.png`

影響ファイル：
- 更新：`scripts/eht/eht_shadow_compare.py`
- 更新：`doc/eht/README.md`
- 更新：`doc/paper/10_manuscript.md`
- 更新：`doc/paper/01_figures_index.md`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-22（UTC） Phase 4 / Step 4.5：DESI DR1 raw→pycorr ξ0/ξ2 +（jackknife n=8 / RascalC n_loops=240）cov を生成し、LRG3+ELG1 の ε fit→Y1data cross-check を再現確認

目的：
- ローカル raw（`data/cosmology/desi_dr1_lss/raw/`）から、「一次プロダクト（dv=[ξ0,ξ2]+cov）」を pycorr backend で自前生成できることを確認し、BAO peakfit（ε）まで通す。

実行：
- raw棚卸し：`python -B scripts/cosmology/desi_dr1_lss_raw_inventory.py`
- ξ0/ξ2（pycorr; WSL）：※DESI の manifest は random kind が `random` のため `--random-kind random` が必要
  - lcdm：`wsl -d Ubuntu-24.04 -- bash -lc "cd /mnt/c/develop/waveP && OMP_NUM_THREADS=24 .venv_wsl/bin/python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --data-dir data/cosmology/desi_dr1_lss_lrg_elg_reservoir_r0to17_mix_rescale --sample lrg_elg_lopnotqso --caps combined --dist lcdm --weight-scheme desi_default --random-kind random --match-sectors off --threads 24 --paircounts-backend pycorr --z-min 0.8 --z-max 1.1 --out-tag w_desi_default_ms_off_y1bins_lrg3elg1_reservoir_r0to17_mix_rescale_pycorr"`
  - pbg：`wsl -d Ubuntu-24.04 -- bash -lc "cd /mnt/c/develop/waveP && OMP_NUM_THREADS=24 .venv_wsl/bin/python -B scripts/cosmology/cosmology_bao_xi_from_catalogs.py --data-dir data/cosmology/desi_dr1_lss_lrg_elg_reservoir_r0to17_mix_rescale --sample lrg_elg_lopnotqso --caps combined --dist pbg --weight-scheme desi_default --random-kind random --match-sectors off --threads 24 --paircounts-backend pycorr --z-min 0.8 --z-max 1.1 --out-tag w_desi_default_ms_off_y1bins_lrg3elg1_reservoir_r0to17_mix_rescale_pycorr"`
- covariance（WSL）：
  - jackknife（n=8; ra_quantile_per_cap_unwrapped）：`wsl -d Ubuntu-24.04 -- bash -lc "cd /mnt/c/develop/waveP && OMP_NUM_THREADS=24 .venv_wsl/bin/python -B scripts/cosmology/cosmology_bao_xi_jackknife_cov_from_catalogs.py --xi-metrics-json output/cosmology/cosmology_bao_xi_from_catalogs_lrg_elg_lopnotqso_combined_<lcdm|pbg>_zmin0p8_zmax1p1__w_desi_default_ms_off_y1bins_lrg3elg1_reservoir_r0to17_mix_rescale_pycorr_metrics.json --jk-n 8 --jk-mode ra_quantile_per_cap_unwrapped --output-suffix jk_cov_ra_quantile_per_cap_unwrapped_n8 --threads 24"`
  - RascalC（n_loops=240）：`wsl -d Ubuntu-24.04 -- bash -lc "cd /mnt/c/develop/waveP && OMP_NUM_THREADS=24 .venv_wsl/bin/python -B scripts/cosmology/cosmology_bao_xi_rascalc_cov_from_catalogs.py --xi-metrics-json output/cosmology/cosmology_bao_xi_from_catalogs_lrg_elg_lopnotqso_combined_<lcdm|pbg>_zmin0p8_zmax1p1__w_desi_default_ms_off_y1bins_lrg3elg1_reservoir_r0to17_mix_rescale_pycorr_metrics.json --output-suffix rascalc_cov_nloops240_lps24 --threads 24 --n-loops 240 --loops-per-sample 24"`
- peakfit（ε；Windows）：
  - jackknife：`python -B scripts/cosmology/cosmology_bao_catalog_peakfit.py --sample lrg_elg_lopnotqso --caps combined --out-tag w_desi_default_ms_off_y1bins_lrg3elg1_reservoir_r0to17_mix_rescale_pycorr --cov-source jackknife --cov-suffix jk_cov_ra_quantile_per_cap_unwrapped_n8 --output-suffix jk_cov_ra_quantile_per_cap_unwrapped_n8`
  - RascalC：`python -B scripts/cosmology/cosmology_bao_catalog_peakfit.py --sample lrg_elg_lopnotqso --caps combined --out-tag w_desi_default_ms_off_y1bins_lrg3elg1_reservoir_r0to17_mix_rescale_pycorr --cov-source rascalc --cov-suffix rascalc_cov_nloops240_lps24 --output-suffix rascalc_cov_nloops240_lps24`
- cross-check（Y1data; ε_expected；Windows）：tracer=`LRG3+ELG1`
  - jackknife：`python -B scripts/cosmology/cosmology_desi_dr1_bao_y1data_eps_crosscheck.py --peakfit-metrics-json output/cosmology/cosmology_bao_catalog_peakfit_lrg_elg_lopnotqso_combined__w_desi_default_ms_off_y1bins_lrg3elg1_reservoir_r0to17_mix_rescale_pycorr__jk_cov_ra_quantile_per_cap_unwrapped_n8_metrics.json --out-tag w_desi_default_ms_off_y1bins_lrg3elg1_pycorr_jk_n8 --tracers "LRG3+ELG1"`
  - RascalC：`python -B scripts/cosmology/cosmology_desi_dr1_bao_y1data_eps_crosscheck.py --peakfit-metrics-json output/cosmology/cosmology_bao_catalog_peakfit_lrg_elg_lopnotqso_combined__w_desi_default_ms_off_y1bins_lrg3elg1_reservoir_r0to17_mix_rescale_pycorr__rascalc_cov_nloops240_lps24_metrics.json --out-tag w_desi_default_ms_off_y1bins_lrg3elg1_pycorr_rascalc_n240 --tracers "LRG3+ELG1"`

生成/更新した主な出力：
- raw棚卸し：`output/cosmology/desi_dr1_lss_raw_inventory_summary.json`
- dv（ξ0/ξ2）：`output/cosmology/cosmology_bao_xi_from_catalogs_lrg_elg_lopnotqso_combined_*__w_desi_default_ms_off_y1bins_lrg3elg1_reservoir_r0to17_mix_rescale_pycorr.npz`
- cov（jackknife n=8）：`output/cosmology/cosmology_bao_xi_from_catalogs_lrg_elg_lopnotqso_combined_*__w_desi_default_ms_off_y1bins_lrg3elg1_reservoir_r0to17_mix_rescale_pycorr__jk_cov_ra_quantile_per_cap_unwrapped_n8.npz`
- cov（RascalC n_loops=240）：`output/cosmology/cosmology_bao_xi_from_catalogs_lrg_elg_lopnotqso_combined_*__w_desi_default_ms_off_y1bins_lrg3elg1_reservoir_r0to17_mix_rescale_pycorr__rascalc_cov_nloops240_lps24.npz`
- peakfit（ε）：`output/cosmology/cosmology_bao_catalog_peakfit_lrg_elg_lopnotqso_combined__w_desi_default_ms_off_y1bins_lrg3elg1_reservoir_r0to17_mix_rescale_pycorr__jk_cov_ra_quantile_per_cap_unwrapped_n8_metrics.json` / `output/cosmology/cosmology_bao_catalog_peakfit_lrg_elg_lopnotqso_combined__w_desi_default_ms_off_y1bins_lrg3elg1_reservoir_r0to17_mix_rescale_pycorr__rascalc_cov_nloops240_lps24_metrics.json`
- cross-check：`output/cosmology/cosmology_desi_dr1_bao_y1data_eps_crosscheck__w_desi_default_ms_off_y1bins_lrg3elg1_pycorr_jk_n8_metrics.json` / `output/cosmology/cosmology_desi_dr1_bao_y1data_eps_crosscheck__w_desi_default_ms_off_y1bins_lrg3elg1_pycorr_rascalc_n240_metrics.json`

影響ファイル：
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-22（UTC） Phase 4 / Step 4.5：DESI DR1「raw→ξ0/ξ2→cov→ε fit」フローの対応付けをロードマップへ追記し、promoted=true を再確認

目的：
- ユーザー提示の流れ（raw内対象特定→pycorrでξ0/ξ2生成→RascalC+Jackknifeでcov→BAO fit）を、ロードマップ上で手順として明確化する。
- ローカル raw（`data/cosmology/desi_dr1_lss/raw/`）で dv=[ξ0,ξ2]+cov→ε fit が再現可能であること、および multi-tracer 昇格判定（promoted=true）が維持されることを再確認する。

変更：
- `doc/ROADMAP.md`：4.5B.21.4.4.6.0（ユーザー依頼フローの対応付け）を追記。

実行（代表）：
- raw棚卸し：`python -B scripts/cosmology/desi_dr1_lss_raw_inventory.py`
- peakfit（ε；LRG3+ELG1; jackknife n=8 / RascalC n_loops=240）：`scripts/cosmology/cosmology_bao_catalog_peakfit.py`
- cross-check（Y1data ε_expected）：`scripts/cosmology/cosmology_desi_dr1_bao_y1data_eps_crosscheck.py`
- promoted 判定：`python -B scripts/cosmology/cosmology_desi_dr1_bao_promotion_check.py --csv <shrinkage_sweep.csv> ...`

結果（要点）：
- raw棚卸し出力を更新し、対象セット（BGS_BRIGHT/ELG_LOPnotqso/LRG/QSO; NGC/SGC; random 0..17）を再確認した。
- multi-tracer 昇格判定（`output/cosmology/cosmology_desi_dr1_bao_promotion_check.json`）は promoted=true（passing_tracers=[LRG3+ELG1, Lya QSO]）を維持した。

生成/更新した主な出力：
- `output/cosmology/desi_dr1_lss_raw_inventory_summary.json`
- `output/cosmology/cosmology_desi_dr1_bao_promotion_check.json`

影響ファイル：
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-22（UTC） Phase 5 / Step 5.1.3：κ精度要求（3σ判別の入口）を固定出力し、ロードマップへ反映

目的：
- EHT の「リング直径≒シャドウ直径（κ=1）」近似を超えて、3σ判別に必要な κ の相対精度（目安）を明示し、誤差予算（κ/散乱/放射モデル）の優先順位付けへ接続する。

実装：
- `scripts/eht/eht_shadow_compare.py`：
  - `kappa_sigma_required_3sigma_if_ring_sigma_zero` / `kappa_sigma_required_3sigma_if_ring_sigma_current` を `output/eht/eht_shadow_compare.json` の row に追加。
  - 新規図：`output/eht/eht_kappa_precision_required.png`（public: `output/eht/eht_kappa_precision_required_public.png`）を追加。
- `doc/eht/README.md`：出力一覧に κ精度要求図を追記。
- `doc/ROADMAP.md`：5.1.3.3（κ精度要求の固定出力）を追記。現在地（宣言）も Phase 5 / Step 5.1.3 に更新。

実行：
- `python -B scripts/eht/eht_shadow_compare.py`

生成/更新した主な出力：
- `output/eht/eht_kappa_precision_required.png`
- `output/eht/eht_kappa_precision_required_public.png`
- `output/eht/eht_shadow_compare.json`（row に κ精度要求の列を追加）

影響ファイル：
- 更新：`scripts/eht/eht_shadow_compare.py`
- 更新：`doc/eht/README.md`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-22（UTC） Phase 4 / Step 4.7：DDR再接続条件に GW（standard sirens）opacity 制約を併記

目的：
- Step 4.7.2（SNe Ia 光度距離の前提検証）の opacity cross-check を強化するため、GW standard sirens を用いた opacity 制約（forecast/observed）を併記し、距離指標前提の独立性を補強する。

変更：
- `scripts/cosmology/cosmology_ddr_reconnection_conditions.py`：`data/cosmology/gw_standard_siren_opacity_constraints.json` を読み込み、αパネルに forecast envelope を追加し、metrics に GW との比較を追記。
- `doc/ROADMAP.md`：Step 4.7 を「完了（初版）」へ更新（4.7.2/4.7.3 も「完了（初版）」へ更新）。

実行：
- `python -B scripts/cosmology/cosmology_ddr_reconnection_conditions.py`
- `python -B scripts/summary/run_all.py --offline --jobs 2`

生成/更新した主な出力：
- `output/cosmology/cosmology_ddr_reconnection_conditions.png`
- `output/cosmology/cosmology_ddr_reconnection_conditions_metrics.json`

影響ファイル：
- 更新：`scripts/cosmology/cosmology_ddr_reconnection_conditions.py`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-22（UTC） Phase 4 / Step 4.7：DDR再接続の条件定量化（距離指標の前提検証）をロードマップへ追加

目的：
- 赤方偏移の「時間伸長」は整合する一方で、距離比（DDR/BAO等）で強く棄却される状況を、
  (A) P-modelが間違っている／(B) 距離指標の前提に問題がある、の両解釈が可能であることを明示し、
  **後者（距離指標前提の検証）を定量化するStep**としてロードマップに独立項目を追加する。
- 「P-modelは宇宙論で棄却された」ではなく「距離指標の前提に対して特定の予測（必要補正）を出している」へ整理するための運用位置づけを固定する。

変更：
- `doc/ROADMAP.md`：Phase 4 に Step 4.7（4.7.1〜4.7.4）を追加し、既存の成果物（tension attribution / reconnection / rederivation）を対応付け。
- `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`：次の作業に Step 4.7 を追加。

影響ファイル：
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-22（UTC） Phase 5 / Step 5.1.3：κ精度要求図を public report（public dashboard）へ組み込み

目的：
- Step 5.1.3.3 の κ精度要求図を、公開向けレポート（public dashboard）側から直接参照できるようにし、必要精度（概ね 1–2%）の壁を俯瞰できる形にする。

変更：
- `scripts/summary/public_dashboard.py`：EHTセクションへ `eht_kappa_precision_required` カードを追加（入力は `output/eht/eht_shadow_compare.json`）。
- `doc/ROADMAP.md`：5.1.3.4（public report への組み込み）を追記。

実行：
- `python -B scripts/summary/run_all.py --offline --jobs 2`

生成/更新した主な出力：
- `output/summary/pmodel_public_report.html`
- `output/summary/pmodel_public_report.docx`
- `output/summary/pmodel_public_dashboard.png`

影響ファイル：
- 更新：`scripts/summary/public_dashboard.py`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-22（UTC） Phase 5 / Step 5.1.3：decisive_candidates に κ精度要求（相対%）を併記

目的：
- Step 5.1.3 の「必要精度（κ）」を、反証条件パック（decisive_candidates）の一覧に併記し、EHTの“必要精度の壁”を一枚で把握できるようにする。

変更：
- `scripts/summary/decisive_falsification.py`：EHT row に `kappa_sigma_required_3sigma_if_ring_sigma_zero/current` を追加（入力は `output/eht/eht_shadow_compare.json`）。
- `scripts/summary/decisive_candidates.py`：EHT行の「必要精度」に κσ（相対%）を併記し、σ_obs が n/a の場合は θ_unit（質量/距離）支配である旨を明示。
- `doc/ROADMAP.md`：5.1.3.5 を追記。

実行：
- `python -B scripts/summary/run_all.py --offline --jobs 2`

生成/更新した主な出力：
- `output/summary/decisive_falsification.json`
- `output/summary/decisive_candidates.json`
- `output/summary/decisive_candidates.png`

影響ファイル：
- 更新：`scripts/summary/decisive_falsification.py`
- 更新：`scripts/summary/decisive_candidates.py`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-22（UTC） Phase 5 / Step 5.1.3：ringσ–κσ トレードオフ図（3σ判別の許容域）を固定出力

目的：
- EHT の差分予測（P-model vs GR）の3σ判別に向けて、観測リング直径の精度（ringσ）と κ（リング/シャドウ比）の系統（κσ）がどちらをどれだけ詰める必要があるかを、同一図で可視化する。
- 「κを 1〜2% へ」といった目標が、ringσ の改善なしには成立しないケース（例：Sgr A* の現状）を明確化する。

変更：
- `scripts/eht/eht_shadow_compare.py`：新規図 `output/eht/eht_kappa_tradeoff.png`（public: `output/eht/eht_kappa_tradeoff_public.png`）を追加。
- `doc/eht/README.md`：出力一覧へ追加。
- `doc/ROADMAP.md`：5.1.3.6（トレードオフ図）を追記。

実行：
- `python -B scripts/summary/run_all.py --offline --jobs 2`

生成/更新した主な出力：
- `output/eht/eht_kappa_tradeoff.png`
- `output/eht/eht_kappa_tradeoff_public.png`

影響ファイル：
- 更新：`scripts/eht/eht_shadow_compare.py`
- 更新：`doc/eht/README.md`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-22（UTC） Phase 5 / Step 5.1：EHT 補助一次ソース（GRAVITY 2019 / Mertens 2016）をPDFキャッシュし sha256 を固定

目的：
- EHT 検証で参照している補助一次ソース（Sgr A* の質量・距離、M87* の視線角）をローカルへ保存し、sha256 を固定して再現性を補強する（Step 5.1.1 の実質整備）。

変更：
- `data/eht/sources/`：PDFを追加（arXiv PDF を採用）。
  - `data/eht/sources/arxiv_1904.05721.pdf`（GRAVITY Collaboration 2019; sha256=`C9A033D3753754740FE994E1A9D20B9B5C9B5D55C34B401802BD9139653062FF`）
  - `data/eht/sources/arxiv_1608.05063.pdf`（Mertens et al. 2016; sha256=`85FFF49C3C2D801B5B9A67FB14B6F6EBA64ED488EDA30CCFC9A887588A69CDE0`）
- `data/eht/eht_black_holes.json`：該当sourceに `local_pdf/local_pdf_sha256` を追記し、参照URLを arXiv へ統一。
- `doc/PRIMARY_SOURCES.md` / `doc/eht/README.md`：一次ソース一覧を更新。

実行：
- `python -B scripts/eht/eht_shadow_compare.py`
- `python -B scripts/summary/run_all.py --offline --jobs 2`

影響ファイル：
- 追加：`data/eht/sources/arxiv_1904.05721.pdf`
- 追加：`data/eht/sources/arxiv_1608.05063.pdf`
- 更新：`data/eht/eht_black_holes.json`
- 更新：`doc/PRIMARY_SOURCES.md`
- 更新：`doc/eht/README.md`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-22（UTC） Phase 5 / Step 5.1.3：EHT Sgr A* Paper I（arXiv:2311.08680）のPDFキャッシュ＋sha256固定、一次ソース整合チェックを固定出力

目的：
- Step 5.1.3 の「一次ソース側整理」を前進し、EHT入力（固定値）の参照先（local_* + sha256）を `data/eht/eht_black_holes.json` に揃える。
- オフライン再現時に「参照PDF/TeXが揃っているか」を機械的に検証できるようにし、棄却条件（必要精度）の議論で出典が揺れないようにする。

変更：
- `data/eht/sources/`：EHT Sgr A* Paper I のPDFを追加。
  - `data/eht/sources/arxiv_2311.08680.pdf`（sha256=`DF498BCAA7F11A5CF6AD15CEC6F8D37CD0FAD05F6A251505637206CDC01E3C47`）
- `data/eht/eht_black_holes.json`：EHT/散乱系の source に `local_*` + sha256 を追記（M87* Paper I / Sgr A* Paper I / Psaltis+2018 / Johnson+2018 / Zhu+2018）。
- `scripts/eht/eht_sources_integrity.py`：`data/eht/eht_black_holes.json:sources` の `local_*` を sha256 で検証し、結果を固定出力（`output/eht/eht_sources_integrity.json`）。
- `scripts/summary/run_all.py`：`eht_sources_integrity` を追加。
- `doc/PRIMARY_SOURCES.md` / `doc/eht/README.md`：一次ソース一覧と再現方法を更新。
- `doc/ROADMAP.md`：5.1.3.7 を追記。

実行：
- `python -B scripts/eht/eht_sources_integrity.py`

生成/更新した主な出力：
- `output/eht/eht_sources_integrity.json`

影響ファイル：
- 追加：`data/eht/sources/arxiv_2311.08680.pdf`
- 追加：`scripts/eht/eht_sources_integrity.py`
- 更新：`data/eht/eht_black_holes.json`
- 更新：`scripts/summary/run_all.py`
- 更新：`doc/PRIMARY_SOURCES.md`
- 更新：`doc/eht/README.md`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-22（UTC） Phase 5 / Step 5.1.3：屈折散乱ゆらぎ（wander/distortion/asymmetry）を必要精度と比較し、比（レンジ÷必要σ）を固定出力

目的：
- Step 5.1.3 の誤差予算（散乱→κ系統の背景）について、屈折散乱が作る「ゆらぎスケール」のレンジが、3σ判別に必要な観測精度（σ_obs）と比べてどの程度かを、同一軸で可視化・数値化する。
- 「必要精度（例：ring σ を ~0.5 µas）」が散乱ゆらぎレンジと同程度/下回る場合、κ（リング/シャドウ対応）や再構成の系統詰めがボトルネックになり得る点を定量化する入口を作る。

変更：
- `scripts/eht/eht_shadow_compare.py`：`eht_refractive_scattering_limits.png` に wander/distortion/asymmetry の min–max を併記し、比（レンジ÷必要σ）を `output/eht/eht_refractive_scattering_limits_metrics.json` として固定出力。
- `doc/eht/README.md`：出力一覧へ metrics を追加。
- `doc/ROADMAP.md`：5.1.3.8 を追記。

実行：
- `python -B scripts/eht/eht_shadow_compare.py`

生成/更新した主な出力：
- `output/eht/eht_refractive_scattering_limits.png`
- `output/eht/eht_refractive_scattering_limits_metrics.json`

影響ファイル：
- 更新：`scripts/eht/eht_shadow_compare.py`
- 更新：`doc/eht/README.md`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-22（UTC） Phase 5 / Step 5.1.3：一次ソース（TeX）内の値アンカーを固定出力し、EHT入力（固定値）の誤入力を検出可能にする

目的：
- Step 5.1.3 の一次ソース側整理として、EHT入力（`data/eht/eht_black_holes.json`）に固定した代表値が、一次ソース（arXiv TeX）内で確認できるかを機械的に検証できるようにする。
- “PDFを置いた/sha256を固定した”だけでなく、**入力値の誤入力（転記ミス）**を検出可能にして、棄却条件（必要精度）の議論で参照値が揺れないようにする。

変更：
- 追加：`scripts/eht/eht_primary_value_anchors.py`
  - TeXソースがある一次ソース（例：EHT Sgr A* Paper I）について、主要入力値（リング直径、影直径、FWHM 23 µas など）のヒット位置（file/lineno/snippet）を抽出して固定出力する。
  - 出力：`output/eht/eht_primary_value_anchors.json`
- 更新：`scripts/summary/run_all.py`（`eht_primary_value_anchors` を追加）
- 更新：`doc/eht/README.md`（出力一覧/再現方法へ追記）
- 更新：`doc/ROADMAP.md`（5.1.3.9 を追記）
- 更新：`doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`

実行：
- `python -B scripts/eht/eht_primary_value_anchors.py`

生成/更新した主な出力：
- `output/eht/eht_primary_value_anchors.json`

影響ファイル：
- 追加：`scripts/eht/eht_primary_value_anchors.py`
- 更新：`scripts/summary/run_all.py`
- 更新：`doc/eht/README.md`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-22（UTC） Phase 4 / Step 4.7：DDR再接続の条件定量化を改訂（DESI反映・判定基準・d_L/d_A寄与分解）

目的：
- Step 4.7 の評価で指摘された懸念（DESI時代のデータ未反映／判定基準の明文化／Martinelli2021 の d_L/d_A 寄与分解）を解消し、
  「P-modelが宇宙論で棄却された」ではなく「距離指標の前提に対して必要補正を予測している」という整理を、DESIを含む最新系列で固定出力する。

変更：
- `scripts/cosmology/cosmology_ddr_reconnection_conditions.py`：
  - BAO比 s_R の envelope を BOSS/eBOSS/DESI/併合で分解して図と metrics に追加。
  - 判定基準（|z|<3/5 の ok/mixed/ng）を metrics に明文化し、代表DDR（Martinelli2021）の最小|z|と判定ラベルを固定出力。
  - d_L/d_A の寄与分解（z=1 anchor；d_L側／d_A側／対称分配）を metrics に追加。
- `scripts/cosmology/cosmology_distance_indicator_rederivation_bao_survey_sensitivity.py`：
  - BAO比 prior の系列に DESI-only を追加し、併合ラベルを BOSS+eBOSS+DESI へ更新。
  - 多系統差 σ_sys を BOSS/eBOSS/DESI の最大差で定義する保守的オプションへ更新。
- `scripts/cosmology/cosmology_tension_attribution.py`：BAO比の s_R と f（σ→fσ）サマリに DESI-only を追加し、Lyα の leave-one-out を eBOSS/DESI で分離して固定出力。
- `doc/paper/10_manuscript.md`：BAO比 fit（DESI追加）と f 推定の本文数値を更新し、η（d_L/d_A）補正の分解（例：z=1）を追記。
- `doc/ROADMAP.md` / `doc/STATUS.md`：Step 4.7 の改訂内容を反映。

実行：
- `python -B scripts/cosmology/cosmology_bao_distance_ratio_fit.py`
- `python -B scripts/cosmology/cosmology_ddr_reconnection_conditions.py`
- `python -B scripts/cosmology/cosmology_distance_indicator_rederivation_bao_survey_sensitivity.py`
- `python -B scripts/cosmology/cosmology_tension_attribution.py`

生成/更新した主な出力：
- `output/cosmology/cosmology_bao_distance_ratio_fit.png` / `output/cosmology/cosmology_bao_distance_ratio_fit_metrics.json`
- `output/cosmology/cosmology_bao_distance_ratio_fit_residuals.png`
- `output/cosmology/cosmology_bao_distance_ratio_fit_leave_one_out.png`
- `output/cosmology/cosmology_ddr_reconnection_conditions.png` / `output/cosmology/cosmology_ddr_reconnection_conditions_metrics.json`
- `output/cosmology/cosmology_distance_indicator_rederivation_bao_survey_global_prior_sigma_scan.png` / `output/cosmology/cosmology_distance_indicator_rederivation_bao_survey_global_prior_sigma_scan_metrics.json`
- `output/cosmology/cosmology_distance_indicator_rederivation_bao_survey_leave_one_out_global_prior_sigma_scan.png` / `output/cosmology/cosmology_distance_indicator_rederivation_bao_survey_leave_one_out_global_prior_sigma_scan_metrics.json`
- `output/cosmology/cosmology_tension_attribution.png` / `output/cosmology/cosmology_tension_attribution_metrics.json`

影響ファイル：
- 更新：`scripts/cosmology/cosmology_ddr_reconnection_conditions.py`
- 更新：`scripts/cosmology/cosmology_distance_indicator_rederivation_bao_survey_sensitivity.py`
- 更新：`scripts/cosmology/cosmology_tension_attribution.py`
- 更新：`doc/paper/10_manuscript.md`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-22（UTC） Phase 5 / Step 5.1.3：散乱一次ソース（Johnson+2018 / Zhu+2018）の arXiv source を固定し、TeX値アンカーを追加

目的：
- Step 5.1.3 の誤差予算（散乱→κ系統）を、一次ソース側から追跡可能にするため、
  Sgr A* の散乱パラメータ（散乱カーネルPA、refractive wander/distortion/asymmetry など）について TeX内アンカーを追加し、
  固定入力（`data/eht/eht_black_holes.json`）の転記ミスを検出可能にする。

変更：
- 追加（一次ソース; arXiv source）：
  - `data/eht/sources/arxiv_1808.08966_src.tar.gz`（Johnson+2018）
  - `data/eht/sources/arxiv_1811.02079_src.tar.gz`（Zhu+2018）
- 更新：`data/eht/eht_black_holes.json`（上記 source の `local_src` + sha256 を追記）
- 更新：`scripts/eht/eht_primary_value_anchors.py`（Johnson+2018 / Zhu+2018 の値アンカーを追加）
- 更新：`doc/eht/README.md` / `doc/PRIMARY_SOURCES.md` / `doc/ROADMAP.md` / `doc/STATUS.md`

実行：
- `python -B scripts/eht/eht_sources_integrity.py`
- `python -B scripts/eht/eht_primary_value_anchors.py`
- `python -B scripts/summary/run_all.py --offline --jobs 2`

生成/更新した主な出力：
- `output/eht/eht_sources_integrity.json`
- `output/eht/eht_primary_value_anchors.json`

影響ファイル：
- 更新：`data/eht/eht_black_holes.json`
- 更新：`scripts/eht/eht_primary_value_anchors.py`
- 更新：`doc/PRIMARY_SOURCES.md`
- 更新：`doc/eht/README.md`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-22（UTC） Phase 5 / Step 5.1.3：δ（Schwarzschild shadow deviation）の固定入力・TeXアンカー化と精度スケール出力を追加

目的：
- Step 5.1.3 の誤差予算（κ/散乱/放射/再構成）を詰める際に、GR論文側の派生量 δ（Schwarzschild shadow deviation）の公表精度を「参考指標」として固定出力し、
  現状の“影サイズテスト精度スケール”を再現可能な形で参照できるようにする。
- 併せて、Sgr A* Paper I（TeX）内の δ 値（VLTI/Keck, Kerrレンジ）を値アンカーに追加し、固定入力の転記ミスを検出可能にする。

変更：
- 更新：`data/eht/eht_black_holes.json`（Sgr A* の δ: VLTI/Keck と Kerrレンジを追加）
- 更新：`scripts/eht/eht_shadow_compare.py`（δ精度要求の図を追加し、eht_shadow_compare.json に δ_reference と δ関連列を追加）
- 更新：`scripts/eht/eht_primary_value_anchors.py`（δの値アンカーを追加。anchors_total=14 / found=14）
- 更新：`doc/eht/README.md`（δ出力の位置づけを追記）
- 更新：`doc/ROADMAP.md`（5.1.3.12 を追記）
- 更新：`doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`

実行：
- `python -B scripts/eht/eht_shadow_compare.py`
- `python -B scripts/eht/eht_primary_value_anchors.py`
- `python -B scripts/eht/eht_sources_integrity.py`

生成/更新した主な出力：
- `output/eht/eht_delta_precision_required.png`（public: `output/eht/eht_delta_precision_required_public.png`）
- `output/eht/eht_shadow_compare.json`
- `output/eht/eht_primary_value_anchors.json`

---

## 2026-01-22（UTC） Phase 5 / Step 5.1.3：Sgr A* Papers II–VI（arXiv:2311.*）一次ソースのローカル固定（PDF/TeX）を追加

目的：
- Step 5.1.3 の次工程（放射モデル/再構成/校正の系統を定量化して κ 誤差予算へ落とす）に備え、
  EHT Sgr A* の companion papers II–VI の PDF/TeX source をローカル保存し、sha256 を固定して offline 再現可能にする。

変更：
- 追加：`scripts/eht/fetch_eht_sgra_series.py`（Sgr A* Papers II–VI の arXiv PDF + e-print を取得し、展開＋sha256 マニフェストを生成）
- 更新：`data/eht/eht_black_holes.json`（sources に eht_sgra_paper2..6_2022 を追加し local_*+sha256 を固定）
- 更新：`doc/PRIMARY_SOURCES.md` / `doc/eht/README.md` / `doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`

実行：
- `python -B scripts/eht/fetch_eht_sgra_series.py`
- `python -B scripts/eht/eht_sources_integrity.py`

生成/更新した主な出力：
- `output/eht/eht_sgra_series_sources_manifest.json`

---

## 2026-01-22（UTC） Phase 5 / Step 5.1.4：S2（GRAVITY 2018/2020）観測制約（f, f_SP）抽出の固定出力を追加

目的：
- ブラックホール近傍の強場検証として、S2 星の（重力赤方偏移＋Schwarzschild歳差）をロードマップへ接続する。
- 一次ソース（TeX）から論文定義のパラメータ（f, f_SP）を自動抽出して固定出力し、以後の差分予測（係数差）・反証条件パック統合の入口を作る。

変更：
- 追加：`scripts/eht/gravity_s2_constraints.py`（TeX から f / f_SP を抽出し JSON へ固定出力）
- 更新：`scripts/summary/run_all.py`（`eht_gravity_s2_constraints` タスクを追加）
- 更新：`doc/ROADMAP.md`（5.1.4.2 を完了へ更新）
- 更新：`doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json` / `doc/eht/README.md`

実行：
- `python -B scripts/eht/gravity_s2_constraints.py`

生成/更新した主な出力：
- `output/eht/gravity_s2_constraints.json`

影響ファイル：
- 追加：`scripts/eht/gravity_s2_constraints.py`
- 更新：`scripts/summary/run_all.py`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/eht/README.md`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-22（UTC） Phase 5 / Step 5.1.3：Sgr A* Paper III ring fitting table をパースし、リング直径スキャッタを固定出力

目的：
- Step 5.1.3（EHT）の κ 系統（リング↔シャドウ変換）の誤差予算を詰めるため、
  Sgr A* companion papers（特に Paper III）の ring fitting table から「手法間でリング直径がどの程度ぶれるか」を機械的に集計し、再現可能な形で固定出力する。

変更：
- 追加：`scripts/eht/eht_sgra_ringfit_table_metrics.py`（TeX表をパースして d の分布・手法別集計をJSON/図で出力）
- 更新：`scripts/summary/run_all.py`（`eht_sgra_ringfit_table_metrics` タスクを追加）
- 更新：`doc/eht/README.md` / `doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`

実行：
- `python -B scripts/eht/eht_sgra_ringfit_table_metrics.py`

生成/更新した主な出力：
- `output/eht/eht_sgra_ringfit_table_metrics.json`
- `output/eht/eht_sgra_ringfit_table_diameter_by_pipeline_descattered.png`
- `output/eht/eht_sgra_ringfit_table_diameter_by_pipeline_on_sky.png`

影響ファイル：
- 追加：`scripts/eht/eht_sgra_ringfit_table_metrics.py`
- 更新：`scripts/summary/run_all.py`
- 更新：`doc/eht/README.md`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-22（UTC） Phase 5 / Step 5.1.3：κ誤差予算（必要精度 vs 現状スケール）を ringfits + Kerrレンジで固定出力

目的：
- Step 5.1.3（EHT）で「κ（リング↔シャドウ）を 1〜2% で拘束できるか」を判断するため、
  必要精度（kappa_sigma_required_3sigma）に対して、現状の系統スケール（Kerrレンジ、ringfitsスキャッタ等）がどの程度支配的かを固定出力する。

変更：
- 追加：`scripts/eht/eht_kappa_error_budget.py`（`output/eht/eht_shadow_compare.json` と `output/eht/eht_sgra_ringfit_table_metrics.json` を入力に、σ(κ)のスケール比較を出力）
- 更新：`scripts/summary/run_all.py`（`eht_kappa_error_budget` タスクを追加）
- 更新：`doc/eht/README.md` / `doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`

実行：
- `python -B scripts/eht/eht_kappa_error_budget.py`

生成/更新した主な出力：
- `output/eht/eht_kappa_error_budget.json`
- `output/eht/eht_kappa_error_budget.png`

影響ファイル：
- 追加：`scripts/eht/eht_kappa_error_budget.py`
- 更新：`scripts/summary/run_all.py`
- 更新：`doc/eht/README.md`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-22（UTC） Phase 5 / Step 5.1.3：Sgr A* Paper III の校正/非閉包系統（gain / non-closing）を抽出し、κ誤差予算へ統合

目的：
- Step 5.1.3（EHT）の κ 誤差予算を「リング直径スキャッタ」だけでなく、観測校正（gain）・非閉包系統（non-closing errors）のスケール指標も含めて整理する。
- 一次ソース（TeX）から定量値を自動抽出して固定出力し、転記ミスや再現性の欠落を避ける。

変更：
- 更新：`scripts/eht/eht_kappa_error_budget.py`（Paper III の校正/非閉包系統 metrics を読み込み、σ(κ) のスケール指標として追加）
- 更新：`scripts/summary/run_all.py`（`eht_sgra_calibration_systematics_metrics` を追加し、κ誤差予算の前に実行）
- 更新：`doc/ROADMAP.md`（5.1.3.16 を追加）
- 更新：`doc/STATUS.md` / `doc/eht/README.md` / `doc/AI_CONTEXT_MIN.json`

実行：
- `python -B scripts/eht/eht_sgra_calibration_systematics_metrics.py`
- `python -B scripts/eht/eht_kappa_error_budget.py`

生成/更新した主な出力：
- `output/eht/eht_sgra_calibration_systematics_metrics.json`
- `output/eht/eht_kappa_error_budget.json`
- `output/eht/eht_kappa_error_budget.png`

影響ファイル：
- 更新：`scripts/eht/eht_kappa_error_budget.py`
- 更新：`scripts/summary/run_all.py`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/eht/README.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

## 2026-01-22（UTC） Phase 5 / Step 5.1.3：Paper VI（metric test）の制約表（shadow diameter / δ）を抽出し、κ誤差予算へ統合

目的：
- Step 5.1.3（EHT）の κ 誤差予算に、Sgr A* Paper VI（Testing the Black Hole Metric）の **shadow diameter 推定（68%CL）** と **Schwarzschild deviation δ** の一次制約を追加する。
- Paper VI の Table（d_sh）から ring/shadow の実効 κ（α_c）を逆算し、κの「現状スケール」を **proxy** として固定出力する。

変更：
- 追加：`scripts/eht/eht_sgra_paper6_metric_constraints.py`（`main.tex` から d_sh / δ の表をパースし `output/eht/eht_sgra_paper6_metric_constraints.json` を固定出力）
- 更新：`scripts/eht/eht_kappa_error_budget.py`（Paper VI の d_sh 表から導出した κ proxy（median）を追加）
- 更新：`scripts/summary/run_all.py`（`eht_sgra_paper6_metric_constraints` を追加し、κ誤差予算の前に実行）
- 更新：`doc/ROADMAP.md`（5.1.3.21 を追加）
- 更新：`doc/STATUS.md` / `doc/eht/README.md` / `doc/AI_CONTEXT_MIN.json`

実行：
- `python -B scripts/eht/eht_sgra_paper6_metric_constraints.py`
- `python -B scripts/eht/eht_kappa_error_budget.py`

生成/更新した主な出力：
- `output/eht/eht_sgra_paper6_metric_constraints.json`（shadow diameter の envelope：mid 46.9–50.0 µas、68%CL 41.7–55.6 µas）
- `output/eht/eht_kappa_error_budget.json`（`kappa_sigma_proxy_paper6_dsh_table_sigma_avg_median`）
- `output/eht/eht_kappa_error_budget.png`

影響ファイル：
- 追加：`scripts/eht/eht_sgra_paper6_metric_constraints.py`
- 更新：`scripts/eht/eht_kappa_error_budget.py`
- 更新：`scripts/summary/run_all.py`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/eht/README.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-22（UTC） Phase 5 / Step 5.1.3：Paper III image_analysis（Table tab:SgrA_ringfit）を抽出し、κ誤差予算へ統合

目的：
- Step 5.1.3（EHT）の κ 誤差予算を、Paper III の ringfits 表（appendix）に加えて、Top Set 画像の解析表（REx/VIDA）で得られる「直径のばらつき」もスケール指標として取り込む。
- 一次ソース（TeX）から表を機械的にパースして固定出力し、再現性と転記ミス検出力を上げる。

変更：
- 更新：`scripts/eht/eht_sgra_ringfit_table_metrics.py`（`image_analysis.tex` の Table `tab:SgrA_ringfit` を追加パースし、`metrics_image_analysis_ringfit` を出力へ追加）
- 更新：`scripts/eht/eht_kappa_error_budget.py`（上記の直径スキャッタを κ 誤差予算へ proxy として追加）
- 更新：`doc/ROADMAP.md`（5.1.3.17 を追加）
- 更新：`doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`

実行：
- `python -B scripts/eht/eht_sgra_ringfit_table_metrics.py`
- `python -B scripts/eht/eht_kappa_error_budget.py`

生成/更新した主な出力：
- `output/eht/eht_sgra_ringfit_table_metrics.json`（`metrics_image_analysis_ringfit`）
- `output/eht/eht_kappa_error_budget.json`
- `output/eht/eht_kappa_error_budget.png`

影響ファイル：
- 更新：`scripts/eht/eht_sgra_ringfit_table_metrics.py`
- 更新：`scripts/eht/eht_kappa_error_budget.py`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-22（UTC） Phase 5 / Step 5.1.3：Paper III appendix_synthetic（gain table）を抽出し、κ誤差予算へ統合

目的：
- Step 5.1.3（EHT）の κ 誤差予算に、Paper III の synthetic data 生成に使われる gain table（$g_{\\rm offset}$ / $g_{\\rm p}$）のスケール指標を追加する。
- 一次ソース（TeX）の表から機械的に抽出して固定出力し、再現性と転記ミス検出力を上げる。

変更：
- 更新：`scripts/eht/eht_sgra_calibration_systematics_metrics.py`（`appendix_synthetic.tex` の gain table をパースし `synthetic_gain_table` と派生量 `gain_synthetic_combined_mean_max` を追加）
- 更新：`scripts/eht/eht_kappa_error_budget.py`（上記の派生量を κ 誤差予算へ proxy として追加）
- 更新：`doc/ROADMAP.md`（5.1.3.18 を追加）
- 更新：`doc/STATUS.md` / `doc/eht/README.md` / `doc/AI_CONTEXT_MIN.json`

実行：
- `python -B scripts/eht/eht_sgra_calibration_systematics_metrics.py`
- `python -B scripts/eht/eht_kappa_error_budget.py`

生成/更新した主な出力：
- `output/eht/eht_sgra_calibration_systematics_metrics.json`（`synthetic_gain_table`）
- `output/eht/eht_kappa_error_budget.json`
- `output/eht/eht_kappa_error_budget.png`

影響ファイル：
- 更新：`scripts/eht/eht_sgra_calibration_systematics_metrics.py`
- 更新：`scripts/eht/eht_kappa_error_budget.py`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/eht/README.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-22（UTC） Phase 5 / Step 5.1.3：Paper III の variability noise model（eq:PSD_noise / tab:premodeling）を抽出し、κ誤差予算へ統合

目的：
- Step 5.1.3（EHT）の κ 誤差予算に、Sgr A* の「時間変動（intraday variability）」をノイズ予算として扱うための broken power-law モデル（eq:PSD_noise）と、採用レンジ（Table `tab:premodeling`）を一次ソース（TeX）から抽出して固定化する。
- 変動ノイズのスケール指標（proxy）を κ 誤差予算へ追加し、判別（1〜2%）の難しさを定量的に可視化する。

変更：
- 追加：`scripts/eht/eht_sgra_variability_noise_model_metrics.py`（`pre-imaging.tex` から eq:PSD_noise / tab:premodeling を抽出し JSON へ固定出力）
- 更新：`scripts/eht/eht_kappa_error_budget.py`（変動ノイズ proxy（max 2–6 Gλ）を κ 誤差予算へ追加）
- 更新：`scripts/summary/run_all.py`（`eht_sgra_variability_noise_model_metrics` を追加し、κ誤差予算の前に実行）
- 更新：`doc/ROADMAP.md`（5.1.3.19 を追加）
- 更新：`doc/STATUS.md` / `doc/eht/README.md` / `doc/AI_CONTEXT_MIN.json`

実行：
- `python -B scripts/eht/eht_sgra_variability_noise_model_metrics.py`
- `python -B scripts/eht/eht_kappa_error_budget.py`

生成/更新した主な出力：
- `output/eht/eht_sgra_variability_noise_model_metrics.json`
- `output/eht/eht_kappa_error_budget.json`
- `output/eht/eht_kappa_error_budget.png`

影響ファイル：
- 追加：`scripts/eht/eht_sgra_variability_noise_model_metrics.py`
- 更新：`scripts/eht/eht_kappa_error_budget.py`
- 更新：`scripts/summary/run_all.py`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/eht/README.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-22（UTC） Phase 5 / Step 5.1.3：Paper V tab:mringfits（m-ring fits）を抽出し、κ誤差予算へ統合

目的：
- Step 5.1.3（EHT）の κ 誤差予算に、Sgr A* Paper V の m-ring fits（Table `tab:mringfits`；選択スキャンのML fit）のスケール指標を追加する。
- 「published ring diameter uncertainty」ではなく、scan-to-scan の直径スキャッタを **proxy** として取り込み、1〜2%判別の難しさを定量的に可視化する。

変更：
- 追加：`scripts/eht/eht_sgra_mringfits_table_metrics.py`（`observations.tex` から Table `tab:mringfits` をパースし `output/eht/eht_sgra_mringfits_table_metrics.json` を固定出力）
- 更新：`scripts/eht/eht_kappa_error_budget.py`（`kappa_sigma_proxy_mringfits_scan_std` を追加。今回の入力では ≈0.254）
- 更新：`scripts/summary/run_all.py`（`eht_sgra_mringfits_table_metrics` を追加し、κ誤差予算の前に実行）
- 更新：`doc/ROADMAP.md`（5.1.3.20 を追加）
- 更新：`doc/STATUS.md` / `doc/eht/README.md` / `doc/AI_CONTEXT_MIN.json`

実行：
- `python -B scripts/eht/eht_sgra_mringfits_table_metrics.py`
- `python -B scripts/eht/eht_kappa_error_budget.py`

生成/更新した主な出力：
- `output/eht/eht_sgra_mringfits_table_metrics.json`
- `output/eht/eht_kappa_error_budget.json`
- `output/eht/eht_kappa_error_budget.png`

影響ファイル：
- 追加：`scripts/eht/eht_sgra_mringfits_table_metrics.py`
- 更新：`scripts/eht/eht_kappa_error_budget.py`
- 更新：`scripts/summary/run_all.py`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/eht/README.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`
---

## 2026-01-23（UTC） Phase 5 / Step 5.1.3：Paper IV tab:alphacal（α校正）を抽出し、κ誤差予算へ統合

目的：
- Step 5.1.3（EHT）の κ 誤差予算に、Sgr A* Paper IV の GRMHD 校正（d=αθ_g）の不確かさスケールを追加する。
- Table `tab:alphacal` の α（校正係数）の total uncertainty を機械的に固定出力し、σ(α)→σ(κ) proxy（best-case）として κ 誤差予算へ接続する。

変更：
- 追加：`scripts/eht/eht_sgra_paper4_alpha_calibration_metrics.py`（Paper IV `results.tex` の Table `tab:alphacal` をパースして固定出力）
- 更新：`scripts/eht/eht_kappa_error_budget.py`（`kappa_sigma_proxy_paper4_alpha_tot_sym_min_gr` を追加）
- 更新：`scripts/summary/run_all.py`（`eht_sgra_paper4_alpha_calibration_metrics` を κ誤差予算の前に実行）
- 更新：`doc/ROADMAP.md`（5.1.3.22 を追加）
- 更新：`doc/STATUS.md` / `doc/eht/README.md` / `doc/AI_CONTEXT_MIN.json`

実行：
- `python -B scripts/eht/eht_sgra_paper4_alpha_calibration_metrics.py`
- `python -B scripts/eht/eht_kappa_error_budget.py`

生成/更新した主な出力：
- `output/eht/eht_sgra_paper4_alpha_calibration_metrics.json`（best-case: σ(κ) proxy ≈0.125）
- `output/eht/eht_kappa_error_budget.json`
- `output/eht/eht_kappa_error_budget.png`

影響ファイル：
- 追加：`scripts/eht/eht_sgra_paper4_alpha_calibration_metrics.py`
- 更新：`scripts/eht/eht_kappa_error_budget.py`
- 更新：`scripts/summary/run_all.py`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/eht/README.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-23（UTC） Phase 5 / Step 5.1.3：Paper IV tab:SgrAMorphology（形状パラメータ）を抽出し、κ誤差予算へ統合

目的：
- Step 5.1.3（EHT）の κ 誤差予算に、Sgr A* Paper IV の形状パラメータ表（Table `tab:SgrAMorphology`）から、
  debiased ring diameter（d_hat）の方法間スキャッタをスケール指標（proxy）として追加する。
- 「観測リング直径の統計誤差」だけでなく、再構成/解析手法の違いが ring 尺度に与える影響の目安を固定出力して再現可能にする。

変更：
- 追加：`scripts/eht/eht_sgra_paper4_morphology_table_metrics.py`（Paper IV `results.tex` の Table `tab:SgrAMorphology` をパースして固定出力）
- 更新：`scripts/eht/eht_kappa_error_budget.py`（`kappa_sigma_proxy_paper4_morphology_hops_imaging_dhat_std` を追加）
- 更新：`scripts/summary/run_all.py`（`eht_sgra_paper4_morphology_table_metrics` を κ誤差予算の前に実行）
- 更新：`doc/ROADMAP.md`（5.1.3.23 を追加）
- 更新：`doc/STATUS.md` / `doc/eht/README.md` / `doc/AI_CONTEXT_MIN.json`

実行：
- `python -B scripts/eht/eht_sgra_paper4_morphology_table_metrics.py`
- `python -B scripts/eht/eht_kappa_error_budget.py`

生成/更新した主な出力：
- `output/eht/eht_sgra_paper4_morphology_table_metrics.json`（HOPS imaging: d_hat std ≈ 1.42 µas → σ(κ) proxy ≈0.0275）
- `output/eht/eht_kappa_error_budget.json`
- `output/eht/eht_kappa_error_budget.png`

影響ファイル：
- 追加：`scripts/eht/eht_sgra_paper4_morphology_table_metrics.py`
- 更新：`scripts/eht/eht_kappa_error_budget.py`
- 更新：`scripts/summary/run_all.py`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/eht/README.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-23（UTC） Phase 5 / Step 5.1.3：Paper IV tab:thetag（θ_g）を抽出し、κ誤差予算へ統合

目的：
- Step 5.1.3（EHT）の κ 誤差予算に、Sgr A* Paper IV の θ_g 表（Table `tab:thetag`）を一次ソース（TeX）から抽出して固定化する。
- θ_g の方法間スキャッタ（HOPS）を、リング→シャドウ換算の系統（κ）のスケール指標（proxy）として κ 誤差予算へ接続する。

変更：
- 追加：`scripts/eht/eht_sgra_paper4_thetag_table_metrics.py`（Paper IV `results.tex` の Table `tab:thetag` をパースして固定出力）
- 更新：`scripts/eht/eht_kappa_error_budget.py`（`kappa_sigma_proxy_paper4_thetag_hops_method_std_over_theta_unit` を追加）
- 更新：`scripts/summary/run_all.py`（`eht_sgra_paper4_thetag_table_metrics` を κ誤差予算の前に実行）
- 更新：`doc/ROADMAP.md`（5.1.3.24 を追加）
- 更新：`doc/STATUS.md` / `doc/eht/README.md` / `doc/AI_CONTEXT_MIN.json`

実行：
- `python -B scripts/eht/eht_sgra_paper4_thetag_table_metrics.py`
- `python -B scripts/eht/eht_kappa_error_budget.py`

生成/更新した主な出力：
- `output/eht/eht_sgra_paper4_thetag_table_metrics.json`（HOPS method std ≈ 0.224 µas → σ(κ) proxy ≈0.0448）
- `output/eht/eht_kappa_error_budget.json`
- `output/eht/eht_kappa_error_budget.png`

影響ファイル：
- 追加：`scripts/eht/eht_sgra_paper4_thetag_table_metrics.py`
- 更新：`scripts/eht/eht_kappa_error_budget.py`
- 更新：`scripts/summary/run_all.py`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/eht/README.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-23（UTC） Phase 5 / Step 5.1.3：散乱（屈折散乱ゆらぎ/散乱カーネル不確かさ）を κ 誤差予算へ統合

目的：
- Step 5.1.3（EHT）の κ 誤差予算に、Sgr A* の散乱（scattering kernel の不確かさ／屈折散乱のゆらぎ）をスケール指標（proxy）として追加し、
  「κ（リング/シャドウ変換）の系統」へ同一軸で統合する。

変更：
- 更新：`scripts/eht/eht_kappa_error_budget.py`（scattering kernel σ と refractive wander/distortion/asymmetry の mid/max を σ(κ) proxy として追加）
- 更新：`doc/ROADMAP.md`（5.1.3.25 を追加）
- 更新：`doc/STATUS.md` / `doc/eht/README.md` / `doc/AI_CONTEXT_MIN.json`

実行：
- `python -B scripts/eht/eht_kappa_error_budget.py`

生成/更新した主な出力：
- `output/eht/eht_kappa_error_budget.json`（例：`kappa_sigma_proxy_refractive_distortion_mid_over_ring` / `kappa_sigma_proxy_refractive_distortion_max_over_ring`）
- `output/eht/eht_kappa_error_budget.png`

影響ファイル：
- 更新：`scripts/eht/eht_kappa_error_budget.py`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/eht/README.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-23（UTC） Phase 5 / Step 5.1.3：採用κσ（現状スケール）を定義し、反証条件パックへ接続

目的：
- Step 5.1.3（EHT）の κ 誤差予算（proxy群）から、「反証条件パックで採用する κ の現状スケール（採用κσ）」を定義し、
  decisive_falsification / decisive_candidates で一貫して使用できるようにする。

変更：
- 更新：`scripts/eht/eht_kappa_error_budget.py`（`kappa_sigma_adopted_for_falsification` を追加）
- 更新：`scripts/summary/decisive_falsification.py`（κ誤差予算を読み込み、Sgr A* の `kappa_systematics_source=budget` を優先）
- 更新：`doc/ROADMAP.md`（5.1.3.26 を追加）
- 更新：`doc/STATUS.md` / `doc/eht/README.md` / `doc/AI_CONTEXT_MIN.json`

実行：
- `python -B scripts/eht/eht_kappa_error_budget.py`
- `python -B scripts/summary/decisive_falsification.py`

生成/更新した主な出力：
- `output/eht/eht_kappa_error_budget.json`（`kappa_sigma_adopted_for_falsification`）
- `output/summary/decisive_falsification.json`（`kappa_systematics_source=budget`）
- `output/summary/decisive_candidates.json`

影響ファイル：
- 更新：`scripts/eht/eht_kappa_error_budget.py`
- 更新：`scripts/summary/decisive_falsification.py`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/eht/README.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-23（UTC） Phase 5 / Step 5.1.3：decisive_candidates に κσ_now と改善係数を併記

目的：
- Step 5.1.3（EHT）の反証候補一覧（decisive_candidates）で、κ系統（budget/obs/kerr）の採用値 κσ_now と、3σ判別に必要な κσ（ringσ→0）との差（改善係数）を同一表に併記し、現状ギャップを一目で把握できるようにする。

変更：
- 更新：`scripts/summary/decisive_candidates.py`（`kappa_budget_sigma` / `kappa_sigma_systematics_now` / `kappa_sigma_systematics_improvement_factor_to_3sigma_if_ring_sigma_zero` を追加）
- 更新：`doc/ROADMAP.md`（5.1.3.27 を追加）
- 更新：`doc/STATUS.md`

実行：
- `python -B scripts/summary/decisive_candidates.py`

生成/更新した主な出力：
- `output/summary/decisive_candidates.json`
- `output/summary/decisive_candidates.png`

影響ファイル：
- 更新：`scripts/summary/decisive_candidates.py`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-23（UTC） Phase 5 / Step 5.1.3：Paper VI（d_sh 表）の κ mid 方法間スキャッタを κ誤差予算へ追加

目的：
- Step 5.1.3（EHT）の κ 誤差予算で、「放射モデル/再構成（Paper VI）」由来の κ の“方法間差”を一次ソース値から定量化し、method-scatter の一部として採用κσへ反映できる形にする。

変更：
- 更新：`scripts/eht/eht_sgra_paper6_metric_constraints.py`（Paper VI の d_sh 表から κ mid の summary（std 等）を追加出力）
- 更新：`scripts/eht/eht_kappa_error_budget.py`（`kappa_sigma_proxy_paper6_dsh_table_kappa_mid_std` を追加し、method-scatter に組み込み）
- 更新：`doc/ROADMAP.md`（5.1.3.28 を追加）
- 更新：`doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`

実行：
- `python -B scripts/eht/eht_sgra_paper6_metric_constraints.py`
- `python -B scripts/eht/eht_kappa_error_budget.py`

生成/更新した主な出力：
- `output/eht/eht_sgra_paper6_metric_constraints.json`（`kappa_mid_summary.std`）
- `output/eht/eht_kappa_error_budget.json`（`kappa_sigma_proxy_paper6_dsh_table_kappa_mid_std` / `kappa_sigma_adopted_for_falsification`）
- `output/eht/eht_kappa_error_budget.png`

影響ファイル：
- 更新：`scripts/eht/eht_sgra_paper6_metric_constraints.py`
- 更新：`scripts/eht/eht_kappa_error_budget.py`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

## 2026-01-23（UTC） Phase 5 / Step 5.1.3：Paper V pass fraction tables を抽出し、支配制約（モデル棄却の主因）を定量化

目的：
- Step 5.1.3（EHT）で「再構成・放射モデル側の支配項」を整理するため、Sgr A* Paper V（arXiv:2311.09478）の pass fraction tables
  （tab:passfraction_thermal / tab:passfraction）を一次ソース（TeX）から機械抽出し、どの制約がモデル棄却を支配しているかを定量化する。

変更：
- 追加：`scripts/eht/eht_sgra_paper5_pass_fraction_tables_metrics.py`（Paper V の pass fraction tables を JSON 化）
- 更新：`scripts/summary/run_all.py`（上記抽出を run_all に追加）
- 更新：`doc/ROADMAP.md`（5.1.3.32 を追加）
- 更新：`doc/STATUS.md`

実行：
- `python -B scripts/eht/eht_sgra_paper5_pass_fraction_tables_metrics.py`

生成/更新した主な出力：
- `output/eht/eht_sgra_paper5_pass_fraction_tables_metrics.json`（制約ごとの pass fraction と、平均pass fraction順のランキング）

注記：
- pass fraction はモデル選択の診断量であり σ(κ) ではないため、採用κσ（method-scatter）には混ぜず、支配制約の把握に使う。

影響ファイル：
- 追加：`scripts/eht/eht_sgra_paper5_pass_fraction_tables_metrics.py`
- 更新：`scripts/summary/run_all.py`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-23（UTC） Phase 5 / Step 5.1.3：Paper IV tab:debiased_noise（a₄）を抽出し、κ誤差予算へ追加

目的：
- Step 5.1.3（EHT）の κ 誤差予算に、Sgr A* Paper IV（arXiv:2311.08697）の debiased variability table（tab:debiased_noise）の a₄（|u|=4 Gλ の excess noise）を一次ソース（TeX）から機械抽出して固定出力し、
  放射/変動由来のスケール指標として追跡できるようにする。

変更：
- 追加：`scripts/eht/eht_sgra_paper4_debiased_noise_table_metrics.py`（Paper IV results.tex の tab:debiased_noise を抽出して JSON 化）
- 更新：`scripts/eht/eht_kappa_error_budget.py`（a₄（fraction）を σ(κ) proxy として図/JSONへ追加）
- 更新：`scripts/summary/run_all.py`（上記抽出を run_all に追加）
- 更新：`doc/ROADMAP.md`（5.1.3.31 を追加）
- 更新：`doc/STATUS.md`

実行：
- `python -B scripts/eht/eht_sgra_paper4_debiased_noise_table_metrics.py`
- `python -B scripts/eht/eht_kappa_error_budget.py`

生成/更新した主な出力：
- `output/eht/eht_sgra_paper4_debiased_noise_table_metrics.json`（a₄=1.90±0.20% → fraction）
- `output/eht/eht_kappa_error_budget.json`（`kappa_sigma_proxy_paper4_debiased_noise_a4_fraction`）
- `output/eht/eht_kappa_error_budget.png`

注記：
- a₄ は放射/変動の振幅スケール指標であり、リング直径の直接誤差ではないため、採用κσ（method-scatter）へは混ぜず proxy として保持する。

影響ファイル：
- 追加：`scripts/eht/eht_sgra_paper4_debiased_noise_table_metrics.py`
- 更新：`scripts/eht/eht_kappa_error_budget.py`
- 更新：`scripts/summary/run_all.py`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-23（UTC） Phase 5 / Step 5.1.3：Paper II の残差ゲイン不確かさ（Δg）を抽出し、κ誤差予算へ追加

目的：
- Step 5.1.3（EHT）の κ 誤差予算に、Sgr A* Paper II（arXiv:2311.08679）の残差ゲイン不確かさ（Δg）を一次ソース（TeX）から機械抽出して固定出力し、
  校正系統のスケール指標として追跡できるようにする。

変更：
- 追加：`scripts/eht/eht_sgra_paper2_gain_uncertainties_metrics.py`（Paper II main.tex から Δg を抽出して JSON 化）
- 更新：`scripts/eht/eht_kappa_error_budget.py`（Paper II Δg metrics を読み込み、σ(κ) proxy として図/JSONへ追加）
- 更新：`scripts/summary/run_all.py`（上記抽出を run_all に追加）
- 更新：`doc/ROADMAP.md`（5.1.3.29 を追加）
- 更新：`doc/STATUS.md`

実行：
- `python -B scripts/eht/eht_sgra_paper2_gain_uncertainties_metrics.py`
- `python -B scripts/eht/eht_kappa_error_budget.py`

生成/更新した主な出力：
- `output/eht/eht_sgra_paper2_gain_uncertainties_metrics.json`（Δg_ALMA=0.05, Δg_SMT=0.06, Δg_LMT=0.12, Δg_tot<=0.2）
- `output/eht/eht_kappa_error_budget.json`（`kappa_sigma_proxy_paper2_delta_g_*`）
- `output/eht/eht_kappa_error_budget.png`

注記：
- Paper II の Δg は振幅校正系統のスケール指標であり、リング直径の直接誤差ではないため、採用κσ（method-scatter）へは混ぜず proxy として保持する。

影響ファイル：
- 追加：`scripts/eht/eht_sgra_paper2_gain_uncertainties_metrics.py`
- 更新：`scripts/eht/eht_kappa_error_budget.py`
- 更新：`scripts/summary/run_all.py`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-23（UTC） Phase 5 / Step 5.1.3：Paper II tab:syserr（非閉包系統誤差予算 s）を抽出し、κ誤差予算へ追加

目的：
- Step 5.1.3（EHT）の κ 誤差予算に、Sgr A* Paper II（arXiv:2311.08679）の系統誤差予算表（tab:syserr）の値（non-closing s）を一次ソース（TeX）から機械抽出して固定出力し、
  校正/整合性チェック由来のスケール指標として追跡できるようにする。

変更：
- 追加：`scripts/eht/eht_sgra_paper2_syserr_table_metrics.py`（Paper II main.tex の tab:syserr を抽出して JSON 化）
- 更新：`scripts/eht/eht_kappa_error_budget.py`（Paper II tab:syserr の s（percent列の max）を σ(κ) proxy として図/JSONへ追加）
- 更新：`scripts/summary/run_all.py`（上記抽出を run_all に追加）
- 更新：`doc/ROADMAP.md`（5.1.3.30 を追加）
- 更新：`doc/STATUS.md`

実行：
- `python -B scripts/eht/eht_sgra_paper2_syserr_table_metrics.py`
- `python -B scripts/eht/eht_kappa_error_budget.py`

生成/更新した主な出力：
- `output/eht/eht_sgra_paper2_syserr_table_metrics.json`（tab:syserr; CASA/HOPS の percent列から max を抽出し `sgra_amp_fraction_max_over_pipelines` を固定）
- `output/eht/eht_kappa_error_budget.json`（`kappa_sigma_proxy_paper2_syserr_amp_fraction_max_over_pipelines`）
- `output/eht/eht_kappa_error_budget.png`

注記：
- tab:syserr の s は closure quantity の系統誤差スケールであり、リング直径の直接誤差ではないため、採用κσ（method-scatter）へは混ぜず proxy として保持する。

影響ファイル：
- 追加：`scripts/eht/eht_sgra_paper2_syserr_table_metrics.py`
- 更新：`scripts/eht/eht_kappa_error_budget.py`
- 更新：`scripts/summary/run_all.py`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-23（UTC） Phase 5 / Step 5.1.3：Paper V の詳細Pass/Fail tables（tab:betacritPF/tab:VKbhacPF）を抽出し、失敗モードを定量化

目的：
- Step 5.1.3（EHT）の「放射モデル側の支配制約（モデル棄却の主因）」について、Paper V（arXiv:2311.09478）の詳細 Pass/Fail 表（tab:betacritPF / tab:VKbhacPF）を一次ソース（TeX）から機械抽出し、どの制約で落ちるか（失敗モード）を定量化して追跡可能にする。

変更：
- 更新：`scripts/eht/eht_sgra_paper5_pass_fraction_tables_metrics.py`（tab:betacritPF / tab:VKbhacPF を追加パースし、fail modes / fail fraction を出力へ追記）
- 更新：`doc/ROADMAP.md`（5.1.3.33 を追加）
- 更新：`doc/STATUS.md`

実行：
- `python -B scripts/eht/eht_sgra_paper5_pass_fraction_tables_metrics.py`

生成/更新した主な出力：
- `output/eht/eht_sgra_paper5_pass_fraction_tables_metrics.json`（`extracted.pass_fail_tables.*.summary`）

注記：
- Pass/Fail 表はモデル選別の診断であり、σ(κ)（method-scatter）とは別物なので κσ には混ぜず、支配制約の同定に用いる。

影響ファイル：
- 更新：`scripts/eht/eht_sgra_paper5_pass_fraction_tables_metrics.py`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-23（UTC） Phase 5 / Step 5.1.3：Paper V Pass/Fail 失敗率（fail fraction）を図示し、支配制約を可視化

目的：
- Step 5.1.3（EHT）で、Paper V（arXiv:2311.09478）の放射モデル選別（Pass/Fail tables）から「どの制約がモデル棄却を支配するか」を視覚的に追跡できる形にする。

変更：
- 更新：`scripts/eht/eht_sgra_paper5_pass_fraction_tables_metrics.py`（Pass/Fail の集計に `constraints_ranked_by_fail_fraction_excluding_aggregates` を追加し、失敗率プロット（PNG）を生成）
- 更新：`doc/ROADMAP.md`（5.1.3.34 を追加）
- 更新：`doc/STATUS.md`
- 更新：`doc/paper/01_figures_index.md`

実行：
- `python -B scripts/eht/eht_sgra_paper5_pass_fraction_tables_metrics.py`

生成/更新した主な出力：
- `output/eht/eht_sgra_paper5_pass_fail_tables_fail_fractions.png`
- `output/eht/eht_sgra_paper5_pass_fraction_tables_metrics.json`

注記：
- 失敗率（fail fraction）はモデル選別の診断であり、σ(κ)（method-scatter）とは別物なので κσ には混ぜず、支配制約の同定に用いる。

影響ファイル：
- 更新：`scripts/eht/eht_sgra_paper5_pass_fraction_tables_metrics.py`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/paper/01_figures_index.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-23（UTC） Phase 5 / Step 5.1.3：Paper V Pass/Fail tables を拡張し、支配制約（global fail fraction）を定量化

目的：
- Step 5.1.3（EHT）で、Paper V（arXiv:2311.09478）の放射モデル選別（Pass/Fail tables）をより広いモデル群（Frankfurt/Illinois/HAMR/Koral/Ressler等）へ拡張し、
  「どの制約がモデル棄却を支配するか」を全表集計（global fail fraction）として定量化して、改善ターゲットの優先順位付けに使える形にする。

変更：
- 更新：`scripts/eht/eht_sgra_paper5_pass_fraction_tables_metrics.py`（Pass/Fail tables の対象を拡張し、`derived.pass_fail_tables_global` と global fail fraction 図を追加）
- 更新：`doc/ROADMAP.md`（5.1.3.35 を追加）
- 更新：`doc/STATUS.md`
- 更新：`doc/paper/01_figures_index.md`

実行：
- `python -B scripts/eht/eht_sgra_paper5_pass_fraction_tables_metrics.py`

生成/更新した主な出力：
- `output/eht/eht_sgra_paper5_pass_fail_global_constraint_fail_fractions.png`
- `output/eht/eht_sgra_paper5_pass_fraction_tables_metrics.json`（`extracted.pass_fail_tables` / `derived.pass_fail_tables_global`）

注記：
- Pass/Fail はモデル選別の診断であり σ(κ)（method-scatter）とは別物なので κσ には混ぜず、支配制約（改善ターゲット）の同定に用いる。

影響ファイル：
- 更新：`scripts/eht/eht_sgra_paper5_pass_fraction_tables_metrics.py`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/paper/01_figures_index.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-23（UTC） Phase 5 / Step 5.1.3：Paper V near-passing tables（fail_one/fail_none）を抽出し、「最後に残る制約」を定量化

目的：
- Step 5.1.3（EHT）で、Paper V（arXiv:2311.09478）の「全制約を通るモデルが無い」状況に対して、fail_one / fail_none（near-passing）テーブルを一次ソース（TeX）から機械抽出し、
  「最後に残る制約（どれが最後に落ちるか）」を頻度として定量化して、支配的なボトルネック（M3 / 2.2 μm など）を明確化する。

変更：
- 更新：`scripts/eht/eht_sgra_paper5_pass_fraction_tables_metrics.py`（near-passing tables を追加パースし、`extracted.near_passing` / `derived.near_passing` と near-passing 図を追加）
- 更新：`doc/ROADMAP.md`（5.1.3.36 を追加）
- 更新：`doc/STATUS.md`
- 更新：`doc/paper/01_figures_index.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

実行：
- `python -B scripts/eht/eht_sgra_paper5_pass_fraction_tables_metrics.py`

生成/更新した主な出力：
- `output/eht/eht_sgra_paper5_near_passing_failed_constraints.png`
- `output/eht/eht_sgra_paper5_pass_fraction_tables_metrics.json`（`extracted.near_passing` / `derived.near_passing`）

注記：
- near-passing の失敗頻度は放射モデル選別の診断であり、σ(κ)（method-scatter）とは別物なので κσ には混ぜず、支配的な制約（改善ターゲット）の同定に用いる。

影響ファイル：
- 更新：`scripts/eht/eht_sgra_paper5_pass_fraction_tables_metrics.py`
- 更新：`doc/ROADMAP.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/paper/01_figures_index.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-23（UTC） Phase 8 / Step 8.2：論文 1.1 背景に「QM+GR統一未解決」と「物質＝波／媒質＝時間」の位置づけを追記

目的：
- 論文（`doc/paper/10_manuscript.md`）の 1.1 背景で、P-model の前提（物質＝波／媒質＝時間、P(x)導入）を現代物理学の文脈（量子力学と一般相対性理論の統一未解決）に自然に接続し、読者が「なぜこの仮定から出発するのか」を理解できるようにする。

変更：
- 更新：`doc/paper/10_manuscript.md`（1.1 背景に追記）
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

実行：
- `python -B scripts/summary/run_all.py --offline --jobs 2`

影響ファイル：
- 更新：`doc/paper/10_manuscript.md`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-23（UTC） Phase 8 / Step 8.3（運用）：資料生成（paper/public）の軽量ルートを追加し、所要時間を計測

目的：
- `scripts/summary/run_all.py` は全topicの再計算を含み、作業中の反復でボトルネックになり得るため、既に生成済みの成果物（`output/*`）を前提に「資料（paper/public）だけ」を再生成できる入口を用意する。
- 併せて、full と quick の wall time を計測して比較可能にする。

変更：
- 追加：`output/summary/build_materials.bat`（既定=quick、`full` 指定で run_all を実行）
- 計測ログ：`output/summary/logs/measure_run_all_full.txt`、`output/summary/logs/measure_build_materials_quick.txt`

計測（PowerShell）：
- full: `Measure-Command { python -B scripts/summary/run_all.py --offline --jobs 2 *> output/summary/logs/measure_run_all_full.txt }` → **531.456s**
- quick: `Measure-Command { cmd /c output/summary/build_materials.bat *> output/summary/logs/measure_build_materials_quick.txt }` → **125.093s**

影響ファイル：
- 追加：`output/summary/build_materials.bat`
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-23（UTC） Phase 5 / Step 5.1.3：Paper V key constraints（M3 / 2.2 μm flux）を一次ソース（TeX）から抽出し、前提分解の起点を固定

目的：
- Step 5.1.3（EHT）で、Paper V（arXiv:2311.09478）の near-passing 解析で支配的だった M3 と 2.2 μm flux について、
  「定義（ΔT, mi定義）」「棄却基準（KS p閾値、NIR閾値）」「感度（30%スケール、extended flux 仮説など）」を一次ソース（TeX）から機械抽出して固定し、
  次段の前提分解（観測・校正・放射モデル仮定の寄与分解）に必要なアンカー値を再現可能にする。

変更：
- 更新：`scripts/eht/eht_sgra_paper5_key_constraints_metrics.py`（Paper V の TeX から M3 / 2.2 μm flux の定義・閾値・感度を抽出して JSON 固定出力）
- 更新：`doc/ROADMAP.md`（5.1.3.37 を追加）
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

実行：
- `python -B scripts/eht/eht_sgra_paper5_key_constraints_metrics.py`

生成/更新した主な出力：
- `output/eht/eht_sgra_paper5_key_constraints_metrics.json`

注記：
- 本出力は「前提分解の起点（定義・閾値・感度の一次ソース固定）」であり、実際の補正/緩和量の推定（観測系統・校正・モデル仮定の寄与分解）は次段で行う。

---

## 2026-01-23（UTC） Phase 8 / Step 8.3（運用）：`build_materials.bat` の quick を「DOCXロックでも継続」するよう改修

目的：
- 作業中に `output/summary/pmodel_paper.docx` が開いている等でロックされている場合でも、資料生成（paper/public）の入口が止まらないようにし、
  少なくとも HTML 版（`pmodel_paper.html` / `pmodel_public_report.html`）は常に更新できる運用にする。

変更：
- 更新：`output/summary/build_materials.bat`
  - quick は `paper_build.py --skip-docx` で HTML を先に確定し、DOCX 変換は別ステップで best-effort（失敗時は warn 継続）に変更。
  - public report の DOCX 変換も、失敗時は warn 継続（HTML は更新）に変更。
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

実行：
- `cmd /c output/summary/build_materials.bat`

注記：
- これにより、DOCX がロック中でも資料生成の quick が成功（exit code 0）し、HTML 版は更新される。

---

## 2026-01-23（UTC） Phase 8 / Step 8.2：論文 1.1 背景を改訂（GRの成功/障壁、統一問題、検証スコープ、GRとP-modelの位置づけ）

目的：
- 論文（`doc/paper/10_manuscript.md`）の 1.1 背景を、(i) GRの成功と記述/再現の障壁、(ii) QM+GR統一未解決の文脈、
  (iii) 本稿の仮定（物質＝波／媒質＝時間→P(x)）と狙い、(iv) 本稿の検証スコープ（弱場〜EHT/宇宙論、量子は今後）、
  (v) GRとP-modelの位置づけ（幾何学的記述 vs 機構再導出）へ自然につながる形に整える。

変更：
- 更新：`doc/paper/10_manuscript.md`（1.1 背景を差し替え・整理）
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

実行：
- `cmd /c output/summary/build_materials.bat`

注記：
- 文面は 3.5 の統一表現（GR/SRは有効理論、P-modelは別機構からの再導出）に従う。

---

## 2026-01-23（UTC） Phase 5 / Step 5.1.3：Paper V の M3 / 2.2 μm 制約の「敏感さ」を定量化（KSのサンプル数依存、閾値のσ換算、extended flux換算）

目的：
- Step 5.1.3（EHT）で、Paper V（arXiv:2311.09478）の near-passing で支配的だった M3 と 2.2 μm flux について、
  「どの仮定をどれだけ動かすと判定が反転し得るか」を最小の定量指標として固定し、前提分解（観測・校正・放射モデル仮定の寄与分解）へ接続する。

変更：
- 更新：`scripts/eht/eht_sgra_paper5_key_constraints_metrics.py`
  - NIR閾値（1.0 mJy）を観測中央値（0.8±0.3 mJy）に対する σ 換算（kσ）として導出。
  - M3（KS p<0.01）の 2-sample KS の D_crit をサンプル数（observed/model）から近似し、モデル長さ依存（n_model=9/18/28）の感度差を可視化。
  - extended flux の抑制因子（1/(1+f_ext)）から、30%スケール変化に必要な f_ext を換算。
  - sensitivity 図を追加。
- 更新：`scripts/summary/run_all.py`（full再計算時に上記メトリクスを再生成できるよう task を追加）
- 更新：`doc/ROADMAP.md`（5.1.3.38 を追加）
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

実行：
- `python -B scripts/eht/eht_sgra_paper5_key_constraints_metrics.py`

生成/更新した主な出力：
- `output/eht/eht_sgra_paper5_key_constraints_metrics.json`
- `output/eht/eht_sgra_paper5_key_constraints_sensitivity.png`

---

## 2026-01-23（UTC） Phase 5 / Step 5.1.3：Paper V Pass/Fail tables の制約緩和スイープ（relaxation sweep）を固定

目的：
- Step 5.1.3（EHT）で、Paper V の near-passing 支配（M3 / 2.2 μm）を「どの程度の影響力か」まで定量化するため、
  Pass/Fail tables を atomic constraints に分解し、特定制約を緩和した場合に “通り得るモデル数（pass_n）” がどれだけ増えるかを固定出力する。

変更：
- 追加：`scripts/eht/eht_sgra_paper5_constraint_relaxation_sweep.py`（入力：`output/eht/eht_sgra_paper5_pass_fraction_tables_metrics.json`）
  - baseline / relax M3 / relax F_2um / relax (M3+F_2um) の pass fraction を global と table別で算出。
  - 併せて single relax の順位（top15）を出力。
- 更新：`scripts/summary/run_all.py`（full再計算時に sweep を再生成できるよう task を追加）
- 更新：`doc/ROADMAP.md`（5.1.3.39 を追加）
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

実行：
- `python -B scripts/eht/eht_sgra_paper5_constraint_relaxation_sweep.py`

生成/更新した主な出力：
- `output/eht/eht_sgra_paper5_constraint_relaxation_sweep_metrics.json`
- `output/eht/eht_sgra_paper5_constraint_relaxation_sweep.png`

---

## 2026-01-23（UTC） Phase 5 / Step 5.1.3：Paper V の M3/2.2μm reconnection 条件図を固定（閾値σ換算・KS n依存・extended flux換算・near救済数）

目的：
- Step 5.1.3（EHT）で、Paper V の near-passing 支配（M3 / 2.2 μm）について、「どの仮定をどれだけ動かすと判定が反転し得るか」を
  近-passing（45）と全Pass/Fail tables（1924）の両方の視点で1枚に統合し、次段の前提分解（観測・校正・モデル仮定）を進めるための基準出力を作る。

変更：
- 追加：`scripts/eht/eht_sgra_paper5_m3_nir_reconnection_conditions.py`
  - NIR：閾値（1.0 mJy）を観測中央値（0.8±0.3 mJy）に対して σ 換算し、flare bias b を仮定した場合の kσ を換算。
  - M3：KS（p<0.01）の 2-sample 近似 D_crit を、観測サンプル数（historical=42 vs 2017=7）とモデルサンプル数（9/18/28）で比較。
  - near-passing（45）の救済数（relax M3 / relax F_2um / relax 両方）と、全表（1924）の relax sweep を同一出力に収める。
- 更新：`scripts/summary/run_all.py`（full再計算時に上記を再生成できるよう task を追加）
- 更新：`doc/ROADMAP.md`（5.1.3.40 を追加）
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

実行：
- `python -B scripts/eht/eht_sgra_paper5_m3_nir_reconnection_conditions.py`

生成/更新した主な出力：
- `output/eht/eht_sgra_paper5_m3_nir_reconnection_conditions_metrics.json`
- `output/eht/eht_sgra_paper5_m3_nir_reconnection_conditions.png`

注記：
- Pass/Fail tables にはモデルの数値（F_2um, mi3 の実値分布）が含まれないため、本ステップは「必要な補正量の厳密推定」ではなく「仮定依存の感度（必要条件）の定量化」として位置づける。

---

## 2026-01-23（UTC） Phase 8 / Step 8.3（運用）：資料生成BATの既定動作を full に変更し、作業中は毎回 build しない運用へ

目的：
- 作業中の反復で `output/summary` の HTML/DOCX を毎回更新する必要が無い場合、重い処理（特に Word 自動化）を避けて解析作業を優先できるようにする。
- 手動実行時に「引数なし＝full」を既定にして、明示的に quick を選べる形にする。

変更：
- 更新：`output/summary/build_materials.bat`
  - 既定（引数なし）を full（`run_all.py --offline --jobs 2`）に変更
  - `quick`（reports-only）と `quick-nodocx`（HTMLのみ）を追加
- 更新：`doc/STATUS.md`（作業区切りでの資料生成を「必要時のみ手動実行」へ変更）
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-23（UTC） Phase 8 / Step 8.2-8.3：論文 1.1 背景の文言整合と、build_materials の既定/計測表記の整合（微修正）

目的：
- 論文 1.1 背景をユーザー提案の文言（GRの成功/障壁、QM+GR統一未解決、本稿の仮定、検証スコープ、GRとP-modelの位置づけ）に合わせて整形する。
- `output/summary/build_materials.bat` が「引数なし=full」になった後も、`doc/STATUS.md` の説明が矛盾しないようにする（quick は引数で明示）。

変更：
- 更新：`doc/paper/10_manuscript.md`（1.1 背景を整形）
- 更新：`doc/STATUS.md`（`build_materials.bat` の既定/quick の表記を修正、timestamp更新）
- 更新：`doc/WORK_HISTORY.md`

---

## 2026-01-23（UTC） Phase 5 / Step 5.1.3：GRAVITY 2020「The flux distribution of Sgr A*」を一次ソース固定し、2.2 μm percentiles で NIR制約の保守性を定量化

目的：
- Paper V の 2.2 μm flux constraint（EHT 2017 に対応する観測値）について、一次ソースを GRAVITY Collaboration 2020（arXiv:2004.07185）に固定し、Table 1 の percentiles（p5/p14/p50/p86/p95）を数値として抽出する。
- その percentiles を用いて、Paper V が採用した閾値（1.0 mJy）がどの程度保守的か（例：threshold/p5）を定量化し、M3/NIR reconnection 条件図へ統合する。

変更：
- 追加：`scripts/eht/fetch_gravity_sgra_flux_paper.py`（GRAVITY 2020 flux distribution; arXiv:2004.07185 を取得）
- 追加：`scripts/eht/gravity_sgra_flux_distribution_metrics.py`（Table 1 percentiles を抽出して固定出力）
- 更新：`scripts/eht/eht_sgra_paper5_m3_nir_reconnection_conditions.py`（GRAVITY percentiles を読み込み、NIRプロット/metrics に反映）
- 更新：`scripts/summary/run_all.py`（`eht_gravity_sgra_flux_distribution_metrics` task を追加）
- 更新：`doc/PRIMARY_SOURCES.md`（arXiv:2004.07185 を追記）
- 更新：`doc/ROADMAP.md`（5.1.3.41 を追加）
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

実行：
- `python -B scripts/eht/fetch_gravity_sgra_flux_paper.py`
- `python -B scripts/eht/gravity_sgra_flux_distribution_metrics.py`
- `python -B scripts/eht/eht_sgra_paper5_m3_nir_reconnection_conditions.py`

生成/更新した主な出力：
- `output/eht/gravity_sgra_flux_sources_manifest.json`
- `output/eht/gravity_sgra_flux_distribution_metrics.json`
- `output/eht/eht_sgra_paper5_m3_nir_reconnection_conditions_metrics.json`（`threshold_over_gravity2020_p5_all` 等）
- `output/eht/eht_sgra_paper5_m3_nir_reconnection_conditions.png`

注記：
- GRAVITY Table 1 の 2017 p5/p14 は instrument systematics により struck-out（同論文注記）。EHT2017 対応の median（p50）は `0.8±0.3 mJy` として利用できる。

---

## 2026-01-23（UTC） Phase 5 / Step 5.1.3：Wielgus+2022 を一次ソース固定し、M3（3h modulation index）の観測側前提（「2017 7 samples」）を機械抽出してreconnection条件へ反映

目的：
- Paper V の M3 constraint について、観測側前提（サンプル選択、ΔT=3h の正当化）を一次ソースで固定し、前提分解の検証を可能にする。
- Wielgus et al. 2022（arXiv:2207.06829）の Table `tab:sigma_mu_3h` と DRW τ（Table `tab:GPresults`）を機械抽出して固定出力し、Paper V の「2017 7 samples」構成候補を追跡可能にする。

変更：
- 追加：`scripts/eht/wielgus2022_m3_observed_metrics.py`（Table `tab:sigma_mu_3h` と `tab:GPresults` を抽出して固定出力）
- 更新：`scripts/eht/eht_sgra_paper5_m3_nir_reconnection_conditions.py`（`wielgus2022_m3_observed_metrics_json` を入力に追加し、M3側に一次ソース由来の値を添付）
- 更新：`doc/PRIMARY_SOURCES.md`（arXiv:2207.06829 を追記）
- 更新：`doc/ROADMAP.md`（5.1.3.42 を追加）
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

実行：
- `python -B scripts/eht/wielgus2022_m3_observed_metrics.py`
- `python -B scripts/eht/eht_sgra_paper5_m3_nir_reconnection_conditions.py`

生成/更新した主な出力：
- `output/eht/wielgus2022_m3_observed_metrics.json`
- `output/eht/eht_sgra_paper5_m3_nir_reconnection_conditions_metrics.json`（`derived.m3.wielgus2022_*` を追加）
- `output/eht/eht_sgra_paper5_m3_nir_reconnection_conditions.png`

注記：
- Paper V の "2017 7 samples" は、Wielgus+2022 の Table `tab:sigma_mu_3h` から **ALMA A1 HI（Apr6, Apr7×3, Apr11）+ SMA HI（Apr5, Apr10）=7** として再現できる候補を固定した。historical distribution（42 samples）の完全再現は次段。

---

## 2026-01-23（UTC） Phase 5 / Step 5.1.3：Wielgus+2022 の historical record（`tab:detections_other_papers`）から Paper V の historical distribution（n=42）の構成を復元して固定

目的：
- Paper V の M3 constraint で使われる historical distribution（42 samples）が「何の観測（どの年/どのアレイ/どのduration）から来るか」を一次ソース側で定量的に復元し、前提（サンプル数・独立性仮定）の検証可能性を上げる。

変更：
- 更新：`scripts/eht/wielgus2022_m3_observed_metrics.py`
  - Wielgus+2022 の Table `tab:detections_other_papers` をパースし、duration>=3h かつ date cutoff=2017-04-11 の条件で floor(duration/ΔT)（ΔT=3h）セグメント化した場合に n=42 となることを固定出力。
- 更新：`scripts/eht/eht_sgra_paper5_m3_nir_reconnection_conditions.py`（上記の summary を metrics に添付）
- 更新：`doc/ROADMAP.md`（5.1.3.43 を追加）
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

実行：
- `python -B scripts/eht/wielgus2022_m3_observed_metrics.py`
- `python -B scripts/eht/eht_sgra_paper5_m3_nir_reconnection_conditions.py`

生成/更新した主な出力：
- `output/eht/wielgus2022_m3_observed_metrics.json`（`derived.paper5_m3_historical_distribution_candidate_pre_eht_2017_apr11.segments_n=42`）
- `output/eht/eht_sgra_paper5_m3_nir_reconnection_conditions_metrics.json`（`derived.m3.wielgus2022_paper5_historical_distribution_candidate_pre_eht_2017_apr11`）

注記：
- Table `tab:detections_other_papers` は各観測の「全durationでの σ/μ」を与えるため、3hセグメントごとの mi3 値はこの表だけでは一意に再現できない（現状は composition（n）復元を優先）。

---

## 2026-01-23（UTC） Phase 5 / Step 5.1.3：historical distribution の independent-samples 仮定（effective n）に対する KS 強度の感度を定量化

目的：
- Paper V の M3 constraint（2-sample KS）はサンプル数 n に強く依存するため、historical distribution の「3hセグメントは独立」という仮定が崩れた場合に、どの程度 “棄却力” が弱まるか（D_crit の増加）を定量化して固定する。

変更：
- 更新：`scripts/eht/eht_sgra_paper5_m3_nir_reconnection_conditions.py`
  - Wielgus+2022 由来の historical distribution composition（n=42 segments / n=30 curves / n=38 SMA+CARMA など）に対して、KS D_crit を計算し `derived.m3.wielgus2022_historical_distribution_effective_n_sensitivity` として固定出力。
- 更新：`doc/ROADMAP.md`（5.1.3.44 を追加）
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

実行：
- `python -B scripts/eht/eht_sgra_paper5_m3_nir_reconnection_conditions.py`

生成/更新した主な出力：
- `output/eht/eht_sgra_paper5_m3_nir_reconnection_conditions_metrics.json`（`derived.m3.wielgus2022_historical_distribution_effective_n_sensitivity`）

---

## 2026-01-23（UTC） Phase 5 / Step 5.1.3：historical distribution の「値」側未確定の影響を、proxy分布によるKS sanity checkとして固定

目的：
- Wielgus+2022 の Table `tab:detections_other_papers` は full-duration の σ/μ を提供するが、Paper V の mi3（3hセグメント）値そのものは与えない。
- そのため「値側が未確定」な段階でどの程度結果が振れ得るかを明示する入口として、full-duration σ/μ を 3hセグメントに複製した proxy 分布を作り、2017（7 samples）との KS 整合性が破れる（p<0.01 で棄却）ことを sanity check として固定する。

変更：
- 更新：`scripts/eht/wielgus2022_m3_observed_metrics.py`
  - `derived.paper5_m3_ks_sanity_2017_vs_historical_proxy` を追加（2-sample KS の D と p（asymptotic））
- 更新：`scripts/eht/eht_sgra_paper5_m3_nir_reconnection_conditions.py`（上記 sanity block を metrics に添付）
- 更新：`doc/ROADMAP.md`（5.1.3.45 を追加）
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

実行：
- `python -B scripts/eht/wielgus2022_m3_observed_metrics.py`
- `python -B scripts/eht/eht_sgra_paper5_m3_nir_reconnection_conditions.py`

生成/更新した主な出力：
- `output/eht/wielgus2022_m3_observed_metrics.json`（`derived.paper5_m3_ks_sanity_2017_vs_historical_proxy`）
- `output/eht/eht_sgra_paper5_m3_nir_reconnection_conditions_metrics.json`（`derived.m3.wielgus2022_paper5_m3_ks_sanity_2017_vs_historical_proxy`）

---

## 2026-01-23（UTC） Phase 5 / Step 5.1.3：DRW（OU）で 3h mi3 の相関→effective n を推定し、KS棄却力（D_crit）への影響を固定

目的：
- Paper V は 3h セグメントの mi3 を「独立サンプル」として扱うが、実際には DRW（damped random walk）過程では近接窓間に相関が残り得る。
- そこで DRW（OU）仮定のシミュレーションで 3h mi3 の window-to-window 自己相関を推定し、effective n と KS D_crit の変化（棄却力の弱まり）を定量化して固定する。

変更：
- 追加：`scripts/eht/wielgus2022_m3_drw_independence_sim.py`（OUシミュレーション→mi3自己相関→effective n→KS D_crit 例を出力）
- 更新：`doc/ROADMAP.md`（5.1.3.46 を追加）
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

実行：
- `python -B scripts/eht/wielgus2022_m3_drw_independence_sim.py`

生成/更新した主な出力：
- `output/eht/wielgus2022_m3_drw_independence_sim_metrics.json`
- `output/eht/wielgus2022_m3_drw_independence_sim.png`

---

## 2026-01-23（UTC） Phase 5 / Step 5.1.3：historical distribution の「値」側（3h mi3）を一次データから n=42/42 まで再構築し、KS判定を確定

目的：
- Paper V の M3 constraint（2-sample KS）を「値側（mi3分布）」まで含めて再現可能にし、near-passing の条件分解（どの仮定が支配的か）へ接続する。

変更：
- 更新：`scripts/eht/eht_sgra_paper5_m3_historical_distribution_values.py`
  - Yusef-Zadeh+2009（SMA 2007; PGPLOT PS fig11）から M20 マーカーを抽出し、Wielgus+2022 の（duration, N, μ±σ）で (t, flux) をキャリブレーションして mi3 を算出。
  - Bower+2018（ALMA 2016; timeseries PDF）から Stokes I の赤系列を digitize（raster/ベクタ両対応）し、同様に mi3 を算出。
  - Marrone（2006; thesis, SMA 2005）の PS.gz から該当図（Jun/Jul 2005）埋め込みEPSを抽出し、BoxF マーカーを parse して mi3 を算出。
  - 出力キーを `ks_2017_7sample_vs_historical`（full/partialを `coverage.is_full_reconstruction` で明示）に更新。
- 追加：一次ソース（thesis）をローカル固定
  - `data/eht/sources/marrone2006_thesis_dpm_thesis.pdf`
  - `data/eht/sources/marrone2006_thesis_dpm_thesis.ps.gz`
- 追加：補助一次ソース（Marrone 2006; arXiv:astro-ph/0607432）をローカル固定
  - `data/eht/sources/arxiv_astroph_0607432.pdf`
  - `data/eht/sources/arxiv_astroph_0607432_src.tar.gz` → `data/eht/sources/arxiv_astroph_0607432/`
- 更新：`doc/PRIMARY_SOURCES.md`（上記一次ソースを追記）
- 更新：`doc/ROADMAP.md`（5.1.3.47 を完了へ更新）
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

実行：
- `python -B scripts/eht/eht_sgra_paper5_m3_historical_distribution_values.py`

生成/更新した主な出力：
- `output/eht/eht_sgra_paper5_m3_historical_distribution_values.json`（segments_computed=42/42; KS: D≈0.619, p_asymptotic≈0.0106）
- `output/eht/eht_sgra_paper5_m3_historical_distribution_values_ecdf.png`

---

## 2026-01-23（UTC） Phase 5 / Step 5.1.3：再構築 mi3 値を reconnection 条件図へ統合し、KS余裕（ΔD）と感度を固定

目的：
- Paper V の near-passing 支配（M3 / 2.2 μm）について、historical distribution の「値」側（mi3）を一次データから再構築できた（n=42/42）ため、これを reconnection 条件図側へ統合し、KS 判定の余裕（p=0.01 境界までの距離）と支配仮定（effective n / digitize）を定量化して救済条件へ接続する。

変更：
- 更新：`scripts/eht/eht_sgra_paper5_m3_nir_reconnection_conditions.py`
  - `--m3-historical-values-json` を追加し、再構築 mi3 値から KS の D/p（asymptotic）と余裕ΔD（p=0.01 まで）を算出して `derived.m3.historical_distribution_values_ks` に固定。
  - effective n（n_eff）解釈と、digitize/scale の簡易ロバストネス（round/scale）を同ブロックに添付。
- 更新：`doc/ROADMAP.md`（5.1.3.48 を追加）
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

実行：
- `python -B scripts/eht/eht_sgra_paper5_m3_nir_reconnection_conditions.py`

生成/更新した主な出力：
- `output/eht/eht_sgra_paper5_m3_nir_reconnection_conditions_metrics.json`（D≈0.619、p_asymptotic≈0.0106、ΔD(p=0.01)≈+0.0035）
- `output/eht/eht_sgra_paper5_m3_nir_reconnection_conditions.png`

---

## 2026-01-23（UTC） Phase 5 / Step 5.1.3：historical mm lightcurves の一次ソース取得manifestを拡張（thesis/旧arXiv形式を追加）

目的：
- Paper V historical distribution（mi3再構築）の入力となる mm light curves の一次ソースについて、取得・検証の入口（manifest）を整備し、offline 再現を強化する。

変更：
- 更新：`scripts/eht/fetch_sgra_historical_mm_lightcurves_papers.py`
  - Marrone 2006 thesis（CfA直URL; PDF/PS.gz）を manifest に追加。
  - 旧arXiv形式 `astro-ph/0607432` を path-safe 名（`astroph_0607432`）で扱い、既存キャッシュ（`data/eht/sources/arxiv_astroph_0607432*`）と一致させた。
- 更新：`doc/ROADMAP.md`（5.1.3.49 を追加）
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

実行：
- `python -B scripts/eht/fetch_sgra_historical_mm_lightcurves_papers.py --offline`

生成/更新した主な出力：
- `output/eht/eht_sgra_historical_mm_lightcurves_papers_sources_manifest.json`（rows=8; `marrone2006_thesis` を含む）

---

## 2026-01-23（UTC） Phase 5 / Step 5.1.3：KS の離散性（D-step）と digitize 系統（scale閾値）を定量化し、救済条件を paper に反映

目的：
- Paper V の M3（3h modulation index）制約は KS に基づくため、サンプル数が小さいと「p値の境界付近」で離散性と digitize 系統が支配的になり得る。
- そこで、再構築した mi3 分布（2017 7-sample vs historical n=42）について、(i) D の最小ステップ（1/lcm(n,m)）と、(ii) 1-step 反転に対応する scale 閾値（0.051 近傍の historical 点を跨がせる条件）を明示し、救済条件として paper に追記する。

変更：
- 更新：`scripts/eht/eht_sgra_paper5_m3_nir_reconnection_conditions.py`
  - `derived.m3.historical_distribution_values_ks.d_discreteness`（D_step, p_next_up/down）を追加。
  - `derived.m3.historical_distribution_values_ks.d_argmax`（Dが最大になる t,i,j）と `digitize_scale_thresholds`（scale_up/down 閾値、Δabs/Δrel、pの反転例）を追加。
- 更新：`doc/paper/10_manuscript.md`（4.8節に M3/2.2 μm near-passing の救済条件を追記）
- 更新：`doc/paper/01_figures_index.md` / `doc/paper/30_references.md`
- 更新：`doc/ROADMAP.md`（5.1.3.50 を追加）
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

実行：
- `python -B scripts/eht/eht_sgra_paper5_m3_nir_reconnection_conditions.py`

生成/更新した主な出力：
- `output/eht/eht_sgra_paper5_m3_nir_reconnection_conditions_metrics.json`（D-step: 1/42、scale_up≈1.028、p_next_up≈0.007）

---

## 2026-01-23（UTC） Phase 5 / Step 5.1.3：Paper V（M3/2.2 μm）の救済条件を decisive pack（decisive_candidates）へ統合

目的：
- Paper V 側の「near-passing 救済条件」（p−α、D-step、digitize scale閾値など）を、summary 出力（decisive_candidates）に載せて、EHT（Sgr A*）の系統評価（放射モデル側）を dashboard/公開資料へ接続しやすくする。

変更：
- 更新：`scripts/summary/decisive_candidates.py`
  - `output/eht/eht_sgra_paper5_m3_nir_reconnection_conditions_metrics.json` を読み、`eht_Sgr_A*` に `paper5_m3_near_passing_rescue` を添付するよう拡張。
- 更新：`doc/ROADMAP.md`（5.1.3.51 を追加）
- 更新：`doc/STATUS.md`
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

実行：
- `python -B scripts/summary/decisive_candidates.py`

生成/更新した主な出力：
- `output/summary/decisive_candidates.json`（`paper5_m3_near_passing_rescue` を追加）
- `output/summary/decisive_candidates.png`（再生成）

---

## 2026-01-23（UTC） Phase 5 / Step 5.1.3：Paper V（M3/2.2 μm）の救済条件を public report（dashboard）へ統合し、確証/保留の判定基準を明文化

目的：
- decisive pack まで統合した Paper V（M3/2.2 μm）救済条件を、public report（dashboard）側にも図＋要点として反映し、読者が「確証/保留の境界条件（digitize閾値など）」を直接参照できるようにする。

変更：
- 更新：`scripts/summary/public_dashboard.py`
  - `output/eht/eht_sgra_paper5_m3_nir_reconnection_conditions_metrics.json` を読み、KSの near-passing 要点（p−α、D-step、digitize scale閾値、残り制約の上位）を summary として表示するカードを追加。
  - card id: `eht_sgra_paper5_m3_nir_reconnection_conditions`
- 更新：`doc/ROADMAP.md`（5.1.3.52 を追加、Step 5.1/5.1.3 を「完了（初版）」へ更新）
- 更新：`doc/STATUS.md`（現在地を Phase 6 / Step 6.1.6 へ移動）
- 更新：`doc/AI_CONTEXT_MIN.json`
- 更新：`doc/WORK_HISTORY.md`

実行：
- `python -B scripts/summary/public_dashboard.py`

生成/更新した主な出力：
- `output/summary/pmodel_public_report.html`（card id: `eht_sgra_paper5_m3_nir_reconnection_conditions`）
- `output/summary/pmodel_public_dashboard_metrics.json`
- `output/summary/pmodel_public_dashboard.png`

---

## 2026-01-23（UTC） Phase 6 / Step 6.1.6：NGLR-1（nglr1）追加データ探索（EDC）とバッチ再評価（増分なし）

目的：
- NGLR-1（nglr1）を mm級精度テストとして活用できるかを判断するため、公開データ（EDC normal point）のカバレッジ（年/局）を拡張できるかを確認する。

変更：
- 更新：`data/llr/llr_edc_batch_manifest.json`（generated_utc 更新；増分なし）
- 更新：`output/llr/batch/*`（再評価で上書き更新）
- 更新：`doc/ROADMAP.md`（6.1.6 を「完了（現時点：増分なし→データ拡充待ち）」として固定）
- 更新：`doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json` / `doc/WORK_HISTORY.md`

実行：
- `python -B scripts/llr/fetch_llr_edc_batch.py --targets nglr1 --years 2025-2026 --append --include-daily`
- `python -B scripts/llr/llr_batch_eval.py --time-tag-mode auto --min-points 30 --chunk 50`

生成/更新した主な出力：
- coverage：`output/llr/batch/llr_data_coverage.csv`（nglr1: APOL=24 / WETL=2 → WETLは除外）
- metrics：`output/llr/batch/llr_batch_metrics.csv`（nglr1 の残差RMSは現時点では統計的に薄く、mm級判定はデータ拡充待ち）

---

## 2026-01-23（UTC） Phase 6 / Step 6.3：BAO多系統（BOSS/eBOSS）peakfit（ε）横並び＋cap張力（NGC/SGC）定量化の固定出力

目的：
- BOSS/eBOSS の BAO peakfit（ε）結果を「同一形式の一次統計出力（peakfit metrics）」から横並びにし、cap依存（NGC/SGC）の張力を zスコアとして明文化する。

変更：
- 追加：`scripts/cosmology/cosmology_bao_multisystematics_summary.py`
- 更新：`doc/ROADMAP.md`（6.3 を完了（初版）へ）
- 更新：`doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json` / `doc/WORK_HISTORY.md`

実行：
- `python -B scripts/cosmology/cosmology_bao_multisystematics_summary.py`

生成/更新した主な出力：
- `output/cosmology/cosmology_bao_multisystematics_summary.png`
- `output/cosmology/cosmology_bao_multisystematics_summary_metrics.json`
- `output/cosmology/cosmology_bao_multisystematics_summary.csv`

---

## 2026-01-23（UTC） Phase 6 / Step 6.4：Kerr（回転BH）の shadow 直径係数 (a*,inc) 系統を固定出力し、係数差予測の頑健性を定量化

目的：
- EHTの影直径テストで、GR側の「Kerr（a*,inc）系統」が差分予測（P-model係数差）の解釈に与える上限を定量化し、強場の反証条件（必要精度）の議論を頑健化する。

変更：
- 追加：`scripts/eht/eht_kerr_shadow_coeff_grid.py`
  - Kerr shadow の effective diameter（avg(width,height)）を (a*,inc) グリッドで計算し、Schwarzschild からの変化率と、P-model係数（4eβ）との差（%）を2段プロットで固定出力。
  - `data/eht/eht_black_holes.json` の object 制約（M87*: inc範囲、Sgr A*: inc上限）を矩形としてオーバーレイし、制約下の係数レンジと係数差（%）を metrics に固定。
- 更新：`scripts/summary/run_all.py`（`eht_kerr_shadow_coeff_grid` タスクを追加）
- 更新：`doc/ROADMAP.md`（Step 6.4.1/6.4.2 を「完了（初版）」へ）
- 更新：`doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json` / `doc/WORK_HISTORY.md`

実行：
- `python -B scripts/eht/eht_kerr_shadow_coeff_grid.py`

生成/更新した主な出力：
- `output/eht/eht_kerr_shadow_coeff_grid.png`（public: `output/eht/eht_kerr_shadow_coeff_grid_public.png`）
- `output/eht/eht_kerr_shadow_coeff_grid_metrics.json`

---

## 2026-01-23（UTC） Phase 6 / Step 6.4：Kerr shadow の直径定義（effective diameter）依存を定量化し、κ予算へ反映

目的：
- Kerr shadow は非円形であり「単一の直径係数」への写像は定義依存になり得るため、定義差が差分予測（P-model vs GR）の解釈に与える影響を定量化する。
- そのうえで、GR側の Kerr 系統として「定義依存」を κ（ring/shadow）予算へ保守的に反映し、必要精度の議論を頑健化する。

変更：
- 追加：`scripts/eht/eht_kerr_shadow_coeff_definition_sensitivity.py`
  - effective diameter 定義（avg(width,height), sqrt(width*height), area_eq, perimeter_eq）による係数レンジ差をグリッド上で集計し、global と object 制約下（M87*, Sgr A*）の envelope を固定出力。
- 更新：`scripts/eht/eht_shadow_compare.py`
  - Kerr shadow 係数の定義依存（envelope）を `reference_gr_kerr_definition_sensitivity` として追加。
  - κの Kerr 系統（`kappa_sigma_assumed_kerr`）は envelope(across methods) を正とし、spin/incのみ（avg(width,height)）の値は `*_spin_only` として併記。
- 更新：`scripts/summary/run_all.py`（`eht_kerr_shadow_coeff_definition_sensitivity` を追加）
- 更新：`doc/ROADMAP.md`（6.4.3/6.4.4 を追加・完了へ）
- 更新：`doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json` / `doc/WORK_HISTORY.md`

実行：
- `python -B scripts/eht/eht_kerr_shadow_coeff_definition_sensitivity.py`
- `python -B scripts/eht/eht_shadow_compare.py`
- `python -B scripts/eht/eht_kappa_error_budget.py`
- `python -B scripts/summary/decisive_falsification.py`

生成/更新した主な出力：
- `output/eht/eht_kerr_shadow_coeff_definition_sensitivity.png`（public: `output/eht/eht_kerr_shadow_coeff_definition_sensitivity_public.png`）
- `output/eht/eht_kerr_shadow_coeff_definition_sensitivity_metrics.json`
- `output/eht/eht_shadow_compare.json`（`reference_gr_kerr_definition_sensitivity` 追加、`*_spin_only` 併記）
- `output/eht/eht_kappa_error_budget.json` / `output/eht/eht_kappa_error_budget.png`
- `output/summary/decisive_falsification.json` / `output/summary/decisive_falsification.png`

---

## 2026-01-23（UTC） Phase 6 / Step 6.4.5：public report（dashboard）へ Kerr 系統カードを統合

目的：
- Kerr（a*,inc）系統と、effective diameter の定義依存を「読者が直接参照できる形」で public report に統合し、差分予測の頑健性を可視化する。

変更：
- 更新：`scripts/summary/public_dashboard.py`
  - Kerr 係数グリッド（6.4.1）と定義依存感度（6.4.3）のカードを追加。
  - `eht_shadow_compare.json` の `reference_gr_kerr_definition_sensitivity` を優先して summary を生成するよう更新。
- 更新：`doc/ROADMAP.md`（6.4.5 を完了へ、Step 6.4 を完了（初版）へ）
- 更新：`doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json` / `doc/WORK_HISTORY.md`

実行：
- `python -B scripts/summary/public_dashboard.py`

生成/更新した主な出力：
- `output/summary/pmodel_public_report.html`（card id: `eht_kerr_shadow_coeff_grid`, `eht_kerr_shadow_definition_sensitivity`）

---

## 2026-01-23（UTC） Phase 8 / Step 8.2：ロードマップ現在地（宣言）の整合（Phase 8へ更新）

目的：
- `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json` と `doc/ROADMAP.md` の「現在地（宣言）」が不整合にならないよう、ロードマップ側の宣言を最新（Phase 8 / Step 8.2）へ合わせる。

変更：
- 更新：`doc/ROADMAP.md`（最終更新UTC、現在地（宣言）を Phase 8 / Step 8.2 へ）

---

## 2026-01-23（UTC） Phase 8 / Step 8.2：DESI DR1（multi-tracer 昇格判定）の論文反映（BAO節）

目的：
- DESI DR1 の BAO（ε_expected cross-check）が LRG1/LRG2 に留まらず、LRG3+ELG1 / Lyα QSO でも “stable |z|≥3” となり screening→確証（距離指標依存の張力）に昇格した点を、論文本文と図一覧へ反映する。

変更：
- 更新：`doc/paper/10_manuscript.md`（DESI DR1 の multi-tracer 昇格（promotion check）を追記し、Step 4.7（距離指標前提の再接続条件）への位置づけも明記）
- 更新：`doc/paper/01_figures_index.md`（LRG3+ELG1 / Lyα QSO の shrinkage sweep 図、promotion check JSON を追加）

実行：
- `cmd /c output\summary\build_materials.bat quick-nodocx`

生成/更新した主な出力：
- `output/cosmology/cosmology_desi_dr1_bao_promotion_check.json`
- `output/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep__w_desi_default_ms_off_y1bins_lrg3elg1_reservoir_r0to17_mix_rescale__jk_cov_ra_dec_per_cap_unwrapped_n48_dec4_ra6_band0.png`
- `output/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep__w_desi_vac_lya_corr_v1p0_mubin_comb__vac_cov_smooth3.png`
- `output/summary/pmodel_paper.html`

---

---

## 2026-01-23（UTC） Phase 8 / Step 8.2：DESI DR1 promotion check の要約図を固定し、public report（dashboard）へ統合

目的：
- DESI DR1 の multi-tracer 昇格判定（promotion check）の中身（z_score_combined vs covariance shrinkage λ）を、読者が直接参照できる **要約図**として固定し、public report に統合する。
- 併せて、論文側の参照も「長い個別PNG」ではなく、要約図へ集約する。

変更：
- 更新：`scripts/cosmology/cosmology_desi_dr1_bao_promotion_check.py`
  - 既存の promotion check JSON に加え、passing tracers の z(λ) をまとめた要約図 `cosmology_desi_dr1_bao_promotion_check.png` / `_public.png` を固定出力。
- 更新：`doc/paper/10_manuscript.md`（要約図 `output/cosmology/cosmology_desi_dr1_bao_promotion_check.png` へ参照を集約）
- 更新：`doc/paper/01_figures_index.md`（promotion check 要約図を追加）
- 更新：`scripts/summary/public_dashboard.py`（card id: `cosmology_desi_dr1_bao_promotion_check` を追加）

実行：
- `python -B scripts/cosmology/cosmology_desi_dr1_bao_promotion_check.py --csv <...>`（入力CSVは `output/cosmology/cosmology_desi_dr1_bao_promotion_check.json` の `inputs.csv` と一致）
- `cmd /c output/summary/build_materials.bat quick-nodocx`

生成/更新した主な出力：
- `output/cosmology/cosmology_desi_dr1_bao_promotion_check.png`（public: `output/cosmology/cosmology_desi_dr1_bao_promotion_check_public.png`）
- `output/cosmology/cosmology_desi_dr1_bao_promotion_check.json`（`outputs.*` を追加）
- `output/summary/pmodel_public_report.html`（新カード統合）
- `output/summary/pmodel_paper.html`

---

## 2026-01-23（UTC） 運用：資料生成の最小実行（build_materials）と所要時間計測

目的：
- `run_all.py` が作業中のリソースを占有しやすいため、資料生成を「Full（run_all）/ quick / quick-nodocx」に分離し、必要時のみ軽量に更新できるようにする。
- 併せて、現状（Full）と変更後（quick/quick-nodocx）の所要時間を定量化する。

実行：
- `python -B scripts/summary/run_all.py --offline --jobs 2`
- `cmd /c output/summary/build_materials.bat quick`
- `cmd /c output/summary/build_materials.bat quick-nodocx`

計測（PowerShell `Measure-Command`）：
- Full（run_all offline; jobs=2）：約510秒（約8.5分）
- quick（reports-only + docx best-effort）：約126秒（約2.1分）
- quick-nodocx（HTMLのみ）：約2.7秒

備考：
- 作業中は原則として資料生成を必須にせず、必要時のみ `quick-nodocx` を用いる。節目で Full を回す。

---

## 2026-01-23（UTC） Phase 8 / Step 8.2：EHT検出可能性（ring σ–κσ tradeoff / δ必要精度）をdashboard/本文へ統合

目的：
- EHTの差分予測（係数差≈4.6%）が「観測で判別できる条件」を、ring統計誤差（ring σ）と κ系統（κσ）のトレードオフとして読者が直接参照できる形に固定する。
- δ（Schwarzschild shadow deviation）の必要精度（参考指標）も併記し、既存のGR解析枠との対応を示す。

変更：
- 更新：`scripts/summary/public_dashboard.py`
  - カード追加：`eht_kappa_tradeoff` / `eht_delta_precision_required`（EHT：必要精度）
  - summary_lines：`eht_shadow_compare.json`（rows）から ringσ/κσ/θ_unit などを要約表示
- 更新：`doc/paper/01_figures_index.md`（EHT節）
  - 追加：`output/eht/eht_kappa_precision_required.png` / `output/eht/eht_kappa_tradeoff.png` / `output/eht/eht_delta_precision_required.png`
- 更新：`doc/paper/10_manuscript.md`
  - EHT節（4.8）の図リストへ追加（κ必要精度/トレードオフ/δ必要精度）
  - 反証節（5.1）へ参照追加（θ_unit / ring σ / κσ の内訳を示す図）

実行：
- `cmd /c output\summary\build_materials.bat quick-nodocx`

生成/更新した主な出力：
- `output/eht/eht_kappa_tradeoff.png`（public: `output/eht/eht_kappa_tradeoff_public.png`）
- `output/eht/eht_delta_precision_required.png`（public: `output/eht/eht_delta_precision_required_public.png`）
- `output/summary/pmodel_public_report.html`（card id: `eht_kappa_tradeoff`, `eht_delta_precision_required`）
- `output/summary/pmodel_paper.html`

---

## 2026-01-23（UTC） Phase 8 / Step 8.2：EHT検出可能性の要点（M87*はθ_unit律速、Sgr A*はring σ/κσ律速）を本文に明文化

目的：
- tradeoff 図を見なくても「次に詰めるべき不確かさ源」を1段で言える形にし、論文の反証可能性（EHT）の主張を明確化する。

変更：
- 更新：`doc/paper/10_manuscript.md`
  - 反証（EHT）節に、M87*（質量/距離=θ_unitが律速）と Sgr A*（ring σ と κσ が律速）の差を短い段落として追記。

実行：
- `cmd /c output\summary\build_materials.bat quick-nodocx`

生成/更新した主な出力：
- `output/summary/pmodel_paper.html`

---

## 2026-01-23（UTC） Phase 8 / Step 8.2：結論部（6.3）のEHT判別条件を本文（4.8/5.1）の語彙と参照図へ統一

目的：
- 結論（判別条件）のEHT記述が、本文（検証/反証）で使っている語彙（θ_unit / ring σ / κσ）と参照図（tradeoff/κ要求）に揃うよう統一する。

変更：
- 更新：`doc/paper/10_manuscript.md`
  - 6.3 の EHT 判別条件に「M87*はθ_unit律速、Sgr A*はring σ・κσ律速」と参照図（tradeoff/κ要求）を追記。

実行：
- `cmd /c output/summary/build_materials.bat quick-nodocx`

生成/更新した主な出力：
- `output/summary/pmodel_paper.html`

---

## 2026-01-23（UTC） Phase 8 / Step 8.2：EHT節（4.8/5.1）の重複を整理（必要精度図を反証節へ集約）

目的：
- 検証節（4.8）は「観測量と系統（κ/Kerr/散乱）」の説明に集中させ、必要精度（tradeoff/κ要求/δ参考）は反証節（5.1）に集約して重複を減らす。

変更：
- 更新：`doc/paper/10_manuscript.md`
  - 4.8 EHT 節の図リストから必要精度図（tradeoff/κ要求/δ参考）を外し、5.1 側に参照を集約。
  - 4.8 の要点は「M87*はθ_unit律速、Sgr A*はring σ/κσ律速（定量化は5.1）」の1行に整理。

実行：
- `cmd /c output/summary/build_materials.bat quick-nodocx`

生成/更新した主な出力：
- `output/summary/pmodel_paper.html`

---

## 2026-01-23（UTC） Phase 8 / Step 8.2：EHT検出節（4.8）へ検出可能性の要点を短く追記

目的：
- 結果（EHT検証節）から反証（EHT必要精度）へ自然に導線が繋がるよう、要点（M87*はθ_unit律速、Sgr A*はring σ/κσ律速）を結果節にも明示する。

変更：
- 更新：`doc/paper/10_manuscript.md`
  - 4.8 EHT 節に要点の短い箇条書きを追加（参照：`output/eht/eht_kappa_tradeoff.png` / `output/eht/eht_kappa_precision_required.png`）。

実行：
- `cmd /c output/summary/build_materials.bat quick-nodocx`

生成/更新した主な出力：
- `output/summary/pmodel_paper.html`

---

## 2026-01-23（UTC） Phase 8 / Step 8.2：要旨の重複を解消し、EHT要件図参照を整合

目的：
- 論文要旨の重複（同趣旨の文の二重記載）を解消し、読者向けの導入を簡潔化する。
- EHTの「判別に必要な観測精度」の参照図を、本文内（5.1/6.2/6.3）で一貫させる。

変更：
- 更新：`doc/paper/10_manuscript.md`
  - 要旨：一次ソース検証の説明文の重複を解消し、強重力（二重パルサー/GW150914）の位置づけを追記。
  - 6.2（制限事項）：EHTの「必要精度要件」の参照を `eht_kappa_tradeoff` / `eht_kappa_precision_required` に統一（系統俯瞰は `eht_shadow_systematics` / `eht_shadow_differential` を併記）。

実行：
- `cmd /c output/summary/build_materials.bat quick-nodocx`

生成/更新した主な出力：
- `output/summary/pmodel_paper.html`
- `output/summary/pmodel_public_report.html`

---

## 2026-01-23（UTC） Phase 8 / Step 8.2：データ出典（一次ソース）に S2/GRAVITY（2018/2020）を追記

目的：
- 本文で S2/GRAVITY（2018/2020）を引用するようになったため、付録（データ出典）の EHT セクションにも一次ソースを追記し、参照の入口を揃える。

変更：
- 更新：`doc/paper/20_data_sources.md`
  - EHT（ブラックホール影）の一次ソースに `[Gravity2018S2Redshift]` / `[Gravity2020S2Precession]` を追加。

実行：
- `cmd /c output/summary/build_materials.bat quick-nodocx`

生成/更新した主な出力：
- `output/summary/pmodel_paper.html`
- `output/summary/pmodel_public_report.html`

---

## 2026-01-23（UTC） Phase 8 / Step 8.2：BAO節の説明を形式的に整理（暫定図の位置づけを明確化）

目的：
- 宇宙論（BAO/AP）の入口説明に口語的な表現（「本番」）が残っていたため、次段階（一次統計からの再導出）との関係が分かるように整形する。

変更：
- 更新：`doc/paper/10_manuscript.md`
  - BAO/AP の暫定図の位置づけを「次段階への診断」として明文化し、Stage A/B の説明を読みやすく整理。

実行：
- `cmd /c output/summary/build_materials.bat quick-nodocx`

生成/更新した主な出力：
- `output/summary/pmodel_paper.html`
- `output/summary/pmodel_public_report.html`

## 2026-01-23（UTC） Phase 8 / Step 8.2：`doc/STATUS.md` を最小サマリへ縮約

目的：
- `doc/STATUS.md` を「最新結果＋次の作業」だけの最小サマリに戻し、詳細は `doc/WORK_HISTORY.md` 側へ集約する（重複防止・現在地の明確化）。

変更：
- 更新：`doc/STATUS.md`
  - 長い箇条書き（過去の詳細ログ）を削除し、現在地・最新要点・次の作業・最小参照のみを残した。

---

## 2026-01-23（UTC） Phase 8 / Step 8.2：論文本文（内部向け）に materials ビルド入口を追記

目的：
- 論文本文の内部向けメモ（再現コマンド例）に、軽量/Full の materials ビルド入口（`build_materials.bat`）を追記し、日常運用と整合させる。

変更：
- 更新：`doc/paper/10_manuscript.md`
  - 再現コマンド例に `cmd /c output/summary/build_materials.bat quick-nodocx` / `cmd /c output/summary/build_materials.bat` を追記。

実行：
- `python -B scripts/summary/paper_lint.py`
- `cmd /c output/summary/build_materials.bat quick-nodocx`

生成/更新した主な出力：
- `output/summary/pmodel_paper.html`
- `output/summary/pmodel_public_report.html`

## 2026-01-23（UTC） Phase 8 / Step 8.2：DDR張力の解釈説明の重複を削減（2.5.3参照へ統一）

目的：
- DDR（距離二重性）の張力について「最小仮定の棄却 vs 距離指標前提の再検証」の説明が複数箇所で重複していたため、結論節（5.3）側は 2.5.3 節参照に置換して簡潔化する。

変更：
- 更新：`doc/paper/10_manuscript.md`
  - 5.3 の同説明を 2.5.3 節参照へ置換し、同内容の繰り返しを削減（Δε の数値は保持）。

実行：
- `python -B scripts/summary/paper_lint.py`
- `cmd /c output/summary/build_materials.bat quick-nodocx`

生成/更新した主な出力：
- `output/summary/pmodel_paper.html`
- `output/summary/pmodel_public_report.html`

## 2026-01-23（UTC） Phase 8 / Step 8.2：再現コマンド（run_all）の推奨並列数を明記

目的：
- 運用ルール（`--jobs 2`）と整合するよう、論文本文（内部向けメモ）の再現コマンド例に推奨並列数を明記する。

変更：
- 更新：`doc/paper/10_manuscript.md`
  - `python -B scripts/summary/run_all.py --offline` → `python -B scripts/summary/run_all.py --offline --jobs 2`
  - `python -B scripts/summary/run_all.py --online` → `python -B scripts/summary/run_all.py --online --jobs 2`

実行：
- `python -B scripts/summary/paper_lint.py`
- `cmd /c output/summary/build_materials.bat quick-nodocx`

生成/更新した主な出力：
- `output/summary/pmodel_paper.html`
- `output/summary/pmodel_public_report.html`

---

## 2026-01-23（UTC） Phase 8 / Step 8.2：回転項（2.7）でのGR/SR位置づけの重複を削減

目的：
- 序論（1.1）で述べた GR/SR と P-model の位置づけが、回転項（2.7）で同内容として重複していたため、参照に置き換えて簡潔化する。

変更：
- 更新：`doc/paper/10_manuscript.md`
  - 回転項（2.7）の「GR/SR と P-model の位置づけ」を 1.1 節参照へ置換し、重複を削減。

実行：
- `python -B scripts/summary/paper_lint.py`
- `cmd /c output/summary/build_materials.bat quick-nodocx`

生成/更新した主な出力：
- `output/summary/pmodel_paper.html`
- `output/summary/pmodel_public_report.html`

---

## 2026-01-23（UTC） Phase 8 / Step 8.2：paper_build のPhase表記をロードマップに合わせる

目的：
- `paper_build.py` の docstring が旧Phase表記（Phase 5）になっていたため、ロードマップ（Phase 8 / Step 8.2）と整合させる。

変更：
- 更新：`scripts/summary/paper_build.py`
  - docstring の「Phase 5」を「Phase 8 / Step 8.2」へ修正。

実行：
- `cmd /c output/summary/build_materials.bat quick-nodocx`

生成/更新した主な出力：
- `output/summary/pmodel_paper.html`
- `output/summary/pmodel_public_report.html`

---

## 2026-01-23（UTC） Phase 8 / Step 8.2：quick-nodocx 実行時に DOCX を「更新したように見せない」改善

目的：
- `build_materials.bat quick-nodocx` は HTML のみ更新する運用のため、`--skip-docx` でも既存 DOCX があると `[ok] docx` と表示されて紛らわしい問題を解消する。

変更：
- 更新：`scripts/summary/paper_build.py`
  - `--skip-docx` のときは `[ok] docx` を表示しない。
  - worklog の `paper_docx` 出力も `--skip-docx` のときは `None` として記録（「更新した」と誤読しない）。

実行：
- `cmd /c output/summary/build_materials.bat quick-nodocx`

生成/更新した主な出力：
- `output/summary/pmodel_paper.html`
- `output/summary/pmodel_public_report.html`

---

## 2026-01-23（UTC） Phase 8 / Step 8.2：要旨の列挙対象と参照を一致させる（Cassini/GPSを明記）

目的：
- 要旨の一次ソース列挙を簡潔化した後、参照（Cassini/GPS）だけが残って読みにくくならないよう、列挙対象と参照を一致させる。

変更：
- 更新：`doc/paper/10_manuscript.md`
  - 要旨の一次ソース列挙を「LLR/Cassini/GPS/EHT」に揃え、参照も対応する代表ソースへ限定。

実行：
- `python -B scripts/summary/paper_lint.py`
- `cmd /c output/summary/build_materials.bat quick-nodocx`

生成/更新した主な出力：
- `output/summary/pmodel_paper.html`
- `output/summary/pmodel_public_report.html`

---

## 2026-01-23（UTC） Phase 8 / Step 8.2：要旨の一次ソース列挙を簡潔化し、Step参照表記を統一

目的：
- 要旨（Abstract）での一次ソース列挙が長くなりすぎていたため、導入として読みやすい長さへ簡潔化する。
- 本文内で「Phase 4 / Step ...」のように Phase と Step を併記する箇所を、ロードマップ参照の一貫性のため Step 表記へ統一する。

変更：
- 更新：`doc/paper/10_manuscript.md`
  - 要旨：一次ソース検証の説明を「LLR（EDC CRD）から EHT（公表値）まで」の表現へ圧縮し、参照も代表ソースへ限定。
  - BAO節：`Phase 4 / Step 4.5B.17.4.6` → `Step 4.5B.17.4.6` に修正。

実行：
- `python -B scripts/summary/paper_lint.py`
- `cmd /c output/summary/build_materials.bat quick-nodocx`

生成/更新した主な出力：
- `output/summary/pmodel_paper.html`
- `output/summary/pmodel_public_report.html`

---

## 2026-01-23（UTC） Phase 8 / Step 8.2：要旨（Abstract）の引用重複を整理

目的：
- 要旨で重複していた一次ソース列挙を削減し、文の対象（パルサー/重力波）に対応する参照だけを残して可読性を上げる。

変更：
- 更新：`doc/paper/10_manuscript.md`
  - 「二重パルサー／GW150914」文の参照を、該当する一次ソース（パルサー/GW）へ限定し、太陽系・EHT系の重複参照を除去。

実行：
- `python -B scripts/summary/paper_lint.py`
- `cmd /c output/summary/build_materials.bat quick-nodocx`

生成/更新した主な出力：
- `output/summary/pmodel_paper.html`
- `output/summary/pmodel_public_report.html`

---

## 2026-01-23（UTC） Phase 8 / Step 8.2：DESI節の「Stage A/B」用語を明示して整合

目的：
- DESI DR1 の記述で `screening` を使う箇所があったため、ロードマップの Stage A/B（4.5A/4.5B）と関係が分かるように表記を揃える。

変更：
- 更新：`doc/paper/10_manuscript.md`
  - `screening（diag）` を `Stage A（スクリーニング：対角近似）` と明記し、確証（Stage B）への導線を統一。
  - multi-tracer 昇格条件の「screening→確証」に `Stage A/B` を併記。

実行：
- `cmd /c output/summary/build_materials.bat quick-nodocx`

生成/更新した主な出力：
- `output/summary/pmodel_paper.html`
- `output/summary/pmodel_public_report.html`

---

## 2026-01-23（UTC） Phase 8 / Step 8.2：BAO節の Stage A/B 表記をロードマップへ統一

目的：
- BAO節の「Phase A/B」という表記が、ロードマップの **Stage A（4.5A）/ Stage B（4.5B）** とズレていたため、用語を統一する。

変更：
- 更新：`doc/paper/10_manuscript.md`
  - `Phase A/B` → `Stage A/B`（4.5A/4.5B）へ置換し、本文の説明とロードマップの命名を揃えた。

実行：
- `cmd /c output/summary/build_materials.bat quick-nodocx`

生成/更新した主な出力：
- `output/summary/pmodel_paper.html`
- `output/summary/pmodel_public_report.html`

---

## 2026-01-23（UTC） Phase 8 / Step 8.2：本文のサブStep参照ラベルを整理

目的：
- BAO節のサブStep参照で「Phase 4.5B...」の誤記を修正し、ロードマップの表記（Step 4.5B...）へ揃える。

変更：
- 更新：`doc/paper/10_manuscript.md`
  - `Phase 4.5B.21.4.4` → `Step 4.5B.21.4.4`

実行：
- `cmd /c output/summary/build_materials.bat quick-nodocx`

生成/更新した主な出力：
- `output/summary/pmodel_paper.html`

---

## 2026-01-23（UTC） Phase 8 / Step 8.2：本文（宇宙論/議論）の重複と表記揺れを整理

目的：
- 本文の重複段落を解消し、宇宙論（DESI/DDR）の位置づけ（Step 4.7）と整合する文章へ揃える。
- 内部注記のPhase表記と、議論節の「達成範囲」の説明をロードマップに合わせて明確化する。

変更：
- 更新：`doc/paper/10_manuscript.md`
  - 宇宙論（DESI DR1）段落の重複を解消し、「P-model自体の棄却」ではなく Step 4.7（再接続条件）へ繋ぐ表現に統一。
  - INTERNAL_ONLY の注記を Phase 8 / Step 8.2 に更新。
  - 6.1（達成範囲）の “Phase 3（必須セット初版）” 表現を、弱場テスト＋EHTという説明へ置換。

実行：
- `cmd /c output/summary/build_materials.bat quick-nodocx`

生成/更新した主な出力：
- `output/summary/pmodel_paper.html`
- `output/summary/pmodel_public_report.html`

---

## 2026-01-23（UTC） Phase 8 / Step 8.2：宇宙論（DESI/DDR）節の表現・参照番号を整合

目的：
- DESI/DDR の張力について、「P-model全体の棄却」と読まれうる表現を避け、**距離指標前提に対する予測（再接続条件）**として位置づける。
- 本文内の誤った Step 番号参照（Step 16.5）を修正する。

変更：
- 更新：`doc/paper/10_manuscript.md`
  - DESI DR1 の promotion 判定の説明で「宇宙論で棄却」表現を削除し、Step 4.7（再接続条件）への導線に統一。
  - 2.5.3 の誤参照「Step 16.5」を「Step 4.7」に修正。
  - DDR張力の解釈を「静的背景Pの最小仮定の棄却（P-modelの一部仮定）」 vs 「距離指標前提の再検証」に明確化。

実行：
- `cmd /c output/summary/build_materials.bat quick-nodocx`

生成/更新した主な出力：
- `output/summary/pmodel_paper.html`
- `output/summary/pmodel_public_report.html`

---

## 2026-01-23（UTC） Phase 8 / Step 8.2：BAO節の Stage A/B 表記をロードマップへ統一（追記）

目的：
- BAO節の「Phase A/B」という表記を、ロードマップの **Stage A（4.5A）/ Stage B（4.5B）** に統一し、Phase 1–8 と用語が衝突しないよう整理する。

変更：
- 更新：`doc/paper/10_manuscript.md`
  - `Phase A/B` → `Stage A/B` へ置換（4.5A/4.5B の説明に揃える）。

実行：
- `cmd /c output/summary/build_materials.bat quick-nodocx`

生成/更新した主な出力：
- `output/summary/pmodel_paper.html`
- `output/summary/pmodel_public_report.html`

---

## 2026-01-23（UTC） Phase 8 / Step 8.2：資料生成の最小実行（quick-nodocx）と Full の所要時間を計測

目的：
- `run_all.py` が重い状況で、作業継続に必要な「最小限の実行」を固定し、Full との差（時間）を定量化する。

変更：
- 更新：`doc/STATUS.md`（資料生成の所要時間を追記）
- 更新：`doc/ROADMAP.md`（最終更新UTCの更新）
- 更新：`doc/AI_CONTEXT_MIN.json`（計測結果を最小辞書へ反映）

実行：
- `cmd /c output/summary/build_materials.bat quick-nodocx`（約2.67秒）
- `cmd /c output/summary/build_materials.bat`（約8分26秒；`run_all.py --offline --jobs 2`）

生成/更新した主な出力：
- `output/summary/pmodel_paper.html`
- `output/summary/pmodel_public_report.html`

---

## 2026-01-23（UTC） Phase 8 / Step 8.2：第8章（INTERNAL_ONLY）の再現コマンド重複を削減（3.1参照へ統一）

目的：
- 第3章（3.1節）と第8章で重複していた再現コマンド記述を整理し、入口（run_all / build_materials）を単一箇所へ集約する。

変更：
- 更新：`doc/paper/10_manuscript.md`
  - 第8章（INTERNAL_ONLY）側は 3.1 節の一覧参照へ置換し、重複を削減。

実行：
- `cmd /c output/summary/build_materials.bat quick-nodocx`

生成/更新した主な出力：
- `output/summary/pmodel_paper.html`
- `output/summary/pmodel_public_report.html`

---

## 2026-01-23（UTC） Phase 8 / Step 8.2：結論節の要約を更新（DESI/DDRの位置づけを明確化）

目的：
- 結論節で、宇宙論（DESI/DDR）の扱いを「一括棄却」ではなく **再接続条件（予測）**として要約し、本文（2.5.3 / 5.3 / Step 4.7）と同じ立場へ揃える。

変更：
- 更新：`doc/paper/10_manuscript.md`
  - 結論に、DESI DR1（pbg座標）の multi-tracer 張力と、Step 4.7 の再接続条件（α, s_L, s_R；Δε）への落とし込みを短く追記。

実行：
- `cmd /c output/summary/build_materials.bat quick-nodocx`

生成/更新した主な出力：
- `output/summary/pmodel_paper.html`
- `output/summary/pmodel_public_report.html`

---

## 2026-01-23（UTC） Phase 8 / Step 8.2：3.1節（INTERNAL_ONLY）の論文HTML生成コマンドを paper_build に統一

目的：
- 論文HTML生成の入口を `paper_build.py --mode publish --outdir output/summary --skip-docx` に揃え、`build_materials.bat`（quick-nodocx）と同じ実装へ統一する（運用混乱を防ぐ）。

変更：
- 更新：`doc/paper/10_manuscript.md`
  - 3.1節の再現コマンド例で `paper_html.py` を `paper_build.py`（publish, html-only）へ置換。

実行：
- `cmd /c output/summary/build_materials.bat quick-nodocx`

生成/更新した主な出力：
- `output/summary/pmodel_paper.html`
- `output/summary/pmodel_public_report.html`

---

## 2026-01-23（UTC） Phase 8 / Step 8.2：公開レポートの論文HTMLカード表記を Phase 8 に更新し、生成案内を build_materials に統一

目的：
- 公開レポート（dashboard）の論文カードが旧Phase表記（Phase 5）と `paper_html.py` を前提にしていたため、Phase 8 / Step 8.2 と `build_materials.bat`（quick-nodocx/Full）へ統一する。

変更：
- 更新：`scripts/summary/public_dashboard.py`
  - 論文カードの `kind` を「論文化（Phase 8 / Step 8.2）」へ更新。
  - 生成案内を `cmd /c output/summary/build_materials.bat quick-nodocx` / `cmd /c output/summary/build_materials.bat` に統一（補足として paper_build の直叩きも併記）。

実行：
- `cmd /c output/summary/build_materials.bat quick-nodocx`

生成/更新した主な出力：
- `output/summary/pmodel_public_report.html`

---

## 2026-01-23（UTC） Phase 8 / Step 8.2：論文化関連（doc/paper・paper_*）の Phase 表記を Phase 8 / Step 8.2 に統一

目的：
- 旧運用の名残で “Phase 5=論文化” と書かれていた箇所が残っていたため、公式ロードマップ（Phase 8 / Step 8.2）に合わせて表記を統一し、入口（再現コマンド/生成導線）の混乱を防ぐ。

変更：
- 更新：`doc/paper/README.md` / `doc/paper/00_outline.md` / `doc/paper/20_data_sources.md` / `doc/paper/30_references.md`
  - “Phase 5（論文化）” を “Phase 8 / Step 8.2（本論文）” へ置換し、build_materials の入口（quick-nodocx）を追記。
- 更新：`scripts/summary/paper_html.py` / `scripts/summary/paper_lint.py` / `scripts/summary/paper_tables.py`
  - docstring/表示バッジ等の “Phase 5（論文化）” 表記を Phase 8 / Step 8.2 に更新。

実行：
- `cmd /c output/summary/build_materials.bat quick-nodocx`

生成/更新した主な出力：
- `output/summary/pmodel_paper.html`
- `output/summary/pmodel_public_report.html`
- `output/summary/pmodel_public_dashboard_metrics.json`

---

## 2026-01-23（UTC） Phase 8 / Step 8.2：公開レポートの Table 1 カード表記を Phase 8 に更新し、生成案内を build_materials に統一

目的：
- 公開レポート（dashboard）の Table 1 カードが旧Phase表記（Phase 5）と `paper_tables.py` 直叩きを前提にしていたため、Phase 8 / Step 8.2 と `build_materials.bat`（quick-nodocx）へ統一する。

変更：
- 更新：`scripts/summary/public_dashboard.py`
  - Table 1 カードの `kind` と説明文を「Phase 8 / Step 8.2」へ更新。
  - 未生成時の案内を `cmd /c output/summary/build_materials.bat quick-nodocx`（および paper_build 直叩き）へ統一。

実行：
- `cmd /c output/summary/build_materials.bat quick-nodocx`

生成/更新した主な出力：
- `output/summary/pmodel_public_report.html`

---

## 2026-01-23（UTC） Phase 8 / Step 8.2：論文（DESI DR1）の Stage A/B 記述の矛盾を解消（Stage B=自前 dv+cov の安定性）

目的：
- 論文本文で「Stage B は公開 multipoles/cov 入手後に overlay で切り分け」としつつ、別箇所で「multi-tracer で screening→確証（Stage B）へ昇格」と書かれており、Stage B の定義が矛盾していたため、ロードマップ（Step 4.5B.21.4.4.6.*）と整合する形へ修正する。

変更：
- 更新：`doc/paper/10_manuscript.md`
  - Stage B を「raw/VAC から dv=[ξ0,ξ2]+cov を自前生成し、cov 推定法（jackknife/RascalC）や tracer を跨いだ安定性で切り分ける」へ統一。
  - 公開 multipoles/cov が入手できた場合の overlay は「追加検証（将来アップデート）」として位置づける。

実行：
- `cmd /c output/summary/build_materials.bat quick-nodocx`

生成/更新した主な出力：
- `output/summary/pmodel_paper.html`
- `output/summary/pmodel_public_report.html`

---

## 2026-01-23（UTC） Phase 8 / Step 8.2：論文（BAO Stage B）の説明を「将来計画」ではなく「狙い（定義）」へ統一

目的：
- BAO節の Stage B 説明が「〜を評価する」と将来計画のように読めたため、本文の役割（Stage B の狙い＝定義）として読める表現へ統一する（ロードマップの Stage A/B の説明と整合）。

変更：
- 更新：`doc/paper/10_manuscript.md`
  - 「Stage B（4.5B）では〜を評価する」→「Stage B（4.5B）の狙いは〜を評価することにある」へ変更。

実行：
- `cmd /c output/summary/build_materials.bat quick-nodocx`

生成/更新した主な出力：
- `output/summary/pmodel_paper.html`
- `output/summary/pmodel_public_report.html`

---

## 2026-01-23（UTC） Phase 8 / Step 8.2：本文中の「Step n.m」の意味（ロードマップ番号）を明文化

目的：
- 本文では「Step 4.6/4.7」等の表記を用いる一方、本文の章番号（例：4.7 GPS）とも重なるため、読者が「Step」を章番号と誤解しないよう、`doc/ROADMAP.md` のロードマップ番号であることを明文化する。

変更：
- 更新：`doc/paper/10_manuscript.md`
  - 1.2節（本研究の貢献）に「Step n.m はロードマップ番号（章番号とは独立）」の注記を追加。

実行：
- `cmd /c output/summary/build_materials.bat quick-nodocx`

生成/更新した主な出力：
- `output/summary/pmodel_paper.html`
- `output/summary/pmodel_public_report.html`

---

## 2026-01-23（UTC） Phase 8 / Step 8.2：本文の曖昧な Step 参照を「ROADMAP Step」へ統一（章番号との衝突回避）

目的：
- 本文内の「Step 4.6/4.7」は章番号（例：4.7 GPS）と衝突して読者が混線し得るため、曖昧な箇所を「ROADMAP Step 4.6/4.7」と明示して衝突を回避する。

変更：
- 更新：`doc/paper/10_manuscript.md`
  - 「Step 4.6/4.7」を「ROADMAP Step 4.6/4.7」へ置換（4.6.5 を含む）。
  - 1.2節の注記も「ROADMAP Step n.m」に合わせて更新。

実行：
- `cmd /c output/summary/build_materials.bat quick-nodocx`

生成/更新した主な出力：
- `output/summary/pmodel_paper.html`
- `output/summary/pmodel_public_report.html`

---

## 2026-01-23（UTC） Phase 8 / Step 8.2：ROADMAP Step 表記を全文で一貫化（4.5B系も含む）

目的：
- 「Step 4.5B.*」のようなROADMAPサブStep表記も、章番号の混線回避のため「ROADMAP Step」に統一する。

変更：
- 更新：`doc/paper/10_manuscript.md`
  - 「Step 4.5B.*」→「ROADMAP Step 4.5B.*」へ置換。
  - 冒頭の内部注記も「ROADMAP Step 8.2」へ統一。

実行：
- `cmd /c output/summary/build_materials.bat quick-nodocx`

生成/更新した主な出力：
- `output/summary/pmodel_paper.html`
- `output/summary/pmodel_public_report.html`

---

## 2026-01-23（UTC） Phase 8 / Step 8.2：ε 記号の混線防止（BAO/AP ε vs 重力赤方偏移 ε vs DDR ε0）

目的：
- 本文では ε が複数の文脈（BAO/AP warping、重力赤方偏移テストの偏差パラメータ、DDRの ε0）で登場するため、混線しないよう「別定義」であることを明記する。

変更：
- 更新：`doc/paper/10_manuscript.md`
  - BAO/AP の ε（2.5.1）について、重力赤方偏移 ε と DDR ε0 との別定義を明記。
  - 重力赤方偏移（GP-A/Galileo）の ε（4.9）について、BAO/AP の ε との別定義を明記。

実行：
- `cmd /c output/summary/build_materials.bat quick-nodocx`

生成/更新した主な出力：
- `output/summary/pmodel_paper.html`
- `output/summary/pmodel_public_report.html`

---

## 2026-01-23（UTC） Phase 8 / Step 8.2：S2/GRAVITY（2018/2020）の一次ソースを本文引用へ反映

目的：
- S2/GRAVITY の補足（強場の独立テスト）が一次ソース（GRAVITY Collaboration 2018/2020）と直接結びついていなかったため、引用を固定する。

変更：
- 更新：`doc/paper/10_manuscript.md`
  - S2/GRAVITY 補足に `[Gravity2018S2Redshift][Gravity2020S2Precession]` を付与。
- 更新：`doc/paper/30_references.md`
  - GRAVITY Collaboration 2018（S2 重力赤方偏移）と 2020（S2 Schwarzschild 歳差）を追加。

実行：
- `cmd /c output\summary\build_materials.bat quick-nodocx`

生成/更新した主な出力：
- `output/summary/pmodel_paper.html`
- `output/summary/pmodel_public_report.html`

---

## 2026-01-23（UTC） Phase 8 / Step 8.2：EHTデータ出典に GRAVITY/S2 のローカルキャッシュを追記

目的：
- EHT のデータ出典（一次ソース）に対して、GRAVITY（Sgr A* 質量・距離）と S2 強場テスト（2018/2020）のローカルキャッシュ位置が明示されていなかったため、offline 再現の入口を揃える。

変更：
- 更新：`doc/paper/20_data_sources.md`
  - EHT 節の「ローカルキャッシュ（入力）」に GRAVITY 2019 / S2 2018/2020 のPDFと、参照マニフェスト（URL/sha256固定）を追記。

実行：
- `cmd /c output\summary\build_materials.bat quick-nodocx`

生成/更新した主な出力：
- `output/summary/pmodel_paper.html`
- `output/summary/pmodel_public_report.html`

---

## 2026-01-23（UTC） Phase 8 / Step 8.2：Stage A/B（4.5A/4.5B）がロードマップ番号であることを明確化

目的：
- 宇宙論（BAO）節の Stage A/B の括弧内表記（4.5A/4.5B）が、本文の章番号と混線しないよう「ロードマップ番号」であることを明確化する。

変更：
- 更新：`doc/paper/10_manuscript.md`
  - 1.2節の注記を拡張（ROADMAP Step に加え、Stage A/B（4.5A/4.5B）も ROADMAP 番号と明記）。
  - BAO節の最初の Stage A/B 言及を「ROADMAP 4.5A/4.5B」として明示。

実行：
- `cmd /c output\summary\build_materials.bat quick-nodocx`

生成/更新した主な出力：
- `output/summary/pmodel_paper.html`
- `output/summary/pmodel_public_report.html`

---

## 2026-01-24（UTC） Phase 8 / Step 8.2：資料生成コマンド表記を Windows cmd で実行可能な形に修正（`output\summary\...`）

目的：
- `cmd /c output/summary/build_materials.bat ...` は Windows の `cmd` では `/` がオプション区切りとして解釈され、コマンドが失敗するため、資料生成コマンド表記を `output\summary\...`（バックスラッシュ）へ統一する。

変更：
- 更新：`doc/paper/10_manuscript.md`
  - 再現コマンドの資料生成案内を `cmd /c output\summary\build_materials.bat ...` に修正。
- 更新：`doc/paper/README.md`
  - 入口（軽量/Full）と Table 1 生成コマンドを修正。
- 更新：`doc/paper/20_data_sources.md`
  - 共通ルールの資料生成コマンドを修正。
- 更新：`scripts/summary/public_dashboard.py`
  - 未生成時/生成案内の表示文字列を修正（コピー&ペーストで動く形に）。
- 更新：`doc/AI_CONTEXT_MIN.json`
  - 再現コマンド（materials build）表記を修正。

実行：
- `cmd /c output\summary\build_materials.bat quick-nodocx`

生成/更新した主な出力：
- `output/summary/pmodel_paper.html`
- `output/summary/pmodel_public_report.html`

---

## 2026-01-24（UTC） Phase 8 / Step 8.2：本文の「暫定」表現を整理（予備/近似/採用値（例）へ統一）

目的：
- 本文の「暫定」表現が文脈によって揺れていたため、(i) 予備診断、(ii) 近似仮定、(iii) 採用値（例）の区別が読者に伝わるよう表現を整理する。

変更：
- 更新：`doc/paper/10_manuscript.md`
  - BAO節の「暫定的な診断図」→「予備的な診断図」へ修正。
  - EHT節の zスコア表現を「κ=1 を置いた zスコア（参考）」へ修正。
  - 速度飽和 δ の記述を「採用値（例）」へ統一。

実行：
- `cmd /c output\summary\build_materials.bat quick-nodocx`

生成/更新した主な出力：
- `output/summary/pmodel_paper.html`
- `output/summary/pmodel_public_report.html`

---

## 2026-01-24（UTC） Phase 3 / Step 3.1–3.3：四重極が主項になる理由（遅延解→多極展開→保存則）を明文化

目的：
- Phase 3（動的P・放射）の理論セクションで「なぜ四重極が主項か」が曖昧だと、二重パルサー/GW（Phase 3.4/3.5）の整合性が空中に浮くため、最小仮定の鎖（遅延解→多極展開→保存則）として明文化する。

変更：
- 更新：`doc/paper/10_manuscript.md`
  - 2.6節に遅延解（retarded solution）と質量モーメント（M, D_i, Q_ij）を追記し、質量保存・運動量保存から単極/双極が放射しないことを明示。
  - P-modelの弱場極限として「普遍結合（双極放射なし）」を必要条件として固定し、二重パルサーの制約と接続。
- 更新：`doc/P_model_handoff.md`
  - 1.7節に質量モーメントと保存則（単極/双極なし）を追記し、運用上の必要条件（普遍結合）として明文化。
- 更新：`doc/ROADMAP.md`
  - Phase 3 / Step 3.1–3.3 を完了（初版）へ更新し、Phase 8の前提として固定した旨を「現在地（宣言）」へ反映。
- 更新：`doc/STATUS.md`
  - 最新結果と次作業（Phase 8 / Step 8.2 の通読・整合）を更新。
- 更新：`doc/AI_CONTEXT_MIN.json`
  - done/next を更新。

実行：
- `python -B scripts/summary/paper_lint.py`
- `cmd /c output\summary\build_materials.bat quick-nodocx`

生成/更新した主な出力：
- `output/summary/pmodel_paper.html`
- `output/summary/pmodel_public_report.html`

---

## 2026-01-24（UTC） ロードマップ方針更新：Phase 3 完全完了 → Phase 6.2（弱場統合）→ Phase 8（論文化）

目的：
- Phase 3（動的・放射）の根幹（四重極主項の理由）を固定したうえで、弱場テスト（太陽系）の長期・多系統統合で“逃げ道”を塞ぎ、その後に Phase 8（論文化）で全体の整合と反証条件を確定する順序へ切り替える。

変更：
- 更新：`doc/ROADMAP.md`
  - 「現在地（宣言）」を Phase 6 / Step 6.2 優先へ更新し、方針（Phase 3→6.2→8）を明記。
  - Phase 3 / Step 3.1–3.3 の現状を「完了」へ更新（初版表記を外し、Phase 3 完全完了として扱う）。
  - Step 6.2 を「進行中」へ更新し、6.2.1–6.2.4 の作業分解（I/F固定、系統分解、長期バッチ、反証条件）を追加。
  - Phase 8（Step 8.2/8.3）は Step 6.2 完了後に再開するため「保留」へ更新。
- 更新：`doc/STATUS.md`
  - 現在地を Phase 6 / Step 6.2 へ更新。
- 更新：`doc/AI_CONTEXT_MIN.json`
  - phase/step と next を更新。

---

## 2026-01-24（UTC） Phase 8 / Step 8.4：論文図の番号昇順化＋表示改善（全幅・拡大）

目的：
- 論文HTMLで図番号が参照順に昇順にならず読みづらかったため、本文の参照順で図番号（図1, 図2, …）が単調増加になるようにする。
- 図が小さく見える問題に対し、紙面上で図を優先して読める（全幅表示＋クリック拡大）形にする。

変更：
- 更新：`scripts/summary/paper_html.py`
  - 図番号の付与順を本文（doc/paper/*.md）の参照順に合わせ、publish HTML で図番号が昇順になるよう整理。
  - 図の inline 挿入をセクション跨ぎで一意に管理し、同一図の重複挿入（同一idの重複）を防止。
  - 図を全幅表示（CSS）し、クリックで拡大表示できるようリンクを追加。
- 更新：`doc/paper/01_figures_index.md`
  - 図番号の付与ルール（参照順）に合わせて注記を更新。
- 更新：`doc/ROADMAP.md`
  - Phase 8 に Step 8.4（図表品質改善）を追記。

実行：
- `cmd /c output\summary\build_materials.bat quick-nodocx`

生成/更新した主な出力：
- `output/summary/pmodel_paper.html`
- `output/summary/pmodel_public_report.html`

---

## 2026-01-24（UTC） Phase 6 / Step 6.2.1：弱場統合I/F（test matrix）を固定

目的：
- 弱場テスト（Cassini/Viking/Mercury/LLR/GPS）を長期・多系統で統合するため、入力・期間・推定量・補正（knobs）・再現コマンドを機械可読（JSON）で固定する。

変更：
- 追加：`scripts/summary/weak_field_test_matrix.py`
  - 統合I/F（対象テスト、入力、期間、推定量、補正、再現コマンド、主要出力）を JSON として生成。
- 追加：`output/summary/weak_field_test_matrix.json`
- 更新：`doc/ROADMAP.md`
  - Step 6.2.1 を完了（初版）へ更新。
- 更新：`doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`
  - Step 6.2.1 完了を反映し、次作業（6.2.2〜）へ更新。

実行：
- `python -B scripts/summary/weak_field_test_matrix.py`

生成/更新した主な出力：
- `output/summary/weak_field_test_matrix.json`

---

## 2026-01-24（UTC） Phase 6 / Step 6.2.2：弱場テスト系統分解テンプレを固定

目的：
- Step 6.2.1 の統合I/F（test matrix）を起点に、弱場テスト（Cassini/Viking/Mercury/LLR/GPS）について「何を動かしたら何が動くか」を系統分解テンプレとして固定し、長期・多系統統合バッチ（Step 6.2.3）の入力を準備する。

変更：
- 追加：`scripts/summary/weak_field_systematics_templates.py`
  - `output/summary/weak_field_test_matrix.json` を読み、系統分解テンプレ JSON を生成。
- 追加：`output/summary/weak_field_systematics_templates.json`
- 更新：`doc/ROADMAP.md`
  - Step 6.2.2 を完了（初版）へ更新。
- 更新：`doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`
  - Step 6.2.2 完了を反映し、次作業（6.2.3〜）へ更新。

実行：
- `python -B scripts/summary/weak_field_systematics_templates.py`

生成/更新した主な出力：
- `output/summary/weak_field_systematics_templates.json`

---

## 2026-01-24（UTC） Phase 6 / Step 6.2.3：弱場長期・多系統の集約出力（consistency）を固定

目的：
- Step 6.2.1（統合I/F）と Step 6.2.2（系統分解テンプレ）を前提に、弱場テスト（Cassini/Viking/Mercury/LLR/GPS）の主要メトリクスを一括集約し、長期・多系統統合の入口（固定出力）を作る。

変更：
- 追加：`scripts/summary/weak_field_longterm_consistency.py`
  - 各テストの既存出力（metrics/summary）を収集し、集約JSONとサマリ図を生成。
  - `--rerun` を指定した場合は baseline コマンドを再実行してから集約（offline-first）。
- 追加：`output/summary/weak_field_longterm_consistency.json`
- 追加：`output/summary/weak_field_longterm_consistency.png`
- 更新：`doc/ROADMAP.md`
  - Step 6.2.3 を完了（初版）へ更新。
- 更新：`doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`
  - Step 6.2.3 完了を反映し、次作業（6.2.4）へ更新。

実行：
- `python -B scripts/summary/weak_field_longterm_consistency.py`

生成/更新した主な出力：
- `output/summary/weak_field_longterm_consistency.json`
- `output/summary/weak_field_longterm_consistency.png`

---

## 2026-01-24（UTC） Phase 6 / Step 6.2.4：弱場統合の反証条件（棄却基準）を固定

目的：
- 弱場テストを「同一β（凍結）で貫く」運用のもとで、どの程度の不一致で棄却するか（最低限の破綻検出条件）を機械可読（JSON）で固定する。

変更：
- 追加：`scripts/summary/weak_field_falsification.py`
  - `output/summary/weak_field_longterm_consistency.json` と各テストの run metadata を参照し、反証条件（pass/fail/unknown）を評価して固定出力。
- 追加：`output/summary/weak_field_falsification.json`
- 更新：`doc/ROADMAP.md`
  - Step 6.2.4 を完了（初版）へ更新し、Step 6.2 を完了（初版）へ更新。
- 更新：`doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`
  - Step 6.2 完了を反映し、Phase 8（論文化）を再開する現在地へ更新。

実行：
- `python -B scripts/summary/weak_field_longterm_consistency.py --rerun`
- `python -B scripts/summary/weak_field_falsification.py`

生成/更新した主な出力：
- `output/summary/weak_field_longterm_consistency.json`
- `output/summary/weak_field_longterm_consistency.png`
- `output/summary/weak_field_falsification.json`

---

## 2026-01-24（UTC） Phase 8 / Step 8.4.2：図の可読性改善（EHT図の凡例かぶり対策）

目的：
- 論文/レポートの主要図で「凡例が図にかぶる」「文字がはみ出す」問題を潰し、図中心で読める状態に近づける。

変更：
- 更新：`scripts/eht/eht_shadow_compare.py`
  - κ必要精度／δ必要精度／κ系統図で凡例を図外へ移動し、保存時に `bbox_inches="tight"` を適用。
  - κトレードオフ図のレイアウト（legend位置と `tight_layout` の rect）を調整。
- 実行：`python -B scripts/eht/eht_shadow_compare.py`
  - 更新出力（例）：`output/eht/eht_kappa_precision_required*.png`、`output/eht/eht_delta_precision_required*.png`、`output/eht/eht_shadow_systematics*.png`、`output/eht/eht_kappa_tradeoff*.png`
- 更新：`doc/ROADMAP.md`
  - Step 8.2/8.3 の「保留」を解除（Step 6.2 完了により再開）。
  - Step 8.4.2 に進捗メモを追記。
- 更新：`doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`
  - Phase 8 の現在地と次作業を更新。

---

## 2026-01-24（UTC） Phase 8 / Step 8.4.2：図の可読性改善（低解像/凡例かぶりの代表セットを一括是正）

目的：
- 図表インデックス（`doc/paper/01_figures_index.md`）で参照される図のうち、解像度不足や凡例かぶりで「紙面で読めない」リスクが高いものを優先して修正し、論文HTMLへ反映する。

変更：
- 更新：`scripts/viking/update_slides.py`
  - 図の `figsize/dpi` を増やし、凡例を図外へ移動、`bbox_inches="tight"` で保存。
- 更新：`scripts/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep.py`
  - 図の `figsize/dpi` を増やし、凡例を図外へ移動、`bbox_inches="tight"` で保存。
- 更新：`scripts/eht/eht_sgra_paper5_m3_historical_distribution_values.py`
  - ECDF図の `figsize/dpi` を増やし、凡例を図外へ移動、`bbox_inches="tight"` で保存。
- 追加：`scripts/llr/llr_station_coord_delta_plot.py`
  - `output/llr/batch/llr_station_metadata_used.json` から局座標差分図のみを軽量再生成できるように追加（`llr_batch_eval.py` の重い再実行を避ける目的）。
- 更新：`scripts/pulsar/binary_pulsar_orbital_decay.py`
  - 図の `figsize/dpi` を増やし、凡例を図外へ移動、`bbox_inches="tight"` で保存。
- 更新：`scripts/cosmology/cosmology_bao_catalog_peakfit_caps_summary.py`
  - 図の `figsize/dpi` を増やし、凡例を図外へ移動、注記の配置を調整、`bbox_inches="tight"` で保存。
- 更新：`scripts/cosmology/fetch_mast_jwst_spectra.py`
  - `z_confirmed_summary` 図の `figsize/dpi` を増やし、`bbox_inches="tight"` で保存。
- 更新：`doc/ROADMAP.md`
  - Step 8.4.2（可読性）を完了（初版）へ更新し、Step 8.4 を完了（初版）へ更新。
  - 次の現在地を Step 8.2（本文整合：最終確認）へ移動。

実行：
- `python -B scripts/viking/update_slides.py`
- `python -B scripts/eht/eht_sgra_paper5_m3_historical_distribution_values.py`
- `python -B scripts/pulsar/binary_pulsar_orbital_decay.py`
- `python -B scripts/cosmology/cosmology_bao_catalog_peakfit_caps_summary.py --out-tag recon_grid_iso`
- `python -B scripts/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep.py ... --skip-existing`（既存出力を再利用して再描画）
- `python -B scripts/cosmology/fetch_mast_jwst_spectra.py --targets ... --offline --confirm-z`
- `python -B scripts/llr/llr_station_coord_delta_plot.py`
- `cmd /c output\\summary\\build_materials.bat quick-nodocx`（PNGを論文HTMLへ反映：base64埋め込み）

生成/更新した主な出力：
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_public_report.html`
- `output/viking/viking_p_model_vs_measured_no_arrow.png`
- `output/eht/eht_sgra_paper5_m3_historical_distribution_values_ecdf.png`
- `output/llr/batch/llr_station_coord_delta_pos_eop.png`
- `output/pulsar/binary_pulsar_orbital_decay.png`
- `output/cosmology/cosmology_bao_catalog_peakfit_caps_summary__recon_grid_iso.png`
- `output/cosmology/cosmology_desi_dr1_bao_cov_shrinkage_sweep__*.png`
- `output/cosmology/jwst_spectra__*__z_confirmed_summary.png`

---

## 2026-01-24（UTC） Phase 8 / Step 8.2：論文publishの軽量QC（paper_qc）を固定

目的：
- 論文publish成果物（`output/summary/pmodel_paper.html`）について、機械的に検出できる混入/崩れを最小コストで検査し、再現可能なチェック入口を固定する。

変更：
- 追加：`scripts/summary/paper_qc.py`
  - paper_lint strict／図番号連番／数式alt（`数式`）／HTMLの `\\` 混入／Markdown本文（$$外）の LaTeXエスケープ混入（例：`\gamma`）を一括チェック。
- 追加：`output/summary/paper_qc.json`
- 更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`
  - Step 8.2 のQC入口と現在地を反映。

実行：
- `python -B scripts/summary/paper_qc.py`

生成/更新した主な出力：
- `output/summary/paper_qc.json`

---

## 2026-01-24（UTC） Phase 8 / Step 8.2：ロードマップ現在地の整合＋ビルド時間計測（run_all vs quick-nodocx）

目的：
- `doc/ROADMAP.md` の「現在地（宣言）」が Step 8.4 のままになっていたため、実際の現在地（Step 8.2）と整合させる。
- 重い `run_all.py` と軽量 `build_materials.bat quick-nodocx` の実行時間差を定量化し、作業中の最小実行フローを明確にする。

変更：
- 更新：`doc/ROADMAP.md`
  - 「現在地（宣言）」を **Phase 8 / Step 8.2（本文整合）** へ修正（Step 8.4 は完了（初版）として固定）。
- 計測：ビルド所要時間（同一環境での目安）
  - `cmd /c output\\summary\\build_materials.bat quick-nodocx`：**約3.1秒**（HTMLのみ更新）
  - `python -B scripts/summary/run_all.py --offline --jobs 2`：**約8.7分**（DOCX生成を含む）

実行：
- `cmd /c output\\summary\\build_materials.bat quick-nodocx`
- `python -B scripts/summary/run_all.py --offline --jobs 2`

生成/更新した主な出力：
- `output/summary/pmodel_paper.html`
- `output/summary/pmodel_public_report.html`
- `output/summary/run_all_status.json`

---

## 2026-01-24（UTC） Phase 8 / Step 8.2-8.3：publish体裁の整合（草稿表記除去）＋公開手順の拡充

目的：
- publish成果物に残っていた「草稿」表記を除去し、外部公開時の誤解を減らす。
- 公開/再現の最小実行・公開範囲（含める/含めない）を `doc/PUBLISHING.md` に明文化し、マニフェストで固定する。

変更：
- 更新：`doc/paper/10_manuscript.md`
  - タイトルから「草稿」表記を除去。
- 更新：`doc/paper/20_data_sources.md`
  - publishに出る箇所の「論文草稿では…」表記を「本稿では…」へ統一。
- 更新：`scripts/summary/paper_html.py`
  - publish HTML のタイトルから「草稿」表記を除去。
  - 参考文献セクション名の「（ドラフト）」表記を除去。
- 更新：`scripts/summary/public_dashboard.py`
  - レポート上の表記（本文草稿→本文、論文草稿→論文本体）を統一。
- 更新：`doc/PUBLISHING.md`
  - `release_manifest.py` の位置づけ、公開範囲（含める/含めない）、実行コスト目安を追記。
- 更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`
  - 上記の進捗・現在地の整合とタイムスタンプ更新。

実行：
- `cmd /c output\\summary\\build_materials.bat quick-nodocx`
- `python -B scripts/summary/paper_qc.py`

---

## 2026-01-24（UTC） Phase 7：追加検証（COW/原子干渉計/量子時計/重力デコヒーレンス/量子光/QED精密）をロードマップへ追記

目的：
- Phase 7（量子）を「ベル（time-tag / selection）」に限定せず、重力×干渉・量子時計・量子光・真空/QED精密まで含む検証ロードマップへ拡張する。
- 論文化資料（paper/short note）にも「今後の拡張」として追記し、読者が現状と次の検証対象を追える形にする。

変更：
- 更新：`doc/ROADMAP.md`
  - Step 7.5–7.8 を追加（COW、原子干渉計重力計、重力誘起デコヒーレンス、量子時計、物質波/二重スリット/de Broglie、単一光子/HOM/スクイーズド光、Casimir/Lamb）。
- 更新：`doc/paper/10_manuscript.md` / `doc/paper/15_short_note.md`
  - Phase 7 の拡張（今後の検証対象）を資料側にも明示。

実行：
- `cmd /c output\\summary\\build_materials.bat quick-nodocx`
- `python -B scripts/summary/paper_qc.py`
- `python -B scripts/summary/release_manifest.py`

生成/更新した主な出力：
- `output/summary/pmodel_paper.html`
- `output/summary/pmodel_public_report.html`
- `output/summary/paper_qc.json`
- `output/summary/release_manifest.json`

---

## 2026-01-24（UTC） Phase 8 / Step 8.3：公開マニフェスト拡張＋配布バンドル（zip）生成

目的：
- Step 8.3（データ・コード公開）の入口を「第三者へ渡せる形」まで具体化する（zip生成）。
- `release_manifest.json` の対象を拡張し、論文入力（doc/paper）と基準定義（handoff）まで含めて “公開の入口” を固定する。

変更：
- 更新：`scripts/summary/release_manifest.py`
  - docs/entrypoints を拡張（`doc/P_model_handoff.md`、`doc/paper/*.md`、`scripts/summary/release_bundle.py` などを追加）。
- 追加：`scripts/summary/release_bundle.py`
  - 配布用 zip を生成（paper: 読み物＋最小docs、repro: コード＋docs＋入口＋summary成果物）。
- 更新：`doc/PUBLISHING.md`
  - 配布バンドル（zip）の生成コマンドを追記（paper/repro）。

実行：
- `python -B scripts/summary/release_manifest.py --no-hash`
- `python -B scripts/summary/release_bundle.py --mode paper --no-hash`
- `python -B scripts/summary/release_bundle.py --mode repro --no-hash`

---

## 2026-01-24（UTC） Phase 4 / Step 4.6：JWST manifest の回帰防止（offlineでz集約維持）と waitlist 反映

目的：
- `fetch_mast_jwst_spectra.py --offline` 実行で、z候補/確定の集約（`manifest_all.json`）が消える回帰を防止し、軽量運用（offline）でもダッシュボード/スコアボードが壊れない形にする。
- 公開待ち（GN-z11）の状態を waitlist として論文側にも明示し、次のアクション（公開後に z_confirmed まで到達）へ接続する。

変更：
- 更新：`scripts/cosmology/fetch_mast_jwst_spectra.py`
  - `--offline` で既存の z推定/確定（`output/cosmology/jwst_spectra__*__z_{estimate,confirmed}.json`）を軽量サマリとして読み込み、manifest を上書きしても状態が消えないようにした（`manifest_all.json` も小さいまま維持）。
- 更新：`doc/paper/10_manuscript.md`（2.5.2）
  - waitlist 出力（`output/cosmology/jwst_spectra_release_waitlist.*`）の参照と、参照日（UTC）を更新。

実行：
- `python -B scripts/cosmology/fetch_mast_jwst_spectra.py --offline`
- `python -B scripts/cosmology/jwst_spectra_release_waitlist.py`
- `cmd /c output\\summary\\build_materials.bat quick-nodocx`
- `python -B scripts/summary/paper_qc.py`

結果：
- `data/cosmology/mast/jwst_spectra/manifest_all.json` が z候補/確定の進捗を含む形で安定化（offlineでも維持）。
- `output/cosmology/jwst_spectra_release_waitlist.json` / `.csv` を更新（blocked は GN-z11 のみ）。
- `output/summary/pmodel_paper.html` / `output/summary/pmodel_short_note.html` / `output/summary/pmodel_public_report.html` を更新（HTMLのみ）。

---

## 2026-01-24（UTC） Phase 4 / Step 4.6：JWST スペクトルの公開待ち状況を waitlist として固定

目的：
- GN-z11 のように「観測は見つかるが proprietary で取得できない」ケースについて、公開待ち（release待ち）を機械可読な一次出力として固定し、次に実行すべきコマンドへ即接続できる形にする。

変更：
- 追加：`scripts/cosmology/jwst_spectra_release_waitlist.py`
- 追記：`doc/ROADMAP.md`（Step 4.6.6）
- 更新：`doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`

実行：
- `python -B scripts/cosmology/fetch_mast_jwst_spectra.py --targets GN-z11 --max-obs 1`
- `python -B scripts/cosmology/jwst_spectra_release_waitlist.py`

結果：
- GN-z11 は `is_released=false` のままで、`t_obs_release_utc=2026-04-09T20:45:23.996448+00:00` を再確認。
- waitlist 出力：`output/cosmology/jwst_spectra_release_waitlist.json` / `.csv`（現時点の blocked は GN-z11 のみ）。
- `python -B scripts/summary/paper_qc.py`

生成/更新した主な出力：
- `output/summary/release_manifest.json`
- `output/summary/pmodel_release_bundle_paper.zip`
- `output/summary/pmodel_release_bundle_repro.zip`

---

## 2026-01-24（UTC） Phase 7（量子）/ Step 7.4.7.2：Giustina 2015 APS supplemental の Cloudflare ブロック検出と手動DL手順の明文化

目的：
- Step 7.4.7（NIST以外の photon time-tag 統合）のうち、Giustina et al. 2015 の photon time-tag（click log）取得が「環境依存で 403」になっている原因を特定し、再現可能な形で “ブロック条件” と “回避（手動DL）” を明文化する。

変更：
- 改善：`scripts/quantum/fetch_giustina2015_prl115_250401.py`
  - APS supplemental 取得失敗時に HTTP status / response headers を記録し、Cloudflare challenge（`cf-mitigated: challenge`）を検出できるようにした。
  - Cloudflare ブロック時に「手動DL→配置→`--offline`で manifest 更新」の具体的手順を CLI に表示するようにした。
- 更新：`doc/quantum/05_bell_public_datasets.md` / `doc/ROADMAP.md`
  - APS supplemental（Giustina time-tag）が Cloudflare challenge で自動取得できない場合の手動DL手順を追記。

実行：
- `python -B scripts/quantum/fetch_giustina2015_prl115_250401.py --include-aps-supplemental`

生成した主な出力：
- `data/quantum/sources/giustina2015_prl115_250401/manifest.json`（`aps_supplemental_attempt` に status/headers を記録）

---

## 2026-01-24（UTC） Phase 8（公開資料）/ 一般向けレポートに「量子（Phase 7）」章を追加（宇宙論と分離）

目的：
- 一般向けレポート（`output/summary/pmodel_public_report.html`）で、量子（Phase 7）を宇宙論（Phase 4）と混線しないように分離し、公開データ再解析の入口を明示する。

変更：
- 更新：`scripts/summary/public_dashboard.py`
  - public report のセクションに「量子（Phase 7）」を追加し、以下の入口を掲載：
    - NIST（time-tag）/ Delft（event-ready）/ Weihs 1998（photon time-tag）
    - 光の量子干渉（visibility/HOM/squeezing）
    - 真空・QED精密（Casimir/Lamb）

実行：
- `cmd /c output\\summary\\build_materials.bat quick-nodocx`

生成した主な出力：
- `output/summary/pmodel_public_report.html`（量子章を追加）

---

## 2026-01-24（UTC） Phase 8 / Step 8.3：release_bundleの安定化（manifest同梱）＋PUBLISHING追記

目的：
- `release_manifest.json` を初回実行で必須扱いにして失敗しないようにしつつ、配布バンドルには必ず manifest を同梱する（公開入口の喪失防止）。
- 配布バンドルの注意（rawデータ非同梱・paper HTMLが大きくなり得る）を `doc/PUBLISHING.md` に明記する。

変更：
- 更新：`scripts/summary/release_manifest.py`
  - manifest自身（`output/summary/release_manifest.json`）を必須チェック対象から除外（初回実行の安定化）。
- 更新：`scripts/summary/release_bundle.py`
  - `release_manifest.json` を常に同梱（重複がないように吸収）。
  - `zip_size_bytes` を出力し、`BUNDLE_INFO.json` に合計サイズ・最大ファイル一覧を記録。
- 更新：`doc/PUBLISHING.md`
  - 配布バンドルの注意（data非同梱・paper HTMLサイズ）を追記。

実行：
- `python -B scripts/summary/release_manifest.py --no-hash`
- `python -B scripts/summary/release_bundle.py --mode paper --no-hash`
- `python -B scripts/summary/release_bundle.py --mode repro --no-hash`

- `python -B scripts/summary/paper_qc.py`

生成/更新した主な出力：
- `output/summary/release_manifest.json`
- `output/summary/pmodel_release_bundle_paper.zip`
- `output/summary/pmodel_release_bundle_repro.zip`
- `output/summary/paper_qc.json`

---

## 2026-01-24（UTC） Phase 8 / Step 8.3：release_manifestに配布バンドル（zip）を optional として記録

目的：
- 生成済みの配布バンドル（zip）を `release_manifest.json` に記録し、公開物の一覧が機械可読で揃うようにする。
  （zip は生成タイミングによって存在しないことがあるため、必須ではなく optional 扱いとする。）

変更：
- 更新：`scripts/summary/release_manifest.py`
  - `release_bundles`（optional）グループを追加し、`output/summary/pmodel_release_bundle_{paper,repro}.zip` を記録。

実行：
- `python -B scripts/summary/release_manifest.py --no-hash`
- `python -B scripts/summary/release_bundle.py --mode paper --no-hash`
- `python -B scripts/summary/release_bundle.py --mode repro --no-hash`

- `python -B scripts/summary/paper_qc.py`

生成/更新した主な出力：
- `output/summary/release_manifest.json`
- `output/summary/pmodel_release_bundle_paper.zip`
- `output/summary/pmodel_release_bundle_repro.zip`
- `output/summary/paper_qc.json`

---

## 2026-01-24（UTC） Phase 8 / Step 8.2：本文整合（表記ゆれ統一）＋QC強化（草稿混入の回帰防止）

目的：
- 本文の表記ゆれ（P-model の後ろのスペース等）を統一し、読みのブレを減らす。
- publish成果物に「草稿」等が再混入しないよう、軽量QCで回帰検出できる状態を作る。

変更：
- 更新：`doc/paper/10_manuscript.md`
  - P-model の表記ゆれ（P-modelの/が/側 等）を「P-model の/が/側」へ統一。
- 更新：`doc/paper/30_references.md`
  - 見出しの「（ドラフト）」表記を除去（本文中の注意書きで作業用であることは維持）。
- 更新：`scripts/summary/paper_qc.py`
  - publish HTML（論文/一般向け）に「草稿」が混入していないことをチェック項目に追加。

実行：
- `cmd /c output\\summary\\build_materials.bat quick-nodocx`
- `python -B scripts/summary/paper_qc.py`
- `python -B scripts/summary/release_manifest.py`

生成/更新した主な出力：
- `output/summary/pmodel_paper.html`
- `output/summary/pmodel_public_report.html`
- `output/summary/paper_qc.json`
- `output/summary/release_manifest.json`

---

## 2026-01-24（UTC） Phase 8 / Step 8.2：本文整合（GR/SRとP-modelの統一表現）＋QC強化（ドラフト混入の回帰防止）

目的：
- 1.1 節で GR/SR と P-model の位置づけ（有効理論／機構の違い／弱場一致・強場差分）を統一表現へ寄せ、AGENTS規約（混乱防止の言い回し）と整合させる。
- publish成果物に「草稿/ドラフト」が再混入しないよう、paper_qc の回帰検出を強化する。

変更：
- 更新：`doc/paper/10_manuscript.md`
  - 1.1 節の GR/SR vs P-model の表現を統一（「一致は現実が同じだから」「概念は別」「弱場は近似一致、強場は差分予言」）。
- 更新：`scripts/summary/paper_qc.py`
  - publish HTML に「ドラフト」が混入していないことを追加チェック（既存の「草稿」チェックを拡張）。

実行：
- `cmd /c output\\summary\\build_materials.bat quick-nodocx`
- `python -B scripts/summary/paper_qc.py`
- `python -B scripts/summary/release_manifest.py`

生成/更新した主な出力：
- `output/summary/pmodel_paper.html`
- `output/summary/pmodel_public_report.html`
- `output/summary/paper_qc.json`
- `output/summary/release_manifest.json`

---

## 2026-01-24（UTC） Phase 8 / Step 8.2：Reproducibility章の外部可視化（publish紙面だけで再現手順が追える状態へ）

目的：
- 再現性を外部評価可能にするため、publish紙面（`output/summary/pmodel_paper.html`）だけで最小の再現手順（入口コマンド）が追えるようにする（従来は INTERNAL_ONLY に寄っていた）。

変更：
- 更新：`doc/paper/10_manuscript.md`
  - 8章（Reproducibility / Availability）に、軽量ビルド・QC・マニフェスト・フル再現の入口コマンドを明記。

実行：
- `cmd /c output\\summary\\build_materials.bat quick-nodocx`
- `python -B scripts/summary/paper_qc.py`
- `python -B scripts/summary/release_manifest.py`

生成/更新した主な出力：
- `output/summary/pmodel_paper.html`
- `output/summary/pmodel_public_report.html`
- `output/summary/paper_qc.json`
- `output/summary/release_manifest.json`

---

## 2026-01-24（UTC） Phase 8 / Step 8.3：release_manifest の再現コマンド拡充（bundle/fast）＋配布バンドル更新

目的：
- `release_manifest.json` が単体で「再現と配布の入口」を示せるようにし、公開物の取り回しを改善する。
- manifest の更新に合わせて、配布バンドル（paper/repro）に同梱される manifest も更新する。

変更：
- 更新：`scripts/summary/release_manifest.py`
  - `repro_commands` に `build_quick` / `release_manifest_fast` / `release_bundle_{paper,repro}` を追加。

実行：
- `cmd /c output\\summary\\build_materials.bat quick-nodocx`
- `python -B scripts/summary/paper_qc.py`
- `python -B scripts/summary/release_manifest.py --no-hash`
- `python -B scripts/summary/release_bundle.py --mode paper --no-hash`
- `python -B scripts/summary/release_bundle.py --mode repro --no-hash`

生成/更新した主な出力：
- `output/summary/pmodel_paper.html`
- `output/summary/pmodel_public_report.html`
- `output/summary/paper_qc.json`
- `output/summary/release_manifest.json`
- `output/summary/pmodel_release_bundle_paper.zip`
- `output/summary/pmodel_release_bundle_repro.zip`

---

## 2026-01-24（UTC） Phase 8：現在地を Step 8.3 へ移動（Step 8.2 を完了（初版）として固定）

目的：
- 本文（Step 8.2）について publish QC が通り、作業用TODOも残っていないため、**完了（初版）** として固定する。
- 次の焦点を Step 8.3（公開範囲・再現入口）へ移し、公開物の運用を詰める。

変更：
- 更新：`doc/ROADMAP.md`
  - Step 8.2 を「完了（初版）」へ更新し、現在地（宣言）を Step 8.3 に移動。
- 更新：`doc/STATUS.md`
  - 現在地を Step 8.3 に移動し、Step 8.2 の固定を明記。
- 更新：`doc/AI_CONTEXT_MIN.json`
  - 現在地/次の作業の辞書を更新（Step 8.3）。

実行：
- `python -B scripts/summary/release_manifest.py --no-hash`
- `python -B scripts/summary/release_bundle.py --mode paper --no-hash`
- `python -B scripts/summary/release_bundle.py --mode repro --no-hash`

---

## 2026-01-24（UTC） Phase 8 / Step 8.3：公開再現性の補強（env_fingerprint）＋reproバンドルへ WSL補助を同梱

目的：
- 公開物が「どの環境で作られたか」を機械可読で残す（再現性の補助）。
- repro バンドルに WSL 側の補助スクリプト（RascalC導入）も含め、第三者が詰まりにくい入口を整える。

変更：
- 追加：`scripts/summary/env_fingerprint.py`
  - `output/summary/env_fingerprint.json` を生成（Python/OS/pip freeze）。
- 更新：`scripts/summary/release_manifest.py`
  - env_fingerprint を entrypoints/publish_outputs に追加し、manifest生成時に自動生成するようにした。
- 更新：`scripts/summary/release_bundle.py`
  - repro バンドルの scripts tree に `*.sh`（WSL補助）を含めるようにした。
- 更新：`doc/PUBLISHING.md`
  - env_fingerprint（自動生成）を公開物の補助情報として追記。

実行：
- `python -B scripts/summary/release_manifest.py --no-hash`
- `python -B scripts/summary/release_bundle.py --mode paper --no-hash`
- `python -B scripts/summary/release_bundle.py --mode repro --no-hash`

生成/更新した主な出力：
- `output/summary/env_fingerprint.json`
- `output/summary/release_manifest.json`
- `output/summary/pmodel_release_bundle_paper.zip`
- `output/summary/pmodel_release_bundle_repro.zip`

---

## 2026-01-24（UTC） Phase 8：Step 8.3 を完了（初版）として固定し、現在地を Step 8.1 へ移動

目的：
- Step 8.3（データ・コード公開）の入口（PUBLISHING/manifest/bundle/env_fingerprint）が揃ったため、**完了（初版）** として固定する。
- 次の作業（短報切り出し）に備えて、現在地を Step 8.1 へ移す。

変更：
- 更新：`doc/ROADMAP.md`
  - 現在地（宣言）を Step 8.1 に移し、Step 8.3 を「完了（初版）」へ更新。
- 更新：`doc/STATUS.md`
  - 現在地を Step 8.1 に移し、Step 8.3 の固定を明記。
- 更新：`doc/AI_CONTEXT_MIN.json`
  - 現在地/次の作業の辞書を更新（Step 8.1）。
- 更新：`doc/WORK_HISTORY_RECENT.md`
  - `python -B scripts/summary/update_work_history_recent.py` で直近3ログを更新。

---

## 2026-01-24（UTC） Phase 8 / Step 8.1：短報（short note）ビルド入口の追加（8.1.1）

目的：
- Step 8.1 の短報切り出しに備え、短報草稿とHTML生成を「固定名の成果物」として再現可能な入口にする。

変更：
- 追加：`doc/paper/15_short_note.md`
- 更新：`scripts/summary/paper_html.py`
  - `--profile short_note` を追加し、`output/summary/pmodel_short_note.html` を生成可能にした。
- 更新：`scripts/summary/paper_build.py`
  - `--profile short_note` を追加し、短報のビルド入口を提供。
- 更新：`output/summary/build_materials.bat`
  - quick/quick-nodocx が短報HTMLも同時更新するようにした。
- 更新：`scripts/summary/run_all.py`
  - short_note_lint / short_note_html / docx_short_note を追加。
- 更新：`scripts/summary/release_manifest.py`
  - docs/publish_outputs に短報（md/html）を追加。
- 更新：`doc/PUBLISHING.md` / `doc/paper/README.md` / `doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`

実行：
- `cmd /c output\\summary\\build_materials.bat quick-nodocx`
- `python -B scripts/summary/paper_qc.py`
- `python -B scripts/summary/release_bundle.py --mode paper --no-hash`
- `python -B scripts/summary/release_bundle.py --mode repro --no-hash`
- `python -B scripts/summary/release_manifest.py --no-hash`

生成/更新した主な出力：
- `output/summary/pmodel_short_note.html`
- `output/summary/paper_qc.json`
- `output/summary/release_manifest.json`
- `output/summary/pmodel_release_bundle_paper.zip`
- `output/summary/pmodel_release_bundle_repro.zip`

---

## 2026-01-24（UTC） Phase 8 / Step 8.1：短報QCを paper_qc へ統合（8.1.3）

目的：
- 短報（`pmodel_short_note.html`）も公開前に機械的QCが通るようにし、作業区切りの確認コストを下げる。

変更：
- 更新：`scripts/summary/paper_qc.py`
  - short note（`doc/paper/15_short_note.md` / `output/summary/pmodel_short_note.html`）をQC対象に追加。
  - `\\` 検出は `<code>/<pre>` 内を除外し、Windowsパス例で false positive が出ないようにした。
- 更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/PUBLISHING.md` / `doc/AI_CONTEXT_MIN.json`

実行：
- `python -B scripts/summary/paper_qc.py`
- `python -B scripts/summary/release_manifest.py --no-hash`

生成/更新した主な出力：
- `output/summary/paper_qc.json`
- `output/summary/release_manifest.json`

---

## 2026-01-24（UTC） Phase 8 / Step 8.1：短報本文を最小構成へ圧縮（8.1.2 初版）

目的：
- 短報を「最小仮定＋必須検証」へ寄せ、読者が最小の前提と検証条件だけを追える形にする。

変更：
- 更新：`doc/paper/15_short_note.md`
  - 背景（最小）／最小仮定と定義／必須検証（最小セット）／再現の入口、の4ブロックへ整理。
  - 宇宙論（距離指標）の扱いは前提分解が必要なため、短報では注意書き＋本論文参照に留める（Phase 4 の結論確定後に最終化）。
- 更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`

実行：
- `cmd /c output\\summary\\build_materials.bat quick-nodocx`
- `python -B scripts/summary/paper_qc.py`
- `python -B scripts/summary/release_manifest.py --no-hash`

生成/更新した主な出力：
- `output/summary/pmodel_short_note.html`
- `output/summary/paper_qc.json`
- `output/summary/release_manifest.json`

---

## 2026-01-24（UTC） Phase 4 / Step 4.6：GN-z11 公開待ちの再確認（MAST）

目的：
- GN-z11（JWST）の一次データ取得が「未公開（release待ち）」で止まっていることを、現時点の MAST で再確認して議論を固定する。

実行：
- `python -B scripts/cosmology/fetch_mast_jwst_spectra.py --targets GN-z11 --download-missing --max-obs 1`

結果：
- `data/cosmology/mast/jwst_spectra/gn_z11/manifest.json` が `is_released=false` を示し、`t_obs_release_utc=2026-04-09...` を再確認（未公開として保留）。
- 集約：`data/cosmology/mast/jwst_spectra/manifest_all.json`

---

## 2026-01-24（UTC） Phase 8：短報を完了（初版）として固定し、現在地を Step 4.6 へ移動

目的：
- Phase 8（論文化・公開）の短報（Step 8.1）が「最小構成＋再現入口＋QC」まで揃ったため、**完了（初版）** として固定する。
- 次の焦点を Phase 4 / Step 4.6（JWST/MAST; GN-z11 公開待ち）へ移す。

変更：
- 更新：`doc/ROADMAP.md`
  - Step 8.1 を「完了（初版）」へ更新し、現在地（宣言）を Step 4.6 へ移動。
- 更新：`doc/STATUS.md`
  - 現在地を Step 4.6 に移動し、短報（初版）固定を明記。
- 更新：`doc/AI_CONTEXT_MIN.json`
  - 現在地/次の作業の辞書を更新（Step 4.6）。

実行：
- `python -B scripts/summary/release_manifest.py --no-hash`
- `python -B scripts/summary/release_bundle.py --mode paper --no-hash`
- `python -B scripts/summary/release_bundle.py --mode repro --no-hash`

---

## 2026-01-24（UTC） 運用：`doc/AI_CONTEXT_MIN.json` の復旧（欠落対策）

目的：
- ContextWindow 圧縮後の復帰用に必須の `doc/AI_CONTEXT_MIN.json` が欠落していたため、最小状態辞書を復旧して再固定する。

変更：
- 追加：`doc/AI_CONTEXT_MIN.json`
  - 現在地（Phase 4 / Step 4.6）と、次の作業（GN-z11 公開後の取得→z_confirmed、結果の短報/本論文反映）を最小辞書で記録。

---

## 2026-01-24（UTC） 運用：`build_materials.bat`（引数なし=Full）の不具合修正

目的：
- `output/summary/build_materials.bat` を引数なしで実行すると `full` ラベルが見つからず失敗するため、手動実行の入口（引数なし=Full）を復旧する。

変更：
- 更新：`output/summary/build_materials.bat`
  - Full（`run_all.py --offline --jobs 2`）を「ラベルジャンプ」ではなく直列実行に変更し、`指定されたバッチ ラベルが見つかりません - full` の失敗を解消。

実行（確認）：
- `cmd /c output\\summary\\build_materials.bat quick-nodocx`

---

## 2026-01-24（UTC） Phase 8 / Step 8.5：査読準備（批判点と応答整理、DDR説明補強）

目的：
- Phase 8 を外部評価（査読）に耐える形へ寄せるため、想定批判点を先回りで整理し、本文の「主張の範囲」「反証条件」「DDR再接続条件（Step 4.7）」の説明を補強する。

変更：
- 更新：`doc/paper/90_peer_review_notes.md`
  - 想定批判点 C1–C14 と、それぞれの応答（本文/メモ/対応先）R1–R14 を作成。
- 更新：`doc/paper/10_manuscript.md`
  - 1.3 節を新設し、有効モデルとしての立場、fit/predict 分離（β/δ凍結）、反証条件、再現入口を明文化。
  - 2.5.3 節（宇宙論II）で、DDR再接続条件の定義（α, s_L, s_R, p_t, p_e）、判定基準（|z|<3/5）、d_L/d_A 寄与分解（z=1 anchor）を追記。
  - 4.11 節（GW150914）に、matched filtering を置換しない “整合性チェック” である旨の注意書きを追記。
- 更新：`doc/ROADMAP.md`
  - Step 8.5 を追加し、Phase 8（Step 8.1–8.5）を完了（初版）として固定。

実行：
- `cmd /c output\\summary\\build_materials.bat quick-nodocx`
- `python -B scripts/summary/paper_qc.py`
- `python -B scripts/summary/paper_figures_audit.py`

生成/更新した主な出力：
- `output/summary/pmodel_paper.html`
- `output/summary/paper_qc.json`
- `output/summary/paper_figures_audit.json` / `output/summary/paper_figures_audit.csv`

---

## 2026-01-24（UTC） Phase 7（量子）/ Step 7.1–7.2：粒子＝束縛波（反射）と、局所モデルによる相関生成（toy）を固定

目的：
- Phase 7（量子）へ進むため、(i) 粒子＝束縛波（反射/境界条件）という言葉の最小モデル化（Step 7.1）と、(ii) time-tag＋同時計数選別が相関評価へ入る位置の明文化（Step 7.2）を行い、Step 7.4（一次データ再解析）の検証項目を固定する。

変更：
- 追加：`doc/quantum/01_particle_as_reflection.md`
  - 「反射」＝境界条件／離散モード／束縛状態、という意味での最小定義と、次段（7.2–7.4）への接続点を整理。
- 追加：`scripts/quantum/particle_reflection_demo.py`
  - 反射→固有モード離散化＋波束反射の toy を再現可能出力として固定。
- 追加：`doc/quantum/02_local_p_correlation.md`
  - 局所モデル（出力＋time-tag＋同時計数選別）を明文化し、ベル不等式の適用前提（同一母集団平均）が破れ得る位置を整理。
- 追加：`scripts/quantum/bell_time_tag_selection_sweep.py`
  - toy simulation として S(Δt) と受理率の依存を固定（Step 7.4 で一次データ検証する項目を具体化）。
- 更新：`doc/ROADMAP.md`
  - Step 7.1/7.2 を「完了（初版）」へ更新し、成果物と再現コマンドを追記。

実行：
- `python -B scripts/quantum/particle_reflection_demo.py`
- `python -B scripts/quantum/bell_time_tag_selection_sweep.py`

生成した主な出力：
- `output/quantum/particle_reflection_demo.png` / `output/quantum/particle_reflection_demo_metrics.json`
- `output/quantum/bell_time_tag_selection_sweep.png` / `output/quantum/bell_time_tag_selection_sweep_metrics.json`

---

## 2026-01-24（UTC） Phase 7（量子）/ Step 7.3：量子もつれの再解釈（非局所仮定を用いない）を固定（初版）

目的：
- “ベル違反＝非局所性” という解釈を自明視せず、観測手続き（time-tag選別）と局所時間構造（装置遅延）の前提検証を経て採否を決める、という立場を明文化する。
- Step 7.4（一次データ）で反証できる形（S(Δt)/trial-based/time-tagアルゴリズム依存）へ落とす。

変更：
- 追加：`doc/quantum/03_entanglement_local_p.md`
  - 立場（未主張/主張）と、非局所仮定を置かない再解釈、反証条件を整理。
- 更新：`scripts/quantum/bell_time_tag_selection_sweep.py`
  - coincidence-based の S(Δt) に加え、trial-based（無選別）の基準 S を併記し、Δt依存と区別できる形に更新。

実行：
- `python -B scripts/quantum/bell_time_tag_selection_sweep.py`

生成/更新した主な出力：
- `output/quantum/bell_time_tag_selection_sweep.png` / `output/quantum/bell_time_tag_selection_sweep_metrics.json`

---

## 2026-01-24（UTC） Phase 7（量子）/ Step 7.4：ベル不等式の棄却（一次データの time-tag 再解析入口を固定：初版）

目的：
- Step 7.2/7.3 の toy（time-tag + post-selection）を、一次データ（実験ログ）で検証可能な形に接続する。
- coincidence window / pairing の選択が「採用される事象集合」を変え得る入口を、time-tag 一次データで可視化・定量化する。

変更：
- 一次データを固定（NIST belltestdata；Shalm et al. 2015 公開リポジトリの subset）：
  - 保存：`data/quantum/sources/nist_belltestdata/`
  - 追加：`data/quantum/sources/nist_belltestdata/manifest.json`（url/path/sha256）
- 追加：`scripts/quantum/fetch_nist_belltestdata.py`
  - NIST belltestdata の取得・キャッシュ入口（offline check / manifest 生成）。
- 追加：`scripts/quantum/nist_belltest_time_tag_reanalysis.py`
  - GPS PPS（channel 5）で Alice/Bob を整列し、click delay（sync基準）と coincidence window 掃引（greedy pairing）を固定出力。
- 追加：`doc/quantum/04_bell_time_tag_primary_reanalysis.md`
  - 本Stepの狙い（独立確率仮定の入口）と、再現コマンド・成果物を整理。
- 更新：`doc/PRIMARY_SOURCES.md`
  - 量子（ベル）に NIST belltestdata を一次ソースとして登録（sha256/保存先/取得入口）。
- 更新：`doc/ROADMAP.md`
  - Step 7.4 を「完了（初版）」へ更新し、成果物と再現コマンドを追記。

実行：
- `python -B scripts/quantum/fetch_nist_belltestdata.py`
- `python -B scripts/quantum/nist_belltest_time_tag_reanalysis.py`

生成した主な出力：
- `output/quantum/nist_belltest_time_tag_bias.png`
- `output/quantum/nist_belltest_time_tag_bias_metrics.json`
- `output/quantum/nist_belltest_coincidence_sweep.csv`

---

## 2026-01-24（UTC） Phase 7（量子）/ Step 7.4：公開データ拡張（Delft）＋CHSH前提の数式化＋棄却条件整理

目的：
- 「time-tag / trial 定義 / post-selection が統計母集団を変えるか」を複数の公開データで検証できるようにする。
- CHSH 不等式の適用前提（同一母集団）を selection の言葉で明文化し、P-model の量子解釈の主張範囲と棄却条件を整理する。

変更：
- 追加：`doc/quantum/05_bell_public_datasets.md`
  - 公開ベルテストデータ（NIST/Delft/候補）の所在と検証可能性を一覧化。
- 追加：`scripts/quantum/fetch_delft_hensen2015.py`
  - Delft/Hensen 2015 の公開 zip を取得・キャッシュし、`manifest.json`（sha256）を生成。
- 追加：`scripts/quantum/delft_hensen2015_chsh_reanalysis.py`
  - Delft/Hensen 2015 の CHSH S を再現し、event-ready window start の感度 sweep（Fig. S3 相当）を固定出力。
- 追加：`doc/quantum/06_chsh_assumptions_and_selection.md`
  - CHSH の前提と selection（w_ab(λ)）の条件を数式で明文化。
- 追加：`doc/quantum/07_pmodel_bell_chsh_notes.md`
  - P-model の量子側の主張範囲（局所P構造／隠れた相関／棄却条件）を整理。
- 更新：`doc/PRIMARY_SOURCES.md`
  - Delft/Hensen 2015 を一次ソースとして登録。
- 更新：`doc/ROADMAP.md`
  - Step 7.4 に Delft 統合と数式化・棄却条件整理を追記。

実行：
- `python -B scripts/quantum/fetch_delft_hensen2015.py`
- `python -B scripts/quantum/delft_hensen2015_chsh_reanalysis.py`

生成した主な出力：
- `data/quantum/sources/delft_hensen2015/manifest.json`
- `output/quantum/delft_hensen2015_chsh.png`
- `output/quantum/delft_hensen2015_chsh_metrics.json`
- `output/quantum/delft_hensen2015_chsh_sweep_start_offset.csv`

---

## 2026-01-24（UTC） Phase 7：論文化資料へ量子（ベル）の現状を追記（Phase 7の進捗を資料へ反映）

目的：
- Phase 7（量子）の進捗（公開一次データ再解析、CHSH前提の数式化、棄却条件）を、論文化資料（paper/short note）にも明示し、読者が現状を追跡できる形にする。

変更：
- 更新：`doc/paper/10_manuscript.md`
  - 1.1 背景／1.3 主張の範囲／6.2 制限事項と今後／7 結論／8 再現入口に、Phase 7（量子：ベル）の現状（入口と位置づけ）を追記。
- 更新：`doc/paper/15_short_note.md`
  - 背景に、Phase 7（量子：ベル）の現状（入口と位置づけ）を追記。
- 更新：`doc/paper/01_figures_index.md`
  - 量子（ベル）図（NIST/Delft）の固定パスを追加し、paper_lint の参照安定性を確保。

実行：
- `cmd /c output\\summary\\build_materials.bat quick-nodocx`
- `python -B scripts/summary/paper_qc.py`

---

## 2026-01-24（UTC） Phase 7（量子）/ Step 7.5：重力×量子干渉（量子時計：chronometric leveling）

目的：
- Step 7.5（重力×量子干渉）のうち、量子時計（重力赤方偏移）の入口を一次ソースで固定し、再現可能な最小出力へ落とす。

変更：
- 更新：`doc/PRIMARY_SOURCES.md`
  - 光格子時計（87Sr）の chronometric leveling（arXiv:2309.14953v3）を一次ソースとして追加し、PDFを `data/quantum/sources/` にキャッシュ（sha256固定）。
- 追加：`scripts/quantum/optical_clock_chronometric_leveling.py`
  - 要旨に明示された ΔU（clock vs geodesy）から、ΔU差・z-score・epsilon（ppm）を計算し固定出力。
- 更新：`doc/quantum/08_gravity_quantum_interference.md`
  - Step 7.5 の抜粋に量子時計（chronometric leveling）を追記（再現コマンド＋成果物）。
- 更新：`doc/ROADMAP.md`
  - Step 7.5.3 を【完了（初版）】へ更新し、再現入口と成果物を紐付け。
- 更新：`doc/paper/10_manuscript.md` / `doc/paper/15_short_note.md` / `doc/paper/01_figures_index.md`
  - Phase 7（量子）の「重力×量子干渉」側も最小再現まで到達したことを追記し、図表インデックスに固定パスを追加。

実行：
- `python -B scripts/quantum/optical_clock_chronometric_leveling.py`
- `cmd /c output\\summary\\build_materials.bat quick-nodocx`
- `python -B scripts/summary/paper_qc.py`

生成した主な出力：
- `output/quantum/optical_clock_chronometric_leveling.png`
- `output/quantum/optical_clock_chronometric_leveling_metrics.json`

---

## 2026-01-24（UTC） Phase 7（量子）/ Step 7.5：物質波干渉（電子二重スリット）＋de Broglie 精密（原子反跳→α）

目的：
- Step 7.5.4（物質波干渉／二重スリット）と Step 7.5.5（de Broglie 波長の精密検証）の入口を一次ソースで固定し、再現可能な最小出力へ落とす。

変更：
- 更新：`doc/PRIMARY_SOURCES.md`
  - 電子二重スリット（Bach et al. 2012; arXiv:1210.6243v1）と、de Broglie 精密（Bouchendira 2008; arXiv:0812.3139v1、独立参照：Gabrielse 2008; arXiv:0801.1134v2）を一次ソースとして追加し、PDFを `data/quantum/sources/` にキャッシュ（sha256固定）。
- 追加：`scripts/quantum/electron_double_slit_interference.py`
  - arXiv:1210.6243v1 に明記された装置パラメータ（600 eV、50 nm、280 nm）から、遠方場の最小モデルで P12 と P1+P2 の差（干渉項）を固定出力。
- 追加：`scripts/quantum/de_broglie_precision_alpha_consistency.py`
  - α（原子反跳）と α（電子 g-2）の整合を z-score と有効εで固定出力（de Broglie を含む精密な一貫性チェックの入口）。
- 更新：`doc/quantum/08_gravity_quantum_interference.md`
  - Step 7.5 の抜粋に「電子二重スリット」と「de Broglie 精密（α整合）」を追記（再現コマンド＋成果物）。
- 更新：`doc/ROADMAP.md`
  - Step 7.5.4 / 7.5.5 を【完了（初版）】へ更新し、Step 7.5 を【完了（初版）】として固定。
- 更新：`doc/paper/10_manuscript.md` / `doc/paper/15_short_note.md` / `doc/paper/01_figures_index.md`
  - Phase 7（量子）で固定した最小再現の対象を更新し、図表インデックスへ固定パスを追加。

実行：
- `python -B scripts/quantum/electron_double_slit_interference.py`
- `python -B scripts/quantum/de_broglie_precision_alpha_consistency.py`
- `cmd /c output\\summary\\build_materials.bat quick-nodocx`
- `python -B scripts/summary/paper_qc.py`

生成した主な出力：
- `output/quantum/electron_double_slit_interference.png`
- `output/quantum/electron_double_slit_interference_metrics.json`
- `output/quantum/de_broglie_precision_alpha_consistency.png`
- `output/quantum/de_broglie_precision_alpha_consistency_metrics.json`

---

## 2026-01-24（UTC） Phase 7（量子）/ Step 7.7：光の量子干渉（単一光子・HOM・スクイーズド光）

目的：
- 量子光学の代表的な干渉（単一光子干渉、HOM、スクイーズド光）について、観測量（visibility/dip/雑音分散）と time-tag/遅延の位置づけを一次ソースで固定し、再現可能な入口を作る。

変更：
- 更新：`doc/PRIMARY_SOURCES.md`
  - 単一光子干渉（Kimura et al. 2004; arXiv:quant-ph/0403104v2）、HOM（arXiv:2106.03871v2）＋Zenodo（10.5281/zenodo.6371310）、スクイーズド光（Vahlbruch et al. 2007; arXiv:0706.1431v1）を追加し、PDF/ZIP を `data/quantum/sources/` にキャッシュ（sha256固定）。
- 追加：`scripts/quantum/fetch_photon_interference_sources.py`
  - 上記一次ソース（arXiv PDF + Zenodo raw）をダウンロードし、`data/quantum/sources/zenodo_6371310/manifest.json` に sha256 を記録する。
- 追加：`scripts/quantum/photon_quantum_interference.py`
  - 単一光子visibility→等価光路差雑音、HOM visibility（報告値）と低周波ノイズPSD（Zenodo一次）、スクイーズド光10 dB→損失下限（η≥0.9）を固定出力。
- 追加：`doc/quantum/10_photon_quantum_interference.md`
  - 観測量定義と、time-tag/遅延が解析手順に入る位置づけを整理（Step 7.4 と共通する「窓選別」リスクも明記）。
- 更新：`doc/ROADMAP.md`
  - Step 7.7 を【完了（初版）】へ更新し、実装/出力/文章化を追記。
- 更新：`doc/paper/10_manuscript.md` / `doc/paper/15_short_note.md` / `doc/paper/01_figures_index.md`
  - Phase 7（量子）の固定出力として `output/quantum/photon_quantum_interference.png` を参照し、図表インデックスへ追加。
- 修正：`output/summary/build_materials.bat`
  - 引数なし（full）/ `full` 指定で失敗するケースがあったため、mode の解釈を明確化して `full|quick|quick-nodocx` を受け付けるように修正（引数なし＝full）。

実行：
- `python -B scripts/quantum/fetch_photon_interference_sources.py`
- `python -B scripts/quantum/photon_quantum_interference.py`
- `cmd /c output\\summary\\build_materials.bat quick-nodocx`
- `python -B scripts/summary/paper_qc.py`

生成した主な出力：
- `output/quantum/photon_quantum_interference.png`
- `output/quantum/photon_quantum_interference_metrics.json`

---

## 2026-01-24（UTC） Phase 7（量子）/ Step 7.8：真空・QED精密（Casimir 効果 / Lamb shift）

目的：
- 真空の境界条件（Casimir）と束縛状態の精密分光（Lamb shift）を、一次ソースと観測量の入口として固定し、P-model 量子解釈の最低要件（満たせない場合は棄却）を明文化する。

変更：
- 更新：`doc/PRIMARY_SOURCES.md`
  - Casimir（Roy+2000; arXiv:quant-ph/9906062v3）と Lamb shift（Ivanov&Karshenboim 2000; arXiv:physics/0009069v1）を追加し、PDF を `data/quantum/sources/` にキャッシュ（sha256固定）。
- 追加：`scripts/quantum/fetch_qed_vacuum_precision_sources.py`
  - 上記一次ソース（arXiv PDF）をダウンロードし、`data/quantum/sources/qed_vacuum_precision_manifest.json` に sha256 を記録する。
- 追加：`scripts/quantum/qed_vacuum_precision.py`
  - Casimir（理想導体のスケーリング：P∝a^{-4}、sphere–plate（PFA）F∝a^{-3}）と、Lamb shift のスケーリング（Z^4 vs Z^6）および核サイズ寄与（例）を固定出力。
- 追加：`doc/quantum/11_qed_vacuum_precision.md`
  - 観測量定義と、P-model 側の最低要件（再現できない場合の棄却条件）を整理。
- 更新：`doc/ROADMAP.md`
  - Step 7.8 を【完了（初版）】へ更新し、実装/出力/文章化を追記。
- 更新：`doc/paper/10_manuscript.md` / `doc/paper/15_short_note.md` / `doc/paper/01_figures_index.md`
  - Phase 7（量子）の固定出力として `output/quantum/qed_vacuum_precision.png` を参照し、図表インデックスへ追加。

実行：
- `python -B scripts/quantum/fetch_qed_vacuum_precision_sources.py`
- `python -B scripts/quantum/qed_vacuum_precision.py`
- `cmd /c output\\summary\\build_materials.bat quick-nodocx`
- `python -B scripts/summary/paper_qc.py`

生成した主な出力：
- `output/quantum/qed_vacuum_precision.png`
- `output/quantum/qed_vacuum_precision_metrics.json`

---

## 2026-01-24（UTC） Phase 7（量子）/ Step 7.4（拡張準備）：NIST 別run取得・run別出力の入口整備

目的：
- NIST belltestdata の training run 依存（mode-lockの悪さが明記されている）を解消するため、より良い run でも同じ指標（delay分布/KS/window sweep）が再計算できるように、取得と解析の入口を拡張する。

変更：
- 更新：`scripts/quantum/fetch_nist_belltestdata.py`
  - `--list`（S3 prefix から run base 一覧）と `--run <base>`（任意run取得）を追加。
  - 大容量runの誤DL防止として `--max-gib` safety limit を追加（multipart run は検出して停止）。
- 更新：`scripts/quantum/nist_belltest_time_tag_reanalysis.py`
  - `--out-tag` を追加し、run別に `output/quantum/*__<tag>.*` として並列保存できるようにした（既定は従来どおり固定名）。
  - time-tag の読み取りを numpy ベースへ置換し、Windowsでも大容量runに拡張しやすい性能へ改善した。
- 更新：`doc/quantum/04_bell_time_tag_primary_reanalysis.md`
  - training 以外のrunへ拡張する手順（`--list`→`--run`→`--out-tag`）を追記。
- 更新：`doc/ROADMAP.md`
  - Step 7.4（拡張）として、training run 以外／trial-based／NIST以外追加をサブStep化。

実行（スモーク/QC）：
- `python -B scripts/quantum/fetch_nist_belltestdata.py --offline`
- `python -B scripts/quantum/fetch_nist_belltestdata.py --list --date 2015_09_18 --filter afterfixingModeLocking`
- `python -B scripts/quantum/nist_belltest_time_tag_reanalysis.py --max-seconds 60 --out-tag smoke60s`（出力は確認後に削除）
- `cmd /c output\\summary\\build_materials.bat quick-nodocx`

---

## 2026-01-24（UTC） Phase 7（量子）/ Step 7.4.1：NIST（afterfixingModeLocking）で指標を再計算（training 依存の解消）

目的：
- training run（mode-lock が悪いと明記）だけで結論が左右されないことを確認するため、より良い run（afterfixingModeLocking）でも同じ指標（delay分布/KS/window sweep）が出るかを検証する。

変更：
- 更新：`doc/PRIMARY_SOURCES.md`
  - NIST belltestdata の afterfixingModeLocking（03_43 run）を一次データとして追加（sha256固定）。
- 更新：`doc/quantum/04_bell_time_tag_primary_reanalysis.md`
  - 追加runの固定成果物（03_43；max_seconds=3600）を追記。
- 更新：`doc/ROADMAP.md`
  - Step 7.4.1 を【完了（初版）】へ更新し、該当成果物を明記。

実行：
- `python -B scripts/quantum/fetch_nist_belltestdata.py --run 03_43_CH_pockel_100kHz.run4.afterTimingfix2_afterfixingModeLocking --max-gib 2.0`
- `python -B scripts/quantum/nist_belltest_time_tag_reanalysis.py --alice-zip data/quantum/sources/nist_belltestdata/compressed/alice/2015_09_18/03_43_CH_pockel_100kHz.run4.afterTimingfix2_afterfixingModeLocking.alice.dat.compressed.zip --bob-zip data/quantum/sources/nist_belltestdata/compressed/bob/2015_09_18/03_43_CH_pockel_100kHz.run4.afterTimingfix2_afterfixingModeLocking.bob.dat.compressed.zip --max-seconds 3600 --out-tag 03_43_afterfixingModeLocking_s3600`

生成した主な出力：
- `output/quantum/nist_belltest_time_tag_bias__03_43_afterfixingModeLocking_s3600.png`
- `output/quantum/nist_belltest_time_tag_bias_metrics__03_43_afterfixingModeLocking_s3600.json`
- `output/quantum/nist_belltest_coincidence_sweep__03_43_afterfixingModeLocking_s3600.csv`

---

## 2026-01-24（UTC） Phase 7（量子）/ Step 7.4.2：NIST trial-based（build）で再解析し、algorithm dependence を定量化

目的：
- NIST の “公式解析（Eberhard/CH）” に近い trial-based 定義（sync×slot）に寄せ、coincidence-based（greedy window）との差を数値化する。

変更：
- 更新：`scripts/quantum/fetch_nist_belltestdata.py`
  - processed_compressed/hdf5（build）の列挙・取得を追加（`--list-hdf5` / `--hdf5`）。
- 追加：`scripts/quantum/nist_belltest_trial_based_reanalysis.py`
  - build(hdf5) の click 定義（radius/bitoffset/pk）に従って trial-based の coincidence/singles を集計し、CH J_prob と window dependence を固定出力。
- 更新：`doc/ROADMAP.md`
  - Step 7.4.2 を【完了（初版）】へ更新。
- 更新：`doc/quantum/04_bell_time_tag_primary_reanalysis.md`
  - trial-based（build）再解析の入口と成果物を追記。
- 更新：`doc/PRIMARY_SOURCES.md`
  - 03_43 build(hdf5) を一次ソースとして追記（sha256固定）。

実行：
- `python -B scripts/quantum/fetch_nist_belltestdata.py --run 03_43_CH_pockel_100kHz.run4.afterTimingfix2_afterfixingModeLocking --hdf5 --max-gib 2.0`
- `python -B scripts/quantum/nist_belltest_trial_based_reanalysis.py --out-tag 03_43_afterfixingModeLocking_s3600`

生成した主な出力：
- `output/quantum/nist_belltest_trial_based__03_43_afterfixingModeLocking_s3600.png`
- `output/quantum/nist_belltest_trial_based_metrics__03_43_afterfixingModeLocking_s3600.json`
- `output/quantum/nist_belltest_trial_based_counts__03_43_afterfixingModeLocking_s3600.csv`

---

## 2026-01-24（UTC） Phase 7（量子）/ Step 7.4.3：Weihs 1998（photon time-tag）を一次ソース固定し window 感度を再解析へ統合

目的：
- NIST 以外の photon time-tag 一次データ（Weihs et al. 1998）を固定し、coincidence window の選択が CHSH |S| に与える感度（selection の入口）を再現可能にする。

変更：
- 追加：`scripts/quantum/fetch_weihs1998_zenodo_7185335.py`
  - Zenodo 7185335（Alice.zip/Bob.zip）を取得し、sha256 を含む `manifest.json` を生成。
- 追加：`scripts/quantum/weihs1998_time_tag_reanalysis.py`
  - time-tag（*_V.dat, *_C.dat）を読み、offset 推定＋greedy pairing による window sweep を実装。
  - CHSH は「参照 window（既定 1.0 ns）で固定した sign/swap variant」を全 window に適用し、過度な per-window 最適化を避けた。
- 更新：`doc/PRIMARY_SOURCES.md`
  - Weihs 1998（Zenodo 7185335）を一次ソースとして追記（sha256固定）。
- 更新：`doc/ROADMAP.md` / `doc/quantum/04_bell_time_tag_primary_reanalysis.md` / `doc/quantum/05_bell_public_datasets.md`
  - Step 7.4.3 を【完了（初版）】へ更新し、取得・再解析の入口と成果物を明記。
- 更新：`doc/paper/10_manuscript.md` / `doc/paper/01_figures_index.md`
  - Phase 7（量子）へ Weihs 1998 の time-tag 再解析成果を追記し、図表インデックスへ追加。

実行：
- `python -B scripts/quantum/fetch_weihs1998_zenodo_7185335.py`
- `python -B scripts/quantum/weihs1998_time_tag_reanalysis.py --subdir longdist --run longdist1 --encoding bit0-setting --out-tag weihs1998_longdist_longdist1`
- `cmd /c output\\summary\\build_materials.bat quick-nodocx`

生成した主な出力：
- `output/quantum/weihs1998_chsh_sweep__weihs1998_longdist_longdist1.png`
- `output/quantum/weihs1998_chsh_sweep_metrics__weihs1998_longdist_longdist1.json`
- `output/quantum/weihs1998_chsh_sweep__weihs1998_longdist_longdist1.csv`
- `data/quantum/sources/zenodo_7185335/manifest.json`

---

## 2026-01-24（UTC） Phase 7（量子）/ Step 7.4.4：NIST追加run（21_15）で trial-based(build)＋coincidence-based を再計算

目的：
- NIST belltestdata の装置条件差（runのsuffix差）に対して、同じ指標（delay分布/KS/window sweep + trial-based/build）がどの程度変化するかを追加runで確認し、時間帯/装置条件依存を切り分ける。

変更：
- 取得（一次データ）：`21_15_CH_pockel_100kHz.run.200nsadditiondelay_lightconeshift`（raw zip + build(hdf5)）をキャッシュし、sha256 を一次ソースへ追記。
- 実行（coincidence-based）：先頭3600秒で click delay/KS と window sweep を再計算（run別 out-tag で固定）。
- 実行（trial-based）：build(hdf5) を用いて trial-based 集計を再計算し、coincidence-based window sweep との J_prob の差を可視化。
- 修正：`scripts/quantum/nist_belltest_trial_based_reanalysis.py`
  - 一部runの build(hdf5) に `badSyncInfo` が存在しないため、欠損時は「bad sync = 0」として扱うようにした（03_43 の build とは構造差がある）。
- 更新：`doc/PRIMARY_SOURCES.md` / `doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json` / `doc/quantum/04_bell_time_tag_primary_reanalysis.md`

実行：
- `python -B scripts/quantum/fetch_nist_belltestdata.py --run 21_15_CH_pockel_100kHz.run.200nsadditiondelay_lightconeshift --hdf5 --max-gib 2.0`
- `python -B scripts/quantum/nist_belltest_time_tag_reanalysis.py --alice-zip data/quantum/sources/nist_belltestdata/compressed/alice/2015_09_18/21_15_CH_pockel_100kHz.run.200nsadditiondelay_lightconeshift.alice.dat.compressed.zip --bob-zip data/quantum/sources/nist_belltestdata/compressed/bob/2015_09_18/21_15_CH_pockel_100kHz.run.200nsadditiondelay_lightconeshift.bob.dat.compressed.zip --max-seconds 3600 --out-tag 21_15_200nsadditiondelay_lightconeshift_s3600`
- `python -B scripts/quantum/nist_belltest_trial_based_reanalysis.py --hdf5 data/quantum/sources/nist_belltestdata/processed_compressed/hdf5/2015_09_18/21_15_CH_pockel_100kHz.run.200nsadditiondelay_lightconeshift.dat.compressed.build.hdf5 --out-tag 21_15_200nsadditiondelay_lightconeshift_s3600 --coincidence-sweep-csv output/quantum/nist_belltest_coincidence_sweep__21_15_200nsadditiondelay_lightconeshift_s3600.csv`
- `cmd /c output\\summary\\build_materials.bat quick-nodocx`

生成した主な出力：
- `output/quantum/nist_belltest_time_tag_bias__21_15_200nsadditiondelay_lightconeshift_s3600.png`
- `output/quantum/nist_belltest_time_tag_bias_metrics__21_15_200nsadditiondelay_lightconeshift_s3600.json`
- `output/quantum/nist_belltest_coincidence_sweep__21_15_200nsadditiondelay_lightconeshift_s3600.csv`
- `output/quantum/nist_belltest_trial_based__21_15_200nsadditiondelay_lightconeshift_s3600.png`
- `output/quantum/nist_belltest_trial_based_metrics__21_15_200nsadditiondelay_lightconeshift_s3600.json`
- `output/quantum/nist_belltest_trial_based_counts__21_15_200nsadditiondelay_lightconeshift_s3600.csv`

---

## 2026-01-24（UTC） Phase 7（量子）/ Step 7.4.4：NIST追加run（23_55；ClassicalRNGXOR）で trial-based(build)＋coincidence-based を再計算

目的：
- NIST belltestdata の装置条件差（Classical RNG XOR）に対して、同じ指標（delay分布/KS/window sweep + trial-based/build）がどの程度変化するかを追加runで確認し、時間帯/装置条件依存を切り分ける。

変更：
- 取得（一次データ）：`23_55_CH_pockel_100kHz.run.ClassicalRNGXOR`（raw zip + build(hdf5)）をキャッシュし、sha256 を一次ソースへ追記。
- 実行（coincidence-based）：先頭3600秒で click delay/KS と window sweep を再計算（run別 out-tag で固定）。
- 実行（trial-based）：build(hdf5) を用いて trial-based 集計を再計算し、coincidence-based window sweep との J_prob の差を可視化。
- 改善：`scripts/quantum/fetch_nist_belltestdata.py`
  - `manifest.json` が都度上書きされてrun履歴が失われるため、同一date内では runs/files をマージして保持するように更新。
- 更新：`doc/PRIMARY_SOURCES.md` / `doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json` / `doc/quantum/04_bell_time_tag_primary_reanalysis.md`

実行：
- `python -B scripts/quantum/fetch_nist_belltestdata.py --run 23_55_CH_pockel_100kHz.run.ClassicalRNGXOR --hdf5 --max-gib 2.0`
- `python -B scripts/quantum/nist_belltest_time_tag_reanalysis.py --alice-zip data/quantum/sources/nist_belltestdata/compressed/alice/2015_09_18/23_55_CH_pockel_100kHz.run.ClassicalRNGXOR.alice.dat.compressed.zip --bob-zip data/quantum/sources/nist_belltestdata/compressed/bob/2015_09_18/23_55_CH_pockel_100kHz.run.ClassicalRNGXOR.bob.dat.compressed.zip --max-seconds 3600 --out-tag 23_55_ClassicalRNGXOR_s3600`
- `python -B scripts/quantum/nist_belltest_trial_based_reanalysis.py --hdf5 data/quantum/sources/nist_belltestdata/processed_compressed/hdf5/2015_09_18/23_55_CH_pockel_100kHz.run.ClassicalRNGXOR.dat.compressed.build.hdf5 --out-tag 23_55_ClassicalRNGXOR_s3600 --coincidence-sweep-csv output/quantum/nist_belltest_coincidence_sweep__23_55_ClassicalRNGXOR_s3600.csv`
- `cmd /c output\\summary\\build_materials.bat quick-nodocx`

生成した主な出力：
- `output/quantum/nist_belltest_time_tag_bias__23_55_ClassicalRNGXOR_s3600.png`
- `output/quantum/nist_belltest_time_tag_bias_metrics__23_55_ClassicalRNGXOR_s3600.json`
- `output/quantum/nist_belltest_coincidence_sweep__23_55_ClassicalRNGXOR_s3600.csv`
- `output/quantum/nist_belltest_trial_based__23_55_ClassicalRNGXOR_s3600.png`
- `output/quantum/nist_belltest_trial_based_metrics__23_55_ClassicalRNGXOR_s3600.json`
- `output/quantum/nist_belltest_trial_based_counts__23_55_ClassicalRNGXOR_s3600.csv`

---

## 2026-01-24（UTC） Phase 7（量子）/ Step 7.4.4：NIST追加run（22_20；200ns reduced delay + light cone shift）で trial-based(build)＋coincidence-based を再計算

目的：
- NIST belltestdata の装置条件差（200ns reduced delay + light cone shift）に対して、同じ指標（delay分布/KS/window sweep + trial-based/build）がどの程度変化するかを追加runで確認し、時間帯/装置条件依存を切り分ける。

変更：
- 取得（一次データ）：`22_20_CH_pockel_100kHz.run.200nsreduceddelay_lightconeshift`（raw zip + build(hdf5)）をキャッシュし、sha256 を一次ソースへ追記。
- 実行（coincidence-based）：先頭3600秒で click delay/KS と window sweep を再計算（run別 out-tag で固定）。
- 実行（trial-based）：build(hdf5) を用いて trial-based 集計を再計算し、coincidence-based window sweep との J_prob の差を可視化。
- 更新：`doc/PRIMARY_SOURCES.md` / `doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json` / `doc/quantum/04_bell_time_tag_primary_reanalysis.md`

実行：
- `python -B scripts/quantum/fetch_nist_belltestdata.py --run 22_20_CH_pockel_100kHz.run.200nsreduceddelay_lightconeshift --hdf5 --max-gib 2.0`
- `python -B scripts/quantum/nist_belltest_time_tag_reanalysis.py --alice-zip data/quantum/sources/nist_belltestdata/compressed/alice/2015_09_18/22_20_CH_pockel_100kHz.run.200nsreduceddelay_lightconeshift.alice.dat.compressed.zip --bob-zip data/quantum/sources/nist_belltestdata/compressed/bob/2015_09_18/22_20_CH_pockel_100kHz.run.200nsreduceddelay_lightconeshift.bob.dat.compressed.zip --max-seconds 3600 --out-tag 22_20_200nsreduceddelay_lightconeshift_s3600`
- `python -B scripts/quantum/nist_belltest_trial_based_reanalysis.py --hdf5 data/quantum/sources/nist_belltestdata/processed_compressed/hdf5/2015_09_18/22_20_CH_pockel_100kHz.run.200nsreduceddelay_lightconeshift.dat.compressed.build.hdf5 --out-tag 22_20_200nsreduceddelay_lightconeshift_s3600 --coincidence-sweep-csv output/quantum/nist_belltest_coincidence_sweep__22_20_200nsreduceddelay_lightconeshift_s3600.csv`

生成した主な出力：
- `output/quantum/nist_belltest_time_tag_bias__22_20_200nsreduceddelay_lightconeshift_s3600.png`
- `output/quantum/nist_belltest_time_tag_bias_metrics__22_20_200nsreduceddelay_lightconeshift_s3600.json`
- `output/quantum/nist_belltest_coincidence_sweep__22_20_200nsreduceddelay_lightconeshift_s3600.csv`
- `output/quantum/nist_belltest_trial_based__22_20_200nsreduceddelay_lightconeshift_s3600.png`
- `output/quantum/nist_belltest_trial_based_metrics__22_20_200nsreduceddelay_lightconeshift_s3600.json`
- `output/quantum/nist_belltest_trial_based_counts__22_20_200nsreduceddelay_lightconeshift_s3600.csv`

---

## 2026-01-24（UTC） Phase 7（量子）/ Step 7.4.4：NIST追加run（17_04；completeblind；multipart）で trial-based(build)＋coincidence-based を再計算

目的：
- NIST belltestdata の装置条件差（completeblind）に対して、同じ指標（delay分布/KS/window sweep + trial-based/build）がどの程度変化するかを追加runで確認し、時間帯/装置条件依存を切り分ける。
- 併せて、raw zip が multipart（.z01 + .zip）で配布されるrunを、同一パイプラインで再解析できる状態へ拡張する。

変更：
- 改善：`scripts/quantum/fetch_nist_belltestdata.py`
  - multipart（.z01/.z02... + .zip）を検出し、必要な part を同時に取得できるようにした（`--list` のサイズ表示も総量へ修正）。
- 改善：`scripts/quantum/nist_belltest_time_tag_reanalysis.py`
  - multipart zip（.z01 + .zip）を読み、中央ディレクトリ→local header→deflate stream の最小実装で先頭から順次読めるようにした（既存の single-file zip も従来通り対応）。
- 取得（一次データ）：`17_04_CH_pockel_100kHz.run.completeblind`（raw multipart zip + build(hdf5)）をキャッシュし、sha256 を一次ソースへ追記。
- 実行（coincidence-based）：先頭3600秒で click delay/KS と window sweep を再計算（run別 out-tag で固定）。
- 実行（trial-based）：build(hdf5) を用いて trial-based 集計を再計算し、coincidence-based window sweep との J_prob の差を可視化。
- 更新：`doc/PRIMARY_SOURCES.md` / `doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json` / `doc/quantum/04_bell_time_tag_primary_reanalysis.md`

実行：
- `python -B scripts/quantum/fetch_nist_belltestdata.py --run 17_04_CH_pockel_100kHz.run.completeblind --hdf5 --max-gib 3.0`
- `python -B scripts/quantum/nist_belltest_time_tag_reanalysis.py --alice-zip data/quantum/sources/nist_belltestdata/compressed/alice/2015_09_18/17_04_CH_pockel_100kHz.run.completeblind.alice.dat.compressed.zip --bob-zip data/quantum/sources/nist_belltestdata/compressed/bob/2015_09_18/17_04_CH_pockel_100kHz.run.completeblind.bob.dat.compressed.zip --max-seconds 3600 --out-tag 17_04_completeblind_s3600`
- `python -B scripts/quantum/nist_belltest_trial_based_reanalysis.py --hdf5 data/quantum/sources/nist_belltestdata/processed_compressed/hdf5/2015_09_18/17_04_CH_pockel_100kHz.run.completeblind.dat.compressed.build.hdf5 --out-tag 17_04_completeblind_s3600 --coincidence-sweep-csv output/quantum/nist_belltest_coincidence_sweep__17_04_completeblind_s3600.csv`

生成した主な出力：
- `output/quantum/nist_belltest_time_tag_bias__17_04_completeblind_s3600.png`
- `output/quantum/nist_belltest_time_tag_bias_metrics__17_04_completeblind_s3600.json`
- `output/quantum/nist_belltest_coincidence_sweep__17_04_completeblind_s3600.csv`
- `output/quantum/nist_belltest_trial_based__17_04_completeblind_s3600.png`
- `output/quantum/nist_belltest_trial_based_metrics__17_04_completeblind_s3600.json`
- `output/quantum/nist_belltest_trial_based_counts__17_04_completeblind_s3600.csv`

---

## 2026-01-24（UTC） Phase 7（量子）/ Step 7.4：Big Bell Test 2018（Nature）の Source Data（human-choice inputs）を一次ソースとして固定

目的：
- Step 7.4（ベル）の「公開一次データの統合」を進めるにあたり、time-tag（photon click log）以外も含めて、公開一次ソースの固定と取得・要約の入口を増やす（公開性・再現性の観点から）。
- 特に Big Bell Test 2018 は「人間入力（randomness）」が実験の構成要素であるため、入力側の一次プロダクト（Source Data）を固定しておく。

変更：
- 追加：`scripts/quantum/fetch_big_bell_test_2018.py`
  - Nature（s41586-018-0085-3）の Supplementary + Source Data（Fig.2）を `data/quantum/sources/big_bell_test_2018/` へキャッシュし、`manifest.json`（sha256）を出力。
- 追加：`scripts/quantum/big_bell_test_2018_sessions_by_country.py`
  - Source Data（xlsx）の Fig.2a（sessions by country）を要約し、PNG/CSV/JSON を固定出力。
- 更新：`doc/PRIMARY_SOURCES.md` / `doc/quantum/05_bell_public_datasets.md` / `doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`

実行：
- `python -B scripts/quantum/fetch_big_bell_test_2018.py`
- `python -B scripts/quantum/big_bell_test_2018_sessions_by_country.py`

生成した主な出力：
- `output/quantum/big_bell_test_2018_sessions_by_country.png`
- `output/quantum/big_bell_test_2018_sessions_by_country_metrics.json`

---

## 2026-01-24（UTC） Phase 7（量子）/ Step 7.4.5：Weihs 1998（time-tag）の複数runで coincidence window sweep の感度を追加固定

目的：
- Step 7.4（ベル）の「観測手続き（coincidence window / pairing）依存」を、Weihs 1998 の単一runに依存しない形で強化する。
- 既にローカルにキャッシュ済みの一次データ（Zenodo 7185335）を用い、複数runで同一パイプライン（offset推定＋greedy pairing＋window sweep）を実行して頑健性を確認する。

変更：
- 実行：Weihs 1998（longdist）の追加run（longdist0/2/10）で sweep を再計算（既存の longdist1 と合わせて比較可能に固定）。
- 追加：`scripts/quantum/weihs1998_chsh_sweep_summary.py`
  - 既存の run別 CSV を読み込み、複数runの |S| vs window を重ねた「まとめ図」を生成する。
- 更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`

実行：
- `python -B scripts/quantum/weihs1998_time_tag_reanalysis.py --subdir longdist --run longdist0 --encoding bit0-setting --out-tag weihs1998_longdist_longdist0`
- `python -B scripts/quantum/weihs1998_time_tag_reanalysis.py --subdir longdist --run longdist2 --encoding bit0-setting --out-tag weihs1998_longdist_longdist2`
- `python -B scripts/quantum/weihs1998_time_tag_reanalysis.py --subdir longdist --run longdist10 --encoding bit0-setting --out-tag weihs1998_longdist_longdist10`
- `python -B scripts/quantum/weihs1998_chsh_sweep_summary.py`

生成した主な出力：
- `output/quantum/weihs1998_chsh_sweep__weihs1998_longdist_longdist0.png`
- `output/quantum/weihs1998_chsh_sweep__weihs1998_longdist_longdist2.png`
- `output/quantum/weihs1998_chsh_sweep__weihs1998_longdist_longdist10.png`
- `output/quantum/weihs1998_chsh_sweep_summary__longdist.png`
- `output/quantum/weihs1998_chsh_sweep_summary__longdist_metrics.json`

---

## 2026-01-24（UTC） Phase 7（量子）/ Step 7.4.6：Giustina 2015（PhysRevLett.115.250401）の一次ソース固定（paper＋supplement）と、time-tag未固定のブロック明文化

目的：
- Step 7.4（ベル）の「NIST以外の photon time-tag 一次データ統合」に向けて、Giustina et al. 2015 の paper＋supplement を offline で固定し、取得経路を再現可能にする。
- 併せて、photon time-tag（click log）の一次公開が未固定であることを “保留/ブロック” として明文化し、論旨が「データ未確認のまま断言」にならないようにする。

変更：
- 追加：`scripts/quantum/fetch_giustina2015_prl115_250401.py`
  - arXiv（PDF＋source）と APS Harvest API（fulltext/metadata）を取得し、`data/quantum/sources/giustina2015_prl115_250401/manifest.json`（sha256）を生成。
  - arXiv source から supplemental PDF（`anc/supplemental_material_Vienna_20151220.pdf`）を抽出し、一次として固定。
- 更新：`doc/PRIMARY_SOURCES.md` / `doc/quantum/05_bell_public_datasets.md` / `doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`
  - Giustina 2015 の一次ソース（保存先＋sha256）を追加。
  - time-tag（click log）の一次公開が未固定であること、APS supplemental が環境依存で 403 になり得ることを明文化。
- 修正：`output/summary/build_materials.bat`
  - `full/quick/quick-nodocx` の分岐で `goto` ラベル解決が失敗し得るケースを避けるため、`goto label` 形式へ統一。

実行：
- `python -B scripts/quantum/fetch_giustina2015_prl115_250401.py --offline`

## 2026-01-24（UTC） Phase 7（量子）/ Step 7.4.7：Weihs 1998（time-tag）の複数subdirで coincidence window sweep 感度を追加固定（Giustina time-tag はブロック）

目的：
- Step 7.4（ベル）の「NIST以外の photon time-tag（click log）統合」を進めるにあたり、既に一次固定できている Weihs 1998（Zenodo 7185335）で、subdir（実験条件）を跨いでも window sweep の感度が同様に現れるかを確認する。
- Giustina 2015 の time-tag 一次公開（APS supplemental）については、環境依存の 403 により取得がブロックされるため、現時点では “ブロック” として扱い、取得可能な一次ソース（Zenodo等）が見つかり次第統合する方針を維持する。

変更：
- 実行：Weihs 1998 の追加subdir（locbell/loccorr/bellstat）で window sweep を再計算し、個別図を固定。
- 改善：`scripts/quantum/weihs1998_chsh_sweep_summary.py`
  - `--summary-tag` を追加し、複数seriesのまとめ図を用途別に出し分け可能にした。
- 改善：`scripts/quantum/fetch_giustina2015_prl115_250401.py`
  - `--include-aps-supplemental`（best-effort）を追加し、APS supplemental が取得できる環境では `aps_supplemental/` へ保存し、manifest に試行結果を記録できるようにした（現環境では 403 でブロック）。
- 更新：`doc/PRIMARY_SOURCES.md` / `doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json` / `doc/quantum/05_bell_public_datasets.md`

実行：
- `python -B scripts/quantum/weihs1998_time_tag_reanalysis.py --subdir locbell --run locbell0 --encoding bit0-setting`
- `python -B scripts/quantum/weihs1998_time_tag_reanalysis.py --subdir loccorr --run loccorr0 --encoding bit0-setting`
- `python -B scripts/quantum/weihs1998_time_tag_reanalysis.py --subdir bellstat --run bellstat0 --encoding bit0-setting`
- `python -B scripts/quantum/weihs1998_chsh_sweep_summary.py --summary-tag multi_subdirs --runs longdist:longdist1:weihs1998_longdist_longdist1 locbell:locbell0:weihs1998_locbell_locbell0 loccorr:loccorr0:weihs1998_loccorr_loccorr0 bellstat:bellstat0:weihs1998_bellstat_bellstat0`
- `python -B scripts/quantum/fetch_giustina2015_prl115_250401.py --include-aps-supplemental`
- `python -B scripts/summary/release_manifest.py --no-hash`
- `python -B scripts/summary/release_bundle.py --mode paper --no-hash`
- `python -B scripts/summary/release_bundle.py --mode repro --no-hash`

生成した主な出力：
- `output/quantum/weihs1998_chsh_sweep__weihs1998_locbell_locbell0.png`
- `output/quantum/weihs1998_chsh_sweep__weihs1998_loccorr_loccorr0.png`
- `output/quantum/weihs1998_chsh_sweep__weihs1998_bellstat_bellstat0.png`
- `output/quantum/weihs1998_chsh_sweep_summary__multi_subdirs.png`
- `output/quantum/weihs1998_chsh_sweep_summary__multi_subdirs_metrics.json`
- `data/quantum/sources/giustina2015_prl115_250401/manifest.json`
- `output/summary/release_manifest.json`
- `output/summary/pmodel_release_bundle_paper.zip`
- `output/summary/pmodel_release_bundle_repro.zip`

---

## 2026-01-25（UTC） Phase 7（量子）/ Step 7.4.7.3：ベルの selection 感度を NIST/Weihs/Delft で横断まとめ（資料カードへ反映）

目的：
- Step 7.4 の主眼（観測手続き＝selection が統計母集団を変え得る）を、データセット横断で “1枚の図” として固定し、査読/読者に説明しやすい形にする。
- NIST（CH）と Weihs/Delft（CHSH）で統計量が異なる点は明示したうえで、window/offset のノブが結果へ入る位置と感度の規模感を可視化する。

変更：
- 追加：`scripts/quantum/bell_selection_sensitivity_summary.py`
  - 既存の一次再解析成果（NIST trial-based metrics、Weihs sweep CSV、Delft metrics）を読み込み、横断まとめ図と数値を生成する。
- 出力：`output/quantum/bell_selection_sensitivity_summary.png` / `output/quantum/bell_selection_sensitivity_summary.json`
- 更新：`scripts/summary/public_dashboard.py`
  - 一般向けレポート（Phase 7）に「ベル：selection感度の横断まとめ」カードを追加。
- 更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`

実行：
- `python -B scripts/quantum/bell_selection_sensitivity_summary.py`
- `cmd /c output\\summary\\build_materials.bat quick-nodocx`

生成した主な出力：
- `output/quantum/bell_selection_sensitivity_summary.png`
- `output/quantum/bell_selection_sensitivity_summary.json`
- `output/summary/pmodel_public_report.html`

---

## 2026-01-25（UTC） Phase 7（量子）/ Step 7.4：Delft 2016（Sci Rep 6, 30289）の一次データ固定＋CHSH 再解析（psi±別＋combined）

目的：
- Step 7.4（ベル）の trial-based 系（event-ready）を、Hensen 2015 に加えて “第二実験”（Sci Rep 6, 30289）の公開データでも再解析できる形にし、selection（event-ready window start）感度が一般に現れ得ることを補強する。

変更：
- 修正：`scripts/quantum/delft_hensen2015_chsh_reanalysis.py`
  - 公開サンプル（Python2）に合わせ、(t+1)/2 の整数除算を明示し、無効trial（t=0）で NaN が混入しないように修正。
  - `--profile hensen2016_srep30289` を実行し、psi+ / psi- を分けて CHSH を計算し、trial数で重み付けした combined を出力。
- 追加：`scripts/summary/public_dashboard.py`
  - 一般向けレポート（Phase 7）に Delft 2016 のカード（`quantum_bell_delft_2016`）を追加。
- 更新：`doc/PRIMARY_SOURCES.md` / `doc/quantum/05_bell_public_datasets.md` / `doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`

実行：
- `python -B scripts/quantum/delft_hensen2015_chsh_reanalysis.py --profile hensen2016_srep30289`
- `python -B scripts/summary/public_dashboard.py`

生成した主な出力：
- `output/quantum/delft_hensen2016_srep30289_chsh.png`
- `output/quantum/delft_hensen2016_srep30289_chsh_metrics.json`
- `output/quantum/delft_hensen2016_srep30289_chsh_sweep_start_offset.csv`
- `output/summary/pmodel_public_report.html`

---

## 2026-01-25（UTC） Phase 7（量子）/ Step 7.4.7.3：selection感度の横断まとめを Delft 2016 まで拡張

目的：
- selection（window/offset）が統計量をどれだけ動かすかの横断まとめを、Delft 2015 に加えて Delft 2016（Sci Rep 30289；combined CHSH）も含む形に拡張し、trial-based 系でも再現される感度を補強する。

変更：
- 更新：`scripts/quantum/bell_selection_sensitivity_summary.py`
  - Delft 2015（CHSH S）と Delft 2016（combined CHSH）を同一パネルに重ねて表示し、JSON出力も `delft2015` / `delft2016` として分離記録する。
- 更新：`scripts/summary/public_dashboard.py`
  - selection横断まとめカードに Delft 2015/2016 の範囲を併記する。
- 更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`

実行：
- `python -B scripts/quantum/bell_selection_sensitivity_summary.py`
- `python -B scripts/summary/public_dashboard.py`

生成した主な出力：
- `output/quantum/bell_selection_sensitivity_summary.png`
- `output/quantum/bell_selection_sensitivity_summary.json`
- `output/summary/pmodel_public_report.html`

---

## 2026-01-25（UTC） Phase 7（量子）/ Step 7.4.7.2：Giustina 2015 time-tag（click log）一次公開のブロック確認（Cloudflare + 公開先未記載）

目的：
- Step 7.4.7.2（Giustina 2015 photon time-tag 統合）について、現環境での自動取得可否と、一次側（supplement）の記述から「公開先が明示されているか」を確認し、ブロックの性質（環境依存/根本的未公開）を切り分ける。

結果：
- APS supplemental（link.aps.org）は Cloudflare challenge（HTTP 403 + `cf-mitigated: challenge`）で自動取得できない（この環境では再現）。
- arXiv の supplemental PDF は data recording/analysis（time-tag threshold 等）を記述するが、click log（time-tag 生データ）の公開先を明示しない（space-time layout は “In preparation / PhD thesis” 参照）。

変更：
- 更新：`doc/quantum/05_bell_public_datasets.md`（Giustina 2015 の未固定理由の一次側の観察を追記）
- 更新：`doc/STATUS.md` / `doc/ROADMAP.md` / `doc/AI_CONTEXT_MIN.json`（ブロック状況を明確化）

実行：
- `python -B scripts/quantum/fetch_giustina2015_prl115_250401.py --include-aps-supplemental`（HTTP 403 を manifest に記録）

次の手段（解除条件）：
- クリックログ（Alice/Bob の event log）が公開されている一次ソース（Zenodo/OSF/機関リポジトリ等）を入手できた場合：
  - ファイルを `data/quantum/sources/giustina2015_prl115_250401/aps_supplemental/` へ配置
  - `python -B scripts/quantum/fetch_giustina2015_prl115_250401.py --offline` で hash 固定
  - 形式確定後に解析統合（NIST/Weihs と同一指標：delay分布/KS/window sweep + trial-based）

---

## 2026-01-25（UTC） Phase 8（論文化）/ Step 8.2：2章（Theory）と4章（Results）へ量子（Phase 7）を追記

目的：
- 論文本文（`doc/paper/10_manuscript.md`）の 2章に量子の立場（局所P構造・selection）を明記し、4章 Results に量子テストの結果を項目別に要約して追記する。

変更：
- 更新：`doc/paper/10_manuscript.md`
  - 2.8 節（量子：局所P構造・相関・selection）を追加し、CHSH の前提（同一母集団）を `w_ab(λ)` で書ける形に整理。
  - 4.13 節（量子：前提検証）を追加し、ベル／重力×量子干渉／物質波干渉／デコヒーレンス／量子光学／QED の結果を項目別に記載。
- 更新：`doc/paper/01_figures_index.md`
  - 追加参照となる量子図（particle_reflection_demo、NIST 03_43 の図、Weihsまとめ、Delft 2016、selection横断まとめ）を追記し、paper_lint 警告を解消。
- 更新：`doc/STATUS.md`

実行：
- `cmd /c output\\summary\\build_materials.bat quick-nodocx`

生成した主な出力：
- `output/summary/pmodel_paper.html`

---

## 2026-01-25（UTC） Phase 7（量子）/ Step 7.4.7.2：Giustina 2015 APS supplemental PDF 手動追加（click log は引き続き未同定）

目的：
- 手動配置された APS supplemental PDF を一次ソースとして固定（sha256）し、click log（time-tag 生データ）公開先が PDF 内に明示されるかを確認する。

結果：
- `Supplemental_material_final.pdf` は PDF 本文のみで、埋め込み添付（click log 等）を含まない。
- PDF 本文には click log の公開 URL/DOI 等は見当たらない（space-time layout は “In preparation / PhD thesis” 参照のまま）→ ブロック継続。

変更：
- 更新：`data/quantum/sources/giustina2015_prl115_250401/manifest.json`（手動配置した `aps_supplemental/Supplemental_material_final.pdf` を hash 固定）
- 更新：`doc/PRIMARY_SOURCES.md`（APS supplemental PDF を一次ソース一覧へ追記）
- 更新：`doc/quantum/05_bell_public_datasets.md`（APS supplemental PDF でも click log が得られない旨を追記）
- 更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`（ブロック条件を更新）

実行：
- `python -B scripts/quantum/fetch_giustina2015_prl115_250401.py --offline`

---

## 2026-01-25（UTC） Phase 8（論文化）/ Step 8.2：論文/短報から内部運用語（Phase/ROADMAP）を除去

目的：
- 論文（publish成果物）に内部の進捗管理語（Phase/ROADMAP）が露出しないようにし、読者向けの表現に統一する。

結果：
- `output/summary/pmodel_paper.html` と `output/summary/pmodel_short_note.html` から `Phase` / `ROADMAP` 表記が除去されることを確認した（paper_lint errors=0/warnings=0）。

変更：
- 更新：`doc/paper/10_manuscript.md`（本文中の Phase/ROADMAP 参照を削除・言い換え）
- 更新：`doc/paper/15_short_note.md`（Phase 参照を削除・言い換え）
- 更新：`doc/paper/20_data_sources.md` / `doc/paper/30_references.md`（Phase 参照を削除）
- 更新：`scripts/summary/paper_html.py`（ヘッダバッジから Phase/Step 表記を削除）
- 更新：`doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`

実行：
- `cmd /c output\\summary\\build_materials.bat quick-nodocx`

生成した主な出力：
- `output/summary/pmodel_paper.html`
- `output/summary/pmodel_short_note.html`

---

## 2026-01-25（UTC） Phase 7（量子）/ Step 7.4.8：Bell 一次プロダクト標準化（fixed outputs：normalized + sweep + falsification）

目的：
- Bell（time-tag / trial log）を、宇宙論と同じ型（一次ソース固定→手順固定→固定出力→指標→不確かさ（統計/系統）→反証条件）で再解析可能に固定する。

変更：
- 追加：`scripts/quantum/bell_primary_products.py`
  - Weihs1998 / Delft2015+2016 / NIST（03_43; s3600）を対象に、正規化データと sweep 指標を同一I/Fで生成する入口を追加。
- 更新：`doc/ROADMAP.md`（Step 7.4.8 を追記し、Step 7.4 を進行中へ更新）
- 更新：`doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`

実行：
- `python -B scripts/quantum/bell_primary_products.py`

---

## 2026-01-25（UTC） Phase 7（量子）ロードマップ拡張：物理全域（量子測定/電磁気/原子分子/核/物性/統計熱）までのステップを追加

目的：
- 「物理に関する全てを P-model で証明する」到達目標をロードマップ上で明確化し、Phase 7（量子）を宇宙論級以上の証明強度で深掘りする前提を固定する。

変更：
- 更新：`doc/ROADMAP.md`
  - Step 7.10（量子測定：Born則・状態更新）
  - Step 7.11（電磁気：電荷・Maxwell/光子）
  - Step 7.12（原子・分子：化学結合の固定検証）
  - Step 7.13（強い相互作用/核力の拡張）
  - Step 7.14（物性：凝縮系）
  - Step 7.15（統計力学・熱力学）
- 更新：`doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`


---

## 2026-01-25（UTC） Phase 7（量子）方針更新：量子を「宇宙論級」以上へ深掘りし、核力（pn束縛）までロードマップへ追加

目的：
- Phase 7（量子）は現状ロードマップの範囲よりも深い証明（最小仮定→写像→一次データ再現＋不確かさ＋反証条件）を要求する方針へ更新する。
- 到達目標として「物理全域を P-model で再導出できる状態」を明文化し、原子核（陽子/中性子の束縛）をロードマップへ追加する。

変更：
- 更新：`doc/ROADMAP.md`（Phase 7 の方針を拡張し、Step 7.9（原子核：pn束縛）を追加）
- 更新：`doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`（方針と次作業を反映）

---

## 2026-01-25（UTC） Phase 7（量子）/ Step 7.4.7：photon time-tag（NIST以外）として Kwiat/Christensen 2013（PRL 111, 130406）データを統合

目的：
- Step 7.4.7（NIST以外の photon time-tag 統合）を前進させる（Giustina 2015 click log が公開先未同定でブロックのため、公開性・再解析可能性が満たされる一次データを優先統合）。
- photon（PC-triggered）の trial/trigger 由来の「自然な窓（window）」を、データ配布側の説明（data_organization.txt）に基づき客観化して固定する。

変更：
- 追加：`scripts/quantum/fetch_kwiat2013_prl111_130406.py`（Illinois QI: CH_Bell_Data.zip + data_organization.txt を取得し manifest 化）
- 更新：`scripts/quantum/bell_primary_products.py`
  - dataset `kwiat2013_prl111_130406_05082013_15` を追加（CH J の window sweep / KS(delay) / cov(diag) を固定出力へ）
  - natural window を `data_organization.txt` の推奨（18000 timebins）として明示（p-hacking optics を避ける）
- 更新：`scripts/quantum/bell_selection_sensitivity_summary.py`（CH の曲線に Kwiat2013 を追加表示）
- 更新：`scripts/summary/public_dashboard.py`（selection summary のカードに Kwiat2013 を反映）
- 更新：`doc/ROADMAP.md` / `doc/PRIMARY_SOURCES.md` / `doc/quantum/05_bell_public_datasets.md`（一次ソースとStep進捗の固定）

生成物（固定出力）：
- `output/quantum/bell/kwiat2013_prl111_130406_05082013_15/window_sweep_metrics.json`
- `output/quantum/bell/kwiat2013_prl111_130406_05082013_15/covariance.json`
- `output/quantum/bell_selection_sensitivity_summary.png` / `.json`

実行：
- `python -B scripts/quantum/fetch_kwiat2013_prl111_130406.py`
- `python -B scripts/quantum/bell_primary_products.py`
- `python -B scripts/quantum/bell_selection_sensitivity_summary.py`


## 2026-01-25（UTC） Phase 7（量子）/ Step 7.4.9：natural window（Weihs）を dtピーク由来へ改善（plateau依存の解消）

目的：
- Weihs 1998 の time-tag では `pairs_total` が window とともに単調増加しやすく、pairs plateau で推奨windowを定める方式が不適切になり得る。
- 「自然な窓（natural window）」を、統計量（|S|/J）の最大化ではなく、装置由来の timing 分布（遅延ピーク幅＋drift）から客観化し、p-hacking に見える余地を減らす。

変更：
- 更新：`scripts/quantum/bell_primary_products.py`
  - time-tag データに対して、nearest-neighbor dt のヒストグラムからピークを検出し、背景（outer bins の中央値）を差し引いた有効信号の 99% を含む半値幅＋drift（p95-p05/2）で推奨windowを決める方式を追加（method=`dt_peak_hist_signal_fraction`）。
  - Weihs 1998（`weihs1998_longdist_longdist1`）の window sweep を 50 ns まで拡張し、推奨window付近も sweep 点として出力に含める。
  - `output/quantum/bell/falsification_pack.json` と `output/quantum/bell/<dataset>/covariance.json` の `natural_window` に推奨window根拠（機械可読）を保存。
- 更新：`doc/paper/12_part3_quantum.md`
  - natural window の客観基準の例を「dtピーク幅（背景差し引き）+ drift + cross-check」に整合。

実行：
- `python -B scripts/quantum/bell_primary_products.py`

---

## 2026-01-25（UTC） Phase 7（量子）/ Step 7.4.7.3：横断まとめ図を固定出力（output/quantum/bell/*）に統一

目的：
- selection 感度の横断まとめ（NIST/Weihs/Delft）が、旧来の個別出力（NIST trial metrics / Weihs sweep CSV / Delft metrics）に依存していると、Phase 7.4.9（宇宙論級：固定出力）と整合しない。
- 自然な窓（natural window）を可視化（推奨window/offset を縦線）し、p-hacking ではなく「装置/手続き由来の基準」を前面に出す。

変更：
- 更新：`scripts/quantum/bell_selection_sensitivity_summary.py`
  - 入力を `output/quantum/bell/<dataset>/*`（window_sweep/offset_sweep/covariance）へ統一。
  - NIST/Weihs は推奨window（natural window）を縦線で表示（log x）。
  - Delft は protocol baseline（start_offset=0）を縦線で表示。
  - 出力 JSON に recommended window/offset と method を併記。
- 更新：`scripts/summary/public_dashboard.py`（カード詳細の入力説明を更新）

出力：
- `output/quantum/bell_selection_sensitivity_summary.png`
- `output/quantum/bell_selection_sensitivity_summary.json`

実行：
- `python -B scripts/quantum/bell_selection_sensitivity_summary.py`

生成した主な出力：
- `output/quantum/bell/weihs1998_longdist_longdist1/normalized_events.*`
- `output/quantum/bell/weihs1998_longdist_longdist1/window_sweep_metrics.json`
- `output/quantum/bell/weihs1998_longdist_longdist1/offset_sweep_metrics.json`
- `output/quantum/bell/weihs1998_longdist_longdist1/summary.png`
- `output/quantum/bell/delft_hensen2015/normalized_events.*`
- `output/quantum/bell/delft_hensen2015/offset_sweep_metrics.json`
- `output/quantum/bell/delft_hensen2015/summary.png`
- `output/quantum/bell/delft_hensen2016_srep30289/normalized_events.*`
- `output/quantum/bell/delft_hensen2016_srep30289/offset_sweep_metrics.json`
- `output/quantum/bell/delft_hensen2016_srep30289/summary.png`
- `output/quantum/bell/nist_03_43_afterfixingModeLocking_s3600/normalized_events.*`
- `output/quantum/bell/nist_03_43_afterfixingModeLocking_s3600/window_sweep_metrics.json`
- `output/quantum/bell/nist_03_43_afterfixingModeLocking_s3600/offset_sweep_metrics.json`
- `output/quantum/bell/nist_03_43_afterfixingModeLocking_s3600/summary.png`
- `output/quantum/bell/table1_row.json`
- `output/quantum/bell/falsification_pack.json` / `output/quantum/bell/falsification_pack.png`

---

## 2026-01-25（UTC） Phase 7（量子）/ Step 7.4.9：量子（Bell）を宇宙論（BAO）と同等の精度で進める前提でロードマップ見直し

目的：
- 量子解析を「宇宙論（BAO）と同型の精度」（一次データ→固定出力→共分散→系統→反証条件）で進める方針を明文化し、次の作業（Step 7.4.9）をロードマップへ落とす。

変更：
- 更新：`doc/ROADMAP.md`（Phase 7 の精度規約を追加、Step 7.4.9 を追加、優先度を更新）
- 更新：`doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`（現在地を Step 7.4.9 へ更新）

実行：
- `python -B scripts/summary/update_work_history_recent.py`

---

## 2026-01-25（UTC） Phase 8（論文化）/ 論文3分冊（Part I/II/III）への分割を実体化＋ビルド入口を整備

目的：
- 肥大化した論文を、(i) コア理論（Part I）、(ii) 宇宙物理の応用検証（Part II）、(iii) 量子物理の応用検証（Part III）に分割し、コアを正本として統一性が破綻しない形で運用可能にする。

変更：
- 更新：`doc/paper/10_part1_core_theory.md`（Part I：コア理論の本文を統合版から移植し、分冊の接続節を追加）
- 更新：`doc/paper/11_part2_astrophysics.md`（Part II：宇宙物理の応用検証として統合版から移植。冒頭リンク文を固定）
- 更新：`doc/paper/12_part3_quantum.md`（Part III：量子物理の応用検証として統合版から移植。内部ブロックの構造/番号を整理し、publish除外が効くように修正）
- 更新：`scripts/summary/paper_html.py`（profile：`paper`/`part2_astrophysics`/`part3_quantum`/`short_note` を追加し、出力名を固定）
- 更新：`scripts/summary/paper_build.py`（profile追加、lint対象原稿の切替、出力DOCX名を固定）
- 更新：`output/summary/build_materials.bat`（quick/quick-nodocx に加え full でも Part II/III を生成するように追加）
- 更新：`doc/paper/README.md`（Part I/II/III の入口とコマンドを追記）
- 更新：`doc/paper/40_publication_plan.md`（3本立て方針・冒頭リンク文・注意点（再掲最小/語彙固定）を明文化）
- 修正：publish HTML に `\\`（LaTeXエスケープ）が混入しないよう、本文中の `\\mu`/`\\sigma` を Unicode（μ/σ）へ置換（`doc/paper/10_part1_core_theory.md`）

実行：
- `python -B scripts/summary/paper_build.py --profile paper --mode publish --outdir output/summary --skip-docx --skip-tables`

---

## 2026-01-25（UTC） Phase 8（論文化）/ 三部作の流れ強化（1→2→3）・Part II/III の最小注記追加・paper_qc 修正・資料生成（quick）

目的：
- 三部作（Part I/II/III）を **Part I→Part II→Part III** の順で読み進めたとき、最後（Part III）で納得できる流れになるよう、接続・立場・要約の表現を引き締める。
- Part II/III の理論枠組みに、P の次元（比 `P/P0` のみが観測量に効く）に関する最小注記を追加し、単独読みに耐える安全弁を置く。
- `paper_qc.py` が Part I（図なし）で誤って失敗する問題を修正する。

変更：
- 更新：`doc/paper/10_part1_core_theory.md`
  - Part II/III への接続に「推奨読み順」と「応用編で写像/凍結値をその場で書き換えない」旨を追記。
- 更新：`doc/paper/11_part2_astrophysics.md`
  - 序論に三部作の読み順（Part I→II→III）を追記。
  - 理論的枠組み 2.1 に P の次元/無次元比に関する最小注記を追記。
  - 結論に Part III（量子編）への接続を追記。
- 更新：`doc/paper/12_part3_quantum.md`
  - 序論に三部作の読み順（Part I→II→III）を追記。
  - 理論的枠組み 2.1 に P の次元/無次元比に関する最小注記を追記。
  - 2.5 の冒頭を「Part I の中心は…」へ修正（本稿の主題との齟齬を解消）。
  - 結論に、三部作としての位置づけ（統一＝反証形式の一貫性）を追記。
- 更新：`scripts/summary/paper_qc.py`
  - strict lint の対象を `doc/paper/10_part1_core_theory.md` に更新（旧：`10_manuscript.md`）。
  - 図が存在しない場合、図番号チェックを trivially OK とする。

実行：
- `cmd /c output\\summary\\build_materials.bat quick`
- `python -B scripts/summary/paper_qc.py`

---

## 2026-01-25（UTC） Phase 8（論文化）/ Part I の主張トーン調整・Part III（Bell/selection）の誤読防止・資料生成（quick）

目的：
- Part I の背景で「量子まで統一」を過剰に先取りしないよう、長期目標として位置づけを明確化して論文トーンを引き締める。
- Part III の Bell/selection 表現（`w_ab(λ)`）が「新しい物理自由度の導入」や「局所実在の主張」と誤読されないよう、記法の位置づけ（採用規則の記法）を明文化する。

変更：
- 更新：`doc/paper/10_part1_core_theory.md`
  - 1.1 背景の「統一」表現を長期目標として整理（応用検証は Part II/III で段階的に扱う）。
  - 1.2 の貢献を「一般向けレポート（公開用）」へ明確化。
- 更新：`doc/paper/12_part3_quantum.md`
  - 2.5 の `w_ab(λ)` を「採用事象集合を表す記法」である旨を追記し、`λ` の表現を「潜在変数」へ修正。
  - 5章の `w_ab(λ)` も「採用規則の記法」と注記して整合。

実行：
- `cmd /c output\\summary\\build_materials.bat quick`
- `python -B scripts/summary/paper_qc.py`

---

## 2026-01-25（UTC） Phase 8（論文化）/ Part I：Pの次元注記・φの次元注記・量子節を展望へ

目的：
- 想定査読コメント（Pの物理的実体/次元、`φ=-c^2 ln(P/P0)` の次元・無次元条件）に備え、Part I の定義と適用条件を明文化する。
- Part I の量子節（2.8）を「展望（preview）」に明確化し、期待値を上げすぎない形で Part III への導線に徹する。

変更：
- 更新：`doc/paper/10_part1_core_theory.md`
  - 2.1節に「観測量は比 `P/P0` のみ」「`P` と `P0` は同次元」「`φ` は速度の二乗の次元」の注記を追記。
  - 2.8節を展望として明記し、主張範囲を抑制（応用検証は Part III へ）。
- 更新：`doc/paper/05_definitions.md`
  - A.2 に P の次元（比のみが観測に効く）と同次元要件を追記。
  - A.4 に `φ` の次元と `ln(P/P0)` の無次元性の注記を追記。

実行：
- `python -B scripts/summary/paper_build.py --profile paper --mode publish --outdir output/summary --skip-docx --skip-tables`
- `python -B scripts/summary/paper_build.py --profile part2_astrophysics --mode publish --outdir output/summary --skip-docx --skip-tables`
- `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx --skip-tables`

---

## 2026-01-25（UTC） Phase 8（論文化）/ Part I/II/III の目次（ToC）ドラフトを作成

目的：
- 3本分冊（Part I=コア理論、Part II=宇宙物理、Part III=量子物理）として破綻しない粒度で、まず目次（章立て）を固定する。

変更：
- 追加：`doc/paper/10_part1_core_theory.md`（Part I：コア理論の目次ドラフト）
- 更新：`doc/paper/11_part2_astrophysics.md`（Part II：宇宙物理編の目次ドラフト）
- 更新：`doc/paper/12_part3_quantum.md`（Part III：量子物理編の目次ドラフト）

実行：
- `python -B scripts/summary/update_work_history_recent.py`

---

## 2026-01-25（UTC） Phase 8（論文化）/ 分冊方針：Part I/II/III の統一リンクを固定

目的：
- 論文肥大化に備え、Part I（コア理論）を法典として Part II（宇宙物理）/ Part III（量子物理）へ統一性が伝わる「冒頭リンク文」と編集ルール（再掲最小・語彙固定）を明文化する。

変更：
- 追加：`doc/paper/11_part2_astrophysics.md`（宇宙物理編；冒頭に Part I 参照の1文を固定）
- 追加：`doc/paper/12_part3_quantum.md`（量子物理編；冒頭に Part I 参照の1文を固定）
- 更新：`doc/paper/40_publication_plan.md`（3本立ての方針＋注意点＋冒頭リンク文の運用を追記）

実行：
- `python -B scripts/summary/update_work_history_recent.py`

---

## 2026-01-25（UTC） Phase 8（論文化）/ Part II（宇宙）・Part III（量子）の「データ出典/参考文献」を本文の引用に即して絞り込み

目的：
- 宇宙編/量子編の末尾に「全件載せ」になっていたデータ出典（一次ソース）と参考文献を、各Partの本文で実際に引用しているキーに基づいて整合させる（混入を防ぐ）。

変更：
- 更新：`scripts/summary/paper_html.py`（publish生成時、`doc/paper/20_data_sources.md` と `doc/paper/30_references.md` を「本文で使われた引用キー」に基づき `##` セクション単位で自動絞り込み）
- 更新：`doc/paper/20_data_sources.md`（量子セクションを追加＋冒頭の対象列挙を汎用化）
- 更新：`doc/paper/30_references.md`（量子セクションを追加）
- 更新：`doc/paper/12_part3_quantum.md`（量子編の引用キーを追加し、publish版で `doc/...` パスが出ないよう internal-only 化）
- 更新：`doc/paper/10_part1_core_theory.md` / `doc/paper/11_part2_astrophysics.md`（Part I↔II/III の相互リンクをHTMLへ統一）

実行：
- `python -B scripts/summary/paper_build.py --profile paper --mode publish --outdir output/summary --skip-docx --skip-tables --no-embed-images`
- `python -B scripts/summary/paper_build.py --profile part2_astrophysics --mode publish --outdir output/summary --skip-docx --skip-tables --no-embed-images`
- `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx --skip-tables --no-embed-images`

生成した主な出力：
- Part I：`output/summary/pmodel_paper.html`
- Part II：`output/summary/pmodel_paper_part2_astrophysics.html`
- Part III：`output/summary/pmodel_paper_part3_quantum.html`

---

## 2026-01-25（UTC） Phase 8（論文化）/ DOCX数式サイズ調整・Part I簡略化・宇宙論詳細の Part II への移管・Table 1 の分割

目的：
- Word（DOCX）で数式が小さすぎる問題を解消する（3倍）。
- Part I（コア）を指定のシンプル構成へ寄せ、宇宙論の詳細は Part II、量子の詳細は Part III へ寄せる。
- Table 1 の掲載方針を「Part II/III のみ」にし、量子用 Table 1 を追加する。

変更：
- 更新：`scripts/summary/html_to_docx.py`（alt=「数式」の画像をWord postprocessで3倍スケール）
- 更新：`scripts/summary/paper_tables.py`（量子用 Table 1：`output/summary/paper_table1_quantum_results.*` を生成）
- 更新：`scripts/summary/paper_html.py`（Table 1 を Part II/III のみに限定、Part III は量子Table1参照）
- 更新：`doc/paper/10_part1_core_theory.md`（宇宙論詳細を Part II へ移管、2.6/2.7 は検証先を Part II へ明示、Methods を 3.1–3.3 に簡略化）
- 更新：`doc/paper/11_part2_astrophysics.md`（宇宙論詳細を 5.3.1–5.3.3 として追加、内部 doc リンクを internal-only 化、量子図の混入を除去）
- 更新：`doc/paper/12_part3_quantum.md`（結果に Table 1 節を追加しリナンバー）

実行：
- （HTML/DOCX生成はユーザーが `output/summary/build_materials.bat` で実行）

---

## 2026-01-25（UTC） Phase 8（論文化）/ Word数式（OMML）を復旧（画像→数式）

目的：
- 論文 DOCX の数式が画像（PNG）になって編集できない問題を解消し、Word の数式（OMML）として出力する（従来の体裁へ復帰）。

変更：
- 更新：`scripts/summary/html_to_docx.py`
  - `--paper-equations` で、publish HTML の数式画像（alt=「数式」）を Markdown の `$$...$$` から復元し、OMML に変換して差し替える。
  - 分冊（Part I/II/III/短報）で Markdown 入力が変わっても破綻しないよう、候補セット（Part別）を作り「数式個数一致」するものを自動選択する。
  - publish と同じく internal-only ブロック（`<!-- INTERNAL_ONLY_START/END -->`）を除去してから `$$...$$` を抽出し、個数ずれを防ぐ。

実行：
- `cmd /c output\\summary\\build_materials.bat quick`（または `full`）

---

## 2026-01-25（UTC） Phase 8（論文化）/ DOCX数式の文字サイズ1.5倍・Part II/III に理論枠組みを追加・Part I を基準書へ寄せる

目的：
- DOCX の数式が Word 数式（OMML）になった後、文字が本文と同サイズで読みづらい問題を解消する（1.5倍）。
- Part II/III を単独で読まれても最低限の理論枠組みが分かるよう、序論直後に「理論的枠組み」を追加する。
- Part I（コア）の役割（基準書）から逸脱した表現を除去し、凍結（β/δ）の責任所在を明確化する。

変更：
- 更新：`scripts/summary/html_to_docx.py`（Word postprocess で OMML 数式のフォントサイズを 1.5 倍）
- 更新：`doc/paper/10_part1_core_theory.md`（「基準書」であることを明確化、β/δ 凍結の責任所在を追記）
- 更新：`doc/paper/11_part2_astrophysics.md`（序論直後に「理論的枠組み（Theoretical Framework）」を追加）
- 更新：`doc/paper/12_part3_quantum.md`（序論直後に「理論的枠組み（Theoretical Framework）」を追加）

実行：
- （HTML/DOCX生成はユーザーが `output/summary/build_materials.bat` で実行）

---

## 2026-01-25（UTC） Phase 8（論文化）/ Part III 構成の同型化・量子 Table 1 に計画テストを追加

目的：
- 量子論文（Part III）の章立てを宇宙論文（Part II）と同型に揃え、統一性を担保する。
- 量子 Table 1 に、未実施の「計画テスト」も併記してロードマップと接続する。

変更：
- 更新：`doc/paper/12_part3_quantum.md`
  - `5. 差分予測` / `6. 議論` を追加し、結論/入手性/参考文献を 7–9 へ揃えた（Part II と同型）。
- 更新：`scripts/summary/paper_tables.py`
  - 量子 Table 1（`output/summary/paper_table1_quantum_results.*`）に、Bell 以外の量子サマリ行（干渉/時計/デコヒーレンス/光学/QED）と、計画テスト行を追加。

実行：
- `python -B scripts/summary/paper_tables.py`
- `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx --skip-tables`

---

## 2026-01-25（UTC） Phase 8（論文化）/ Part I 抽象と概念章の純化・Part II/III の未完成表記を解消

目的：
- Part I（コア）の Abstract を「写像/凍結/反証条件」に絞り、検証列挙を最小化する。
- Part I の 2.5〜2.8 を「概念（写像）固定」に徹し、特に動的P（放射）の詳細（Peters–Mathews展開）は Part II へ寄せてコアの純度を上げる。
- Part II/III の「準備中」表記を解消し、公開体裁として最低限の説明（目的・一次データ・指標・反証条件）を追加する。
- Part II の LLR 数値を Table 1 と本文で整合させる。

変更：
- 更新：`doc/paper/10_part1_core_theory.md`
  - Abstract を「写像/凍結/反証条件」に整理。
  - 2.5（宇宙論）/2.6（動的P）/2.7（回転）を短縮し、Peters–Mathews の式展開はコアから除去（検証は Part II へ）。
- 更新：`doc/paper/11_part2_astrophysics.md`
  - Abstract/序論/方法の「準備中」を置換し、目的・一次データ・指標（Table 1）・反証条件の骨格を明文化。
  - LLR の主要数値を Table 1（`output/llr/batch/llr_batch_summary.json`）と一致させた（4.354171 ns, N=13132）。
- 更新：`doc/paper/12_part3_quantum.md`
  - Abstract/序論/方法/差分予測/議論/結論の「準備中」を置換し、目的・一次データ・指標（Table 1）・反証条件の骨格を明文化。

実行：
- `python -B scripts/summary/paper_build.py --profile paper --mode publish --outdir output/summary --skip-docx --skip-tables`
- `python -B scripts/summary/paper_build.py --profile part2_astrophysics --mode publish --outdir output/summary --skip-docx --skip-tables`
- `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx --skip-tables`

---

## 2026-01-25（UTC） Phase 8（論文化）/ コア（Part I）の攻撃点（δ/β/P0/有効モデル）を明確化

目的：
- 想定査読コメント（攻撃点）に備え、Part I の立場を「有効モデル／写像固定」の軸へ寄せる。
- 速度項 δ を第一原理由来に見せず、現象論的な ansatz として正直に位置づける。
- β=1 を弱場のキャリブレーションであることを明示し、勝負は固定後の差分予測（Part II）であることを強調する。
- `P0` の定義と適用範囲（局所系の漸近境界条件）を明確化し、宇宙論背景 `P_bg(t)` は Part II に委譲する。

変更：
- 更新：`doc/paper/10_part1_core_theory.md`
  - δ：2.3節で phenomenological ansatz として採用理由（最小形・極限条件）を明記。
  - β：2.4節で β=1 はキャリブレーションとして凍結し、差分予測は強場/宇宙論側で判定する方針を明記。
  - P0：2.1節で「局所系の漸近的平坦領域では定数」として扱うスコープ注記を追加。
  - 1.1節で「時間波」の微視的理論は未提示であり、有効モデルとして写像を先に検証する立場を補強。
- 更新：`doc/paper/05_definitions.md`
  - `P0` の注記（局所系では定数、宇宙論は Part II）を追記。
  - δ の注記（phenomenological ansatz／最小形／他の形もあり得る）を追記。
  - β=1 の注記（弱場キャリブレーション→固定後に差分予測）を追記。

実行：
- `python -B scripts/summary/paper_build.py --profile paper --mode publish --outdir output/summary --skip-docx --skip-tables`

---

## 2026-01-25（UTC） Phase 8（論文化）/ β凍結の一貫性（Cassini/光偏向）を出力へ反映・資料再生成

目的：
- β凍結値（`output/theory/frozen_parameters.json`）を Cassini/太陽光偏向の既定挙動に反映し、論文の「β凍結」表記と生成物（CSV/JSON/図）の矛盾を防ぐ。
- Cassini overlay のメタデータ出力に β の取得元（beta_source）を残し、再現性情報を強化する。
- 三部作（Part I/II/III）と一般向けレポートを quick で再生成し、publish QC を通す。

変更：
- 更新：`scripts/cassini/cassini_fig2_overlay.py`
  - `--beta` 省略時は凍結β（`output/theory/frozen_parameters.json`）を採用。
  - worklog へ `beta_source` / `tdf_reconstruct_beta_source` を記録。

実行：
- `python -B scripts/cassini/cassini_fig2_overlay.py --no-sweep`（`output/cassini/cassini_fig2_metrics.csv` / `cassini_fig2_run_metadata.json` を更新）
- `python -B scripts/theory/solar_light_deflection.py`（`output/theory/solar_light_deflection_metrics.json` を更新）
- `python -B scripts/summary/paper_tables.py`（Table 1 再生成）
- `cmd /c output\\summary\\build_materials.bat quick`（Part I/II/III + public report を再生成）
- `python -B scripts/summary/paper_qc.py`（OK）

---

## 2026-01-25（UTC） Phase 8（論文化）/ Part I Abstract の「凍結」表現を運用前提へ明確化

目的：
- Part I（コア理論）の Abstract (ii)「凍結」が“永久凍結”に誤読されないよう、運用（改訂→一括再生成）を明文化する。

変更：
- 更新：`doc/paper/10_part1_core_theory.md`
  - Abstract (ii) を「Part I で確定し frozen_parameters.json に保存。Part II/III では勝手に変更せず、更新が必要なら Part I 改訂→以後の出力を一括再生成」に修正。

実行：
- `cmd /c output\\summary\\build_materials.bat quick`（Part I/II/III + public report を再生成）
- `python -B scripts/summary/paper_qc.py`（OK）

---

## 2026-01-25（UTC） Phase 8（論文化）/ 査読耐性の補強（δの非一意性・前処理/circularity注記・内部メモのpublish除去）

目的：
- 速度項 δ を「最小の現象論的 ansatz」として採用している点について、関数形が非一意であることと、識別は Part II の課題であることを明文化し、ad-hoc 批判に耐える。
- 公開一次ソースの一部が標準理論に基づく前処理を含み得る点（円環性）を Part II 側でも明記し、独立テストと整合性チェックの区別を明確化する。
- publish 体裁として不要な内部メモ（入力固定パス）を internal-only 化する。

変更：
- 更新：`doc/paper/10_part1_core_theory.md`
  - 1.2節の貢献表現を「図表カタログ（dashboard）＋要約レポート」へ整理。
  - 2.3節（δ）に、飽和形の非一意性（他の関数形もあり得る）と、識別/第一原理導出は Part II の課題である旨を追記。
- 更新：`doc/paper/11_part2_astrophysics.md`
  - 3章（Data/Methods）に、一次ソースの前処理（標準理論依存）の注意を追記。
  - LLR/Viking/GPS の注意に、幾何/推定済みプロダクト依存（円環性）を追記。
  - 宇宙論節の内部メモ（DDR入力固定）を internal-only 化。

実行：
- `cmd /c output\\summary\\build_materials.bat quick`（Part I/II/III + public report を再生成）
- `python -B scripts/summary/paper_qc.py`（OK）

---

## 2026-01-25（UTC） Phase 7（量子）/ 想定攻撃への防御（Schr不在・event-ready・QED安全確認）を Part III とロードマップへ反映

目的：
- Part III（量子）が「半古典（既存QMへφを代入しただけ）」に見える致命的攻撃を避けるため、Schr/KG が現れる最小ロジック（仮定列挙）を Theory に追記する。
- Hensen 2015（event-ready / loophole-free）に対して、window/offset sweep を p-hacking と誤解されないよう「自然な窓（natural window）の根拠（物理/装置）」と反証点を明文化する。
- QED精密（Lamb shift / g-2 等）と矛盾するという攻撃に対し、P-model最小結合（重力ポテンシャルφのみ）では原子スケールの効果が極小である安全確認（オーダー評価）を追加し、機械可読出力へ固定する。

変更：
- 更新：`doc/paper/12_part3_quantum.md`
  - 2.5.1 に「波動方程式と短波長極限（Schr/KG）」を追加（rest phase＋時計写像→`V=mφ`、Born則は未導出である旨も明記）。
  - Bell（Delft/Hensen）に「event-ready と自然な窓（natural window）」の注意を追加（sweepの位置づけ、p-hacking回避、τ_relaxの候補と今後の基準固定）。
  - QED節（4.2.6）に安全確認（原子スケールの `|φ_nuc|/c^2` と `ΔE` のオーダー）を追加。
- 更新：`doc/ROADMAP.md`
  - Step 7.4.9 に natural window 基準の固定（delay/jitter + accidental rate）を追加【準備中】。
  - Step 7.5.6（Schr/KG の位置づけ）を追加し、初版として完了扱いへ【完了（初版）】。
  - Step 7.8.3（QED safety check）を追加し、初版として完了扱いへ【完了（初版）】。
- 更新：`scripts/quantum/qed_vacuum_precision.py`
  - 原子スケールの重力ポテンシャル（H / U-238例）と `ΔE~m_e|φ|` を計算し、`output/quantum/qed_vacuum_precision_metrics.json` に保存（図にも注記）。

実行：
- `python -B scripts/quantum/qed_vacuum_precision.py`
- `cmd /c output\\summary\\build_materials.bat quick`（Part I/II/III + public report を再生成）
- `python -B scripts/summary/paper_qc.py`（OK）

---

## 2026-01-25（UTC） Phase 7（量子）/ Step 7.4.9：Bell を “宇宙論級” へ（共分散＋系統分解＋長期統合＋閾値の固定出力を初版として実装）

目的：
- Bell（NIST/Weihs/Delft）について、Phase 4.5（BAO）と同じく「一次データ→固定出力→不確かさ（共分散）→系統テンプレ→長期統合→反証条件（閾値）」の形へ揃える（初版）。

変更：
- 更新：`scripts/quantum/bell_primary_products.py`
  - NIST/Delft の offset sweep 出力に誤差（J_sigma_boot / S_err）を併記し、共分散計算の入力を固定化。
  - 固定出力として `output/quantum/bell/<dataset>/covariance.json` を追加（Weihs=block共分散、NIST=入れ子Poisson近似、Delft=対角近似）。
  - 固定出力として `output/quantum/bell/systematics_templates.json` / `output/quantum/bell/longterm_consistency.*` を追加。
  - falsification_pack に推奨window（pairs_total の plateau を用いる初版）を併記。
- 更新：`doc/ROADMAP.md`（Step 7.4.9 を【完了（初版）】へ）
- 更新：`doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`（現在地と次作業を更新）

実行：
- `python -B scripts/quantum/bell_primary_products.py`

---

## 2026-01-25（UTC） Phase 7（量子）/ Step 7.4.9：natural window の客観化（NIST の推奨windowを build.hdf5 gate 由来へ）

目的：
- falsification_pack の「推奨window」が、pairs_total の単純plateau定義だと NIST で不自然に巨大（例：5000 ns）になり得る問題を解消し、p-hacking に見えない **装置/解析定義由来** の基準として固定する。

変更：
- 更新：`scripts/quantum/bell_primary_products.py`
  - NIST の推奨windowを、processed build（`*.dat.compressed.build.hdf5`）の gate 設定（pk/radius）由来で決める方式へ変更（`radius_a + radius_b` を保守的half-window proxyとして採用）。
  - `output/quantum/bell/falsification_pack.json` の各datasetに `recommended_window_method` を併記し、推奨windowの根拠を機械可読で固定。
  - `output/quantum/bell/<dataset>/covariance.json` の `natural_window` も同じ根拠へ統一。

実行：
- `python -B scripts/quantum/bell_primary_products.py`

---

## 2026-01-25（UTC） Phase 7（量子）/ Step 7.4.7（Giustina）ブロック再確認＋Step 7.4.9（NIST natural window）の根拠を「trial-based一致」へ修正

目的：
- Step 7.4.7（Giustina 2015）の photon click log は公開先未同定（公開されていない可能性）でブロック継続の根拠を明確化する。
- Step 7.4.9（natural window）で、NIST の推奨window根拠として「build gate の pk/radius を ns と仮定する」弱い前提を撤回し、**独立な trial-based coincidence 定義**との一致で window を固定する。

変更：
- 更新：`scripts/quantum/bell_primary_products.py`
  - NIST の推奨windowを `trial_based_counts.json` の coincidence total に最も近い `pairs_total` を与える window（time-tag sweep）として固定（method=`trial_match_pairs_total`）。
  - `output/quantum/bell/falsification_pack.json` と `output/quantum/bell/<dataset>/covariance.json` に推奨windowの根拠（trial_total / selected_pairs_total / delta）を機械可読で保存。

調査（Giustina 2015）：
- arXiv 版の Data availability には「実験データは著者へ連絡すれば入手可能（request）」旨の記載があり、公開クリックログ（time-tag一次データ）の自動取得先は現状未固定（ブロック継続）。

実行：
- `python -B scripts/quantum/bell_primary_products.py`

---

## 2026-01-25（UTC） Phase 7（量子）/ Step 7.9.1：原子核deuteronベースライン（NIST CODATA定数）を一次ソース固定＋固定出力化

目的：
- Phase 7 を「宇宙論級」へ拡張する方針に従い、原子核（pn束縛）の最小ケース（deuteron）について、一次データを固定し、再現可能なベースライン出力（数値＋図＋反証条件）を先に凍結する。
- 以後の Step 7.9.2（np散乱）/ 7.9.3（P場→核スケール有効方程式）に進むための「観測量パッケージ（B, r_d, 1/κ）」を固定する。

変更：
- 追加：`scripts/quantum/fetch_nuclear_binding_sources.py`
  - NIST Cuu（CODATA 2022）定数ページ（mp,mn,md,rd）を取得し、`data/quantum/sources/nist_codata_2022_nuclear_baseline/manifest.json` と `extracted_values.json` を生成。
- 追加：`scripts/quantum/nuclear_binding_deuteron.py`
  - mass defect から deuteron の束縛エネルギーBを計算し、サイズ拘束（r_d, 1/κ）を合わせて固定出力化。
  - 出力：`output/quantum/nuclear_binding_deuteron.png` / `output/quantum/nuclear_binding_deuteron_metrics.json`
- 更新：`doc/PRIMARY_SOURCES.md`（原子核ベースライン一次ソースを追加）
- 更新：`doc/ROADMAP.md`（Step 7.9 を進行中へ、7.9.1 を完了（初版）へ）
- 更新：`doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`（現在地と次作業を更新）

実行：
- `python -B scripts/quantum/fetch_nuclear_binding_sources.py`
- `python -B scripts/quantum/nuclear_binding_deuteron.py`

---

## 2026-01-25（UTC） Phase 7（量子）/ Step 7.9.2：np散乱（低エネルギー：散乱長/有効レンジ/shape）を一次ソース固定＋固定出力化

目的：
- Step 7.9（原子核）を「任意関数fit」批判に耐える形へ進めるため、deuteron（pn束縛）に直結する低エネルギーnp散乱パラメータ（a_t, r_t, v2t / a_s, r_s, v2s）を一次ソースで固定する。
- 同一一次ソース内の複数推定（legacy vs phase-shift analyses）の差を「解析依存系統（proxy）」として保存し、以後の Step 7.9.3（核スケール有効方程式）で拘束として使う。

変更：
- 追加：`scripts/quantum/fetch_nuclear_np_scattering_sources.py`
  - arXiv:0704.1024v1（PDF + source tarball）を取得し、eq.(16–19) を機械抽出して `data/quantum/sources/np_scattering_low_energy_arxiv_0704_1024v1_extracted.json` を生成。
  - `data/quantum/sources/np_scattering_low_energy_arxiv_0704_1024v1_manifest.json` に URL/sha256 を凍結。
- 追加：`scripts/quantum/nuclear_np_scattering_baseline.py`
  - np散乱の低エネルギーパラメータを図＋JSONで固定出力化し、deuteron B（Step 7.9.1；CODATA質量欠損）からの R=1/α と r_t=2R(1−R/a_t) の整合チェックを併記。
  - 出力：`output/quantum/nuclear_np_scattering_baseline.png` / `output/quantum/nuclear_np_scattering_baseline_metrics.json`
- 更新：`doc/PRIMARY_SOURCES.md`（np散乱一次ソースを追加）
- 更新：`doc/ROADMAP.md`（Step 7.9.2 を【完了（初版）】へ）
- 更新：`doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`（現在地と次作業を更新）

実行：
- `python -B scripts/quantum/fetch_nuclear_np_scattering_sources.py`
- `python -B scripts/quantum/nuclear_np_scattering_baseline.py`

---

## 2026-01-25（UTC） Phase 7（量子）/ Step 7.9.3：原子核の最小有効方程式（square-well ansatz）を固定し、拘束と棄却条件を出力化

目的：
- Step 7.9（原子核）で “既存QMへφを代入しただけ” に見える攻撃を避けるため、Part I の基本変数 `u=ln(P/P0)` と核観測量（B, a_t, r_t …）の間に、再現可能な **最小の effective equation / uプロファイル拘束**を固定する。
- 「単純な ansatz class がどこで棄却されるか」を出力として残し、次の最小拡張（7.9.4）で任意関数fitに逃げない土台を作る。

変更：
- 追加：`scripts/quantum/nuclear_effective_potential_square_well.py`
  - deuteron `B`（CODATA）と np散乱 `a_t`（eq18/eq19）を拘束にし、2パラメータの square-well（`R,V0`）を決定。
  - `r_t` を予言し、eq18–eq19 の包絡に入らない（棄却例）ことを固定出力化。
  - 出力：`output/quantum/nuclear_effective_potential_square_well.png` / `output/quantum/nuclear_effective_potential_square_well_metrics.json`
- 追加：`doc/quantum/12_nuclear_effective_equation.md`（`u`→有効方程式→拘束→棄却条件の論理を固定）
- 更新：`doc/ROADMAP.md`（Step 7.9.3 を【完了（初版）】へ、次の 7.9.4（ansatz class 最小拡張）を追加）
- 更新：`doc/PRIMARY_SOURCES.md`（Step 7.9.3 の固定出力を追記）
- 更新：`doc/paper/12_part3_quantum.md`（4.2.7 に原子核（deuteron/np散乱）の位置づけを追加）
- 更新：`scripts/summary/paper_tables.py`（Table 1（Part III）に原子核行を追加）

実行：
- `python -B scripts/quantum/nuclear_effective_potential_square_well.py`
- `python -B scripts/summary/paper_tables.py`

---

## 2026-01-25（UTC） Phase 8（論文化）/ Step 8.2：Part III（量子）に原子核図を追加したため、図インデックス同期＋HTML再生成

目的：
- Part III（量子）に Step 7.9（原子核）の図を追加したため、publish の図番号リンクの安定性（figures index）を保つ。

変更：
- 更新：`doc/paper/01_figures_index.md`
  - `output/quantum/nuclear_binding_deuteron.png`
  - `output/quantum/nuclear_np_scattering_baseline.png`
  - `output/quantum/nuclear_effective_potential_square_well.png`
  を「量子（原子核）」として追記。

実行：
- `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`
  - `paper_lint` warnings=0 を確認。

---

## 2026-01-25（UTC） Phase 7（量子）/ Step 7.9.4：原子核 ansatz の最小拡張（core+well）を固定し、棄却条件を出力化

目的：
- Step 7.9.3（square-well）の棄却を踏まえ、ansatz class を **最小拡張**（core+well）し、「どこまでが拘束で、どこからが予言か」を固定出力として残す。
- 任意関数fit批判を避けるため、自由度は低パラメータに保ち、棄却されるなら棄却されること自体を成果物として凍結する。

変更：
- 追加：`scripts/quantum/nuclear_effective_potential_core_well.py`
  - hard-core + attractive well を用い、triplet を `(B,a_t,r_t)` で拘束し、`v2t` と singlet の `(r_s,v2s)` を予言して棄却条件を固定。
  - 出力：`output/quantum/nuclear_effective_potential_core_well.png` / `output/quantum/nuclear_effective_potential_core_well_metrics.json`
- 追加：`doc/quantum/13_nuclear_core_well_ansatz.md`（棄却例の位置づけ）
- 更新：`doc/ROADMAP.md`（Step 7.9.4 を【完了（初版；棄却例）】へ）
- 更新：`doc/paper/12_part3_quantum.md`（4.2.7 に反映）

実行：
- `python -B scripts/quantum/nuclear_effective_potential_core_well.py`

---

## 2026-01-25（UTC） Phase 7（量子）/ Step 7.9.5：finite repulsive core + well を導入し、退化/棄却まで固定（次の 2-range へ）

目的：
- Step 7.9.4 の棄却を踏まえ、repulsive core を hard-core（∞）ではなく有限 **Vc** として導入し、最小追加自由度で `v2` 系を救えるかを検証する。
- 残余自由度（任意性）を残さないため、triplet の追加目標（v2t）を用いた探索も含め、結果（退化/棄却）を固定出力として凍結する。

変更：
- 追加：`scripts/quantum/nuclear_effective_potential_finite_core_well.py`
  - finite core+well（`Rc,L,Vc,V0`）を実装し、deuteron B と np散乱（eq18/eq19）の拘束下で ansatz class を評価。
  - 結果：最適解が `Rc→0,Vc→0` に潰れて square-well 相当に退化し、singlet 予言 `(r_s,v2s)` は観測包絡に入らない（棄却）。
  - 出力：`output/quantum/nuclear_effective_potential_finite_core_well.png` / `output/quantum/nuclear_effective_potential_finite_core_well_metrics.json`
- 更新：`scripts/summary/paper_tables.py`（Table 1（量子）の原子核行を 7.9.5 metrics 優先へ）
- 更新：`doc/paper/12_part3_quantum.md`（4.2.7 を 7.9.5 まで反映し、次（7.9.6）へ繋ぐ）
- 更新：`doc/paper/01_figures_index.md`（finite core+well 図を追記）
- 更新：`doc/PRIMARY_SOURCES.md`（7.9.5 の固定出力 sha256 を追記）
- 更新：`doc/ROADMAP.md`（Step 7.9.5 を【完了（初版；退化/棄却例）】へ、次の Step 7.9.6（2-range）を追加）
- 追加：`doc/quantum/14_nuclear_finite_core_well_ansatz.md`（退化/棄却例の整理）
- 再生成：`python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`
  - `paper_lint` warnings=0 を確認。

実行：
- `python -B scripts/quantum/nuclear_effective_potential_finite_core_well.py`
- `python -B scripts/summary/paper_tables.py`
- `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`

---

## 2026-01-25（UTC） Phase 7（量子）/ Step 7.9.6：2-range（2段）ansatz を実装し、棄却条件を固定出力化

目的：
- Step 7.9.5（finite core+well）の退化/棄却を踏まえ、最小追加自由度として 2-range（2段）well を導入し、triplet/singlet を同時拘束した上で `v2` 系まで含む反証条件を固定する。
- 特に「singlet側が ad-hoc」という攻撃を避けるため、singlet は shared geometry/共有 `V1` の下で `a_s` のみを fit し、`(r_s,v2s)` を差分予測として扱う。

変更：
- 追加：`scripts/quantum/nuclear_effective_potential_two_range.py`
  - 2-range（2段）well を実装し、triplet を `(B,a_t,r_t,v2t)` で拘束、singlet は `a_s` で合わせて `(r_s,v2s)` を予言。
  - 結果：triplet は両datasetで目標をほぼ再現できるが、singlet 予言 `r_s` が観測包絡（eq18–eq19）から大きく外れ、ansatz class は棄却。
  - 出力：`output/quantum/nuclear_effective_potential_two_range.png` / `output/quantum/nuclear_effective_potential_two_range_metrics.json`
- 更新：`scripts/summary/paper_tables.py`（Table 1（量子）の原子核行を 7.9.6 metrics 優先へ）
- 更新：`doc/paper/12_part3_quantum.md`（4.2.7 に 7.9.6 を反映し、次（7.9.7）へ接続）
- 更新：`doc/paper/01_figures_index.md`（2-range 図を追記）
- 更新：`doc/PRIMARY_SOURCES.md`（7.9.6 の固定出力 sha256 を追記）
- 更新：`doc/ROADMAP.md`（Step 7.9.6 を【完了（初版；棄却例）】へ、次の Step 7.9.7 を追加）

実行：
- `python -B scripts/quantum/nuclear_effective_potential_two_range.py`
- `python -B scripts/summary/paper_tables.py`
- `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`

---

## 2026-01-25（UTC） Phase 7（量子）/ Step 7.9.7：2-range で singlet を `(a_s,r_s)` で拘束し、`v2s` を差分予測して棄却を固定

目的：
- Step 7.9.6（2-range；singlet を `a_s` のみで合わせる）の失敗が「singlet 側拘束が強すぎた」ことに起因するのかを切り分ける。
- singlet の自由度を最小限（`V1s,V2s`）だけ増やして `a_s,r_s` を合わせ、残る `v2s` を差分予測として評価する。

変更：
- 更新：`scripts/quantum/nuclear_effective_potential_two_range.py`
  - `--step 7.9.6/7.9.7` を追加し、7.9.7 では singlet を `a_s,r_s` で拘束して `v2s` を予言するモードを実装。
  - 出力（7.9.7）：`output/quantum/nuclear_effective_potential_two_range_fit_as_rs.png` / `output/quantum/nuclear_effective_potential_two_range_fit_as_rs_metrics.json`
  - 結果：両datasetで `a_s,r_s` は合わせられるが、予言 `v2s` が観測包絡（eq18–eq19）から外れ、2-range（純粋に attractive）は決定的に棄却。
- 更新：`scripts/summary/paper_tables.py`（Table 1（量子）の原子核行を 7.9.7 metrics 優先へ）
- 更新：`doc/paper/12_part3_quantum.md`（4.2.7 に 7.9.7 を反映し、次（7.9.8）へ接続）
- 更新：`doc/paper/01_figures_index.md`（7.9.7 図を追記）
- 更新：`doc/PRIMARY_SOURCES.md`（7.9.7 の固定出力 sha256 を追記；7.9.6 再現コマンドを `--step 7.9.6` に明示）
- 更新：`doc/ROADMAP.md`（Step 7.9.7 を【完了（初版；棄却例）】へ、次の Step 7.9.8 を追加）
- 再生成：`python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`
  - `paper_lint` warnings=0 を確認。

実行：
- `python -B scripts/quantum/nuclear_effective_potential_two_range.py --step 7.9.7`
- `python -B scripts/summary/paper_tables.py`
- `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`

---

## 2026-01-25（UTC） Phase 7（量子）/ Step 7.9.8：repulsive core + 2-range で `v2s` 符号救済を検証し、棄却を固定

目的：
- Step 7.9.7（2-range；`v2s>0`）の失敗が「純粋に attractive という符号構造の不足」に起因するかを切り分ける。
- 最小追加自由度として repulsive core を導入し、triplet/singlet の同時拘束の下で `v2s` を差分予測として評価する。

変更：
- 更新：`scripts/quantum/nuclear_effective_potential_two_range.py`
  - `--step 7.9.8` を追加し、repulsive core + 2-range（符号付きV）の伝播と、triplet の `(B,a_t,r_t,v2t)` 拘束＋singlet の `(a_s,r_s)` 拘束→`v2s` 予言を実装。
  - 出力（7.9.8）：`output/quantum/nuclear_effective_potential_repulsive_core_two_range.png` / `output/quantum/nuclear_effective_potential_repulsive_core_two_range_metrics.json`
  - 結果：repulsive core を入れても `v2s` は依然として正となり、観測包絡（eq18–eq19）から外れるため棄却（`envelope_ok(v2s)=no`）。
- 更新：`doc/ROADMAP.md`（Step 7.9.8 を【完了（初版；棄却例）】へ）
- 更新：`doc/paper/12_part3_quantum.md`（4.2.7 に 7.9.8 を反映）
- 更新：`doc/paper/01_figures_index.md`（7.9.8 図を追記）
- 更新：`doc/PRIMARY_SOURCES.md`（7.9.8 の固定出力 sha256 を追記）
- 更新：`scripts/summary/paper_tables.py`（Table 1（量子）の原子核行を 7.9.8 metrics 優先へ）
- 再生成：`python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`
  - `paper_lint` warnings=0 を確認。

実行：
- `python -B scripts/quantum/nuclear_effective_potential_two_range.py --step 7.9.8`
- `python -B scripts/summary/paper_tables.py`
- `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`

---

## 2026-01-25（UTC） Phase 7（量子）/ Step 7.10：量子測定（Born則・状態更新）の位置づけを初版として固定

目的：
- Phase 7 が “semi-classical（既存QMへφを代入しただけ）” と見なされないために、波動方程式→状態（ψ）→確率（Born則）→測定（状態更新）を **仮定列として固定**する。
- 以後（電磁気、原子・分子、物性、核力…）へ拡張する際の基準（何が導出で何が仮定か）を明確化する。

変更：
- 追加：`doc/quantum/15_quantum_measurement_born_rule.md`
  - Born則（|ψ|^2）と状態更新（条件付き更新）を「第一原理導出ではなく操作的仮定」として採用し、採用範囲・未解決点・反証点を固定。
- 追加：`scripts/quantum/quantum_measurement_born_rule.py`
  - 位置づけ図と要点の固定出力を追加。
  - 出力：`output/quantum/quantum_measurement_born_rule_flow.png` / `output/quantum/quantum_measurement_born_rule_metrics.json`
- 更新：`doc/paper/12_part3_quantum.md`
  - 2.5.2（Born則と状態更新）を追加し、publishで独立に読める最低限を担保。
- 更新：`doc/paper/01_figures_index.md`（測定の図を追記）
- 更新：`doc/PRIMARY_SOURCES.md`（固定出力 sha256 を追記）
- 更新：`doc/ROADMAP.md`（Step 7.10 を【完了（初版；仮定列の固定）】へ）
- 再生成：`python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`
  - `paper_lint` warnings=0 を確認。

実行：
- `python -B scripts/quantum/quantum_measurement_born_rule.py`
- `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`

---

## 2026-01-25（UTC） Phase 7（量子）/ Step 7.11：電磁気（電荷・Maxwell/光子）を最小導入し、初版として固定

目的：
- 原子・分子・物性へ進む前提として、電荷/電磁場（少なくとも静電場と光子）の位置づけを P-model 側で与える。
- “重力（P）以外の相互作用が未定義” という致命的攻撃点を、仮定列として固定して段階的に閉じる。

変更：
- 追加：`doc/quantum/16_electromagnetism_charge_maxwell_photon.md`
  - U(1)自由度（Aμ, E, B）を最小候補として導入し、Coulomb 1/r（静電場）と光子（偏光・エネルギー流）の位置づけを固定（第一原理導出は未主張）。
- 追加：`scripts/quantum/electromagnetism_minimal.py`
  - Coulomb vs 重力（p–e）のスケール確認と、最小位置づけの図を固定出力化。
  - 出力：`output/quantum/electromagnetism_minimal.png` / `output/quantum/electromagnetism_minimal_metrics.json`
- 更新：`doc/paper/12_part3_quantum.md`
  - 2.6（電磁気の最小位置づけ）を追加し、publishで独立に読める最低限を担保。
- 更新：`doc/paper/01_figures_index.md`（電磁気の図を追記）
- 更新：`doc/PRIMARY_SOURCES.md`（固定出力 sha256 を追記）
- 更新：`doc/ROADMAP.md`（Step 7.11 を【完了（初版；最小候補の固定）】へ）
- 再生成：`python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`
  - `paper_lint` warnings=0 を確認。

実行：
- `python -B scripts/quantum/electromagnetism_minimal.py`
- `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`

---

## 2026-01-25（UTC） Phase 7（量子）/ Step 7.12：原子・分子（原子スペクトル基準値；H I）を一次データで固定（初版）

目的：
- 原子・分子へ進む入口として、一次データ（原子スペクトル）を offline 再現できる形でキャッシュし、基準値（ターゲット）を固定する。
- 本Stepは「原子・分子の第一原理導出」を主張せず、Part III と Table 1 に接続できる最小の足場を確立する。

変更：
- 追加：`scripts/quantum/fetch_nist_asd_lines.py`
  - NIST ASD（lines1.pl）の line output を取得し、`data/quantum/sources/nist_asd_h_i_lines/` にキャッシュ（manifest＋抽出値）する。
- 追加：`scripts/quantum/atomic_hydrogen_baseline.py`
  - H I の代表遷移（Lyα/Hα/Hβ/Hγ）を基準値として固定出力化。
  - 出力：`output/quantum/atomic_hydrogen_baseline.png` / `output/quantum/atomic_hydrogen_baseline_metrics.json`
- 追加：`doc/quantum/17_atomic_molecular_baseline.md`（Step 7.12 の到達点と次の拡張を明文化）
- 更新：`scripts/summary/paper_tables.py`（Table 1（量子）へ「原子・分子（基準値）」行を追加）
- 更新：`doc/paper/12_part3_quantum.md`（4.2.8 に原子スペクトル基準値（H I）を追記）
- 更新：`doc/paper/01_figures_index.md`（原子・分子の図を追記）
- 更新：`doc/paper/20_data_sources.md`（量子の一次ソースに NIST ASD を追記）
- 更新：`doc/PRIMARY_SOURCES.md`（Step 7.12 の一次ソースと固定出力 sha256 を追記）
- 更新：`doc/ROADMAP.md`（Step 7.12 を【完了（初版；一次データ固定＋基準値出力）】へ）
- 再生成：`python -B scripts/summary/paper_build.py --profile (paper|part2_astrophysics|part3_quantum) --mode publish --outdir output/summary --skip-docx`
  - `paper_lint` warnings=0 を確認。

実行：
- `python -B scripts/quantum/fetch_nist_asd_lines.py --spectra "H I"`
- `python -B scripts/quantum/atomic_hydrogen_baseline.py`
- `python -B scripts/summary/paper_build.py --profile paper --mode publish --outdir output/summary --skip-docx`
- `python -B scripts/summary/paper_build.py --profile part2_astrophysics --mode publish --outdir output/summary --skip-docx`
- `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`

---

## 2026-01-25（UTC） Phase 7（量子）/ Step 7.12：原子スペクトル（He I）を追加固定し、Part III の独立性を強化

目的：
- Step 7.12 の「最小ケース」を H I だけでなく He I（多電子）まで拡張し、量子編の入口をより攻撃耐性の高い形へ整備する。

変更：
- 更新：`scripts/quantum/fetch_nist_asd_lines.py`（He I の基準遷移（可視域）を `selected_lines` として抽出する targets を追加）
- 固定（一次データ；He I）：`python -B scripts/quantum/fetch_nist_asd_lines.py --spectra "He I"`
  - 保存先：`data/quantum/sources/nist_asd_he_i_lines/manifest.json` / `extracted_values.json` / `nist_asd_lines__he_i__format3__obs_ritz_unc.tsv`
- 追加：`scripts/quantum/atomic_helium_baseline.py`
  - He I の代表遷移（4本）を基準値として固定出力化。
  - 出力：`output/quantum/atomic_helium_baseline.png` / `output/quantum/atomic_helium_baseline_metrics.json`
- 更新：`doc/quantum/17_atomic_molecular_baseline.md`（He I の取得・固定出力を追記）
- 更新：`scripts/summary/paper_tables.py`（Table 1（量子）へ He I 行を追加）
- 更新：`doc/paper/12_part3_quantum.md`（4.2.8 を H I/He I に拡張）
- 更新：`doc/paper/01_figures_index.md`（He I 図を追記）
- 更新：`doc/paper/20_data_sources.md`（NIST ASD のローカルキャッシュを H I/He I へ拡張）
- 更新：`doc/PRIMARY_SOURCES.md`（He I の一次ソースと固定出力 sha256 を追記）
- 更新：`doc/paper/30_references.md`（引用キー `[NISTASDLines]` を追加し、paper_lint を通す）
- 更新：`doc/ROADMAP.md`（Step 7.12 の固定項目に He I を追記）
- 再生成：`python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`
  - `paper_lint` errors=0 を確認。

実行：
- `python -B scripts/quantum/fetch_nist_asd_lines.py --spectra "He I"`
- `python -B scripts/quantum/atomic_helium_baseline.py`
- `python -B scripts/summary/paper_tables.py`
- `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`

---

## 2026-01-25（UTC） Phase 7（量子）/ Step 7.12：分子（H2）の一次データを固定し、Part III/Table 1 へ接続

目的：
- 原子（H I/He I）に続き、分子（H2）についても一次データ（分子定数）を offline 再現できる形でキャッシュし、基準値（ターゲット）を固定する。
- 「分子（化学結合）の入口」を、宇宙論と同じ型（一次データ→固定出力→Table 1→本文）で運用できる状態にする。

変更：
- 追加：`scripts/quantum/fetch_nist_webbook_diatomic_constants.py`
  - NIST Chemistry WebBook “Constants of diatomic molecules”（Huber & Herzberg compilation）を取得し、`data/quantum/sources/nist_webbook_diatomic_h2/` にキャッシュ（manifest＋抽出値＋HTML）する。
- 追加：`scripts/quantum/molecular_h2_baseline.py`
  - H2（ground state）の分子定数（ωe/ωe x_e/B_e/α_e/D_e/r_e）を基準値として固定出力化。
  - 出力：`output/quantum/molecular_h2_baseline.png` / `output/quantum/molecular_h2_baseline_metrics.json`
- 更新：`scripts/summary/paper_tables.py`（Table 1（量子）へ「H2 分子定数（基準値）」行を追加）
- 更新：`doc/paper/12_part3_quantum.md`（4.2.8 を H I/He I/H2 に拡張）
- 更新：`doc/paper/30_references.md`（引用キー `[NISTWebBookDiatomic]` を追加し、paper_lint を通す）
- 更新：`doc/paper/20_data_sources.md`（NIST WebBook のローカルキャッシュを追記）
- 更新：`doc/paper/01_figures_index.md`（H2 図を追記）
- 更新：`doc/quantum/17_atomic_molecular_baseline.md`（H2 の取得・固定出力を追記）
- 更新：`doc/PRIMARY_SOURCES.md`（H2 の一次ソースと固定出力 sha256 を追記）
- 更新：`doc/ROADMAP.md`（Step 7.12 の固定項目に H2 を追記）
- 再生成：`python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`
  - `paper_lint` errors=0 / warnings=0 を確認。
- QC：`python -B scripts/summary/paper_qc.py`
  - publish成果物の lint strict / 図番号 / `\\\\` 混入なし等を確認。

実行：
- `python -B scripts/quantum/fetch_nist_webbook_diatomic_constants.py --id C1333740 --slug h2`
- `python -B scripts/quantum/molecular_h2_baseline.py`
- `python -B scripts/summary/paper_tables.py`
- `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`
- `python -B scripts/summary/paper_qc.py`

---

## 2026-01-25（UTC） Phase 7（量子）/ Step 7.12：分子遷移（一次線リスト；ExoMol）を一次固定し、代表遷移セットを固定

目的：
- Step 7.12（原子・分子）を「分子定数/結合エネルギー」から一段進め、**遷移（一次線リスト）**を一次データで固定する。
- 将来の再導出（束縛・準位・遷移）で一致させるべき「観測ターゲット（代表遷移）」を、恣意性の少ない規則（Einstein A の大きい順 topN）で固定する。

変更：
- 追加：`scripts/quantum/fetch_exomol_diatomic_line_lists.py`
  - ExoMol line list（states/trans/pf）を一次ソースとして取得し、`data/quantum/sources/exomol_*/` に dataset page + raw + manifest をキャッシュ（offline 再現）。
- 追加：`scripts/quantum/molecular_transitions_exomol_baseline.py`
  - ExoMol line list（H2: RACPPK / HD: ADJSAAM）から Einstein A の大きい順 top10 を抽出し、代表遷移（波数 ν̃ と A）を固定出力化。
  - 出力：`output/quantum/molecular_transitions_exomol_baseline.png` / `..._metrics.json` / `..._selected.csv`
- 更新：`scripts/summary/paper_tables.py`
  - Table 1（量子）へ「分子遷移（ExoMol；代表遷移）」行を追加。
- 更新：`doc/quantum/17_atomic_molecular_baseline.md` / `doc/ROADMAP.md` / `doc/PRIMARY_SOURCES.md`
  - Step 7.12 の一次データ固定（遷移）と、固定出力（代表遷移）を明文化し、sha256 を追記。
- 更新：`doc/paper/12_part3_quantum.md`（4.2.8）/ `doc/paper/20_data_sources.md` / `doc/paper/30_references.md` / `doc/paper/01_figures_index.md`
  - Part III へ ExoMol line list と代表遷移の固定出力を接続（D2 は別ソースが必要なため継続タスクとして明記）。

再生成：
- `python -B scripts/summary/paper_tables.py`
- `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`
- `python -B scripts/summary/paper_qc.py`

実行：
- `python -B scripts/quantum/fetch_exomol_diatomic_line_lists.py`
- `python -B scripts/quantum/molecular_transitions_exomol_baseline.py`
- `python -B scripts/summary/paper_tables.py`
- `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`
- `python -B scripts/summary/paper_qc.py`

---

## 2026-01-25（UTC） Phase 7（量子）/ Step 7.12：熱化学（thermochemistry）で解離エンタルピー（298 K）を独立ベースラインとして固定

目的：
- 分子束縛の「結合エネルギー」について、分光定数（ωe, B_e 等）とは独立な一次ソースとして、NIST WebBook の gas phase thermochemistry（ΔfH°gas）をキャッシュし、解離エンタルピー（298 K）を固定する。
- 分子編が「分光定数だけ」になってしまう攻撃点を塞ぎ、Part III/Table 1 の入力I/F（一次データ→固定出力→指標）に結合エネルギーの独立ベースラインを追加する。

変更：
- 追加：`scripts/quantum/fetch_nist_webbook_thermochemistry.py`
  - NIST WebBook の thermochemistry（Thermo-Gas）セクションから、ΔfH°（kJ/mol）を抽出・キャッシュする（ΔfH 行が無い場合は Shomate 表の H を使用）。
  - 保存先：`data/quantum/sources/nist_webbook_thermo_<slug>/manifest.json` / `extracted_values.json`
- 追加：`scripts/quantum/molecular_dissociation_thermochemistry.py`
  - ΔfH°gas（298 K）から解離エンタルピー（298 K）を算出し、固定出力化（H2/HD/D2）。
  - 出力：`output/quantum/molecular_dissociation_thermochemistry.png` / `output/quantum/molecular_dissociation_thermochemistry_metrics.json`
- 更新：`scripts/summary/paper_tables.py`（Table 1（量子）へ「分子 解離エンタルピー（298 K）」行を追加）
- 更新：`doc/paper/12_part3_quantum.md`（4.2.8 に thermochemistry を追記）
- 更新：`doc/paper/30_references.md`（引用キー `[NISTWebBookThermo]` を追加し、paper_lint を通す）
- 更新：`doc/paper/20_data_sources.md` / `doc/paper/01_figures_index.md` / `doc/quantum/17_atomic_molecular_baseline.md` / `doc/PRIMARY_SOURCES.md` / `doc/ROADMAP.md`
- 再生成：`python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`
  - `paper_lint` errors=0 / warnings=0 を確認。
- QC：`python -B scripts/summary/paper_qc.py`

実行：
- `python -B scripts/quantum/fetch_nist_webbook_thermochemistry.py --id C12385136 --slug h_atom`
- `python -B scripts/quantum/fetch_nist_webbook_thermochemistry.py --id C16873179 --slug d_atom`
- `python -B scripts/quantum/fetch_nist_webbook_thermochemistry.py --id C1333740 --slug h2`
- `python -B scripts/quantum/fetch_nist_webbook_thermochemistry.py --id C13983205 --slug hd`
- `python -B scripts/quantum/fetch_nist_webbook_thermochemistry.py --id C7782390 --slug d2`
- `python -B scripts/quantum/molecular_dissociation_thermochemistry.py`
- `python -B scripts/summary/paper_tables.py`
- `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`
- `python -B scripts/summary/paper_qc.py`

---

## 2026-01-25（UTC） Phase 7（量子）/ Step 7.12：同位体（HD, D2）を追加固定し、縮約質量スケーリングを固定出力化

目的：
- Step 7.12（分子）の「同位体依存」を一次データとして固定し、将来の再導出で“恣意fit”を避けるための系統制約（縮約質量スケーリング）を追加する。
- 分子の「結合エネルギー」へ進む前に、まず分子定数（ωe, B_e 等）の同位体系統を固定し、反証条件（何が破れたら棄却か）へ繋ぐ足場を増やす。

変更：
- 固定（一次データ；HD）：`python -B scripts/quantum/fetch_nist_webbook_diatomic_constants.py --id C13983205 --slug hd`
  - 保存先：`data/quantum/sources/nist_webbook_diatomic_hd/manifest.json` / `extracted_values.json` / `nist_webbook_diatomic_constants__hd__c13983205.html`
- 固定（一次データ；D2）：`python -B scripts/quantum/fetch_nist_webbook_diatomic_constants.py --id C7782390 --slug d2`
  - 保存先：`data/quantum/sources/nist_webbook_diatomic_d2/manifest.json` / `extracted_values.json` / `nist_webbook_diatomic_constants__d2__c7782390.html`
- 更新：`scripts/quantum/molecular_h2_baseline.py`
  - `--slug` 対応（h2/hd/d2）とし、同一I/Fで分子定数の固定出力を追加。
  - 併せて Morse の D0/De 推定（ωe, ωe x_e からの現象論的導出）を **derived** として同梱（独立データではない旨を明記）。
- 追加：`scripts/quantum/molecular_isotopic_scaling.py`
  - 縮約質量 μ に対する ωe∝μ^{-1/2}, B_e∝μ^{-1} の整合（mass-number近似）を ratio として固定出力化。
  - 出力：`output/quantum/molecular_isotopic_scaling.png` / `output/quantum/molecular_isotopic_scaling_metrics.json`
- 更新：`scripts/summary/paper_tables.py`（Table 1（量子）へ HD/D2 行を追加）
- 更新：`doc/paper/12_part3_quantum.md`（4.2.8 を H2/HD/D2 + 同位体スケーリング図へ拡張）
- 更新：`doc/paper/01_figures_index.md` / `doc/paper/20_data_sources.md` / `doc/quantum/17_atomic_molecular_baseline.md` / `doc/PRIMARY_SOURCES.md` / `doc/ROADMAP.md`
- 再生成：`python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`
  - `paper_lint` errors=0 / warnings=0 を確認。
- QC：`python -B scripts/summary/paper_qc.py`

実行：
- `python -B scripts/quantum/fetch_nist_webbook_diatomic_constants.py --id C13983205 --slug hd`
- `python -B scripts/quantum/fetch_nist_webbook_diatomic_constants.py --id C7782390 --slug d2`
- `python -B scripts/quantum/molecular_h2_baseline.py --slug h2`
- `python -B scripts/quantum/molecular_h2_baseline.py --slug hd`
- `python -B scripts/quantum/molecular_h2_baseline.py --slug d2`
- `python -B scripts/quantum/molecular_isotopic_scaling.py`
- `python -B scripts/summary/paper_tables.py`
- `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`
- `python -B scripts/summary/paper_qc.py`

---

## 2026-01-25（UTC） Phase 7（量子）/ Step 7.12：分光学的解離エネルギー D0（0 K）を一次固定し、結合エネルギーの独立ベースラインを追加

目的：
- 分子束縛が「分子定数（ωe, B_e 等）」だけだと攻撃点になるため、結合エネルギーの独立ベースラインとして **分光学的解離エネルギー D0（0 K）** を一次ソースで固定する。
- 298 K の熱化学（解離エンタルピー）とは別系統として D0 を固定し、将来の P-model 再導出で「どこを一致させるか」を明確にする。

変更：
- 追加：`scripts/quantum/fetch_molecular_dissociation_d0_spectroscopic.py`
  - 高精度分光（ionization→D0）の一次ソースを取得し、`data/quantum/sources/molecular_dissociation_d0_spectroscopic/` に manifest＋抽出値＋raw（PDF/HTML）をキャッシュ。
- 追加：`scripts/quantum/molecular_dissociation_d0_spectroscopic.py`
  - D0（0 K）の基準値を PNG＋metrics として固定出力化：`output/quantum/molecular_dissociation_d0_spectroscopic.png` / `..._metrics.json`
- 更新：`scripts/summary/paper_tables.py`
  - Table 1（量子）へ「分光学的解離エネルギー D0（0 K）」行を追加。
- 更新：`doc/paper/12_part3_quantum.md`（4.2.8）/ `doc/paper/20_data_sources.md` / `doc/paper/30_references.md` / `doc/paper/01_figures_index.md`
  - D0（0 K）を一次ソースと固定出力に接続し、298 K 熱化学との差（別ベースライン）を明文化。
- 更新：`doc/PRIMARY_SOURCES.md` / `doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`
  - Step 7.12 の「一次データ固定」と「次の拡張（遷移＝一次線リスト）」の現在地を更新。

再生成：
- `python -B scripts/summary/paper_tables.py`
- `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`
- `python -B scripts/summary/paper_qc.py`

実行：
- `python -B scripts/quantum/fetch_molecular_dissociation_d0_spectroscopic.py`
- `python -B scripts/quantum/molecular_dissociation_d0_spectroscopic.py`
- `python -B scripts/summary/paper_tables.py`
- `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`
- `python -B scripts/summary/paper_qc.py`


---

## 2026-01-25（UTC） Phase 7（量子）/ Step 7.12：同位体質量（NIST）を一次固定し、縮約質量スケーリングを精密化

目的：
- Step 7.12（分子）の同位体依存（縮約質量 μ）を、mass-number近似（H=1, D=2）ではなく一次ソースに基づく同位体質量で評価できるようにする。
- 将来の分子束縛再導出で「同位体系統がズレる／追加自由度で恣意fitする」攻撃点を、データI/F（一次→固定出力）側で先に塞ぐ。

変更：
- 追加：`scripts/quantum/fetch_nist_isotopic_compositions.py`
  - NIST Atomic Weights and Isotopic Compositions（stand_alone.pl）を取得し、同位体質量（relative atomic mass）を `data/quantum/sources/nist_isotopic_compositions_h/` にキャッシュ（manifest＋抽出値＋HTML）する。
- 更新：`scripts/quantum/molecular_isotopic_scaling.py`
  - NIST 同位体質量（H1, D2）がキャッシュされている場合はそれを優先して μ を計算し、無い場合は mass-number近似へフォールバックする。
  - metrics に `mass_model`（ソースURL/sha256/採用質量）を同梱し、解析I/Fとして凍結する。
- 更新：`doc/paper/12_part3_quantum.md`（4.2.8 に同位体質量の一次ソースを追加）
- 更新：`doc/paper/20_data_sources.md` / `doc/paper/30_references.md`（引用キー `[NISTIsotopicCompositions]` を追加）
- 更新：`doc/quantum/17_atomic_molecular_baseline.md` / `doc/ROADMAP.md` / `doc/PRIMARY_SOURCES.md`
- 再生成：`python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`
  - `paper_lint` errors=0 / warnings=0 を確認。
- QC：`python -B scripts/summary/paper_qc.py`（ok=True）

実行：
- `python -B scripts/quantum/fetch_nist_isotopic_compositions.py --element H`
- `python -B scripts/quantum/molecular_isotopic_scaling.py`
- `python -B scripts/summary/paper_tables.py`
- `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`
- `python -B scripts/summary/paper_qc.py`

## 2026-01-26（UTC） Phase 7（量子）/ Step 7.12：D2 の遷移（一次線リスト）一次ソースを MOLAT で確定し、代表遷移を固定出力化

目的：
- Step 7.12（分子）の「遷移（一次線リスト）」で D2 が欠けた状態だと、同位体系列が不完全になり“恣意fit”の攻撃点になるため、公開一次ソースから D2 の線リストを固定する。
- 宇宙論と同型（一次データ→固定出力→Table 1→本文）で、D2 も同一I/Fへ統合する。

変更：
- 追加：`scripts/quantum/fetch_molat_d2_fuv_emission_lines.py`
  - MOLAT（OBSPM）の D2 FUV emission line lists（transition energies + A；ARLSJ1999）を取得し、`data/quantum/sources/molat_d2_fuv_emission_arlsj1999/` に manifest＋抽出値＋raw（HTML）＋抽出（pre）をキャッシュ。
- 更新：`scripts/quantum/molecular_transitions_exomol_baseline.py`
  - H2/HD（ExoMol）に加え、D2（MOLAT）を同じ固定出力へ統合（代表遷移：Einstein A top10）。
  - 出力：`output/quantum/molecular_transitions_exomol_baseline.png` / `..._metrics.json` / `..._selected.csv`
- 更新：`scripts/summary/paper_tables.py`
  - Table 1（量子）の「分子 遷移（一次線リスト；代表遷移）」を ExoMol + MOLAT として表記し、ν̃レンジ表示の桁を改善。
- 更新：`doc/paper/12_part3_quantum.md`（4.2.8；D2 遷移の一次ソースを MOLAT として明記）
- 更新：`doc/paper/20_data_sources.md` / `doc/paper/30_references.md` / `doc/paper/01_figures_index.md`
  - 引用キー `[MOLATD2ARLSJ1999]` / `[ARLSJ1999]` を追加。
- 更新：`doc/PRIMARY_SOURCES.md`（sha256 追記／固定出力 sha256 更新）
- 更新：`doc/ROADMAP.md`（Step 7.12 の D2 遷移を MOLAT で確定）

再生成：
- `python -B scripts/summary/paper_tables.py`
- `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`
- `python -B scripts/summary/paper_qc.py`

実行：
- `python -B scripts/quantum/fetch_molat_d2_fuv_emission_lines.py`
- `python -B scripts/quantum/molecular_transitions_exomol_baseline.py`
- `python -B scripts/summary/paper_tables.py`
- `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`
- `python -B scripts/summary/paper_qc.py`

## 2026-01-26（UTC） Phase 8（論文化）/ Step 8.2：Part III（量子）の査読耐性を強化（Schr の可視化／Bellのaccidental批判への防衛／decoherence差別化）

目的：
- 量子物理学者が Abstract/Introduction の段階で離脱する攻撃（「Schr がない」「ただの重力モデル」）を封じる。
- Bell の window sweep が “accidental coincidence を拾っただけ（p-hacking）” と見なされる攻撃に対し、自然窓（客観基準）の固定と説明を強化する。
- 「重力誘起デコヒーレンス」が Penrose–Diósi 型の collapse model と混同され、既存制約の巻き添えで棄却される攻撃を避ける。

変更：
- 更新：`doc/paper/12_part3_quantum.md`
  - Abstract/Introduction に Schr 整合（2.5.1）を明示。
  - Bell 節で natural window（客観基準）と p-hacking 回避の立場を明確化（NIST: trial照合、Weihs/Kwiat: dtピークの背景差し引き＋drift）。
  - 重力誘起デコヒーレンスを「dephasing」として位置づけ、collapse model（Penrose–Diósi 等）と区別し、代表的制約の参照を追加。
- 更新：`doc/paper/01_figures_index.md`
  - Bell 横断まとめ図のキャプションに「dtピークの背景差し引き＝accidental proxy / trial照合」を追記。
- 更新：`doc/paper/30_references.md`
  - 引用キー `[Diosi1987]` / `[Penrose1996StateReduction]` / `[Donadi2020UndergroundCollapse]` を追加。
- 更新：`doc/PRIMARY_SOURCES.md`
  - 上記3件を DOI 参照として追記（paywallの可能性；未キャッシュ）。
- 更新：`doc/ROADMAP.md`
  - Step 7.6.3（collapse modelとの区別＋既存制約の位置づけ）を「完了（初版）」として追記。

再生成：
- `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`
- `python -B scripts/summary/paper_qc.py`

実行：
- `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`
- `python -B scripts/summary/paper_qc.py`

## 2026-01-26（UTC） Phase 8（論文化）/ Step 8.2：Part I（コア理論）の査読耐性を強化（Pの操作的定義／δの最小拡張／静的ポアソン）

目的：
- 「P の物理的実体が未定義」「P/P0 だけは物理でない」という攻撃に対し、Part I の範囲で成立する操作的定義を明記する。
- 「速度飽和 δ が ad hoc」という攻撃に対し、第一原理未提示であることを隠さず、Padé-like な最小拡張として位置づける。
- 「場の方程式がない」という攻撃に対し、静的弱場での最小方程式（ポアソン型）を仮定として固定する（真空ではラプラス）。

変更：
- 更新：`doc/paper/10_part1_core_theory.md`
  - 2.1 に P の操作的定義（標準時計の進み）と、次元/絶対値の扱い（比のみで閉じる）を追記。
  - 2.2 に 静的弱場のポアソン型方程式（真空ではラプラス）を最小仮定として追記。
  - 2.3 の δ を Padé-like な最小拡張（現象論）として位置づけ、凍結出力への接続を追記。

再生成：
- `python -B scripts/summary/paper_build.py --profile paper --mode publish --outdir output/summary --skip-docx`
- `python -B scripts/summary/paper_qc.py`

## 2026-01-26（UTC） Phase 7（量子）/ Step 7.12：H I の fine structure multiplet（Hα/Hβ）を観測ターゲットとして固定

目的：
- 「単線だけ都合よく選んだ」「fine structure を無視している」攻撃を避けるため、H I の代表線について multiplet の範囲（min–max）と本数 N を一次ソース（NIST ASD）の raw TSV から機械抽出し、固定出力へ同梱する。
- Step 7.12 の拡張（hyperfine/QED精密）へ進む前に、まず “fine structure は基準値（ターゲット）として固定済み” の状態にする。

変更：
- 更新：`scripts/quantum/atomic_hydrogen_baseline.py`
  - raw TSV（NIST ASD line output）を読み込み、obs_nu present + Type empty（E1）+ Aki present の行だけを用いて、Lyα/Hα/Hβ/Hγ 近傍の multiplet（観測ターゲット）の範囲と本数 N を `output/quantum/atomic_hydrogen_baseline_metrics.json` に固定（parameters と filter を同梱）。
- 更新：`scripts/summary/paper_tables.py`
  - Table 1（量子）の H I 行に、Hα/Hβ の multiplet 範囲と N を追記。
- 更新：`doc/paper/12_part3_quantum.md`（4.2.8 に fine structure target を追記）
- 更新：`doc/quantum/17_atomic_molecular_baseline.md` / `doc/ROADMAP.md` / `doc/PRIMARY_SOURCES.md`（固定出力 sha256 更新）

再生成：
- `python -B scripts/quantum/atomic_hydrogen_baseline.py`
- `python -B scripts/summary/paper_tables.py`
- `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`
- `python -B scripts/summary/paper_build.py --profile paper --mode publish --outdir output/summary --skip-docx`
- `python -B scripts/summary/paper_qc.py`

## 2026-01-26（UTC） Phase 7（量子）/ Step 7.12：H I hyperfine（21 cm）を一次固定し、基準値出力へ統合

目的：
- 「原子・分子を扱うなら、fine/hyperfine の基準値（ターゲット）を固定しないと恣意選別に見える」攻撃を避けるため、H I 基底の hyperfine（21 cm）を一次ソースで固定し、再現可能なターゲットとして出力へ統合する。
- Step 7.12 の “基準値固定” を強化し、次段階（追加QED精密の一次固定 → 束縛の再導出）へ繋ぐ。

変更：
- 追加：`scripts/quantum/fetch_nist_atspec_handbook.py`
  - NIST AtSpec（AtSpec.PDF）を `data/quantum/sources/nist_atspec_handbook/` へキャッシュし、H I 21 cm の周波数（括弧付き不確かさ）を機械抽出して `extracted_values.json` に固定。
- 追加：`scripts/quantum/atomic_hydrogen_hyperfine_baseline.py`
  - 21 cm の基準値（f, λ, fractional σ）を `output/quantum/atomic_hydrogen_hyperfine_baseline_metrics.json` と図に固定。
- 更新：`scripts/summary/paper_tables.py`
  - Table 1（量子）に H I hyperfine（21 cm）の行を追加（基準値ターゲットとして固定）。
- 更新：`doc/paper/12_part3_quantum.md`（4.2.8 に 21 cm を追記）
- 更新：`doc/paper/01_figures_index.md`（図一覧へ追加）
- 更新：`doc/paper/20_data_sources.md` / `doc/paper/30_references.md`（参照追加）
- 更新：`doc/PRIMARY_SOURCES.md`（一次ソースと固定出力の sha256 を追記）
- 更新：`doc/ROADMAP.md` / `doc/quantum/17_atomic_molecular_baseline.md`（Step 7.12 の到達点メモ更新）

再生成：
- `python -B scripts/quantum/fetch_nist_atspec_handbook.py`
- `python -B scripts/quantum/atomic_hydrogen_hyperfine_baseline.py`
- `python -B scripts/summary/paper_tables.py`
- `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`
- `python -B scripts/summary/paper_build.py --profile paper --mode publish --outdir output/summary --skip-docx`
- `python -B scripts/summary/paper_qc.py`

実行：
- `python -B scripts/quantum/fetch_nist_atspec_handbook.py`
- `python -B scripts/quantum/atomic_hydrogen_hyperfine_baseline.py`
- `python -B scripts/summary/paper_tables.py`
- `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`
- `python -B scripts/summary/paper_build.py --profile paper --mode publish --outdir output/summary --skip-docx`
- `python -B scripts/summary/paper_qc.py`

## 2026-01-26（UTC） Phase 8（論文化）/ Part I（コア理論）：凍結値の明示・参照追加・目次整理

目的：
- Part I を「基準書」として読みやすくし、査読で狙われやすい点（凍結値の所在、強場の未固定、参照不足、目次の冗長）を先回りで潰す。

変更：
- 更新：`doc/paper/10_part1_core_theory.md`
  - 3.3 に β/δ の凍結値（実値）と参照先（`output/theory/frozen_parameters.json`）を追記（本文の既定は β=1、数値は凍結値を採用）。
  - 2.6 に「強場での方程式形は未固定（Part II の課題）」を追記し、弱場優先の立場を明確化。
  - EHT / Peters–Mathews / 二重パルサーの参照を本文に付与。
- 更新：`doc/paper/30_references.md`
  - EHT（M87, Sgr A*）と二重パルサー（B1913+16）の表記を整理（不要な arXiv 表記を削除して DOI/誌情報を優先）。
- 更新：`scripts/summary/paper_html.py`
  - グローバル目次の単独「本文」を除外（本文内部の目次（details）を正とする）。

再生成：
- `python -B scripts/summary/paper_build.py --profile paper --mode publish --outdir output/summary --skip-docx`
- `python -B scripts/summary/paper_build.py --profile part2_astrophysics --mode publish --outdir output/summary --skip-docx --skip-tables`
- `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx --skip-tables`
- `python -B scripts/summary/paper_qc.py`

実行：
- `python -B scripts/summary/paper_build.py --profile paper --mode publish --outdir output/summary --skip-docx`
- `python -B scripts/summary/paper_build.py --profile part2_astrophysics --mode publish --outdir output/summary --skip-docx --skip-tables`
- `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx --skip-tables`
- `python -B scripts/summary/paper_qc.py`

実行：
- `python -B scripts/quantum/atomic_hydrogen_baseline.py`
- `python -B scripts/summary/paper_tables.py`
- `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`
- `python -B scripts/summary/paper_build.py --profile paper --mode publish --outdir output/summary --skip-docx`
- `python -B scripts/summary/paper_qc.py`

## 2026-01-26（UTC） Phase 7（量子）/ Step 7.8：H 1S–2S を一次固定し、QED精密（safety check）を強化

目的：
- 「量子重力理論を名乗るなら、既知の QED 精密（束縛分光）と矛盾していないことを示せ」という致命的攻撃に対し、代表的な精密ベンチマーク（H 1S–2S）を一次ソースで固定し、原子スケールの重力写像が直ちに破綻しない（桁で安全）ことを機械可読の出力として同梱する。
- Step 7.12（原子・分子）の拡張（hyperfine/QED精密）へ進む前に、少なくとも「1S–2S は固定済み」の状態にする。

変更：
- 更新：`scripts/quantum/fetch_qed_vacuum_precision_sources.py`
  - arXiv:1107.3101v1（Parthey et al. 2011; H 1S–2S）を一次ソースとして追加取得し、`data/quantum/sources/arxiv_1107.3101v1.pdf` へキャッシュ。
- 更新：`scripts/quantum/qed_vacuum_precision.py`
  - PDF から `f_{1S-2S}=2466061413187035(10) Hz` を機械抽出し、`output/quantum/qed_vacuum_precision_metrics.json` に固定（fractional σ、hσ[eV]、ΔE_grav(H) との比を同梱）。
  - 図注に `hσ / ΔE_grav(H)` のスケール差を追記。
- 更新：`scripts/summary/paper_tables.py`
  - Table 1（量子）の「真空・QED精密」行に H 1S–2S の精密ベンチマークを追記。
- 更新：`doc/paper/12_part3_quantum.md`（4.2.6 に H 1S–2S を追記）
- 更新：`doc/paper/20_data_sources.md` / `doc/paper/30_references.md` / `doc/PRIMARY_SOURCES.md` / `doc/ROADMAP.md` / `doc/quantum/11_qed_vacuum_precision.md` / `doc/quantum/17_atomic_molecular_baseline.md`

再生成：
- `python -B scripts/quantum/fetch_qed_vacuum_precision_sources.py`
- `python -B scripts/quantum/qed_vacuum_precision.py`
- `python -B scripts/summary/paper_tables.py`
- `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`
- `python -B scripts/summary/paper_build.py --profile paper --mode publish --outdir output/summary --skip-docx`
- `python -B scripts/summary/paper_qc.py`

## 2026-01-26（UTC） Phase 7（量子）/ Step 7.8：α（原子反跳 vs 電子 g-2）を一次PDFから機械抽出し、QED精密クロスチェックを固定

目的：
- 「QED精密（g-2 等）と矛盾しないか？」攻撃に対し、H 1S–2S に加えて、微細構造定数 α の独立決定（原子反跳 vs 電子 g-2）を一次ソースPDFから機械抽出して固定し、入口の頑健性（差分と z-score）を明文化する。
- 量子（Phase 7）を宇宙論と同じ水準（一次固定＋不確かさ＋反証条件）へ近づけるため、精密量の参照を「手入力」ではなく「一次PDF→抽出」で担保する。

変更：
- 更新：`scripts/quantum/fetch_qed_vacuum_precision_sources.py`
  - 一次ソースを追加（arXiv:0812.3139v1（α: recoil）, arXiv:0801.1134v2（α: e− g-2））し、`data/quantum/sources/qed_vacuum_precision_manifest.json` に統合。
- 更新：`scripts/quantum/qed_vacuum_precision.py`
  - 両PDFから `α^{-1}` を機械抽出し、差分と z-score、解釈パラメータ（recoil の ε）を `output/quantum/qed_vacuum_precision_metrics.json` に固定。
  - 図 `output/quantum/qed_vacuum_precision.png` に α クロスチェックのパネルを追加。
- 更新：`scripts/summary/paper_tables.py`
  - Table 1（量子）の「真空・QED精密」行へ α の差分（z-score）を追記。
- 更新：`doc/paper/12_part3_quantum.md`（4.2.6 に α クロスチェックの一文を追記）
- 更新：`doc/quantum/11_qed_vacuum_precision.md`（2c を追加）
- 更新：`doc/ROADMAP.md`（Step 7.8 に 7.8.5（α）を追加）

再生成：
- `python -B scripts/quantum/fetch_qed_vacuum_precision_sources.py`
- `python -B scripts/quantum/qed_vacuum_precision.py`
- `python -B scripts/summary/paper_tables.py`
- `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`
- `python -B scripts/summary/paper_build.py --profile paper --mode publish --outdir output/summary --skip-docx`
- `python -B scripts/summary/paper_qc.py`

実行：
- `python -B scripts/quantum/fetch_qed_vacuum_precision_sources.py`
- `python -B scripts/quantum/qed_vacuum_precision.py`
- `python -B scripts/summary/paper_tables.py`
- `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`
- `python -B scripts/summary/paper_build.py --profile paper --mode publish --outdir output/summary --skip-docx`
- `python -B scripts/summary/paper_qc.py`

## 2026-01-26（UTC） Phase 8（論文化）/ Part I（コア理論）：付録の純化（EHT定義のPart II寄せ）＋HTML目次/アンカー統一

目的：
- Part I を「基準書（写像凍結）」として純化し、EHT等の応用定義は Part II 側へ寄せる。
- 3本（Part I/II/III）のHTMLで「冒頭目次＋各章内目次」の重複をなくし、番号見出しアンカーを統一する。

変更：
- 更新：`doc/paper/05_definitions.md`
  - A.7（EHT：リング直径と影直径）を削除し、Part I の付録を記号定義（A.1〜A.6）に限定。
- 更新：`scripts/summary/paper_html.py`
  - 目次を「冒頭のグローバル目次」に統一（各カード内の「この章の目次」を廃止）。
  - 番号見出しのアンカーを `#section-1-1` 形式へ正規化（Part I/II/III/短報）。
  - 不具合修正：`_render_html()` の構文エラー（重複 `*`）と、見出し抽出の backreference を修正。

再生成：
- `python -B scripts/summary/paper_build.py --profile paper --mode publish --outdir output/summary --skip-docx`
- `python -B scripts/summary/paper_build.py --profile part2_astrophysics --mode publish --outdir output/summary --skip-docx`
- `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`
- `python -B scripts/summary/paper_qc.py`

実行：
- `python -B scripts/summary/paper_build.py --profile paper --mode publish --outdir output/summary --skip-docx`
- `python -B scripts/summary/paper_build.py --profile part2_astrophysics --mode publish --outdir output/summary --skip-docx`
- `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`
- `python -B scripts/summary/paper_qc.py`

## 2026-01-26（UTC） Phase 7（量子）/ Step 7.13.4：λ_π 制約下 3-range（Yukawa tail 粗視化；shared tail）を追加しても v2s 符号は救えず（末尾）

目的：
- Step 7.13.3（λ_π 制約下 2-range）で残った「v2s が正に出る」攻撃点に対し、外側の最小 tail（free parameterなし）を追加しても符号が救えるかを切り分ける。

変更：
- 更新：`scripts/quantum/nuclear_effective_potential_two_range.py`
  - Step 7.13.4 を追加（λ_π 制約＋3-range tail 粗視化；shared tail）。
  - piecewise-constant signed potential を扱う汎用伝播（segments）と、bound-state 条件の solve を追加。
- 出力（固定）：`python -B scripts/quantum/nuclear_effective_potential_two_range.py --step 7.13.4`
  - `output/quantum/nuclear_effective_potential_pion_constrained_three_range_tail.png`
  - `output/quantum/nuclear_effective_potential_pion_constrained_three_range_tail_metrics.json`
  - `output/quantum/nuclear_effective_potential_pion_constrained_three_range_tail.csv`
- 結果（初版）：v2s は依然として正（例：eq18 ≈ +0.315、eq19 ≈ +0.347）で、観測包絡（eq18–eq19：-0.48〜-0.005）外 → この ansatz class は棄却。
- 更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/PRIMARY_SOURCES.md` / `doc/paper/12_part3_quantum.md` / `doc/AI_CONTEXT_MIN.json`

実行：
- `python -B scripts/quantum/nuclear_effective_potential_two_range.py --step 7.13.4`
- `python -B scripts/summary/paper_qc.py`

## 2026-01-26（UTC） Phase 8（論文化）/ Step 8.2.1：Part I軸強化（操作的定義・写像理由・β/δ位置づけ）＋Part II 前処理依存の明文化

目的：
- Part I（コア）を「Pの操作的定義→写像理由→凍結→反証形式」の軸で読み切れる形へ寄せ、査読で刺されやすい点（`P` の実体/`ln` の恣意性/`β` のキャリブレーション疑義/`δ` の ad-hoc 批判）に対する防衛線を本文内で固定する。
- Part II/III の凍結運用（β/δは Part I 改訂に集約）を統一し、宇宙物理データの前処理依存を正面から明示して過剰主張を避ける。

変更：
- 更新：`doc/paper/10_part1_core_theory.md`
  - 1.1：`P` を「標準時計の進みを決める場」として操作的に定義することを先頭で明確化。
  - 1.3：`P` を実体として断言せず、比 `P/P0` を通じた写像として扱う立場を追記。
  - 2.1：`φ=-c^2 ln(P/P0)` の選択理由を P-model 内部要請（比 `P/P0`、合成の加法性、弱場近似）として明文化。
  - 2.3：`δ` を現象論拡張（Padé-like 最小形）として短く整理し、詳細は付録へ寄せた。
  - 2.4：`β` を「自由波（光）のP勾配感度指数（束縛波/自由波の応答差）」として定義し、独立クロスチェック（VLBI）へ接続。
  - 3.3：`δ` の位置づけ（上限拘束＋実用上0）を明確化。
- 更新：`doc/paper/05_definitions.md`
  - `P` の操作的定義を追記し、`φ` の定義を「合成の加法性→ln」へ整合。
  - `β` の意味（自由波感度指数）を追記。`δ` を `δ≥0` として SR 極限を明示。
- 更新：`doc/paper/11_part2_astrophysics.md`
  - `β/δ` の凍結運用（Part I 改訂に集約）へ表現を統一。
  - 3.1 に一次データの前処理依存（GPS/LLR/Cassini/EHT）を明文化し、依存を外すために必要な入力を列挙。
- 更新：`doc/paper/12_part3_quantum.md`
  - `β/δ` の凍結運用（Part I 改訂に集約）へ表現を統一し、`δ≥0` 表記へ整合。
- 更新：`doc/paper/01_figures_index.md`
  - 量子（原子核）の新規図（λ_π 制約の2件）を追加し、Part III の図番号リンクを安定化。
- 更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`
  - Step 8.2.1（改稿）を追記し、現在地を更新。

再生成：
- `python -B scripts/summary/paper_build.py --profile paper --mode publish --outdir output/summary --skip-docx`
- `python -B scripts/summary/paper_build.py --profile part2_astrophysics --mode publish --outdir output/summary --skip-docx`
- `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`
- `python -B scripts/summary/paper_qc.py`

実行：
- `python -B scripts/summary/paper_build.py --profile paper --mode publish --outdir output/summary --skip-docx`
- `python -B scripts/summary/paper_build.py --profile part2_astrophysics --mode publish --outdir output/summary --skip-docx`
- `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`
- `python -B scripts/summary/paper_qc.py`

## 2026-01-26（UTC） Phase 7（量子）/ Step 7.13.4：λ_π 制約下 3-range（Yukawa tail 粗視化；shared tail）を追加しても v2s 符号は救えず（末尾追記）

目的：
- Step 7.13.3（λ_π 制約下 2-range）で残った「v2s が正に出る」攻撃点に対し、外側の最小 tail（free parameterなし）を追加しても符号が救えるかを切り分ける。

変更：
- 更新：`scripts/quantum/nuclear_effective_potential_two_range.py`
  - Step 7.13.4 を追加（λ_π 制約＋3-range tail 粗視化；shared tail）。
  - piecewise-constant signed potential を扱う汎用伝播（segments）と、bound-state 条件の solve を追加。
- 出力（固定）：`python -B scripts/quantum/nuclear_effective_potential_two_range.py --step 7.13.4`
  - `output/quantum/nuclear_effective_potential_pion_constrained_three_range_tail.png`
  - `output/quantum/nuclear_effective_potential_pion_constrained_three_range_tail_metrics.json`
  - `output/quantum/nuclear_effective_potential_pion_constrained_three_range_tail.csv`
- 結果（初版）：v2s は依然として正（例：eq18 ≈ +0.315、eq19 ≈ +0.347）で、観測包絡（eq18–eq19：-0.48〜-0.005）外 → この ansatz class は棄却。
- 更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/PRIMARY_SOURCES.md` / `doc/paper/12_part3_quantum.md` / `doc/AI_CONTEXT_MIN.json`

実行：
- `python -B scripts/quantum/nuclear_effective_potential_two_range.py --step 7.13.4`
- `python -B scripts/summary/paper_qc.py`

## 2026-01-26（UTC） Phase 7（量子）/ Step 7.13.4：λ_π 制約下 3-range（Yukawa tail 粗視化；shared tail）を追加しても v2s 符号は救えず

目的：
- Step 7.13.3（λ_π 制約下 2-range）で残った「v2s が正に出る」攻撃点に対し、外側の最小 tail（free parameterなし）を追加しても符号が救えるかを切り分ける。

変更：
- 更新：`scripts/quantum/nuclear_effective_potential_two_range.py`
  - Step 7.13.4 を追加（λ_π 制約＋3-range tail 粗視化；shared tail）。
  - piecewise-constant signed potential を扱う汎用伝播（segments）と、bound-state 条件の solve を追加。
- 出力（固定）：`python -B scripts/quantum/nuclear_effective_potential_two_range.py --step 7.13.4`
  - `output/quantum/nuclear_effective_potential_pion_constrained_three_range_tail.png`
  - `output/quantum/nuclear_effective_potential_pion_constrained_three_range_tail_metrics.json`
  - `output/quantum/nuclear_effective_potential_pion_constrained_three_range_tail.csv`
- 結果（初版）：v2s は依然として正（例：eq18 ≈ +0.315、eq19 ≈ +0.347）で、観測包絡（eq18–eq19：-0.48〜-0.005）外 → この ansatz class は棄却。
- 更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/PRIMARY_SOURCES.md` / `doc/paper/12_part3_quantum.md` / `doc/AI_CONTEXT_MIN.json`

実行：
- `python -B scripts/quantum/nuclear_effective_potential_two_range.py --step 7.13.4`
- `python -B scripts/summary/paper_qc.py`

## 2026-01-26（UTC） Phase 7（量子）/ Step 7.13.3：λ_π 制約下の 2-range 再評価（signed V2_s）

目的：
- 7.13.2 で固定した λ_π（m_π 由来の range）を ansatz 設計へ実装し、最小の符号拡張（singlet の V2_s を signed で許す）でも singlet v2s<0 が救えるかを切り分ける。

変更：
- 更新：`scripts/quantum/nuclear_effective_potential_two_range.py`
  - `--step 7.13.3` を追加（λ_π 制約付きの triplet fit + singlet `(a_s,r_s)` fit（signed V2_s）+ `v2s` 予言）。
  - 固定出力：`output/quantum/nuclear_effective_potential_pion_constrained_signed_v2.png` / `.csv` / `_metrics.json`
- 更新：`doc/ROADMAP.md`（7.13.3 を追加）
- 更新：`doc/PRIMARY_SOURCES.md`（7.13.3 出力の sha256 を追記）
- 更新：`doc/paper/12_part3_quantum.md`（4.2.7 に Step 7.13.3 の結果と図を追記）

結果（初版）：
- λ_π 制約を入れても、(a_s,r_s) を満たす範囲で `v2s` は正に出て観測包絡（eq18–eq19）外となり、2-range（最小の符号拡張込み）ansatz class は棄却。

再現：
- `python -B scripts/quantum/nuclear_effective_potential_two_range.py --step 7.13.3`

## 2026-01-26（UTC） Phase 8（論文化）/ Part I：β, δ の位置づけ（constraint→frozen→predict）を明確化

目的：
- 「フィッティングで合わせているだけ」という誤解を避け、β/δ の凍結値が一次ソース拘束に基づくこと、以後の結果生成では最適化しないこと、更新は Part I 改訂に集約することを本文中で明文化する。

変更：
- 更新：`doc/paper/10_part1_core_theory.md`
  - 1.3 の「β と δ」段落を、一次ソース拘束→凍結値固定→外挿（predict）の流れへ置換。
  - 箇条書きの運用ルールを更新（Part II/III で β/δ を個別変更しない／変更は Part I 改訂に集約）。
  - 「（注）fit は凍結値の決定手続きに限定し、以後の結果生成では最適化しない」を追記。

検証：
- `python -B scripts/summary/paper_qc.py`

## 2026-01-26（UTC） Phase 7（量子）/ Step 7.4.7：Kwiat/Christensen 2013（Illinois QI）の一次ソース/参考文献を論文へ整合

目的：
- Part III の Bell 横断まとめで使用している photon time-tag dataset（Christensen et al. 2013；Kwiat group）が、論文の一次ソース/参考文献リストに未記載だったため、出典不明・再現不能として撃たれるリスクを潰す。
- Part III 本文の入力一覧と、付録「データ出典（一次ソース）」および参考文献キーを一致させる。

変更：
- 更新：`doc/paper/20_data_sources.md`
  - [IllinoisQIBellTestdata] を追加（`CH_Bell_Data.zip`, `data_organization.txt`；ローカル `manifest.json` を参照）。
- 更新：`doc/paper/30_references.md`
  - [IllinoisQIBellTestdata] を追加。
- 更新：`doc/paper/12_part3_quantum.md`
  - Bell 入力（一次ソース）に Christensen et al. 2013 を追加し、[IllinoisQIBellTestdata] を引用。

再生成：
- `python -B scripts/quantum/bell_selection_sensitivity_summary.py`
- `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`

実行：
- `python -B scripts/quantum/bell_selection_sensitivity_summary.py`
- `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`

## 2026-01-26（UTC） Phase 7（量子）/ Step 7.13.1：hadron/QCD スケールの基準値固定（PDG RPP 2024）

目的：
- Step 7.9（核力）と Step 7.13（核力↔QCD統合）で「任意関数fit」に見える攻撃点を塞ぐため、QCD/hadron スケールの代表値（p/n/π/K など）を一次ソースで固定し、共通の土台（range/scale）を作る。

変更：
- 追加：`scripts/quantum/fetch_pdg_mass_width_2024.py`
  - PDG RPP 2024 の Monte Carlo table（masses/widths/particle ID）を取得し、sha256 manifest を生成。
  - 保存先：`data/quantum/sources/pdg_rpp_2024_mass_width/`
- 追加：`scripts/quantum/qcd_hadron_masses_baseline.py`
  - p/n/π/K/Λ/Σ/Ξ の質量（MeV）と Compton λ（fm）を固定出力化。
  - 出力：`output/quantum/qcd_hadron_masses_baseline.png` / `output/quantum/qcd_hadron_masses_baseline_metrics.json` / `output/quantum/qcd_hadron_masses_baseline.csv`
- 更新：`doc/PRIMARY_SOURCES.md`
  - PDG の一次ソース（URL/ローカル/sha256）と基準値出力を追記。
- 更新：`doc/ROADMAP.md`
  - Step 7.13 を進行中へ更新し、7.13.1 を追加（完了（初版））。

実行：
- `python -B scripts/quantum/fetch_pdg_mass_width_2024.py`
- `python -B scripts/quantum/qcd_hadron_masses_baseline.py`

## 2026-01-26（UTC） Phase 7（量子）/ Step 7.13.2：hadron（m_π）→核スケール（u(r)幾何）の橋渡しを固定出力化

目的：
- Step 7.9 の核スケール ansatz class（R1,R2,Rc）が “恣意的距離パラメータ” に見える攻撃点を減らすため、PDG の m_π から得られる range（λ_π）を操作的制約として明示し、核スケール幾何（R2/λ_π 等）を固定出力化する。
- スケール整合（range）と、観測棄却点（例：singlet v2s の符号）が別問題であることを同一図で示し、次の ansatz 再設計（7.13.3+）の要件を明確にする。

変更：
- 追加：`scripts/quantum/qcd_nuclear_range_bridge.py`
  - 入力：`output/quantum/qcd_hadron_masses_baseline_metrics.json`（λ_π）＋ `output/quantum/nuclear_effective_potential_*_metrics.json`（Step 7.9）
  - 出力：`output/quantum/qcd_nuclear_range_bridge.png` / `output/quantum/qcd_nuclear_range_bridge_metrics.json` / `output/quantum/qcd_nuclear_range_bridge.csv`
- 更新：`doc/ROADMAP.md`
  - Step 7.13.2（橋渡し出力）を追加し、完了（初版）として固定。

実行：
- `python -B scripts/quantum/qcd_nuclear_range_bridge.py`

## 2026-01-26（UTC） Phase 7（量子）/ Step 7.4.9.1：Bell time-tag の偶発同時計数推定（time-shift）＋accidental subtraction を同梱

目的：
- 「窓を広げすぎてノイズ（偶発同時計数）を拾っただけでは？」という攻撃に備え、time-shift による偶発推定と accidental subtraction を固定出力として同梱する。
- window/offset sweep が p-hacking に見えないよう、（natural window の推奨に加え）**偶発差し引き後も窓依存が残るか**を cross-check として明示する。

変更：
- 更新：`scripts/quantum/bell_primary_products.py`
  - NIST/Weihs の window sweep に time-shift 偶発推定を追加し、accidental（推定）と accidental subtraction（raw/clipped）後の統計量を `output/quantum/bell/<dataset>/window_sweep_metrics.json` に併記。
  - dataset summary 図（`output/quantum/bell/<dataset>/summary.png`）でも raw vs accidental-subtracted を重ね描き。
- 更新：`scripts/quantum/bell_selection_sensitivity_summary.py`
  - 横断まとめ図に accidental-subtracted を追加（Weihs/NIST）。
- 更新：`doc/paper/12_part3_quantum.md`
  - Bell 節に accidental subtraction の位置づけ（何を防衛するための cross-check か）を追記。
- 更新：`doc/ROADMAP.md`
  - Step 7.4.9.1（偶発推定＋subtraction）を追記。

再生成：
- `python -B scripts/quantum/bell_primary_products.py --datasets all --overwrite`
- `python -B scripts/quantum/bell_selection_sensitivity_summary.py`
- `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`
- `python -B scripts/summary/paper_build.py --profile paper --mode publish --outdir output/summary --skip-docx`
- `python -B scripts/summary/paper_qc.py`

## 2026-01-26（UTC） Phase 8（論文化）/ Step 8.2：Part I（コア理論）改稿（独自性/参照枠/反証中心）＋概念図追加＋付録見出し重複解消

目的：
- Part I を「P-model語彙が主語／参照枠としての既存物理／反証可能性中心」に寄せ、独自性は強めつつ過剰主張に見えないトーンへ整える。
- Part I の最小図（写像概念図）を追加し、Part II/III の冒頭で参照できる “辞書の入口” を作る。
- publish HTML で付録見出しが二重に表示されていた問題（カード見出し＋H1）を解消する。

変更：
- 更新：`doc/paper/10_part1_core_theory.md`
  - 1.1：未解決問題への視点転換を「検証可能仮説（写像）」として明確化。
  - 2.3：速度飽和 δ の物理的解釈候補（束縛波の有限帯域）を追記し、要請最小の ansatz であることを明文化。
  - 2.4：β を「光（自由波）のPへの応答強さ」として位置づけ、弱場拘束→凍結→強場差分予測へ接続。
  - 2.8：量子への橋渡しを “概念辞書” として短く固定（粒子/波動関数/測定/もつれ）。
  - 4.1：反証条件を無次元（必要相対精度）中心に圧縮し、タイムライン要素を除去。
- 追加：`scripts/theory/pmodel_core_mapping_overview.py`
  - 図：`output/theory/pmodel_core_mapping_overview.png`
  - 指標：`output/theory/pmodel_core_mapping_overview_metrics.json`
- 更新：`doc/paper/01_figures_index.md`
  - Part I の概念図を追加（固定パス）。
- 更新：`doc/paper/05_definitions.md` / `doc/paper/20_data_sources.md` / `doc/paper/30_references.md`
  - 先頭H1を削除し、publish HTML の見出し二重表示を解消。

再生成：
- `python -B scripts/theory/pmodel_core_mapping_overview.py`
- `python -B scripts/summary/paper_build.py --profile paper --mode publish --outdir output/summary --skip-docx`
- `python -B scripts/summary/paper_build.py --profile part2_astrophysics --mode publish --outdir output/summary --skip-docx`
- `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`
- `python -B scripts/summary/paper_qc.py`

実行：
- `python -B scripts/theory/pmodel_core_mapping_overview.py`
- `python -B scripts/summary/paper_build.py --profile paper --mode publish --outdir output/summary --skip-docx`
- `python -B scripts/summary/paper_build.py --profile part2_astrophysics --mode publish --outdir output/summary --skip-docx`
- `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`
- `python -B scripts/summary/paper_qc.py`

実行：
- `python -B scripts/quantum/bell_primary_products.py --datasets all --overwrite`
- `python -B scripts/quantum/bell_selection_sensitivity_summary.py`
- `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`
- `python -B scripts/summary/paper_build.py --profile paper --mode publish --outdir output/summary --skip-docx`
- `python -B scripts/summary/paper_qc.py`

## 2026-01-26（UTC） Phase 8（論文化）/ Part I/II/III：立ち位置の宣言文を追加（参照枠／ΛCDM非依存／QMベンチマーク）

目的：
- 「P-modelを既存理論の言い換え（ΛCDMの修正、QMの解釈改変）として読まれる」攻撃を先回りで遮断し、三部作の役割を明文化する。

変更：
- 更新：`doc/paper/10_part1_core_theory.md`
  - 1.3冒頭に、P-model 固有の最小仮定/写像を先に固定し、GR/QM は比較の参照枠としてのみ用いる旨を追記。
- 更新：`doc/paper/11_part2_astrophysics.md`
  - 序論末尾に、ΛCDM の修正版ではなく P-model 仮定を演繹適用し、標準理論は比較対象としてのみ用いる旨を追記。
- 更新：`doc/paper/12_part3_quantum.md`
  - 序論に、QM の隠れた変数追加（解釈改変）ではなく、P-model から出発し QM は現象論ベンチマークとして扱う旨を追記。

再生成：
- `python -B scripts/summary/paper_build.py --profile paper --mode publish --outdir output/summary --skip-docx`
- `python -B scripts/summary/paper_build.py --profile part2_astrophysics --mode publish --outdir output/summary --skip-docx`
- `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`
- `python -B scripts/summary/paper_qc.py`

実行：
- `python -B scripts/summary/paper_build.py --profile paper --mode publish --outdir output/summary --skip-docx`
- `python -B scripts/summary/paper_build.py --profile part2_astrophysics --mode publish --outdir output/summary --skip-docx`
- `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`
- `python -B scripts/summary/paper_qc.py`

## 2026-01-26（UTC） Phase 7（量子）/ Step 7.13.4：λ_π 制約下 3-range（Yukawa tail 粗視化；shared tail）でも v2s<0 は再現できず（最新）

目的：
- Step 7.13.3（λ_π 制約下 2-range）で残った「v2s が正に出る」攻撃点に対し、外側の最小 tail（free parameterなし）を追加しても符号が救えるかを切り分ける。

変更：
- 更新：`scripts/quantum/nuclear_effective_potential_two_range.py`
  - Step 7.13.4 を追加（λ_π 制約＋3-range tail 粗視化；shared tail）。
- 出力（固定）：`python -B scripts/quantum/nuclear_effective_potential_two_range.py --step 7.13.4`
  - `output/quantum/nuclear_effective_potential_pion_constrained_three_range_tail.png`
  - `output/quantum/nuclear_effective_potential_pion_constrained_three_range_tail_metrics.json`
  - `output/quantum/nuclear_effective_potential_pion_constrained_three_range_tail.csv`
- 結果（初版）：v2s は依然として正（eq18 ≈ +0.315、eq19 ≈ +0.347）で、観測包絡（eq18–eq19：-0.48〜-0.005）外 → この ansatz class は棄却。

実行：
- `python -B scripts/quantum/nuclear_effective_potential_two_range.py --step 7.13.4`
- `python -B scripts/summary/paper_qc.py`

## 2026-01-26（UTC） Phase 7（量子）/ Step 7.13.5：λ_π 制約下 barrier+tail（mean-preserving split）でも v2s<0 は再現できず（最新）

目的：
- Step 7.13.4（λ_π 制約下 3-range tail）で残った「v2s が正に出る」攻撃点に対し、外側 tail（R2..R3）を barrier+tail に分割しても符号が救えるかを切り分ける（v2s は fit しない）。

変更：
- 更新：`scripts/quantum/nuclear_effective_potential_two_range.py`
  - Step 7.13.5 を追加（tail を barrier+tail に分割、mean-preserving ルールで追加自由度なし）。
- 更新：`doc/paper/01_figures_index.md`
  - Step 7.13.5 図を追加。
- 更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`
  - 現在地と次作業を更新。

出力（固定）：`python -B scripts/quantum/nuclear_effective_potential_two_range.py --step 7.13.5`
- `output/quantum/nuclear_effective_potential_pion_constrained_barrier_tail.png`
- `output/quantum/nuclear_effective_potential_pion_constrained_barrier_tail_metrics.json`
- `output/quantum/nuclear_effective_potential_pion_constrained_barrier_tail.csv`

結果（初版）：v2s は依然として正（eq18 ≈ +0.320、eq19 ≈ +0.363）で、観測包絡（eq18–eq19：-0.48〜-0.005）外 → この ansatz class は棄却。

実行：
- `python -B scripts/quantum/nuclear_effective_potential_two_range.py --step 7.13.5`

## 2026-01-26（UTC） Phase 8（論文化）/ Step 8.2.1：Part I 軸強化（P-model主語・β凍結／δ_0は拡張へ）＋凍結出力をβのみに更新（最新）

目的：
- Part I（コア理論）を「P-model主語／参照枠（GR/QM）最小／写像＋棄却中心」に寄せ、速度飽和 `δ_0` の ad-hoc 攻撃点をコアから分離して、査読耐性を上げる。

変更：
- 更新：`doc/paper/10_part1_core_theory.md`
  - Abstract に「P-modelの視点（3本柱）」と「凍結後に残る差分予測3本」を追記。
  - 1.3 に「P-model主語／GR・QMは参照枠」宣言を追記。
  - 2.3 の速度項は SR 回収で固定し、速度飽和 `δ_0` はコアから外して Part II の拡張仮説へ移動。
  - 2.5/2.6 を補強（宇宙論は写像固定のみ／四重極が最低次となる理由を保存則として追記）。
  - 4.1 の差分予測はカテゴリ（到来方向偏向／強場形状／宇宙論の距離非依存量）へ圧縮。
- 更新：`doc/paper/11_part2_astrophysics.md` / `doc/paper/12_part3_quantum.md`
  - 速度項を SR 回収へ統一。凍結は `β` のみに統一し、`δ_0` は Part II の拡張仮説として位置づけ。
- 更新：`doc/paper/05_definitions.md`
  - A.3 を SR 回収へ統一し、速度飽和 `δ_0` を「拡張（Part II）」へ分離。
- 更新：`doc/P_model_handoff.md`
  - 時計式から δ を除去し、`δ_0` は拡張仮説として整理。
- 更新：`scripts/theory/freeze_parameters.py`
  - `output/theory/frozen_parameters.json` を **βのみ凍結**する仕様へ変更（`δ_0` は別途扱い）。
- 更新：`scripts/gps/compare_clocks.py` / `scripts/theory/gps_time_dilation.py` / `scripts/eht/gravity_s2_pmodel_projection.py`
  - `--delta` の既定値を 0.0（無効）へ統一（`δ_0` は拡張仮説として明示的に与える）。
- 更新：`scripts/summary/public_dashboard.py` / `scripts/summary/decisive_falsification.py` / `scripts/summary/paper_tables.py` / `doc/paper/01_figures_index.md` / `doc/paper/90_peer_review_notes.md`
  - 「β/δ凍結」表記を「β凍結＋`δ_0`は拡張仮説」へ整合。

再生成：
- `python -B scripts/theory/freeze_parameters.py`（→ `output/theory/frozen_parameters.json`）

QC：
- `python -B scripts/summary/paper_qc.py`（ok）

## 2026-01-26（UTC） Phase 7（量子）/ Step 7.13.6：λ_π 制約下 barrier+tail（k-scan; cross-systematics 拘束）でも v2s<0 は再現できず（最新）

目的：
- Step 7.13.5（mean-preserving barrier+tail）で残った「v2s が正に出る」攻撃点に対し、tail の “結び方” の 1自由度（barrier_height_factor k）のみを解除し、eq18–eq19 の差（analysis-dependent systematics proxy）で拘束しても `v2s<0` が救えるかを切り分ける。

変更：
- 更新：`scripts/quantum/nuclear_effective_potential_two_range.py`
  - Step 7.13.6 を追加（k-scan：単一の k を cross-systematics で選択し、per-dataset の追加最適化をしない）。
- 更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`
  - 現在地と次作業を更新。

出力（固定）：`python -B scripts/quantum/nuclear_effective_potential_two_range.py --step 7.13.6`
- `output/quantum/nuclear_effective_potential_pion_constrained_barrier_tail_k_scan.png`
- `output/quantum/nuclear_effective_potential_pion_constrained_barrier_tail_k_scan_metrics.json`
- `output/quantum/nuclear_effective_potential_pion_constrained_barrier_tail_k_scan.csv`

結果（初版）：
- 選択 k=2.0。
- v2s は正（eq18 ≈ +0.253、eq19 ≈ +0.295）で観測包絡（eq18–eq19：-0.48〜-0.005）外 → ansatz class は棄却。

実行：
- `python -B scripts/quantum/nuclear_effective_potential_two_range.py --step 7.13.6`

## 2026-01-26（UTC） Phase 7（量子）/ Step 7.13.7：λ_π 制約下 barrier+tail（q-scan; free tail depth）でも包絡一致に到達せず（最新）

目的：
- Step 7.13.6（k-scan）で残った「v2s が正に出る」攻撃点に対し、tail 側の深さを mean-preserving から切り離して 1自由度（tail_depth_factor q）として走査し、eq18–eq19 の差（analysis-dependent systematics proxy）で単一 q を拘束して、包絡一致（eq18–eq19：-0.48〜-0.005）に到達できるかを切り分ける。

変更：
- 更新：`scripts/quantum/nuclear_effective_potential_two_range.py`
  - Step 7.13.7 を追加（barrier+tail のうち tail 深さを `Vt=q·V3_mean` として独立化し、q-scan で単一 q を選択）。
  - 固定：barrier_height_factor は k=2.0（固定）。
- 更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json` / `doc/paper/01_figures_index.md`
  - 現在地と次作業、図一覧を更新。

出力（固定）：`python -B scripts/quantum/nuclear_effective_potential_two_range.py --step 7.13.7`
- `output/quantum/nuclear_effective_potential_pion_constrained_barrier_tail_q_scan.png`
- `output/quantum/nuclear_effective_potential_pion_constrained_barrier_tail_q_scan_metrics.json`
- `output/quantum/nuclear_effective_potential_pion_constrained_barrier_tail_q_scan.csv`

結果（初版）：
- 選択 q=0.7。
- v2s はほぼ 0（eq18 ≈ +0.016、eq19 ≈ +0.016）で観測包絡外 → ansatz class は棄却。
- 補足：q によって v2s の符号が反転し得ること（例：q=0.5 では v2s_pred が負）自体は確認できたが、単一 q で両データの包絡一致は得られなかった。

実行：
- `python -B scripts/quantum/nuclear_effective_potential_two_range.py --step 7.13.7`

## 2026-01-26（UTC） Phase 7（量子）/ Step 7.13.8：λ_π 制約下 barrier+tail（(k,q)-scan; global 2DOF）で v2s 包絡一致に到達（最新）

目的：
- Step 7.13.7（q-scan）で残った「単一 q では包絡一致できない」を受け、(k,q) を **global** に 2自由度として走査し、per-dataset 調整を導入せずに v2s 包絡一致（eq18–eq19：-0.48〜-0.005）へ到達できるかを切り分ける。

変更：
- 更新：`scripts/quantum/nuclear_effective_potential_two_range.py`
  - Step 7.13.8 を追加（global (k,q) scan：単一の (k,q) を cross-systematics（eq18–eq19 包絡）で選択し、per-dataset の追加最適化をしない）。
- 更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json` / `doc/paper/01_figures_index.md`
  - 現在地と次作業、図一覧を更新。

出力（固定）：`python -B scripts/quantum/nuclear_effective_potential_two_range.py --step 7.13.8`
- `output/quantum/nuclear_effective_potential_pion_constrained_barrier_tail_kq_scan.png`
- `output/quantum/nuclear_effective_potential_pion_constrained_barrier_tail_kq_scan_metrics.json`
- `output/quantum/nuclear_effective_potential_pion_constrained_barrier_tail_kq_scan.csv`

結果（初版）：
- 選択 (k,q)=(1.0, 0.6)。
- v2s は負に出て包絡内（eq18 ≈ -0.148、eq19 ≈ -0.118）→ barrier+tail（free tail depth）ansatz class は **棄却されない**（この段階で包絡一致に到達）。

実行：
- `python -B scripts/quantum/nuclear_effective_potential_two_range.py --step 7.13.8`

## 2026-01-26（UTC） Phase 7（量子）/ Step 7.13.9：軽核（A=2,3,4）ベースライン（束縛エネルギーB、利用可能な電荷半径）を一次固定（最新）

目的：
- Step 7.13.8 で固定した核スケール ansatz class を核種依存（A依存）へ拡張する前提として、軽核（A=2,3,4）の束縛エネルギー（質量欠損）と、利用可能な電荷半径（p/d/α）を **一次**ソースで固定し、以後の再導出と反証条件のターゲットを揃える。

変更：
- 更新：`scripts/quantum/fetch_nuclear_binding_sources.py`
  - 出力先ディレクトリ名（`--out-dirname`）と、軽核用の追加定数（`--include-light-nuclei`）を導入し、同一スクリプトで deuteron-only と light nuclei の両方をキャッシュ可能にした。
- 追加：`scripts/quantum/nuclear_binding_light_nuclei.py`
  - A=2,3,4 の束縛エネルギー（B, B/A）と、CODATAで利用可能な電荷半径（p/d/α）を固定出力化（PNG/CSV/metrics）。
- 更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json` / `doc/PRIMARY_SOURCES.md` / `doc/paper/01_figures_index.md`
  - 現在地と次作業、一次ソース一覧、図一覧を更新。

出力（固定）：
- `python -B scripts/quantum/fetch_nuclear_binding_sources.py --out-dirname nist_codata_2022_nuclear_light_nuclei --include-light-nuclei`
- `python -B scripts/quantum/nuclear_binding_light_nuclei.py`
  - `output/quantum/nuclear_binding_light_nuclei.png`
  - `output/quantum/nuclear_binding_light_nuclei_metrics.json`
  - `output/quantum/nuclear_binding_light_nuclei.csv`

結果（初版）：
- 束縛エネルギー（質量欠損；CODATA核質量）：deuteron ≈ 2.224566 MeV、triton ≈ 8.481797 MeV、helion ≈ 7.717990 MeV、alpha ≈ 28.295611 MeV。
- メモ：A=3 の電荷半径は CODATA/NIST Cuu では提供されないため、次段階で専用コンパイル（一次）をキャッシュして追加する。

## 2026-01-26（UTC） Phase 8（論文化・公開）/ Step 8.2.1：Part I/II/III の参照枠隔離と棄却プロトコル/自由度台帳を追記（改稿）（最新）

目的：
- Part I/II/III の本文主語を P-model に統一し、参照枠（GR/QM/PPN 等）の比較を各節末の `Reference note:` に隔離することで、定義/導出への混入を防ぐ。
- `ln` と `β` の導入理由を P-model 内部要請として明文化し、論文の軸（写像・凍結・棄却）を前面化する。
- 反証可能性を「議論」ではなく「手続き」として固定するため、共通棄却手順と自由度台帳を追加する。

変更：
- 更新：`doc/paper/10_part1_core_theory.md`
  - Abstract にコア定義を追記し、1.3/2.1/2.3/2.4 に要請ブロックを追記。
  - 参照枠比較（GR/QM/PPN/SR 等）を `Reference note:` に隔離。
  - `3.0 共通棄却手順（Rejection Protocol）` を追加。
- 更新：`doc/paper/11_part2_astrophysics.md`
  - 序論に表現規約を追記し、理論的枠組みの参照枠比較を `Reference note:` に隔離。
  - 太陽光偏向/EHT/影直径係数差などの参照枠表現を `Reference note:` へ寄せ、本文の主語を P-model に寄せた。
  - `3.0 共通棄却手順（Rejection Protocol）` を追加。
- 更新：`doc/paper/12_part3_quantum.md`
  - 序論に表現規約を追記し、QM/SR/PPN などの参照枠説明を `Reference note:` に隔離。
  - `3.0 共通棄却手順（Rejection Protocol）` を追加。
- 更新：`doc/paper/05_definitions.md`
  - `A.0 自由度台帳（Degrees of Freedom Ledger）` を追加（β, P_local, P_bg, φ, n(P) などの status/fixed-by/used-in を一覧化）。

実行：
- （資料生成はユーザー実行）必要に応じて `cmd /c output\\summary\\build_materials.bat quick-nodocx`（または Full）で Part I/II/III の HTML/DOCX を再生成して反映確認。

## 2026-01-26（UTC） Phase 7（量子）/ Step 7.13.10：A=3（t/h）電荷半径の一次固定（IAEA comp）を追加し、軽核ベースラインへ統合（最新）

目的：
- Step 7.13.9 の “A=3 の電荷半径が欠ける” 攻撃点を塞ぐため、専用コンパイル（一次）から triton/helion の電荷半径を固定し、軽核ベースライン出力へ統合する。

変更：
- 追加：`scripts/quantum/fetch_nuclear_charge_radii_sources.py`
  - IAEA radii database の `charge_radii.csv` をキャッシュし、A=3（t/h）の電荷半径を `extracted_values.json` として固定出力化。
- 更新：`scripts/quantum/nuclear_binding_light_nuclei.py`
  - p/d/α（CODATA）に加えて t/h（IAEA）の電荷半径を読み込み、`output/quantum/nuclear_binding_light_nuclei.*` に統合。
- 更新：`doc/PRIMARY_SOURCES.md` / `doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`
  - 一次ソース、ロードマップ（7.13.10追加）、現在地を更新。

出力（固定/更新）：
- 取得・キャッシュ：`python -B scripts/quantum/fetch_nuclear_charge_radii_sources.py --out-dirname iaea_charge_radii`
  - `data/quantum/sources/iaea_charge_radii/charge_radii.csv` / `manifest.json` / `extracted_values.json`
- ベースライン（軽核）：`python -B scripts/quantum/nuclear_binding_light_nuclei.py`
  - `output/quantum/nuclear_binding_light_nuclei.png`
  - `output/quantum/nuclear_binding_light_nuclei_metrics.json`
  - `output/quantum/nuclear_binding_light_nuclei.csv`

## 2026-01-26（UTC） Phase 7（量子）/ Step 7.13.11：代表核種（A依存）ベースライン固定（AME2020＋電荷半径）（最新）

目的：
- 核種依存（A依存）へ進む前提として、代表核種（軽核＋代表安定核）の束縛エネルギー/核子あたり束縛（B/A；AME2020）と電荷半径（IAEA radii）を一次固定し、以後の A依存検証のターゲットを揃える。

変更：
- 追加：`scripts/quantum/fetch_ame2020_mass_table_sources.py`
  - IAEA AMDC の AME2020 mass table（`mass_1.mas20.txt`）をキャッシュし、B/A と質量欠損等を `extracted_values.json` として固定出力化。
- 追加：`scripts/quantum/nuclear_binding_representative_nuclei.py`
  - 代表核種（d,t,h,α,Li-6,C-12,O-16,Ca-40,Fe-56,Ni-62,Pb-208）の B と B/A（AME2020）と電荷半径（IAEA radii）を統合し、A依存ベースラインを固定出力化（PNG/CSV/metrics）。
- 更新：`doc/PRIMARY_SOURCES.md` / `doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`
  - 一次ソース、ロードマップ（7.13.11追加）、現在地を更新。
- 更新：`doc/paper/01_figures_index.md` / `doc/paper/12_part3_quantum.md`
  - 図一覧と本文の核セクションの図リストに `output/quantum/nuclear_binding_representative_nuclei.png` を追記。

出力（固定）：
- 取得・キャッシュ：`python -B scripts/quantum/fetch_ame2020_mass_table_sources.py --out-dirname iaea_amdc_ame2020_mass_1_mas20`
  - `data/quantum/sources/iaea_amdc_ame2020_mass_1_mas20/mass_1.mas20.txt` / `manifest.json` / `extracted_values.json`
- ベースライン（代表核種）：`python -B scripts/quantum/nuclear_binding_representative_nuclei.py`
  - `output/quantum/nuclear_binding_representative_nuclei.png`
  - `output/quantum/nuclear_binding_representative_nuclei_metrics.json`
  - `output/quantum/nuclear_binding_representative_nuclei.csv`

結果（初版）：
- 軽核→重核までの B/A（核子あたり束縛）と電荷半径を、同一の一次出典（AME2020＋IAEA）で揃えて固定した。
- メモ：この段階では多体問題を解かず「ターゲット固定」までに留める。次は A>4 の再導出（最小多体近似＋棄却条件）へ進む（Step 7.13.12+）。

## 2026-01-26（UTC） Phase 7（量子）/ Step 7.13.12：A依存の最小多体近似（uniform mean-field）での整合性チェック（最新）

目的：
- Step 7.13.8 で固定した u-profile ansatz class（同一の幾何＋global (k,q)）が、核種依存（A依存）の “飽和” を **追加の核種別調整なし**に説明できるかを、宣言済み近似の下で切り分ける（consistency check）。

変更：
- 追加：`scripts/quantum/nuclear_a_dependence_mean_field.py`
  - Step 7.13.8 のポテンシャル（eq18/eq19）と、Step 7.13.11 の代表核種ターゲット（B/A, r_charge）から、
    - 密度を半径から推定（uniform sphere）
    - 速度項（Fermi gas）＋相互作用項（pairwise mean-field）
    を合成し、B/A の A依存を固定出力化（PNG/CSV/metrics）。
- 更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`
  - 7.13.12 を追加し、現在地と次作業を更新。
- 更新：`doc/paper/01_figures_index.md` / `doc/paper/12_part3_quantum.md`
  - 図一覧と本文の核セクションの図リストに `output/quantum/nuclear_a_dependence_mean_field.png` を追記。

出力（固定）：
- `python -B scripts/quantum/nuclear_a_dependence_mean_field.py`
  - `output/quantum/nuclear_a_dependence_mean_field.png`
  - `output/quantum/nuclear_a_dependence_mean_field_metrics.json`
  - `output/quantum/nuclear_a_dependence_mean_field.csv`

結果（初版）：
- uniform mean-field の近似では残差が大きく、A依存の飽和はこの近似だけでは説明できない可能性が高いことが数値として可視化された。
- 次段階は、Pauli 相関や多体項（3体など）を **新しい自由度として明示**し、棄却条件つきで再テストする（Step 7.13.13+）。

## 2026-01-26（UTC） Phase 7（量子）/ Step 7.13.13：A依存の最小多体近似（density-dependent repulsion proxy）での切り分け（最新）

目的：
- Step 7.13.12 の uniform mean-field が “過剰束縛（飽和しない）” を示したため、**追加自由度を明示**した最小の多体補正（Pauli/clustering/3体項の粗視化）を 1項だけ導入し、A依存（飽和）をどこまで救えるかを切り分ける。

変更：
- 更新：`scripts/quantum/nuclear_a_dependence_mean_field.py`
  - `--step 7.13.13` を追加し、2成分Fermi gas（p/n）＋ Hartree mean-field（pp/nn→singlet、pn→固定mix）＋ Coulomb に加えて、密度依存の多体反発 proxy を導入：
    - `E_rep/A = C * ρ^2`
    - C は 1点（既定：Ca-40）で凍結し、それ以後は外挿（predict）のみに使用。
- 更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`
  - 7.13.13 を追記し、現在地と次作業を更新。
- 更新：`doc/paper/01_figures_index.md` / `doc/paper/12_part3_quantum.md`
  - 図一覧と本文の核セクションの図リストに `output/quantum/nuclear_a_dependence_mean_field_density_repulsion.png` を追記。

出力（固定）：
- `python -B scripts/quantum/nuclear_a_dependence_mean_field.py --step 7.13.13`
  - `output/quantum/nuclear_a_dependence_mean_field_density_repulsion.png`
  - `output/quantum/nuclear_a_dependence_mean_field_density_repulsion_metrics.json`
  - `output/quantum/nuclear_a_dependence_mean_field_density_repulsion.csv`

結果（初版）：
- 代表核種（d,t,h,α,Li-6,C-12,O-16,Ca-40,Fe-56,Ni-62,Pb-208）に対し、1点（Ca-40）で凍結した `Cρ^2` を用いた外挿で、残差RMSが **約5.1 MeV（eq18）/ 5.16 MeV（eq19）** に改善した（Step 7.13.12 の RMS≈20 MeV から改善）。
- メモ：この段階の `Cρ^2` は多体効果の“置き換え”であり、次段階では Pauli/exchange/finite-range 相関や核種ごとの散乱（一次）などで、より物理的に拘束していく（Step 7.13.14+）。

## 2026-01-26（UTC） Phase 7（量子）/ Step 7.13.14：多体反発 proxy の C を“電荷半径の平衡条件”で凍結した切り分け（最新）

目的：
- Step 7.13.13 の `Cρ^2`（多体反発 proxy）が「B/A へフィット」に見える攻撃点を避けるため、**B/A を使わず**に C を凍結する手続きを追加し、A依存（飽和）の切り分けをより物理的に固定する。

変更：
- 更新：`scripts/quantum/nuclear_a_dependence_mean_field.py`
  - `--step 7.13.14` を追加し、`E_rep/A = C * ρ^2` の C を **電荷半径の平衡条件**で凍結する版を実装。
  - 手順：電荷半径→`R_sharp`→密度 `ρ` を推定し、基礎モデル（2成分Fermi＋Hartree＋Coulomb）の `E_base(R)` を半径方向に微小摂動して `dE_base/dR` を数値微分。平衡条件 `dE/dR=0` を満たす C を核種ごとに推定し、重核（既定：`A>=40`）の推定Cの **中央値**を凍結値として採用。
- 更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`
  - 7.13.14 を完了（初版）として反映し、次作業（7.13.15+）を設定。
- 更新：`doc/paper/01_figures_index.md` / `doc/paper/12_part3_quantum.md`
  - 図一覧と本文の核セクションの図リストに `output/quantum/nuclear_a_dependence_mean_field_repulsion_radii_frozen.png` を追記。

出力（固定）：
- `python -B scripts/quantum/nuclear_a_dependence_mean_field.py --step 7.13.14`
  - `output/quantum/nuclear_a_dependence_mean_field_repulsion_radii_frozen.png`
  - `output/quantum/nuclear_a_dependence_mean_field_repulsion_radii_frozen_metrics.json`
  - `output/quantum/nuclear_a_dependence_mean_field_repulsion_radii_frozen.csv`

結果（初版）：
- 凍結された C（中央値；`A>=40`）：**C≈9.10e2（eq18）/ 9.18e2（eq19）**（metrics参照）。
- 残差RMS：**≈5.13 MeV（eq18）/ 5.23 MeV（eq19）**（Step 7.13.13 と同程度）。ただし凍結が B/A に依存しないため、手続きとしてはより防御的になった。

## 2026-01-26（UTC） Phase 7（量子）/ Step 7.13.15：Hartree–Fock（Fock/exchange）＋3体項（proxy）の明示と凍結（最新）

目的：
- 7.13.14 の `Cρ^2` が “proxy のまま” に見える点を前進させるため、pp/nn の **exchange（Fock）項**を相互作用側へ明示的に追加し（Pauliの効果を kinetic だけでなく interaction にも反映）、残余の多体反発は 3体項 proxy として **別項で**扱う（隠れ自由度を作らない）。

変更：
- 更新：`scripts/quantum/nuclear_a_dependence_mean_field.py`
  - `--step 7.13.15` を追加し、uniform-matter Hartree–Fock（pp/nn の Fock）＋ Coulomb ＋ 3体項 proxy を実装。
  - 3体項 proxy：`E_3/A = C3 * ρ^2`（C3 は **B/A を使わず**、電荷半径の平衡条件 `dE/dR=0` から推定し、重核（既定：`A>=40`）の推定値中央値で凍結）。
- 更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`
  - 7.13.15.1 を完了（初版）として反映し、次作業（7.13.15.2+：核種別一次拘束の追加）を設定。
- 更新：`doc/paper/01_figures_index.md` / `doc/paper/12_part3_quantum.md`
  - 図一覧と本文の核セクションの図リストに `output/quantum/nuclear_a_dependence_hf_three_body_radii_frozen.png` を追記。

出力（固定）：
- `python -B scripts/quantum/nuclear_a_dependence_mean_field.py --step 7.13.15`
  - `output/quantum/nuclear_a_dependence_hf_three_body_radii_frozen.png`
  - `output/quantum/nuclear_a_dependence_hf_three_body_radii_frozen_metrics.json`
  - `output/quantum/nuclear_a_dependence_hf_three_body_radii_frozen.csv`

結果（初版）：
- 凍結された C3（中央値；`A>=40`）：**C3≈1.69e3（eq18）/ 1.73e3（eq19）**（metrics参照）。
- 残差RMS：**≈5.85 MeV（eq18）/ 6.18 MeV（eq19）**。現段階では「A依存（飽和）の切り分け」の枠組み固定を優先し、核種別一次拘束の追加（散乱など）は次段階（7.13.15.2+）で扱う。

## 2026-01-26（UTC） Phase 7（量子）/ Step 7.13.15.2：核種別一次σを用いたHF+3体の不確かさ分解（最新）

目的：
- Phase 7 を「宇宙論と同じ精度（系統・不確かさを分解して固定）」で進めるため、7.13.15.1（HF+3体；C3は電荷半径で凍結）の出力に対して、核種ごとの一次σ（AME2020 B/A σ、IAEA 電荷半径 σ）を明示的に取り込み、`σ_total`（不確かさ台帳）を固定する。

変更：
- 更新：`scripts/quantum/nuclear_a_dependence_mean_field.py`
  - `--step 7.13.15.2` を追加し、7.13.15.1 の metrics を後処理して不確かさ（radii由来／C3散らばり由来／観測σ）を分解して出力。
  - 手順（要点）：
    - `σ_r_charge→σ_R_sharp` を伝播し、`d(B/A)/dR` から `σ_BA_from_radii` を推定。
    - 重核（既定：`A>=40`）の `C3_est_from_radii` の散らばりを MAD→σ として `σ_C3` を推定し、`σ_BA_from_C3=ρ^2 σ_C3` を評価。
    - `σ_total=sqrt(σ_r^2+σ_C3^2+σ_obs^2)` を核種別・eq別に固定（**B/Aへの再フィットは行わない**）。
- 更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`
  - 7.13.15.2 を完了（初版）として反映し、次作業（7.13.15.3+）を設定。
- 更新：`doc/paper/01_figures_index.md` / `doc/paper/12_part3_quantum.md`
  - 図一覧と本文の核セクションの図リストに `output/quantum/nuclear_a_dependence_hf_three_body_uncertainty.png` を追記。

出力（固定）：
- `python -B scripts/quantum/nuclear_a_dependence_mean_field.py --step 7.13.15.2`
  - `output/quantum/nuclear_a_dependence_hf_three_body_uncertainty.png`
  - `output/quantum/nuclear_a_dependence_hf_three_body_uncertainty_metrics.json`
  - `output/quantum/nuclear_a_dependence_hf_three_body_uncertainty.csv`

結果（初版）：
- 重核（`A>=40`）での C3 散らばり（MAD→σ）：**≈165（eq18）/ 168（eq19） MeV·fm^6**（metrics参照）。

## 2026-01-26（UTC） Phase 7（量子）/ Step 7.13.15.3：散乱（eq18/eq19）起因の系統項を追加し、棄却用不確かさ予算を強化（最新）

目的：
- 7.13.15.2 の `σ_total`（radii由来／C3散らばり由来／観測σ）に加え、低エネルギー散乱拘束由来の入力差分（eq18 vs eq19）の影響を **系統項**として明示し、核種別に「どこで棄却されるか」をより正面から固定する（eqの選別や再フィットに逃げない）。

変更：
- 更新：`scripts/quantum/nuclear_a_dependence_mean_field.py`
  - `--step 7.13.15.3` を追加し、Step 7.13.15.2 の metrics を後処理して、eq18/eq19 の予測差を `σ_set=0.5|pred(eq18)-pred(eq19)|` として `σ_total` に加えた `σ_total_with_set` を固定出力化。
- 更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`
  - 7.13.15.3 を完了（初版）として反映し、次作業（7.13.15.4+）を設定。
- 更新：`doc/paper/01_figures_index.md` / `doc/paper/12_part3_quantum.md`
  - 図一覧と本文の核セクションの図リストに `output/quantum/nuclear_a_dependence_hf_three_body_uncertainty_set_systematic.png` を追記。

出力（固定）：
- `python -B scripts/quantum/nuclear_a_dependence_mean_field.py --step 7.13.15.3`
  - `output/quantum/nuclear_a_dependence_hf_three_body_uncertainty_set_systematic.png`
  - `output/quantum/nuclear_a_dependence_hf_three_body_uncertainty_set_systematic_metrics.json`
  - `output/quantum/nuclear_a_dependence_hf_three_body_uncertainty_set_systematic.csv`

結果（初版）：
- `σ_set`（median; 11核種）：**≈0.19 MeV**（metrics参照）。

## 2026-01-26（UTC） Phase 7（量子）/ Step 7.13.15.4：半径ソース依存（CODATA vs IAEA）を系統項として追加（最新）

目的：
- 代表核種の電荷半径（IAEA radii compilation）に対し、light nuclei で独立に利用できる CODATA（NIST Cuu）半径がある場合、その差分を **半径ソース依存の系統**として明示し、棄却条件の逃げ道（“半径ソースを変えれば良い”）を塞ぐ（半径ソースの置換や再フィットに逃げない）。

変更：
- 更新：`scripts/quantum/nuclear_a_dependence_mean_field.py`
  - `--step 7.13.15.4` を追加し、Step 7.13.15.2 の不確かさ台帳（radii/C3/obs）に対して、`σ_r_source=0.5|r(CODATA)-r(IAEA)|` を追加で伝播した `σ_total_plus_r_source` を固定出力化。
- 更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`
  - 7.13.15.4 を完了（初版）として反映し、次作業（7.13.15.5+）を設定。
- 更新：`doc/paper/01_figures_index.md` / `doc/paper/12_part3_quantum.md`
  - 図一覧と本文の核セクションの図リストに `output/quantum/nuclear_a_dependence_hf_three_body_uncertainty_radii_source_systematic.png` を追記。

出力（固定）：
- `python -B scripts/quantum/nuclear_a_dependence_mean_field.py --step 7.13.15.4`
  - `output/quantum/nuclear_a_dependence_hf_three_body_uncertainty_radii_source_systematic.png`
  - `output/quantum/nuclear_a_dependence_hf_three_body_uncertainty_radii_source_systematic_metrics.json`
  - `output/quantum/nuclear_a_dependence_hf_three_body_uncertainty_radii_source_systematic.csv`

結果（初版）：
- deuteron（d）での半径差：`Δr≈-0.0143 fm`（CODATA−IAEA）→ `σ_r_source≈0.00716 fm`（半差；metrics参照）。

## 2026-01-26（UTC） Phase 7（量子）/ Step 7.13.15.5：総合棄却予算（σ_final）を固定し、light nuclei の適用範囲を明確化（最新）

目的：
- 7.13.15.2（radii/C3/obs）＋7.13.15.3（散乱由来の set 差）＋7.13.15.4（半径ソース差）を合成し、核種別・eq別に `σ_final` と `z=residual/σ_final` を固定して「どこで棄却されるか」を読みやすくする。同時に light nuclei（少数体系）に対する uniform-matter HF+3体モデルの **適用範囲**を明示して評価の誤読（軽核で自明に死ぬ）を避ける。

変更：
- 更新：`scripts/quantum/nuclear_a_dependence_mean_field.py`
  - `--step 7.13.15.5` を追加し、`σ_final^2=σ_total^2+σ_set^2+σ_r_source^2`（`σ_set=0.5|pred(eq18)-pred(eq19)|`）を核種別・eq別に固定し、`z_final` と pass/fail（|z|<=3）を出力。
  - 適用範囲（初版）：`A>=16` を in-domain として明示し、domain 内の `χ^2-like` と `|z|<=3` 率を metrics に固定。
- 更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`
  - 7.13.15.5 を完了（初版）として反映し、次作業（7.13.15.6+）を設定。
- 更新：`doc/paper/01_figures_index.md` / `doc/paper/12_part3_quantum.md`
  - 図一覧と本文の核セクションの図リストに `output/quantum/nuclear_a_dependence_hf_three_body_rejection_budget.png` を追記。

出力（固定）：
- `python -B scripts/quantum/nuclear_a_dependence_mean_field.py --step 7.13.15.5`
  - `output/quantum/nuclear_a_dependence_hf_three_body_rejection_budget.png`
  - `output/quantum/nuclear_a_dependence_hf_three_body_rejection_budget_metrics.json`
  - `output/quantum/nuclear_a_dependence_hf_three_body_rejection_budget.csv`

結果（初版）：
- domain（`A>=16`）での `|z|<=3` 率：**0.60（eq18/eq19）**（N=5；metrics参照）。

## 2026-01-26（UTC） Phase 7（量子）/ Step 7.13.15.6：AME2020×IAEA radii でデータ数拡張し、shell・表面の系統を切り分け（最新）

目的：
- 7.13.15.1 の C3 凍結（電荷半径の平衡条件）を維持したまま、AME2020（核種別 B/A）と IAEA 電荷半径を大規模に結合し、HF+3体モデルの残差系統を可視化・固定出力化する。
- 特に、surface（A-bin）と shell（magic Z/N）を切り分け、次のモデル拡張（追加項の明示／自由度台帳への登録）に向けた「どこで失敗するか」を仕様として残す。

変更：
- 更新：`scripts/quantum/nuclear_a_dependence_mean_field.py`
  - `--step 7.13.15.6` を追加し、AME2020×IAEA radii join の核種（Z>=1, A>=2, r_charge>0）に対して、HF+3体（C3凍結）の予測・残差・C3_est_from_radii を一括で評価し、shell（magic Z/N）と surface（A-bin）で集計する固定出力を追加。
  - 共通化：HF 基礎エネルギー評価を `_hf_base_energy_uniform_sphere_mev_per_a()` として追加（7.13.15 系の拡張で共通利用）。
- 更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`
  - 7.13.15.6 を完了（初版）として反映し、次作業（7.13.15.6+）を設定。
- 更新：`doc/paper/01_figures_index.md` / `doc/paper/12_part3_quantum.md`
  - 図一覧と本文の核セクションの図リストに `output/quantum/nuclear_a_dependence_hf_three_body_extended_dataset.png` を追記。

出力（固定）：
- `python -B scripts/quantum/nuclear_a_dependence_mean_field.py --step 7.13.15.6`
  - `output/quantum/nuclear_a_dependence_hf_three_body_extended_dataset.png`
  - `output/quantum/nuclear_a_dependence_hf_three_body_extended_dataset_metrics.json`
  - `output/quantum/nuclear_a_dependence_hf_three_body_extended_dataset.csv`

結果（初版）：
- join N=955（published=907, preliminary=48）、domain（A>=16）N=932。
- residual RMS（pred_mean−obs；domain）：**≈5.18 MeV**（metrics参照）。
- C3_est_from_radii（domain）の中央値：**≈1.57e3（eq18）/ 1.60e3（eq19） MeV·fm^6**（robust σ ≈70；metrics参照）。

## 2026-01-26（UTC） Phase 7（量子）/ Step 7.13.15.7：surface（有限サイズ）項の明示（radii-only fit）と棄却統計（z）の更新（最新）

目的：
- 7.13.15.6 で観測された `C3_est_from_radii` の A 依存を、自由度台帳に載る形（最小追加）で明示し、fit/predict 分離のまま棄却統計（z）を更新する。

変更：
- 更新：`scripts/quantum/nuclear_a_dependence_mean_field.py`
  - `--step 7.13.15.7` を追加し、radii-only fit で `C3_est_from_radii ≈ C3∞ + C_surf*x`（`x=1/(6ρ^2R_sharp)`）を凍結。
  - predict は `C3_eff=C3∞+C_surf*x` を用い、`E_total/A=E_base/A+C3_eff ρ^2=E_base/A+C3∞ρ^2+C_surf/(6R_sharp)` により B/A を外挿し、`σ_set=0.5|pred18-pred19|` を加えた `z=residual/σ_final` を固定出力化（eqの選別は行わない）。
- 更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`
  - 7.13.15.7 を完了（初版）として反映し、次作業（7.13.15.8）を設定。
- 更新：`doc/paper/01_figures_index.md` / `doc/paper/12_part3_quantum.md`
  - 図一覧と本文の核セクションの図リストに `output/quantum/nuclear_a_dependence_hf_three_body_surface_term.png` を追記。

出力（固定）：
- `python -B scripts/quantum/nuclear_a_dependence_mean_field.py --step 7.13.15.7`
  - `output/quantum/nuclear_a_dependence_hf_three_body_surface_term.png`
  - `output/quantum/nuclear_a_dependence_hf_three_body_surface_term_metrics.json`
  - `output/quantum/nuclear_a_dependence_hf_three_body_surface_term.csv`

結果（初版）：
- fit（A>=16, published radii）：`C3∞≈1.31e3（eq18）/ 1.33e3（eq19） MeV·fm^6`、`C_surf≈1.64e2（eq18）/ 1.67e2（eq19） MeV·fm`（metrics参照）。
- B/A 残差RMS（domain; mean eq）：**≈6.89 MeV**。
- obs+radii+C3-fit残差だけでは `σ_final` が小さく、domain での `|z|<=3` 率は **≈0.001**（N=932）。shell 等の未モデル化系統を追加項（またはモデル誤差）として明示する必要が残る。

## 2026-01-26（UTC） Phase 7（量子）/ Step 7.13.15.8：shell（magic Z/N）系統をモデル誤差（σ_shell）として明示し、棄却統計を更新（最新）

目的：
- 7.13.15.7 の結果が示す「B/A 残差は obs+radii+C3-fit残差（＋σ_set）だけでは説明できない」点を正面から扱い、shell（magic Z/N）に起因する系統を **棄却予算の追加項（σ_shell）**として明示する。

変更：
- 更新：`scripts/quantum/nuclear_a_dependence_mean_field.py`
  - `--step 7.13.15.8` を追加し、magic Z/N（2,8,20,28,50,82,126）で magic_any を定義し、category 別の `σ_shell` を固定して `σ_final_shell^2 = σ_final^2 + σ_shell^2` により z を更新（予測B/Aは変更しない）。
- 更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`
  - 7.13.15.8 を完了（初版）として反映し、次作業（7.13.15.9）を設定。
- 更新：`doc/paper/01_figures_index.md` / `doc/paper/12_part3_quantum.md`
  - 図一覧と本文の核セクションの図リストに `output/quantum/nuclear_a_dependence_hf_three_body_shell_term.png` を追記。

出力（固定）：
- `python -B scripts/quantum/nuclear_a_dependence_mean_field.py --step 7.13.15.8`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shell_term.png`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shell_term_metrics.json`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shell_term.csv`

手続き（初版）：
- category：magic_any（magic Z または magic N）
- `σ_shell(category)^2 = max(0, median(residual_mean^2) - median(σ_mean^2))`（domain 内、category別）
- `σ_final_shell^2 = σ_final^2 + σ_shell^2`、`z_shell = residual / σ_final_shell`

結果（初版）：
- `σ_shell`（non-magic）≈ **7.07 MeV**、（magic）≈ **7.20 MeV**（metrics参照）。
- domain で `z_mean_shell` の RMS ≈ **0.97**、`|z|<=3` 率は **≈1.00**（metrics参照）。

## 2026-01-26（UTC） Phase 7（量子）/ Step 7.13.15.9：separation energies（S_n/S_2n）と shell-gap による決着点の固定（最新）

目的：
- 7.13.15.8 の `σ_shell` は“読む”ための暫定であり、過大なモデル誤差を入れると反証可能性が弱くなる。
- B/A の絶対値ではなく、shell 構造に敏感な差分量（S_n, S_2n）と shell-gap（閉殻ギャップ）を固定出力化し、次段（shell を deterministic correction へ昇格するか／予測しない領域を宣言するか）の決着点を作る。

変更：
- 更新：`scripts/quantum/nuclear_a_dependence_mean_field.py`
  - `--step 7.13.15.9` を追加し、Step 7.13.15.7（surface項凍結；予測は変更しない）の出力から `B(Z,N)=A*(B/A)` を構成して `S_n, S_2n` を計算し、magic N に対する shell-gap（`gap_n`, `gap_2n`）の obs vs pred を固定出力化。
- 更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`
  - 7.13.15.9 を完了（初版）として反映し、次作業（7.13.15.10）を設定。
- 更新：`doc/paper/01_figures_index.md` / `doc/paper/12_part3_quantum.md`
  - 図一覧と本文の核セクションの図リストに `output/quantum/nuclear_a_dependence_hf_three_body_separation_energies.png` を追記。

出力（固定）：
- `python -B scripts/quantum/nuclear_a_dependence_mean_field.py --step 7.13.15.9`
  - `output/quantum/nuclear_a_dependence_hf_three_body_separation_energies.png`
  - `output/quantum/nuclear_a_dependence_hf_three_body_separation_energies_metrics.json`
  - `output/quantum/nuclear_a_dependence_hf_three_body_separation_energies.csv`

結果（初版）：
- domain（A>=16）での差分ペア数：Sn **N=731**、S2n **N=763**。
- 残差RMS（pred_mean−obs）：Sn ≈ **12.80 MeV**、S2n ≈ **23.43 MeV**（metrics参照）。
- shell-gap（magic N）データは `gap_n/gap_2n` として **各N=21** 点が得られ、magic N により符号・スケール不一致が残る（図参照）。

## 2026-01-26（UTC） Phase 7（量子）/ Step 7.13.15.10：shell を deterministic correction（最小自由度）へ昇格し、S_n/S_2n と shell-gap で外挿評価（最新）

目的：
- 7.13.15.9 の決着点（S_n/S_2n と shell-gap）で説明不能な系統を、追加自由度として明示して最小限で吸収できるかを評価する。
- “合わせ込み”にならないよう、fit/predict 分離（係数凍結の領域を限定し、他領域で外挿評価）を固定する。

変更：
- 更新：`scripts/quantum/nuclear_a_dependence_mean_field.py`
  - `--step 7.13.15.10` を追加し、`ΔE_shell(Z,N)=a_any*I_magic_any + a_double*I_doubly_magic`（2自由度）を **全束縛 B**へ加える deterministic correction を導入。
  - 係数の凍結は Sn のうち **magic N∈{50,82} を含む差分ペアのみ**で最小二乗（2×2）で行い、それ以外の magic N は外挿として評価。
- 更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`
  - 7.13.15.10 を完了（初版）として反映し、次作業（7.13.15.11）を設定。
- 更新：`doc/paper/01_figures_index.md` / `doc/paper/12_part3_quantum.md`
  - 図一覧と本文の核セクションの図リストに `output/quantum/nuclear_a_dependence_hf_three_body_shell_correction.png` を追記。

出力（固定）：
- `python -B scripts/quantum/nuclear_a_dependence_mean_field.py --step 7.13.15.10`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shell_correction.png`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shell_correction_metrics.json`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shell_correction.csv`

結果（初版）：
- fit N=32 から `a_any≈-1.25 MeV`、`a_double≈-9.41 MeV`（metrics参照）。
- Sn（domain A>=16）：全体RMSは **12.80→12.84 MeV**（悪化）。学習領域（magic N=50/82）では **10.36→10.15 MeV**（改善）だが、他のmagic領域では **12.56→13.81 MeV**（悪化）。
- shell-gap：`gap_n` の RMS は **5.66→9.45 MeV** と悪化し、magic指標のみの最小補正では閉殻ギャップの整合が取れないことが固定された（図参照）。

## 2026-01-26（UTC） Phase 7（量子）/ Step 7.13.15.11：束縛モードの量子化（殻構造）の最小写像を導入し、shell-gap の外挿性能を検証（最新）

目的：
- 7.13.15.10 の結論（magic指標の ad-hoc 補正は外挿で崩れる）を受け、殻構造を「束縛モードの量子化」として最小写像で明示し、shell-gap を直接評価する。
- 既存の mean-field 予測（7.13.15.7）を変更せず、追加写像は 1自由度（κ）の凍結として管理し、外挿で判定する。

変更：
- 更新：`scripts/quantum/nuclear_a_dependence_mean_field.py`
  - `--step 7.13.15.11` を追加し、magic 境界 `[0,2,8,20,28,50,82,126,184]` に基づく殻内占有分率関数 `S_shell(x)=p(p-g)/g`（x=N,Z）と、スケール `ħω(A)=41*A^{-1/3}` を導入。
  - 補正：`B_corr = B_pred + κ ħω(A) (S_shell(N)+S_shell(Z))` を定義し、κ は `gap_n` のうち magic N∈{50,82} のみで最小二乗（線形）で凍結。
- 更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`
  - 7.13.15.11 を完了（初版）として反映し、次作業（7.13.15.12）を設定。
- 更新：`doc/paper/01_figures_index.md` / `doc/paper/12_part3_quantum.md`
  - 図一覧と本文の核セクションの図リストに `output/quantum/nuclear_a_dependence_hf_three_body_shell_quantization.png` を追記。

出力（固定）：
- `python -B scripts/quantum/nuclear_a_dependence_mean_field.py --step 7.13.15.11`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shell_quantization.png`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shell_quantization_metrics.json`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shell_quantization.csv`

結果（初版）：
- `κ≈-0.170`（fit N=12；metrics参照）。
- Sn/S2n の全体RMSはわずかに改善（Sn **12.80→12.71**、S2n **23.43→23.21**）。
- shell-gap：`gap_n` 全体では **5.66→5.74**（ほぼ同等）だが、学習領域（50/82）では **3.45→1.92** に改善し、他の magic N では **7.67→8.47** と悪化して外挿は未達（次段へ）。

## 2026-01-26（UTC） Phase 7（量子）/ Step 7.13.15.12：殻量子化写像の強化（N/Z非対称：kN,kZの分離凍結）と外挿評価（最新）

目的：
- 7.13.15.11 の最小写像（κ単一）は学習領域（50/82）では改善するが、他magicで悪化する。ここでは N/Z 非対称（kN,kZ）を導入し、識別可能性を守った凍結手順で外挿評価する。

変更：
- 更新：`scripts/quantum/nuclear_a_dependence_mean_field.py`
  - `--step 7.13.15.12` を追加し、`B_corr = B_pred + kN ħω(A) S_shell(N) + kZ ħω(A) S_shell(Z)` を導入。
  - identifiability：Sn/gap_n は Z項が差分で消えるため kN のみ、Sp/gap_p は N項が消えるため kZ のみが効く。したがって kN/kZ は **別々の観測量で凍結**する必要があることをコード内で明示。
  - 凍結：kN は `gap_n`（magic N∈{50,82}）で1D最小二乗、kZ は `gap_p`（magic Z∈{50,82}）で1D最小二乗として別々に凍結し、外挿領域で評価。
- 更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`
  - 7.13.15.12 を完了（初版）として反映し、次作業（7.13.15.13）を設定。
- 更新：`doc/paper/01_figures_index.md` / `doc/paper/12_part3_quantum.md`
  - 図一覧と本文の核セクションの図リストに `output/quantum/nuclear_a_dependence_hf_three_body_shell_quantization_asym.png` を追記。

出力（固定）：
- `python -B scripts/quantum/nuclear_a_dependence_mean_field.py --step 7.13.15.12`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shell_quantization_asym.png`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shell_quantization_asym_metrics.json`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shell_quantization_asym.csv`

結果（初版）：
- `kN≈-0.170`（fit N=12）、`kZ≈-0.121`（fit N=10）、比 `kZ/kN≈0.71`（metrics参照）。
- Sn/Sp の全体RMSは微改善（Sn **12.80→12.71**、Sp **18.72→18.64**）。
- shell-gap：学習領域（50/82）では `gap_n` RMS **3.45→1.92**、`gap_p` RMS **2.32→1.58** と改善するが、外挿領域では `gap_n`（other magic）RMS **7.67→8.48**、`gap_p`（other magic）RMS **11.62→12.34** と悪化し、外挿は未達（次段へ）。

## 2026-01-26（UTC） Phase 7（量子）/ Step 7.13.15.13：殻境界（縮退）の内部生成（degeneracy model）で shell-gap 外挿を検証（最新）

目的：
- 7.13.15.11–.12 は magic 境界を外部から与えており、学習領域（50/82）に寄る一方で外挿（他magic）で悪化する。
- 次段として、殻容量（縮退）を最小スペクトルから **内部生成**し、1n/1p の shell-gap が外挿で改善しうるかを検証する（fit/predict 分離は維持）。

変更：
- 更新：`scripts/quantum/nuclear_a_dependence_mean_field.py`
  - `--step 7.13.15.13` を追加。
  - Nilsson-like 球対称スペクトル（3D HO + `l·s` + `l^2`；κ=0.07, μ=0.60）を凍結し、準位間隔 `ΔE` の robust 閾値（`ΔE > gap_factor*median(ΔE)`；gap_factor=2.0）で閉殻境界（MODEL_MAGIC）を抽出。
  - `S_shell(x)=p(p-g)/g` は **MODEL_MAGIC** の殻内占有分率として定義し、`B_corr = B_pred + kN ħω(A) S_shell(N) + kZ ħω(A) S_shell(Z)` を評価。
  - 凍結（fit/predict 分離）：kN は `gap_n@N=50/82` のみで、kZ は `gap_p@Z=50/82` のみで別々に凍結し、他magicを外挿評価（p-hacking 回避）。
- 更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`
  - 7.13.15.13 を完了（初版）として反映し、次作業（7.13.15.14：相関/ペアリング）を設定。
- 更新：`doc/paper/01_figures_index.md` / `doc/paper/12_part3_quantum.md`
  - 図一覧と本文の核セクションの図リストに `output/quantum/nuclear_a_dependence_hf_three_body_shell_degeneracy_model.png` を追記。

出力（固定）：
- `python -B scripts/quantum/nuclear_a_dependence_mean_field.py --step 7.13.15.13`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shell_degeneracy_model.png`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shell_degeneracy_model_metrics.json`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shell_degeneracy_model.csv`

結果（初版）：
- MODEL_MAGIC ≈ `[0,2,8,14,20,28,50,76,82,114,164,210]`（metrics参照）。`kN≈-0.179`（fit N=12）、`kZ≈-0.130`（fit N=10）。
- Sn/Sp の全体RMSは微改善（Sn **12.798→12.794**、Sp **18.716→18.668**；S2n/S2p も微改善）。
- ただし 1n/1p の外挿領域では `gap_n`（other magic）RMS **7.67→8.20**、`gap_p`（other magic）RMS **11.62→12.36** と悪化し、外挿は未達（metrics参照）。
- 一方 2n/2p gap は改善傾向（例：`gap_S2n` RMS **15.23→10.67**）。

## 2026-01-26（UTC） Phase 7（量子）/ Step 7.13.15.14：最小ペアリング項（OES凍結）を追加し、shell-gap 外挿の改善を検証

目的：
- 7.13.15.11–.13 の結論（殻内占有だけでは 1n/1p gap の外挿が救えない）を受け、相関（odd-even staggering / pairing）を最小自由度で明示し、外挿で効果を判定する。
- pairing の凍結はモデル依存にしない（一次データから独立に拘束し、fit/predict を分離する）。

変更：
- 更新：`scripts/quantum/nuclear_a_dependence_mean_field.py`
  - `--step 7.13.15.14` を追加し、Step 7.13.15.13（degeneracy-model shell）に最小ペアリング項を重ねた評価を固定出力化。
  - pairing：`B_pair = B_shell + a_p*s(Z,N)/sqrt(A)`（s=+1 even-even, -1 odd-odd, 0 odd-A）。
  - `a_p` は観測束縛 `B_obs` の OES（3-point）から推定し、観測magic近傍を除外（tol=1）して凍結（モデル独立）。
- 更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`
  - 7.13.15.14 を完了（初版）として反映し、次作業（7.13.15.15：pairing固定→kN/kZ再凍結）を設定。
- 更新：`doc/paper/01_figures_index.md` / `doc/paper/12_part3_quantum.md`
  - 図一覧と本文の核セクションの図リストに `output/quantum/nuclear_a_dependence_hf_three_body_shell_degeneracy_pairing_model.png` を追記。

出力（固定）：
- `python -B scripts/quantum/nuclear_a_dependence_mean_field.py --step 7.13.15.14`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shell_degeneracy_pairing_model.png`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shell_degeneracy_pairing_model_metrics.json`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shell_degeneracy_pairing_model.csv`

結果（初版）：
- `a_p≈12.02 MeV`（`a_p_n≈11.79`, `a_p_p≈12.25`；OES 3-point；n=473/246）。
- Sn/Sp の全体RMSは改善（Sn **12.794→12.643**、Sp **18.668→18.421**）。
- 外挿領域（other magic）では `gap_n` RMS **8.20→7.73**、`gap_p` RMS **12.36→11.49** と改善（metrics参照）。
- 一方、学習magic（50/82）の gap は悪化（例：`gap_n` train RMS **1.84→3.00**、`gap_p` train RMS **1.55→2.38**）。これは kN/kZ が pairing 無しで凍結されているためであり、次段で pairing 固定下に kN/kZ を再凍結して整合を取る必要が残る。

## 2026-01-26（UTC） Phase 7（量子）/ Step 7.13.15.15：pairing 固定下で kN/kZ を再凍結し、1n/1p shell-gap 外挿を再評価（初版）

目的：
- 7.13.15.14 の結果（pairing を入れると other-magic は改善するが、train-magic を損ねる）を受け、pairing（a_p）を固定したまま shell係数（kN/kZ）を再凍結し、学習領域と外挿領域の両立を評価する。

変更：
- 更新：`scripts/quantum/nuclear_a_dependence_mean_field.py`
  - `--step 7.13.15.15` を追加し、pairing（a_p）固定下で kN/kZ を `gap_n/gap_p@50/82` で再凍結して外挿評価を固定出力化。

出力（固定）：
- `python -B scripts/quantum/nuclear_a_dependence_mean_field.py --step 7.13.15.15`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shell_degeneracy_pairing_refreeze.png`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shell_degeneracy_pairing_refreeze_metrics.json`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shell_degeneracy_pairing_refreeze.csv`

結果（初版）：
- `kN≈-0.323`（fit N=12）、`kZ≈-0.265`（fit N=10）。train-magic の gap は回復（例：`gap_n` train RMS ≈ **1.85**、`gap_p` train RMS ≈ **1.56**）。
- 外挿領域（other magic）では `gap_n` RMS ≈ **8.02**（vs 8.20）、`gap_p` RMS ≈ **12.04**（vs 12.36）と微改善に留まる（metrics参照）。
- 一方、2n/2p gap は改善（例：`gap_2n` RMS ≈ **7.83**）。

## 2026-01-26（UTC） Phase 7（量子）/ Step 7.13.15.16：pairing 最小形を改善（odd-A含む/中性子・陽子分離）し、kN/kZ 再凍結の下で外挿判定

目的：
- 7.13.15.15 で other-magic の改善が微小だったため、odd-A を 0 とする粗い pairing を避け、より標準的な最小形（中性子・陽子の寄与を分離）へ置換して外挿で判定する。

変更：
- 更新：`scripts/quantum/nuclear_a_dependence_mean_field.py`
  - `--step 7.13.15.16` を追加し、`B_base = B_pred + a_n*(-1)^N/sqrt(A) + a_p*(-1)^Z/sqrt(A)`（OES 3-point で `a_n,a_p` を別々に凍結）を基準として kN/kZ を再凍結し、外挿評価を固定出力化。
- 更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`
  - 7.13.15.16 を完了（初版）として反映し、次作業（7.13.15.17：本質的相関）を追加。
- 更新：`doc/paper/01_figures_index.md` / `doc/paper/12_part3_quantum.md`
  - 図一覧と本文の核セクションの図リストに Step 7.13.15.15–.16 の図を追記。

出力（固定）：
- `python -B scripts/quantum/nuclear_a_dependence_mean_field.py --step 7.13.15.16`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shell_degeneracy_pairing_sep_refreeze.png`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shell_degeneracy_pairing_sep_refreeze_metrics.json`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shell_degeneracy_pairing_sep_refreeze.csv`

結果（初版）：
- `a_n≈5.89 MeV`、`a_p≈6.13 MeV`（OES 3-point；n=473/246）。`kN≈-0.320`（fit N=12）、`kZ≈-0.268`（fit N=10）。
- train-magic は維持（`gap_n` train RMS ≈ **1.85**、`gap_p` train RMS ≈ **1.56**）。一方、other-magic は **実質的に改善せず**（`gap_n` RMS ≈ **8.02**、`gap_p` RMS ≈ **12.04**；metrics参照）。
- 結論：平均場+殻内占有+最小ペアリングの枠組みでも核殻構造の外挿は困難であることを固定し、次段で「本質的相関（多体構造）」へ進む。

## 2026-01-26（UTC） Phase 7（量子）/ Step 7.13.15.17：本質的相関（pn-collective proxy）を最小自由度で導入し、shell-gap 外挿で判定

目的：
- 7.13.15.16 までの結論（平均場+殻補正+最小ペアリングでは other-magic の 1n/1p shell-gap 外挿が十分に改善しない）を受け、次の相関自由度を **最小1DoF** で明示し、外挿で判定する。

変更：
- 更新：`scripts/quantum/nuclear_a_dependence_mean_field.py`
  - `--step 7.13.15.17` を追加し、7.13.15.16 の凍結（`a_n,a_p,kN,kZ`）を前提に pn-collective proxy を導入して外挿評価を固定出力化。
  - 定義：`B_corr = B_base + kNZ ħω(A) q(N) q(Z)`（`q=p(g-p)/g^2`；open-shell 指標）。
  - `kNZ` は shell-gap を直接 fit せず、観測magic近傍を除外（tol=1）した mid-shell の Sn/Sp 残差で凍結（p-hacking 回避）。
- 更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`
  - 7.13.15.17 を完了（初版）として反映し、次作業（7.13.15.18）を追加。
- 更新：`doc/paper/01_figures_index.md` / `doc/paper/12_part3_quantum.md`
  - 図一覧と本文の核セクションの図リストに Step 7.13.15.17 の図を追記。

出力（固定）：
- `python -B scripts/quantum/nuclear_a_dependence_mean_field.py --step 7.13.15.17`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shell_degeneracy_collective_pn.png`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shell_degeneracy_collective_pn_metrics.json`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shell_degeneracy_collective_pn.csv`

結果（初版）：
- `kNZ≈-11.60`（fit N=865；Sn=502, Sp=363）。
- other-magic は `gap_p` が改善（RMS **12.04→10.41**）する一方、`gap_n` は悪化（RMS **8.02→9.87**）。
- 結論：pn-collective 1DoF では `gap_n/gap_p` の同時改善は得られないため、次段で識別性を保った最小増分の相関DoF（7.13.15.18）を検討する。

## 2026-01-26（UTC） Phase 7（量子）/ Step 7.13.15.18：識別性を保った最小増分（2DoF）として `q(N),q(Z)` を導入し、shell-gap 外挿で判定（最新）

目的：
- 7.13.15.17 の結果（pn-collective 1DoF では `gap_n/gap_p` が同時に救えない）を受け、識別性（kqNはSnのみ、kqZはSpのみ）を維持したまま相関DoFを最小増分（2DoF）し、other-magic の `gap_n/gap_p` 同時改善の可否を外挿で判定する。

変更：
- 更新：`scripts/quantum/nuclear_a_dependence_mean_field.py`
  - `--step 7.13.15.18` を追加し、`B_corr = B_base + kqN ħω(A) q(N) + kqZ ħω(A) q(Z)`（`q=p(g-p)/g^2`）を導入。
  - `kqN` は mid-shell の Sn 残差で、`kqZ` は mid-shell の Sp 残差で **別々に凍結**（gap直fit禁止、観測magic近傍除外 tol=1）。
- 更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`
  - 7.13.15.18 を完了（初版）として反映し、次作業（7.13.15.19：no-go pack）を追加。
- 更新：`doc/paper/01_figures_index.md` / `doc/paper/12_part3_quantum.md`
  - 図一覧と本文の核セクションの図リストに Step 7.13.15.18 の図を追記。

出力（固定）：
- `python -B scripts/quantum/nuclear_a_dependence_mean_field.py --step 7.13.15.18`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shell_degeneracy_collective_q_sep.png`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shell_degeneracy_collective_q_sep_metrics.json`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shell_degeneracy_collective_q_sep.csv`

結果（初版）：
- `kqN≈-3.46`（fit N=508）、`kqZ≈-3.97`（fit N=374）。
- other-magic は `gap_n` RMS **8.02→9.85**、`gap_p` RMS **12.04→13.85** と悪化（metrics参照）。
- 結論：識別性を保った 2DoF の最小増分でも other-magic の `gap_n/gap_p` 同時改善は得られない。次段で no-go を固定し、モデルクラスの再設計点を定義する（7.13.15.19）。

## 2026-01-26（UTC） Phase 7（量子）/ Step 7.13.15.19：結論固定（no-go pack）として shell-gap 外挿の失敗パターンを機械的に確定（初版）

目的：
- 7.13.15.13–.18 の失敗パターン（train側は救えるが other-magic が救えない/片側を救うと片側が悪化）を、論文・ロードマップ上で再利用可能な形（no-go pack）として固定する。
- 再実装（やり直し）で同じ探索を繰り返さないよう、合否条件（棄却条件）を機械的に出力し、次の設計点へ進む。

変更：
- 更新：`scripts/quantum/nuclear_a_dependence_mean_field.py`
  - `--step 7.13.15.19` を追加し、Step 7.13.15.13–.18 の metrics JSON を読み込んで、baseline（7.13.15.16）に対する shell-gap 外挿の pass/fail を固定出力化。
  - 判定は **fit/predict 分離**を維持するため、gap 直fit を行わず、既存ステップの固定metricsを集計するだけとした。
  - other側の合格条件は「strict 同時改善（`gap_n` と `gap_p` が両方とも baseline より小さい）」とし、baseline が pass 扱いにならないようにした（no-go pack の目的上）。
- 更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`
  - 7.13.15.19 を完了（初版）として反映し、次作業（7.13.15.20：拡張相関の仕様化）を追加。
- 更新：`doc/paper/01_figures_index.md` / `doc/paper/12_part3_quantum.md`
  - 図一覧と本文の核セクションの図リストに no-go pack 図を追記。

出力（固定）：
- `python -B scripts/quantum/nuclear_a_dependence_mean_field.py --step 7.13.15.19`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_no_go_pack.png`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_no_go_pack_metrics.json`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_no_go_pack.csv`

結果（初版）：
- baseline（7.13.15.16）は train（`gap_n≈1.85`, `gap_p≈1.56`）、other（`gap_n≈8.02`, `gap_p≈12.04`）。
- 判定：train側 guardrail（`+0.5 MeV`）＋other側 strict 同時改善の条件で `n_pass_all=0`（CSV/metrics参照）。
  - 7.13.15.14 は other-magic を両方改善するが train を破綻させる。
  - 7.13.15.17 は `gap_p` は改善するが `gap_n` は悪化する（同時改善にならない）。
  - 7.13.15.18 は `gap_n/gap_p` が両方悪化する。

結論：
- 平均場+殻補正+最小ペアリング+最小相関（識別性維持）の枠組みでは、other-magic の 1n/1p shell-gap 外挿を同時に救えないことを no-go として確定した。
- 次段では configuration mixing / 変形 / 多体相関を、独立拘束→外挿判定の形で最小自由度から導入し直す（7.13.15.20）。

## 2026-01-26（UTC） Phase 7（量子）/ Step 7.13.15.20：shell-gap 失敗様式の固定（failure modes + next design pack）として magic と A で分解（初版）

目的：
- 7.13.15.19 の no-go を「どこで失敗しているか（light vs heavy / magic別 / coverage制約）」まで機械的に分解し、次に足すべき自由度と必要データ（coverage）を固定する。

変更：
- 更新：`scripts/quantum/nuclear_a_dependence_mean_field.py`
  - `--step 7.13.15.20` を追加し、baseline（7.13.15.16）の shell-gap CSV を入力として、残差を magic と A_min（domain stress test）で分解して固定出力化。
- 更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`
  - 7.13.15.20 を完了（初版）として反映し、次作業（7.13.15.21：coverage拡張）を追加。
- 更新：`doc/paper/01_figures_index.md` / `doc/paper/12_part3_quantum.md`
  - 図一覧と本文の核セクションの図リストに failure modes 図を追記。

出力（固定）：
- `python -B scripts/quantum/nuclear_a_dependence_mean_field.py --step 7.13.15.20`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_failure_modes.png`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_failure_modes_metrics.json`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_failure_modes.csv`

結果（初版；代表）：
- `gap_n` other は N=8/20 が支配的で、heavy 側（例：N=126）は小さい。A_min で見ると `gap_n` other RMS は **A>=60 で ≈0.40 MeV（n=3）**まで低下。
- `gap_p` other は現状 **Z=20 のみ**で、radii-join + 3核連鎖要件の制約により coverage が狭い（Z=28 等の評価点が不足）。

結論：
- 拡張相関（変形/configuration mixing 等）を足す前に、(i) 適用領域（A_min）と light の扱い、(ii) radii-join 依存を外す coverage 拡張（半径モデル等）を先に仕様として固定する必要がある（7.13.15.21）。

## 2026-01-26（UTC） Phase 7（量子）/ Step 7.13.15.21：coverage 拡張（凍結した半径モデルで AME2020 へ外挿し shell-gap 決着点を増やす）（初版）

目的：
- radii-join に依存していた shell-gap 評価（proton 側 other-magic の偏り）を緩和し、より広い核表（AME2020）で決着できる形へ拡張する。

変更：
- 更新：`scripts/quantum/nuclear_a_dependence_mean_field.py`
  - `--step 7.13.15.21` を追加し、IAEA radii から `r_charge=r0*A^(1/3)` を凍結（radii-only）した上で、Step 7.13.15.7 の凍結 surface-term（`C3_inf,C_surf`）を用いて AME2020 mass table へ `B_pred_mean` を外挿し、shell-gap の coverage を拡張して固定出力化。
- 更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`
  - 7.13.15.21 を完了（初版）として反映し、次作業（7.13.15.22：expanded set での決着）を追加。
- 更新：`doc/paper/01_figures_index.md` / `doc/paper/12_part3_quantum.md`
  - 図一覧と本文の核セクションの図リストに coverage expanded 図を追記。

出力（固定）：
- `python -B scripts/quantum/nuclear_a_dependence_mean_field.py --step 7.13.15.21`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_coverage_expanded.png`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_coverage_expanded_metrics.json`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_coverage_expanded.csv`

結果（初版；代表）：
- 半径モデル：`r0≈0.949 fm`（fit A>=40, n=834, RMS≈0.070 fm）。
- coverage：proton 側の gap が Z=28 等まで増え（例：`gap_Sp:28` が n=29）、radii-join の偏り（Z=20のみ）を緩和した（詳細は metrics の `coverage` を参照）。
- expanded set（A>=16）では train-magic の gap は pairing+shell で小さくできる一方、other-magic の RMS は pairing-only より shell を入れると悪化する傾向が残る（shell 写像の一般化や domain 分割が必要）。

結論：
- coverage を拡張した上で、次段は shell 写像の一般化（または light/medium/heavy の domain 分割）を no-go/棄却条件として固定し、追加自由度（変形/混合/多体）は独立拘束→外挿判定で最小化する（7.13.15.22）。

## 2026-01-26（UTC） Phase 7（量子）/ Step 7.13.15.22：expanded set 決着（domain A_min×shell 写像スキャン）で shell-gap no-go を再評価（初版）

目的：
- coverage を拡張した AME2020 セット上で、(i) domain A_min の分割、(ii) shell 写像（S_shell）の固定候補変更、が no-go を覆せるかを **追加自由度なし**で確定する。

変更：
- 更新：`scripts/quantum/nuclear_a_dependence_mean_field.py`
  - `--step 7.13.15.22` を追加し、domain A_min={16,40,60,80,100} と shell 写像2候補（`model_magic` / `obs_magic`）をスキャンして strict 判定を固定出力化。
- 更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`
  - 7.13.15.22 を完了（初版）として反映し、次作業（7.13.15.23：proton 側を救う最小増分の独立拘束DoF 設計）を追加。
- 更新：`doc/paper/01_figures_index.md` / `doc/paper/12_part3_quantum.md`
  - 図一覧と本文の核セクションの図リストに decision scan 図を追記。

出力（固定）：
- `python -B scripts/quantum/nuclear_a_dependence_mean_field.py --step 7.13.15.22`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded.png`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_metrics.json`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded.csv`

結果（初版；代表）：
- strict 判定では `strict_pass=0/10`（train は改善するが、other-magic の 1n/1p shell-gap を同時に救えない）。
- domain 分割だけでは不十分：A_min を上げると other の悪化は小さくなるが、proton 側 other は依然として改善しない（または coverage が 0 になる）。
- `obs_magic` は neutron 側 other の改善には効き得る（例：A>=60 で `gap_Sn` other RMS **1.12→0.41 MeV**）一方、proton 側 other は悪化（例：`gap_Sp` other RMS **0.77→1.20 MeV**）。

結論：
- domain 分割と固定 S_shell のみでは、neutron/proton の other-magic を同時に救えない。次段は proton 側を救う最小増分の相関/多体DoF を **独立拘束→凍結→外挿判定** の形で導入し直す（7.13.15.23）。

## 2026-01-26（UTC） Phase 7（量子）/ Step 7.13.15.23：独立拘束DoF（半径の isospin 依存）で proton 側 shell-gap を救えるかを検証（初版）

目的：
- 7.13.15.22 の no-go（proton 側 other が落ちる）に対して、**独立に凍結できる最小増分**として半径モデルを isospin 拡張し、expanded set の strict 判定で決着する。

変更：
- 更新：`scripts/quantum/nuclear_a_dependence_mean_field.py`
  - `--step 7.13.15.23` を追加し、半径モデルを `r_charge=(r0+rI*I)A^{1/3}`（I=(N-Z)/A）へ拡張（radii-only で凍結、mass/gap による最適化は行わない）して、7.13.15.22 と同一の strict 判定で再評価。
- 更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`
  - 7.13.15.23 を完了（初版）として反映し、次作業（7.13.15.24：proton 特有の自由度なし補正）を追加。
- 更新：`doc/paper/01_figures_index.md` / `doc/paper/12_part3_quantum.md`
  - 図一覧と本文の核セクションの図リストに radii-isospin decision scan 図を追記。

出力（固定）：
- `python -B scripts/quantum/nuclear_a_dependence_mean_field.py --step 7.13.15.23`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_radii_isospin.png`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_radii_isospin_metrics.json`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_radii_isospin.csv`

結果（初版；代表）：
- 半径フィット（radii-only）：`r0≈0.989 fm`, `rI≈-0.240 fm`（A>=40, n=834, fit RMS≈0.049 fm）。
- strict 判定：`strict_pass=0/10`。半径の isospin 依存を入れても、proton 側 other-magic shell-gap は改善しない（むしろ悪化傾向）。

結論：
- 半径モデルの最小拡張（独立拘束DoF）では proton 側 shell-gap の no-go は覆らない。次段は proton 特有の補正（例：Coulomb exchange）を **自由パラメータなし（または独立拘束）**で追加し、strict 判定で再評価する（7.13.15.24）。

## 2026-01-27（UTC） Phase 7（量子）/ Step 7.13.15.24：Coulomb exchange（Slater）を自由度なしで追加し、expanded set の strict 判定で再評価（初版）

目的：
- 7.13.15.23（半径 isospin 拡張）でも proton 側 other-magic shell-gap が救えなかったため、proton 特有の決定論補正として Coulomb exchange（Slater 近似）を **自由パラメータなし**で追加し、同一の凍結手順で strict 判定を再評価する。

変更：
- 更新：`scripts/quantum/nuclear_a_dependence_mean_field.py`
  - `--step 7.13.15.24` を追加し、7.13.15.21 の凍結半径モデル（`r_charge=r0*A^{1/3}`）を採用して AME2020 へ外挿。
  - energy model に Coulomb exchange（Slater 近似）を `E_x/A` として加算し、7.13.15.22 と同一の手順（pairing OES → kN/kZ refreeze → strict 判定）で decision scan を再実行。
- 更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`
  - 7.13.15.24 を完了（初版）として反映し、次作業（7.13.15.25：Coulomb/finite-size 補正）を追加。
- 更新：`doc/paper/01_figures_index.md` / `doc/paper/12_part3_quantum.md`
  - 図一覧と本文の核セクションの図リストに Coulomb exchange decision scan 図を追記。

出力（固定）：
- `python -B scripts/quantum/nuclear_a_dependence_mean_field.py --step 7.13.15.24`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_coulomb_exchange.png`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_coulomb_exchange_metrics.json`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_coulomb_exchange.csv`

結果（初版；代表）：
- strict 判定：`strict_pass=0/10`（domain A_min×S_shell 2候補）。Coulomb exchange の追加だけでは proton 側 other-magic shell-gap の no-go は覆らない。
- 例：`obs_magic` + A>=60
  - `gap_Sn` other：RMS **1.12→0.41 MeV**
  - `gap_Sp` other：RMS **0.77→1.20 MeV**（ΔRMS ≈ +0.43 MeV）

結論：
- Coulomb exchange（Slater）だけでは proton 側 other-magic を救えない。次段は Coulomb/finite-size（電荷分布の非一様性）等の決定論補正を **独立拘束（固定）**で追加するか、構造DoF（独立拘束）を追加して strict 判定で再評価する（7.13.15.25）。

## 2026-01-27（UTC） Phase 7（量子）/ Step 7.13.15.25：Coulomb/finite-size（2pF+Slater）を自由度なしで追加し、expanded set の strict 判定で再評価（初版）

目的：
- 7.13.15.24（uniform gas の Slater exchange）でも proton 側 other-magic shell-gap が救えなかったため、uniform sphere 近似に起因する系統として Coulomb を finite-size（電荷分布の非一様性）へ拡張し、同一の凍結手順で strict 判定を再評価する。

変更：
- 更新：`scripts/quantum/nuclear_a_dependence_mean_field.py`
  - `--step 7.13.15.25` を追加し、Coulomb direct を 2pF（固定 `a`）へ置換し、Slater（LDA）で Coulomb exchange を追加（いずれも自由パラメータの最適化は行わない）。
- 更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`
  - 7.13.15.25 を完了（初版）として反映し、次作業（7.13.15.26：半径 isospin 拡張＋finite-size Coulomb の組み合わせ）を追加。
- 更新：`doc/paper/01_figures_index.md` / `doc/paper/12_part3_quantum.md`
  - 図一覧と本文の核セクションの図リストに finite-size Coulomb decision scan 図を追記。

出力（固定）：
- `python -B scripts/quantum/nuclear_a_dependence_mean_field.py --step 7.13.15.25`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_coulomb_finite_size.png`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_coulomb_finite_size_metrics.json`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_coulomb_finite_size.csv`

結果（初版；代表）：
- strict 判定：`strict_pass=0/10`（domain A_min×S_shell 2候補）。finite-size Coulomb の追加だけでは proton 側 other-magic shell-gap の no-go は覆らない。
- 例：`obs_magic` + A>=60
  - `gap_Sn` other：RMS **1.12→0.41 MeV**
  - `gap_Sp` other：RMS **0.77→1.20 MeV**（ΔRMS ≈ +0.44 MeV）

結論：
- Coulomb/finite-size（2pF+Slater）だけでは proton 側 other-magic を救えない。次段は、radii-only で独立凍結した半径 isospin 拡張（7.13.15.23）と組み合わせ、isobar 間の半径差を取り込んだ上で strict 判定を再評価する（7.13.15.26）。

## 2026-01-27（UTC） Phase 7（量子）/ Step 7.13.15.26：半径 isospin 拡張（独立凍結）＋ Coulomb/finite-size（2pF+Slater）を組み合わせ、expanded set の strict 判定で再評価（初版）

目的：
- 7.13.15.25（finite-size Coulomb）でも proton 側 other-magic shell-gap が救えなかったため、radii-only で独立凍結した半径 isospin 拡張（7.13.15.23）と、決定論補正である Coulomb/finite-size（2pF+Slater）を組み合わせ、同一の凍結手順で strict 判定を再評価する。

変更：
- 更新：`scripts/quantum/nuclear_a_dependence_mean_field.py`
  - `--step 7.13.15.26` を追加し、7.13.15.23 の凍結半径モデル `r_charge=(r0+rI*I)A^{1/3}`（I=(N-Z)/A）を採用。
  - Coulomb/finite-size（2pF direct + Slater exchange）を半径の核種依存で適用し（`a=0.523 fm` 固定、`c` は `r_rms` から bisection）、7.13.15.22 と同一の手順（pairing OES → kN/kZ refreeze → strict 判定）で decision scan を再実行。
- 更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`
  - 7.13.15.26 を完了（初版）として反映し、次作業（7.13.15.27：shell/structure DoF 追加）を追加。
- 更新：`doc/paper/01_figures_index.md` / `doc/paper/12_part3_quantum.md`
  - 図一覧と本文の核セクションの図リストに 7.13.15.26 decision scan 図を追記。

出力（固定）：
- `python -B scripts/quantum/nuclear_a_dependence_mean_field.py --step 7.13.15.26`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_radii_isospin_coulomb_finite_size.png`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_radii_isospin_coulomb_finite_size_metrics.json`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_radii_isospin_coulomb_finite_size.csv`

結果（初版；代表）：
- strict 判定：`strict_pass=0/10`（domain A_min×S_shell 2候補）。半径 isospin 拡張と finite-size Coulomb の組合せでも no-go は覆らない。
- 例：`obs_magic` + A>=60
  - `gap_Sn` other：RMS **1.10→0.353 MeV**
  - `gap_Sp` other：RMS **0.625→1.487 MeV**（ΔRMS ≈ +0.86 MeV）

結論：
- 半径写像（独立拘束）と Coulomb の決定論補正を組み合わせても、proton 側 other-magic shell-gap を救えない。次段は shell/structure DoF を追加し、train で凍結→other で棄却する形で strict 判定を再評価する（7.13.15.27）。

## 2026-01-27（UTC） Phase 7（量子）/ Step 7.13.15.27：shell refreeze を isospin 依存で拡張し（train 凍結→other 棄却）、expanded set の strict 判定で再評価（初版）

目的：
- 7.13.15.22〜7.13.15.26 の一連の独立拘束（半径写像）・決定論補正（Coulomb）でも proton 側 other-magic shell-gap が救えない no-go が残ったため、最小追加DoFとして shell refreeze 係数を isospin 非対称度 I=(N-Z)/A に依存させ、train で凍結→other で棄却する形で strict 判定を再評価する。

変更：
- 更新：`scripts/quantum/nuclear_a_dependence_mean_field.py`
  - `--step 7.13.15.27` を追加し、ベースラインは 7.13.15.26（半径 isospin 拡張＋ Coulomb/finite-size）と同一に固定。
  - 追加DoF候補として shell refreeze を `kN(I)=kN0+kN1*I`、`kZ(I)=kZ0+kZ1*I` に拡張し、係数（kN0,kN1,kZ0,kZ1）は train magic（N/Z∈{50,82}）のみにより凍結、other-magic は棄却判定にのみ使用（p-hacking 回避）。
- 更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`
  - 7.13.15.27 を完了（初版）として反映し、次作業（7.13.15.28：独立拘束の構造入力の導入）を追加。
- 更新：`doc/paper/01_figures_index.md` / `doc/paper/12_part3_quantum.md`
  - 図一覧と本文の核セクションの図リストに 7.13.15.27 decision scan 図を追記。

出力（固定）：
- `python -B scripts/quantum/nuclear_a_dependence_mean_field.py --step 7.13.15.27`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_shell_i_dep.png`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_shell_i_dep_metrics.json`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_shell_i_dep.csv`

結果（初版；代表）：
- strict 判定：`strict_pass=0/10`（domain A_min×S_shell 2候補）。isospin 依存の shell refreeze を入れても proton 側 other-magic shell-gap の no-go は覆らない。
- 例：`obs_magic` + A>=60
  - `gap_Sn` other：RMS **0.564 MeV**（n=18）
  - `gap_Sp` other：RMS **1.64 MeV**（n=19）
- 注意：A>=80 以上では `gap_Sp` other の coverage が 0 となり（RMS が NaN）、決着点として不適。

結論：
- 最小追加DoF（isospin 依存の shell refreeze）でも no-go は残る。次段は、独立拘束可能な構造入力（例：変形パラメータ・分光情報）を追加し、train 凍結→other 棄却の strict 判定で再評価する（7.13.15.28）。

## 2026-01-27（UTC） Phase 7（量子）/ Step 7.13.15.28：独立拘束の変形入力（β2; NNDC B(E2) adopted）を導入し、Coulomb shape factor として deterministic に反映して strict 再評価（初版）

目的：
- 7.13.15.27 までの最小追加DoF（isospin 依存 shell refreeze）でも proton 側 other-magic shell-gap の no-go が残ったため、**独立拘束可能**な構造入力として変形パラメータ β2（NNDC B(E2) adopted entries）を導入し、決定論的写像のまま strict 判定で再評価する。

変更：
- 更新：`scripts/quantum/nuclear_a_dependence_mean_field.py`
  - β2 を Coulomb shape factor f(β2) として finite-size Coulomb（2pF+Slater）へ反映するオプションを追加（`--step 7.13.15.28` は 7.13.15.27 の手順を再利用）。
  - β2 の欠損を direct / imputed / missing に分類してカウントし、metrics に coverage を保存（p-hacking 回避のため deterministic ルール固定）。
  - 既存ステップ（7.13.15.6/7.13.15.26 等）に紛れ込んでいた `include_beta2` 参照を除去し、Step 7.13.15.28 を安定化。
- 更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`
  - 7.13.15.28 を完了（初版）として反映し、次作業（7.13.15.29）を追加。

出力（固定）：
- `python -B scripts/quantum/nuclear_a_dependence_mean_field.py --step 7.13.15.28`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_shell_i_dep_beta2.png`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_shell_i_dep_beta2_metrics.json`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_shell_i_dep_beta2.csv`

結果（初版；代表）：
- strict 判定：**strict_pass=0/10**（domain A_min×S_shell 2候補）。β2（Coulomb shape）の追加でも proton 側 other-magic shell-gap の no-go は覆らない。
- β2 coverage（in-domain A>=16, n=3487）：direct=423 / imputed=1553 / missing=1511（欠損が多い）。

結論：
- β2 を Coulomb へ導入しても no-go は残る。次段は β2 の表面項反映や、coverage を strict に組み込むなど、独立拘束入力の追加・強化で再評価する（7.13.15.29）。

## 2026-01-27（UTC） Phase 7（量子）/ Step 7.13.15.29：expanded set：β2 を Coulomb+surface に deterministic に反映し、coverage（direct-only vs imputed）を strict に組み込んで再評価（初版）

目的：
- 7.13.15.28（β2 を Coulomb shape factor として導入）では、β2 欠損が多く、かつ imputation を含む評価が「p-hacking（窓・前処理依存）」に見えやすい点が残った。そこで (i) β2 の効果を Coulomb だけでなく surface（面積因子）へも反映し、(ii) coverage を direct-only / imputed の二系統で再計算し、最終判定は strict に統合（AND）して頑健性を固定する。

変更：
- 更新：`scripts/quantum/nuclear_a_dependence_mean_field.py`
  - β2 の体積保存回転楕円体の表面積比 `g(β2)` を導入し、surface 項へ deterministic に反映（自由度追加なし）。
  - decision scan を 2系統（imputed / direct-only）で再計算し、`pass_strict := pass_strict_primary AND pass_strict_direct_only` で統合して保存（imputation 依存を strict に隔離）。
  - バグ修正：decision scan の後処理で `r0` をループ変数として上書きしていたため、変数名を変更して `TypeError` を回避。
- 更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`
  - 7.13.15.29 を完了（初版）として反映し、次作業（7.13.15.30：分光一次ソースの追加）を追加。

出力（固定）：
- `python -B scripts/quantum/nuclear_a_dependence_mean_field.py --step 7.13.15.29`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_shell_i_dep_beta2_surface_cov.png`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_shell_i_dep_beta2_surface_cov_metrics.json`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_shell_i_dep_beta2_surface_cov.csv`

結果（初版；代表）：
- strict 判定：`strict_pass=0/10`（domain A_min×S_shell 2候補）。β2 の Coulomb+surface 反映、および coverage strict 統合でも no-go は覆らない。
- in-domain（A>=16）n=3487
- β2 coverage（metrics；in-domain A>=16）：
  - imputed run：direct=423 / imputed=1553 / missing=1511
  - direct-only run：direct=423 / missing=3064
- strict 統合：`pass_strict := pass_strict_primary AND pass_strict_direct_only`（direct-only を落とす候補は自動的に失格）

結論：
- β2 の shape を surface へ拡張し、imputation を排した direct-only 判定まで AND 統合しても no-go 継続。次段は shell closure の別系統指標（分光データ E(2+1) 等）を一次ソースとして追加し、strict 棄却条件を cross-check として固定する（7.13.15.30）。

## 2026-01-27（UTC） Phase 7（量子）/ Step 7.13.15.30：分光一次ソース E(2+_1)（NNDC）を追加し、shell closure 指標として別系統で交差検証（peak strict）（初版）

目的：
- 7.13.15.29 まで（β2 を Coulomb+surface に導入し、coverage を strict に統合）でも shell-gap no-go が残ったため、「shell closure がどこで決着するか」を分光データ（E(2+_1)）で別系統に固定し、p-hacking を避けた cross-check（strict）として統合する。

変更：
- 更新：`scripts/quantum/fetch_nuclear_deformation_be2_sources.py`
  - NNDC B(E2) adopted entries の `transitionEnergy` を E(2+_1) proxy（keV）として抽出し、`data/quantum/sources/nndc_be2_adopted_entries/extracted_e2plus.json` に保存（manifest に追記）。
- 更新：`scripts/quantum/nuclear_a_dependence_mean_field.py`
  - `--step 7.13.15.30` を追加し、decision scan に分光ピーク（±2近傍の局所最大）フィルタを導入して `pass_strict_spectro` を固定（strict に AND 統合）。
  - 追加出力：E(2+_1) の N/Z 診断図を固定名で生成。
- 更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json` / `doc/PRIMARY_SOURCES.md`
  - 7.13.15.30 を完了（初版）として反映し、次作業（7.13.15.31：ENSDF/NuDat 等で coverage 拡大）を追加。

出力（固定）：
- `python -B scripts/quantum/nuclear_a_dependence_mean_field.py --step 7.13.15.30`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_shell_i_dep_beta2_surface_cov_e2plus.png`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_shell_i_dep_beta2_surface_cov_e2plus_metrics.json`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_shell_i_dep_beta2_surface_cov_e2plus.csv`
  - `output/quantum/nuclear_a_dependence_hf_three_body_e2plus_diagnostics_expanded_shell_i_dep_beta2_surface_cov_e2plus.png`

結果（初版；代表）：
- strict 判定：`strict_pass=0/10`（domain A_min×S_shell 2候補）。分光ピーク strict（E(2+_1)）を入れても no-go は覆らない。
- 例（1候補）：spectro peak counts（gapベース）：`gap_Sn` n_peak=32 / `gap_Sp` n_peak=36（metrics 参照）

結論：
- 分光一次ソース（E(2+_1)）を cross-check（peak strict）として統合しても no-go 継続。次段は ENSDF/NuDat 等で E(2+_1) の coverage を拡大し、同一 strict で cross-check を強化する（7.13.15.31）。

## 2026-01-27（UTC） Phase 7（量子）/ Step 7.13.15.31：expanded set：NuDat 3.0 で E(2+_1) の coverage を拡大し、分光 cross-check を強化（strict 固定）（初版）

目的：
- 7.13.15.30 では NNDC B(E2) adopted entries の `transitionEnergy` を E(2+_1) proxy として利用したが、coverage が限定される。そこで NuDat 3.0（chart data JSON）を一次ソースとしてキャッシュし、E(2+_1) をより広い核種範囲で固定して同一 strict プロトコルで cross-check を強化する。

変更：
- 追加：`scripts/quantum/fetch_nuclear_spectroscopy_e2plus_sources.py`
  - NuDat 3.0 の static JSON（primary.json / secondary.json）をキャッシュし、`excitedStateEnergies.firstTwoPlusEnergy`（keV）を E(2+_1) として抽出して `data/quantum/sources/nndc_nudat3_primary_secondary/extracted_e2plus.json` に保存（offline 再現）。
- 更新：`scripts/quantum/nuclear_a_dependence_mean_field.py`
  - 7.13.15.31 を追加し、7.13.15.30 と同一の「分光ピーク（±2近傍の局所最大）strict」cross-check を NuDat3 E(2+_1) に置換して再計算（decision scan の strict に AND 統合）。
- 更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json` / `doc/PRIMARY_SOURCES.md`
  - 7.13.15.31 を完了（初版）として反映し、次作業（7.13.15.32：分光 cross-check の多指標化）を追加。

出力（固定）：
- `python -B scripts/quantum/fetch_nuclear_spectroscopy_e2plus_sources.py`
  - `data/quantum/sources/nndc_nudat3_primary_secondary/extracted_e2plus.json`（E(2+_1) 抽出；diag: n_rows=666）
- `python -B scripts/quantum/nuclear_a_dependence_mean_field.py --step 7.13.15.31`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_shell_i_dep_beta2_surface_cov_e2plus_nudat3.png`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_shell_i_dep_beta2_surface_cov_e2plus_nudat3_metrics.json`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_shell_i_dep_beta2_surface_cov_e2plus_nudat3.csv`
  - `output/quantum/nuclear_a_dependence_hf_three_body_e2plus_diagnostics_expanded_shell_i_dep_beta2_surface_cov_e2plus_nudat3.png`

結果（初版；代表）：
- strict 判定：`strict_pass=0/10`（domain A_min×S_shell 2候補）。NuDat3 による coverage 拡大でも no-go は覆らない。

結論：
- E(2+_1) の一次ソースを NuDat 3.0 へ拡張して cross-check を強化しても no-go 継続。次段は E(2+_1) 単独ではなく、追加の分光指標（例：R4/2, 0+_2, E(3-_1) など）を strict に統合し、「shell closure proxy」の別系統 cross-check を増やして識別性を強化する（7.13.15.32）。

## 2026-01-27（UTC） Phase 8（論文化）/ Step 8.2.2：Part I（コア理論）の改稿（量子辞書深化／差分予測の具体化／概念比較図の追加）（改稿）

目的：
- Part I を「P-model固有の視点（写像凍結棄却）」で閉じ、Part III への橋渡し（量子の位置づけ）と、反証可能性（どのクラスの観測で決着するか）を論文体裁として強化する。

変更：
- 更新：`doc/paper/10_part1_core_theory.md`
  - 2.8（量子）を「最小辞書」だけでなく、P-model内での位置づけ（束縛モード/伝播モード/光子、位相情報、測定、もつれ）として説明し、Part III の反証条件へ接続する形へ改稿。
  - 4.1（差分予測）を抽象列挙から、決着条件の要点（到来方向偏向／強場形状指標／距離指標非依存量）として具体化。
  - 3.3 見出しを「共通パラメータ（β）と凍結手順」へ修正（δをコアに含めない方針の整合）。
  - 図2として概念比較図（P-model vs 参照枠（GR））を追加。
- 追加：`scripts/theory/pmodel_core_concept_comparison.py` → `output/theory/pmodel_core_concept_comparison.png`
- 更新：`scripts/theory/pmodel_core_mapping_overview.py` → `output/theory/pmodel_core_mapping_overview.png`
  - 図1の本文から δ の記述を除去し、「Part Iコアに δ を入れない」方針と整合。
- 更新：`doc/paper/01_figures_index.md`
  - Part I 図2（概念比較図）を追加。
- 更新：`scripts/summary/run_all.py`
  - 概念図（図1/図2）生成を run_all に追加し、full pipeline で再生成できるようにした。

結論：
- Part I の「基準書」としての軸（P-model主語／参照枠隔離／反証可能性）を強化し、Part II/III へ読み進めたときに統一性が崩れない導線を追加した。

## 2026-01-27（UTC）追記：paper_qc（lint strict）の citation key 競合を解消

背景：
- Part I の共通棄却手順（3.0）で `[Input]` 等の角括弧ラベルを用いていたため、lint が引用キーとして誤認し（references未定義）、paper_qc が失敗していた。

対応：
- 更新：`doc/paper/10_part1_core_theory.md`
  - `[Input]/[Frozen]/[Output]/[Statistic]/[Reject]` を `**Input**` 等へ置換し、引用キー競合を回避。
- 確認：`python -B scripts/summary/paper_qc.py` → ok: True（paper_lint_strict: True）

## 2026-01-27（UTC） Phase 7（量子）/ Step 7.13.15.32：expanded set：分光 cross-check を多指標化（NuDat 3.0：E(2+_1), E(4+_1), E(3-_1), R4/2）し、strict に統合して再評価（初版）

目的：
- 7.13.15.30–.31 の E(2+_1) 単独の cross-check では「shell closure proxy」としての識別性が不足する可能性があるため、NuDat 3.0 から追加の分光指標を抽出し、p-hacking を避けた形で strict に統合する。

変更：
- 更新：`scripts/quantum/fetch_nuclear_spectroscopy_e2plus_sources.py`
  - NuDat 3.0 chart JSON（primary.json / secondary.json）をキャッシュし、`excitedStateEnergies` から multi 指標を抽出して `data/quantum/sources/nndc_nudat3_primary_secondary/extracted_spectroscopy.json` を追加（offline 再現）。
- 更新：`scripts/quantum/nuclear_a_dependence_mean_field.py`
  - 7.13.15.32 を追加し、decision scan の strict に `pass_strict_spectro_multi`（E2+, E4+, E3-, R4/2 の local extrema）を AND 統合。
  - 分光の multi 指標を可視化する診断図（N/Z）を追加。
- 更新：`doc/ROADMAP.md` / `doc/PRIMARY_SOURCES.md` / `doc/paper/01_figures_index.md` / `doc/paper/12_part3_quantum.md`
  - 7.13.15.32 を完了（初版）として反映し、一次ソース（NuDat 3.0）派生ファイルと図表インデックスを更新。

出力（固定）：
- `python -B scripts/quantum/fetch_nuclear_spectroscopy_e2plus_sources.py`
  - `data/quantum/sources/nndc_nudat3_primary_secondary/extracted_spectroscopy.json`（E(2+_1), E(4+_1), E(3-_1), R4/2 抽出）
- `python -B scripts/quantum/nuclear_a_dependence_mean_field.py --step 7.13.15.32`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3.png`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_metrics.json`
  - `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3.csv`
  - `output/quantum/nuclear_a_dependence_hf_three_body_spectroscopy_diagnostics_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3.png`

結果（初版；代表）：
- strict 判定：`strict_pass=0/10`（domain A_min×S_shell 2候補）。分光 multi-metric strict を追加しても no-go は覆らない。

結論：
- E(2+_1) 単独から multi 指標へ拡張しても no-go 継続。次段は shell/構造入力の追加（別系統の独立拘束）か、S_shell の最小形を超えたモデル化の必要性を評価する。

## 2026-01-27（UTC） Phase 8（論文化）/ Step 8.2.3：Part I/II/III（publish体裁）の冗長・表記揺れを修正（本文 badge/図キャプション/棄却プロトコル/自由度台帳）

目的：
- publish HTML（およびDOCX化）で読者が引っかかる冗長・表記揺れを除去し、Part I/II/III の統一体裁（主語はP-model／参照枠はReference note隔離／反証可能性中心）を補強する。

変更：
- 更新：`scripts/summary/paper_html.py`
  - 本文セクションの `badge="本文"` を除去し、目次後の「本文」「本文」連続を解消（H2のみ残す）。
- 更新：`doc/paper/10_part1_core_theory.md`
  - 2.0 図1/図2の括弧内キャプション（重複要因）を除去し、figcaption（図表インデックス側）へ集約。
  - 2.2 の「批判を避けるため」を、射程に基づく最小形採用の文言へ言い換え。
  - 2.5 見出しを「背景Pによる赤方偏移：写像の固定」へ修正し、Part II への委譲宣言を冗長化しない形へ圧縮。
  - 3.0 共通棄却手順の統計表記を χ²/logL/ΔAIC へ明確化。
  - LaTeX表記（`\\rm` 等）を正規化（`\\mathrm{}`）し、DOCX数式変換での欠落リスクを低減。
- 更新：`doc/paper/01_figures_index.md`
  - 図2キャプションの「図2:」重複を除去し、キャプションを短文化。
- 更新：`doc/paper/05_definitions.md`
  - A.0（自由度台帳）の表ヘッダを短く整理し、Statusの意味を表外へ分離（Word表として読める体裁へ）。
  - A.3.1 の LaTeX 表記（`\\rm` 等）を正規化。
- 更新：`doc/paper/11_part2_astrophysics.md` / `doc/paper/12_part3_quantum.md`
  - 共通棄却手順のラベルを `**Input**` 等へ統一し、paper_lint の citation key 誤認（`[Input]` 等）を回避。
  - 統計表記（χ²/logL/ΔAIC）と閾値表記（ΔAIC>10）を Part I と統一。

確認：
- `python -B scripts/summary/paper_build.py --profile paper --mode publish --outdir output/summary --skip-docx`
- `python -B scripts/summary/paper_build.py --profile part2_astrophysics --mode publish --outdir output/summary --skip-docx`
- `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`
- `python -B scripts/summary/paper_qc.py` → ok: True（lint strict / 図番号連番 / 数式alt 等）

結論：
- publish体裁の冗長（本文ラベル重複／図キャプション重複）と表記揺れ（棄却プロトコル／宇宙論節見出し）を解消し、三部作の統一性と読みやすさを改善した。

## 2026-01-27（UTC） Phase 7（量子）/ Step 7.13.15.33：expanded set：S_shell の g^power 正規化を g^2（power=2）へ変更し、strict を再評価（初版）

目的：
- shell-gap no-go（other-magic）に対して、S_shell の最小形（g^1）を固定したままでは外挿改善が見込めない可能性があるため、「shell term の規格化」を最小自由度（power_g）で拡張し、改善の有無を機械的に判定する。

変更：
- 更新：`scripts/quantum/nuclear_a_dependence_mean_field.py`
  - S_shell を `p(p-g)/g^power` として power を切替可能にし、metrics に `power_g` を記録。
  - `--step 7.13.15.33` を追加し、NuDat3 multi + β2 + surface_cov を維持したまま `power=2` を適用。
- 更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`
  - 7.13.15.33 を完了（初版）として反映し、次作業（7.13.15.34：電荷半径 kink の strict 統合）を追加。
- 更新：`doc/paper/12_part3_quantum.md` / `doc/paper/01_figures_index.md`
  - 7.13.15.33 の固定出力（shellS_g2）を論文の出力一覧と図表インデックスへ追記。

実行：`python -B scripts/quantum/nuclear_a_dependence_mean_field.py --step 7.13.15.33`

出力（固定）：
- `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_shellS_g2.png`
- `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_shellS_g2.csv`
- `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_shellS_g2_metrics.json`
- `output/quantum/nuclear_a_dependence_hf_three_body_spectroscopy_diagnostics_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_shellS_g2.png`

結果（初版；代表）：
- strict 判定：`strict_pass=0/10`（no-go 継続）。S_shell の g^2 正規化は other-magic の改善に寄与しない。

結論：
- S_shell の規格化（g^2）でも no-go は覆らない。次段は真の独立拘束（例：電荷半径 kink 等）を strict に統合し、p-hacking を避けた形で識別性を強化する。

## 2026-01-27（UTC） Phase 7（量子）/ Step 7.13.15.34：expanded set：電荷半径の kink（同位体シフト）を shell closure proxy として strict に統合（初版）

目的：
- shell-gap no-go（other-magic）に対して、分光（NuDat3 multi）とは独立な一次入力として IAEA 電荷半径の同位体シフト（kink）を導入し、strict の独立クロスチェックを増やす。
- kink の定義（2階差分・step=2・閾値）を固定して p-hacking を禁止し、fit/predict を分離した形で運用する。

変更：
- 更新：`scripts/quantum/nuclear_a_dependence_mean_field.py`
  - 7.13.15.27 の decision scan に、電荷半径 kink proxy を追加（IAEA radii；Δ²r と独立σ伝播）し、strict にAND統合できるよう拡張。
  - `--step 7.13.15.34` を追加し、NuDat3 multi + β2 + surface_cov の設定を維持したまま kink strict を適用。
  - 診断図：`...radii_kink_diagnostics_*.png` を固定出力し、metrics baseline に kink 定義と counts を保存。
- 更新：`doc/ROADMAP.md` / `doc/paper/12_part3_quantum.md` / `doc/paper/01_figures_index.md`
  - 7.13.15.34 を完了（初版）として反映し、出力一覧と図表インデックスへ追記。
  - 次段（7.13.15.35：kink を「観測量（Δ²r）」として直接比較）を準備中として追加。

実行：`python -B scripts/quantum/nuclear_a_dependence_mean_field.py --step 7.13.15.34`

出力（固定）：
- `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_radii_kink.png`
- `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_radii_kink.csv`
- `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_radii_kink_metrics.json`
- `output/quantum/nuclear_a_dependence_hf_three_body_spectroscopy_diagnostics_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_radii_kink.png`
- `output/quantum/nuclear_a_dependence_hf_three_body_radii_kink_diagnostics_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_radii_kink.png`

確認：
- `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`
- `python -B scripts/summary/paper_qc.py` → ok: True

結果（初版；代表）：
- strict 判定：`strict_pass=0/10`（no-go 継続）
- kink strict：`pass_radii_kink=10/10`（この定義では discriminative にならず）

結論：
- kink proxy の strict 統合は完了したが、主判定（other-magic 救済）は依然 no-go。次段は kink を「選別」ではなく「観測量（Δ²r）」として直接比較し、棄却条件を強く固定する。

## 2026-01-27（UTC） Phase 8（論文化）/ Step 8.4：pmodel_paper（Part I）体裁修正（矢印・数式欠落に見える空白・箇条書き・図キャプション・付録表）

目的：
- 読者の信頼に直結する「欠落に見えない」体裁へ優先的に修正する（Word/DOCX 取り込み時も含む）。

変更：
- 更新：`doc/paper/10_part1_core_theory.md`
  - 2.1：`要請（P内部）→帰結：` の矢印を復帰し、主要式（静止時計写像・u・点質量）を本文にも明示して「数式欠落に見える空白」を抑制。
  - 2.6：箇条書きが崩れる原因（数式ブロックのHTML挿入）を避けるため、最小動力学仮定/放射要件を通常段落へ整理。
  - 2.0：図挿入の前置き（`**図**：`）を除去し、キャプションを `図1:` 形式に統一。
- 更新：`doc/paper/05_definitions.md`
  - A.0：`Status の意味` を箇条書きとして解釈されるよう空行を追加。
  - A.3.1：括弧の誤読防止に「誤読例/正しい式」を追記して空白に見えない形へ。
- 更新：`scripts/summary/paper_html.py`
  - 図の `<figure>` が `<p>` にネストされる問題を除去し、`図：図1:` の冗長表示を抑制。
  - Word HTML 取り込みで表が「縦並び」に見えやすい問題に対し、`<table>` に border/cellpadding を付与。
- 更新：`scripts/summary/html_to_docx.py`
  - Word 取り込み後の表に border を有効化し、A.0 自由度台帳が「表」に見えることを優先。
  - Word 数式（OMML）の段落余白を詰め、「数式欠落に見える空白」を低減。

確認：
- `python -B scripts/summary/paper_build.py --profile paper --mode publish --outdir output/summary --skip-docx`
- `python -B scripts/summary/paper_qc.py` → ok: True（`output/summary/paper_qc.json`）

出力：
- `output/summary/pmodel_paper.html`
- `output/summary/paper_qc.json`

## 2026-01-27（UTC） Phase 7（量子）/ Step 7.13.15.35：expanded set：電荷半径 kink を「観測量（Δ²r）」として直接比較し、棄却条件（σ_obs）を strict にAND統合（初版）

目的：
- 7.13.15.34 の kink strict（proxy選別）は discriminative になりにくいため、凍結した半径写像から Δ²r_pred を計算し、IAEA の Δ²r_obs と直接比較して棄却条件を固定する。

変更：
- 更新：`scripts/quantum/nuclear_a_dependence_mean_field.py`
  - 7.13.15.27 の decision scan に `include_radii_kink_delta2r` を追加し、評価統計 `(Δ²r_pred-Δ²r_obs)/σ_obs(Δ²r)`（step=2、独立σ伝播）を計算して strict にAND統合。
  - `--step 7.13.15.35` を追加し、NuDat3 multi + β2 + surface_cov の設定を維持したまま Δ²r strict を適用。
  - 診断出力：Δ²r 残差の `...radii_kink_delta2r_diagnostics_*.png` と点ごとの `...radii_kink_delta2r_*.csv` を固定出力。
- 更新：`doc/ROADMAP.md` / `doc/paper/12_part3_quantum.md` / `doc/paper/01_figures_index.md`
  - 7.13.15.35 を完了（初版）として反映し、出力一覧と図表インデックスへ追記。

実行：`python -B scripts/quantum/nuclear_a_dependence_mean_field.py --step 7.13.15.35`

出力（固定）：
- `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_radii_kink_delta2r.png`
- `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_radii_kink_delta2r.csv`
- `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_radii_kink_delta2r_metrics.json`
- `output/quantum/nuclear_a_dependence_hf_three_body_spectroscopy_diagnostics_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_radii_kink_delta2r.png`
- `output/quantum/nuclear_a_dependence_hf_three_body_radii_kink_delta2r_diagnostics_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_radii_kink_delta2r.png`
- `output/quantum/nuclear_a_dependence_hf_three_body_radii_kink_delta2r_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_radii_kink_delta2r.csv`

結果（初版；代表）：
- strict 判定：`strict_pass=0/10`（no-go 継続）
- Δ²r strict：`pass_radii_kink_delta2r=0/10`（A_min=16 の代表で max |resid|/σ_obs ≈ 15.5（x=N）/19.1（x=Z））

結論：
- 凍結半径写像（7.13.15.23；radii-only fit）では電荷半径 kink（Δ²r）を σ_obs 基準で再現できず、半径の shell/構造効果は独立入力として必要（あるいは半径写像自体の拡張が必要）であることが、棄却条件として固定された。

## 2026-01-27（UTC） Phase 7（量子）/ Step 7.13.15.36：expanded set：半径写像に最小 shell 項（r_shell）を導入し、Δ²r strict を再評価（初版）

目的：
- 7.13.15.35 で Δ²r mismatch が大きく、凍結半径写像（r_charge）が shell/構造効果を吸収できていないことが判明した。次段では、半径写像に最小の shell 項（自由度1）を追加し、Δ²r の棄却条件を保ったまま改善の有無を機械的に判定する。

変更：
- 更新：`scripts/quantum/nuclear_a_dependence_mean_field.py`
  - 7.13.15.27 の Δ²r strict に「半径写像の最小 shell 項」を追加できるよう拡張：
    - 半径写像：`r_charge=r_base+r_shell*(S(N)+S(Z))`（`S=p(p-g)/g^2`、magic list は model/obs を scan）
    - `r_shell` は IAEA radii のみで weighted LS fit（A>=fit_min_A）。Δ²r 定義/σ_obs/閾値は 7.13.15.35 と同一で固定。
  - `--step 7.13.15.36` を追加し、NuDat3 multi + β2 + surface_cov + Δ²r strict の設定を維持したまま radius_shell 拡張を適用。
- 更新：`doc/ROADMAP.md` / `doc/paper/12_part3_quantum.md` / `doc/paper/01_figures_index.md`
  - 7.13.15.36 を完了（初版）として反映し、出力一覧と図表インデックスへ追記。

実行：`python -B scripts/quantum/nuclear_a_dependence_mean_field.py --step 7.13.15.36`

出力（固定）：
- `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_radii_kink_delta2r_radius_shell.png`
- `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_radii_kink_delta2r_radius_shell.csv`
- `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_radii_kink_delta2r_radius_shell_metrics.json`
- `output/quantum/nuclear_a_dependence_hf_three_body_spectroscopy_diagnostics_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_radii_kink_delta2r_radius_shell.png`
- `output/quantum/nuclear_a_dependence_hf_three_body_radii_kink_delta2r_diagnostics_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_radii_kink_delta2r_radius_shell.png`
- `output/quantum/nuclear_a_dependence_hf_three_body_radii_kink_delta2r_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_radii_kink_delta2r_radius_shell.csv`

結果（初版；代表）：
- strict 判定：`strict_pass=0/10`（no-go 継続）
- Δ²r strict：`pass_radii_kink_delta2r=0/10`
  - A_min=16：max |resid|/σ_obs ≈ 15.3（x=N）/19.0（x=Z）
  - best（A_min=100）：max |resid|/σ_obs ≈ 10.75（x=Z）
- r_shell（fit；代表）：model_magic ≈ -0.00428 fm、obs_magic ≈ -0.00888 fm

結論：
- r_shell（自由度1）の半径写像拡張でも Δ²r を σ_obs 基準で再現できない。半径の構造効果を救うには別形式（または追加自由度）が必要である。

## 2026-01-27（UTC） Phase 7（量子）/ Step 7.13.15.37：expanded set：半径写像を N/Z 分離（r_shell_N, r_shell_Z）で拡張し、Δ²r strict を再評価（初版）

目的：
- 7.13.15.36（自由度1：r_shell）でも Δ²r mismatch が改善しないため、最小追加自由度（+1）として N/Z 分離（r_shell_N, r_shell_Z）を導入し、Δ²r strict を同一閾値で再評価する。

変更：
- 更新：`scripts/quantum/nuclear_a_dependence_mean_field.py`
  - `_run_step_7_13_15_27` に `radii_kink_delta2r_radius_shell_nz` を追加し、半径写像 `r_charge=r_base+r_shell_N*S(N)+r_shell_Z*S(Z)` を適用できるよう拡張。
  - `--step 7.13.15.37` を追加。
  - Δ²r strict の定義・σ_obs・閾値は 7.13.15.35 と同一で固定（p-hacking回避）。(r_shell_N,r_shell_Z) の fit は IAEA radii のみ（A>=fit_min_A）で実施。
  - Δ²r 診断CSVの shell列を（sum: r_shell_fm / nz: r_shell_N_fm,r_shell_Z_fm）へ拡張。
- 更新：`doc/ROADMAP.md` / `doc/paper/12_part3_quantum.md` / `doc/paper/01_figures_index.md`
  - 7.13.15.37 を完了（初版）として反映し、出力一覧と図表インデックスへ追記。
- 再生成（HTML）：
  - `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`
  - `python -B scripts/summary/paper_qc.py` → ok: True（`output/summary/paper_qc.json`）

実行：`python -B scripts/quantum/nuclear_a_dependence_mean_field.py --step 7.13.15.37`

出力（固定）：
- `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_radii_kink_delta2r_radius_shell_nz.png`
- `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_radii_kink_delta2r_radius_shell_nz.csv`
- `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_radii_kink_delta2r_radius_shell_nz_metrics.json`
- `output/quantum/nuclear_a_dependence_hf_three_body_spectroscopy_diagnostics_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_radii_kink_delta2r_radius_shell_nz.png`
- `output/quantum/nuclear_a_dependence_hf_three_body_radii_kink_delta2r_diagnostics_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_radii_kink_delta2r_radius_shell_nz.png`
- `output/quantum/nuclear_a_dependence_hf_three_body_radii_kink_delta2r_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_radii_kink_delta2r_radius_shell_nz.csv`

結果（初版；代表）：
- strict 判定：`strict_pass=0/10`（no-go 継続）
- Δ²r strict：`pass_radii_kink_delta2r=0/10`
  - best：obs_magic×A_min=100 で max |resid|/σ_obs ≈ 10.86（x=Z）
- 半径写像（fit；代表）：
  - model_magic：`r_shell_N≈-0.0460 fm`、`r_shell_Z≈+0.0365 fm`
  - obs_magic：`r_shell_N≈-0.0219 fm`、`r_shell_Z≈+0.00518 fm`

結論：
- N/Z 分離（自由度2）の半径写像拡張でも Δ²r を σ_obs 基準で再現できないため、Δ²r は棄却条件として維持しつつ、半径の構造効果を救うには別形式（または追加の独立入力）が必要である。

## 2026-01-27（UTC） Phase 8（論文化）/ Step 8.2.4：DOCX体裁：pmodel_paper（Part I）の要請ブロック/数式行間/表表示を修正

目的：
- pmodel_paper（Part I）の Word（DOCX）で、(i) 2.1 の「要請（P内部）→帰結：」が矢印/コロン欠落に見える、(ii) 数式周辺の空白が大きく式が抜けたように見える、(iii) A.3.1 の末尾に空白が残る、(iv) A.0 の表が表に見えない、など「読者の信頼に直結する」体裁問題を最優先で解消する。

変更：
- 更新：`doc/paper/10_part1_core_theory.md`
  - 2.1 の要請ブロックの区切りを `要請（P内部）→帰結： ` の体裁に微修正（後段の可読性を改善）。
- 更新：`doc/paper/05_definitions.md`
  - A.3.1 の「括弧の位置に注意（誤読防止）」を ordered list 化し、直後の空白に見える区切りを除去（A.4 へ直結）。
- 更新：`scripts/summary/html_to_docx.py`
  - Word数式（OMML）前後の段落間隔を tightening（前後段落の SpaceBefore/After を補正）し、欠落に見える余白を削減。
  - 表の見え方（Word UI）を安定化：`_enable_table_borders()` を width 計算失敗時でも必ず適用。
  - Word取り込みが "："→":" に正規化する問題を、DOCX保存後の XML 最終パッチで補正（要請ブロック等のコロンを fullwidth に復元）。

再生成：
- `python -B scripts/summary/paper_build.py --profile paper --mode publish --outdir output/summary`
- `python -B scripts/summary/paper_qc.py` → ok: True（`output/summary/paper_qc.json`）

出力（固定）：
- `output/summary/pmodel_paper.html`
- `output/summary/pmodel_paper.docx`

## 2026-01-27（UTC） Phase 8（論文化）/ Step 8.2.4（追記）：2.6 の箇条書き体裁を統一し、見栄え崩れを解消

変更：
- 更新：`doc/paper/10_part1_core_theory.md`
  - 2.6 の「基本変数／最小の動力学仮定／放射の構造／理論的限界」を箇条書きへ統一し、Word上で箇条書き記号だけが混ざって見える問題を回避。

再生成：
- `python -B scripts/summary/paper_build.py --profile paper --mode publish --outdir output/summary`

## 2026-01-27（UTC） Phase 8（論文化）/ Step 8.2.4（追記）：paper_qc に DOCX側チェック（要請コロン／A.0表枠線）を追加

変更：
- 更新：`scripts/summary/paper_qc.py`
  - `output/summary/pmodel_paper.docx` を対象に、(i) 2.1 要請ブロックの fullwidth コロン `：`、(ii) A.0 自由度台帳の tblBorders（Word UIで表に見える）を機械チェックに追加。
  - Wordが無い環境で DOCX が生成されない場合は skip 扱い（HTML系チェックは継続）。

実行：`python -B scripts/summary/paper_qc.py` → ok: True（`output/summary/paper_qc.json`）

## 2026-01-27（UTC） Phase 7（量子）/ Step 7.13.15.38（初版）：β2（変形）を半径写像へ反映して Δ²r strict を再評価（no-go 継続）

変更：
- 更新：`scripts/quantum/nuclear_a_dependence_mean_field.py`
  - `radii_kink_delta2r_radius_beta2` を追加し、Δ²r の予測半径を `r_charge=r_base*sqrt(1+(5/(4π))*β2^2)` に置換できるようにした（β2 は NNDC B(E2) adopted）。
  - `--step 7.13.15.38` を追加（fixed outputs を新規スタブ名で固定）。

実行：
- `python -B scripts/quantum/nuclear_a_dependence_mean_field.py --step 7.13.15.38`

結果（初版）：
- strict 判定：strict_pass=0/10（no-go 継続）
- Δ²r strict：pass_radii_kink_delta2r=0/10（best：model_magic×A_min=100 で max |resid|/σ_obs ≈ 13.41；Sp軸で支配的に悪化）

出力（固定）：
- `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_radii_kink_delta2r_radius_beta2_metrics.json`
- `output/quantum/nuclear_a_dependence_hf_three_body_radii_kink_delta2r_diagnostics_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_radii_kink_delta2r_radius_beta2.png`

## 2026-01-27（UTC） Phase 7（量子）/ Step 7.13.15.39（初版）：Δ²r（kink）strict no-go の総括（7.13.15.35–.38）

目的：
- 7.13.15.35–.38 の「凍結半径写像」variant（base/shell/shell_NZ/β2）を跨いで、Δ²r strict の no-go が偶然ではないことを固定出力として残し、意思決定の透明性（どこで棄却し、どこで次へ進むか）を高める。

変更：
- 更新：`scripts/quantum/nuclear_a_dependence_mean_field.py`
  - `--step 7.13.15.39` を追加し、7.13.15.35–.38 の metrics を読み込んで Δ²r strict の集約（CSV/PNG/JSON）を生成できるようにした。

実行：
- `python -B scripts/quantum/nuclear_a_dependence_mean_field.py --step 7.13.15.39`

結果（初版）：
- strict 判定：`strict_pass=0/10`（全variant）
- Δ²r strict：`pass_radii_kink_delta2r=0/10`（全variant）
- 最良でも max |Δ²r_pred−Δ²r_obs|/σ_obs ≈ 10.75（A_min=100）

出力（固定）：
- `output/quantum/nuclear_a_dependence_hf_three_body_radii_kink_delta2r_strict_summary.csv`
- `output/quantum/nuclear_a_dependence_hf_three_body_radii_kink_delta2r_strict_summary.png`
- `output/quantum/nuclear_a_dependence_hf_three_body_radii_kink_delta2r_strict_summary_metrics.json`

## 2026-01-27（UTC） Phase 7（量子）/ Step 7.13.15.40（初版）：odd-even（最小）半径補正で Δ²r（kink）strict を再評価（no-go）

目的：
- 7.13.15.35–.38 の no-go を受け、ロードマップに挙げた「odd-even 系統」を最小形（Z/N の奇偶オフセット）で試し、同一 strict 閾値（7.13.15.35 と同一）で改善の有無を機械判定する。

変更：
- 更新：`scripts/quantum/nuclear_a_dependence_mean_field.py`
  - `--step 7.13.15.40` を追加。
  - 半径写像：`r_charge = r_base + r_oe_N*I(N odd) + r_oe_Z*I(Z odd)`（IAEA radii のみで weighted LS fit）

実行：
- `python -B scripts/quantum/nuclear_a_dependence_mean_field.py --step 7.13.15.40`

結果（初版）：
- strict 判定：`strict_pass=0/10`
- Δ²r strict：`pass_radii_kink_delta2r=0/10`
- 構造上、Δ²r は step=2（x±2）なので純粋な奇偶オフセットは差分で打ち消され、Δ²r をほぼ変えない（best max |resid|/σ_obs≈10.86 が維持）

出力（固定）：
- `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_radii_kink_delta2r_radius_odd_even.png`
- `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_radii_kink_delta2r_radius_odd_even.csv`
- `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_radii_kink_delta2r_radius_odd_even_metrics.json`
- `output/quantum/nuclear_a_dependence_hf_three_body_radii_kink_delta2r_diagnostics_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_radii_kink_delta2r_radius_odd_even.png`
- `output/quantum/nuclear_a_dependence_hf_three_body_radii_kink_delta2r_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_radii_kink_delta2r_radius_odd_even.csv`

## 2026-01-27（UTC） Phase 7（量子）/ Step 7.13.15.41（初版）：shell_NZ+β2 を半径写像へ同時反映して Δ²r（kink）strict を再評価（no-go）

目的：
- 7.13.15.37（shell_NZ）と 7.13.15.38（β2）を単独で入れても no-go が改善しないことを受け、両者を同時に適用した最小合成（追加自由度を増やさず、β2 は固定入力）で Δ²r strict を再判定する。

変更：
- 更新：`scripts/quantum/nuclear_a_dependence_mean_field.py`
  - `radii_kink_delta2r_radius_shell_nz_beta2` を追加し、半径写像 `r_charge = (r_base + r_shell_N*S(N) + r_shell_Z*S(Z)) * sqrt(1 + (5/(4π))*β2^2)` で Δ²r（kink）strict を評価できるようにした。
  - `--step 7.13.15.41` を追加（fixed outputs を新規スタブ名で固定）。

実行：
- `python -B scripts/quantum/nuclear_a_dependence_mean_field.py --step 7.13.15.41`

結果（初版）：
- strict 判定：`strict_pass=0/10`
- Δ²r strict：`pass_radii_kink_delta2r=0/10`
- best max |resid|/σ_obs ≈ 13.5（obs_magic×A_min=100；7.13.15.39 の best ≈10.75 より悪化）

出力（固定）：
- `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_radii_kink_delta2r_radius_shell_nz_beta2.png`
- `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_radii_kink_delta2r_radius_shell_nz_beta2.csv`
- `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_radii_kink_delta2r_radius_shell_nz_beta2_metrics.json`
- `output/quantum/nuclear_a_dependence_hf_three_body_spectroscopy_diagnostics_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_radii_kink_delta2r_radius_shell_nz_beta2.png`
- `output/quantum/nuclear_a_dependence_hf_three_body_radii_kink_delta2r_diagnostics_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_radii_kink_delta2r_radius_shell_nz_beta2.png`
- `output/quantum/nuclear_a_dependence_hf_three_body_radii_kink_delta2r_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_radii_kink_delta2r_radius_shell_nz_beta2.csv`

## 2026-01-27（UTC） Phase 7（量子）/ Step 7.13.15.42（初版）：Δ²r（kink）strict を even-even 限定（Z,N がともに偶数）で再評価

目的：
- 7.13.15.35–.41 の Δ²r strict no-go を受け、支配的 failure が odd-A / odd-odd（形状共存など）に由来するかを、ルール固定のまま切り分ける。
- 分光（NuDat3）と β2（NNDC B(E2)）が実質的に even-even 由来であることと整合する評価（even-even 限定）を追加し、「どこで落ちているか」を見える化する。

変更：
- 更新：`scripts/quantum/nuclear_a_dependence_mean_field.py`
  - Δ²r（kink）評価に `radii_kink_delta2r_even_even_only`（Z,N ともに偶数のみ）を追加。
  - `--step 7.13.15.42` を追加（7.13.15.35 と同一設定だが Δ²r 評価は even-even のみ）。

実行：
- `python -B scripts/quantum/nuclear_a_dependence_mean_field.py --step 7.13.15.42`

結果（初版）：
- strict 判定：`strict_pass=0/10`（no-go 継続）
- ただし odd-A 由来の worst（例：N=101, Z0=80 近傍）が評価対象から外れることで、A_min=100 では max |resid|/σ_obs が ≈5.73（Sn）/≈4.84（Sp）まで低下し、failure 構造が even-even の magic 近傍（例：Z0=50, 82）へ集約することが確認できた。

出力（固定）：
- `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_radii_kink_delta2r_even_even_only_metrics.json`
- `output/quantum/nuclear_a_dependence_hf_three_body_radii_kink_delta2r_diagnostics_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_radii_kink_delta2r_even_even_only.png`

## 2026-01-27（UTC） Phase 7（量子）/ Step 7.13.15.43（初版）：magic-offset 半径写像で Δ²r（kink）strict を再評価（even-even）

目的：
- 7.13.15.42 で「even-even の magic 近傍へ集約」した Δ²r strict failure を、半径写像に **magic点の離散オフセット**を入れた最小DoFで救えるかを検証する。

変更：
- 更新：`scripts/quantum/nuclear_a_dependence_mean_field.py`
  - `radii_kink_delta2r_radius_magic_offset` を追加：`r_charge = r_base + r_magic_N*I(N∈magic) + r_magic_Z*I(Z∈magic)`（IAEA radii のみで weighted LS fit；magic は OBS_MAGIC）。
  - `--step 7.13.15.43` を追加（評価は `radii_kink_delta2r_even_even_only=True`）。

実行：
- `python -B scripts/quantum/nuclear_a_dependence_mean_field.py --step 7.13.15.43`

結果（初版）：
- strict 判定：`strict_pass=0/10`（no-go 継続）
- ただし A_min=100 では max |Δ²r_pred−Δ²r_obs|/σ_obs が ≈3.07（Sn）/≈3.72（Sp）まで低下し、閾値3にかなり近づいた。
  - 代表 failure：Sp の (N=70, Z0=50) で abs_resid_sigma≈3.72
- fit（半径オフセット；参考）：`r_magic_N_fm≈-0.0198`、`r_magic_Z_fm≈-0.0304`（fit_min_A=40, n_fit=871）

出力（固定）：
- `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_radii_kink_delta2r_radius_magic_offset_even_even_only.png`
- `output/quantum/nuclear_a_dependence_hf_three_body_spectroscopy_diagnostics_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_radii_kink_delta2r_radius_magic_offset_even_even_only.png`
- `output/quantum/nuclear_a_dependence_hf_three_body_radii_kink_delta2r_diagnostics_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_radii_kink_delta2r_radius_magic_offset_even_even_only.png`
- `output/quantum/nuclear_a_dependence_hf_three_body_radii_kink_delta2r_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_radii_kink_delta2r_radius_magic_offset_even_even_only.csv`
- `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_radii_kink_delta2r_radius_magic_offset_even_even_only.csv`
- `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_radii_kink_delta2r_radius_magic_offset_even_even_only_metrics.json`

## 2026-01-27（UTC） Phase 7（量子）/ Step 7.13.15.44（初版）：Δ²r（kink）strict を shell-closure kink（center magic のみ）に限定して再評価（magic-offset＋even-even）

目的：
- mid-shell/non-closure kink（例：局所的半径異常）が strict 判定を支配して「殻閉じ kink」の反証条件が読めなくなるのを避け、kink を「magic中心」に限定して再評価する。

変更：
- 更新：`scripts/quantum/nuclear_a_dependence_mean_field.py`
  - `radii_kink_delta2r_center_magic_only` を追加（Δ²r の kink 判定を center が OBS_MAGIC の場合に限定）。
  - `--step 7.13.15.44` を追加（`radii_kink_delta2r_radius_magic_offset=True` + `radii_kink_delta2r_even_even_only=True` を維持）。

実行：
- `python -B scripts/quantum/nuclear_a_dependence_mean_field.py --step 7.13.15.44`

結果（初版）：
- strict 判定：`strict_pass=0/10`（no-go 継続）
- A_min=100 で max |Δ²r_pred−Δ²r_obs|/σ_obs ≈3.07（Sn）/≈3.72（Sp）。低A（A_min=16/40）では Sp 側が ≈4.74 まで悪化。

出力（固定）：
- `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_radii_kink_delta2r_radius_magic_offset_even_even_center_magic_only.png`
- `output/quantum/nuclear_a_dependence_hf_three_body_radii_kink_delta2r_diagnostics_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_radii_kink_delta2r_radius_magic_offset_even_even_center_magic_only.png`
- `output/quantum/nuclear_a_dependence_hf_three_body_radii_kink_delta2r_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_radii_kink_delta2r_radius_magic_offset_even_even_center_magic_only.csv`
- `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_radii_kink_delta2r_radius_magic_offset_even_even_center_magic_only_metrics.json`

## 2026-01-27（UTC） Phase 7（量子）/ Step 7.13.15.45（初版）：magic-offset-neighbors 半径写像で shell-closure kink を再評価（even-even＋center magic のみ）

目的：
- 7.13.15.44 の「純オフセット（I(magic)）」が Δ²r を過大/過小にしやすい可能性に対し、Δ² stencil の隣接点（±2）へ重みをにじませて overshoot を抑制できるかを切り分ける。

変更：
- 更新：`scripts/quantum/nuclear_a_dependence_mean_field.py`
  - `radii_kink_delta2r_radius_magic_offset_neighbors` を追加：`w_magic(x)=1 (x∈magic), 0.5 (x±2∈magic), else 0` を用いた 2DoF（r_magic_N, r_magic_Z）の weighted LS fit。
  - Δ²r 診断CSVに `radius_magic_neighbor_weight/step` を追加（neighbors 設定の見える化）。
  - `--step 7.13.15.45` を追加。

実行：
- `python -B scripts/quantum/nuclear_a_dependence_mean_field.py --step 7.13.15.45`

結果（初版）：
- strict 判定：`strict_pass=0/10`（no-go 継続）
- A_min=100：Sn 側は max |resid|/σ_obs≈2.31 まで改善したが、Sp 側は ≈3.44 が残存。
- A_min<=80：Sn 側に (Z=42,N0=50) ≈10.64σ の mismatch が発生し、総合では悪化が支配的。

出力（固定）：
- `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_radii_kink_delta2r_radius_magic_offset_neighbors_even_even_center_magic_only.png`
- `output/quantum/nuclear_a_dependence_hf_three_body_radii_kink_delta2r_diagnostics_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_radii_kink_delta2r_radius_magic_offset_neighbors_even_even_center_magic_only.png`
- `output/quantum/nuclear_a_dependence_hf_three_body_radii_kink_delta2r_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_radii_kink_delta2r_radius_magic_offset_neighbors_even_even_center_magic_only.csv`
- `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_radii_kink_delta2r_radius_magic_offset_neighbors_even_even_center_magic_only_metrics.json`

## 2026-01-27（UTC） Phase 7（量子）/ Step 7.13.15.46（初版）：magic-offset を「magic番号ごと」に分解して再評価（even-even＋center magic のみ）

目的：
- 7.13.15.44–.45 の残差（例：Z0=50, N0=82/50）を、「単一の r_magic_N/Z」ではなく **magic番号ごと**に分解した少数DoFで吸収できるかを切り分ける（fitは IAEA radii のみ、B/A への再フィットは行わない）。

変更：
- 更新：`scripts/quantum/nuclear_a_dependence_mean_field.py`
  - `radii_kink_delta2r_radius_magic_offset_per_magic` を追加：`r_charge = r_base + Σ r_magic_N[m]*I(N==m) + Σ r_magic_Z[m]*I(Z==m)`（magic は OBS_MAGIC；weighted LS fit）。
  - Δ²r 診断CSV（kink）に `radius_magic_neighbor_weight/step` を追加（magic-variant 共通の列として固定）。
  - `--step 7.13.15.46` を追加。

実行：
- `python -B scripts/quantum/nuclear_a_dependence_mean_field.py --step 7.13.15.46`

結果（初版）：
- strict 判定：`strict_pass=0/10`（no-go 継続）
- Sn 側（N0=82）で Δ²r_pred が過大となり、A_min=100 でも max |resid|/σ_obs≈14.59（例：Z=58,N0=82）。
- Sp 側も A_min=100 で max |resid|/σ_obs≈5.63（例：N=70,Z0=50）。
  - 結論：この per-magic 分解は、半径系の系統（例：Z=20）を過大に吸収して Δ²r を悪化させるため、当面は採用しない。

出力（固定）：
- `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_radii_kink_delta2r_radius_magic_offset_per_magic_even_even_center_magic_only.png`
- `output/quantum/nuclear_a_dependence_hf_three_body_spectroscopy_diagnostics_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_radii_kink_delta2r_radius_magic_offset_per_magic_even_even_center_magic_only.png`
- `output/quantum/nuclear_a_dependence_hf_three_body_radii_kink_delta2r_diagnostics_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_radii_kink_delta2r_radius_magic_offset_per_magic_even_even_center_magic_only.png`
- `output/quantum/nuclear_a_dependence_hf_three_body_radii_kink_delta2r_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_radii_kink_delta2r_radius_magic_offset_per_magic_even_even_center_magic_only.csv`
- `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_radii_kink_delta2r_radius_magic_offset_per_magic_even_even_center_magic_only.csv`
- `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_radii_kink_delta2r_radius_magic_offset_per_magic_even_even_center_magic_only_metrics.json`

## 2026-01-27（UTC） Phase 7（量子）/ Step 7.4.7.3：ベル selection 感度まとめの JSON に `source_manifest` と Giustina 2015（click log 未公開）の `status=blocked` を追加

目的：
- Step 7.4.7（photon time-tag 統合）の横断まとめ（selection sensitivity）に、一次ソース（manifest）への参照を含めて再現性の文脈を固定する。
- Giustina 2015 は click log が未公開でブロックのため、summary 側にも **blocked を明示**し、読者が「欠落」に見えない形にする。

変更：
- 更新：`scripts/quantum/bell_selection_sensitivity_summary.py`
  - 各dataset（NIST/Weihs/Delft/Kwiat）の `source_manifest`（`data/quantum/sources/*/manifest.json` の要約）を `output/quantum/bell_selection_sensitivity_summary.json` に追加。
  - Giustina 2015（`data/quantum/sources/giustina2015_prl115_250401/manifest.json`）について、`status=blocked` と理由（click log未公開/Cloudflare等）を summary に追加。

実行：
- `python -B scripts/quantum/bell_selection_sensitivity_summary.py`

出力（固定）：
- `output/quantum/bell_selection_sensitivity_summary.png`
- `output/quantum/bell_selection_sensitivity_summary.json`

## 2026-01-27（UTC） Phase 8（論文化）/ Step 8.2.4（追補）：pmodel_paper 2.6 の箇条書き崩れを防ぐため、数式ブロックを箇条書き項目に内包

目的：
- 2.6「動的P（放射・波動）」で、箇条書きの途中に数式ブロックが入ることで Word 取り込み時に見栄えが崩れ、「式が欠落したように見える」/「箇条書き記号が混ざって見える」問題を抑える。

変更：
- 更新：`doc/paper/10_part1_core_theory.md`
  - 2.6 の「最小の動力学仮定」項目における数式ブロック（`$$ ... $$`）と直後の文を、箇条書き項目の内部に入るようインデントを調整。
  - 「放射の構造（最小要件）」の説明段落も同一項目内に入るようインデントを調整し、箇条書きを 1 本に統一。

生成・確認：
- 生成（HTML）：`python -B scripts/summary/paper_build.py --mode publish --outdir output/summary --skip-docx`
- 生成（DOCX）：`python -B scripts/summary/html_to_docx.py --in output/summary/pmodel_paper.html --out output/summary/pmodel_paper.docx --paper-equations --orientation landscape --margin-mm 7`
- QC：`python -B scripts/summary/paper_qc.py` → ok: True（`output/summary/paper_qc.json`）

出力（更新）：
- `output/summary/pmodel_paper.html`
- `output/summary/pmodel_paper.docx`
- `output/summary/paper_qc.json`

## 2026-01-28（UTC） Phase 7（量子）/ Step 7.1.3（追補）：Part I 定義からの量子接続（最小作用／境界条件による離散化／Schr写像）を数理ノートとして固定

目的：
- ユーザー要請：「dτ/dt=P0/P」「φ=-c^2 ln(P/P0)」を起点に、(1) 微小変動の最小作用/波動方程式、(2) 定在波の安定条件→離散化、(3) ħ/h の位置づけと Schr 方程式への写像、を **矛盾しない最小形**として整理する。

変更：
- 追加：`doc/quantum/18_p_field_action_and_schrodinger_mapping.md`
  - Part I の u=ln(P/P0), φ=-c^2 u, dτ/dt=e^{-u} を明示し、Part I 2.6 の波動方程式（□u=-(4πG/c^2)ρ）を与える最小作用の形を整理。
  - 境界条件（反射/位相整合）による固有モード離散化（幾何学的量子化）を整理。
  - 内部時計 θ=ω0τ と ħ を E=ħω の変換係数として導入し、m=ħω0/c^2 により Schr 形（iħ∂tΨ=-(ħ^2/2m)∇^2Ψ+mφΨ）へ写像できることを整理。

ロードマップ反映：
- 追記：`doc/ROADMAP.md`（Step 7.1 に 7.1.3 を追加）

## 2026-01-28（UTC） Phase 7（量子）/ Step 7.10.1（追補）：測定＝selection を散逸系（アトラクター）／情報（エントロピー最小化）として数理モデル化し、Born則 `|ψ|^2` の位置づけを明確化

目的：
- ユーザー要請：「測定＝対象P構造がマクロ測定系P構造と干渉し、安定モードを選択（selection）」を、散逸系のアトラクター形成／情報（エントロピー最小化）の観点で **数式化**する。
- Born則（確率密度 `|ψ|^2`）を「局所エネルギー流（強度）」と「干渉（交差項）」の両方を含む形として明確化する。
- もつれ・ベル再解釈（共通原因 λ＋selection重み）への導線を整える。

変更：
- 更新：`doc/quantum/15_quantum_measurement_born_rule.md`
  - `|ψ|^2` を検出率（不可逆エネルギー流）として書く最小モデル（`λ(x,t)=κ(x)|ψ|^2`）と、干渉項が確率に入る形を追記。
  - 測定＝散逸系のアトラクター形成として、pointer `Π_m` による Lindblad 有効方程式と量子軌道（更新則）の整合を追記。
  - エントロピー最小化（条件付き更新で不確かさが減る）の見え方を追記（第一原理導出ではなく写像として固定）。
- 更新：`doc/quantum/03_entanglement_local_p.md`
  - 共通原因 `λ` と selection 重み `w_ab(λ)` により、観測相関が条件付き平均として書けることを数式で追記（詳細は `doc/quantum/06_chsh_assumptions_and_selection.md` 参照）。
- 更新：`doc/ROADMAP.md`（Step 7.10 に 7.10.1 を追加）

## 2026-01-28（UTC） Phase 7（量子）/ Step 7.5.7（初版）：量子の決着点（干渉×βの微小差分＋Bell遅延シグネチャ）を Part I 3.0 書式で固定出力化

目的：
- ユーザー要請：「P-model と標準QM+GRで観測予測が微小にズレる“決着点”」を、Part I 3.0 の共通書式（Input/Frozen/Output/Statistic/Reject）で **固定出力（JSON）**として残す。
- 干渉（COW/原子干渉計）では、β（自由波応答指数）が位相に与える影響を “order estimate” として保存し、必要精度（3σ）を機械可読にする。
- Bell では、共通P相関の「遅延シグネチャ」候補を、公開 time-tag データから計算できる operational proxy（delay分布の setting 依存；KS）で固定し、3σ相当の閾値を明文化する。

変更：
- 追加：`scripts/summary/quantum_falsification.py`
  - 入力：`output/quantum/cow_phase_shift_metrics.json` / `output/quantum/atom_interferometer_gravimeter_phase_metrics.json` / `output/quantum/bell/falsification_pack.json` ほか
  - 出力：`output/summary/quantum_falsification.json`
  - Bell（遅延）：KS距離を `KS_z ≈ D*sqrt(N_eff)` へ換算し、Weihs/NIST を “fast switching” として最小閾値（3σ）を評価できる形へ固定。
- 更新：`scripts/summary/run_all.py`
  - final aggregation task に `quantum_falsification` を追加（`python -B scripts/summary/run_all.py --offline --jobs 2` で更新対象に含める）。
- 更新：`doc/ROADMAP.md`
  - Step 7.5.7 を追記（出力の固定と再現コマンドを明文化）。

実行：
- `python -B scripts/summary/quantum_falsification.py`

結果（初版）：
- COW（中性子干渉）：現モデルでは β 依存は入らない（整合チェックとして扱う）。
- 原子干渉計：β差分は order estimate として Δφ_beta≈3.38e-7 rad（T=0.4 s の例）を記録し、3σ検出に必要な 1σ 位相精度（≈1.13e-7 rad）を出力に固定。
- Bell（遅延シグネチャ）：Weihs/NIST は KS_z が 3σ を超える（proxy上の“遅延の setting 依存”が見える）。一方、Kwiat2013 はこの proxy では 3σ 未満。

出力（固定）：
- `output/summary/quantum_falsification.json`

## 2026-01-28（UTC） Phase 7（量子）/ Step 7.5.7（追補）：Phase 7 完遂の評価軸をロードマップへ明文化し、Bell 遅延シグネチャを “遅延（ns）” で読める形へ改善

目的：
- ユーザー指示（Phase 7 完遂に向けた強化）に従い、Phase 7 の出口条件（評価軸：P内部一貫性／selection／非局所の再解釈＋反証条件）を `doc/ROADMAP.md` に明文化する。
- Bell の「遅延シグネチャ」を KS proxy だけに依存させず、NIST では **遅延の物理量（Δmedian(ns)）**を併記して “欠落に見えない” 形にする（3σ判定は KS_z を継続利用）。

変更：
- 更新：`doc/ROADMAP.md`
  - Phase 7 冒頭に「完遂の評価軸（3本柱＋反証条件）」を追加し、出口条件を明示。
  - Step 7.5 に 7.5.8（原子干渉計×βの厳密導出）を追加し、Step 7.5 の現状を進行中へ更新。
  - Step 7.4 に 7.4.10（高速スイッチングBellの遅延シグネチャを遅延/残差として固定）を追加。
- 更新：`scripts/summary/quantum_falsification.py`
  - NIST time-tag 再解析の固定出力（`output/quantum/nist_belltest_time_tag_bias_metrics__*.json`）から delay の median（ns）を読み取り、`output/summary/quantum_falsification.json` の Bell 項へ `delay_stats_ns` として併記。
  - Bell の判定ラベルを「KS_z + Δmedian(ns)」として明示。

実行：
- `python -B scripts/summary/quantum_falsification.py`

出力（更新）：
- `output/summary/quantum_falsification.json`

## 2026-01-28（UTC） Phase 7（量子）/ Step 7.13.15.47：Δ²r（shell-closure kink）strict no-go を反証条件（棄却/制限事項）として整理（A/B/C 判定表を Part III に固定）

目的：
- ユーザー要請：Step 7.13（原子核）の Δ²r（kink）検証（7.13.15.43–7.13.15.46）の no-go を、A/B/C（理論棄却／一次データ系統／手法限界）として分類し、Part III を「棄却/許容が明確な検証カタログ」へ寄せる。
- 「欠落」ではなく「棄却/制限事項」として、読者が誤解しない形で固定する。

変更：
- 更新：`doc/paper/12_part3_quantum.md`
  - 4.2.7.1 を追加し、Δ²r の定義と strict 判定（`|Δ²r_pred−Δ²r_obs|/σ_obs ≤ 3`、σ_obs=独立伝播・共分散未導入）を明記。
  - 7.13.15.43–.46（A_min=100）の worst を表で固定し、A/B/C 判定（現段階は全て C）と次アクション（優先度/工数）を併記。
  - 参照 metrics JSON を列挙し、数値の再参照を容易化。
- 更新：`doc/ROADMAP.md`
  - 7.13.15.47 を追加（完了）し、反映先（Part III 4.2.7.1）を明記。
  - 続きの作業として 7.13.15.48（共分散導入での再判定）/ 7.13.15.49（核構造側の最小拡張）を追記（準備中）。

結果（固定；A_min=100）：
- 7.13.15.43/7.13.15.44：max |Δ²r_pred−Δ²r_obs|/σ_obs ≈3.07（Sn；worst: Z=58,N0=82）/≈3.72（Sp；worst: Z0=50,N=70）
- 7.13.15.45：≈2.31（Sn；worst: Z=58,N0=82）/≈3.44（Sp；worst: Z0=82,N=108）
- 7.13.15.46：≈14.59（Sn；worst: Z=58,N0=82）/≈5.63（Sp；worst: Z0=50,N=70）

判定（現段階）：
- 7.13.15.43–.46 は **C（手法限界：mean-field＋半径写像）**として整理し、核モジュールの **棄却/制限事項**として固定（Part I のコア写像そのものの棄却とは切り分け）。
- 7.13.15.46（per-magic）は “救済案” として不適切（不安定化/過剰適合）であり、「棄却された救済案」として扱う。

参照（metrics JSON）：
- `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_radii_kink_delta2r_radius_magic_offset_even_even_only_metrics.json`
- `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_radii_kink_delta2r_radius_magic_offset_even_even_center_magic_only_metrics.json`
- `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_radii_kink_delta2r_radius_magic_offset_neighbors_even_even_center_magic_only_metrics.json`
- `output/quantum/nuclear_a_dependence_hf_three_body_shellgap_decision_expanded_shell_i_dep_beta2_surface_cov_spectro_multi_nudat3_radii_kink_delta2r_radius_magic_offset_per_magic_even_even_center_magic_only_metrics.json`

## 2026-01-28（UTC） Phase 7（量子）/ Step 7.10.2：Born則と Schr/KG 導出の理論的位置づけを明確化（Part III 2.5節の改訂）

目的：
- ユーザー要請：「Born則とSchrödinger導出が操作的仮定に見える／測定の立場が図1のみ」という弱点を潰し、semi-classical 批判への防御線を Part III 理論節で構築する。
- 何を仮定し、何を導出し、何が未導出か（採用範囲と逸脱条件を含む）を、論文本文だけで追える形に固定する。

変更：
- 更新：`doc/paper/12_part3_quantum.md`
  - 2.5.1：波動方程式→Schr/KG の接続を、**仮定／導出／未導出**へ分離して明示（`φ=-c^2 ln(P/P0)` と rest phase から `V=mφ` が出る位置を固定）。併せて、P-model 固有補正の観測入口（φの定義、原子干渉計のβ項）を明記。
  - 2.5.2：Born則を「操作的採用」として明確化し、採用範囲（線形応答・マルコフ・backreaction無視・弱場）と、逸脱し得るレジーム（マクロ重ね合わせ／強重力場／自己重力拡張）を “定量の形（スケーリングと閾値）” で固定。
  - 2.5.3：測定を「条件付き更新」として位置づけ、Lüders/POVM を採用する理由、デコヒーレンス機構の言語化、Penrose–Diósi 型との関係（同一視しない）を明文化。Bell の selection（採用規則）を反証入口として併記。
- 更新：`doc/ROADMAP.md`
  - Step 7.5.6 に追補（仮定列の明確化）を追記。
  - Step 7.10.2 を追加（完了）し、Part III 2.5.2–2.5.3 反映を明記。

QC：
- `python -B scripts/summary/paper_qc.py` → ok: True

## 2026-01-28（UTC） Phase 7（量子）/ Step 7.4.9：Bell を “宇宙論級” へ格上げ（bootstrap共分散＋natural window freeze＋既存批判との差異の明文化）

目的：
- Step 7.4（ベル）の解析を「入口の羅列」ではなく、BAO級の **固定I/F＋固定出力＋誤差（統計/系統）分離＋reject凍結**として整備し、ロードマップ上で Step 7.4.9 を **完了**へ更新する。
- 共分散行列（統計）を bootstrap（N≥1000）で固定し、natural window を客観基準として freeze して p-hacking に見えない形へ寄せる。
- 既存批判（Adenier, De Raedt等）との差異（新規性）を本文へ明記する。

変更：
- 更新：`scripts/quantum/bell_primary_products.py`
  - dataset別に `covariance_bootstrap.json`（N≥1000）を固定出力（NIST/Weihs/Delft/Kwiat）。
  - dataset別に `natural_window_frozen.json`（推奨→grid射影→基準点＋reject(3σ)）を固定出力。
  - Kwiat window sweep の rows に `click_a_by_setting` / `click_b_by_setting` を追加（cov bootstrap の入力を欠落させない）。
- 更新：`doc/paper/12_part3_quantum.md`
  - 4.2.1 に、Adenier/De Raedt の既存批判との差異（新規性：固定I/F＋共分散＋natural window freeze＋reject）を追記。
  - natural window の固定先を `covariance_bootstrap.json` / `natural_window_frozen.json` へ更新。
- 更新：`doc/paper/30_references.md`
  - Adenier/De Raedt 関連の参照キーを追加。
- 更新：`data/quantum/sources/giustina2015_prl115_250401/manifest.json`
  - click log 入手時の一次データ要件（schema/配置先/正規化ターゲット）を `primary_data_requirements` として固定。
- 更新：`doc/ROADMAP.md`
  - Step 7.4.9 を **完了**へ更新し、固定出力に `covariance_bootstrap.json` / `natural_window_frozen.json` を追記。

実行：
- `python -B scripts/quantum/bell_primary_products.py --overwrite`
- `python -B scripts/summary/paper_qc.py`

出力（更新/追加）：
- `output/quantum/bell/<dataset>/covariance_bootstrap.json`
- `output/quantum/bell/<dataset>/natural_window_frozen.json`
- `output/summary/paper_qc.json`

## 2026-01-28（UTC） Phase 7（量子）/ Step 7.11：電磁気の「safety check」を検証へ格上げ（採用宣言＋α(P) の κ 制約固定）

目的：
- ユーザー要請：Step 7.11（電磁気）を「先送り」ではなく、**採用（公理）＋未導出＋整合性チェック（検証）**へ格上げする。
- 特に、微細構造定数 α を P 非依存として採用する立場を明示しつつ、仮想的な `α(P/P0)=α0(1+κ ln(P/P0)+…)` の κ を一次制約で縛って「逃げ」に見えない形へ固定する。

変更：
- 追加：`scripts/quantum/fetch_alpha_variation_sources.py`
  - Rosenband 2008（NIST PDF）と Webb 2011（arXiv PDF）を一次ソースとしてキャッシュ。
  - 出力：`data/quantum/sources/alpha_variation_manifest.json`
- 追加：`scripts/quantum/alpha_p_dependence_constraint.py`
  - α(P) の κ 制約を固定出力化（Rosenband の clock drift を地球公転の ΔU⊙/c² へ対応づけた order constraint、H 1S–2S 基準値の補助制約、Webb はスケール参照として記録）。
  - 出力：`output/quantum/alpha_p_dependence_constraint.png` / `output/quantum/alpha_p_dependence_constraint.json`
- 更新：`scripts/quantum/electromagnetism_minimal.py`
  - 「α(P) を主張しない」から「κ=0 を採用し、κ≠0 は制約で縛る」へ図と metrics を更新。
- 更新：`doc/paper/12_part3_quantum.md`
  - 2.6 を「採用／未導出／整合性チェック（本稿の射程）」の構造に再編し、`output/quantum/alpha_p_dependence_constraint.json` を参照して κ を凍結（κ=0採用）。
- 更新：`doc/ROADMAP.md`
  - Step 7.11 の現状を「完了（検証へ格上げ：α(P) の κ 制約を固定）」へ更新し、再現コマンドと成果物を追記。
- 更新：`doc/paper/01_figures_index.md`
  - `output/quantum/alpha_p_dependence_constraint.*` を図一覧へ追加。
- 更新：`doc/paper/30_references.md`
  - Rosenband 2008 / Webb 2011 の参照キーを追加。
- 更新：`doc/PRIMARY_SOURCES.md`
  - Step 7.11 の固定出力に `alpha_p_dependence_constraint.*` を追加し、electromagnetism_minimal の sha256 を更新。

結果（固定；要点）：
- 地球公転による太陽重力ポテンシャルの変化を Δu=ΔU⊙/c² と見積もると Δu≈3.30e-10。
- Rosenband（clock drift；3σ）を用いた order constraint として `|κ|≲2.0e-7` を固定（`output/quantum/alpha_p_dependence_constraint.json`）。

再現：
- `python -B scripts/quantum/fetch_alpha_variation_sources.py`
- `python -B scripts/quantum/alpha_p_dependence_constraint.py`
- `python -B scripts/quantum/electromagnetism_minimal.py`

---

## 2026-01-28（UTC） Phase 7（量子）/ Step 7.5.9：P-model vs GR（時計写像）差分スケールを固定（Earth/Sun/強場）

目的：
- ユーザー要請：「重力量子干渉が弱場写像で同スケールに見え、P-modelの検証にならない」という批判に対し、P-model の `dτ/dt=exp(-x)` と GR の `dτ/dt=sqrt(1-2x)` の差分（高次）を定量化して固定する。
- 差分が観測可能になる条件（必要精度）を、実験室（Earth）／深宇宙（Sun）／強場（中性子星; 例）で比較できる形へ落とす。

変更：
- 更新：`scripts/quantum/gravity_quantum_interference_delta_predictions.py`
  - Earth（COW/原子干渉計/時計）に加えて、Sun（0.3 AU↔1 AU, 0.05 AU↔1 AU）と強場例（中性子星表面↔∞）の差分を固定出力へ追加。
  - 弱場で `δz` が `z_p−z_gr` の直接差分で丸め落ちるケースに備え、`expm1/log1p` と弱場の解析近似（`δz/z≈-(x_low+x_high)`）を併用して数値安定化。
  - 出力：`output/quantum/gravity_quantum_interference_delta_predictions.json` / `.png`
- 更新：`doc/paper/12_part3_quantum.md`
  - 4.2.2 に、写像（exp vs sqrt）と弱場差分スケールの式、代表値の表、結論（地球弱場は厳しい／太陽長基線や強場が候補）を追記。
- 更新：`doc/ROADMAP.md`
  - Step 7.5.9 を追加し、成果物と反映先（Part III 4.2.2）を明記。
- 更新：`doc/paper/01_figures_index.md`
  - `output/quantum/gravity_quantum_interference_delta_predictions.*` を追記。

結果（固定；要点）：
- Earth 弱場では `δz/z≈-1.39e-9`（代表値）と極小で、差分検出に必要な精度は非常に厳しい（例：COW/原子干渉計で相対≲4.64e-10）。
- 太陽ポテンシャル（0.3 AU↔1 AU）では `δ(Δf/f)≈-9.85e-16`（必要精度≲3.28e-16）と差分が増幅し得る。
- 強場例（中性子星表面↔∞）では `δz≈-4.72e-2`（必要精度≲1.57e-2）と差分が大きいが、天体物理系統が支配的になり得る。

再現：
- `python -B scripts/quantum/gravity_quantum_interference_delta_predictions.py`

---

## 2026-01-28（UTC） Phase 7（量子）/ Step 7.5.8：原子干渉計×β（位相項の分解と定数項の相殺）を式として固定

目的：
- ユーザー要請：Step 7.5.7 の「原子干渉計×β」が order estimate に見える弱点を解消し、Mueller 2007 の導出（k_eff を光の分散から決める）に沿って、β がどの位相項へ入るか（および定数項の相殺）を明示する。
- 差分予測（Δφ_beta）と棄却閾値（3σに必要な 1σ 精度）を、固定出力として残す。

変更：
- 更新：`scripts/quantum/atom_interferometer_gravimeter_phase.py`
  - `output/theory/frozen_parameters.json` の凍結βを読み込み、`results.beta_phase_dependence` に「式＋A/B（上限/局所差分）モデル＋採用モデル＋必要精度」を固定。
  - 出力：`output/quantum/atom_interferometer_gravimeter_phase_metrics.json`（既存の固定名を維持し、追記で拡張）
- 更新：`scripts/summary/quantum_falsification.py`
  - `atom_beta_phase_delta_est` が `atom_interferometer_gravimeter_phase_metrics.json` の `beta_phase_dependence` を参照して、採用モデル（局所差分）の必要精度を固定するように更新。
  - 出力：`output/summary/quantum_falsification.json`
- 更新：`doc/paper/12_part3_quantum.md`
  - 4.2.2 に、β（光伝播）由来の差分がレーザー位相項に入ることと、局所差分で強く抑圧されること（代表値）を追記。
- 更新：`doc/quantum/08_gravity_quantum_interference.md`
  - Step 7.5.8 の位置づけ（固定先）を追記。
- 更新：`doc/ROADMAP.md`
  - Step 7.5.8 を **完了（初版）** とし、Step 7.5 を **完了（初版）** へ更新。

結果（固定；要点）：
- A（上限）：地球ポテンシャル（∞基準）の “上限見積もり” として δφ≈3.38e-7 rad（参考）。
- B（採用：局所差分）：凍結β（Cassini）と代表値（T=0.4 s）で δφ_beta≈4.16e-14 rad、3σ検出に必要な 1σ 精度は σφ≲1.39e-14 rad（現状到達困難）として固定。

再現：
- `python -B scripts/quantum/atom_interferometer_gravimeter_phase.py`
- `python -B scripts/summary/quantum_falsification.py`

---

## 2026-01-28（UTC） Phase 7（量子）/ Step 7.4.10：Bell 遅延シグネチャを Δmedian(ns)＋残差(z) で凍結（KS proxy からの置換）

目的：
- ロードマップ Step 7.4.10 の要件に従い、Bell（高速スイッチング環境）の setting 依存遅延を、KS proxy ではなく **物理量（遅延量：Δmedian; ns）＋残差（z）**として固定し、3σ 閾値（Reject）を凍結する。
- これにより、Step 7.5.7（量子の決着点パック）の Bell 条件を、観測上の ns 量へ接続する（読者にとって “欠落に見えない” 体裁の強化）。

変更：
- 更新：`scripts/quantum/bell_primary_products.py`
  - `delay_signature`（Δmedian(ns), σ(Δmedian), z）を追加し、`output/quantum/bell/falsification_pack.json` に固定出力。
  - 閾値を `delay_signature_z_min=3` として freeze（KS は `ks_delay_min_legacy` として proxy 併記）。
- 更新：`scripts/summary/quantum_falsification.py`
  - Bell の遅延判定を KS_z から `delay_signature.z_delta_median` へ切替（出力：`output/summary/quantum_falsification.json`）。
- 更新：`doc/ROADMAP.md`
  - Step 7.4.10 を【完了】へ更新（凍結先ファイルを明記）。
- 更新：`doc/paper/12_part3_quantum.md`
  - 4.2.1 の Bell 要約を、Δmedian(ns)＋z を主表示に更新（KS は proxy として併記）。
- 更新：`doc/STATUS.md`
  - Step 7.4.10 完了を追記し、次タスクを核（7.13.15.48/49）へ更新。

結果（固定；要点）：
- Weihs1998（longdist1）：Δmedian(A)≈0.083 ns（z≈5.54）、Δmedian(B)≈0.095 ns（z≈5.53）
- NIST（03_43 afterfixingModeLocking, s3600）：Δmedian(A)≈158 ns（z≈34.8）、Δmedian(B)≈217 ns（z≈43.9）

実行：
- `python -B scripts/quantum/bell_primary_products.py`
- `python -B scripts/summary/quantum_falsification.py`
- `python -B scripts/summary/paper_qc.py`

出力（更新）：
- `output/quantum/bell/falsification_pack.json`
- `output/summary/quantum_falsification.json`
- `output/summary/paper_qc.json`

---

## 2026-01-28（UTC） Phase 7（量子）/ Step 7.13.15.48：Δ²r（kink）の σ_obs に共分散（AR(1) 相関 ρ）を導入し、strict（3σ）判定の頑健性を再評価

目的：
- Δ²r（shell-closure kink）の strict no-go（Step 7.13.15.44）の判定が、`σ_obs` を独立誤差として扱っている点に依存していないかを検証する（B/Cの切り分け）。

変更：
- 更新：`scripts/quantum/nuclear_a_dependence_mean_field.py`
  - `--step 7.13.15.48` を追加。
  - Step 7.13.15.44 の Δ²r_pred/Δ²r_obs を固定入力とし、σ_obs(Δ²r) に AR(1) 共分散モデル（相関 ρ）を導入して ρ スイープ（-0.9..0.9, step 0.05）を固定出力化。
- 更新：`doc/ROADMAP.md`
  - Step 7.13.15.48 を【完了（初版）】へ更新（結果と出力ファイルを明記）。
- 更新：`doc/paper/12_part3_quantum.md`
  - 4.2.7.1 に Step 7.13.15.48 の結果（ρ≤-0.40 が必要、ρ≥0 では no-go 強化）を追記。

結果（固定；要点）：
- ρ=0（独立）で、従来の A_min=100 の worst（Sn≈3.07 at Z=58,N0=82；Sp≈3.72 at Z0=50,N=70）を再現。
- strict を両軸で通すには、隣接点の反相関が **ρ≤-0.40 程度**必要（救済はデータ側の共分散仮定に依存）。

実行：
- `python -B scripts/quantum/nuclear_a_dependence_mean_field.py --step 7.13.15.48`

出力（追加）：
- `output/quantum/nuclear_a_dependence_hf_three_body_radii_kink_delta2r_radius_magic_offset_even_even_center_magic_only_covariance_ar1_rho_sweep_metrics.json`
- `output/quantum/nuclear_a_dependence_hf_three_body_radii_kink_delta2r_radius_magic_offset_even_even_center_magic_only_covariance_ar1_rho_sweep.png`
- `output/quantum/nuclear_a_dependence_hf_three_body_radii_kink_delta2r_radius_magic_offset_even_even_center_magic_only_covariance_ar1_rho_sweep.csv`

---

## 2026-01-28（UTC） Phase 7（量子）/ Step 7.13.15.49：pairing（OES）最小拡張で Δ²r（shell-closure kink）を救済、β2補正は採用未確定

目的：
- Step 7.13.15.43–.46 の strict no-go（mean-field＋半径写像の限界）を受け、核構造側の “最小追加物理” を明示した上で、Δ²r strict を救えるかを固定する。
- 任意関数fit を避け、追加自由度を最小（固定I/F）に抑えたまま、救済/棄却の境界を明確化する。

変更：
- 更新：`scripts/quantum/nuclear_a_dependence_mean_field.py`
  - `--step 7.13.15.49` を追加。
  - pairing（OES 3点）を半径に線形で入れる最小モデル（`r -> r + k_n Δ_n + k_p Δ_p`）を実装し、`k_n,k_p` の凍結手順（nonmagic領域で weighted LS）を固定。
  - deformation（β2）の幾何補正（`r -> r*sqrt(1+(5/(4π))β2^2)`）を同時に入れるケースも同一I/Fで評価。
- 更新：`doc/paper/12_part3_quantum.md`
  - 4.2.7.1 に Step 7.13.15.49 の結果と解釈（no-go の位置づけ）を追記。
- 更新：`doc/ROADMAP.md`
  - Step 7.13.15.49 を【完了（初版）】へ更新（結果と出力ファイルを明記）。

結果（固定；要点）：
- pairingのみ（def0）：A_min=100 の shell-closure kink（strict set）が pass（max |resid|/σ_obs≈2.01）。
  - 凍結係数（初版）：`k_n≈0.0116 fm/MeV`, `k_p≈0.0087 fm/MeV`（n_fit=378）。
- deformation補正込み（def1）：同一凍結手順では fail（max≈7.17）。ただし grid では pass 点が存在するため、β2補正は現段階では **採用未確定**として保持する。

実行：
- `python -B scripts/quantum/nuclear_a_dependence_mean_field.py --step 7.13.15.49`

出力（追加）：
- `output/quantum/nuclear_a_dependence_hf_three_body_radii_kink_delta2r_radius_magic_offset_even_even_center_magic_only_pairing_deformation_minimal_metrics.json`
- `output/quantum/nuclear_a_dependence_hf_three_body_radii_kink_delta2r_radius_magic_offset_even_even_center_magic_only_pairing_deformation_minimal.png`
- `output/quantum/nuclear_a_dependence_hf_three_body_radii_kink_delta2r_radius_magic_offset_even_even_center_magic_only_pairing_deformation_minimal.csv`

---

## 2026-01-28（UTC） Phase 7（量子）/ Step 7.4：Bell を「完了」扱いへ更新（7.4.7.2 は blocked だが I/F 凍結済み）

目的：
- Step 7.4（Bell）が「宇宙論級（共分散＋系統＋反証条件）」に到達していることをロードマップ上で明確化し、Phase 7 の未完タスク（7.9/7.13/7.14/7.15）へ作業軸を戻す。

変更：
- 更新：`doc/ROADMAP.md`
  - Step 7.4 を【完了】へ更新。
  - Step 7.4.7 を【完了】へ更新（Giustina 2015 click log は一次未公開のため 7.4.7.2=blocked のまま保持するが、`data/quantum/sources/giustina2015_prl115_250401/manifest.json` に `primary_data_requirements` を凍結済み）。
- 更新：`doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`
  - 現在地と次作業（Step 7.13 出口条件整理→7.14 着手）を更新。

---

## 2026-01-28（UTC） Phase 7（量子）/ Step 7.13.15.49：Δ²r（shell-closure kink）の採用条件を凍結（pairing def0採用、β2 def1は別仮説）

目的：
- Step 7.13.15.49 の結果（pairingでpass／β2同時導入は凍結手順ではfail）を、論文・ロードマップ側で「採用（基準）/非採用（別仮説）」として明確化し、読者にとって曖昧さが残らない反証条件へ落とす。

変更：
- 更新：`doc/paper/12_part3_quantum.md`
  - 4.2.7.1 に「採用（この稿の核モジュール；凍結）」と「反証条件（固定）」を追記（pairing def0 を基準採用、β2 def1 は別仮説として切り離し）。
- 更新：`doc/ROADMAP.md`
  - Step 7.13.15.49 に「採用（基準）」を追記（Δ²rは pairing def0 を基準に扱う）。
- 更新：`doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`
  - 次作業（核力の未解決点→物性I/F設計）へ更新。

---

## 2026-01-28（UTC） Phase 7（量子）/ Step 7.14.1：物性（凝縮系）Si格子定数（NIST CODATA）を一次固定（基準値の凍結）

目的：
- Step 7.14（物性）の着手として、固体の幾何学的基準値（格子定数）を一次ソースから固定し、将来の再導出と反証条件設定へ接続する。

変更：
- 追加：`scripts/quantum/fetch_silicon_lattice_sources.py`
  - NIST Cuu（CODATA 2022）定数ページ `asil`（Si格子定数）と `d220sil`（Si(220)格子間隔）を取得し、`data/quantum/sources/nist_codata_2022_silicon_lattice/` に `manifest.json` / `extracted_values.json` を固定。
- 追加：`scripts/quantum/condensed_silicon_lattice_baseline.py`
  - 基準値（ターゲット）を `output/quantum/condensed_silicon_lattice_baseline_metrics.json`（+ png/csv）として固定出力化。
- 更新：`doc/PRIMARY_SOURCES.md`
  - Si格子定数（NIST CODATA）の一次URLとローカル保存先を追記。
- 更新：`doc/ROADMAP.md`
  - Step 7.14 を進行中とし、7.14.1 を【完了（初版）】で追記。
- 更新：`doc/paper/12_part3_quantum.md`
  - 4.2.9 に Si格子定数の基準値（ターゲット）を追記。
- 更新：`doc/paper/01_figures_index.md`
  - `output/quantum/condensed_silicon_lattice_baseline.png` を追記。

実行：
- `python -B scripts/quantum/fetch_silicon_lattice_sources.py`
- `python -B scripts/quantum/condensed_silicon_lattice_baseline.py`

出力（追加）：
- `output/quantum/condensed_silicon_lattice_baseline.png`
- `output/quantum/condensed_silicon_lattice_baseline_metrics.json`
- `output/quantum/condensed_silicon_lattice_baseline.csv`

---

## 2026-01-28（UTC） Phase 7（量子）/ Step 7.14.3：Si低温比熱（NIST-JANAF）を一次固定し、Debye（θ_D）ターゲットを固定出力化

目的：
- Step 7.14（物性）の “比熱” を低温側（100–300 K）へ拡張し、WebBook（298 K 以降）の空白に見える領域を一次固定で埋める。
- 低温 Cp(T) を Debye の 1-parameter（θ_D）で圧縮し、将来の再導出と棄却判定の入口（ターゲット）を固定する。

変更：
- 追加：`scripts/quantum/fetch_silicon_janaf_sources.py`
  - NIST-JANAF table（Si-004）の HTML/txt を取得し、`data/quantum/sources/nist_janaf_silicon_si/` に `manifest.json` / `extracted_values.json` を固定。
- 追加：`scripts/quantum/condensed_silicon_heat_capacity_debye_baseline.py`
  - JANAF Cp(T)（solid）を 100–300 K で Debye fit（Cv を Cp の proxy として使用）し、`θ_D` を基準値（ターゲット）として固定出力化（+ png/csv）。
- 更新：`doc/ROADMAP.md`
  - Step 7.14.3 を【完了（初版）】で追記（再現コマンドと出力ファイルを明記）。
- 更新：`doc/PRIMARY_SOURCES.md`
  - NIST-JANAF（Si-004）の一次URLとローカル保存先（sha256）を追記。
- 更新：`doc/paper/12_part3_quantum.md`
  - 4.2.11 に JANAF + Debye（θ_D）ターゲットを追記。
- 更新：`doc/paper/01_figures_index.md`
  - `output/quantum/condensed_silicon_heat_capacity_debye_baseline.png` を追記。

結果（固定；要点）：
- Debye fit（100–300 K；proxy）：`θ_D≈622.1 K`（σ_proxy≈17.4 K）。
- Cross-check（298.15 K）：WebBook（Shomate）−JANAF ≈ −0.0094 J/mol·K。

実行：
- `python -B scripts/quantum/fetch_silicon_janaf_sources.py`
- `python -B scripts/quantum/condensed_silicon_heat_capacity_debye_baseline.py`

出力（追加）：
- `output/quantum/condensed_silicon_heat_capacity_debye_baseline.png`
- `output/quantum/condensed_silicon_heat_capacity_debye_baseline_metrics.json`
- `output/quantum/condensed_silicon_heat_capacity_debye_baseline.csv`

---

## 2026-01-28（UTC） Phase 7（量子）/ Step 7.14.4：Si抵抗率 ρ(T)（NBS IR 74-496 Appendix E）を一次固定し、室温近傍の温度係数を固定出力化

目的：
- Step 7.14（物性）の追加ターゲットとして、固体の輸送（抵抗率）を一次データから固定し、将来の再導出と棄却判定の入口（観測ターゲット）へ接続する。

変更：
- 追加：`scripts/quantum/fetch_silicon_resistivity_nbsir74_496_sources.py`
  - NBS IR 74-496（Legacy IR）の PDF を取得し、Appendix E の ρ(T)（0–50°C）の range table を `extracted_values.json` に抽出固定。
- 追加：`scripts/quantum/condensed_silicon_resistivity_temperature_coefficient_baseline.py`
  - 室温近傍の温度係数を `d ln ρ / dT ≈ (ln ρ(30°C) − ln ρ(20°C))/10`（proxy）として計算し、基準値（ターゲット）を固定出力化（+ png/csv）。
- 更新：`doc/ROADMAP.md` / `doc/PRIMARY_SOURCES.md`
  - Step 7.14.4 を追記（一次URL/保存先/sha256、再現コマンド、出力ファイルを明記）。
- 更新：`doc/paper/12_part3_quantum.md` / `doc/paper/01_figures_index.md`
  - Part III に 4.2.12 を追加し、図一覧へ追記。

実行：
- `python -B scripts/quantum/fetch_silicon_resistivity_nbsir74_496_sources.py`
- `python -B scripts/quantum/condensed_silicon_resistivity_temperature_coefficient_baseline.py`

出力（追加）：
- `output/quantum/condensed_silicon_resistivity_temperature_coefficient_baseline.png`
- `output/quantum/condensed_silicon_resistivity_temperature_coefficient_baseline_metrics.json`
- `output/quantum/condensed_silicon_resistivity_temperature_coefficient_baseline.csv`

---

## 2026-01-28（UTC） Phase 7（量子）/ Step 7.10：Born則・測定（状態更新）の理論的位置づけを明確化（Part III 2.5.1–2.5.3）

目的：
- 「semi-classical（既存QMへφを代入しただけ）」批判を避けるため、P-model での量子側の扱い（仮定/導出/未導出、Born則の採用範囲と逸脱条件、測定更新の立場）を、論文本文だけで追跡できる形に固定する。

変更：
- 更新：`doc/paper/12_part3_quantum.md`
  - 2.5.1：仮定→導出の要約ブロックを追加し、式を数式ブロックへ統一（本文から LaTeX 風表記を排除）。
  - 2.5.2：Born則の採用範囲/逸脱条件を整理し、逸脱の検出しきい値（3σ）と自己重力指標 `m_crit` の例を追記。
  - 2.5.3：測定更新（Lüders/POVM）の式表記を整形。
- 更新：`doc/ROADMAP.md`
  - Step 7.10 を「完了」へ更新し、論文反映の範囲（2.5.1–2.5.3）を明記。

---

## 2026-01-28（UTC） Phase 7（量子）/ Step 7.14.5：Si 熱膨張係数 α(T)（NIST TRC cryogenics）を一次固定し、基準曲線を固定出力化

目的：
- Step 7.14（物性）の追加ターゲットとして、長さスケールの温度応答（熱膨張係数 α(T)）を一次ソースから固定し、将来の再導出と棄却判定へ接続する。

変更：
- 追加：`scripts/quantum/fetch_silicon_thermal_expansion_sources.py`
  - NIST TRC Cryogenics（Material Properties: Silicon）の HTML と図（式/plot/注記）をキャッシュし、係数 a–l と data range / fit error 行を `extracted_values.json` に抽出固定。
- 追加：`scripts/quantum/condensed_silicon_thermal_expansion_baseline.py`
  - ページ記載のブレンド式（erf gate）に従い α(T) を評価し、整数Kグリッド（13–600 K）で基準曲線を固定出力化（+ png/csv/metrics）。
- 更新：`doc/ROADMAP.md` / `doc/PRIMARY_SOURCES.md`
  - Step 7.14.5 を追記（一次URL/保存先/sha256、再現コマンド、出力ファイル）。
- 更新：`doc/paper/12_part3_quantum.md` / `doc/paper/01_figures_index.md`
  - Part III に 4.2.13 を追加し、図一覧へ追記。

結果（固定；要点）：
- data range：13–600 K（単位：`10^-8 / K`）。
- fit error relative to data（ページ記載）：`0.03×10^-8 / K (T<50 K)`、`0.5×10^-8 / K (T≥50 K)`。
- 代表値（例）：`α(298.15 K)≈259.856×10^-8 / K`。

実行：
- `python -B scripts/quantum/fetch_silicon_thermal_expansion_sources.py`
- `python -B scripts/quantum/condensed_silicon_thermal_expansion_baseline.py`

出力（追加）：
- `output/quantum/condensed_silicon_thermal_expansion_baseline.png`
- `output/quantum/condensed_silicon_thermal_expansion_baseline_metrics.json`
- `output/quantum/condensed_silicon_thermal_expansion_baseline.csv`

---

## 2026-01-28（UTC） Phase 8（論文化）/ Step 8.2：Part III（量子）DOCXが更新されない問題を修正（paper_lint阻害の解消）＋ part2/part3 DOCX再生成

目的：
- `output/summary/pmodel_paper_part2_astrophysics.docx` / `output/summary/pmodel_paper_part3_quantum.docx` が `output/summary/build_materials.bat` 実行後も更新されないケースを切り分け、再現可能な形で解消する。

原因と対応：
- Part III 原稿に **`[Reject]`** 表記が残っており、paper_lint が引用キーと誤認して `missing citation keys in references: [Reject]` で停止していた。
  - 対応：`doc/paper/12_part3_quantum.md` の `**[Reject]（閾値）**` を `**Reject（棄却閾値）**` に修正。

再生成：
- Part III（HTML）：`python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx --skip-tables`
- DOCX（part2/part3）：`python -B scripts/summary/html_to_docx.py --in output/summary/pmodel_paper_part*_*.html --out output/summary/pmodel_paper_part*_*.docx --paper-equations --orientation landscape --margin-mm 7`

---

## 2026-01-28（UTC） Phase 7（量子）/ Step 7.4.9：ベルテスト節（4.2.1）に既存批判との差異を追記（レビュアー対策）

目的：
- Part III のベルテスト解析が「既存批判の再現に過ぎない」と誤解されるリスクを下げるため、既存批判（Adenier / De Raedt / Larsson）と本稿の目的・手法・主張の違いを本文で明示する。
- 「自然な窓（natural window）」推奨の凍結根拠を、恣意性ではなく偶発同時計数（accidental）の統計的定義に基づくこととして明文化し、window/offset の逸脱を系統として扱う方針を固定する。

変更：
- 更新：`doc/paper/12_part3_quantum.md`
  - 4.2.1 の「結果（主要数値）」の直後に「既存批判との関係」ブロックを追記（3–5文の要約＋差異の散文＋目的宣言）。
  - natural window 推奨の決定アルゴリズムを補強し、accidental の統計的定義に基づく非恣意性と、窓の拡大/縮小を系統（sweep幅）として計上する方針を明記。
- 更新：`doc/paper/30_references.md`
  - Larsson 2014（loopholes review）を参考文献へ追加（引用キー追加）。

---

## 2026-01-28（UTC） Phase 8（論文化）/ Step 8.2：Part III 5節（差分予測）に Table 2（量子差分予測と棄却条件サマリ）を追加

目的：
- Part III の差分予測（反証可能性）が方針説明に留まって見える問題を抑え、レビュアーが「定量的な反証条件がない」と批判できない形で、量子テーマ横断の数値表（予測/現在精度/必要精度/棄却条件）を本文に固定する。
- Bell については「違反の有無」ではなく「手続き依存性の定量化」を主張する立場を維持しつつ、棄却条件（setting-independent 手続きが確立され、複数datasetで 3σ超の違反が一貫再現される場合）を表の形で明示する。

変更：
- 更新：`doc/paper/12_part3_quantum.md`
  - 5節に **Table 2** を追加（Bell / 干渉 / 量子時計 / de Broglie / decoherence を横断し、標準QM予測・P-model予測・現在精度・必要精度・棄却条件をサマリ）。
  - 各行の根拠として、固定出力（`output/quantum/*.json`）と凍結Step（7.4.9, 7.5.*, 7.6.2）を併記し、棄却閾値は Part III 3.0 の Rejection Protocol（3σ）に統一する旨を明記。

---

## 2026-01-28（UTC） Phase 8（論文化）/ Step 8.2：4.2.2（重力×量子干渉）に P-model固有の高次補正スケールと観測可能性を追記

目的：
- COW/原子干渉計/量子時計が弱場で標準理論と同スケールに見える点について、「どの高次で差分が現れ、現実の精度で検出可能か」を本文に固定し、レビュアーの「検証になっていない」批判を回避する。

変更：
- 更新：`doc/paper/12_part3_quantum.md`
  - 4.2.2 の「結果（差分予測：代表値）」の直後に、`φ_P=-c^2 ln(P/P0)` の弱場展開（高次項スケール）と、既存出力（`output/quantum/gravity_quantum_interference_delta_predictions.json` 等）に基づく「実験精度 vs 補正」の比較表を追記。
  - 結論として、地上弱場では差分検出が困難であり、将来の長基線宇宙実験や Part II（宇宙論）での間接拘束へ接続する方針を明文化。

---

## 2026-01-28（UTC） Phase 8（論文化）/ Step 8.2：4.2.7.1（shell-closure kink）に pairing補正の物理的根拠を追記（レビュアー対策）

目的：
- Step 7.13.15.49 の pairing補正（`r -> r + k_n Δ_n + k_p Δ_p`）について、「追加fitで逃げている」という誤解を避けるため、OES（Odd-Even Staggering）と 3点公式の位置づけ、半径への寄与の物理、k_n/k_p の解釈と凍結手順（kink点で再フィットしない）を本文で明示する。

変更：
- 更新：`doc/paper/12_part3_quantum.md`
  - 4.2.7.1 の「結論（この段階で固定できること）」の直後に「pairing補正の物理的根拠」を追記（OESの物理、密度→半径の関係、k_n/k_p の凍結正当性、β2補正は同手順で失敗するため採用しない旨）。
- 更新：`doc/paper/30_references.md`
  - pairing/OES の標準的背景として Bohr & Mottelson を追加（引用キー追加）。

---

## 2026-01-28（UTC） Phase 8（論文化）/ Step 8.2：2.5.2（Born則）に実験接続（m_crit 具体例＋計画実験）を追記

目的：
- 2.5.2 の Born則（採用範囲と逸脱条件）が理論整理に留まって見える問題を抑え、「どのスケールで逸脱が見えるか」を m_crit の数値例として固定し、計画実験（宇宙干渉計コンセプト等）への接続を本文に明示する。

変更：
- 更新：`doc/paper/12_part3_quantum.md`
  - 2.5.2 の「観測可能性（定量の形）」の直後に「実験接続（計画実験への予測）」を追記。
  - m_crit≃sqrt(ħ R/(G T)) の数値例（R,T）を表で示し、MAQRO/OTIMA/光格子時計（弱場で ε≈0）との関係と位置づけ（地上では直接検証困難→将来宇宙実験へ）を明文化。

---

## 2026-01-28（UTC） Phase 8（論文化）/ Step 8.2：Part III 4.2.7（原子核）に Step 7.13.5–7.13.8（barrier+tail）を反映

目的：
- 4.2.7 が 7.13.4 までで止まって見える問題を抑え、`v2s` 符号問題に対する「最小拡張（barrier+tail; global (k,q)）で包絡一致に到達」の事実を本文へ反映して、ロードマップ（Step 7.13.8）と整合させる。

変更：
- 更新：`doc/paper/12_part3_quantum.md`
  - 4.2.7 の結果に 7.13.5–7.13.8（barrier+tail; global (k,q)-scan）の要約を追記し、「2-range 系は棄却される一方で barrier+tail（global 2DOF）は棄却されない」ことを明文化。
  - 図リストに barrier+tail 系の出力（mean-preserving / k-scan / q-scan / kq-scan）を追加。

---

## 2026-01-28（UTC） Phase 8（論文化）/ Step 8.2：Table 1（量子）の原子核行を Step 7.13.8（barrier+tail; global (k,q)）へ更新

目的：
- ロードマップ上で核スケール `u(r)` の最小“生存候補”が Step 7.13.8（λ_π 制約下の barrier+tail; global (k,q)）に更新されているのに対し、Table 1（量子）の原子核行が旧来の棄却例（Step 7.9.8）を参照していた問題を解消し、論文の要約表を最新の固定出力へ揃える。

変更：
- 更新：`scripts/summary/paper_tables.py`
  - 原子核行の参照先を `output/quantum/nuclear_effective_potential_pion_constrained_barrier_tail_kq_scan_metrics.json`（Step 7.13.8）へ優先切替し、(k,q)・λ_π・`v2s` 包絡一致（envelope_ok）を表に出る形で整形。
- 更新（生成物）：`output/summary/paper_table1_quantum_results.md`（および `.json` / `.csv`）
  - 原子核行が barrier+tail（global (k,q)）を反映し、`envelope_ok(v2s)=yes` を示す形に更新。

---

## 2026-01-28（UTC） Phase 7（量子）/ Step 7.13.8.1：barrier+tail の (k,q) 拡張走査で v2t+v2s+ r_s 同時拘束を検証（no-go固定）

目的：
- Step 7.13.8（barrier+tail; global (k,q)）で singlet `v2s` 包絡一致に到達した一方で、triplet `v2t` が包絡外に出る問題が残るため、(k,q) 探索範囲を拡張して **triplet v2t と singlet (r_s,v2s)** の同時拘束が可能かを切り分け、反証条件として固定する。

変更：
- 更新：`scripts/quantum/nuclear_effective_potential_two_range.py`
  - 新規Step `7.13.8.1` を追加（λ_π 制約下の barrier+tail; (k,q) 拡張走査）。
  - scan 評価に `v2t` と `v2s` に加え、singlet `r_s`（`r_eff`）の包絡判定を追加（`r_s` が fit 失敗する領域を明示的に棄却）。
  - 併せて、`r_s` を「fit だから常に一致」と仮定していた判定を廃し、`r_s` も envelope 判定を行うように修正（`paper_table1` の自動要約の整合性改善）。
  - barrier+tail 系CSVに `v2t_fit/obs` と envelope 判定列を追加（解析上の見落とし防止）。
- 生成物：`python -B scripts/quantum/nuclear_effective_potential_two_range.py --step 7.13.8.1`
  - 出力：`output/quantum/nuclear_effective_potential_pion_constrained_barrier_tail_kq_scan_v2t.png` / `..._metrics.json` / `..._v2t.csv`
  - 結果（初版）：走査範囲（k∈[1.0..4.0], q∈[0.6..1.4], tail_len_over_lambda=1.0, barrier_len_fraction=0.5）では、**triplet v2t と singlet v2s を包絡へ入れても singlet r_s が崩れる**。最良候補は (k,q)=(3.5,1.3) で `v2t`/`v2s` は包絡内だが、`r_eff≈1.07 fm` と観測 `r_s≈2.63–2.68 fm` から大きく外れ、fit が成立しない（bisectionが収束せずフォールバック）。
- 更新：`doc/ROADMAP.md` / `doc/paper/12_part3_quantum.md`
  - Step 7.13.8.1 を追記し、同時拘束の no-go をロードマップと本文に反映。
- 更新：`scripts/summary/paper_tables.py` / `output/summary/paper_table1_quantum_results.*`
  - 原子核行に `envelope_ok(v2t)` を追加（自動判定）。
  - `7.13.8.1` の出力は `r_s` が通る場合のみ優先し、通らない場合は `7.13.8` を要約対象とする（誤って no-go 出力を“生存候補”として上書きしないため）。

---

## 2026-01-28（UTC） Phase 7（量子）/ Step 7.13.8.2：barrier+tail のチャネル依存 (k,q) 分離で v2t+v2s+ r_s 同時拘束を再検証（no-go継続）

目的：
- Step 7.13.8.1 の no-go（`v2t`/`v2s` を包絡へ入れると singlet `r_s` が崩壊）を受け、最小の追加自由度として tail の強度パラメータ (k,q) を triplet/singlet で分離（(k_t,q_t)/(k_s,q_s)）し、同時拘束が回復するかを一次データ（eq18/eq19）で切り分けて固定する。

変更：
- 更新：`scripts/quantum/nuclear_effective_potential_two_range.py`
  - 新規 Step `7.13.8.2` を追加（λ_π 制約下の barrier+tail；channel-split (k,q)-scan）。
  - 評価は triplet `v2t` 包絡＋ triplet (a_t,r_t) 安定性（許容幅）＋ singlet `r_s` 包絡＋ singlet `v2s` 包絡を outside_count で統合し、rank で選択する。
- 生成物：`python -B scripts/quantum/nuclear_effective_potential_two_range.py --step 7.13.8.2`
  - 出力：`output/quantum/nuclear_effective_potential_pion_constrained_barrier_tail_channel_split_kq_scan.png` / `output/quantum/nuclear_effective_potential_pion_constrained_barrier_tail_channel_split_kq_scan_metrics.json` / `output/quantum/nuclear_effective_potential_pion_constrained_barrier_tail_channel_split_kq_scan.csv`
  - 結果（初版）：走査（全108点）では `within_all=0`、かつ `r_s` が包絡に入る候補は 0 件。最良候補 (k_t,q_t)=(3.5,1.3), (k_s,q_s)=(0.5,1.0) でも `v2t`/`v2s` は包絡内だが、`r_s_fit≈1.17 fm`（obs≈2.63–2.68 fm）へ崩壊して `Δr_s≈-1.46〜-1.51 fm`。
  - 結論：チャネル依存 (k,q) 分離だけでは no-go は解消しない。次段階は幾何（R1/R2）や短距離自由度（core 等）を含む最小拡張の設計へ進む。
- 更新：`doc/ROADMAP.md` / `doc/paper/12_part3_quantum.md` / `doc/paper/01_figures_index.md`
  - Step 7.13.8.2 を追記し、結果（no-go継続）と固定出力をロードマップ・本文・図表インデックスへ反映。

---

## 2026-01-28（UTC） Phase 7（量子）/ Step 7.13.8.3：7.13.8.2 選択の凍結＋singlet `R1_s/λπ` scan で同時拘束を再検証（no-go継続）

目的：
- Step 7.13.8.2（channel-split (k,q)）でも singlet `r_s` の崩壊が解消しないため、追加自由度を 1つだけ（singlet の内側境界 `R1_s/λπ`）導入し、`v2s` 包絡一致と `r_s` 包絡一致の両立が可能かを最小コストで切り分けて固定する。
- ランタイム爆発を避けるため、(k,q) の再走査は行わず、**7.13.8.2 の選択 (k_t,q_t)/(k_s,q_s) を凍結して再利用**する。

変更：
- 更新：`scripts/quantum/nuclear_effective_potential_two_range.py`
  - 新規 Step `7.13.8.3` を追加（λ_π 制約下の barrier+tail；channel-split (k,q) を凍結＋singlet `R1_s/λπ` scan）。
  - Step 7.13.8.2 の metrics JSON から選択された (k_t,q_t)/(k_s,q_s) を読み込み、`R1_s/λπ` をグリッド走査して rank（outside_count など）で選択する手続きを実装。
- 生成物：`python -B scripts/quantum/nuclear_effective_potential_two_range.py --step 7.13.8.3`
  - 出力：`output/quantum/nuclear_effective_potential_pion_constrained_barrier_tail_channel_split_kq_scan_singlet_r1_scan.png` / `..._metrics.json` / `..._singlet_r1_scan.csv`

結果（初版）：
- 走査：`R1_s/λπ ∈ {0.25,0.35,0.45,0.55,0.65,0.75}`（global；7.13.8.2 の (k_t,q_t)=(3.5,1.3), (k_s,q_s)=(0.5,1.0) を凍結）。
- `R1_s/λπ≈0.45–0.55` では `r_s` は観測に一致し得る一方で、`v2s` が過度に負へ外れて包絡外（例：`v2s≈-0.52〜-0.61`）となる。
- `R1_s/λπ=0.75` では `v2s≈-0.061` と包絡内だが、`r_s≈1.17 fm` へ崩壊する（`Δr_s≈-1.46〜-1.51 fm`）。
- 結論：7.13.8.2 の選択を凍結したまま singlet 幾何を 1自由度だけ追加しても同時拘束は回復せず、no-go は継続する。次段階では `R2_s` の分離や短距離自由度（core 等）を含む最小拡張を設計し、同時拘束の可否を反証条件として固定する。

更新：
- 更新：`doc/ROADMAP.md` / `doc/paper/12_part3_quantum.md` / `doc/paper/01_figures_index.md`
  - Step 7.13.8.3（no-go継続）と固定出力（PNG/metrics/CSV）をロードマップ・本文・図表インデックスへ反映。

---

## 2026-01-29（UTC） Phase 7（量子）/ Step 7.13.8.4：7.13.8.2 選択の凍結＋singlet `R2_s/λπ` scan で `r_s` と `v2s` の同時包絡整合を回復

目的：
- Step 7.13.8.2（channel-split (k,q)）〜7.13.8.3（singlet `R1_s/λπ` scan）で残った主要 no-go（`r_s` を合わせると `v2s` が外れ、`v2s` を合わせると `r_s` が崩壊）を、追加自由度 1つ（singlet 外側境界 `R2_s/λπ`）だけで解消できるかを切り分け、固定出力として残す。

変更：
- 更新：`scripts/quantum/nuclear_effective_potential_two_range.py`
  - 新規 Step `7.13.8.4` を追加（λ_π 制約下の barrier+tail；7.13.8.2 の (k_t,q_t)/(k_s,q_s) を凍結し、7.13.8.3 の scan から `R1_s/λπ=0.45` を凍結した上で、singlet `R2_s/λπ` を走査）。
- 生成物：`python -B scripts/quantum/nuclear_effective_potential_two_range.py --step 7.13.8.4`
  - 出力：`output/quantum/nuclear_effective_potential_pion_constrained_barrier_tail_channel_split_kq_scan_singlet_r2_scan.png` / `..._metrics.json` / `..._singlet_r2_scan.csv`
  - 結果（初版）：`R2_s/λπ=1.5` で singlet は **`r_s` 包絡内かつ `v2s` 包絡内**に同時到達（eq18: `r_s≈2.626 fm, v2s≈-0.103`／eq19: `r_s≈2.676 fm, v2s≈-0.058`）。これにより、7.13.8.1–7.13.8.3 の主要 no-go（`r_s` vs `v2s`）を解消した。
- 更新：`doc/ROADMAP.md` / `doc/paper/12_part3_quantum.md` / `doc/paper/01_figures_index.md`
  - Step 7.13.8.4（singlet split の凍結）をロードマップ・本文・図表インデックスへ反映。

---

## 2026-01-29（UTC） Phase 7（量子）/ Step 7.13.8.5：7.13.8.4 の singlet split を凍結し、triplet の barrier split を走査して (a_t,r_t,v2t)×(r_s,v2s) を同時拘束

目的：
- Step 7.13.8.4 により singlet の同時拘束（`r_s` と `v2s`）は回復したが、triplet 側で `(a_t,r_t)` 許容幅外という残課題が残るため、最小の追加自由度として triplet の barrier/tail 分割比と強度を小グリッド走査し、同時拘束が可能かを固定する。

変更：
- 更新：`scripts/quantum/nuclear_effective_potential_two_range.py`
  - 新規 Step `7.13.8.5` を追加（7.13.8.4 の singlet split（`R1_s/λπ=0.45`, `R2_s/λπ=1.5`）と `q_t=1.3` を凍結し、triplet の `barrier_len_fraction_t` と `k_t` を走査）。
- 生成物：`python -B scripts/quantum/nuclear_effective_potential_two_range.py --step 7.13.8.5`
  - 出力：`output/quantum/nuclear_effective_potential_pion_constrained_barrier_tail_channel_split_kq_scan_triplet_barrier_fraction_scan.png` / `..._metrics.json` / `..._triplet_barrier_fraction_scan.csv`
  - 結果（初版）：`barrier_len_fraction_t=0.1`, `k_t=0.0`（`q_t=1.3` 固定）で **triplet は `(a_t,r_t)` 許容幅内かつ `v2t` 包絡内**に同時到達（eq18: `a_t≈5.4097 fm, r_t≈1.7497 fm, v2t≈0.052 fm^3`／eq19: `a_t≈5.4115 fm, r_t≈1.7523 fm, v2t≈0.055 fm^3`）。singlet 側も 7.13.8.4 の固定を維持し、`r_s` 包絡内かつ `v2s` 包絡内を満たす。これにより barrier+tail（channel-split + singlet split + triplet barrier split）の ansatz class は **(a_t,r_t,v2t)×(r_s,v2s)** の主要拘束で棄却されないことを固定した。

---

## 2026-01-29（UTC） Phase 8（論文化）/ Step 8.2：Table 1（量子）の原子核行を Step 7.13.8.5 の固定出力へ更新

目的：
- Step 7.13.8.5 で deuteron+np散乱の主要拘束（triplet `(a_t,r_t,v2t)` と singlet `(r_s,v2s)`）を同時に満たす固定候補に到達したため、論文要約表（Table 1）の原子核行をこの固定出力へ更新し、レビュアーが「どの固定条件が生存しているか」を即座に追える形へ揃える。

変更：
- 更新：`scripts/summary/paper_tables.py`
  - 原子核行の参照先を Step 7.13.8.5（`output/quantum/nuclear_effective_potential_pion_constrained_barrier_tail_channel_split_kq_scan_triplet_barrier_fraction_scan_metrics.json`）へ優先切替。
  - triplet tolerance（`|Δa_t|≤0.2 fm`, `|Δr_t|≤0.05 fm`）と envelope 判定（`r_s/v2s/v2t`）を表に出る形で要約。
- 更新（生成物）：`python -B scripts/summary/paper_tables.py`
  - `output/summary/paper_table1_quantum_results.md`（および `.json` / `.csv`）を再生成し、原子核行で `envelope_ok(v2t)=yes` と `tolerance_ok(triplet_ar)=yes` を明示。

---

## 2026-01-29（UTC） Phase 4（宇宙論）/ Step 4.8：XRISM 公開一次データによる BH/銀河団の X線スペクトル検証タスクをロードマップへ追加

目的：
- Phase 4 の「距離指標と独立な検証（Step 4.3）」を拡張し、XRISM（X線高分解能）の公開一次データ（FITS）から **z/速度/線幅**を直接固定できる検証項目を追加する。
- とくに BH/AGN の吸収線（UFO/disk wind）から **速度 v/c** を一次データで固定し、Phase 5.2（速度飽和 δ の上限制約）へ接続できる入口を用意する。

変更：
- 更新：`doc/ROADMAP.md`
  - Phase 4 に Step 4.8（XRISM：BH/銀河団の X線スペクトル解析）を追加し、I/F（入力・凍結・統計/系統・棄却条件・固定出力）とサブステップ（4.8.1–4.8.4）を明文化。
- 更新：`doc/PRIMARY_SOURCES.md`
  - XRISM の一次データ入口（HEASARC）を追加し、取得・キャッシュ（manifest）方針と保存先（案）を追記。
- 更新：`doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`
  - Step 4.8 を「次の作業」に追加（Phase 7 の継続タスクと併記）。

---

## 2026-01-29（UTC） Phase 4（宇宙論）/ Step 4.8.1：XRISM（HEASARC）一次データの取得・キャッシュ（manifest）とスペクトルQCの固定

目的：
- Step 4.8 の入口として、XRISM の公開一次データ（FITS）を obsid 単位で取得・キャッシュし、offline 再現できる manifest（sha256 付き）と、最小のスペクトルQC図を固定する。

変更：
- 追加：`scripts/xrism/fetch_xrism_heasarc.py`
  - HEASARC の XRISM archive（`https://heasarc.gsfc.nasa.gov/FTP/xrism/data/obs/`）を obsid 単位で探索し（cat=0..9 を試行）、Resolve/Xtend の products を取得・キャッシュする。
  - `--offline` で既存キャッシュから QC を再生成できる（再現性）。
- 追加：`output/xrism/xrism_targets_catalog.csv`
  - 対象選定（obsid/role 等）を固定するための最小カタログ（初版テンプレ）。

生成物（初版）：
- 取得・キャッシュ（例：Resolve products；obsid=000126000）：
  - `data/xrism/heasarc/manifest.json`
  - `data/xrism/heasarc/obs/0/000126000/resolve/products/`（rmf/pi 等）
- QC（例）：
  - `output/xrism/000126000__spectrum_qc.png`

再現：
- online（取得＋キャッシュ）：`python -B scripts/xrism/fetch_xrism_heasarc.py --obsid 000126000 --instrument resolve --download-missing --download-scope products`
- offline（QC再生成）：`python -B scripts/xrism/fetch_xrism_heasarc.py --obsid 000126000 --instrument resolve --offline --download-scope products`

---

## 2026-01-29（UTC） Phase 4（宇宙論）/ Step 4.8.2：XRISM（BH/AGN）Fe-K 吸収線 centroid→v/c の固定出力化（初版）

目的：
- BH/AGN の吸収線（UFO/disk wind）の centroid ずれから速度 v/c を一次データで固定し、統計と系統（手続き依存）を分離して「出力として」残す。

変更：
- 更新：`output/xrism/xrism_targets_catalog.csv`
  - role=`bh_agn` の初版ターゲット（NGC4151 / PDS456）を追加し、z_sys と instrument_prefer 列を追加。
- 追加：`scripts/xrism/xrism_bh_outflow_velocity.py`
  - PI+RMF（EBOUNDS）から energy 軸を復元し、Fe-K 吸収線（FeXXV_HeA / FeXXVI_LyA）の centroid を最小モデルで fit。
  - 系統 sweep（fit window / gain / rebin）を実行し、β（=v/c）の統計誤差と系統散らばりを固定出力。
- 更新：`scripts/xrism/fetch_xrism_heasarc.py`
  - Apache index の absolute link（`/FTP/...`）を辿ってサブツリー外へ再帰が漏れる問題を修正（誤ダウンロード防止）。
  - download_missing 時に 0バイトファイルを「欠損」とみなして再取得するよう修正（中断DLの回復）。

生成物（初版）：
- キャッシュ（例）：
  - `data/xrism/heasarc/obs/0/000125000/resolve/products/`（NGC4151）
  - `data/xrism/heasarc/obs/3/300072010/resolve/products/`（PDS456）
- 解析出力：
  - `output/xrism/<obsid>__line_fit.csv` / `output/xrism/<obsid>__line_fit_metrics.json`
  - `output/xrism/xrism_bh_outflow_velocity_summary.csv` / `output/xrism/xrism_bh_outflow_velocity_summary_metrics.json`
  - `output/xrism/<obsid>__FeXXV_HeA__fit.png` / `output/xrism/<obsid>__FeXXVI_LyA__fit.png`

再現：
- online（px=1000のみ取得する例）：`python -B scripts/xrism/fetch_xrism_heasarc.py --obsid 000125000 --obsid 300072010 --instrument resolve --download-missing --download-scope products --include-regex "p0px1000.*\\.rmf\\.gz$" --include-regex "p0px1000.*_src\\.pi\\.gz$"`
- offline（解析）：`python -B scripts/xrism/xrism_bh_outflow_velocity.py`

---

## 2026-01-29（UTC） Phase 4（宇宙論）/ Step 4.8.3：XRISM（銀河団）輝線 centroid/線幅→ z（距離指標非依存）と速度分散 σ_v の固定出力化（初版）

目的：
- XRISM（Resolve）の高分解能スペクトルから、銀河団の輝線 centroid（→z）と線幅（→σ_v；turbulence proxy）を一次データで固定し、光学z（catalogの z_sys）との cross-check と energy-scale 系統の上限を「出力」として残す。

変更：
- 更新：`output/xrism/xrism_targets_catalog.csv`
  - role=`cluster`（初版：Perseus_C1 / Coma）と role=`cluster_outskirts`（初版：Perseus_O1）を追加し、解析対象の恣意性を排除。
- 追加：`scripts/xrism/xrism_cluster_redshift_turbulence.py`
  - PI+RMF（EBOUNDS）から energy 軸を復元し、輝線（FeXXV_HeA / FeXXVI_LyA）の centroid と σ_E を最小モデルで fit。
  - fit window は z_opt（catalogの z_sys）から期待値 E_exp=E_rest/(1+z_opt) を作り、近傍（±window_halfwidth）で固定（窓幅・centroid bounds を固定して手続き依存を明示）。
  - 速度分散は `σ_v = c·σ_E/centroid` を採用し、Resolve の energy resolution（FWHM=5 eV を既定）を 1σ 換算して deconvolution（上限/参考）を併記。
  - 系統 sweep：fit window（3通り）／gain（±1e-3, 0）／rebin（min_counts=30,60）。検出基準：amp/σ_amp ≥ 3。

生成物（初版）：
- キャッシュ（例）：
  - `data/xrism/heasarc/obs/0/000156000/resolve/products/`（Perseus_C1）
  - `data/xrism/heasarc/obs/3/300073010/resolve/products/`（Coma）
- 解析出力：
  - `output/xrism/<obsid>__line_fit.csv` / `output/xrism/<obsid>__line_fit_metrics.json`
  - `output/xrism/xrism_cluster_redshift_turbulence_summary.csv` / `output/xrism/xrism_cluster_redshift_turbulence_summary_metrics.json`
  - `output/xrism/<obsid>__FeXXV_HeA__fit.png` / `output/xrism/<obsid>__FeXXVI_LyA__fit.png`

再現：
- online（px=1000のみ取得する例）：`python -B scripts/xrism/fetch_xrism_heasarc.py --obsid 000156000 --obsid 300073010 --instrument resolve --download-missing --download-scope products --include-regex "p0px1000.*\\.rmf\\.gz$" --include-regex "p0px1000.*_src\\.pi\\.gz$"`
- offline（解析）：`python -B scripts/xrism/xrism_cluster_redshift_turbulence.py`

---

## 2026-01-29（UTC） Phase 4（宇宙論）/ Step 4.8.4：XRISM統合（Phase 4.3/5.2 接続と Table 1 採用可否の固定）（初版）

目的：
- Step 4.8.2（BH/AGN: v/c）と Step 4.8.3（銀河団: z_xray, σ_v）の固定出力を統合し、(A) Phase 4.3（距離指標と独立な検証）への位置づけ、(B) Phase 5.2（速度飽和 δ）への接続形式、(C) Table 1 への採用/不採用（screening）を「出力として」固定する。

変更：
- 追加：`scripts/xrism/xrism_integration.py`
  - XRISM固定出力（BH/cluster summary CSV）を集約し、検出数・代表値・手続き系統（sys/stat）と採用ゲートを `output/xrism/xrism_integration_metrics.json` に固定。
  - δ接続（γ→δ上限）を計算し、XRISMの速度域（γ~O(1)）では Phase 5.2 の高γ上限を更新しないこと（接続形式のみ）を明文化。
- 更新：`scripts/summary/paper_tables.py`
  - Table 1 に XRISM（BH/AGN, 銀河団）行を追加し、現時点は **not_adopted_yet（screening）** として理由（対象数不足＋手続き系統支配）を明示。

生成物（初版）：
- `output/xrism/xrism_integration_metrics.json`
- `output/summary/paper_table1_results.json` / `.csv` / `.md`（XRISM行を追加）

再現：
- 統合metrics：`python -B scripts/xrism/xrism_integration.py`
- Table 1 更新：`python -B scripts/summary/paper_tables.py --out-dir output/summary`

---

## 2026-01-29（UTC） Phase 4（宇宙論）/ Step 4.6（JWST/MAST）補修：公開待ちの統合と Table 1（screening/参考）への行追加

目的：
- JWST/MAST x1d（スペクトル一次データ）の取得状況・z確定状況と、公開待ち（proprietary; GN-z11 など）の次回解放日時を統合して固定し、Table 1 に「参考（σ評価除外）」として表示できる形にする（議論がブレないようにする）。

変更：
- 追加：`scripts/cosmology/jwst_spectra_integration.py`
  - `data/cosmology/mast/jwst_spectra/manifest_all.json` と `output/cosmology/jwst_spectra_release_waitlist.json` から、targets/QC/z_confirmed/blocked/next_release を集約し `output/cosmology/jwst_spectra_integration_metrics.json` を固定。
- 更新：`scripts/summary/paper_tables.py`
  - Table 1 に JWST/MAST 行を追加し、現時点は **not_adopted_yet（screening/参考）** として（公開待ちが残るため）理由と next_release を明示。

生成物（初版）：
- `output/cosmology/jwst_spectra_integration_metrics.json`
- `output/summary/paper_table1_results.json` / `.csv` / `.md`（JWST/MAST 行を追加）

再現：
- 統合metrics：`python -B scripts/cosmology/jwst_spectra_integration.py`
- Table 1 更新：`python -B scripts/summary/paper_tables.py --out-dir output/summary`

---

## 2026-01-29（UTC） Phase 7（量子）/ Step 7.13.12–7.13.15 補修：核力 u-profile の canonical metrics 固定（A依存/ Table 1 参照の統一）

目的：
- Step 7.13.8.5（λ_π 制約下の barrier+tail；channel-split + singlet split + triplet barrier split）を現時点の“生存候補”として扱う際に、A依存（7.13.12 以降）や Table 1 が参照する metrics を **固定名（canonical）**へ統一し、長い step-specific filename のハードコードを排除する。

変更：
- 更新：`scripts/quantum/nuclear_effective_potential_two_range.py`
  - Step 7.13.8.5 の実行時に `output/quantum/nuclear_effective_potential_canonical_metrics.json` を生成（安定エイリアス；downstream の優先参照先）。
- 更新：`scripts/quantum/nuclear_a_dependence_mean_field.py`
  - 有効ポテンシャルの参照を canonical 優先へ変更し、metrics 出力の inputs に `potential_metrics`（step/canonical 情報を含む）を追加。
  - 7.13.12/13/14/15 を再生成して inputs の参照先と sha256 を更新。
- 更新：`scripts/summary/paper_tables.py`
  - Table 1（量子）の原子核行で canonical を優先参照し、canonical を 7.13.8.5（triplet barrier fraction scan）の同型入力として処理。

生成物（更新/追加）：
- `output/quantum/nuclear_effective_potential_canonical_metrics.json`
- `output/quantum/nuclear_a_dependence_mean_field_metrics.json`
- `output/quantum/nuclear_a_dependence_mean_field_density_repulsion_metrics.json`
- `output/quantum/nuclear_a_dependence_mean_field_repulsion_radii_frozen_metrics.json`
- `output/quantum/nuclear_a_dependence_hf_three_body_radii_frozen_metrics.json`
- `output/summary/paper_table1_quantum_results.md`（原子核行の `source=` が canonical）

再現：
- canonical 生成：`python -B scripts/quantum/nuclear_effective_potential_two_range.py --step 7.13.8.5`
- A依存（例）：`python -B scripts/quantum/nuclear_a_dependence_mean_field.py --step 7.13.12`
- Table 1 更新：`python -B scripts/summary/paper_tables.py --out-dir output/summary`

---

## 2026-01-29（UTC） Phase 7（量子）/ Step 7.14.6：OFHC Copper 熱伝導率 κ(T)（NIST TRC）を一次固定し、基準曲線を固定出力化（初版）

目的：
- 物性（凝縮系）の代表として、NIST TRC Cryogenics の一次 fit を用いて OFHC Copper の熱伝導率 κ(T) を固定し、以後の再導出（P-model側の最小モデル）に対して反証条件を設定できる “凍結ターゲット” を増やす。

変更：
- 追加：`scripts/quantum/fetch_ofhc_copper_thermal_conductivity_sources.py`
  - NIST TRC の HTML（RRR=50/100/150/300/500 の κ(T) 係数表）をキャッシュし、`extracted_values.json` へ係数 a–i・範囲・誤差を抽出して固定。
- 追加：`scripts/quantum/condensed_ofhc_copper_thermal_conductivity_baseline.py`
  - κ(T) の基準曲線（RRR別）を計算し、CSV/PNG と metrics を固定出力化。

生成物（初版）：
- 入力キャッシュ：
  - `data/quantum/sources/nist_trc_ofhc_copper_thermal_conductivity/manifest.json`
  - `data/quantum/sources/nist_trc_ofhc_copper_thermal_conductivity/extracted_values.json`
- ベースライン出力：
  - `output/quantum/condensed_ofhc_copper_thermal_conductivity_baseline.png`
  - `output/quantum/condensed_ofhc_copper_thermal_conductivity_baseline_metrics.json`
  - `output/quantum/condensed_ofhc_copper_thermal_conductivity_baseline.csv`

再現：
- 取得・抽出：`python -B scripts/quantum/fetch_ofhc_copper_thermal_conductivity_sources.py`
- ベースライン：`python -B scripts/quantum/condensed_ofhc_copper_thermal_conductivity_baseline.py`

---

## 2026-01-29（UTC） Phase 8（論文化）/ Step 8.2（補修）：XRISM を Part II §4.13 として独立節化（更新可能な解析I/Fの固定）

目的：
- XRISM は公開データ（obsid）が継続的に追加されるため、「現状の結論」を先に確定するのではなく、将来の高精度更新に耐える **再現可能な解析I/F**（入力、凍結条件、統計/系統の分離、採用ゲート、固定出力）を論文本文で独立節として固定する。

変更：
- 更新：`doc/paper/11_part2_astrophysics.md`
  - `### 4.13 XRISM（X線高分解能スペクトル：Resolve）` を新設（4.12 の後、5章の前）。
  - BH/AGN（吸収線 centroid→v/c）、銀河団（輝線 centroid/線幅→z_xray, σ_v）、系統 sweep（window/gain/rebin）、採用ゲート（screening）と固定出力名を明文化。
- 更新：`doc/ROADMAP.md`
  - Step 4.8.5（論文化：Part II §4.13）を追記し、ロードマップ→本文の参照を固定。
- 更新：`doc/STATUS.md`
  - Step 4.8 の参照に `doc/paper/11_part2_astrophysics.md`（§4.13）を追加。

再現：
- XRISM統合：`python -B scripts/xrism/xrism_integration.py`
- Table 1 更新：`python -B scripts/summary/paper_tables.py --out-dir output/summary`

---

## 2026-01-29（UTC） Phase 4（宇宙論）/ Step 4.8（XRISM）補修：DARTS rev3 を一次の正として統合し、Table 1（銀河団）を adopted へ更新

目的：
- XRISM は公開データが増え続ける前提のため、一次ソース（DARTS）から「公開済みobsid→取得→解析→採用ゲート」の I/F を固定し、将来の高精度更新（event-level抽出等）に耐える基盤を作る。
- 特に、銀河団の z_xray（距離指標非依存）が **複数datasetで再現**できる状態（detected_obsids≥2）と、手続き系統が統計の10倍以下（sys/stat≤10）という最小ゲートを満たすかを Table 1 で判定できるようにする。

変更：
- 追加：`scripts/xrism/fetch_xrism_darts_metadata.py`
  - DARTS public list と Resolve metadata CSV を取得し、`data/xrism/sources/darts/manifest.json`（sha256）と `output/xrism/darts_resolve_public_observations.csv` を固定。
- 追加：`scripts/xrism/build_xrism_target_catalog.py`
  - seed ターゲット（CenA/NGC4151/PDS456/主要銀河団/SNR）を `data/xrism/sources/xrism_target_catalog.json` として固定（z_opt/参照/期待線/arXiv台帳）。
- 追加：`scripts/xrism/fetch_xrism_darts_rev3.py`
  - DARTS rev3 を `data/xrism/raw/<obsid>/` に mirror 取得し、`data/xrism/sources/<obsid>/manifest.json`（sha256）を固定（スコープ追加のマージ対応）。
- 追加：`scripts/xrism/update_xrism_targets_catalog_from_json.py`
  - `data/xrism/sources/xrism_target_catalog.json` から `output/xrism/xrism_targets_catalog.csv` へ追記補完。
- 更新：`scripts/xrism/xrism_bh_outflow_velocity.py` / `scripts/xrism/xrism_cluster_redshift_turbulence.py`
  - `data/xrism/raw/<obsid>/`（直下obsid）を data-root として探索できるように補修（DARTS cache をそのまま解析可能に）。
- 更新：`scripts/xrism/xrism_integration.py`
  - Table 1 採用ゲートを `min_detected_obsids=2` + `sys/stat≤10` へ更新し、銀河団が adopted になる状態を反映。
- 更新：`scripts/summary/paper_tables.py`
  - `output/xrism/xrism_integration_metrics.json` を反映し、Table 1（XRISM銀河団）を adopted へ更新。

生成物（更新/追加）：
- `data/xrism/sources/darts/manifest.json` / `output/xrism/darts_resolve_public_observations.csv`
- `data/xrism/sources/xrism_target_catalog.json`
- `data/xrism/raw/<obsid>/` / `data/xrism/sources/<obsid>/manifest.json`
- `output/xrism/xrism_bh_outflow_velocity_summary.csv`
- `output/xrism/xrism_cluster_redshift_turbulence_summary.csv`
- `output/xrism/xrism_integration_metrics.json`
- `output/summary/paper_table1_results.md`

再現：
- metadata：`python -B scripts/xrism/fetch_xrism_darts_metadata.py`
- seed：`python -B scripts/xrism/build_xrism_target_catalog.py`
- rev3取得（products例）：`python -B scripts/xrism/fetch_xrism_darts_rev3.py --catalog data/xrism/sources/xrism_target_catalog.json --scope products --include-regex "p0px1000.*\\.rmf\\.gz$" --include-regex "p0px1000.*_src\\.pi\\.gz$"`
- 解析：`python -B scripts/xrism/xrism_cluster_redshift_turbulence.py --data-root data/xrism/raw --role cluster` / `python -B scripts/xrism/xrism_bh_outflow_velocity.py --data-root data/xrism/raw --role bh_agn`
- 統合：`python -B scripts/xrism/xrism_integration.py`
- Table 1：`python -B scripts/summary/paper_tables.py --out-dir output/summary`

---

## 2026-01-29（UTC） Phase 4（宇宙論）/ Step 4.8（XRISM）補修：BH/AGN を Table 1 adopted（detected_obsids=2/5, sys/stat≈3.38）へ更新

目的：
- BH/AGN（吸収線 centroid→β）の統合で、sys/stat≤10 を満たす検出 obsid を 2 件以上にし、Table 1 の採用ゲートへ到達させる。

変更：
- 更新：`scripts/xrism/xrism_bh_outflow_velocity.py`
  - best selection を「detected fit の中で min(chi2_red)（fallback: min(chi2_red)）」へ変更し、固定 sweep（window/gain/rebin）内での検出可否を出力へ反映。
- 更新：`scripts/xrism/xrism_integration.py`
  - sys/stat ゲート（≤10）を満たす obsid を採用カウント（detected_obsids）とし、高系統 obsid を excluded として列挙（BH/AGN の Table 1 判定を adopted へ更新）。
- 更新：`doc/ROADMAP.md` / `doc/paper/11_part2_astrophysics.md` / `doc/STATUS.md`
  - XRISM（BH/AGN）の Table 1 状態（adopted）と excluded の扱いを反映。
- 更新：`output/xrism/xrism_integration_metrics.json` / `output/summary/paper_table1_results.md`

結果（固定）：
- BH/AGN：detected_obsids=2/5, sys/stat≈3.38（excluded_detected_obsids_sysdom=[300019010,300047040,300072010]）

再現：
- BH解析：`python -B scripts/xrism/xrism_bh_outflow_velocity.py --data-root data/xrism/raw --role bh_agn`
- 統合：`python -B scripts/xrism/xrism_integration.py`
- Table 1：`python -B scripts/summary/paper_tables.py --out-dir output/summary`

---

## 2026-01-29（UTC） Phase 4（宇宙論）/ Step 4.8（XRISM）補修：BH/AGN の excluded を縮小（detected_obsids=4/5; excluded=PDS456）

目的：
- BH/AGN の sys/stat が「非検出の局所最小」に引っ張られて過大化し、excluded が増える問題を抑制し、同一obsid内で安定な line_id を代表として採用できる形にする。

変更：
- 更新：`scripts/xrism/xrism_bh_outflow_velocity.py`
  - 系統（beta_sys/centroid_sys）を **detected+ok の sweep**から優先推定（fallback: ok）し、非検出 fit を混ぜて sys が爆発することを避けた（policy を metrics に明記）。
- 更新：`scripts/xrism/xrism_integration.py`
  - obsid代表行（per_obsid_best）を「detected → sys/stat≤10 → σ_total最小」の順で決定し、同一obsidで安定な line_id を採用できるようにした。
- 更新：`output/xrism/xrism_integration_metrics.json` / `output/summary/paper_table1_results.md`
  - BH/AGN：detected_obsids=4/5 に改善し、excluded は PDS456 のみに縮小。

結果（固定）：
- BH/AGN：detected_obsids=4/5, excluded_detected_obsids_sysdom=[300072010]

再現：
- BH解析：`python -B scripts/xrism/xrism_bh_outflow_velocity.py --data-root data/xrism/raw --role bh_agn`
- 統合：`python -B scripts/xrism/xrism_integration.py`
- Table 1：`python -B scripts/summary/paper_tables.py --out-dir output/summary`

---

## 2026-01-29（UTC） Phase 4（宇宙論）/ Step 4.8（XRISM）補修：BH/AGN を detected_obsids=5/5（excludedなし）へ改善

目的：
- PDS456 が sys/stat>10 で excluded になっていたため、fit quality（χ²_red）の差が大きい候補を「系統」として同列に扱わないようにし、採用ゲート（sys/stat≤10）の判定が妥当な範囲の手続き差を反映するようにする。

変更：
- 更新：`scripts/xrism/xrism_bh_outflow_velocity.py`
  - sys 推定を detected fit（amp/σ_amp≥3）に限定した上で、fit quality（χ²_red）の差で重み付け（w=exp(-(χ²_red−min)/τ)）して weighted std を採用（fallback: unweighted std）。
- 更新：`output/xrism/xrism_bh_outflow_velocity_summary.csv` / `output/xrism/xrism_integration_metrics.json`
  - PDS456（FeXXVI Lyα）の sys/stat が 13.4→8.19 となり、excluded が解消。
- 更新：`output/summary/paper_table1_results.md` / `doc/ROADMAP.md` / `doc/STATUS.md` / `doc/paper/11_part2_astrophysics.md`
  - BH/AGN の detected_obsids=5/5 を反映。

結果（固定）：
- BH/AGN：detected_obsids=5/5, excluded_detected_obsids_sysdom=[]

再現：
- BH解析：`python -B scripts/xrism/xrism_bh_outflow_velocity.py --data-root data/xrism/raw --role bh_agn`
- 統合：`python -B scripts/xrism/xrism_integration.py`
- Table 1：`python -B scripts/summary/paper_tables.py --out-dir output/summary`

---

## 2026-01-29（UTC） Phase 4（宇宙論）/ Step 4.8（XRISM）補修：event-level QC（Pixel除外/GTI）を最小I/Fとして固定

目的：
- event_cl（event-level）から PI histogram を再構成し、Pixel除外（例：Pixel 27）や GTI 適用の効果を「手続き差（系統）」として定量化できる入口を作る。
- 将来の XRISM 公開 obsid 増加・校正更新に備え、解析I/F（入力→処理→比較指標→固定出力）を先に閉じる。

変更：
- 更新：`scripts/cosmology/boss_dr12v5_fits.py`
  - XRISM event FITS に含まれる bit-array（TFORM=...X）を読み飛ばせるよう、TFORM `X` の幅（ceil(bits/8) bytes）を追加サポート。
- 追加：`scripts/xrism/xrism_event_utils.py`
  - event_cl の `TIME/PI/PIXEL` を chunk 読みし、(i) GTI（event内のGTI拡張を優先）適用、(ii) Pixel除外、(iii) RMF channel へのヒストグラム化、の最小実装を追加。
- 追加：`scripts/xrism/xrism_event_level_qc.py`
  - products（*_src.pi.gz）と event-level PI histogram を Fe-K帯域で比較し、`output/xrism/<obsid>__event_level_qc.json` と要約 `output/xrism/xrism_event_level_qc_summary.csv` を固定出力。

結果（固定）：
- PDS456（obsid=300072010）について、event内GTI（114区間）を適用した上で Pixel 27 を除外すると、Pixel 27 は **586/40307（約1.45%）**。
- 同 obsid の Fe-K帯域（5.5–7.5 keV）で、products vs event の差は **L1≈1.06%**、エネルギー重み付き平均の差は **-0.76 eV**（event−products）だった（`output/xrism/300072010__event_level_qc.json`）。

再現：
- 取得（最小；PDS456）：`python -B scripts/xrism/fetch_xrism_darts_rev3.py --obsid 300072010 --scope event_cl --scope log --scope auxil --include-regex "^resolve/event_cl/xa300072010rsl_p0px1000_cl\\.evt\\.gz$" --include-regex "^log/" --include-regex "^auxil/xa300072010_gen\\.gti\\.gz$"`
- QC：`python -B scripts/xrism/xrism_event_level_qc.py --obsid 300072010 --apply-gti`

---

## 2026-01-29（UTC） Roadmap 追記：GW250114（QNM/Area theorem/IMR）と Fe-Kα 相対論的広がり（ISCO）を追加

目的：
- レビュアー向けに「強場で検証可能な観測量（QNM/ISCO）」の追加パスをロードマップ上で明示し、Part II の該当節（§4.11 重力波、§4.13 XRISM）の拡張計画を固定する。

変更：
- 更新：`doc/ROADMAP.md`
  - Step 3.5.1：GW250114（GWOSC公開）で QNM 周波数/減衰時間、Area theorem、IMR consistency を固定出力化するタスクを追加。
  - Step 4.8.7：Fe-Kα 相対論的 broad line（GX 339-4 等）を XMM-Newton/NuSTAR + XRISM 公開で解析し、ISCO 制約と P-model 予測比較へ接続するタスクを追加。
- 更新：`doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`
  - 上記の追加タスクを「次の作業」に反映。

結果（固定）：
- ロードマップに「GW250114（3.5.1）」と「Fe-Kα broadening（4.8.7）」を追加し、準備中として管理を開始した。

---

## 2026-01-29（UTC） Phase 4（宇宙論）/ Step 4.8.6（XRISM）補修：event-level QC を BH/AGN+銀河団の7 obsidへ拡張

目的：
- event_cl（event-level）から PI histogram を再構成し、Pixel除外（例：Pixel 27）/GTI の手続き差を **複数obsid横断**で固定する（adopted 判定の頑健性確認の土台）。

変更：
- 更新：`data/xrism/raw/<obsid>/resolve/event_cl/*`
  - DARTS rev3 から px=1000 の event_cl（`*_cl.evt.gz`）を BH/AGN と銀河団へ拡張取得。
- 更新：`output/xrism/xrism_event_level_qc_summary.csv` / `output/xrism/<obsid>__event_level_qc.json`
  - Fe-K帯域（5.5–7.5 keV）で products（PI）と event_cl 由来の差を固定出力化。

結果（固定）：
- 対象（7 obsid）：300019010 / 300047020 / 300047040 / 300072010 / 000138000 / 000156000 / 300073010
- Fe-K帯域の products vs event の差は **L1≈0.7–3.4%**、平均エネルギー差（event−products）は **±0.8 eV以内**（要約：`output/xrism/xrism_event_level_qc_summary.csv`）。

再現：
- 取得（px=1000 の event_cl のみ）：`python -B scripts/xrism/fetch_xrism_darts_rev3.py --obsid 300019010 --obsid 300047020 --obsid 300047040 --obsid 000138000 --obsid 000156000 --obsid 300073010 --scope event_cl --include-regex "^resolve/event_cl/xa[0-9]{9}rsl_p0px1000_cl\\.evt\\.gz$"`
- QC：`python -B scripts/xrism/xrism_event_level_qc.py --obsid 300019010 --obsid 300047020 --obsid 300047040 --obsid 300072010 --obsid 000138000 --obsid 000156000 --obsid 300073010 --apply-gti`

---

## 2026-01-29（UTC） Phase 4（宇宙論）/ Step 4.8（XRISM）補修：event-level QC を統合 metrics に組み込み

目的：
- 4.8.6 で固定した event-level QC（products vs event_cl）を、XRISM の統合 metrics（Table 1採用判定の固定出力）側にも含め、手続き差（Pixel除外/GTI）を **同じJSONで横断確認できる形**にする。
- これは Table 1 のゲート（detected_obsids≥2 かつ sys/stat≤10）を変更するためではなく、「手続き頑健性チェック」を出力として凍結するため。

変更：
- 更新：`scripts/xrism/xrism_integration.py`
  - `output/xrism/xrism_event_level_qc_summary.csv` を読み込み、BH/AGN・銀河団の各 summary に `event_level_qc`（coverage, L1 range, mean shift eV range）を追記。
  - `per_obsid_best` 行にも、該当 obsid の QC が存在する場合は `event_level_qc` を付与。
- 更新：`output/xrism/xrism_integration_metrics.json`
  - `inputs.event_level_qc_summary_csv` と、`xrism.{bh,cluster}.event_level_qc` を固定出力化。

結果（固定）：
- BH/AGN 側は catalog 5 obsid のうち 4 obsid で event-level QC が対応（coverage=0.8）。Fe-K帯域の差は L1≈0.72–1.06%、平均エネルギー差は -0.76〜+0.38 eV（event−products）。

再現：
- 統合：`python -B scripts/xrism/xrism_integration.py`

---

## 2026-01-29（UTC） Phase 4（宇宙論）/ Step 4.8.7（XRISM拡張）準備：XMM/NuSTAR 一次ソースを追加し、QC統合をロードマップへ反映

目的：
- Fe-Kα 相対論的 broad line（ISCO 制約）で使用する XMM-Newton/NuSTAR の一次データソースを `doc/PRIMARY_SOURCES.md` に明示し、取得→cache→sha256→再現の入口を先に固定する。
- 4.8.6 の event-level QC が統合 metrics 側にも取り込まれていることを、`doc/ROADMAP.md`（4.8.6）へ明記して運用上の参照点を一つにする。

変更：
- 更新：`doc/PRIMARY_SOURCES.md`
  - XMM-Newton（XSA）/ NuSTAR（HEASARC）を Step 4.8.7 の関連一次データとして追記し、保存先（`data/xrism/xmm_nustar/`）と manifest を明記。
- 更新：`doc/ROADMAP.md`
  - Step 4.8.6 に、統合 metrics（`scripts/xrism/xrism_integration.py`）への event-level QC 取り込みを追記。

---

## 2026-01-29（UTC） Phase 4（宇宙論）/ Step 4.8（XRISM）補修：event-level QC を line fit の系統誤差へ統合（sys_total）

目的：
- event-level QC（products vs event_cl の平均エネルギー差）を、BH/AGN（β）および銀河団（z_xray）の **系統誤差の内訳**へ統合し、Table 1 の adopted 判定が「手続き差」を入れても崩れないことを数値で固定する。

変更：
- 更新：`scripts/xrism/xrism_bh_outflow_velocity.py`
  - `output/xrism/xrism_event_level_qc_summary.csv` を読み込み、line fit の系統に `centroid_sys_event_level_keV`（=|mean_shift|）と `beta_sys_event_level` を追加。
  - (window/gain/rebin) sweep の散らばり（`*_sys`）と二乗和で合成した `*_sys_total` を出力（CSV/metrics JSON）。
- 更新：`scripts/xrism/xrism_cluster_redshift_turbulence.py`
  - 同様に `centroid_sys_event_level_keV` と `z_xray_sys_event_level` を追加し、`*_sys_total` を出力。
- 更新：`scripts/xrism/xrism_integration.py`
  - summary CSV に `*_sys_total` がある場合はそれを優先して採用ゲート（sys/stat）を評価（後方互換として無い場合は従来 `*_sys` を使用）。

結果（固定）：
- `output/xrism/xrism_integration_metrics.json` の Table 1 判定は、BH/AGN・銀河団ともに **adopted を維持**（event-level を系統に入れても gate を満たす）。

再現：
- BH/AGN：`python -B scripts/xrism/xrism_bh_outflow_velocity.py --data-root data/xrism/raw --role bh_agn`
- 銀河団：`python -B scripts/xrism/xrism_cluster_redshift_turbulence.py --data-root data/xrism/raw --role cluster`
- 統合：`python -B scripts/xrism/xrism_integration.py`
- Table 1反映：`python -B scripts/summary/paper_tables.py --out-dir output/summary`

---

## 2026-01-29（UTC） Phase 4（宇宙論）/ Step 4.8.6（XRISM）補修：event-level QC を 8 obsid に拡張し、coverage=1.0 を固定

目的：
- BH/AGN 側で event-level QC が未対応だった obsid（000125000）の event_cl を取得し、QCサマリを全対象で再生成して **coverage=1.0** を固定する（以後、手続き差の議論が欠損obsidに依存しない）。

変更：
- 更新：`data/xrism/raw/000125000/resolve/event_cl/*`
  - DARTS rev3 から px=1000 の event_cl を追加取得。
- 更新：`output/xrism/xrism_event_level_qc_summary.csv`
  - 対象（8 obsid）：000125000 / 300019010 / 300047020 / 300047040 / 300072010 / 000138000 / 000156000 / 300073010
  - BH/AGN・銀河団ともに `event_level_qc.coverage=1.0`（`output/xrism/xrism_integration_metrics.json`）。

再現：
- 取得：`python -B scripts/xrism/fetch_xrism_darts_rev3.py --obsid 000125000 --scope event_cl --include-regex "^resolve/event_cl/xa[0-9]{9}rsl_p0px1000_cl\\.evt\\.gz$"`
- QC（全対象で再生成；上書き）：`python -B scripts/xrism/xrism_event_level_qc.py --obsid 000125000 --obsid 300019010 --obsid 300047020 --obsid 300047040 --obsid 300072010 --obsid 000138000 --obsid 000156000 --obsid 300073010 --apply-gti`
- 再集計：`python -B scripts/xrism/xrism_bh_outflow_velocity.py --data-root data/xrism/raw --role bh_agn; python -B scripts/xrism/xrism_cluster_redshift_turbulence.py --data-root data/xrism/raw --role cluster; python -B scripts/xrism/xrism_integration.py`

---

## 2026-01-29（UTC） Phase 4（宇宙論）/ Step 4.8（XRISM）補修：pixel_exclude/GTI の手続き sweep を variant 出力として固定

目的：
- pixel_exclude / GTI の on/off を sweep し、手続き差（event-level）の寄与を **上書きせず保存**できる形で固定する（次回以降の校正更新・obsid追加でも同じ形式で追記できるようにする）。

変更：
- 更新：`scripts/xrism/xrism_event_level_qc.py`
  - `--variant`（suffix）を追加し、`xrism_event_level_qc_summary__<variant>.csv` と `<obsid>__event_level_qc__<variant>.json` を生成可能にした。
  - `--sweep-procedure` を追加し、(apply_gti on/off)×(pixel_exclude none/27) の 2×2 sweep を一括生成し、`output/xrism/xrism_event_level_qc_sweep_metrics.json` に要約を固定した。
- 更新：`scripts/xrism/xrism_integration.py`
  - `output/xrism/xrism_event_level_qc_sweep_metrics.json` が存在する場合は `xrism.event_level_qc_sweep` として統合 metrics に取り込み（再現I/Fの参照点を一つにする）。
- 更新：`doc/ROADMAP.md` / `doc/paper/11_part2_astrophysics.md`
  - 4.8.6 に sweep 出力を追記し、本文にも sweep 要約ファイルを参照として追記。

結果（固定）：
- 対象（8 obsid）：000125000 / 300019010 / 300047020 / 300047040 / 300072010 / 000138000 / 000156000 / 300073010
- pixel_exclude=27（gti on/off）では L1≈0.72–3.37%、mean shift は -0.76〜+0.38 eV（event−products）。pixel_exclude無しでは差は0（このサンプルでの比較）。

再現：
- sweep：`python -B scripts/xrism/xrism_event_level_qc.py --sweep-procedure --obsid 000125000 --obsid 300019010 --obsid 300047020 --obsid 300047040 --obsid 300072010 --obsid 000138000 --obsid 000156000 --obsid 300073010`
- 統合更新：`python -B scripts/xrism/xrism_integration.py`

---

## 2026-01-29（UTC） Phase 4（宇宙論）/ Step 4.8.7（Fe-Kα relativistic broad line / ISCO）開始：XMM/NuSTAR の取得I/Fと ISCO台帳（stub）を固定

目的：
- Fe-Kα の相対論的 broad line（反射スペクトル）から ISCO（内縁半径 r_in）を制約するため、まず **一次データ取得→cache→sha256 manifest** の I/F を閉じる。
- 併せて、ISCO制約の出力名（CSV/metrics/systematics）を先に固定し、反射fit（XSPEC/SAS 等が絡む部分）は次段で差し替え可能にする。

変更：
- 追加：`scripts/xrism/fetch_xmm_nustar_heasarc.py`
  - HEASARC FTP over HTTPS から XMM（rev0/1; PPS/ODF）と NuSTAR（event_cl/auxil 等）を取得し、`data/xrism/sources/xmm_nustar_manifest.json` に sha256 を固定。
  - 既定 include regex の誤り（raw 文字列で `\\.` を使って一致しない）を修正し、PPS/FTZ 等が抽出されるようにした。
- 追加：`data/xrism/sources/xmm_nustar_targets.json`
  - GX 339-4 の seed（XMM: 0204730201/0204730301；NuSTAR: 80001013001/80001015001）を台帳化。
- 追加：`scripts/xrism/fek_relativistic_broadening_isco_constraints.py`
  - ISCO台帳の固定出力（stub）：`output/xrism/fek_relativistic_broadening_isco_constraints.csv` と metrics/systematics JSON を生成。
- 更新：`doc/PRIMARY_SOURCES.md` / `doc/ROADMAP.md`
  - Step 4.8.7 の一次ソース（HEASARC FTP, XMMMASTER, NuSTAR AFT）と I/F を追記。

結果（固定）：
- manifest：`data/xrism/sources/xmm_nustar_manifest.json`（history 付き）
- cache（例；初回検証）：`data/xrism/xmm_nustar/xmm/rev0/0204730201/PPS/*` / `data/xrism/xmm_nustar/nustar/80001013001/event_cl/*`
- ISCO台帳（stub）：`output/xrism/fek_relativistic_broadening_isco_constraints.csv`（現段階は status=not_computed）

再現：
- 取得（seed）：`python -B scripts/xrism/fetch_xmm_nustar_heasarc.py --xmm-obsid 0204730201 --xmm-obsid 0204730301 --nustar-obsid 80001013001 --nustar-obsid 80001015001 --download-missing`
- 台帳生成（stub）：`python -B scripts/xrism/fek_relativistic_broadening_isco_constraints.py`

---

## 2026-01-29（UTC） Phase 6（拡張・高精度検証）/ Step 6.5 追加：SPARC（銀河回転曲線 RAR/BTFR）

目的：
- 検証スケールを BH（強場）から銀河（弱場・広域）へ拡張し、回転曲線の平坦化と RAR/BTFR を一次データで再構築して、P-model の銀河スケール予測を反証可能な形で定義する。

変更：
- 更新：`doc/ROADMAP.md`
  - Step 6.5（SPARC：RAR/BTFR）を Phase 6 に追加（6.5.1〜6.5.5：理論準備→取得→RAR再構築→BTFR→反証条件）。
- 更新：`doc/PRIMARY_SOURCES.md`
  - SPARC の一次ソース（配布元URL）を追加（Section 8）。

結果（固定）：
- Roadmap：`doc/ROADMAP.md` に Step 6.5 を追記。
- Primary sources：`doc/PRIMARY_SOURCES.md` に SPARC を追記。

---

## 2026-01-29（UTC） Phase 4（宇宙論）/ Step 4.8.7（Fe-Kα relativistic broad line / ISCO）補修：GX 339-4 seed を拡張し、cache coverage を 1.0 に更新（XMM/NuSTAR）

目的：
- Step 4.8.7 の「取得→cache→sha256 manifest」I/F を実運用に耐える形にし、NuSTAR event_cl の巨大ファイルで再現が止まらないようにする。
- GX 339-4 の seed を 2×XMM + 3×NuSTAR へ拡張し、ISCO台帳（stub）の cache coverage を 1.0 に更新する。

変更：
- 更新：`scripts/xrism/fetch_xmm_nustar_heasarc.py`
  - `--max-file-mib`（単一ファイルサイズ上限）と `--xmm-exclude-regex` / `--nustar-exclude-regex` を追加。
  - download を `.part` へ書き込み→完了後に rename（原子的）することで、途中失敗時の不完全ファイル混入を抑制。
- 更新：`data/xrism/sources/xmm_nustar_targets.json`
  - GX 339-4 の NuSTAR seed に `80001013002` を追加。
- 更新：`output/xrism/fek_relativistic_broadening_isco_constraints.csv`
  - XMM 0204730201/0204730301 と NuSTAR 80001013001/80001013002/80001015001 の cache 検出を更新し、`cache_coverage=1.0` を固定。

結果（固定）：
- ISCO台帳（stub）：`output/xrism/fek_relativistic_broadening_isco_constraints.csv`（n_rows=5；data_cached=1）
- metrics：`output/xrism/fek_relativistic_broadening_isco_constraints_metrics.json`（cache_coverage=1.0）

再現：
- seed（NuSTAR追加；必要なら巨大ファイル抑制）：`python -B scripts/xrism/fetch_xmm_nustar_heasarc.py --xmm-obsid 0204730201 --xmm-obsid 0204730301 --nustar-obsid 80001013001 --nustar-obsid 80001013002 --nustar-obsid 80001015001 --download-missing --max-file-mib 300`
- 台帳（stub）：`python -B scripts/xrism/fek_relativistic_broadening_isco_constraints.py`

---

## 2026-01-29（UTC） Phase 4（宇宙論）/ Step 4.8.7（Fe-Kα relativistic broad line / ISCO）進捗：XMM（MOS1+MOS2）で broad line→r_in の proxy fit（diskline）を固定出力化

目的：
- XSPEC/HEASoft が無い環境でも Step 4.8.7 の「ISCO制約」の入口が前進するよう、XMM PPS（MOS1+MOS2）の公開スペクトルから broad Fe-K 線形状を proxy で fit し、`r_in`（内縁半径）推定と系統 sweep を固定出力化する。
- NuSTAR 側は event_cl まで cache 済みだが、`nuproducts`（HEASoft/XSPEC）依存のため、この環境では **blocked_missing_dependency** として明示する。

変更：
- 更新：`scripts/xrism/fetch_xmm_nustar_heasarc.py`
  - XMM PPS の background spectrum（`BGSPEC`）を既定 include に追加（SRSPEC/SRCARF とセットで取得可能に）。
- 更新：`scripts/xrism/fek_relativistic_broadening_isco_constraints.py`
  - XMM PPS（MOS1+MOS2）の SRSPEC を候補走査し、band（3–10 keV）で最も明るい source を自動選択。
  - powerlaw + diskline_proxy（RMF無し；PI→E は 5 eV/bin 仮定）の最小 fit を実装し、band/gain/rebin の系統 sweep を実行して `r_in_sys` を算出。
  - NuSTAR は `HEASoft/XSPEC` 欠如のため `blocked_missing_dependency` として台帳に明示。

結果（固定）：
- ISCO台帳（CSV）：`output/xrism/fek_relativistic_broadening_isco_constraints.csv`
  - XMM 2 obsid は `status=proxy_diskline_v1` で `r_in_rg`, `r_in_rg_stat`, `r_in_rg_sys` を出力。
  - NuSTAR 3 obsid は `status=blocked_missing_dependency`（この環境での再解析不可）を明示。
- 詳細（per-obsid）：
  - `output/xrism/xmm_0204730201__fek_broad_line_proxy_diskline.json`
  - `output/xrism/xmm_0204730301__fek_broad_line_proxy_diskline.json`
- まとめ：`output/xrism/fek_relativistic_broadening_isco_constraints_detail.json`
- 注意：proxy model のため redchi2 が大きく、`r_in` が境界に張り付く場合がある。次段で **RMF折り込み＋reflection model**（XSPEC）へ置換する前提。

再現：
- XMM（不足分取得）：`python -B scripts/xrism/fetch_xmm_nustar_heasarc.py --xmm-obsid 0204730201 --xmm-obsid 0204730301 --download-missing --max-files 500`
- 台帳（proxy）：`python -B scripts/xrism/fek_relativistic_broadening_isco_constraints.py`

---

## 2026-01-29（UTC） Phase 3（重力波）/ Step 3.5.1（GW250114：ringdown/QNM・Area theorem・IMR consistency）完了：公開 data release（GWOSC→Zenodo）を用いた固定出力化

目的：
- Part II §4.11（重力波）を拡張し、GW250114 について ringdown（QNM）、Area theorem、IMR consistency を **公開一次データ**で再現可能な形に固定する（強場側の差分予測/反証条件へ接続する入口）。

変更：
- 追加：`scripts/gw/gw_ringdown_qnm.py` / `scripts/gw/gw_area_theorem.py` / `scripts/gw/gw_imr_consistency.py`
  - GW250114 は GWOSC の strain が `hdf5/gwf`（4096s）で提供されるため、GWOSC が参照する Zenodo の `GW250114_data_release.tar.gz` を取得・展開し、公開リングダウン解析（start time scan / inspiral truncation scan / pyRing）を出力として固定。
- 更新：`doc/ROADMAP.md`（Step 3.5.1 を【完了】へ更新、再現コマンドを明記）
- 更新：`doc/paper/11_part2_astrophysics.md`（§4.11 に GW250114 の数値と図を追記）
- 更新：`doc/PRIMARY_SOURCES.md`（GWOSC→Zenodo data release の入口を追記）

結果（固定）：
- ringdown QNM（data release；t_ref=10.5M）：`output/gw/gw250114_ringdown_qnm_fit.json` / `output/gw/gw250114_ringdown_qnm_fit.png`
  - 例：`f_220≈247 Hz`, `τ_220≈4.52 ms`（start time を系統として保存）
- Area theorem（参照 -40M）：`output/gw/gw250114_area_theorem_test.json` / `output/gw/gw250114_area_theorem_test.png`
  - Gaussian significance：combined=4.45σ（ringdown+pyRing）、pyRingのみ=4.70σ、first σ≥5 は -10M
- IMR consistency（proxy）：`output/gw/gw250114_imr_consistency.json` / `output/gw/gw250114_imr_consistency.png`
  - 例：GR 予測との整合（mode 220）：`z_f≈−0.14`, `z_τ≈+0.54`
  - (M_f,a_f) は不確かさ伝播込みで `p≈0.74`（矛盾なし）
- raw cache（入口）：`data/gw/gw250114/GW250114_data_release.tar.gz` / `data/gw/gw250114/GW250114_082203_event.json` / `data/gw/gw250114/*hdf5`

再現：
- ringdown QNM：`python -B scripts/gw/gw_ringdown_qnm.py --event GW250114 --catalog O4_Discovery_Papers --slug gw250114 --method data_release`
- Area theorem：`python -B scripts/gw/gw_area_theorem.py --event GW250114 --catalog O4_Discovery_Papers --slug gw250114`
- IMR consistency（proxy）：`python -B scripts/gw/gw_imr_consistency.py --event GW250114 --catalog O4_Discovery_Papers --slug gw250114`

---

## 2026-01-29（UTC） Phase 4（宇宙論）/ Step 4.8.7（Fe-Kα relativistic broad line / ISCO）補修：NuSTAR event_cl の proxy diskline fit を追加し、stub を proxy_v2 へ更新

目的：
- Step 4.8.7 の「ISCO台帳（stub）」を、XMM（PPS）だけでなく NuSTAR（event_cl）でも **offlineで再解析可能**にし、クロスミッション整合の入口を前進させる。
- full reflection fit（RMF/ARF 折り込み；XSPEC/HEASoft/SAS 等）へ移行する前に、proxy 手続きのノブ（band/gain/rebin）感度を台帳として固定する。

変更：
- 更新：`scripts/xrism/fek_relativistic_broadening_isco_constraints.py`
  - NuSTAR event_cl（FPMA/FPMB）の PI histogram を構築し、PI→E を 0.04 keV/bin とみなす proxy で powerlaw+diskline fit を追加。
  - NuSTAR でも band/gain/rebin の sweep を行い、`r_in_rg_sys` を固定出力（proxy）。
  - metrics を `proxy_v2` に更新し、`n_proxy_computed=5`（XMM 2 + NuSTAR 3）、`n_blocked_missing_dependency=0` を固定。
- 更新：`doc/STATUS.md` / `doc/ROADMAP.md` / `doc/AI_CONTEXT_MIN.json`（Step 4.8.7 の現状記述を NuSTAR proxy 対応へ更新）

結果（固定）：
- ISCO台帳（CSV）：`output/xrism/fek_relativistic_broadening_isco_constraints.csv`
  - XMM 2 obsid + NuSTAR 3 obsid が `status=proxy_diskline_v1` で `r_in_rg`, `r_in_rg_stat`, `r_in_rg_sys` を出力。
- metrics：`output/xrism/fek_relativistic_broadening_isco_constraints_metrics.json`（`status=proxy_v2`）
- 詳細（per-obsid；NuSTAR）：
  - `output/xrism/nustar_80001013001__fek_broad_line_proxy_diskline.json`
  - `output/xrism/nustar_80001013002__fek_broad_line_proxy_diskline.json`
  - `output/xrism/nustar_80001015001__fek_broad_line_proxy_diskline.json`
- 注意：proxy（応答折り込み無し）のため、ISCO制約の定量は次段で **RMF/ARF 折り込み＋reflection model** に置換して再評価する。

再現：
- 台帳（proxy）：`python -B scripts/xrism/fek_relativistic_broadening_isco_constraints.py`

---

## 2026-01-29（UTC） Phase 4（宇宙論）/ Step 4.8.7（Fe-Kα relativistic broad line / ISCO）補修：proxy_v3（XMM ARF×exposure 重み＋r_in_bound）でI/Fを強化

目的：
- proxy 解析（応答折り込み無し）でも、**手続きの限界**（境界貼り付き）を出力として固定し、次段（XSPEC/HEASoft/SAS）の reflection fit へ安全に差し替え可能な I/F を強化する。

変更：
- 更新：`scripts/xrism/fek_relativistic_broadening_isco_constraints.py`
  - XMM proxy に ARF×exposure の throughput 重みを導入（なお RMF folding は未実装のまま）。
  - `r_in_bound`（lower/upper/""）を追加し、`r_in` が境界に張り付く＝proxyで拘束不能を明示。
  - `proxy_v3` として metrics/ノブ台帳を更新（`output/xrism/fek_relativistic_broadening_model_systematics.json`）。

結果（固定）：
- ISCO台帳（CSV）：`output/xrism/fek_relativistic_broadening_isco_constraints.csv`（note に `r_in_bound=` を付与）
- metrics：`output/xrism/fek_relativistic_broadening_isco_constraints_metrics.json`（`status=proxy_v3`）

再現：
- 台帳（proxy_v3）：`python -B scripts/xrism/fek_relativistic_broadening_isco_constraints.py`

---

## 2026-01-29（UTC） Phase 6（銀河回転曲線）/ Step 6.5（SPARC：RAR/BTFR）進捗：SPARC raw取得（sha256 manifest固定）＋ Rotmod_LTG からの RAR再構築（g_obs/g_bar）を固定出力化

目的：
- Phase 6 / Step 6.5 の入口として、SPARC一次データを offline 再現できる形で固定し、RAR/BTFR 検証の共通I/F（入力→出力）を確立する。
- P-model の銀河スケール予測（6.5.1 の A/B 選択）を導入する前に、まず観測側（g_obs/g_bar）の再現を固定して、単位・定義ミスを排除する。

変更：
- 追加：`scripts/cosmology/fetch_sparc.py`
  - SPARC配布物（`*.mrt`, `Rotmod_LTG.zip`）を取得し、raw cache と sha256 manifest（URL/bytes/sha256/取得条件）を固定。
  - http は環境によって接続拒否になるため、既定を https に統一。
- 更新：`scripts/cosmology/sparc_rar_from_rotmod.py`
  - 出力名をロードマップ準拠に統一：`sparc_rar_reconstruction.csv` / `sparc_rar_metrics.json` / `sparc_rar_scatter.png`
  - rotmod header（`# Distance = ... Mpc`）の distance 抽出を修正し、`distance_mpc` を CSV に反映。
  - log-log の最小fit（slope/intercept/residual dex）を `sparc_rar_metrics.json` に固定。
- 更新：`doc/ROADMAP.md` / `doc/PRIMARY_SOURCES.md`
  - SPARC を https を正として明記し、Step 6.5.2/6.5.3.1 の進捗（完了（初版））と再現コマンドを追記。

結果（固定）：
- raw cache + manifest：`data/cosmology/sparc/raw/*` / `data/cosmology/sparc/manifest.json`
- RAR再構築（観測側I/F）：`output/cosmology/sparc_rar_reconstruction.csv` / `output/cosmology/sparc_rar_metrics.json` / `output/cosmology/sparc_rar_scatter.png`
  - counts：n_galaxies=175, n_points=3391（`sparc_rar_metrics.json`）

再現：
- raw取得：`python -B scripts/cosmology/fetch_sparc.py --download-missing`
- RAR再構築：`python -B scripts/cosmology/sparc_rar_from_rotmod.py`

---

## 2026-01-29（UTC） Phase 6（銀河回転曲線）/ Step 6.5（SPARC：RAR/BTFR）進捗：6.5.1 方針固定（A既定）＋ BTFR cross-check ＋ falsification pack（baryons-onlyヌル）を固定出力化

目的：
- Step 6.5 を「観測側I/F固定→予測→反証条件」へ接続するため、6.5.1（銀河スケール予測の方針）を明文化し、BTFR と falsification pack を固定出力として追加する。

変更：
- 追加：`doc/cosmology/SPARC_RAR_BTFR.md`
  - 6.5.1 の結論として、現時点のコア P-model（φ≡-c^2 ln(P/P0)）は弱場で a0 型修正を自動生成しないため **(A)（P-model=GR弱場）を既定**として進める方針を固定。
  - (B)（弱場修正）を主張する場合は、`g_obs=f(g_bar,P)` の具体式＋自由度＋凍結＋反証条件を別途固定する、という条件を明文化。
- 追加：`scripts/cosmology/sparc_btfr_metrics.py`
  - BTFR_Lelli2019.mrt（一次）から `log(M_b)` vs `log(V)` の最小回帰と散布を固定出力化（primary: Vf）。
  - 出力：`output/cosmology/sparc_btfr_metrics.json` / `output/cosmology/sparc_btfr_scatter.png`
- 追加：`scripts/cosmology/sparc_falsification_pack.py`
  - RAR再構築（`sparc_rar_reconstruction.csv`）を入力に、baryons-only（g_P=g_bar）を参照ヌルとして residual をbin集計し、3σ形式の最小 pack を固定。
  - 出力：`output/cosmology/sparc_falsification_pack.json`
  - 注意：V_obs の統計誤差のみを使用し、g_bar 側（M/L等）の系統は含まないことを pack に明記。
- 更新：`doc/ROADMAP.md` / `doc/PRIMARY_SOURCES.md`
  - Step 6.5.1/6.5.4/6.5.5.1 の進捗（完了（初版））と再現コマンド、SPARC https を正とする旨を追記。

結果（固定）：
- BTFR：`output/cosmology/sparc_btfr_metrics.json` / `output/cosmology/sparc_btfr_scatter.png`
- falsification pack（baryons-onlyヌル）：`output/cosmology/sparc_falsification_pack.json`

再現：
- BTFR：`python -B scripts/cosmology/sparc_btfr_metrics.py`
- falsification pack：`python -B scripts/cosmology/sparc_falsification_pack.py`

---

## 2026-01-29（UTC） Phase 6（銀河回転曲線）/ Step 6.5（SPARC：RAR/BTFR）補修：falsification pack に RAR経験式（a0）の baseline fit を追加（比較用）

目的：
- baryons-only ヌル（g_P=g_bar）の棄却と、既知の RAR 経験式の「到達可能な散布」を同一I/Fで比較できるようにし、6.5.3.2（P-model予測の具体化）へ進むための基準（bench）を固定する。

変更：
- 更新：`scripts/cosmology/sparc_falsification_pack.py`
  - McGaugh+2016 の経験式 `g_obs = g_bar / (1 - exp(-sqrt(g_bar/a0)))` を 1パラメータ（a0）で fit し、結果を `output/cosmology/sparc_falsification_pack.json` の `baselines` として保存（P-model予測ではない）。
  - best-fit：`a0≈1.24×10^-10 m/s^2`（log10(a0)≈-9.905）
- 更新：`doc/cosmology/SPARC_RAR_BTFR.md`（baseline fit の位置づけと注意点を追記）
- 更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`（Step 6.5 の状態辞書を反映）

結果（固定）：
- pack：`output/cosmology/sparc_falsification_pack.json`（`baselines.rar_mcgaugh2016_fit_a0`）

再現：
- `python -B scripts/cosmology/sparc_falsification_pack.py`

---

## 2026-01-29（UTC） Phase 6（銀河回転曲線）/ Step 6.5（SPARC：RAR/BTFR）補修：M/L（Υ）sweep により g_bar 系統感度を固定（baryons-only の頑健性確認）

目的：
- `sparc_falsification_pack.json` が明記する通り、現段階の有意度は V_obs の統計誤差のみで g_bar 側（M/L等）の系統を含まない。
- そこで最小の系統 sweep として、Υ_disk/Υ_bulge を動かし、baryons-only ヌル（g_P=g_bar）の残差・z がどれだけ変動するかを固定する。

変更：
- 追加：`scripts/cosmology/sparc_rar_mlr_sweep.py`
  - Rotmod_LTG.zip を用い、Υ_disk/Υ_bulge を格子 sweep（既定：disk=[0.4,0.5,0.6], bulge=[0.5,0.7,0.9]）し、baryons-only 統計と baseline a0 fit の envelope を JSON として固定。
  - 出力：`output/cosmology/sparc_rar_mlr_sweep_metrics.json`
- 更新：`doc/ROADMAP.md`（6.5.5.3 を追記）、`doc/STATUS.md`、`doc/AI_CONTEXT_MIN.json`、`doc/cosmology/SPARC_RAR_BTFR.md`

結果（固定；sweep範囲内）：
- low-accel weighted mean residual：0.57〜0.67 dex
- low-accel z：1.06e3〜1.34e3（依然として非常に大）
- baseline a0 fit：`a0≈(0.94〜1.72)×10^-10 m/s^2`

再現：
- `python -B scripts/cosmology/sparc_rar_mlr_sweep.py`

---

## 2026-01-29（UTC） Phase 6（銀河回転曲線）/ Step 6.5（SPARC：RAR/BTFR）進捗：fit→freeze→holdout（galaxy split）枠組みを固定（弱場修正(B)の凍結手順の土台）

目的：
- シナリオ(B)（弱場修正：g_obs=f(g_bar,P)）を主張するには、自由度（パラメータ）を凍結し、別データで再現性を確認する必要がある。
- そのために、RAR を galaxy 単位で split し、fit→freeze→holdout を機械的に回せる I/F を固定する（将来の f を差し替え可能にする）。

変更：
- 追加：`scripts/cosmology/sparc_rar_freeze_test.py`
  - galaxy split（既定 train_frac=0.7, seed固定）で、train で a0 fit（baseline）→凍結→test で評価する枠組みを追加。
  - 併せて、モデルごとに「intrinsic scatter σ_int（dex）」を train の χ²/dof≈1 から推定し、holdout へ持ち越す評価も保存。
  - 出力：`output/cosmology/sparc_rar_freeze_test_metrics.json`

結果（固定；例）：
- baryons-only：σ_int≈0.55 dex を入れても low-accel の z は O(10^1) を維持（強く棄却）
- baseline RAR（McGaugh+2016; a0 fit）：σ_int≈0.15 dex、holdout で |z| は数程度まで縮む（split依存）

再現：
- `python -B scripts/cosmology/sparc_rar_freeze_test.py`

---

## 2026-01-29（UTC） Phase 6（銀河回転曲線）/ Step 6.5（SPARC：RAR/BTFR）進捗：a0 = κ c H0^(P)（κ=1/(2π)）候補を freeze-test に追加し、外部固定 a0 の holdout 指標を固定

目的：
- シナリオ(B)の候補として「a0 を SPARC で fit せず、cosmology（H0^(P)）から外部固定」する接続案を追加し、fit→freeze→holdout の同一指標で評価する。

変更：
- 更新：`scripts/cosmology/sparc_rar_freeze_test.py`
  - `--h0p-metrics` / `--h0p-km-s-mpc` / `--pbg-kappa` を追加し、`a0=κ c H0^(P)` の候補モデル（`candidate_rar_pbg_a0_fixed_kappa`）を実装。
- 更新：`output/cosmology/sparc_rar_freeze_test_metrics.json`

主要結果（例；seed=20260129, train_frac=0.7, κ=1/(2π)）：
- H0^(P)=70 km/s/Mpc（`output/cosmology/cosmology_redshift_pbg_metrics.json`）から `a0≈1.08×10^-10 m/s^2`。
- holdout（with σ_int）低加速度：`z≈-0.94`（residual≈-0.006 dex）。
- baseline a0 fit の holdout（with σ_int）：`z≈-3.48`。

注意：
- これはコア P-model からの導出ではなく、P_bg（H0^(P)）との接続案（候補）として扱う。

再現：
- `python -B scripts/cosmology/sparc_rar_freeze_test.py`

---

## 2026-01-29（UTC） Phase 6（銀河回転曲線）/ Step 6.5（SPARC：RAR/BTFR）進捗：a0 = κ c H0^(P) 候補を falsification pack / M/L sweep に展開（σ_intなしの統計も固定）

目的：
- freeze-test（holdout）の候補 `a0=κ c H0^(P)` を、pack（単一指標）と M/L sweep（g_bar 系統）にも展開し、同一I/Fで比較できる形へ進める。

変更：
- 更新：`scripts/cosmology/sparc_falsification_pack.py`
  - `--h0p-metrics` / `--h0p-km-s-mpc` / `--pbg-kappa` を追加し、`baselines.rar_mcgaugh2016_a0_pbg_fixed_kappa` を保存。
- 更新：`scripts/cosmology/sparc_rar_mlr_sweep.py`
  - 同じ `H0^(P)` 入力で `candidate_rar_pbg_fixed_kappa` を追加し、envelope を固定。
- 更新（固定出力）：
  - `output/cosmology/sparc_falsification_pack.json`
  - `output/cosmology/sparc_rar_mlr_sweep_metrics.json`

主要結果（σ_intなし；V_obs の統計誤差のみ）：
- pack：候補の低加速度 z≈32.7（weighted mean residual≈0.017 dex）。
- M/L sweep：候補の低加速度 z は約 -33〜121、weighted mean residual は約 -0.018〜0.060 dex（sweep範囲内）。

注意：
- 上記の z は σ_int を含まないため大きくなりやすい。棄却条件は freeze-test の σ_int 推定と整合する形で固定する。

再現：
- `python -B scripts/cosmology/sparc_falsification_pack.py`

---

## 2026-01-29（UTC） Phase 6（銀河回転曲線）/ Step 6.5（SPARC：RAR/BTFR）進捗：scenario(B) の σ_int ルールと棄却条件を falsification pack に明文化（freeze-test holdout 指標を統合）

目的：
- シナリオ(B)候補（`g_obs=f(g_bar,P)`）の検証を「fit→freeze→holdout（galaxy split）」と整合する形で固定する。
- σ_int（intrinsic scatter）の扱いと 3σ 判定（|z|<3）を、pack（単一ファイル）へ明文化して攻撃点（恣意性）を減らす。

変更：
- 更新：`scripts/cosmology/sparc_falsification_pack.py`
  - `--freeze-test-metrics` を追加し、`output/cosmology/sparc_rar_freeze_test_metrics.json` から holdout（with σ_int）の低加速度 z を抽出して `scenario_b.freeze_test_summary` として pack に統合。
  - `scenario_b.sigma_int_rule` と `scenario_b.reject`（|z_low_accel|<3）を明文化。
- 更新（固定出力）：`output/cosmology/sparc_falsification_pack.json`

主要結果（freeze-test の holdout；seed=20260129, train_frac=0.7）：
- baryons-only：z≈24.5（強く棄却）
- baseline a0 fit：z≈-3.48（境界付近；split依存）
- 候補 a0=κ c H0^(P)（κ=1/(2π)）：z≈-0.94（pass）

注意：
- これは「候補が確立した」ではなく、**棄却条件の固定**（どう観測されたら棄却されるか）を先に行った段階。
- 次段で seed/train_frac を走査し、split 依存（holdout |z| の分布）を envelope として固定する。

再現：
- `python -B scripts/cosmology/sparc_falsification_pack.py`

---

## 2026-01-29（UTC） Phase 6（銀河回転曲線）/ Step 6.5（SPARC：RAR/BTFR）進捗：seed/train_frac sweep を freeze-test に実装し、split 依存（holdout |z|）を sweep_summary として固定

目的：
- シナリオ(B)候補の評価が「単一 split の偶然」に依存しないよう、seed/train_frac を走査して holdout 指標（低加速度 |z|）の分布を固定する。

変更：
- 更新：`scripts/cosmology/sparc_rar_freeze_test.py`
  - `--seeds` / `--train-fracs` により複数 split を実行し、`sweep_summary`（モデル別の holdout z の min/max/median と pass_rate）を出力。
- 更新：`scripts/cosmology/sparc_falsification_pack.py`
  - `scenario_b.freeze_test_summary.sweep_summary` を pack に取り込み、候補の split 依存を同一ファイルで参照できる形に更新。
- 更新（固定出力）：
  - `output/cosmology/sparc_rar_freeze_test_metrics.json`
  - `output/cosmology/sparc_falsification_pack.json`

結果（例；seeds=20260129..20260133, train_fracs=[0.6,0.7,0.8] の計15run）：
- baryons-only：pass_rate(|z|<3)=0
- baseline a0 fit：pass_rate(|z|<3)≈0.27
- 候補 a0=κ c H0^(P)（κ=1/(2π)）：pass_rate(|z|<3)≈0.80（ただし min z≈-5.77）

再現：
- `python -B scripts/cosmology/sparc_rar_freeze_test.py --train-fracs 0.6 --train-fracs 0.7 --train-fracs 0.8 --seeds 20260129 --seeds 20260130 --seeds 20260131 --seeds 20260132 --seeds 20260133`
- `python -B scripts/cosmology/sparc_falsification_pack.py`
- `python -B scripts/cosmology/sparc_rar_mlr_sweep.py`

---

## 2026-01-29（UTC） Phase 6（銀河回転曲線）/ Step 6.5（SPARC：RAR/BTFR）進捗：split sweep を拡張（250run）し、候補の安定性（pass_rate）を再固定

目的：
- seed/train_frac の走査範囲を拡張し、候補（a0=κ c H0^(P)）の holdout |z| がどれだけ安定か（pass_rate）を、より大きいサンプルで固定する。

変更：
- 更新（固定出力）：
  - `output/cosmology/sparc_rar_freeze_test_metrics.json`
  - `output/cosmology/sparc_falsification_pack.json`（`scenario_b.freeze_test_summary.sweep_summary`）

結果（seeds=50, train_fracs=5 の計250run；|z|<3）：
- baryons-only：pass_rate=0
- baseline a0 fit：pass_rate≈0.268
- 候補 a0=κ c H0^(P)（κ=1/(2π)）：pass_rate≈0.648

再現：
- `python -B scripts/cosmology/sparc_rar_freeze_test.py --train-frac-start 0.5 --train-frac-stop 0.9 --train-frac-step 0.1 --seed-start 20260129 --seed-count 50`
- `python -B scripts/cosmology/sparc_falsification_pack.py`

---

## 2026-01-29（UTC） Phase 6（銀河回転曲線）/ Step 6.5（SPARC：RAR/BTFR）進捗：採用判定ルール（pass_rate閾値）を pack に固定し、候補を not_adopted_yet として確定

目的：
- 「候補が split に依存しないか」を定量化し、採用/非採用を機械的に判定できる形（閾値）で固定する。

変更：
- 更新：`scripts/cosmology/sparc_falsification_pack.py`
  - `scenario_b.adoption.evaluation` を追加し、`sweep_summary` から pass_rate を評価して採用判定（初版：pass_rate(|z|<3)≥0.95, n_runs≥100）を保存。
- 更新（固定出力）：`output/cosmology/sparc_falsification_pack.json`

結果（今回の sweep_summary；n_runs=250）：
- 候補 a0=κ c H0^(P)（κ=1/(2π)）：pass_rate≈0.648 < 0.95 → adopted=false（not_adopted_yet）

再現：
- `python -B scripts/cosmology/sparc_falsification_pack.py`

---

## 2026-01-29（UTC） Phase 4（宇宙論）/ Step 4.13（XRISM）補修：ロードマップ番号を paper §4.13 に揃え、Step 4.8 を番号互換として残置

目的：
- XRISM の解析を「paper §4.13」と同じ番号でロードマップ上も独立セクションとして管理し、将来の公開データ追加や精密化（系統分解・cross-cal強化）を Step 4.13.* に集約できる形にする。

変更：
- 更新：`doc/ROADMAP.md`
  - Step 4.8 を「番号互換（保留）」として残置し、XRISM 本体を Step 4.13.*（4.13.1–4.13.7）へ再番号化。
- 更新：`doc/PRIMARY_SOURCES.md` / `doc/paper/11_part2_astrophysics.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`
  - Step 4.8.* の参照を Step 4.13.* に更新（今後の新規追加は Step 4.13 を正）。

再現：
- n/a（ドキュメント更新）

---

## 2026-01-29（UTC） Phase 6（銀河回転曲線）/ Step 6.5（SPARC：RAR/BTFR）補修：κ-fit候補は baseline の再パラメータ化であることを固定

目的：
- 「a0=κ c H0^(P)」候補に対して κ を自由に fit しても、McGaugh+2016 RAR 経験式の a0 fit と同一（再パラメータ化）であり、P-model側の新規予測にはならない点を明文化する。

変更：
- 更新：`doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`
  - `candidate_rar_pbg_fit_kappa` は baseline と等価で、freeze-test の sweep_summary（pass_rate など）も一致する点を追記。
  - 次の作業を「κ の外部固定（prior）または自由度が増えない別形の予測設計」へ更新。

参照（固定出力）：
- `output/cosmology/sparc_rar_freeze_test_metrics.json`（sweep_summary）
- `output/cosmology/sparc_falsification_pack.json`

---

## 2026-01-29（UTC） Phase 6（銀河回転曲線）/ Step 6.5（SPARC：RAR/BTFR）進捗：κ sweep（外部固定 prior の感度）を固定し、この型の改善上限を確認

目的：
- 候補 `a0 = κ c H0^(P)`（外部固定）について、κ の取り方（prior）にどれだけ結果が敏感かを定量化し、「この型だけで採用閾値（pass_rate≥0.95）へ到達し得るか」を固定出力として残す。

変更：
- 追加：`scripts/cosmology/sparc_rar_pbg_kappa_sweep.py`
  - κ を走査し、freeze-test と同じ split 群（seed/train_frac sweep）で holdout 指標（low-accel z）の pass_rate を出力。
- 追加（固定出力）：
  - `output/cosmology/sparc_rar_pbg_kappa_sweep_metrics.json`
  - `output/cosmology/sparc_rar_pbg_kappa_sweep.png`
- 更新：`doc/ROADMAP.md` / `doc/cosmology/SPARC_RAR_BTFR.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`
  - κ sweep の位置づけ（6.5.5.2.5）と結論（この型では採用閾値に届かない）を反映。

結果（seeds=50, train_fracs=5 の計250split；|z|<3）：
- best κ≈0.15：pass_rate≈0.728（still < 0.95）

再現：
- `python -B scripts/cosmology/sparc_rar_pbg_kappa_sweep.py`

---

## 2026-01-29（UTC） Phase 6（銀河回転曲線）/ Step 6.5（SPARC：RAR/BTFR）補修：holdout 指標を galaxy-level へ拡張し、採用判定を更新（κ sweep も再生成）

目的：
- point-level z は同一銀河内の多数点を独立扱いして独立度（SEM）を過大評価し得るため、銀河内平均を1サンプルとする galaxy-level 指標（`low_accel_galaxy`）を採用判定の正として固定する。
- κ sweep 出力を point/galaxy の両系列へ更新し、κ prior の許容域を固定する。

変更：
- 再生成（固定出力）：
  - `output/cosmology/sparc_rar_pbg_kappa_sweep_metrics.json`
  - `output/cosmology/sparc_rar_pbg_kappa_sweep.png`
- 更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json` / `doc/cosmology/SPARC_RAR_BTFR.md`
  - Step 6.5.5.2.* の結論を galaxy-level 採用に合わせて改訂。

結果（seeds=50, train_fracs=5 の計250split；|z|<3）：
- freeze-test（galaxy-level）：候補 κ=1/(2π) の pass_rate≈0.976（adopted=true）、baseline≈0.752、baryons-only=0（`output/cosmology/sparc_rar_freeze_test_metrics.json` / `output/cosmology/sparc_falsification_pack.json`）。
- κ sweep（galaxy-level）：κ≈0.11–0.16 で pass_rate≥0.95、ref κ=1/(2π) は≈0.976（best κ≈0.12 で 1.0）。point-level best は κ≈0.15 で≈0.728（`output/cosmology/sparc_rar_pbg_kappa_sweep_metrics.json`）。

再現：
- `python -B scripts/cosmology/sparc_rar_pbg_kappa_sweep.py`
- `python -B scripts/cosmology/sparc_rar_freeze_test.py --train-frac-start 0.5 --train-frac-stop 0.9 --train-frac-step 0.1 --seed-start 20260129 --seed-count 50`

---

## 2026-01-29（UTC） Phase 6（銀河回転曲線）/ Step 6.5（SPARC：RAR/BTFR）補修：M/L（Υ）系統を freeze-test に統合し、adopted_final を固定（robust 不成立）

目的：
- g_bar 系統（Υ_disk/Υ_bulge）は入力そのものを動かすため、split 安定性（adopted_fixed_ml）だけでは不十分。M/L sweep を freeze-test と同じ split 群で評価し、robust_adopted_mlr と adopted_final を固定する。

変更：
- 追加：`scripts/cosmology/sparc_rar_freeze_test_mlr_sweep.py`
  - g_bar を vgas/vdisk/vbul から再計算（vdisk→vdisk*sqrt(Υ_disk), vbul→vbul*sqrt(Υ_bulge)）し、freeze-test（galaxy-level）を M/L グリッドで再評価。
- 再生成（固定出力）：
  - `output/cosmology/sparc_rar_freeze_test_mlr_sweep_metrics.json`
  - `output/cosmology/sparc_rar_freeze_test_mlr_sweep.png`
- 更新：`scripts/cosmology/sparc_falsification_pack.py`
  - `scenario_b.systematics.mlr_sweep` と `adoption.final`（adopted_fixed_ml / robust_adopted_mlr / adopted_final）を pack に統合。
  - 再生成：`output/cosmology/sparc_falsification_pack.json`
- 更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json` / `doc/cosmology/SPARC_RAR_BTFR.md`
  - Step 6.5.5.2.4 の採用判定を adopted_fixed_ml / adopted_final に分離し、M/L 依存の結論を反映。

結果（Υ_disk=[0.4,0.5,0.6], Υ_bulge=[0.5,0.7,0.9]；seeds=50, train_fracs=5；計250split；galaxy-level |z|<3）：
- 候補（κ=1/(2π)）：pass_rate の min≈0.656（worst：0.6/0.9）→ robust_adopted_mlr=False → adopted_final=False。
- baseline（a0 fit）：min≈0.464（候補より不安定）。

再現：
- `python -B scripts/cosmology/sparc_rar_freeze_test_mlr_sweep.py`
- `python -B scripts/cosmology/sparc_falsification_pack.py`

---

## 2026-01-29（UTC） Phase 6（銀河回転曲線）/ Step 6.5（SPARC：RAR/BTFR）補修：Υ nuisance fit（train→holdout）を追加評価し、改善しないことを固定

目的：
- M/L（Υ）系統が adopted_final を支配する状況で、Υ を nuisance（自由度2）として train で推定し holdout へ持ち越す手続きで robustness を回復できるかを確認し、結論を固定する。

変更：
- 更新：`scripts/cosmology/sparc_rar_freeze_test.py`
  - Υ fit objective に `chi2_high_accel`（high-accel でΥを校正）を追加。
- 生成：
  - `output/cosmology/sparc_rar_freeze_test_fit_upsilon_global_chi2_high_accel_metrics.json`
- 更新：`scripts/cosmology/sparc_falsification_pack.py`
  - pack に `scenario_b.systematics.upsilon_fit_on_train` を追加し、Υ nuisance fit の sweep_summary と fit選択頻度を台帳化。
- 再生成：`output/cosmology/sparc_falsification_pack.json`
- 更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json` / `doc/cosmology/SPARC_RAR_BTFR.md`

結果：
- Υ nuisance fit（global; train→holdout）は galaxy-level pass_rate(|z|<3)≈0.888（median z≈-2.06）で adopted_fixed_ml（≈0.976）より悪化し、robustness を改善しなかった。
- fit は (Υ_disk,Υ_bulge)=(0.55,0.75) を高頻度で選択し（約8割）、M/L 系統支配の結論（adopted_final=False）を補強する。

再現：
- `python -B scripts/cosmology/sparc_rar_freeze_test.py --seed-start 20260129 --seed-count 50 --train-frac-start 0.5 --train-frac-stop 0.9 --train-frac-step 0.1 --fit-upsilon-global --upsilon-fit-objective chi2_high_accel --upsilon-disk-start 0.45 --upsilon-disk-stop 0.55 --upsilon-disk-step 0.05 --upsilon-bulge-start 0.65 --upsilon-bulge-stop 0.75 --upsilon-bulge-step 0.05 --out output/cosmology/sparc_rar_freeze_test_fit_upsilon_global_chi2_high_accel_metrics.json`
- `python -B scripts/cosmology/sparc_falsification_pack.py`

---

## 2026-01-29（UTC） Phase 6（銀河回転曲線）/ Step 6.5（SPARC：RAR/BTFR）補修：手続き系統（low-accel cut / sigma-floor / galaxy集約条件）を sweep し、pack に統合

目的：
- adopted_fixed_ml（単一手続きでの split 頑健性）に加えて、手続き（procedure）を変えたときに holdout 統計（galaxy-level |z|）がどれだけ動くかを sys として固定する。

変更：
- 追加：`scripts/cosmology/sparc_rar_freeze_test_procedure_sweep.py`
  - procedure grid（sigma_floor_dex / low_accel_cut_log10_gbar / min_points_per_galaxy）を sweep し、candidate の pass_rate(|z|<3) を固定出力化。
- 更新：`scripts/cosmology/sparc_rar_freeze_test.py`
  - `--min-points-per-galaxy` を追加し、galaxy-level 集約条件（min_points_per_galaxy）を手続きノブとして外部から指定可能にした。
  - `_run_once(models=...)` を追加し、systematics sweep 側は候補モデルのみを高速に評価できるようにした（baseline fit を省略）。
- 更新：`scripts/cosmology/sparc_falsification_pack.py`
  - pack に `scenario_b.systematics.procedure_sweep` を追加し、procedure sweep の envelope/worst/best を台帳化。
- 生成：
  - `output/cosmology/sparc_rar_freeze_test_procedure_sweep_metrics.json`
  - `output/cosmology/sparc_rar_freeze_test_procedure_sweep.png`
- 再生成：`output/cosmology/sparc_falsification_pack.json`

結果（candidate；galaxy-level；seeds=20, train_fracs=3；計60split）：
- pass_rate(|z|<3) は 0.933–0.967（min<0.95）まで動き、procedure 依存が採用判定（gate）に影響し得ることを sys として固定した。

再現：
- `python -B scripts/cosmology/sparc_rar_freeze_test_procedure_sweep.py`
- `python -B scripts/cosmology/sparc_falsification_pack.py`

---

## 2026-01-29（UTC） Phase 6（銀河回転曲線）/ Step 6.5（SPARC：RAR/BTFR）補修：adopted_final の判定ルールに procedure robustness を追加

目的：
- adopted_final を「split 安定性（adopted_fixed_ml）」「M/L robustness（robust_adopted_mlr）」「procedure robustness（robust_adopted_procedure）」の AND として閉じ、自由度/手続き依存で逃げない gate にする。

変更：
- 更新：`scripts/cosmology/sparc_falsification_pack.py`
  - `scenario_b.adoption.final.decision_rule` を `adopted_fixed_ml && robust_adopted_mlr && robust_adopted_procedure` に更新し、pack に `robust_adopted_procedure` を追加。
- 更新：`doc/ROADMAP.md`（6.5.5.2.4 の判定ルールを更新）
- 再生成：`output/cosmology/sparc_falsification_pack.json`

結果：
- adopted_final は引き続き False（robust_adopted_mlr=False かつ robust_adopted_procedure=False）。

---

## 2026-01-29（UTC） Phase 6（銀河回転曲線）/ Step 6.5（SPARC：RAR/BTFR）補修：SPARC/RAR 一次論文（arXiv）を cache し、M/L prior 凍結の一次根拠を repo 内に固定

目的：
- Υ_disk prior（M/L 系統）の凍結根拠となる一次論文（TeX/PDF）を offline 再現できる形でキャッシュし、参照先（URL/sha256/保存先）を `doc/PRIMARY_SOURCES.md` に固定する。

変更：
- 追加：`scripts/cosmology/fetch_sparc_primary_sources.py`
  - arXiv:1606.09251（SPARC I）/ arXiv:1610.08981（RAR）の PDF + source（e-print）を取得し、sha256 manifest を生成。
- 追加（一次キャッシュ）：`data/cosmology/sources/arxiv_1606.09251.pdf` / `data/cosmology/sources/arxiv_1610.08981.pdf`（+ source tarball / extract dir）
- 追加（manifest）：`data/cosmology/sources/sparc_primary_sources_manifest.json`
- 更新：`doc/PRIMARY_SOURCES.md` / `doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`

再現：
- `python -B scripts/cosmology/fetch_sparc_primary_sources.py`

---

## 2026-01-29（UTC） Phase 6（銀河回転曲線）/ Step 6.5（SPARC：RAR/BTFR）補修：Υ★（3.6μm）の一次根拠を SPARC I から要約し、prior 凍結判断へ接続

目的：
- Υ_disk の許容域（prior）を「一次ソースに基づいて」議論できるように、SPARC I（arXiv:1606.09251）の source（`SPARC.tex`）から Υ★（3.6μm）の代表値・レンジに関する主張を台帳化し、候補の robustness 失敗が “prior 凍結で回避できるか” を評価する入口を固定する。

変更：
- 更新：`doc/cosmology/SPARC_RAR_BTFR.md`（M/L sweep 節に一次根拠（Υ★≈0.5/0.2/0.7）を追記）
- 更新：`doc/ROADMAP.md`（6.5.5.2.7：prior 根拠の cache+要約を完了として追記）
- 更新：`doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`

結果：
- SPARC I は [3.6] の恒星 M/L（Υ★）として Υ★≈0.5 を fiducial とし、低値 Υ★≈0.2（DiskMass）や高値 Υ★≈0.7（mean maximum-disk limit）も議論しているため、Υ_disk=0.55 は “fiducial近傍” の範囲に含まれる。
- よって候補が Υ_disk=0.55 で robust を失う事実は、prior を一次ソースへ凍結しても回避できず、adopted_final=False の結論を補強する。

---

## 2026-01-29（UTC） Phase 6（銀河回転曲線）/ Step 6.5（SPARC：RAR/BTFR）補修：M/L sweep を tight prior で再評価し、pack を最新値へ同期

目的：
- adopted_final を左右する M/L（Υ）系統について、文献中心値（Υ=0.5/0.7）近傍の tight grid でも候補の robustness が成立するかを確認し、最新の envelope を固定する。

変更：
- 再生成（固定出力；tight prior grid）：
  - `output/cosmology/sparc_rar_freeze_test_mlr_sweep_metrics.json`
  - `output/cosmology/sparc_rar_freeze_test_mlr_sweep.png`
- 再生成：`output/cosmology/sparc_falsification_pack.json`
- 更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json` / `doc/cosmology/SPARC_RAR_BTFR.md`

結果（Υ_disk=[0.45,0.5,0.55], Υ_bulge=[0.65,0.7,0.75]；seeds=50, train_fracs=5；計250split；galaxy-level |z|<3）：
- 候補（κ=1/(2π)）：pass_rate の min≈0.852（worst：0.55/0.75）→ robust_adopted_mlr=False → adopted_final=False（維持）。
- baseline（a0 fit）：min≈0.66（候補より不安定）。

再現：
- `python -B scripts/cosmology/sparc_rar_freeze_test_mlr_sweep.py --upsilon-disk 0.45 --upsilon-disk 0.5 --upsilon-disk 0.55 --upsilon-bulge 0.65 --upsilon-bulge 0.7 --upsilon-bulge 0.75`
- `python -B scripts/cosmology/sparc_falsification_pack.py`

---

## 2026-01-29（UTC） Phase 6（銀河回転曲線）/ Step 6.5（SPARC：RAR/BTFR）補修：M/L sweep の marginal（Υ_disk/Υ_bulge）を固定し、感度の支配要因を台帳化

目的：
- M/L sweep で adopted_final が False になる要因が Υ_disk と Υ_bulge のどちらに支配されるかを「出力として固定」し、次の prior 凍結（一次ソース）へ接続する。

変更：
- 更新：`scripts/cosmology/sparc_rar_freeze_test_mlr_sweep.py`
  - 既定の M/L グリッドを tight prior（Υ_disk=[0.45,0.5,0.55], Υ_bulge=[0.65,0.7,0.75]）へ変更（固定出力と一致させる）。
  - `marginal`（Υ_disk/Υ_bulge 方向の集約）を metrics に追加。
- 更新：`scripts/cosmology/sparc_falsification_pack.py`
  - pack に `scenario_b.systematics.mlr_sweep.candidate.marginal_by_upsilon_disk/bulge` を統合。
- 再生成（固定出力）：
  - `output/cosmology/sparc_rar_freeze_test_mlr_sweep_metrics.json`
  - `output/cosmology/sparc_rar_freeze_test_mlr_sweep.png`
  - `output/cosmology/sparc_falsification_pack.json`
- 更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json` / `doc/cosmology/SPARC_RAR_BTFR.md`

結果（candidate；galaxy-level pass_rate(|z|<3) の marginal）：
- Υ_disk=0.45：min=0.996、Υ_disk=0.50：min=0.976、Υ_disk=0.55：min=0.852（悪化の主因は Υ_disk）。
- Υ_bulge 方向の差は二次的で、最小値は常に Υ_disk=0.55 の列で決まる。

再現：
- `python -B scripts/cosmology/sparc_rar_freeze_test_mlr_sweep.py`
- `python -B scripts/cosmology/sparc_falsification_pack.py`
---

## 2026-01-30（UTC） Phase 4（宇宙論）/ Step 4.13.7（Fe-Kα broad line：ISCO制約）補修：NuSTAR proxy を DET1 region+背景差し引きで proxy_v4 化

目的：
- HEASoft 非依存で、NuSTAR event_cl から broad Fe-K の proxy fit（diskline_proxy）に使う net spectrum を再現可能に抽出し、ISCO制約（r_in）の系統台帳（band/gain/rebin）と同一I/Fで固定する。

変更：
- 更新：`scripts/xrism/fek_relativistic_broadening_isco_constraints.py`
  - NuSTAR event_cl の DET1 座標で「coarse peak→source円＋background annulus」を近似抽出し、背景差し引き後の net spectrum を fit する手続きを追加（`--nustar-region auto_det1`）。
  - 低S/N で fit が壊れないよう、min_counts を band内カウントから自動調整（5/10/25）し、fit 失敗時は mode を落として再試行する（fit_attempts を debug に記録）。
  - sysノブ台帳を `proxy_v4` に更新（`nustar_region` を knobs に追加）。
- 再生成（固定出力）：
  - `output/xrism/fek_relativistic_broadening_isco_constraints.csv`
  - `output/xrism/fek_relativistic_broadening_isco_constraints_metrics.json`
  - `output/xrism/fek_relativistic_broadening_model_systematics.json`
  - `output/xrism/fek_relativistic_broadening_isco_constraints_detail.json`
- 更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`

結果（初版）：
- NuSTAR 高S/N obsid（例：80001013002）では DET1 peak が明確で、region抽出の debug と `r_in` の proxy fit を固定出力化できた。
- 低S/N obsid（例：80001013001）は net counts が小さく、proxy の不安定性（sys大）が残るため、次段で「除外/統合/半径パラメータ」の凍結が必要。

再現：
- `python -B scripts/xrism/fek_relativistic_broadening_isco_constraints.py`
- 例（半径調整）：`python -B scripts/xrism/fek_relativistic_broadening_isco_constraints.py --nustar-src-radius 80 --nustar-bkg-inner 160 --nustar-bkg-outer 240`

---

## 2026-01-30（UTC） Phase 4（宇宙論）/ Step 4.13.7（Fe-Kα broad line：ISCO制約）補修：proxy_v5（Δχ²で low-S/N を凍結）

目的：
- NuSTAR proxy の「低S/N obsid をどう扱うか」を、手続きとして凍結する（レビュアー対策：恣意的除外に見えないよう、指標を出力として固定する）。

変更：
- 更新：`scripts/xrism/fek_relativistic_broadening_isco_constraints.py`
  - continuum-only（powerlaw）vs diskline_proxy の Δχ² を計算し、Δχ²<9 を broad line 未検出として凍結（`proxy_line_detected=0`）。
  - `proxy_isco_constrained`（line検出かつ r_in_bound なし）を固定出力化し、ISCO拘束可能な obsid を機械的に判定できるようにした。
  - CSV に proxy 判定列を追加（`proxy_quality`, `proxy_line_detected`, `proxy_delta_chi2`, `proxy_net_counts_band_pos`, `proxy_snr_band`, `proxy_isco_constrained`, `proxy_region_mode`）。
- 再生成（固定出力）：
  - `output/xrism/fek_relativistic_broadening_isco_constraints.csv`
  - `output/xrism/fek_relativistic_broadening_isco_constraints_metrics.json`（n_nustar_line_detected / n_nustar_isco_constrained_proxy を追加）
  - `output/xrism/fek_relativistic_broadening_isco_constraints_detail.json`
  - `output/xrism/fek_relativistic_broadening_model_systematics.json`
- 更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json` / `doc/paper/11_part2_astrophysics.md`

結果（GX 339-4 seed；初版）：
- NuSTAR 80001013001 は Δχ²≈0 で broad line 未検出扱い（`proxy_line_detected=0`）→ ISCO拘束不能を凍結。
- NuSTAR 80001013002 は `proxy_isco_constrained=1`（proxy段階では “拘束可能” 判定）。

再現：
- `python -B scripts/xrism/fek_relativistic_broadening_isco_constraints.py`

---

## 2026-01-30（UTC） Phase 6（銀河回転曲線）/ Step 6.5（SPARC：RAR/BTFR）補修：outlier clipping（MAD）を procedure sweep に追加

目的：
- 手続き系統 sweep を outlier clipping まで拡張し、selection 由来の手続き差を sys として固定する。

変更：
- 更新：`scripts/cosmology/sparc_rar_freeze_test.py`
  - low-accel galaxy-level 集約に `--galaxy-clipping-method`（none/mad）と `--galaxy-clipping-k` を追加。
- 更新：`scripts/cosmology/sparc_rar_freeze_test_procedure_sweep.py`
  - procedure grid に `galaxy_clipping=[none, mad:3.5]` を追加して sweep。
- 再生成：
  - `output/cosmology/sparc_rar_freeze_test_procedure_sweep_metrics.json`
  - `output/cosmology/sparc_rar_freeze_test_procedure_sweep.png`
  - `output/cosmology/sparc_falsification_pack.json`

結果：
- candidate の pass_rate(|z|<3) は procedure sweep で 0.933–1.0（min<0.95）となり、clipping を含めても procedure robustness は成立しない（robust_adopted_procedure=False）。

---

## 2026-01-30（UTC） Phase 6（銀河回転曲線）/ Step 6.5（SPARC：RAR/BTFR）完了（初版）：採用判定ゲートを最終固定し、ロードマップを完了へ更新

目的：
- Step 6.5 の「採用判定（adopted_final）と次条件」をロードマップ/実装ノートへ反映し、Step 6.5 を完了（初版）として閉じる。

変更：
- 更新：`doc/ROADMAP.md`
  - Step 6.5 を完了（初版）へ更新（6.5.3/6.5.3.2/6.5.5/6.5.5.2 の進行中ラベルを解消）。
  - 次条件を adopted_final=False（M/L + procedure robustness 失敗）前提へ更新。
- 更新：`doc/cosmology/SPARC_RAR_BTFR.md`（次の作業を「追加課題」へ整理）
- 更新：`doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`

結果：
- SPARC：候補 a0=κ c H0^(P) は adopted_fixed_ml=True だが、M/L と手続き系統に対して robust を失うため adopted_final=False を固定（採用は保留）。

再現：
- `python -B scripts/cosmology/sparc_falsification_pack.py`

---

## 2026-01-30（UTC） Phase 4（宇宙論）/ Step 4.13（XRISM：Resolve）補修：表記統一（4.13）と Resolve サマリ図の固定出力を追加

目的：
- 論文（Part II §4.13）/ ロードマップ（Step 4.13）/ STATUS の XRISM 表記を「XRISM（X線高分解能スペクトル：Resolve）」に揃え、4.13節に対応する代表図（Resolveの主要観測量サマリ）を固定出力として追加する。

変更：
- 更新：`doc/ROADMAP.md` / `doc/STATUS.md`（Step 4.13 の表記を Resolve に統一）
- 更新：`scripts/xrism/xrism_integration.py`（integration に `output/xrism/xrism_resolve_summary.png` を追加生成）
- 更新：`doc/paper/11_part2_astrophysics.md`（§4.13 に図（`output/xrism/xrism_resolve_summary.png`）を追記）
- 再生成：`output/xrism/xrism_integration_metrics.json` / `output/xrism/xrism_resolve_summary.png`

結果：
- Resolve の BH/AGN（β）と銀河団（Δv）のサマリ図を固定し、4.13節の「代表図」として参照できる形にした。

再現：
- `python -B scripts/xrism/xrism_integration.py`

---

## 2026-01-30（UTC） Phase 8（論文化）/ Step 8.2（補修）：Part II §5.3（宇宙論）の 5.3.1–5.3.3 を標準フォーム化（要点固定）＋図表インデックス整合

目的：
- Part II の 4.x/5.x 標準フォーム（目的/入力/処理/式/指標/結果/図/考察/注意）に合わせ、§5.3 の詳細サブ節（5.3.1–5.3.3）を「要点は箇条書きで固定」し、長い診断ログは internal-only として退避する。
- 追加参照した図（DESI promotion check / GW250114 / XRISM）の図表インデックス（固定パス）を更新し、`paper_lint` を通す。

変更：
- 更新：`doc/paper/11_part2_astrophysics.md`
  - §5.3.1–5.3.3 に標準フォームの要点（箇条書き）を追加し、既存の詳細ログを `<!-- INTERNAL_ONLY_* -->` ブロックにまとめて退避。
  - XRISM の QC 参照を placeholder から実在ファイルへ変更：`output/xrism/000125000__spectrum_qc.png`
- 更新：`doc/paper/01_figures_index.md`
  - 参照済み PNG の追加（未登録による警告の解消）：`output/cosmology/cosmology_desi_dr1_bao_promotion_check_public.png`、`output/gw/gw250114_*`、`output/xrism/xrism_resolve_summary.png`、`output/xrism/000125000__spectrum_qc.png`
- 検証：`paper_lint`（errors=0, warnings=0）

結果：
- Part II §5.3 の各サブ節は「標準フォームの要点（短い箇条書き）」が本文として固定され、詳細ログは internal-only へ退避した（本文の可読性と再現ログの両立）。
- 図表インデックスと本文参照が整合し、`paper_lint` が警告なしで通る状態になった。

再現：
- `python -B scripts/summary/paper_lint.py --manuscript doc/paper/11_part2_astrophysics.md --no-log`

---

## 2026-01-30（UTC） Phase 8（論文化）/ Step 8.2（補修）：Part II（part2_astrophysics）HTML生成失敗（\\bigl）を修正し再生成

目的：
- `output/summary/pmodel_paper_part2_astrophysics.html` が更新されない原因を切り分け、確実に再生成できる状態へ戻す。

原因：
- Part II の数式PNG生成（matplotlib mathtext）が `\\bigl` / `\\bigr` を解釈できず、`paper_build.py --profile part2_astrophysics` が例外で停止していた。

変更：
- 更新：`doc/paper/11_part2_astrophysics.md`
  - `\\bigl((1+z)^{\\Delta\\epsilon}\\bigr)` を `((1+z)^{\\Delta\\epsilon})` に置換し、mathtext互換に修正。
- 再生成：`output/summary/pmodel_paper_part2_astrophysics.html`

結果：
- Part II の HTML が正常に再生成され、タイムスタンプが更新されることを確認した。

再現：
- `python -B scripts/summary/paper_build.py --profile part2_astrophysics --mode publish --outdir output\\summary --skip-docx --skip-tables`

---

## 2026-01-30（UTC） Phase 8（論文化）/ Step 8.2.4（資料再生成バッチ）補修：`build_materials.bat` の引数無し（full）で論文HTML/DOCXを全生成

目的：
- `output/summary/build_materials.bat` を引数無しで実行したときに、論文のHTML/DOCX（paper/part2/part3/short_note）を一括で再生成できるようにし、再生成手順を運用ドキュメントへ明記する。

変更：
- 更新：`output/summary/build_materials.bat`
  - 引数無し（=full）で `paper_build.py` により `pmodel_paper` / `pmodel_paper_part2_astrophysics` / `pmodel_paper_part3_quantum` / `pmodel_short_note` の HTML を再生成するように拡張。
  - 上記4本の HTML→DOCX 変換を追加（Word無しは `RC=3` としてスキップ、失敗は warn して継続）。
- 更新：`AGENTS.md`
  - 引数無し（=full）の生成対象と、DOCXスキップ条件（Word無し）を追記。

結果：
- 論文系の成果物は `output/summary/build_materials.bat`（引数無し）で一括再生成できる状態を固定した（環境によりDOCXはスキップされ得る）。

再現：
- `C:\\develop\\waveP\\output\\summary\\build_materials.bat`

---

## 2026-01-30（UTC） Phase 8（論文化）/ Step 8.2（補修）：Part II の 4.x/5.x を標準フォームへ再整形（図ラベル重複/改行/図解説）

目的：
- Part II（`doc/paper/11_part2_astrophysics.md`）の 4.x/5.x を、標準フォーム（目的/入力/処理/式/指標/結果/図/考察/注意）で統一し、表記ゆれ（図ラベル重複）と可読性（過長行）を解消する。
- 図の解説を「タイトルの言い換え」ではなく、読者が図で何を見るかが分かる説明に揃える。

変更：
- 更新：`doc/paper/11_part2_astrophysics.md`
  - 4.x/5.x の各節で、見出し語（目的/入力/処理/式/指標/結果/図/考察/注意）を行頭に統一し、不要なラベルを削除。
  - 過長行を改行し、長いコマンドはコードブロック化（PowerShell）して可読性を改善。
  - LLR/Cassini 節の式ラベルの誤混入（四重極チャープ則の重複等）を修正し、節の内容に合わせた式を固定。
- 検証：`paper_lint`（errors=0, warnings=0）

結果：
- Part II の 4.x/5.x は標準フォームで読める形に整い、図の解説も「何を見るか」が分かる形で固定された。

再現：
- `python -B scripts/summary/paper_lint.py --manuscript doc/paper/11_part2_astrophysics.md --no-log`

---

## 2026-01-30（UTC） Phase 8（論文化）/ Step 8.2（補修）：Part II フォーム書式を「太字タイトル＋本文中心」へ更新（図説明の非箇条書き化）

目的：
- Part II（`doc/paper/11_part2_astrophysics.md`）のフォーム見出しを **太字（行頭）** に統一し、見出し行自体は箇条書きにしない。
- 図の下の説明を箇条書きにせず、2〜4行の説明文として意味のある解説を付与する（“図:” の重複も防ぐ）。

変更：
- 更新：`doc/paper/11_part2_astrophysics.md`
  - `- 目的：...` 等を `**目的**：...` 形式へ置換（入力/処理/式/指標/結果/考察/注意も同様）。
  - 図セクションは `**図**` とし、`output/...png` を本文中の `<code>`（バッククォート）参照＋段落説明で統一（図説明は非箇条書き）。
  - 5.3（DDR/BAO）などの多段節も同じフォームで再整形。
- 検証：`paper_lint`（errors=0, warnings=0）
- 再生成：`output/summary/pmodel_paper_part2_astrophysics.html` / `output/summary/pmodel_paper_part2_astrophysics.docx`

結果：
- Part II の本文フォームが揃い、図の説明が「タイトルの言い換え」ではなく “図で何を見るか” を示す形で固定された。

再現：
- `python -B scripts/summary/paper_lint.py --manuscript doc/paper/11_part2_astrophysics.md --no-log`
- `python -B scripts/summary/paper_build.py --profile part2_astrophysics --mode publish --outdir output\\summary --skip-tables`

---

## 2026-01-30（UTC） Phase 8（論文化）/ Step 8.2（補修）：Part II（Astrophysics）で LaTeX `\\` 表記が本文に出ないように補修（HTML/DOCX再生成）

目的：
- Part II（`doc/paper/11_part2_astrophysics.md`）の本文に、LaTeX の `\\alpha` / `\\mu` のようなエスケープ文字列が見える問題を解消し、生成HTMLで `\\` が残らない状態へ固定する。

変更：
- 更新：`doc/paper/11_part2_astrophysics.md`
  - 本文中の `r_s \\equiv 2GM/c^2`、`γ_max≈1/\\sqrt{\\delta_0}` のような LaTeX 風表記を、通常表記（Unicode）へ置換。
- 再生成：`output/summary/pmodel_paper_part2_astrophysics.html` / `output/summary/pmodel_paper_part2_astrophysics.docx`

結果：
- `rg -n \"\\\\\\\\\" output/summary/pmodel_paper_part2_astrophysics.html` が no matches となり、HTML本文に `\\` が残らないことを確認した。

再現：
- `python -B scripts/summary/paper_build.py --profile part2_astrophysics --mode publish --outdir output\\summary --skip-docx --skip-tables`
- `python -B scripts/summary/html_to_docx.py --in output\\summary\\pmodel_paper_part2_astrophysics.html --out output\\summary\\pmodel_paper_part2_astrophysics.docx --paper-equations --orientation landscape --margin-mm 7`

---

## 2026-01-30（UTC） Phase 8（論文化）/ Step 8.2（補修）：総合スコアボード（validation_scoreboard）の補足が図内に入る問題を修正

目的：
- Part II の総合スコアボード図（`output/summary/validation_scoreboard.png`）に、補足（Table 1 内訳等）が図内テキストとして埋め込まれていたため、図は図として簡潔にし、補足は本文側（図の直下）へ移す。

変更：
- 更新：`scripts/summary/validation_scoreboard.py`
  - 図内テキスト（「補足: …」「Table 1（全…行）: …」）の描画を削除。
  - 余白調整（left/right など）を固定し、レイアウト警告を回避。
- 更新：`doc/paper/11_part2_astrophysics.md`
  - 4.1 のスコアボード図の直下に、補足（図外で参照する方針）を追記。
- 再生成：`output/summary/validation_scoreboard.png` / `output/summary/validation_scoreboard.json`
- 再生成：`output/summary/pmodel_paper_part2_astrophysics.html` / `output/summary/pmodel_paper_part2_astrophysics.docx`

結果：
- スコアボード図は図内補足なし（本文側へ移動）として固定され、Part II の HTML/DOCX に反映された。

再現：
- `python -B scripts/summary/validation_scoreboard.py`
- `python -B scripts/summary/paper_build.py --profile part2_astrophysics --mode publish --outdir output\\summary --skip-docx --skip-tables`
- `python -B scripts/summary/html_to_docx.py --in output\\summary\\pmodel_paper_part2_astrophysics.html --out output\\summary\\pmodel_paper_part2_astrophysics.docx --paper-equations --orientation landscape --margin-mm 7`

---

## 2026-01-30（UTC） Phase 4（宇宙論）/ Step 4.13.7（Fe-Kα broad line / ISCO）補修：ISCO proxy 図を固定し、Part II §4.13 へ反映

目的：
- Step 4.13.7（Fe-Kα broad line / ISCO）の proxy_v5 出力に、内縁半径 r_in（ISCO proxy）の横断図を追加し、Part II §4.13 に主要数値と図を反映する。
- `paper_build.py --profile part2_astrophysics`（quick）でも図欠損で落ちないよう、図生成を best-effort で組み込む。

変更：
- 更新：`scripts/xrism/fek_relativistic_broadening_isco_constraints.py`
  - `--plot-only`（既存CSVからPNGのみ再生成）を追加。
  - 図：`output/xrism/fek_relativistic_broadening_isco_constraints.png`（r_in の横断図）を固定出力。
- 更新：`scripts/summary/paper_build.py`
  - profile=part2_astrophysics のとき、`xrism_integration.main([])` と `fek_relativistic_broadening_isco_constraints.main([\"--plot-only\"])` を best-effort で実行して図を用意する。
- 更新：`doc/paper/11_part2_astrophysics.md`
  - 4.13 XRISM に Fe-Kα broad line / ISCO（proxy; GX 339-4）の主要数値と図を追記。
- 更新：`doc/paper/01_figures_index.md`
  - 新図（ISCO proxy）を追記。
- 更新：`doc/ROADMAP.md`
  - Step 4.13.7 に図出力と論文化反映の進捗を追記。

再生成：
- `output/xrism/fek_relativistic_broadening_isco_constraints.png`
- `output/summary/pmodel_paper_part2_astrophysics.html` / `output/summary/pmodel_paper_part2_astrophysics.docx`

結果：
- Part II §4.13 に、ISCO proxy の現状（拘束可否・stat/sysのオーダー）が数値と図で入った。
- 次段は、RMF/ARF 畳み込み込みの reflection model へ置換し、P-model の ISCO 予測との比較指標（Δ/σ, z）を確定する（Step 4.13.7 継続）。

再現：
- 図（軽量）：`python -B scripts/xrism/fek_relativistic_broadening_isco_constraints.py --plot-only`
- HTML（軽量）：`python -B scripts/summary/paper_build.py --profile part2_astrophysics --mode publish --outdir output\\summary --skip-tables --skip-docx`
- DOCX：`python -B scripts/summary/html_to_docx.py --in output\\summary\\pmodel_paper_part2_astrophysics.html --out output\\summary\\pmodel_paper_part2_astrophysics.docx --paper-equations --orientation landscape --margin-mm 7`

---

## 2026-01-30（UTC） Phase 8（論文化）/ Step 8.2（補修）：DOCXで「章/項の前に改ページ」を強制（paper系）

目的：
- 論文DOCX（paper/Part II/Part III/short note）で、章と項の前に必ず改ページを入れ、読みやすい版面を固定する。

変更：
- 更新：`scripts/summary/html_to_docx.py`
  - `--pagebreak-headings` を追加（Heading 2/3 の前に改ページ）。
  - `--paper-equations` 指定時は自動で `pagebreak_headings` を有効化（paper系DOCXは常に改ページが入る）。
- 再生成：`output/summary/pmodel_paper_part2_astrophysics.docx`

結果：
- `pmodel_paper_part2_astrophysics.docx` で Heading 2/3 の前に改ページが入ることを確認した。

再現：
- `python -B scripts/summary/html_to_docx.py --in output\\summary\\pmodel_paper_part2_astrophysics.html --out output\\summary\\pmodel_paper_part2_astrophysics.docx --paper-equations --orientation landscape --margin-mm 7`

---

## 2026-01-30（UTC） Phase 8（論文化）/ Step 8.2（補修）：Part II（4.x/5.x）フォーム整形（図見出し撤去・式の `\\` 表記修正）

目的：
- Part II の 4.x/5.x 節で、「図」見出し重複や式中の `\\mu` 等のエスケープ表記が混入していたため、標準フォームに揃えた上で publish HTML/DOCX を再生成し、体裁起因の指摘リスクを下げる。

変更：
- 更新：`doc/paper/11_part2_astrophysics.md`
  - `**図**` のフォーム見出しを撤去し、結果の直後に図（PNG）と 2〜4行解説を置く形式へ統一。
  - 数式ブロック内の `\\` 表記を解消し、LaTeX を通常表記（例：`\mu`, `\eta`, `\epsilon_0`）へ統一。
  - 一部の「結果」行を適切に改行（数値と出力参照を分離）。
- 再生成：`output/summary/pmodel_paper_part2_astrophysics.html` / `output/summary/pmodel_paper_part2_astrophysics.docx`
  - `paper_lint` は errors=0。

再現：
- `python -B scripts/summary/paper_build.py --profile part2_astrophysics --mode publish --outdir output\\summary --skip-tables --skip-docx`
- `python -B scripts/summary/html_to_docx.py --in output\\summary\\pmodel_paper_part2_astrophysics.html --out output\\summary\\pmodel_paper_part2_astrophysics.docx --paper-equations --orientation landscape --margin-mm 7`

---

## 2026-01-30（UTC） Phase 4｜Step 4.13.7 + Phase 8｜Step 8.2（補修）：XMM RMF 畳み込み（diskline proxy）導入とスコアボード反映で Part II を再生成

目的：
- Fe-Kα broad line / ISCO（GX 339-4）の proxy 段階を、XMM 側だけでも RMF 畳み込みへ前進し、reflection model 置換の前提を揃える。
- 総合スコアボード図の体裁（図内補足なし）を Part II HTML/DOCX に確実に反映する。

変更：
- 更新：`doc/paper/11_part2_astrophysics.md`
  - 4.13 XRISM の注意を「NuSTAR=非折り込み proxy / XMM=RMF 畳み込み到達（ただし diskline proxy）」として更新。
- 更新：`doc/ROADMAP.md`
  - Step 4.13.7（ISCO）を `isco_constraints_v6` として更新し、XMM canned RMF cache と `rmf_diskline_v1` を追記。

再生成：
- `output/summary/pmodel_paper_part2_astrophysics.html`
- `output/summary/pmodel_paper_part2_astrophysics.docx`

結果：
- Part II のスコアボードは図内注釈無しで固定され、最新版が HTML/DOCX に埋め込まれた。
- ISCO（GX 339-4）は XMM の RMF 畳み込みでも上限貼り付きで拘束不能（次段：reflection model + sys 分解へ）。

再現：
- `python -B scripts/summary/validation_scoreboard.py`
- `python -B scripts/summary/paper_build.py --profile part2_astrophysics --mode publish --outdir output\\summary --skip-docx --skip-tables`
- `python -B scripts/summary/html_to_docx.py --in output\\summary\\pmodel_paper_part2_astrophysics.html --out output\\summary\\pmodel_paper_part2_astrophysics.docx --paper-equations --orientation landscape --margin-mm 7`

---

## 2026-01-30（UTC） Phase 8（論文化）/ Step 8.2（補修）：DOCX改ページ（Heading 4）と Part III（量子）フォーム整形（数式 `\\` 除去）

目的：
- 論文DOCXで、章（Heading 2）/項（Heading 3）に加えて「小項（Heading 4；例：5.3.1）」の前にも改ページを入れ、可読性を固定する。
- Part III（量子）を Part II の論文フォームへ揃え、本文に LaTeX エスケープ（`\\phi` 等）が露出しないようにする。

変更：
- 更新：`scripts/summary/html_to_docx.py`
  - `_apply_page_breaks_for_headings(..., levels=(2,3,4))` とし、Heading 4 も `PageBreakBefore` 対象に追加。
- 更新：`doc/paper/11_part2_astrophysics.md`
  - INTERNAL_ONLY 外の長文行を改行し、可読性を改善（内容は同一）。
- 更新：`doc/paper/12_part3_quantum.md`
  - 数式ブロック内の `\\` 表記を解消し、通常LaTeX（例：`\phi`, `\nabla`, `\sqrt`）へ統一。
  - 章序文・差分予測（Table 2周辺）などの長文行を改行し、Part II と同様の体裁へ寄せた（内容は同一）。

再生成：
- `output/summary/pmodel_paper_part2_astrophysics.html` / `.docx`
- `output/summary/pmodel_paper_part3_quantum.html`
- `output/summary/pmodel_paper_part3_quantum__tmp.docx`（`pmodel_paper_part3_quantum.docx` がロックされていたため暫定名で生成）

結果：
- DOCX XMLで、Heading 4 の見出し段落に `pageBreakBefore` が入ることを確認した（例：Part II の 5.3.1、Part III の 2.5.1）。
- publish HTML で `\\` の露出がないことを確認した（`paper_lint` errors=0）。

再現：
- `python -B scripts/summary/paper_build.py --profile part2_astrophysics --mode publish --outdir output\\summary --skip-tables --skip-docx`
- `python -B scripts/summary/html_to_docx.py --in output\\summary\\pmodel_paper_part2_astrophysics.html --out output\\summary\\pmodel_paper_part2_astrophysics.docx --paper-equations --orientation landscape --margin-mm 7`
- `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output\\summary --skip-tables --skip-docx`
- `python -B scripts/summary/html_to_docx.py --in output\\summary\\pmodel_paper_part3_quantum.html --out output\\summary\\pmodel_paper_part3_quantum.docx --paper-equations --orientation landscape --margin-mm 7`
  - 注：`pmodel_paper_part3_quantum.docx` が開かれていると上書きできないため、閉じてから再実行する。

---

## 2026-01-30（UTC） Phase 4（XRISM）/ Step 4.13.7（ISCO）：NuSTAR src_reg（X,Y）導入と `sys_region` 追加（isco_constraints_v7）

目的：
- Fe-Kα broad line の ISCO proxy について、NuSTAR event_cl の pipeline region（*_src.reg）を優先して使い、手続き差（region抽出）を系統として分離しつつ、再解析I/Fを固定する。

変更：
- 更新：`scripts/xrism/fetch_xmm_nustar_heasarc.py`
  - NuSTAR の既定 include に `event_cl/*.reg` を追加（*_src.reg を取得可能に）。
- 更新：`scripts/xrism/fek_relativistic_broadening_isco_constraints.py`
  - NuSTAR：`src_reg`（*_src.reg; X,Y）を追加し既定に変更（fallback：auto_det1→none）。
  - NuSTAR：`src_reg vs auto_det1` の差を `sys_region` として系統に追加（detail: `systematics.region_variants`）。
  - XMM：RMF/ARF折り込みでも continuum-only vs diskline の Δχ² を記録し、CSV の `proxy_*` 列を埋めるようにした。
  - status を `isco_constraints_v7` に更新。

取得：
- NuSTAR（HEASARC）：80001013002 / 80001015001 の `*_src.reg` を追加取得（`data/xrism/xmm_nustar/nustar/<obsid>/event_cl/`）。

生成：
- `output/xrism/fek_relativistic_broadening_isco_constraints.csv`
- `output/xrism/fek_relativistic_broadening_isco_constraints_metrics.json`
- `output/xrism/fek_relativistic_broadening_model_systematics.json`
- `output/xrism/fek_relativistic_broadening_isco_constraints_detail.json`
- `output/xrism/fek_relativistic_broadening_isco_constraints.png`

結果：
- NuSTAR 80001013002 は `src_reg` で `proxy_isco_constrained=1` を維持（r_in≈5.50 rg）。
- NuSTAR 80001015001 は `src_reg` でも `r_in_bound=lower`（proxy段階では下限貼り付き）を維持。

再現：
- `python -B scripts/xrism/fetch_xmm_nustar_heasarc.py --nustar-obsid 80001013002 --nustar-scope event_cl --download-missing --nustar-include-regex \"^event_cl/nu80001013002[AB].*_src\\.reg$\"`
- `python -B scripts/xrism/fek_relativistic_broadening_isco_constraints.py`
- `python -B scripts/xrism/fek_relativistic_broadening_isco_constraints.py --plot-only`

---

## 2026-01-30（UTC） Phase 4（XRISM）/ Step 4.13.7（ISCO）：XSPEC forward-fold fit の入口（ブロック時 plan 保存）を追加

目的：
- ISCO proxy を diskline proxy から物理モデル（reflection）へ置換する前段として、XSPEC/pyXspec がある環境で forward-fold fit を再現可能に回す入口（I/F）を固定する。
- XSPEC が無い環境でも「ブロック状態＋入力 plan」を JSON に保存し、依存不足で止まっている箇所を機械可読にする。

変更：
- 追加：`scripts/xrism/fek_relativistic_broadening_reflection_fit.py`
  - 入力（推奨）：`output/xrism/xmm_<obsid>__fek_broad_line_rmf_diskline.json`（PPS 選定済みの rmf_sources）
  - 出力（固定名）：`output/xrism/xmm_<obsid>__fek_broad_line_reflection_xspec.json`（blocked でも plan を保存）
- 更新：`scripts/xrism/fek_relativistic_broadening_isco_constraints.py`
  - `xmm_<obsid>__..._reflection_xspec.json` が status=ok の場合は、それを優先して台帳（CSV）へ反映する（未生成/blocked は従来 proxy を使用）。
- 更新：`doc/ROADMAP.md`
  - Step 4.13.7 に xspec entrypoint と per-obsid 出力名を追記した。

結果：
- XSPEC が無い環境では status=blocked_missing_xspec の plan JSON を保存できるようになった（XSPEC 環境での再実行を前提）。

再現：
- `python -B scripts/xrism/fek_relativistic_broadening_reflection_fit.py --dry-run`
---

## 2026-01-30（UTC） Phase 4（XRISM）/ Step 4.13.7（ISCO）：XSPEC dry-run plan 生成と xspec 状態の台帳化（metrics へ記録）

目的：
- XSPEC/pyXspec が無い環境でも「どの入力で forward-fold fit を回すか」を plan として固定し、XSPEC 環境へ持ち込んで再実行できる状態を強化する。
- ISCO 台帳（isco_constraints_v7）の metrics に xspec 実行状況（ok/blocked/dry_run/fail）を記録し、未実行が “見えない” 状態を避ける。

変更：
- 更新：`scripts/xrism/fek_relativistic_broadening_reflection_fit.py`
  - `--dry-run` は XSPEC の有無に関わらず plan JSON を生成し、終了コードは 0 とする（ブロック扱いにしない）。
- 更新：`scripts/xrism/fek_relativistic_broadening_isco_constraints.py`
  - `output/xrism/fek_relativistic_broadening_isco_constraints_metrics.json` に `n_xmm_xspec_*`（seen/ok/blocked/dry_run/fail）を追加して台帳化。
  - detail JSON に xspec の status/meta を付与（status=ok の場合は xspec 結果を優先して台帳へ反映）。

生成（更新）：
- `output/xrism/xmm_0204730201__fek_broad_line_reflection_xspec.json`（status=dry_run）
- `output/xrism/xmm_0204730301__fek_broad_line_reflection_xspec.json`（status=dry_run）
- `output/xrism/fek_relativistic_broadening_isco_constraints_metrics.json`（`n_xmm_xspec_dry_run=2` を記録）

再現：
- `python -B scripts/xrism/fek_relativistic_broadening_reflection_fit.py --dry-run`
- `python -B scripts/xrism/fek_relativistic_broadening_isco_constraints.py`

---

## 2026-01-30（UTC） Phase 7（量子）/ Step 7.14.6（物性）：OFHC copper 熱伝導率 κ(T) を Part III に反映（4.2.14）＋図の説明を補強

目的：
- Step 7.14.6（OFHC copper の熱伝導率 κ(T) baseline）を、論文本文（Part III）へ明示的に接続し、一次固定ターゲットとして参照できる状態にする。
- Part II を基準とする論文フォームに揃えるため、物性（凝縮系）サブ節の図について 2〜3行の説明を付与し、図の意味が本文で閉じるようにする。

変更：
- 更新：`doc/paper/12_part3_quantum.md`
  - `4.2.14`（OFHC copper κ(T)）を追加し、代表値（κ(4K), κ_max, κ(300K), fit誤差）を本文へ固定した。
  - `4.2.9–4.2.13` の図に短い説明（2行）を付与した（体裁の統一）。
- 更新：`doc/paper/01_figures_index.md`
  - `output/quantum/condensed_ofhc_copper_thermal_conductivity_baseline.png` を図表インデックスへ登録した。

再生成：
- `output/summary/pmodel_paper_part3_quantum.html`
- `output/summary/pmodel_paper_part2_astrophysics.html`（lint確認のため再生成）

結果：
- `paper_lint` warnings=0（Part III：図表インデックス登録まで含めて整合）。

再現：
- `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output\\summary --skip-docx --skip-tables`
- `python -B scripts/summary/paper_build.py --profile part2_astrophysics --mode publish --outdir output\\summary --skip-docx --skip-tables`

---

## 2026-01-30（UTC） Phase 4（XRISM）/ Step 4.13.7（ISCO）：XSPEC CLI fallback と .xcm（実行スクリプト）を凍結（pyXspec 非依存）

目的：
- Step 4.13.7 の forward-fold fit（XSPEC）について、pyXspec が無い環境でも実行できるようにし、ブロック（依存不足）を減らす。
- XSPEC 実行環境へ持ち込める **再現用 .xcm** を per-obsid で固定し、reviewer-facing に「何を回すか」を機械可読にする。

変更：
- 更新：`scripts/xrism/fek_relativistic_broadening_reflection_fit.py`
  - XSPEC の実行方式を 2系統に拡張：pyXspec（従来）＋XSPEC CLI（`xspec` 実行ファイル）fallback。
  - `--dry-run` でも per-obsid の `.xcm` を生成して固定（入力 plan と同一 I/F にする）。
  - method_tag を `xspec_diskline_v2` に更新（tclout による `RIN_PARAM` / `RIN_ERR` を出力し、CLI 実行時は解析ログ（tail）も JSON に保存）。
- 更新：`doc/ROADMAP.md`
  - Step 4.13.7 の XSPEC 出力I/Fに `.xcm` と CLI fallback を追記。

生成（更新）：
- `output/xrism/xmm_0204730201__fek_broad_line_reflection_xspec.xcm`
- `output/xrism/xmm_0204730301__fek_broad_line_reflection_xspec.xcm`
- `output/xrism/xmm_0204730201__fek_broad_line_reflection_xspec.json`（status=dry_run）
- `output/xrism/xmm_0204730301__fek_broad_line_reflection_xspec.json`（status=dry_run）

再現：
- `python -B scripts/xrism/fek_relativistic_broadening_reflection_fit.py --dry-run`
- （XSPEC環境；CLI）`python -B scripts/xrism/fek_relativistic_broadening_reflection_fit.py --prefer-cli --xspec-bin xspec`
- `python -B scripts/xrism/fek_relativistic_broadening_isco_constraints.py`（xspec status=ok を優先採用）

---

## 2026-01-30（UTC） Phase 4（XRISM）/ Step 4.13.7（ISCO）：sys/stat（σ_sys/σ_stat）と系統内訳（band/gain/rebin/region）を台帳へ追加

目的：
- 強場（Fe-Kα broad line / ISCO）で「系統が統計を支配しているか」を定量化するため、sys/stat（σ_sys/σ_stat）と σ_total を台帳（CSV）に固定する。
- 系統の主要因（band/gain/rebin/region）を `sys_*_rg` として分解し、次段（reflection model + cross-cal）で削るべき支配系統を明確化する。

変更：
- 更新：`scripts/xrism/fek_relativistic_broadening_isco_constraints.py`
  - CSV列を追加：`r_in_bound`, `sigma_total_rg`, `sys_stat_ratio`, `sys_band_rg`, `sys_gain_rg`, `sys_rebin_rg`, `sys_region_rg`。
  - `detail_json`（per-obsid）の `systematics.components` から `sys_*_rg` を抽出して横持ち（欠損は空欄）。
  - 図タイトルを「method-dependent」に変更（XMM: RMF-folded、NuSTAR: no RMF/ARF など手法差が残る段階であることを明示）。
- 更新：`doc/ROADMAP.md` / `doc/paper/11_part2_astrophysics.md` / `doc/STATUS.md`
  - sys/stat と系統内訳を台帳化した旨を追記。

結果（更新）：
- `output/xrism/fek_relativistic_broadening_isco_constraints.csv`
- `output/xrism/fek_relativistic_broadening_isco_constraints_metrics.json`（`n_isco_constrained_sys_stat_le10` を追加）
- `output/xrism/fek_relativistic_broadening_isco_constraints.png`

注意：
- `r_in_bound=upper/lower` の行は点推定ではないため、z と sys/stat は空欄にして誤解を避ける。

再現：
- `python -B scripts/xrism/fek_relativistic_broadening_isco_constraints.py`

---

## 2026-01-30（UTC） Phase 4（XRISM）/ Step 4.13.7（ISCO）：NuSTAR 80001013006 を追加し、ISCO台帳の独立観測数を増強

目的：
- Fe-Kα broad line / ISCO の proxy 台帳について、GX 339-4 の独立観測を増やし、dataset 横断での再現性と系統支配（sys/stat）の分布を確認できる状態にする。
- 「ISCO拘束が複数obsidで成立し、かつ sys/stat が支配しない」条件へ近づけるため、まず追加 obsid を同じ I/F で取り込む。

変更：
- 更新：`data/xrism/sources/xmm_nustar_targets.json`
  - NuSTAR obsid に 80001013006 を追加（GX 339-4）。
- 実行：`scripts/xrism/fek_relativistic_broadening_isco_constraints.py`
  - 台帳（CSV/PNG/metrics）を再生成し、`n_rows=6`、`n_isco_constrained=2` を更新した。

結果（更新）：
- `output/xrism/fek_relativistic_broadening_isco_constraints.csv`
- `output/xrism/fek_relativistic_broadening_isco_constraints_metrics.json`
- `output/xrism/fek_relativistic_broadening_isco_constraints.png`

注意：
- 80001013008 は単一ファイルが ~402 MiB と大きく、取得/再解析の負荷が高いため seed からは一旦除外（必要なら別途「大容量obsid」として扱う）。

再現：
- `python -B scripts/xrism/fek_relativistic_broadening_isco_constraints.py`

---

## 2026-01-30（UTC） Phase 4（XRISM）/ Step 4.13.7（ISCO）：ISCO 差分の比較指標（Δ/σ, z）と参照ISCOを台帳へ追加（isco_constraints_v7）

目的：
- Fe-Kα broad line の ISCO proxy（r_in）について、参照枠（GR）および P-model 側の候補ISCOとの **差分指標（Δ/σ, z）**を固定し、強場差分の反証条件へ接続できる形にする。
- 参照ISCO（数値と定義）を metrics に保存し、将来の reflection fit（XSPEC/relxill等）へ差し替えた後も比較軸が揺れないようにする。

変更：
- 更新：`scripts/xrism/fek_relativistic_broadening_isco_constraints.py`
  - CSV列を追加：`delta_gr_rg`, `z_gr`, `delta_pmodel_rg`, `z_pmodel`（σ_total=√(stat²+sys²) で計算）。
  - `output/xrism/fek_relativistic_broadening_isco_constraints_metrics.json` に `isco_reference`（GR=6 r_g、P-model候補=6.338 r_g）を保存。
  - `output/xrism/fek_relativistic_broadening_isco_constraints.png` に参照ISCOの縦線（GR/P-model）を追加。
- 更新：`doc/ROADMAP.md`
  - Step 4.13.7 に、z 指標と `isco_reference` 保存を追記。
- 更新：`doc/paper/11_part2_astrophysics.md`
  - ISCO 図の説明文に、縦線（GR/P-model）を追記。

結果（更新）：
- `output/xrism/fek_relativistic_broadening_isco_constraints.csv`
- `output/xrism/fek_relativistic_broadening_isco_constraints_metrics.json`
- `output/xrism/fek_relativistic_broadening_isco_constraints.png`

注意：
- `r_in_bound=upper/lower` の行は点推定ではないため、z 列は空欄にして誤解を避ける（bound を note に保持）。

再現：
- `python -B scripts/xrism/fek_relativistic_broadening_isco_constraints.py`

---

## 2026-01-30（UTC） Phase 4（XRISM）/ Step 4.13.7（ISCO）：NuSTAR 追加obsidで GX 339-4 の ISCO proxy を多観測化（n_rows=11）

目的：
- Fe-Kα broad line / ISCO の proxy 台帳について、GX 339-4 の独立観測数を増やし、dataset 横断で r_in（ISCO proxy）が再現するかと sys/stat の分布を確認できる状態にする。
- 「ISCO拘束が複数obsidで成立し、かつ sys/stat が支配しない」条件へ近づけるため、まず同一I/Fで複数 NuSTAR obsid を取り込む。

変更：
- 更新：`scripts/xrism/fek_relativistic_broadening_isco_constraints.py`
  - 既存の NuSTAR per-obsid detail JSON（`output/xrism/nustar_<obsid>__fek_broad_line_proxy_diskline.json`）が存在する場合は再計算を省略し、再実行コストを抑えた。
  - `--force-recompute-proxy` を追加し、必要なら proxy を上書き再計算できるようにした。
- 実行：`python -B scripts/xrism/fek_relativistic_broadening_isco_constraints.py`
  - NuSTAR obsid を追加して台帳を更新：80001013010 / 80302304007 / 80502325006 / 80702316002 / 90702303001。
- 更新：`doc/ROADMAP.md` / `doc/paper/11_part2_astrophysics.md` / `doc/STATUS.md`
  - 追加 obsid と metrics（n_rows / n_isco_constrained / sys/stat ゲート）を追記。

結果（更新）：
- `output/xrism/fek_relativistic_broadening_isco_constraints.csv`（n_rows=11）
- `output/xrism/fek_relativistic_broadening_isco_constraints_metrics.json`（`n_isco_constrained=5`、`n_isco_constrained_sys_stat_le10=3`）
- `output/xrism/fek_relativistic_broadening_isco_constraints.png`
- 新規 per-obsid detail JSON：
  - `output/xrism/nustar_80001013010__fek_broad_line_proxy_diskline.json`
  - `output/xrism/nustar_80302304007__fek_broad_line_proxy_diskline.json`
  - `output/xrism/nustar_80502325006__fek_broad_line_proxy_diskline.json`
  - `output/xrism/nustar_80702316002__fek_broad_line_proxy_diskline.json`
  - `output/xrism/nustar_90702303001__fek_broad_line_proxy_diskline.json`

注意：
- 本段階の NuSTAR は proxy（RMF/ARF 非折り込み）であり、reflection model（relxill等）による forward-fold fit へ置換した上で強場差分（ISCO）の結論を確定する（Step 4.13.7 の次段）。

再現：
- `python -B scripts/xrism/fek_relativistic_broadening_isco_constraints.py`
- （上書き）`python -B scripts/xrism/fek_relativistic_broadening_isco_constraints.py --force-recompute-proxy`

---

## 2026-01-30（UTC） Phase 4（XRISM）/ Step 4.13.7（ISCO）：HEASARC 取得manifestに追加NuSTAR obsidのsha256を追記（再現性補強）

目的：
- Step 4.13.7 の NuSTAR proxy で使用した追加obsidについて、一次データ取得の再現性（取得条件と sha256）を `data/xrism/sources/xmm_nustar_manifest.json` に固定する。

変更：
- 実行：`scripts/xrism/fetch_xmm_nustar_heasarc.py`
  - scope=event_cl、include を A01/B01 の cl event と src.reg に限定し、既存ファイルは `skipped_exists` として sha256 を記録（再ダウンロードなし）。
  - 対象：80302304007 / 80502325006 / 80702316002 / 90702303001

結果（更新）：
- `data/xrism/sources/xmm_nustar_manifest.json`

注意：
- 本段階は NuSTAR proxy（RMF/ARF 非折り込み）の入力固定であり、reflection model（relxill等）の forward-fold fit は別環境（XSPEC/HEASoft）で実施する。

再現：
- 例：`python -B scripts/xrism/fetch_xmm_nustar_heasarc.py --nustar-obsid 80302304007 --nustar-scope event_cl --nustar-include-regex \"^event_cl/nu80302304007[AB]01_cl\\.evt\\.gz$\" --nustar-include-regex \"^event_cl/nu80302304007[AB]01_src\\.reg$\" --download-missing`

---

## 2026-01-30（UTC） Phase 4（XRISM）/ Step 4.13.7（ISCO）：XSPEC forward-fold fit を実行可能化（PHA再ビン）→ XMM 2 obsid を status=ok で固定

目的：
- Step 4.13.7 の「ISCO 制約（強場差分）」について、XMM PPS スペクトルに対して XSPEC の forward-fold（RMF/ARF）fit を実行し、per-obsid の結果 JSON（status=ok）を固定できる状態にする。
- XMM PPS（SRSPEC 2400ch）と canned RMF（EBOUNDS 800ch）のチャンネル不整合を解消し、XSPEC が期待する OGIP PHA 形式を満たす I/F を確定する。

変更：
- 更新：`scripts/xrism/fek_relativistic_broadening_reflection_fit.py`
  - detail JSON の `spectrum_rebin`（2400→800）を参照し、XSPEC 実行前に OGIP PHA（spec/bkg）を 800ch へ再ビンして生成するようにした（HEASoft の `grppha/rbnpha` には依存しない）。
  - XSPEC が要求する HDUCLAS 系キーワード（HDUCLAS3/HDUVERS1）と link キーワード（RESPFILE/ANCRFILE/BACKFILE='none'）を付与し、XSPEC の「フォーマット未認識」/「BACKFILE missing」エラーを解消した。
  - XSPEC CLI の `tclout` が取得できない場合は status=fail として扱い、NaN を status=ok と誤認しないようにした。
- 実行（WSL）：XMM 2 obsid の XSPEC fit を実行して status=ok を固定した。
- 実行：`python -B scripts/xrism/fek_relativistic_broadening_isco_constraints.py` を再実行し、XMM は XSPEC 結果を優先採用する形で台帳を更新した（`n_xmm_xspec_ok=2`）。

結果（更新）：
- XSPEC per-obsid：
  - `output/xrism/xmm_0204730201__fek_broad_line_reflection_xspec.json`（status=ok）
  - `output/xrism/xmm_0204730301__fek_broad_line_reflection_xspec.json`（status=ok）
- 再ビン生成物：
  - `output/xrism/xmm_0204730201__m1__spec_rebin800.pha` / `output/xrism/xmm_0204730201__m1__bkg_rebin800.pha`
  - `output/xrism/xmm_0204730301__m1__spec_rebin800.pha` / `output/xrism/xmm_0204730301__m1__bkg_rebin800.pha`
- 台帳：`output/xrism/fek_relativistic_broadening_isco_constraints.csv` / `..._metrics.json` / `..._isco_constraints.png`

注意：
- 現状の XSPEC は diskline（Schwarzschild）の最小モデルのため、XMM は `r_in` が下限（6 r_g）に貼り付く（bound）形になっている。物理モデル（relxill 等）による制約確定と cross-cal/sys 分解は次段で実施する。

再現：
- （WSL）`wsl -d Ubuntu-24.04 -- bash -lc \"cd /mnt/c/develop/waveP && /home/entersystem/miniforge3/bin/mamba run -n xspec_env python3 -B scripts/xrism/fek_relativistic_broadening_reflection_fit.py --prefer-cli --xspec-bin xspec\"`
- `python -B scripts/xrism/fek_relativistic_broadening_isco_constraints.py`

---

## 2026-01-30（UTC） Phase 4（XRISM）/ Step 4.13.7（ISCO）：XSPEC dry-run の安全化（status=ok を上書きしない）

目的：
- `--dry-run` を「計画（plan）と .xcm を凍結する用途」に限定し、既に固定済みの XSPEC 結果（status=ok）を誤って上書きしないようにする。

変更：
- 更新：`scripts/xrism/fek_relativistic_broadening_reflection_fit.py`
  - `--dry-run` 時に、既存の `output/xrism/xmm_<obsid>__fek_broad_line_reflection_xspec.json` が status=ok の場合は JSON を上書きせず、.xcm（＋必要なら再ビン PHA）のみを更新するようにした。

再現：
- `python -B scripts/xrism/fek_relativistic_broadening_reflection_fit.py --dry-run`

---

## 2026-01-30（UTC） Phase 4（XRISM）/ Step 4.13.7（ISCO）：再ビン PHA の POISSERR/SYS_ERR を補完し、XSPEC χ² が非異常値になることを確認

目的：
- 自前生成の OGIP PHA（2400→800 再ビン）に `POISSERR` 等が欠落していると、XSPEC が非Poisson扱いとなり χ² が異常に巨大になる問題を解消する。
- bound 時の `tclout error` 出力（`0 0 + flags`）を統計誤差として誤解釈しない（NaN として扱う）。

変更：
- 更新：`scripts/xrism/fek_relativistic_broadening_reflection_fit.py`
  - PHAヘッダseedから `POISSERR`/`SYS_ERR` を継承し、再ビン PHA に書き出す。
  - `tclout error` が (0,0) の場合は `r_in_rg_stat` を NaN にし、`r_in_bound` が付くケースは統計誤差を NaN に統一した。
- 実行（WSL）：XMM 2 obsid で再実行し、`stderr_tail` の POISSERR warning が消え、redχ²≈1.34–1.38 になることを確認した。
- 実行：`python -B scripts/xrism/fek_relativistic_broadening_isco_constraints.py` を再実行し、台帳/図を更新した。

結果（更新）：
- XSPEC per-obsid：
  - `output/xrism/xmm_0204730201__fek_broad_line_reflection_xspec.json`（POISSERR warning なし；redχ²≈1.38）
  - `output/xrism/xmm_0204730301__fek_broad_line_reflection_xspec.json`（POISSERR warning なし；redχ²≈1.34）
- 台帳：`output/xrism/fek_relativistic_broadening_isco_constraints.csv` / `..._metrics.json` / `..._isco_constraints.png`

再現：
- （WSL）`wsl -d Ubuntu-24.04 -- bash -lc \"cd /mnt/c/develop/waveP && /home/entersystem/miniforge3/bin/mamba run -n xspec_env python3 -B scripts/xrism/fek_relativistic_broadening_reflection_fit.py --prefer-cli --xspec-bin xspec\"`
- `python -B scripts/xrism/fek_relativistic_broadening_isco_constraints.py`

---

## 2026-01-31（UTC） Phase 8（論文化）/ Step 8.2（補修）：Part III（量子）フォーム最終整形（Part II準拠）と Part3 HTML/DOCX 再生成

目的：
- Part III（量子）を Part II の標準フォーム（太字タイトル＋本文中心、図説明は箇条書きにしない）へ揃え、レビューで指摘されやすい体裁差を解消する。
- Part3 の HTML/DOCX を再生成し、更新物（HTML/DOCX）が出力へ反映される状態を確認する。

変更：
- 更新：`doc/paper/12_part3_quantum.md`
  - 2.5.2 の「実験接続」ブロックを、太字タイトル（非箇条書き）＋表＋本文の形へ整形した。
  - 4.2.7（核）の結果リストで、極端に長い1行（ansatz class の説明）を適切に改行した（内容は同一）。
  - 4.2.7.1 の pairing 補正の根拠を、箇条書き見出しではなく本文段落（OES / 半径応答 / 係数凍結）として整理した。
  - 4.2.8 の「同位体依存」「熱化学」を、太字タイトル（非箇条書き）＋本文の形へ整理した。
  - 5節（差分予測）に `**考察**：` を明示し、フォーム（目的/入力/処理/指標/結果/考察/注意）を揃えた。
- 更新：`output/summary/build_materials.bat`
  - `pmodel_paper_part3_quantum.docx` がロックされて `...__tmp.docx` が生成された場合に、注意メッセージを表示するようにした。

再生成：
- `output/summary/pmodel_paper_part3_quantum.html`
- `output/summary/pmodel_paper_part3_quantum__tmp.docx`（`pmodel_paper_part3_quantum.docx` がロックされていたため暫定名で生成）

結果：
- `paper_lint` errors=0, warnings=0。
- DOCX がロックされている場合でも tmp へ生成できることを確認した（本体を更新するには対象 DOCX を閉じて再実行する）。

再現：
- `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output\\summary --skip-docx --skip-tables`
- `python -B scripts/summary/html_to_docx.py --in output\\summary\\pmodel_paper_part3_quantum.html --out output\\summary\\pmodel_paper_part3_quantum.docx --paper-equations --orientation landscape --margin-mm 7`

---

## 2026-01-31（UTC） Phase 8（論文化）/ Step 8.2.5（DOCX体裁）補修：Part III（Part3）の DOCX が開かれていても既定ファイル名へ更新（in-place）

目的：
- `build_materials.bat` 実行時に `pmodel_paper_part3_quantum.docx` が開かれている/ロックされていても、既定ファイル名（`...part3_quantum.docx`）が更新されるようにする（`__tmp` 生成で止まらない）。

変更：
- 更新：`scripts/summary/html_to_docx.py`
  - `pmodel_paper_part3_quantum.docx` の rename が失敗した場合、起動中の Word（ActiveObject）を通じて **開いている当該DOCXを in-place に更新して Save**するフォールバックを追加した。
  - これにより、`__tmp.docx` は一時生成されても最終的に削除され、既定ファイル名が更新される。

結果：
- `cmd /c output\\summary\\build_materials.bat`（または `html_to_docx.py`）実行後に `output/summary/pmodel_paper_part3_quantum.docx` の更新が成立することを確認した。

注意：
- この挙動は「Wordで当該DOCXが開かれていても更新したい」用途向けであり、DOCXを手編集している場合は上書きされる（編集は別名保存を推奨）。
- Word が起動していない/当該DOCXがWordで開かれていない場合は、従来どおり `__tmp.docx` を残して警告する（対象ロックの原因がWord以外の可能性があるため）。

再現：
- `python -B scripts/summary/html_to_docx.py --in output\\summary\\pmodel_paper_part3_quantum.html --out output\\summary\\pmodel_paper_part3_quantum.docx --paper-equations --orientation landscape --margin-mm 7`

---

## 2026-01-31（UTC） Phase 8（論文化）/ Step 8.2.6（体裁改修）枠線撤去＋Part III（量子）の入力短文化・結果表化

目的：
- 全ての論文（paper/part2/part3/short_note）について、HTML/DOCX の「枠線」を撤去する（見出し下線／カード枠／画像枠／表枠線）。
- Part III 4.2.7.1 のフォントが小さすぎる問題を抑制する。
- Part III の入力（ソース）表記が冗長になりすぎていた箇所を、言葉での表現へ寄せる。
- Part III で複数の結果を示す箇所を表形式へ統一する。

変更：
- 更新：`scripts/summary/paper_html.py`
  - publish HTML の枠線（見出し下線／カード枠／画像枠／表枠線）を撤去し、表は枠線なし＋背景で可読性を確保。
- 更新：`scripts/summary/html_to_docx.py`
  - Word変換後に表枠線を強制しない（枠線を無効化）。
  - Heading 4/5 のフォントサイズを正規化し、小見出しが小さすぎないように調整。
- 更新：`scripts/summary/paper_qc.py`
  - DOCX の A.0 表チェックを「枠線あり」→「枠線なし（val=none/nil）」へ更新。
- 更新：`doc/paper/12_part3_quantum.md`
  - 4.2.* の入力表記からコマンド/パス列挙を除去し、一次ソース中心の説明へ整理（必要な詳細は INTERNAL_ONLY に退避）。
  - 4.2.* の結果を表形式へ統一（ベル／干渉／光学／QED／核／分子／物性）。
  - 8章（再現性）は `build_materials.bat` を入口として簡潔化（コマンド羅列は INTERNAL_ONLY へ退避）。
- 更新：`doc/ROADMAP.md`（8.2.6 を追記）

再生成：
- `cmd /c output\\summary\\build_materials.bat quick-nodocx`
- `python -B scripts/summary/html_to_docx.py --in output\\summary\\pmodel_paper.html --out output\\summary\\pmodel_paper.docx --paper-equations --orientation landscape --margin-mm 7`
- `python -B scripts/summary/html_to_docx.py --in output\\summary\\pmodel_paper_part2_astrophysics.html --out output\\summary\\pmodel_paper_part2_astrophysics.docx --paper-equations --orientation landscape --margin-mm 7`
- `python -B scripts/summary/html_to_docx.py --in output\\summary\\pmodel_paper_part3_quantum.html --out output\\summary\\pmodel_paper_part3_quantum.docx --paper-equations --orientation landscape --margin-mm 7`
- `python -B scripts/summary/html_to_docx.py --in output\\summary\\pmodel_short_note.html --out output\\summary\\pmodel_short_note.docx --paper-equations --orientation landscape --margin-mm 7`

結果：
- `paper_lint` errors=0, warnings=0（paper/part2/part3/short_note）。
- `paper_qc` ok=True（DOCX表チェック：`paper_docx_a0_table_no_borders=True`）。

---

## 2026-01-31（UTC） Phase 8（論文化）/ Step 8.2.6（体裁改修）追加：Part II（宇宙物理編）の複数結果を表形式へ統一＋背景白（DOCX）を強制

目的：
- Part II で「複数の結果（複数dataset/複数指標）を箇条書きで羅列」していた箇所を、表形式へ統一する。
- 論文DOCXで「テキスト背景がグレー」になる問題を解消し、背景を白に統一する。
- 総合スコアボード（`validation_scoreboard.png`）の補足が図内に入って可読性が落ちる問題を避け、図外（本文）で説明する前提へ戻す。

変更：
- 更新：`doc/paper/11_part2_astrophysics.md`
  - 4.3/4.7–4.13 の「結果」を表形式へ整理（Cassini/GPS/EHT/重力赤方偏移/二重パルサー/GW/フレームドラッグ/XRISM）。
  - 5.1–5.3.3 の「結果」を表形式へ整理（EHT差分・δ0上限・DDR/BAO/AP等）。
  - 表の列崩れを避けるため、表中の絶対値表記は `abs(x)` または `∣x∣` を使用（`|x|` は使わない）。
- 更新：`scripts/summary/paper_html.py`
  - `pre`（コードブロック）の背景を白に統一（濃色背景を廃止）。
- 更新：`scripts/summary/html_to_docx.py`
  - WordのHTML取り込みで残る `<w:shd ... w:fill="FAFAFA">` 等の shading を、DOCX XML の後処理で `FFFFFF` へ強制（背景白）。
  - `<w:highlight .../>` も削除（背景色の統一）。
- 更新：`AGENTS.md`
  - 複数結果は表形式、背景白、枠線なし、DOCXの章/項/小項に改ページ、を論文フォーム規約へ追記。

再生成：
- `python -B scripts/summary/validation_scoreboard.py`
- `cmd /c output\\summary\\build_materials.bat quick`
- `python -B scripts/summary/paper_qc.py`

結果：
- `output/summary/pmodel_paper_part2_astrophysics.html` / `.docx` を更新（結果表・図・体裁が反映）。
- `output/summary/pmodel_paper_part3_quantum.docx` を更新（`__tmp` に落ちず既定名で生成）。
- `output/summary/validation_scoreboard.png` を更新（図内の冗長注記を避ける前提で再生成）。
- `paper_qc` ok=True（枠線なし・LaTeXエスケープなし等）。

---

## 2026-01-31（UTC） Phase 8（論文化）/ Step 8.2.7（体裁改修）表ヘッダー背景＋Table 1（検証サマリ）ヒートマップ＋タイトル重複解消

目的：
- Part II/III の表について、ヘッダー行だけ背景色を付与して可読性を上げる。
- 検証サマリ（Table 1）の「差/指標」列を、P-model と観測の差（proxy）に応じて緑→黄→赤（中間色あり）で可視化する。
- Table 1 のタイトル表記が重複していた問題を解消し、本文（4.1）の直後に Table 1 を注入する方式へ統一する。

変更：
- 更新：`scripts/summary/paper_html.py`
  - Table 1 JSON（`output/summary/paper_table1_results.json` / `paper_table1_quantum_results.json`）から HTML table を生成し、本文の `4.1 Table 1（検証サマリ）` 直後へ注入する方式へ変更（独立セクションとしての追加を廃止）。
  - 「差/指標」セルに背景色（HSLベース；緑→黄→赤）を付与（Part III は数値が無い行も黄（入口/制約）へ寄せ、全行で色が付くように調整）。
  - 表ヘッダー（`th`）の背景色を追加（薄青）。
- 更新：`scripts/summary/html_to_docx.py`
  - DOCX の背景白統一パッチを「全て白へ強制」から、「不要な灰色背景のみ白へ補正」へ緩和し、意図した色（ヘッダー/ヒートマップ）を保持。

再生成：
- `cmd /c output\\summary\\build_materials.bat quick`
- `python -B scripts/summary/paper_qc.py`

結果：
- `output/summary/pmodel_paper_part2_astrophysics.html` / `.docx`：Table 1 の「差/指標」がヒートマップ化され、タイトル重複が解消。
- `output/summary/pmodel_paper_part3_quantum.html` / `.docx`：同様にヒートマップ化され、DOCXでも意図した色が保持されることを確認（灰色背景は残らない）。
- `paper_qc` ok=True（`output/summary/paper_qc.json`）。

---

## 2026-01-31（UTC） Phase 8（論文化）/ Step 8.2.8（体裁改修）スコアボードの画面収まり改善＋Part III（量子）用スコアボード追加

目的：
- Part II の総合スコアボード（`validation_scoreboard.png`）が、項目増加で縦に伸びすぎて画面に収まらない問題を改善する。
- Part III（量子）にも同様の俯瞰図（スコアボード）を用意し、Table 1 の入口で「全体像→個別節」へ繋げやすくする。

変更：
- 更新：`scripts/summary/validation_scoreboard.py`
  - スコアボードPNGの描画を「自動分割（多段）」へ変更し、項目数が増えても高さが過度に伸びないようにした（横方向の列分割）。
  - title/xlabel を外から渡せるようにし、他用途（量子）へ再利用可能にした。
- 追加：`scripts/summary/quantum_scoreboard.py`
  - `output/summary/paper_table1_quantum_results.json`（Part III Table 1）から、z/σ/Δ（手続き感度）の proxy を用いて正規化スコア（0=理想、1/2=境界）を算出し、俯瞰図（PNG/JSON）を固定出力化した。
- 更新：`doc/paper/12_part3_quantum.md`
  - 4.1 Table 1（検証サマリ）に `output/summary/quantum_scoreboard.png` を追加し、Table 1 の俯瞰図として位置づけた。
- 更新：`doc/paper/01_figures_index.md`
  - `output/summary/quantum_scoreboard.(png|json)` を追加し、図番号リンクの安定性を維持した。
- 更新：`output/summary/build_materials.bat`
  - `quick/full/quick-nodocx` で `validation_scoreboard.py` と `quantum_scoreboard.py` を自動生成する入口を追加し、論文生成と同期するようにした。

再生成：
- `cmd /c output\\summary\\build_materials.bat quick`
- `python -B scripts/summary/paper_qc.py`

結果：
- `output/summary/validation_scoreboard.png` が多段表示になり、画面に収まりやすいサイズで固定された。
- `output/summary/quantum_scoreboard.png` / `.json` を追加し、Part III（量子）の Table 1 俯瞰図が HTML/DOCX に反映された。
- `paper_qc` ok=True。

---

## 2026-01-31（UTC） Phase 8（論文化）/ Step 8.2.9（体裁改修）スコアボード縦3段化＋source表記除去＋Table 1 全行着色＋EHT図凡例位置修正

目的：
- 総合スコアボードの「横分割」で左側ラベルが消える問題を解消する（縦3段へ変更）。
- 論文本文に出ていた内部トークン（`source=...metrics.json`）を除去し、第三者にとって意味のある表現へ寄せる。
- Part II Table 1 の「差/指標」列で背景色が白のセルが残る問題を解消（全行で着色）。
- Part II 図16（EHTリング直径）の凡例がグラフと被る問題を解消（右下へ移動）。

変更：
- 更新：`scripts/summary/validation_scoreboard.py`
  - 多段レイアウトを「横分割」→「縦3段（stacked panels）」へ変更（ラベル欠落回避）。
- 更新：`scripts/summary/paper_html.py`
  - Table 1 の表示から `source=...` を除去。
  - Part II（非量子）の Table 1 は不明パターンでも中間色（黄）で着色し、全行で背景色が付くように調整。
- 更新：`scripts/eht/eht_shadow_compare.py`
  - `eht_shadow_compare.png` の凡例位置を右下へ変更（図16の被り回避）。

再生成：
- `python -B scripts\\eht\\eht_shadow_compare.py`
- `cmd /c output\\summary\\build_materials.bat quick`
- `python -B scripts\\summary\\paper_qc.py`

結果：
- `output/summary/validation_scoreboard.png` / `output/summary/quantum_scoreboard.png` は縦3段表示になり、ラベルが欠落しない。
- `output/summary/pmodel_paper_part2_astrophysics.html` / `output/summary/pmodel_paper_part3_quantum.html` から `source=` 表記が消えた。
- Part II/III の Table 1 は「差/指標」列が全行で着色される（白セルなし）。
- `paper_qc` ok=True（`output/summary/paper_qc.json`）。

---

## 2026-01-31（UTC） Phase 8（論文化）/ Step 8.2.10（体裁改修）論文から内部パス表記（data/scripts/output）を除去

目的：
- 論文本文・一次ソース一覧・参考文献に残っていた内部パス（`data/`/`scripts/`/`output/`）表記を削除し、第三者が「出典」と「意味」だけを追える体裁にする。
- 「入手性（Reproducibility / Availability）」の節から、実装・運用向けのコマンド列挙を外し、本文は一次ソースと固定条件の説明に集中させる。

変更：
- 更新：`doc/paper/11_part2_astrophysics.md`
  - 本文中の内部パス表記を削除し、文章化（Figureは埋め込みで維持）。
  - GWセクションに「多イベント要約」と「GW250114のIMR consistency（proxy）」を図として追加。
- 更新：`doc/paper/12_part3_quantum.md`
  - データ/方法・入手性の節から内部パスとビルド入口表記を削除。
- 更新：`doc/paper/20_data_sources.md` / `doc/paper/30_references.md`
  - 「ローカル」「Local cache」等のローカルキャッシュ表記を除去（一次ソースのURL/参照日を残す）。

再生成：
- `cmd /c output\\summary\\build_materials.bat quick`
- `python -B scripts/summary/paper_qc.py`

結果：
- `output/summary/pmodel_paper_part2_astrophysics.html` / `output/summary/pmodel_paper_part3_quantum.html` で `<code>(data|scripts|output)/...` が 0件。
- `paper_qc` ok=True（`output/summary/paper_qc.json`）。

---

## 2026-01-31（UTC） Phase 8（論文化）/ Step 8.4.2（図の可読性）EHT 図16（リング直径）の凡例・注記を修正

目的：
- Part II 図16（EHTリング直径）で「リング直径（観測）」と「影直径（モデル予測）」と「EHT推定の影直径 d_sh」が混ざって見える問題を解消する。
- Sgr A* の d_sh はリング直径からの推定量であり、独立な観測量ではない点を明示する。
- M87* は論文側で d_sh が明示されないため、黒ひし形（d_sh）は出さないことを明確化する。

変更：
- 更新：`scripts/eht/eht_shadow_compare.py`
  - 棒（P-model/GR）は「影直径（モデル予測）」、赤点は「観測リング直径」、黒ひし形は「参考：EHT推定の影直径 d_sh（Sgr A*のみ）」となるよう凡例を修正。
  - κ 表記のうち、d_sh 由来の比は `κ_ref(d_sh)` として区別。

再生成：
- `python -B scripts\\eht\\eht_shadow_compare.py`
- `cmd /c output\\summary\\build_materials.bat quick`

結果：
- `output/eht/eht_shadow_compare.png` の表記が誤読しにくくなり、M87* の黒ひし形（d_sh）が無い理由も凡例で明確になった。
[work] 2026-01-31T07:58:03Z Phase 8 / Step 8.4.2: EHT 図16-18の M87*/Sgr A* 両表記を強化。M87* の d_sh 参考値（質量・距離からの Schwarzschild 影直径）を追加し、eht_shadow_compare/kappa_fit/systematics の凡例を κ_ref(d_sh) に統一。図16で Sgr A* はリング>影（中心値）となるよう確認。
[work] 2026-01-31T09:16:07Z Phase 8 / Step 8.4.2: EHT 図16の誤読対策。図の凡例/タイトルを θ_ring vs θ_sh(κ=1) に明確化し、θ_ring−d_sh の注記を追加。4.8本文に d_sh が推定量である注意書きを追記し、Part2/3/全paperをquick再生成。
[work] 2026-01-31T09:39:11Z Phase 4 / Step 4.13.7: Fe-Kα broad line/ISCO（GX 339-4）を初版完了として固定。ISCO proxy 台帳（csv/metrics/図）を最新化し、Part2（4.13）の代表表を sys/stat≤10 の3 obsidへ更新。doc/ROADMAP.md の 4.13.7 を完了（初版）へ更新し、quickで論文HTML/DOCXを再生成。
[work] 2026-01-31T09:51:26Z Phase 4 / Step 4.6: JWST/MAST スペクトルを再取得（--download-missing, max-obs=1）し、offline で z_estimate/z_confirmed を再計算。release waitlist を更新（GN-z11 は未公開のまま、release=2026-04-09）。integration metrics（jwst_spectra_integration_metrics.json）も更新。
[work] 2026-01-31T10:23:40Z Phase 4 / Step 4.6: fetch_mast_jwst_spectra の offline モードで、manifest の product list 欠落でも raw/ の x1d FITS を検出できる fallback（scan）を追加。offline 再生成で qc/z_estimate が GN-z11 以外 9/10 に改善し、Table 1 の JWST 行（x1d_qc_ok=9/10, z_candidates=9/10）を更新（paper_tables）。
[work] 2026-01-31T10:51:51Z Phase 4 / Step 4.6: JWST/MAST の NIRSpec ターゲット（JADES_10058975, RX_11027）で、obsid が uncal/rate 側に寄って x1d product が見つからない問題を解消するため、targets.json の extra_filters に dataproduct_type=spectrum と instrument_name=NIRSPEC/SLIT を追加。これにより per-target manifest が正しい x1d product list（x1d_fits_n=6）を保持する。併せて、fetch_mast_jwst_spectra の subset 実行で manifest_all.json を上書きしてダッシュボード/Table1の targets_n が崩れる問題を防ぐため、manifest_all に run_targets を追加し、既存 items を merge して clobber を回避。
[work] 2026-01-31T11:07:21Z Phase 4 / Step 4.6: 公開済みターゲットの独立スペクトル数（ok_spectra_n）を増強。JADES_10058975 は NIRSpec x1d を 6本（+combined 1本）へ拡張し、min_ok_spectra=2 を満たす形で z_confirmed を再固定（ok_spectra_n=3）。LID4959 は p750l + mirimage_x1d を spectra に含め、max_z_pull により誤ピークを除外する設定で z_confirmed を再固定（ok_spectra_n=3）。integration/paper_tables を再生成し、Table 1 の JWST 行は targets=10 のまま安定（GN-z11 未公開で release_wait=1）。
[work] 2026-01-31T11:13:25Z Phase 4 / Step 4.6: z_confirmed の手続き系統を強化するため、confirm-z の整合性指標 χ²/dof>1 の場合に Birge ratio（sqrt(χ²/dof)）で z_total_sigma を膨張させるルールを導入（uncertainty_inflation を JSON に記録）。これにより、スペクトル間の散らばりが大きいケース（例：JADES_10058975 の χ²/dof≈24）は過小評価されず、手続き依存性を σ に織り込める。全ターゲットを --offline --confirm-z で再生成し、integration/paper_tables を更新。
[work] 2026-01-31T11:23:52Z Phase 4 / Step 4.6: LID2619 の z_confirmed を multi-spectrum cross-check へ拡張（p750l + mirimage_x1d を spectra に追加）。二重線の入れ替わり（誤ピーク）を避けるため prior_sigma_um を狭くし、min_ok_spectra=2 を満たす形で ok_spectra_n=3 に改善。併せて jwst_spectra_integration_metrics に、multi-spectrum 確定数（z_confirmed_multi_spectra_ok_n）と χ²/dof>1 のフラグ集計を追加し、Table 1 の定量メトリクスを補強した。
[work] 2026-01-31T11:58:43Z Phase 5 / Step 5.1: EHT（ブラックホール影）補強文献（M87 2018 Paper I/II、Vincent+2022、Johnson+2020、Gralla+2020）を一次ソースとしてキャッシュし、`scripts/eht/fetch_eht_supporting_papers.py` を追加。`doc/PRIMARY_SOURCES.md` / `doc/paper/30_references.md` / `doc/eht/README.md` を更新して参照を固定した。
[work] 2026-01-31T12:26:47Z Phase 5 / Step 5.1: EHT（ブラックホール影）の補強として、M87* の multi-epoch（2017/2018）リング直径の整合性を固定出力化。`data/eht/eht_black_holes.json` に `ring_measurements` と補強ソース（Paper VI, persistent I/II, Vincent/Johnson/Gralla）を追加し、`scripts/eht/eht_m87_persistent_shadow_metrics.py` で `output/eht/eht_m87_persistent_shadow_ring_diameter.png` / `..._metrics.json` を生成。論文側（`doc/paper/10_manuscript.md` / `doc/paper/11_part2_astrophysics.md`）にも multi-epoch 図と系統文献を反映した。
[work] 2026-01-31T12:46:36Z Phase 5 / Step 5.1.3.54: public report（dashboard）に M87* multi-epoch 図カードを追加し、第三者が整合性チェックを追える形に統合（`scripts/summary/public_dashboard.py` を再生成）。
[work] 2026-01-31T13:29:12Z Phase 7 / Step 7.15.1: 統計力学・熱力学の入口として、黒体放射の基準量（σ, a, nγ）を NIST CODATA（一次）から固定し、`output/quantum/thermo_blackbody_radiation_baseline.*` を生成。Part III に 4.2.15 を追記し、`doc/quantum/19_stat_mech_thermo.md` を追加した。
[work] 2026-01-31T13:50:16Z Phase 7 / Step 7.15.2: 黒体（光子気体）の平衡熱力学（u,p,s,nγ）と s/(nγ k_B)=const を固定出力化（`output/quantum/thermo_blackbody_entropy_baseline.*`）。Part III に 4.2.16 を追記し、Step 7.15 を完了（初版）へ更新した。
[work] 2026-01-31T14:16:50Z Phase 7 / Step 7.9.9: Part III の原子核節（4.2.7/4.2.7.1）を Part II 標準フォームへ整形し、棄却/解除の要点を要約表で固定。Δ²r kink は A_min=100 の base no-go（Sn=3.075σ, Sp=3.723σ）、AR(1) sweep（closest pass ρ=-0.40）、pairing の strict pass（Sn=0.688σ, Sp=2.014σ）を本文へ反映した。
[work] 2026-01-31T14:23:29Z Phase 7 / Step 7.9.9: Part III 4.2.7.1 の判定式表記を `abs(...)` へ統一し、表やコード整形で `|` が誤解を生まないように整理した。
[work] 2026-01-31T14:36:30Z Phase 7 / Step 7.13.8.6: barrier+tail の canonical 解（Step 7.13.8.5）の ERE 主要数値（eq18/eq19）と代表図（triplet barrier fraction scan）を Part III 4.2.7 に追記し、同時拘束が成立する最小自由度を論文化として固定した。
[work] 2026-01-31T15:12:25Z Phase 7 / Step 7.14.7: 物性（凝縮系）ターゲットの `falsification`（棄却条件）を metrics に固定（Si 格子/Cp/ρ係数/α、OFHC Cu κ）。Part III 4.2.9–4.2.14 を標準フォーム（目的/入力/処理/式/指標/結果/注意）へ統一。
[work] 2026-01-31T15:45:30Z Phase 7 / Step 7.14.8: Debye–Grüneisen 最小モデル（α≈A·Cv）の成立性チェックを追加し、Si α(T) が符号反転（T≈124 K）を含むため定数Aモデルが全域で棄却されること、さらに T≥200 K でも比例が成立しないこと（相対RMSE≈0.182）を固定出力化。Part III 4.2.13 に要約表と図を追記。
[work] 2026-01-31T16:09:11Z Phase 7 / Step 7.14.9: Debye–Grüneisen 最小拡張（A_eff(T)=A_inf·tanh((T−T0)/ΔT)）を固定出力化し、T0 を観測の負→正交差で凍結。符号反転は再現できるが精度不足（fit range rel RMSE≈0.237、|resid|>3σ_fit が 514点）で棄却。Part III 4.2.13 に表と図を追記し、ROADMAP/図インデックス/STATUS/AI_CONTEXT を更新。
[work] 2026-01-31T16:26:54Z Phase 7 / Step 7.14.10: Debye–Grüneisen 2枝モデル（α≈A1·Cv(θ1)+A2·Cv(θ2)）を固定出力化し、θ1 を Debye fit で凍結した上で θ2 を走査・A1/A2 を重み付きLSで決定。符号反転温度は近傍まで寄るが、σ_fit スケールで精度不足（max abs(z)≈23.8、reduced χ²≈56.8）で棄却。Part III 4.2.13 に表と図を追記し、ROADMAP/図インデックス/STATUS/AI_CONTEXT を更新。
[work] 2026-01-31T16:42:34Z Phase 7 / Step 7.14.11: Debye+Einstein 混合モデル（α≈A_D·Cv_D(θ_D)+A_E·Cv_E(θ_E)）を固定出力化し、θ_D を凍結した上で θ_E を走査・A_D/A_E を重み付きLSで決定。符号反転温度は近傍まで寄るが、σ_fit スケールで精度不足（max abs(z)≈23.1、reduced χ²≈57.8）で棄却。Part III 4.2.13 に表と図を追記し、ROADMAP/図インデックス/STATUS/AI_CONTEXT を更新。
[work] 2026-01-31T16:56:23Z Phase 7 / Step 7.14.12: A_eff(T) 多項式 ansatz（診断：α≈A_eff(T)·Cv_Debye）を固定出力化し、次数 n=0..3 の範囲でも σ_fit スケールでは棄却されることを確認（best n=3 でも max abs(z)≈52.6）。単一Debye Cv 前提の滑らかな A_eff(T) だけでは形状が足りない点を “出力として” 明文化した。Part III 4.2.13 に表と図を追記し、ROADMAP/図インデックス/STATUS/AI_CONTEXT を更新。
[work] 2026-01-31T17:12:24Z Phase 7 / Step 7.14.13: Cp(T)（JANAF）を proxy に取り込んだ Grüneisen ansatz（α≈A_inf·tanh((T−T0)/ΔT)·Cp_proxy）を固定出力化し、Cv形状の改善だけでは σ_fit スケールで救えないことを確認（max abs(z)≈55.2）。Part III 4.2.13 に表と図を追記し、ROADMAP/図インデックス/STATUS/AI_CONTEXT を更新。
[work] 2026-01-31T17:52:39Z Phase 7 / Step 7.14.14: Debye+Einstein×2（光学2枝）混合モデルを追加し、σ_fit 近傍まで改善するが strict を満たさず棄却（max abs(z)=3.23, reduced χ²=2.32）。Part III 4.2.13 に表と図を追記し、ROADMAP/図インデックス/STATUS/AI_CONTEXT を更新。
[work] 2026-01-31T18:12:58Z Phase 7 / Step 7.14.15: temperature-split holdout（train→test）を追加し、fitレンジ選択が統計量を支配し得る点を定量化（Einstein×2は train で max abs(z)<1 でも test で 15–45 まで悪化）。Part III 4.2.13 に要約表と図を追記し、ROADMAP/図インデックス/STATUS/AI_CONTEXT を更新。
[work] 2026-01-31T19:12:17Z Phase 7 / Step 7.14.16: Si の弾性定数（Ioffe semiconductor database）をキャッシュし、バルク弾性率 B(T) の参照曲線（piecewise; 400K未満一定＋400–873K線形近似）を固定出力化（`output/quantum/condensed_silicon_bulk_modulus_baseline.*`）。400→600KでのB変化は約−1.6%。
[work] 2026-01-31T19:12:17Z Phase 7 / Step 7.14.17: Cp_proxy + B(T) を用いた `α≈γ(T)·Cp_proxy/(B(T)V_m)`（tanh γ）を評価し、B(T) を入れても σ_fit スケールの棄却が解消しないことを固定（`output/quantum/condensed_silicon_thermal_expansion_gruneisen_cp_proxy_gammaT_bulkmodulus_model.*`）。Part III 4.2.13 に補足図を追記し、ROADMAP/図インデックス/STATUS/AI_CONTEXT を更新。
[work] 2026-01-31T19:53:47Z Phase 7 / Step 7.14.18: Ioffe DB の phonon frequencies（代表周波数）を抽出し、Einstein 温度 θ_E を離散アンカーとして固定した Debye+Einstein×2 を追加。TA（低周波）× optical（高周波）の離散候補から SSE 最小のペアを選択し、fit range（T≥50 K）でも棄却（max abs(z)=5.17, reduced χ²=4.16）、holdout A でも test 側で max abs(z)=7.81 まで悪化。2点アンカーだけでは不足であり、phonon DOS/anharmonicity 側の追加拘束が必要であることを固定した。Ioffe extracted_values/manifest の sha 更新に伴い 7.14.16/7.14.17 の出力を再生成し、Part III 4.2.13/図インデックス/PRIMARY_SOURCES/ROADMAP/STATUS/AI_CONTEXT を更新。
[work] 2026-01-31T19:56:26Z Phase 7 / Step 7.14.19: Ioffe の離散アンカーを 3枝（Einstein×3）へ拡張（光学側2枝）し、枝数増加だけでは holdout が改善しないことを固定（fit range（T≥50 K）: max abs(z)=4.75, reduced χ²=4.13 で棄却、holdout A の test 側で max abs(z)=15.9 まで悪化）。Part III 4.2.13 に要約表と図を追記し、ROADMAP/図インデックス/STATUS を更新。
[work] 2026-01-31T20:28:02Z Phase 7 / Step 7.14.20: 次段（phonon DOS / mode-dependent γ / anharmonicity の一次拘束で holdout を通す最小追加物理）をロードマップへ明文化し、次の作業（入力候補/凍結方針/反証条件）を固定した。
[work] 2026-01-31T21:02:17Z Phase 7 / Step 7.14.20: Si phonon DOS（ω–D(ω)）の公開HTML（proxy）をキャッシュし、acoustic/optical の half-integral split に基づく “DOS拘束 2-group” Grüneisen モデルを評価。strict（max|z|<=3 & χ²_red<=2）と holdout（split A/B）を満たさず棄却で、DOS形状の凍結だけでは高温域の α(T) を予測できないことを固定した。出力：`output/quantum/condensed_silicon_thermal_expansion_gruneisen_phonon_dos_mode_gamma_model_metrics.json`。
[work] 2026-01-31T21:11:28Z Phase 7 / Step 7.14.20: 2:1 の mode-count（TA/LA）に基づき、TA/LA/optical の “DOS拘束 3-group” へ拡張して評価。global fit は改善するが、holdout split A（50–300→300–600 K）で train→test 崩壊が残り棄却（anharmonicity / ω(T)・γ(T) の一次拘束が必要）。出力：`output/quantum/condensed_silicon_thermal_expansion_gruneisen_phonon_dos_mode_gamma_three_group_model_metrics.json`。
[work] 2026-01-31T22:20:06Z Phase 7 / Step 7.14.20: DOS拘束モデルに optical softening（線形；fをgrid scan）を追加し、最小anharmonicity proxyで holdout が改善するかを評価。2-group は best f(T_max)=0.060 でも棄却（T≥50K: max abs(z)≈22.8）。3-group は best f(T_max)=0.000 で差が出ず、holdout 崩壊も残る。出力：`output/quantum/condensed_silicon_thermal_expansion_gruneisen_phonon_dos_mode_gamma_optical_softening_linear_model_metrics.json` / `output/quantum/condensed_silicon_thermal_expansion_gruneisen_phonon_dos_mode_gamma_three_group_optical_softening_linear_model_metrics.json`。
[work] 2026-01-31T23:26:53Z Phase 7 / Step 7.14.20: Raman ω(T) の一次拘束候補として arXiv:2001.08458 のPDFをキャッシュし、ベクタ図の ω(T) マーカーをdigitizeして softening 形状 g(T) を固定（`data/quantum/sources/arxiv_2001_08458_si_raman_phonon_shift/`）。これを用いた optical softening（Raman shape；`s(T)=1−f·g(T)`）を DOS拘束モデルへ追加し、f を grid scan で選ぶ最小拡張を評価したが、holdout 崩壊は解消しなかった（2-group best f=0.040 でも棄却、3-group best f=0.000）。出力：`output/quantum/condensed_silicon_thermal_expansion_gruneisen_phonon_dos_mode_gamma_optical_softening_raman_shape_model_metrics.json` / `output/quantum/condensed_silicon_thermal_expansion_gruneisen_phonon_dos_mode_gamma_three_group_optical_softening_raman_shape_model_metrics.json`。ROADMAP/STATUS/PRIMARY_SOURCES/図インデックス/Part III を更新。
[work] 2026-02-01T01:43:31Z Phase 7 / Step 7.14.20: phonon DOS 拘束モデルを 4-group（TA/LA/TO/LO）へ拡張し、符号制約付き weighted LS（境界探索）で係数を推定。global は改善（T≥50K: max abs(z)=6.05, reduced χ²=5.97）するが、holdout A は 1.12→16.95 で train→test 崩壊が残り棄却。Kim2015 global softening proxy や optical softening（linear/Raman shape）は 4-group でも改善せず（例：max abs(z)=6.87、holdout A 16.95→18.91）。実装（`scripts/quantum/condensed_silicon_thermal_expansion_gruneisen_phonon_dos_mode_gamma_model.py`）と Part III（要約表）/図インデックス/STATUS/AI_CONTEXT を更新。
[work] 2026-02-01T02:57:39Z Phase 7 / Step 7.14.20: INS一次（Kim et al., PRB 91, 014307 (2015)）の published PDF をオープンミラー（CaltechAUTHORS）からキャッシュし、図の digitize（温度依存 DOS / γ(T)）に進むための入口を追加。CaltechAUTHORS の `download=1` が短寿命の S3 redirect を返して 403 になる場合があるため、fetcher 側で cache-buster（`&ts=`）を付与して安定取得できるようにした。更新：`scripts/quantum/fetch_silicon_phonon_dos_sources.py`、一次ソース追記：`doc/PRIMARY_SOURCES.md`、進捗反映：ROADMAP/STATUS/AI_CONTEXT。
[work] 2026-02-01T04:12:36Z Phase 7 / Step 7.14.20: Kim2015 Fig.1 の温度別 phonon DOS を published PDF（CaltechAUTHORS）からベクタ曲線として digitize し、固定データ（`fig1_digitized_dos.json`）と検証図（`output/quantum/silicon_phonon_dos_kim2015_fig1_digitized.png`）を生成。これを用いる T-dependent DOS モード（`--dos-mode kim2015_fig1_energy`）を Si α(T) の DOS拘束モデルへ追加し、2-group/4-group を評価したが strict/holdout は満たさず（例：4-group global max abs(z)=5.89, reduced χ²=3.53、holdout A test max abs(z)=19.4）。ROADMAP/STATUS/AI_CONTEXT を更新。
[work] 2026-02-01T05:11:25Z Phase 7 / Step 7.14.20: Kim2015 Fig.2 の feature別 -Δε/ε を published PDF（CaltechAUTHORS）から digitize して固定（fig2_digitized_softening.json / silicon_phonon_softening_kim2015_fig2_digitized.png）。これを用いた fixed mode-softening（--mode-softening kim2015_fig2_features）を Si α(T) の DOS拘束モデルへ追加し、static ω の 2/3/4-group を評価したが strict/holdout は未達（例：4-group T≥50K max abs(z)=6.44, holdout A test max abs(z)=14.84）。次は Fig.2 を γ(T) の一次拘束へ接続し、固定入力として A(T) 温度依存を最小追加して holdout 条件を探索する。
[work] 2026-02-01T05:44:00Z Phase 7 / Step 7.14.20: phonon DOS 拘束モデルに `--use-bulk-modulus`（B(T) と V_m を固定入力として導入し、`α≈Σ γ_i·Cv_i/(B(T)·V_m)` で γ_i を fit）を追加して検査。4-group の global 指標は大きく悪化（T≥50K: max abs(z)≈32.5, reduced χ²≈174；+Fig.2 mode-softening でも max abs(z)≈32.8, reduced χ²≈191）し、strict/holdout を満たさず棄却。出力：`output/quantum/condensed_silicon_thermal_expansion_gruneisen_phonon_dos_mode_gamma_four_group_bulkmodulus_model_metrics.json` / `output/quantum/condensed_silicon_thermal_expansion_gruneisen_phonon_dos_mode_gamma_four_group_mode_softening_kim2015_fig2_bulkmodulus_model_metrics.json`。

---

## 2026-02-01（UTC） Phase 7（量子）/ Step 7.14.16・7.14.20：B(T) 参照曲線の 400K 不連続を除去し、--use-bulk-modulus の評価を再固定

目的：
- Ioffe の Cij(T) 線形近似をそのまま使うと 400 K で B_ref と不連続になり、α(T) の σ_fit に対して巨大な系統（段差）となって評価が破綻するのを避ける。

変更：
- 更新：`scripts/quantum/condensed_silicon_bulk_modulus_baseline.py`
  - 400 K 以上の線形 Cij(T) を、400 K で B_ref に一致するよう平行移動して連続化（offset=+0.692×(1e11 dyn/cm^2)）。
- 更新：`scripts/quantum/condensed_silicon_thermal_expansion_gruneisen_cp_proxy_gammaT_model.py` / `scripts/quantum/condensed_silicon_thermal_expansion_gruneisen_phonon_dos_mode_gamma_model.py`
  - 同じ連続化を `_bulk_modulus_pa` に反映。

再生成：
- `python -B scripts/quantum/condensed_silicon_bulk_modulus_baseline.py`
- `python -B scripts/quantum/condensed_silicon_thermal_expansion_gruneisen_cp_proxy_gammaT_model.py --use-bulk-modulus`
- `python -B scripts/quantum/condensed_silicon_thermal_expansion_gruneisen_phonon_dos_mode_gamma_model.py --groups 4 --enforce-signs --use-bulk-modulus`
- `python -B scripts/quantum/condensed_silicon_thermal_expansion_gruneisen_phonon_dos_mode_gamma_model.py --groups 4 --enforce-signs --mode-softening kim2015_fig2_features --use-bulk-modulus`

結果：
- B(T) は 400→600 K で約 −1.52%（連続）となり、段差由来の偽棄却は解消。
- 4-group（bulkmodulus）：global は strict ok（T≥50K: max abs(z)≈2.04, reduced χ²≈0.34）だが、holdout は未達。
- 4-group（mode-softening + bulkmodulus）：global は strict ok（T≥50K: max abs(z)≈1.33, reduced χ²≈0.30）だが、holdout test は reduced χ²≈5.7 で未達。

参照：
- `doc/STATUS.md`
- `doc/ROADMAP.md`

[work] 2026-02-01T07:58:19Z Phase 7 / Step 7.14.20: Kim2015 Fig.2 の ω_scale_i(T) を用いた γ(T) trend を診断として追加（`--gamma-trend kim2015_fig2_softening_common`）。global は strict ok（T≥50K: max abs(z)≈1.32, reduced χ²≈0.19）だが、holdout A/B で Δγ が不安定になり test が崩壊（例：max abs(z)≈18.2, reduced χ²≈114）するため、trend 1パラメータでは generalize できず棄却。出力：`output/quantum/condensed_silicon_thermal_expansion_gruneisen_phonon_dos_mode_gamma_four_group_mode_softening_kim2015_fig2_gamma_trend_kim2015_fig2_bulkmodulus_model_metrics.json`。
[work] 2026-02-01T08:43:39Z Phase 7 / Step 7.14.20: Kim2015（PRB 91, 014307）Eq.(4)/(6)/(9) と Table I を、digitized Fig.2（ω_scale）に接続する診断を追加（`kim2015_gruneisen_diagnostics` を metrics に埋め込み）。Eq.(6) 由来の γ_T は 300K で ≈7.39 と再現され、Fig.2 の softening が “等温体積項” を含む（barγの単純proxyが大きくなる）ことを数値で示した。併せて、T-dependent DOS（Kim2015 Fig.1 digitize）を `--use-bulk-modulus` と組み合わせた 4-group を追加検査したが、holdout が大崩壊（test reduced χ²≫1）して棄却（Fig.1 だけでは手続き依存が解消しない）。更新：`scripts/quantum/condensed_silicon_thermal_expansion_gruneisen_phonon_dos_mode_gamma_model.py`。出力：`output/quantum/condensed_silicon_thermal_expansion_gruneisen_phonon_dos_mode_gamma_four_group_kim2015_fig1_energy_bulkmodulus_model_metrics.json`、既存 Fig.2+bulkmodulus 系 metrics に `kim2015_gruneisen_diagnostics` を追記。
[work] 2026-02-01T09:47:33Z Phase 7 / Step 7.14.20: Si α(T) の DOS拘束 Grüneisen モデル（`scripts/quantum/condensed_silicon_thermal_expansion_gruneisen_phonon_dos_mode_gamma_model.py`）に holdout 安定化の正則化ノブを追加（`--ridge-factor`, `--delta-ridge-factor`）。`--ridge-factor` は定数γモデルの holdout 改善に寄与せず（小さくしても悪化し得る）。一方で γ(T) trend（Δγ）の “trainで不安定→test崩壊” は `--delta-ridge-factor` で抑制できるが、strict holdout（reduced χ²≤2）には未達（例：`delta_ridge_factor=1e-4` で split A/B test reduced χ²≈6.9/11.9）。次は Eq.(8) の温度項を最小追加し、range selection 依存の系統を減らす設計へ進む。
[work] 2026-02-01T10:28:41Z Phase 7 / Step 7.14.20: Kim2015 の Eq.(8)（⟨∂lnε/∂T⟩|_V）を診断として明示化し、Fig.2 digitize（isobaric dlnω/dT）を「quasiharmonic（体積項）」と「intrinsic（温度項）」へ分解した比率（300K）を metrics に固定した（`Eq8_fraction_*`）。併せて、Windows PowerShell（cp932）で `--help` が UnicodeEncodeError で落ちる問題（–/ω/γ/Δ/Σ/λ/≈ 等）を CLI help 文字列側で回避し、引数無しで help が出ることを確認。更新：`scripts/quantum/condensed_silicon_thermal_expansion_gruneisen_phonon_dos_mode_gamma_model.py`。出力：`output/quantum/condensed_silicon_thermal_expansion_gruneisen_phonon_dos_mode_gamma_four_group_mode_softening_kim2015_fig2_bulkmodulus_model_metrics.json`（`kim2015_gruneisen_diagnostics` に Eq.(8) 系の内訳が追加）。
[work] 2026-02-01T11:24:48Z Phase 7 / Step 7.14.20: Si α(T) の holdout（train→test）改善を狙い、(1) ω(T) を含む Cv(T)=dU/dT の診断（`--cv-omega-dependence dU_numeric`）と、(2) V_m(T)=V_ref·exp(3∫α dT) を 1/(B·V_m) に反映する診断（`--vm-thermal-expansion`）を追加して評価したが、いずれも holdout が悪化して棄却。更新：`scripts/quantum/condensed_silicon_thermal_expansion_gruneisen_phonon_dos_mode_gamma_model.py`。出力：`output/quantum/condensed_silicon_thermal_expansion_gruneisen_phonon_dos_mode_gamma_four_group_mode_softening_kim2015_fig2_bulkmodulus_cv_dU_model_metrics.json` / `output/quantum/condensed_silicon_thermal_expansion_gruneisen_phonon_dos_mode_gamma_four_group_mode_softening_kim2015_fig2_bulkmodulus_vmT_model_metrics.json`。
[work] 2026-02-01T12:08:58Z Phase 7 / Step 7.14.20: Fig.2 依存を外した最小の γ(T) trend 診断として `--gamma-trend linear_T`（g(T)=(T-300K)/T_max, 1パラメータ Δγ）を追加し、4-group+bulkmodulus で評価。global は strict ok（T≥50K: max abs(z)≈1.25）だが、holdout A/B が大崩壊（test reduced χ²≈96.7/103）するため棄却。更新：`scripts/quantum/condensed_silicon_thermal_expansion_gruneisen_phonon_dos_mode_gamma_model.py`。出力：`output/quantum/condensed_silicon_thermal_expansion_gruneisen_phonon_dos_mode_gamma_four_group_mode_softening_kim2015_fig2_gamma_trend_linear_T_bulkmodulus_model_metrics.json`。
[work] 2026-02-01T13:34:26Z Phase 7 / Step 7.14.20: Si α(T) の holdout 改善を狙い、`condensed_silicon_thermal_expansion_gruneisen_phonon_dos_mode_gamma_model.py` に固定周波数基底の γ(ω) 診断（`--gamma-omega-model`：`linear_endpoints` / `pwlinear_split`）を追加して評価。`pwlinear_split` は global strict ok（max abs(z)≈2.73, reduced χ²≈0.38）まで到達するが holdout が未達（split A test reduced χ²≈3.40、split B test reduced χ²≈20.6）。併せて Eq.(8) の体積項のみを ω_scale に反映する診断（`--mode-softening kim2015_fig2_features_eq8_quasi`）を追加したが holdout が悪化して棄却（split A test reduced χ²≈13.9）。doc/ROADMAP.md / doc/STATUS.md / doc/AI_CONTEXT_MIN.json を更新。
[work] 2026-02-01T17:09:41Z Phase 7 / Step 7.14.20: Si α(T) の DOS拘束 Grüneisen モデルで、固定周波数基底の γ(ω) を `pwlinear_split_leaky` へ拡張し、overlap（ε）と warp（w→w^p）を凍結ノブとして追加。グリッド探索により strict+holdout strict を同時に満たす凍結点（ridge=1e-06, ε=0.24, warp_p=1.32）を確立し、Step 7.14.20 を完了（初版）へ更新。更新：`scripts/quantum/condensed_silicon_thermal_expansion_gruneisen_phonon_dos_mode_gamma_model.py` / `doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`。出力：`output/quantum/condensed_silicon_thermal_expansion_gruneisen_phonon_dos_mode_gamma_gamma_omega_pwlinear_split_leaky_mode_softening_kim2015_fig2_bulkmodulus_ridge1e-06_leak2p40e-01_warp1p32_model_metrics.json`。
[work] 2026-02-01T17:32:48Z Phase 8 / Step 8.2: doc/ROADMAP.md のステータスを整合化（Step 7.9 / 7.13.15 / 7.14 を完了（初版）へ更新）し、doc/STATUS.md と doc/AI_CONTEXT_MIN.json の現在地を Phase 4 / Step 4.6（JWST/MAST；GN-z11 公開待ち）へ更新。
[work] 2026-02-01T17:53:26Z Phase 4 / Step 4.6: JWST/MAST の公開/未公開状況を再スキャンし、`manifest_all.json` を更新。offline で z_estimate/z_confirmed を再計算し、integration metrics（`output/cosmology/jwst_spectra_integration_metrics.json`）と Table 1 出力（`scripts/summary/paper_tables.py`）を更新。GN-z11 は未公開のまま（obsid=253898658、release_utc=2026-04-09T20:45:23.996448+00:00）。
[work] 2026-02-01T18:31:07Z Phase 4 / Step 4.6: GN-z11 の target_name 揺れによる取りこぼし対策として、`data/cosmology/mast/jwst_spectra/targets.json` に position（ra/dec）を追加し、cone search でも拾える形へ更新。再スキャンしても GN-z11 の公開 x1d は未だ未公開（release_utc=2026-04-09T20:45:23.996448+00:00）。併せて `output/summary/build_materials.bat` の改行を CRLF に修正して `quick-nodocx` が動作することを確認し、論文HTML/スコアボード等を再生成。
[work] 2026-02-01T18:50:25Z Phase 4 / Step 4.8: XRISM の番号互換（XRISMは Step 4.13 を正とする）が確定済みのため、Step 4.8 を完了（初版）へ更新。更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`。
[work] 2026-02-01T19:09:23Z Phase 4 / Step 4.6: JWST/MAST を再スキャンし、`manifest_all.json` と z_estimate/z_confirmed（offline）および integration metrics / Table 1 を再生成。GN-z11 は未公開のまま（release_utc=2026-04-09T20:45:23.996448+00:00）。併せて `cmd /c output\\summary\\build_materials.bat quick-nodocx` で論文HTML/スコアボード等を再生成。
[work] 2026-02-01T19:15:03Z Phase 4 / Step 4.6.6: JWST/MAST の release waitlist（公開待ち）を再生成し、GN-z11 の未公開状態（release_utc）を更新。integration/Table 1 と論文HTML（quick-nodocx）も再生成。
[work] 2026-02-01T19:21:05Z Phase 8 / Step 8.2: `doc/STATUS.md` を「最小サマリ」運用へ戻し、現在地（Phase/Step）と直近結果/次作業だけに整理（履歴は `doc/WORK_HISTORY.md` を正とする）。
[work] 2026-02-01T19:27:39Z Phase 4 / Step 4.6: GN-z11 の公開待ちにより作業がブロックされるため、ロードマップ Step 4.6 の現状を「保留（GN-z11 公開待ち；I/F は完了（初版））」として明示。更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`。
[work] 2026-02-02T00:47:13Z Phase 4 / Step 4.6: `build_materials.bat` で Table 1 が最新の cache 状態を反映するように、`jwst_spectra_release_waitlist.py` を argv-safe にし、`scripts/summary/paper_build.py` の Table 1 生成前に JWST（release waitlist/integration）と XRISM integration を best-effort で再生成する手順を追加。
[work] 2026-02-02T01:08:10Z Phase 4 / Step 4.6: JWST/MAST を再スキャンし、release waitlist / integration / Table 1 / 論文HTML（quick-nodocx）を再生成。GN-z11 は未公開のまま（release_utc=2026-04-09T20:45:23.996448+00:00）。

---

## 2026-02-02（UTC） Phase 7（量子）/ Step 7.4.9（Bell横断統合）＋ Phase 4（強場）/ Step 4.8（EHT κ誤差予算）

目的：
- Part II（EHT）で κ の誤差予算を「モデル依存（厚いディスク等）」まで含めて保守的に固定し、差分予測（必要精度）へ接続する。
- Part III（Bell）で反証条件パックを dataset 横断で統合し、selection 感度と delay シグネチャ（Δmedian; z）を同一I/Fで凍結する。

変更：
- 更新：`scripts/eht/eht_kappa_error_budget.py`
  - κσ の採用値に「放射モデル依存（thick disk 等；Vincent 2022）」の floor を導入（Paper VI の推定影直径テーブル散らばりを proxy として使用）。
  - 図を横棒へ変更し、ラベル過密で読めない問題を解消。
- 更新：`scripts/quantum/bell_primary_products.py`
  - Delft（event-ready）の offset sweep も ratio=Δ/σ へ統一し、全datasetで selection ratio を比較可能にした。
  - `output/quantum/bell/longterm_consistency.json` を「cross-dataset summary（ratio + delay z + freeze点）」として拡張。
  - `output/quantum/bell/falsification_pack.png` を ratio + delay（Δmedian; z）で再描画。
- 更新：`doc/paper/11_part2_astrophysics.md` / `doc/paper/12_part3_quantum.md`
  - EHT κ誤差予算図と、Bell反証条件パック図を本文へ追加。
- 更新：`doc/paper/01_figures_index.md`
  - 追加した図を index に登録（paper_lint warning 0件）。

再生成：
- `python -B scripts/eht/eht_kappa_error_budget.py`
- `python -B scripts/quantum/bell_primary_products.py --datasets all`
- `python -B scripts/summary/decisive_falsification.py`
- `python -B scripts/summary/quantum_falsification.py`
- `cmd /c output\\summary\\build_materials.bat quick-nodocx`

結果：
- EHT：`output/eht/eht_kappa_error_budget.json` の `kappa_sigma_adopted_for_falsification` がモデル依存 floor を含む形へ更新。
- Bell：`output/quantum/bell/longterm_consistency.json` に横断統合（ratio/Δmedian(z)/freeze）が追加され、図も更新。
- `paper_lint` warnings=0 を確認し、`output/summary/pmodel_paper_part2_astrophysics.html` / `output/summary/pmodel_paper_part3_quantum.html` を更新した。

[work] 2026-02-02T13:24:18Z Phase 7 / Step 7.4.7.5: Giustina 2016 thesis（uTheses id=39955; Phaidra o:1331600）の公開状態（fulltext_locked）監視を追加。`scripts/quantum/fetch_giustina2016_utheses_39955.py` を実装して snapshot/manifest を固定し、probe 出力 `output/quantum/bell/giustina2016_utheses_probe.json` を生成（現状 fulltext_locked=1）。`doc/ROADMAP.md` に 7.4.7.5/7.4.7.6 を追記し、`doc/PRIMARY_SOURCES.md` / `doc/quantum/05_bell_public_datasets.md` に参照を固定。
[work] 2026-02-02T13:39:31Z Phase 7 / Step 7.4.7.6: Giustina 2015 click log（time-tag）の公開一次ソース探索を初版として実施。Zenodo/OSF/DataCite を機械検索する `scripts/quantum/search_giustina2015_clicklog_public_sources.py` を追加し、検索ログを `output/quantum/bell/giustina2015_clicklog_public_search.json` に固定（現時点で候補未発見→ブロック継続）。`doc/ROADMAP.md` の 7.4.7.6 を更新。
[work] 2026-02-02T14:26:04Z Phase 5 / Step 5.1: EHT κ誤差予算の放射モデル依存（thick disk; Vincent+2022）を明示化（ラベル更新）し、`doc/paper/11_part2_astrophysics.md` の 4.8（EHT）説明文に Vincent+2022 を明記。`scripts/eht/eht_kappa_error_budget.py` と `scripts/summary/decisive_falsification.py` を再実行して `output/eht/eht_kappa_error_budget.{json,png}` と `output/summary/decisive_falsification.{json,png}` を更新。
[work] 2026-02-02T14:26:04Z Phase 7 / Step 7.4.9: Bell 反証条件パック（selection sensitivity + delay signature + longterm consistency）を再生成し、fast-switching データ（Weihs1998 / NIST）で delay-z≥3 が成立することを固定出力で確認。`scripts/quantum/bell_primary_products.py` と `scripts/summary/quantum_falsification.py` を再実行して `output/quantum/bell/falsification_pack.{json,png}` / `output/quantum/bell/longterm_consistency.{json,png}` / `output/summary/quantum_falsification.json` を更新。
[work] 2026-02-02T15:15:36Z Phase 7 / Step 7.4.7.6: Giustina 2015 click log（time-tag）公開先探索の探索範囲を Crossref/OpenAlex/Figshare/Dataverse（Harvard）へ拡張し、検索ログ `output/quantum/bell/giustina2015_clicklog_public_search.json` を更新。既知の paper/arXiv ヒット（known_work_hits）と dataset候補（candidate_dataset_hits）を分離し、現時点で click log 候補は未発見（candidate_dataset_hits=0）としてブロック継続を固定。
[work] 2026-02-02T15:40:01Z Phase 7 / Step 7.4.7.5: Giustina 2016（uTheses id=39955; Phaidra o:1331600）の公開状態監視を `--refresh` で更新し、fulltext_locked=1（thesis_doc_pid=o:1331601 は非公開のまま）を再確認して probe を更新（`output/quantum/bell/giustina2016_utheses_probe.json`）。
[work] 2026-02-02T16:11:00Z Phase 7 / Step 7.4.7.6: Giustina 2015 click log（time-tag）公開先探索に DuckDuckGo HTML web search（piracyドメイン除外）を追加し、検索ログ `output/quantum/bell/giustina2015_clicklog_public_search.json` を更新。現時点では click log の候補は未発見（candidate_dataset_hits=0）としてブロック継続を固定。
[work] 2026-02-02T16:44:39Z Phase 7 / Step 7.4.7.5: Giustina 2016 thesis_doc_pid（Phaidra o:1331601）の metadata を追加で固定し、filename=`39955.pdf` と rights=`InC`、detail=404 / download=403（非公開）を機械的に確認できるようにした。`scripts/quantum/fetch_giustina2016_utheses_39955.py` を拡張して `phaidra_o1331601_metadata.json` をキャッシュし、probe/manifest/PRIMARY_SOURCES/ROADMAP/STATUS を更新。
[work] 2026-02-02T17:05:06Z Phase 7 / Step 7.4.7.6: Giustina 2015 click log（time-tag）公開先探索の web search を補強（Giustina 2016 thesis 由来のタイトル/URN/pid などの語を追加）し、検索ログ `output/quantum/bell/giustina2015_clicklog_public_search.json` を更新（candidate_dataset_hits=0 のまま）。
[work] 2026-02-05T02:45:01Z Phase 8 / Step 8.5: Part III（Bell）で Vienna 2015（Giustina et al. 2015）は raw time-tag 未公開のため解析対象外である旨を注記として1文で明記し、公開された場合は同一I/Fで追加可能とした。`doc/paper/30_references.md` に `Giustina2015PRL250401` を追加し、`output/summary/build_materials.bat quick-nodocx` で論文HTMLを再生成。
[work] 2026-02-05T03:09:56Z Phase 8 / Step 8.5: Part III（量子）5章（差分予測）を強化し、Bell の「棄却条件パック（operational falsification pack）」を Part II（EHT 5.1）と同型のフォーム（目的/入力/処理/式/指標/結果/考察/注意）で形式化した。Table 2 に Born則逸脱（自己重力拡張）の差分予測（χ, m_crit）を追加し、5.1 で R_sel と z_delay の定義・運用閾値（R_sel≥1, z_delay≥3）と cross-dataset 結果表を固定、5.2 で m_crit と MAQRO/OTIMA の到達度（χ）から必要精度（σ_phase/σ_V, N）の数値要件を表で固定した。`doc/paper/01_figures_index.md` に `output/quantum/bell/longterm_consistency.png` を追加し、`paper_lint --strict` warnings=0 を確認、`output/summary/build_materials.bat quick-nodocx` で `output/summary/pmodel_paper_part3_quantum.html` を更新。
[work] 2026-02-05T06:44:04Z Phase 4 / Step 4.3: 時間伸長（p_t）について「理論側の条件分岐（p_t=1 を要求する条件／未確定になる条件）」と「観測側の(1+z)埋め込み循環の監査」を、ロードマップの作業として明文化（4.3.1 を追加）し、Step 4.3 を「進行中（改訂）」へ更新した。次は Blondin+2008（spectral aging）を p_t 自由で再fitし、事前に t/(1+z) を作らない非循環 I/F を固定出力（json+png）として追加する。
[work] 2026-02-05T07:06:18Z Phase 4 / Step 4.3.1: Blondin+2008（arXiv:0804.3595）Table 3（aging rate）を一次PDFから抽出し、`g(z)=1/(1+z)^(p_t)`（p_t自由; zero-point固定）で再fitして `p_t≈0.967±0.104 (1σ; all)` を再現した。主fitは `t_rest=t_obs/(1+z)` を前処理として作らない形で固定し、audit（circularity_risk=low）を `output/cosmology/cosmology_sn_time_dilation_constraints_metrics.json` に追記した。出力：`output/cosmology/cosmology_sn_time_dilation_pt_fit.{json,png}`。更新：`scripts/cosmology/cosmology_sn_time_dilation_constraints.py`、`doc/ROADMAP.md`、`doc/STATUS.md`。
[work] 2026-02-05T09:29:53Z Phase 4 / Step 4.14: 宇宙論の最終判定フロー（p_t→条件A→独立ガードレール→BAO ε入口→DDR再接続→分岐）を `doc/ROADMAP.md` に追加し、Step 1〜6（ユーザー提示）を 4.14.1〜4.14.6 としてマッピングした。既存成果物により 4.14.1/4.14.3/4.14.5 を完了扱いにし、未完（4.14.2/4.14.4/4.14.6）と次アクションを明示した。併せて `doc/STATUS.md` と `doc/AI_CONTEXT_MIN.json` の現在地を 4.14.2 に更新した。
[work] 2026-02-05T09:57:18Z Phase 4 / Step 4.14.2/4.14.4: 条件A（自由伝播で dθ/dt 保存）を time dilation（p_t=1）の決定点として A案（伝播公理）で仕様凍結し、`doc/cosmology/TIME_DILATION_CONDITION_A.md` を追加。併せて BAO ε の入口（手続きノブ）感度を既存metricsから統合して台帳化（`output/cosmology/cosmology_bao_epsilon_entry_sensitivity_ledger.{json,png}`）し、ロードマップ上の 4.14.2/4.14.4 を完了（初版）へ更新した。更新：`doc/ROADMAP.md`、`doc/STATUS.md`、`doc/AI_CONTEXT_MIN.json`。
[work] 2026-02-05T10:18:13Z Phase 4 / Step 4.14.6: 宇宙論の最終判定フロー（4.14.1〜4.14.5）を合流し、分岐（進む/棄却/写像改訂）を固定出力として凍結した（初版）。`p_t` は 1 と整合、DDRは単独機構では整合困難だが最小パラメータ化では独立拘束内で max|z|<3 の解が存在（reconnection path は棄却されない）。一方で BAO ε は手続きノブで大きく動き得るため、決定的棄却に使う場合は ledger を併用する。出力：`output/cosmology/cosmology_final_branch_decision_metrics.json` / `output/cosmology/cosmology_final_branch_decision.png`。実装：`scripts/cosmology/cosmology_final_branch_decision.py`。更新：`doc/ROADMAP.md`、`doc/STATUS.md`、`doc/AI_CONTEXT_MIN.json`。
[work] 2026-02-05T10:28:37Z Phase 4 / Step 4.14.6: `scripts/cosmology/cosmology_final_branch_decision.py` へのリネーム追従として、`doc/WORK_HISTORY.md` の実装参照を統一し、`python -B scripts/summary/update_work_history_recent.py` を再実行して `doc/WORK_HISTORY_RECENT.md` を再生成した。併せて `python -B scripts/cosmology/cosmology_final_branch_decision.py` と `python -B scripts/cosmology/cosmology_bao_epsilon_entry_sensitivity_ledger.py` を再実行して出力を再確認した（ロジック変更なし）。
[work] 2026-02-05T10:39:25Z Phase 4 / Step 4.14: Step 4.14.6 が完了（初版）に到達していたため、`doc/ROADMAP.md` の Step 4.14 の現状を「完了（初版）」へ更新して整合を取った（内容・出力は変更なし）。併せて `doc/STATUS.md` と `doc/AI_CONTEXT_MIN.json` の最終更新UTCを更新した。
[work] 2026-02-05T12:33:54Z Phase 5 / Step 5.3: DDR（distance duality relation）について、FRWでの `D_L=(1+z)^2 D_A` 導出前提の棚卸し→P-modelで破れる前提の同定→`D_L^(P)`/`D_A^(P)` 導出→P-model DDR関係の確立→ε再解釈→Part I/II 反映、の作業パック（5.3.1〜5.3.7）を `doc/ROADMAP.md` に追加し、Step 5.3 を「進行中（改訂）」へ更新した。併せて `doc/STATUS.md` と `doc/AI_CONTEXT_MIN.json` の最終更新UTCを更新した。
[work] 2026-02-05T13:21:43Z Phase 5 / Step 5.3: DDR（distance duality relation）の改訂パック（5.3.1〜5.3.7）を初版として完了。FRW の `D_L=(1+z)^2 D_A` 導出前提を台帳化（`doc/cosmology/ddr_frw_assumptions_ledger.md`）し、P-model（空間膨張なし＋背景P赤方偏移＋p_t=1）で維持/破棄される前提を監査（`doc/cosmology/ddr_pmodel_assumption_audit.md`）した。そこから `D_A^(P)=D`, `D_L^(P)=(1+z)D` を導出し（`doc/cosmology/ddr_pmodel_distance_derivation.md`）、P-model最小の DDR は `D_L^(P)=(1+z)D_A^(P)`（η=1/(1+z), ε0=-1）と固定。既存の DDR 制約（例：Martinelli2021 の ε0=0.013±0.029）をこの関係で再解釈し、静的最小が約35σで棄却されることを `scripts/cosmology/cosmology_distance_duality_constraints.py` の固定出力として追加（`output/cosmology/cosmology_ddr_pmodel_relation.json` / `output/cosmology/cosmology_ddr_epsilon_reinterpretation.json`）。併せて Part I（2.5.3）と Part II（5.3）の本文へ反映し、FRW側の `(1+z)^2` が「フラックス減衰（光子エネルギー×到着率）＋空間膨張での `D_A=D_M/(1+z)`」の合成である点を明示した。
[work] 2026-02-06T03:03:43Z Phase 5 / Step 5.3: DDR の追補タスクとして、FRWの `(1+z)` 要因分解→P-modelで破れる公理(i)-(iii)の明示→P-model固有指標 `η^(P)=D_L/((1+z)D_A)` による再評価→Part I/II更新→反証条件の再定義、を 5.3.8〜5.3.14 として `doc/ROADMAP.md` に追記し、Step 5.3 を「進行中（追補）」へ更新した。併せて `doc/STATUS.md` と `doc/AI_CONTEXT_MIN.json` の現在地を Step 5.3（追補）へ更新した。
[work] 2026-02-06T03:41:45Z Phase 5 / Step 5.3.12-5.3.14: `scripts/cosmology/cosmology_distance_duality_constraints.py` の η^(P) 追補を修正（z_ref 未定義の NameError を解消）し、P-model固有指標 η^(P)=D_L/((1+z)D_A) による制約図と固定JSON、反証条件パックを生成（`output/cosmology/cosmology_ddr_pmodel_eta_constraints.{png,json}` / `output/cosmology/cosmology_ddr_pmodel_falsification_pack.json`）。併せて Part II 5.3節を「35σ棄却」から「距離推定I/Fの前提監査（ηとη^(P)）」へ位置づけ更新し、図と結果表を差し替えた。`doc/ROADMAP.md` の 5.3.8〜5.3.14 を完了（初版）へ更新。
[work] 2026-02-06T05:37:42Z Phase 5 / Step 5.3: DDR前提監査の追補2として、(1) 距離推定I/Fで「空間膨張(1+z)」が埋め込まれる箇所の特定チェックリスト、(2) η^(P) 指標での観測制約テーブル再整理、(3) 独立プローブ（p_t, β_T）の結論明文化、を 5.3.15〜5.3.17 として `doc/ROADMAP.md` に追加し、Step 5.3 を進行中へ戻した。
[work] 2026-02-06T06:06:46Z Phase 5 / Step 5.3.15-5.3.17: DDR前提監査（追補2）を初版として完了。距離推定I/Fで「空間膨張(1+z)」が埋め込まれる箇所を Yes/No で点検できる監査チェックリストを固定（`doc/cosmology/ddr_distance_estimation_if_audit_checklist.md`）。公表制約16件を η^(P) 指標へ写像した比較表を固定生成（`output/cosmology/cosmology_ddr_pmodel_eta_constraints_table.md`）し、生成スクリプトを更新（`scripts/cosmology/cosmology_distance_duality_constraints.py`）。併せて Part II 5.3 の結果表を16行へ拡張し、5.3.2 に独立プローブ（p_t, β_T）が P-model最小予測と整合する結論を明文化（`doc/paper/11_part2_astrophysics.md`）。`doc/ROADMAP.md` の Step 5.3（追補2含む）を完了（改訂）へ更新した。
[work] 2026-02-06T07:36:25Z Phase 8 / Step 8.2: Part II 5.3 の図が HTML で表示されない問題を修正。`output/summary/*.html` が `output/...`（repo-root相対）をそのまま `<img src>` に残しており、`output/summary/` 配下の HTML から参照するとパスが壊れる（例：`output/summary/output/...`）のが原因だった。`scripts/summary/paper_html.py` に src/href の repo-root 相対パス（output/doc/data/scripts）を out_dir からの相対パスへ自動変換する後処理を追加し、`paper_build` を再実行して HTML を再生成（paper/part2/part3/short_note）。Part II は DOCX も再生成し、5.3 の図（`cosmology_ddr_pmodel_eta_constraints.png` 等）が表示されることを確認した。
[work] 2026-02-06T07:59:56Z Phase 8 / Step 8.6: 論文の最終整合タスク（DDR監査表／Table 1整合／反証条件パック明文化／Discussion/Conclusion反映／弱場β整合確認／EHT精度要件集約／図表参照整合）を、ロードマップに Step 8.6（8.6.1〜8.6.8）として追加した。反映：`doc/ROADMAP.md`。
[work] 2026-02-06T08:44:07Z Phase 8 / Step 8.6: Step 8.6（論文の最終整合）を完了。Part II 5.3 に「距離推定I/F監査表（公表制約16件）」と η^(P) の反証条件パック要約（固定JSON）を追記し、DDRを「35σ棄却」ではなく「前提監査（どこに膨張側(1+z)が埋め込まれるか）」として固定した。Table 1（検証サマリ）を η^(P) 指標＋凍結β表記へ整合更新（`scripts/summary/paper_tables.py`）、総合スコアボード（`scripts/summary/validation_scoreboard.py`）のDDR説明も同枠組みへ更新。Discussion 6.2/6.3 と Conclusion 7章へ枠組み転換と精度要件（EHT: κ系統と4.63%差、ngEHT/space-VLBI）を反映。`paper_qc` / `paper_lint` を通過（errors/warnings=0）し、`paper_build` で `output/summary/pmodel_paper_part2_astrophysics.{html,docx}` と `output/summary/pmodel_paper.{html,docx}` を再生成した。
[work] 2026-02-06T09:11:58Z Phase 8 / Step 8.6: ROADMAP/STATUS/AI_CONTEXT の「次にやること」記述を整理し、完了済み（GW250114/SPARC等）を外して、保留中の GN-z11（Step 4.6）と Bell 追加一次データの公開監視（Step 7.4.7）へ焦点を合わせた（宣言セクションも整合）。
[work] 2026-02-06T10:00:49Z Phase 8 / Step 8.6: ユーザー提示の最終チェック項目（弱場β整合／EHT精度要件／図番号・引用・相互参照）を、既存の Step 8.6.5–8.6.7 と対応づけた上で、Part II の「完成宣言（GN-z11 を除く freeze）」を 8.6.9 としてロードマップへ明記した。
[work] 2026-02-06T10:11:15Z Phase 4 / Step 4.6 + Phase 7 / Step 7.4.7: 公開待ちのブロッカーを再確認（監視更新）。GN-z11（JWST/NIRSpec IFU; proposal_id=4528）は MAST 上で `t_obs_release_utc=2026-04-09T20:45:23.996448+00:00` のままで `is_released=false` を再確認（`scripts/cosmology/fetch_mast_jwst_spectra.py --targets GN-z11`）。Giustina 2016 thesis（uTheses 39955; Phaidra o:1331601）は `fulltext_locked=1` / download=403 のままで非公開を再確認（`scripts/quantum/fetch_giustina2016_utheses_39955.py --refresh`）。Giustina 2015 click log（time-tag）の公開一次ソース探索も再実行し、candidate_dataset_hits=0（未発見）を固定更新（`scripts/quantum/search_giustina2015_clicklog_public_sources.py`）。
[work] 2026-02-06T11:11:41Z Phase 8 / Step 8.2: Part II 5.3（DDR）の図に図番号が付かない問題を修正。publish の図番号付与は「figures_index 登録 + `output/...png` の code-snippet参照」で有効になるため、5.3 の2図を Markdown 画像から code-snippet 参照へ置換し、`doc/paper/01_figures_index.md` に `output/cosmology/cosmology_ddr_pmodel_eta_constraints.png` を登録した。`python -B scripts/summary/paper_build.py --profile part2_astrophysics --mode publish --outdir output\\summary` を再実行し、HTML/DOCXでキャプション（図番号）が出ることを確認（`output/summary/pmodel_paper_part2_astrophysics.{html,docx}`）。
[work] 2026-02-06T12:06:57Z Phase 7 / Step 7.13.16: Part III（核力）の追加作業として「核力＝近接場干渉（交差項）→2モード近似→反証条件」を仕様化するパック（7.13.16.1–7.13.16.7）をロードマップへ追加。意図は、既存の有効ポテンシャル側で使っている結合パラメータ J(R) を「モード重なり（近接場干渉）」として物理解釈し、range を P-model量（例：λ_C、局在幅）へ接続して設計・棄却可能性まで固定すること。反映：`doc/ROADMAP.md`。
[work] 2026-02-06T12:19:57Z Phase 7 / Step 7.13.16: 「核力＝近接場干渉（交差項）→2モード近似→結合条件→射程J(R)→結合スケール→選別→反証条件」を仕様ノートとして固定し、スケール指標図を生成して出力を凍結した。追加：`doc/quantum/20_nuclear_near_field_interference_two_mode_model.md`。実装：`scripts/quantum/nuclear_near_field_interference_two_mode_model.py`（CODATA deuteron B と PDG λ_π を読み、J_E(R)=J_E(R0)exp((R0−R)/L) の proxy を可視化）。出力：`output/quantum/nuclear_near_field_interference_two_mode_model.png` / `output/quantum/nuclear_near_field_interference_two_mode_model_metrics.json`。`doc/ROADMAP.md` の 7.13.16.1–7.13.16.7 を完了（初版）へ更新し、Step 7.13 を完了（改訂）へ戻した。
[work] 2026-02-06T13:00:13Z Phase 7 / Step 7.13.17: 核結合エネルギー（Δω写像）モデルの体系化タスク（最小仮定→2体→Δω→B.E.→deuteron/He-4→AME2020全域→差分予測→棄却条件）をロードマップへ追加（7.13.17.1–7.13.17.10）。Part I 継承と核力固有仮定を分離し、全域の系統検証（B.E./A、残差分布、magic/pairing 等）と 3σ 棄却の運用までを「同一I/F」で固定する計画を明文化。反映：`doc/ROADMAP.md`。
[work] 2026-02-06T13:14:00Z Phase 7 / Step 7.13.17.1: 核結合エネルギー（Δω→B.E.）写像に先立ち、最小仮定台帳を固定。Part I/III 継承（u=ln(P/P0), φ, dτ/dt, E=ħω, m=ħω0/c^2）と核スケール固有仮定（近接場干渉、2モード近似、near-field/位相平均化の操作的I/F、Out of Scope）を分離して文書化し、以後のΔω導出・核種横断検証で仮定追加が発生した場合の更新起点を作成。追加：`doc/quantum/21_nuclear_binding_energy_frequency_mapping_min_assumptions.md`。更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`。
[work] 2026-02-06T13:27:08Z Phase 7 / Step 7.13.17.2: deuteron（pn束縛）の2体問題として、束縛条件を境界条件（例：square well の k cot(kR)=−κ）で最小固定し、B.E.→Δω（Δω≡B/ħ）写像を出力として凍結。ノート：`doc/quantum/22_nuclear_binding_energy_frequency_mapping_deuteron_two_body.md`。実装：`scripts/quantum/nuclear_binding_energy_frequency_mapping_deuteron_two_body.py`。出力：`output/quantum/nuclear_binding_energy_frequency_mapping_deuteron_two_body.png` / `output/quantum/nuclear_binding_energy_frequency_mapping_deuteron_two_body_metrics.json`。更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`。
[work] 2026-02-06T14:56:09Z Phase 7 / Step 7.13.17.3: Δω→Δm→B.E. の写像（B=ħΔω, Δm=B/c^2）を c の冪まで含めて凍結し、幾何因子（例：x=kR）と量子数依存（l,s,j）の入口整理をノート化。light nuclei（A=2,3,4）の一次固定値から Δω_obs と Δm を再構成し、写像の sanity check を固定出力化。追加：`doc/quantum/23_nuclear_binding_energy_frequency_mapping_mass_defect_interface.md`。実装：`scripts/quantum/nuclear_binding_energy_frequency_mapping_interface.py`。出力：`output/quantum/nuclear_binding_energy_frequency_mapping_interface.png` / `output/quantum/nuclear_binding_energy_frequency_mapping_interface_metrics.json` / `output/quantum/nuclear_binding_energy_frequency_mapping_interface.csv`。更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`。
[work] 2026-02-06T15:25:20Z Phase 7 / Step 7.13.17.4: deuteron の数値検証（ERE cross-check）を初版として固定。np triplet 低エネルギー散乱（a_t,r_t）から束縛極 κ（k=iκ）を解き、B_pred=(ħc)^2 κ^2/(2 μ c^2) を再構成して B_obs（CODATA）と比較した。Eq.(18)（GWU/SAID）と Eq.(19)（Nijmegen）の差分を解析依存の系統 proxy（half-range）として保存し、B_obs が envelope（min–max）に入ることを固定。追加：`doc/quantum/24_nuclear_binding_energy_frequency_mapping_deuteron_verification.md`。実装：`scripts/quantum/nuclear_binding_energy_frequency_mapping_deuteron_verification.py`。出力：`output/quantum/nuclear_binding_energy_frequency_mapping_deuteron_verification.png` / `output/quantum/nuclear_binding_energy_frequency_mapping_deuteron_verification_metrics.json` / `output/quantum/nuclear_binding_energy_frequency_mapping_deuteron_verification.csv`。更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`。
[work] 2026-02-06T15:43:10Z Phase 7 / Step 7.13.17.5: He-4（α粒子）の検証拡張を初版として固定。deuteron の参照距離を tail スケール R_ref=1/κ_d として凍結し、αの charge rms 半径 r_rms から一様球等価半径 R_α=√(5/3) r_rms を構成。range は λ_π（Step 7.13.17.2 の固定）とし、J_E(R)=J_E(R_ref)exp((R_ref−R)/L)（J_E(R_ref)=B_d/2）で結合スケールを接続した。多体系 reduction は baseline を collective（C=A−1）として凍結し、pn_only（C=Z·N）/pairwise_all（C=A(A−1)/2）は系統 envelope として保存。追加：`doc/quantum/25_nuclear_binding_energy_frequency_mapping_alpha_verification.md`。実装：`scripts/quantum/nuclear_binding_energy_frequency_mapping_alpha_verification.py`。出力：`output/quantum/nuclear_binding_energy_frequency_mapping_alpha_verification.png` / `output/quantum/nuclear_binding_energy_frequency_mapping_alpha_verification_metrics.json` / `output/quantum/nuclear_binding_energy_frequency_mapping_alpha_verification.csv`。更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`。
[work] 2026-02-07T00:17:39Z Phase 7 / Step 7.13.17.6: 代表核種（A=2,4,12,16）で A依存の予備診断を初版として固定。AME2020（B/A）と IAEA charge radii（r_rms）から d/α/C-12/O-16 を抽出し、凍結I/F（R_ref=1/κ_d, L=λ_π, R=√(5/3) r_rms, J_E(R)=J_ref exp((R_ref−R)/L, J_ref=B_d/2), B_pred=2 C J_E(R)）を機械適用して C 感度（C=A−1, Z·N, A(A−1)/2）と C_required=B_obs/(2J_E(R)) の傾向を台帳化した。追加：`doc/quantum/26_nuclear_binding_energy_frequency_mapping_representative_nuclei.md`。実装：`scripts/quantum/nuclear_binding_energy_frequency_mapping_representative_nuclei.py`。出力：`output/quantum/nuclear_binding_energy_frequency_mapping_representative_nuclei.png` / `output/quantum/nuclear_binding_energy_frequency_mapping_representative_nuclei_metrics.json` / `output/quantum/nuclear_binding_energy_frequency_mapping_representative_nuclei.csv`。更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`。
[work] 2026-02-07T00:32:00Z Phase 7 / Step 7.13.17.7: AME2020（全核種）へ凍結I/F（R_ref=1/κ_d, J_ref=B_d/2, L=λ_π, J_E(R)=J_ref exp((R_ref−R)/L), B_pred=2 C J_E）を機械適用し、残差分布（B_pred/B_obs）と偶奇・魔法数フラグでの系統差を固定出力化した。r_rms 測定値がある核種は R=√(5/3) r_rms を採用し、測定が無い核種は fallback として R=r0·A^(1/3) を採用（r0 は measured radii（A>=4）由来の median として凍結；metrics に p10/p90 も保存）。baseline の C は collective（C=A−1）に固定し、診断として pn_only（C=Z·N）/pairwise_all（C=A(A−1)/2）も保存した（本Stepで一致を主張しない）。追加：`doc/quantum/27_nuclear_binding_energy_frequency_mapping_ame2020_all_nuclei.md`。実装：`scripts/quantum/nuclear_binding_energy_frequency_mapping_ame2020_all_nuclei.py`。出力：`output/quantum/nuclear_binding_energy_frequency_mapping_ame2020_all_nuclei.png` / `output/quantum/nuclear_binding_energy_frequency_mapping_ame2020_all_nuclei_metrics.json` / `output/quantum/nuclear_binding_energy_frequency_mapping_ame2020_all_nuclei.csv`。更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`。
[work] 2026-02-07T00:47:55Z Phase 7 / Step 7.13.17.8: Step 7.13.17.7 の残差（B_pred/B_obs）を数式（I/F）から物理語へ翻訳し、主不足（A依存の幾何/range proxy）と二次項（shell/pairing）を分離した。診断量として `ν_eff_required≡B_obs/(J_E·A)=2C_required/A` を定義し、凍結CSVから再構成して A とともに大きく増える（例：A=100 の中央値≈20.4、A=200 の中央値≈52.7）ことを固定出力化した。これにより、現行I/Fでは「核半径 R を指数減衰距離として入れたこと」が mismatch の主因候補であり、偶奇/魔法数は残差上の二次構造として扱うのが自然であることを明確化した。追加：`doc/quantum/28_nuclear_binding_energy_frequency_mapping_physical_interpretation.md`。実装：`scripts/quantum/nuclear_binding_energy_frequency_mapping_physical_interpretation.py`。出力：`output/quantum/nuclear_binding_energy_frequency_mapping_physical_interpretation.png` / `output/quantum/nuclear_binding_energy_frequency_mapping_physical_interpretation_metrics.json`。更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`。
[work] 2026-02-07T00:59:53Z Phase 7 / Step 7.13.17.9: Step 7.13.17.7 の凍結I/F（anchor/range/C）を維持したまま、指数減衰に入れる「距離」だけを差し替えた差分予測を固定した。global proxy（x=核半径 R）では B_pred/B_obs が A とともに単調に小さくなり、median≈0.064 の大域的過小予測となる一方、local spacing proxy（x=d=ρ^(−1/3)=(4π/3)^(1/3)·r0, r0=R/A^(1/3)）では A-trend が大きく緩和し、median≈1.43 の O(1) 残差帯へ圧縮されることを凍結出力として確認した。これにより、支配的な不足は pairing/shell ではなく「距離I/Fの解釈」にある、という差分仮説を *fit無し* で固定できた。追加：`doc/quantum/29_nuclear_binding_energy_frequency_mapping_differential_predictions.md`。実装：`scripts/quantum/nuclear_binding_energy_frequency_mapping_differential_predictions.py`。出力：`output/quantum/nuclear_binding_energy_frequency_mapping_differential_predictions.png` / `output/quantum/nuclear_binding_energy_frequency_mapping_differential_predictions_metrics.json` / `output/quantum/nuclear_binding_energy_frequency_mapping_differential_predictions.csv`。更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`。
[work] 2026-02-07T01:14:26Z Phase 7 / Step 7.13.17.10: Δω→B.E. 写像I/Fに対して、3σ運用の反証条件パック（falsification pack）を固定。閾値（abs(z_median)≤3, abs(z_Δmedian)≤3; A-bin固定）を JSON に凍結し、global（x=R）/ local（x=d）を同一指標で pass/fail 判定できる形にした。重要な注意として σ_proxy は実験誤差ではなく内部散らばり指標であることを明文化。追加：`doc/quantum/30_nuclear_binding_energy_frequency_mapping_falsification_pack.md`。実装：`scripts/quantum/nuclear_binding_energy_frequency_mapping_falsification_pack.py`。出力：`output/quantum/nuclear_binding_energy_frequency_mapping_falsification_pack.png` / `output/quantum/nuclear_binding_energy_frequency_mapping_falsification_pack.json` / `output/quantum/nuclear_binding_energy_frequency_mapping_falsification_table.csv`。更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`。
[work] 2026-02-07T01:36:25Z Phase 7 / Step 7.13.18: Step 7.13.17.10 の閾値（3σ運用）を変更せず、最小追加物理として “局所近傍の飽和” を導入して pass/fail がどう動くかを固定。距離I/Fは local spacing d を維持し、結合数指標を `ν_eff=min(ν_base,ν_sat)`（`ν_base=2(A−1)/A`, `ν_sat=1.5` 凍結）で飽和させた結果、baseline（dのみ）では fail していた中央値指標が 3σ内へ入り、z_median/z_Δmedian がともに pass となることを固定出力で確認。追加：`doc/quantum/31_nuclear_binding_energy_frequency_mapping_minimal_additional_physics.md`。実装：`scripts/quantum/nuclear_binding_energy_frequency_mapping_minimal_additional_physics.py`。出力：`output/quantum/nuclear_binding_energy_frequency_mapping_minimal_additional_physics.png` / `output/quantum/nuclear_binding_energy_frequency_mapping_minimal_additional_physics_metrics.json` / `output/quantum/nuclear_binding_energy_frequency_mapping_minimal_additional_physics.csv`。更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`。
[work] 2026-02-07T05:17:44Z Phase 7 / Step 7.13: Step 7.13（強い相互作用/核力）について 7.13.1–7.13.18 の完了（初版）を確認し、ロードマップの Step 7.13 現状を「進行中→完了（初版）」へ更新した。併せて `doc/AI_CONTEXT_MIN.json` の現在地を Phase 4 / Step 4.6（GN-z11 公開待ち）へ合わせ、`next` から完了済み Step 7.15 を除去して整合させた。更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`。
[work] 2026-02-07T06:37:51Z Phase 8 / Step 8.2: 「Part IIIに作業結果が反映されていない」疑義を再検証し、`4.2.7.2 Δω→B.E.写像の最小追加物理（Step 7.13.18）` が原稿（`doc/paper/12_part3_quantum.md`）・publish HTML（`output/summary/pmodel_paper_part3_quantum.html`）・publish DOCX（`output/summary/pmodel_paper_part3_quantum.docx`）の3点に存在することを確認した。再現性確保のため `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary` を再実行し、`paper_lint` errors=0 / warnings=0 で再生成が通ることを固定。`docx` は展開XML（`word/document.xml`）で Step 7.13.18 文言を直接検出して反映済みを確認した。更新：`doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`。
[work] 2026-02-07T06:49:12Z Phase 8 / 運用整理: `doc/ROADMAP.md` と `doc/STATUS.md` を再編し、公開待ち案件（Step 4.6 / Step 7.4.7 / Step 4.13）の優先度を下げて「保留項目（ユーザー指示時に実施）」へ移動した。現在地は公開待ち非依存の Phase 7 優先に更新し、運用方針を「ユーザー指示時に保留項目を再開」に統一した。更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`。
[work] 2026-02-07T07:02:33Z Phase 7 / Step 7.13.17: ユーザー指定の核力ロードマップ（13ステップ）を既存 7.13.17 に統合し、重複項目は目的/作業つきで改訂、欠落項目は新規追加した。Step 1–10 は既存 7.13.17.1–10 を改訂、Step 13 は既存の反証条件パック（旧 7.13.17.10）を 7.13.17.13 として再整理、Step 11（既存理論との差異抽出）と Step 12（差分予測の定量化）を準備中として追加。併せて Step 7.13 の現状を「完了→進行中（改訂）」へ更新し、`doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json` を整合させた。更新：`doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`。
[work] 2026-02-07T07:27:28Z Phase 7 / Step 7.13.17.11-.12: 既存理論との差異抽出と差分予測の定量化を完了。`scripts/quantum/nuclear_binding_energy_frequency_mapping_theory_diff.py` を追加して P-model（local spacing + ν飽和）と標準理論proxy（湯川距離proxy / SEMF固定係数）を同一AME2020で比較し、`output/quantum/nuclear_binding_energy_frequency_mapping_theory_diff.{png,csv,metrics.json}` を固定。続けて `scripts/quantum/nuclear_binding_energy_frequency_mapping_differential_quantification.py` を追加し、`ΔB` と `σ_req=abs(ΔB)/3` を核種別に算出して `output/quantum/nuclear_binding_energy_frequency_mapping_differential_quantification.{png,csv,metrics.json}` と `..._top20.csv` を固定した。文書は `doc/quantum/32_nuclear_binding_energy_frequency_mapping_theory_diff.md` / `doc/quantum/33_nuclear_binding_energy_frequency_mapping_differential_quantification.md` を新規追加、`doc/paper/12_part3_quantum.md` に 4.2.7.3 を追記、`doc/paper/01_figures_index.md` に新図を登録。`python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary` を再実行し、`paper_lint` errors=0/warnings=0 で `output/summary/pmodel_paper_part3_quantum.{html,docx}` を更新。併せて `doc/ROADMAP.md` / `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json` を同期更新。
[work] 2026-02-07T07:48:23Z Phase 7 / Step 7.13.17.13（改訂）: 反証条件パックへ Step 7.13.17.11/.12 の差分チャネル（P-SEMF / P-Yukawa）を統合。`scripts/quantum/nuclear_binding_energy_frequency_mapping_falsification_pack.py` を更新し、`differential_channels`（median abs(ΔB), median σ_req,rel）と条件 `σ_rel(total)<=σ_req,rel` を JSON/図へ追加（図は3面化: z_median, z_Δmedian, channel precision demand）。`scripts/summary/paper_tables.py` も更新し、量子Table 1（原子核行）にチャネル要約を反映。文書は `doc/quantum/30_nuclear_binding_energy_frequency_mapping_falsification_pack.md` と `doc/paper/12_part3_quantum.md`（4.2.7.3）を更新。再生成: `python -B scripts/quantum/nuclear_binding_energy_frequency_mapping_falsification_pack.py` / `python -B scripts/summary/paper_tables.py` / `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary`。結果: `output/quantum/nuclear_binding_energy_frequency_mapping_falsification_pack.{png,json}`、`output/summary/paper_table1_quantum_results.{json,md}`、`output/summary/pmodel_paper_part3_quantum.{html,docx}` を更新、`paper_lint` errors=0/warnings=0。
[work] 2026-02-07T08:08:52Z Phase 7 / Step 7.13.17.14: 反証条件パックへ独立cross-check（Step 7.13.15.9 の分離エネルギー指標、Step 7.13.15.49 の電荷半径kink strict）を統合。scripts/quantum/nuclear_binding_energy_frequency_mapping_falsification_pack.py に independent_cross_checks / gate_status / channel_gate_requires_independent_crosschecks を追加し、4面図（z_median, z_Δmedian, channel precision demand, radii+separation cross-check）へ更新。doc/paper/12_part3_quantum.md に 5.3 を追記、doc/quantum/30_nuclear_binding_energy_frequency_mapping_falsification_pack.md と doc/ROADMAP.md/doc/STATUS.md/doc/AI_CONTEXT_MIN.json を同期更新。再生成：python -B scripts/quantum/nuclear_binding_energy_frequency_mapping_falsification_pack.py、python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary。
[work] 2026-02-07T08:27:36Z Phase 8 / Step 8.2: Part III 反映確認の最終化として、doc/paper/01_figures_index.md に output/quantum/nuclear_binding_energy_frequency_mapping_falsification_pack.png を登録し、python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary を再実行。paper_lint は errors=0 / warnings=0 で、output/summary/pmodel_paper_part3_quantum.{html,docx} 更新を確認。doc/STATUS.md と doc/AI_CONTEXT_MIN.json を同期更新。
[work] 2026-02-07T08:27:36Z Phase 8 / Step 8.2: doc/ROADMAP.md の最終更新UTCと『直近完了』を同期し、Part III反映最終化（figures index登録＋paper_lint warnings=0）を現在地宣言へ反映。
[work] 2026-02-07T08:42:41Z Phase 7 / Step 7.13.19: ユーザー指定の『波動干渉理論』ロードマップ（16ステップ）を 7.13 系へ統合追加。doc/ROADMAP.md に 7.13.19.1–7.13.19.16 を新設し、重複箇所は 7.13.17/7.13.18 参照として整理、現在地の次作業を 7.13.19.1（Part I 2.7 追加）へ更新。doc/STATUS.md と doc/AI_CONTEXT_MIN.json も同期更新。
[work] 2026-02-07T08:42:41Z Phase 7 / Step 7.13.19: doc/ROADMAP.md の最終更新UTCを 2026-02-07T08:42:41Z に同期（表紙時刻と STATUS/AI_CONTEXT を整合）。
[work] 2026-02-07T09:08:18Z Phase 7 / Step 7.13.19.1: Part I（doc/paper/10_manuscript.md）に 2.7 核力（近接場での波動干渉）を追加し、最小仮定（r≫λ_c 位相平均化 / r≲λ_c 位相干渉, Ψ_total=Ψ1+Ψ2, Out of Scope: Coulomb/スピン/多体詳細）を固定。既存見出しを 2.8 回転 / 2.9 量子へ繰下げ、python -B scripts/summary/paper_lint.py で errors=0/warnings=0 を確認。併せて doc/ROADMAP.md の 7.13.19.1 を完了（初版）へ更新し、次を 7.13.19.2 に変更。doc/STATUS.md / doc/AI_CONTEXT_MIN.json を同期更新。
[work] 2026-02-07T09:15:11Z Phase 7 / Step 7.13.19.2: Part I 2.7（doc/paper/10_manuscript.md）へ共鳴条件を追記。動径方程式（u_l=rR_l）、s波の境界条件 k cot(kR)=-kappa、周波数差 Delta_omega=(E_free-E_bound)/hbar（E_free=0 で Delta_omega=E_B/hbar）を明示し、ω_bound の数値導出方針を固定。doc/ROADMAP.md で 7.13.19.2 を完了（初版）へ更新し、次を 7.13.19.3 に変更。python -B scripts/summary/paper_lint.py は errors=0, warnings=0。doc/STATUS.md / doc/AI_CONTEXT_MIN.json を同期更新。
[work] 2026-02-07T09:23:08Z Phase 7 / Step 7.13.19.3: Part I 2.7（doc/paper/10_manuscript.md）へ質量欠損写像を追記。B.E.=hbar*Delta_omega、Delta_m=hbar*Delta_omega/c^2=B.E./c^2、Delta_m/m=Delta_omega/omega_free を明示し、幾何因子 F_geom(R/lambda_c,n,l)*C_coh を定義。doc/ROADMAP.md で 7.13.19.3 を完了（初版）へ更新し、次を 7.13.19.4 に変更。python -B scripts/summary/paper_lint.py は errors=0, warnings=0。doc/STATUS.md / doc/AI_CONTEXT_MIN.json を同期更新。
[work] 2026-02-07T09:32:05Z Phase 7 / Step 7.13.19.4: Part III の原子核節を再構造化。doc/paper/12_part3_quantum.md で 4.2.7 見出しを「原子核（総論）」へ改め、既存 4.2.7.1–4.2.7.3（有効モデル検証）を維持したまま、新規 4.2.7.4（波動干渉理論の検証; Part I 2.7 接続）を追加。運用I/F層と解釈層を分離した構成を固定し、次段の重陽子/He-4/軽核系統（7.13.19.5-.7）への入口を明示。python -B scripts/summary/paper_lint.py は errors=0, warnings=0。doc/ROADMAP.md / doc/STATUS.md / doc/AI_CONTEXT_MIN.json を同期更新。
[work] 2026-02-07T09:40:17Z Phase 7 / Step 7.13.19.5: Part III `4.2.7.4` を重陽子検証セクションとして実装。doc/paper/12_part3_quantum.md に ERE束縛極の式、eq18/eq19 の実数値表（a_t,r_t,kappa,B.E._pred,Delta_B,相対誤差）、包絡判定（envelope pass）と系統proxy（half-range）を追記し、図 `output/quantum/nuclear_binding_energy_frequency_mapping_deuteron_verification.png` と `...deuteron_two_body.png` の解説を追加。doc/ROADMAP.md で 7.13.19.5 を完了（初版）へ更新し、次を 7.13.19.6 に変更。python -B scripts/summary/paper_lint.py は errors=0, warnings=0。doc/STATUS.md / doc/AI_CONTEXT_MIN.json を同期更新。
[work] 2026-02-07T10:34:24Z Phase 7 / Step 7.13.19.6: Part III に He-4 検証を追加。doc/paper/12_part3_quantum.md へ新規 `4.2.7.5` を実装し、凍結I/F（R_ref=1/kappa_d, L=lambda_pi, J_ref=B_d/2）で He-4 の多体縮約（collective/pn_only/pairwise_all）を比較。`B.E._pred`、`B.E./A`、`C_required`、残差（Delta_B）を表で固定し、`output/quantum/nuclear_binding_energy_frequency_mapping_alpha_verification.png` の図解を追記。判定は pair-wise 過大・collective 最小差分。doc/ROADMAP.md で 7.13.19.6 を完了（初版）へ更新し、次を 7.13.19.7 に変更。python -B scripts/summary/paper_lint.py は errors=0, warnings=0。doc/STATUS.md / doc/AI_CONTEXT_MIN.json を同期更新。
[work] 2026-02-07T10:54:44Z Phase 7 / Step 7.13.19.7: Part III に軽核系統性を追加。doc/paper/12_part3_quantum.md へ新規 `4.2.7.6` を実装し、`output/quantum/nuclear_binding_light_nuclei.csv` から A=2,3,4 の観測 `B.E./A` を固定、`output/quantum/nuclear_binding_energy_frequency_mapping_representative_nuclei_metrics.json` から collective 予測の残差A依存（A=2,4,12,16; ratio/log10 ratio/Delta_B）を表で固定。図 `...nuclear_binding_light_nuclei.png` と `...nuclear_binding_energy_frequency_mapping_representative_nuclei.png` の解説を追記し、軽核域での符号反転トレンド（A=4 で過大、A>=12 で過小）を明示。doc/ROADMAP.md で 7.13.19.7 を完了（初版）へ更新し、次を 7.13.19.8 に変更。python -B scripts/summary/paper_lint.py は errors=0, warnings=0。doc/STATUS.md / doc/AI_CONTEXT_MIN.json を同期更新。
[work] 2026-02-07T12:12:54Z Phase 7 / Step 7.13.19.8: Part III に差分予測セクション `5.4` を新設。`output/quantum/nuclear_binding_energy_frequency_mapping_differential_quantification_metrics.json` と `..._top20.csv` の凍結値を用いて、差分チャネル（P-SEMF/P-Yukawa）の全核種統計、A帯別統計、top核種（P-SEMF rank1-5）を本文表へ固定し、`ΔB`・`σ_req=abs(ΔB)/3`・`σ_req,rel` を5章I/Fに接続。`python -B scripts/summary/paper_lint.py` は errors=0, warnings=0。`doc/ROADMAP.md` を 7.13.19.8 完了へ更新し、次を 7.13.19.9 に切替。`doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json` を同期更新。
[work] 2026-02-07T12:56:25Z Phase 7 / Step 7.13.19.9: Part III `5.4` 末に反証条件パックを追加。`output/quantum/nuclear_binding_energy_frequency_mapping_falsification_pack.json` を基準に、3σ運用ゲート（abs(z_median)<=3, abs(z_Δmedian)<=3）、核種カテゴリ閾値（light/mid/heavy の median σ_req,rel）、独立cross-check（分離エネルギーRMS、半径kink baseline vs pairing凍結）を本文表として固定し、差分予測I/Fを5章内で運用判定へ接続。`python -B scripts/summary/paper_lint.py` は errors=0, warnings=0。`doc/ROADMAP.md` を 7.13.19.9 完了へ更新し、次を 7.13.19.10 に切替。`doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json` を同期更新。
[work] 2026-02-07T13:04:32Z Phase 7 / Step 7.13.19.10: Part III `4.2.7` 冒頭に有効モデルI/Fと波動干渉理論の接続段落を追加。操作的I/F（有効モデル）と第一原理解釈（波動干渉）を同一観測I/Fで比較する規則を明記し、一致領域（deuteron/He-4・軽核入口）と乖離判定領域（5.4 の `ΔB`,`σ_req`）を固定。評価導線 `4.2.7.2 -> 4.2.7.4-4.2.7.6 -> 5.4` を本文で明示。`python -B scripts/summary/paper_lint.py` は errors=0, warnings=0。`doc/ROADMAP.md` を 7.13.19.10 完了へ更新し、次を 7.13.19.11 に切替。`doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json` を同期更新。
[work] 2026-02-07T13:19:39Z Phase 7 / Step 7.13.19.11: 量子Table 1 の核力行を『原子核（波動干渉＋deuteron+np散乱）』へ統合更新。scripts/summary/paper_tables.py で topic/observable/data/pmodel を波動干渉写像（B=ħΔω, Δm/m=Δω/ω）に接続し、AME2020（全核種）要約・deuteron写像・反証パック（global-R/local-spacing の z 指標）を metric に集約。併せて eq18/eq19 は残差中心の短縮表記へ整理。再生成: python -B scripts/summary/paper_tables.py。検証: python -B scripts/summary/paper_lint.py（errors=0,warnings=0）。
[work] 2026-02-07T13:33:28Z Phase 7 / Step 7.13.19.12: 図表準備（概念図/準位図/全核種曲線/残差監査/差分予測）を完了。scripts/quantum/nuclear_near_field_interference_two_mode_model.py、scripts/quantum/nuclear_binding_energy_frequency_mapping_deuteron_two_body.py、scripts/quantum/nuclear_binding_energy_frequency_mapping_ame2020_all_nuclei.py、scripts/quantum/nuclear_binding_energy_frequency_mapping_differential_predictions.py、scripts/quantum/nuclear_binding_energy_frequency_mapping_differential_quantification.py を再実行し、Part III に 4.2.7.7（図A–Eパック）を追加。doc/paper/01_figures_index.md に図A–Eを登録し、python -B scripts/summary/paper_lint.py で errors=0/warnings=0 を確認。
[work] 2026-02-07T13:45:18Z Phase 7 / Step 7.13.19.13: Part III Discussion を強化。doc/paper/12_part3_quantum.md の 6章に 6.1 波動干渉理論の位置づけ を追加し、(1) グルーオン交換との対応は操作的同値であり置換主張ではない点、(2) Coulomb/スピン/高次多体はコア写像外の系統として独立cross-checkで監査する点、(3) 3σ運用式 σ_rel(total)<=σ_req,rel と σ_req,rel=abs(ΔB)/(3B_obs) を明記して将来精度要件を固定。検証：python -B scripts/summary/paper_lint.py（errors=0, warnings=0）。更新：doc/ROADMAP.md（7.13.19.13 完了、次=7.13.19.14）/ doc/STATUS.md / doc/AI_CONTEXT_MIN.json。
[work] 2026-02-07T13:51:22Z Phase 7 / Step 7.13.19.14: Part III の Conclusion（7章）を更新し、核力の波動干渉解釈を『QCD置換ではなく同一I/Fでの反証運用』として明記。重力（遠距離場）/核力（近接場）のスケール分岐（r≫λ_c / r≲λ_c）と 3σ運用ゲート（σ_rel(total)<=σ_req,rel）を結論へ固定した。検証：python -B scripts/summary/paper_lint.py（errors=0, warnings=0）。更新：doc/paper/12_part3_quantum.md / doc/ROADMAP.md。
[work] 2026-02-07T13:57:20Z Phase 7 / Step 7.13.19.15: 参考文献・付録の核データ出典整備を完了。doc/paper/20_data_sources.md に AME2020/ENSDF/IAEA NDS/NuDat 3.0 の一次出典節を追加し、doc/paper/30_references.md に同出典の参考文献を追記した。doc/ROADMAP.md で 7.13.19.15 を完了（初版）へ更新し、次を 7.13.19.16（全体整合性チェック）へ切替。検証：python -B scripts/summary/paper_lint.py（errors=0, warnings=0）。更新：doc/STATUS.md / doc/AI_CONTEXT_MIN.json。
[work] 2026-02-07T14:01:36Z Phase 7 / Step 7.13.19.16: 波動干渉理論統合の全体整合性チェックを完了。Part III の番号・図表・用語・内部参照を点検し、4.2.7.X/Y/Z のプレースホルダ残りが無いことを確認。検証：python -B scripts/summary/paper_qc.py（ok=True）および python -B scripts/summary/paper_lint.py（errors=0, warnings=0）。doc/ROADMAP.md で 7.13.19 を完了（改訂）へ更新し、次を Phase 8 / Step 8.2（ユーザー指示時のPart III publish反映）へ切替。更新：doc/STATUS.md / doc/AI_CONTEXT_MIN.json。
[work] 2026-02-07T14:18:21Z Phase 8 / Step 8.2: Part III publish 反映を再実行。doc/paper/12_part3_quantum.md の数式 \\le を \\leq へ修正して paper_build の数式描画エラーを解消し、doc/paper/01_figures_index.md に未登録だった核力図3件（deuteron_verification / alpha_verification / representative_nuclei）を追加。python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary を再実行して output/summary/pmodel_paper_part3_quantum.html / .docx を更新。python -B scripts/summary/paper_lint.py --manuscript doc/paper/12_part3_quantum.md --references doc/paper/30_references.md --figures-index doc/paper/01_figures_index.md は errors=0, warnings=0。doc/ROADMAP.md / doc/STATUS.md / doc/AI_CONTEXT_MIN.json を同期更新。
[work] 2026-02-07T14:29:13Z Phase 8 / Step 8.2: ユーザー指示により Part III 論文を再生成。python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary を実行し、output/summary/pmodel_paper_part3_quantum.html / output/summary/pmodel_paper_part3_quantum.docx を更新。paper_lint 結果は errors=0, warnings=0。doc/STATUS.md と doc/AI_CONTEXT_MIN.json を同期更新。
[work] 2026-02-07T14:53:38Z Phase 7 / Step 7.16: ユーザー指定の追加ロードマップ（核物理検証6件、Bell完全検証4件、量子干渉4件、独立cross-check3件、誤差解析3件）を Phase 7 配下へ統合。AGENTS 規約（新規Phase追加禁止）に従い、Step 7.16 として 7.16.1〜7.16.20 を新設し、ユーザー提示の『Phase 1〜5』はサブトラックとして再番号化した。doc/ROADMAP.md の現在地宣言を更新し、次作業を 7.16.1（最小仮定の文書化）へ設定。併せて doc/STATUS.md / doc/AI_CONTEXT_MIN.json を同期更新。
[work] 2026-02-07T15:03:49Z Phase 7 / Step 7.16.1: 全核種系統解析（AME2020完全版）を再実行して固定出力を更新。`python -B scripts/quantum/nuclear_binding_energy_frequency_mapping_ame2020_all_nuclei.py` を実行し、`output/quantum/nuclear_binding_energy_frequency_mapping_ame2020_all_nuclei.csv` / `..._a_band_stats.csv` / `..._zn_residual_map.png` / `..._metrics.json` を再生成。metricsで `extended_step=7.16.1`、`collective_ratio_all.n=3554`、`outlier_abs_z_gt3_n=80` を確認し、`doc/ROADMAP.md`（7.16.1 完了・次 7.16.2）/ `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json` を同期更新した。
[work] 2026-02-07T15:12:27Z Phase 7 / Step 7.16.2: 魔法数での殻閉殻効果（S_2n/S_2p kink）を初版完了として固定。新規 `scripts/quantum/nuclear_magic_shell_closure_kink_analysis.py` を追加し、既存固定出力（`nuclear_binding_energy_frequency_mapping_ame2020_all_nuclei.csv` と `nuclear_binding_energy_frequency_mapping_differential_quantification.csv`）から `S_2n/S_2p` と `gap_2n/gap_2p` を算出、magic N/Z={2,8,20,28,50,82,126} の統計を集約した。代表4核種（O-16/Ca-40/Sn-132/Pb-208）の詳細比較と shell-proxy（SEMF）との差分も同時に固定し、`output/quantum/nuclear_magic_shell_closure_kink_summary.csv` / `..._representative4.csv` / `..._kink_quantification.png` / `..._kink_metrics.json` を生成。`doc/ROADMAP.md` で 7.16.2 を完了（初版）へ更新し、次を 7.16.3（pairing系統組み込み）へ遷移。`doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json` を同期更新。
[work] 2026-02-07T15:22:36Z Phase 7 / Step 7.16.3: pairing効果の系統的組み込みを完了（初版）。新規 scripts/quantum/nuclear_pairing_effect_systematics_analysis.py を追加し、AME2020全核種CSV（output/quantum/nuclear_binding_energy_frequency_mapping_ame2020_all_nuclei.csv）から3点公式 Delta_n/Delta_p を算出。A中央値中心化残差で k_n/k_p を凍結して補正前後残差（全体/偶奇/magic）を固定し、output/quantum/nuclear_pairing_effect_systematics_per_nucleus.csv / ..._summary.csv / ..._quantification.png / ..._metrics.json を生成。固定値: n_nuclei=3556, n_with_delta_n=3320, n_with_delta_p=3201, n_fit_rows=3191, k_n=-1.478, k_p=1.794。doc/ROADMAP.md（7.16.3完了・次7.16.4）/ doc/STATUS.md / doc/AI_CONTEXT_MIN.json を同期更新。
[work] 2026-02-07T15:36:28Z Phase 7 / Step 7.16.5: 核半径との整合性検証を完了（初版）。新規 scripts/quantum/nuclear_charge_radius_consistency_analysis.py を追加し、IAEA charge radii（data/quantum/sources/iaea_charge_radii/charge_radii.csv）と AME2020 全核種固定出力（output/quantum/nuclear_binding_energy_frequency_mapping_ame2020_all_nuclei.csv）を (Z,A) で統合。r_ch fit（A^(1/3), A^(1/3)+I）、J_E(R) 自己無矛盾性（stored vs radius再計算）、中性子スキン proxy（max(0,-rI*I)）を同一I/Fで固定し、output/quantum/nuclear_charge_radius_consistency_full.csv / ..._a_band_summary.csv / ..._neutron_skin_proxy.csv / ...png / ...metrics.json を生成。固定値: n_joined_rows=955, r0(A^(1/3))=0.9527 fm, r0(A^(1/3)+I)=1.0035 fm, rI=-1.7458 fm。doc/ROADMAP.md（7.16.5 完了、次=7.16.6）/ doc/STATUS.md / doc/AI_CONTEXT_MIN.json を同期更新。
[work] 2026-02-07T23:27:30Z Phase 7 / Step 7.16.6: 励起準位予測I/Fを完了（初版）。scripts/quantum/nuclear_excitation_level_prediction_analysis.py の回帰保存ロジック不具合（continue配下の未実行コード）を修正し、NuDat/ENSDF抽出（e2plus/e4plus/e3minus, r42）と AME2020 全核種固定I/Fを再結合して再実行。output/quantum/nuclear_excitation_level_prediction_full.csv / ..._summary.csv / ..._level_density_summary.csv / ..._representative.csv / ...png / ...metrics.json を更新。固定値: n_joined_rows=665, n_fit_e2plus=665, n_fit_e4plus=611, n_fit_e3minus=327, n_fit_r42=611。doc/ROADMAP.md（7.16.6 完了、次=7.16.7）/ doc/STATUS.md / doc/AI_CONTEXT_MIN.json を同期更新。
[work] 2026-02-07T23:51:51Z Phase 7 / Step 7.16.7: Bell 共分散行列の完全構築を完了（初版）。scripts/quantum/bell_primary_products.py を拡張し、5dataset（Weihs/Delft/NIST/Kwiat/Hensen2016）の window/offset sweep 共分散へ固有値診断を付与。cross-dataset sweep profile（共通 u∈[0,1] グリッド=81）を追加して covariance/correlation を固定し、bootstrap n=10000 + jackknife を同時出力。生成物：output/quantum/bell/cross_dataset_covariance.json / .png、output/quantum/bell/longterm_consistency.json、output/quantum/bell/systematics_templates.json、output/quantum/bell/*/covariance_bootstrap.json。固定値: n_profile_datasets=5, profile_cov_rank_eps1e-10=5。検証：python -B scripts/quantum/bell_primary_products.py, python -m py_compile scripts/quantum/bell_primary_products.py
[work] 2026-02-08T00:30:44Z Phase 7 / Step 7.16.8-7.16.9: Bell系統誤差15項目の完全分解と長期一貫性定量化を完了（初版）。scripts/quantum/bell_primary_products.py を拡張し、systematics_decomposition_15items（json/csv/png）を固定、longterm_consistency に year（1998-2016）トレンド、条件依存（selection_class/statistic_family）、cross-dataset covariance要約（rank/最大相関ペア）を追加。再生成: python -m py_compile scripts/quantum/bell_primary_products.py, python -B scripts/quantum/bell_primary_products.py。主要出力: output/quantum/bell/systematics_decomposition_15items.{json,csv,png}, output/quantum/bell/longterm_consistency.{json,png}, output/quantum/bell/cross_dataset_covariance.json。
[work] 2026-02-08T00:51:57Z Phase 7 / Step 7.16.10: Bell selection loophole の完全定量化を完了（初版）。scripts/quantum/bell_primary_products.py を拡張し、4 loopholes（fair sampling / detection / locality / freedom-of-choice）を同一I/Fで集計する `output/quantum/bell/selection_loophole_quantification.{json,csv,png}` を追加。detection は trial-based denominators（NIST/Kwiat）で η_min を固定、freedom-of-choice は setting-bias 指標を追加し、Delft 2015/2016 の normalized_events に pair setting counts を出力するよう更新。再生成: python -m py_compile scripts/quantum/bell_primary_products.py, python -B scripts/quantum/bell_primary_products.py --overwrite。固定値: fair n_supported=5/n_pass=0, detection n_supported=2/n_pass=0, locality n_supported=2/n_pass=0, freedom n_supported=5/n_pass=5。
[work] 2026-02-08T01:03:20Z Phase 7 / Step 7.16.11: COW実験の完全解析を完了（初版）。scripts/quantum/cow_experiment_phase.py を拡張し、既存の位相スケーリング出力を維持したまま、統合カタログ（output/quantum/cow_experiment_data_integration.csv）、H-v依存sweep（output/quantum/cow_phase_shift_hv_sweep.csv）、完全解析図（output/quantum/cow_experiment_complete_analysis.png）、統合metrics（output/quantum/cow_experiment_complete_analysis_metrics.json）を固定。再生成: python -m py_compile scripts/quantum/cow_experiment_phase.py, python -B scripts/quantum/cow_experiment_phase.py。固定値: catalog_rows=6, hv_sweep_rows=25, numeric_coverage_ratio=1/6, representative_phi0_cycles=-11.1551。
[work] 2026-02-08T06:38:08Z Phase 7 / Step 7.16.12: 原子干渉計の系統的検証を完了（初版）。scripts/quantum/gravity_quantum_interference_delta_predictions.py を拡張し、重力計・原子ジャイロ proxy・光格子時計を同一I/Fへ統合、`delta_z_over_z_gr` / `delta_observable` / `required_precision_3sigma` / `current_precision` を固定した統合サマリを生成。出力: output/quantum/atom_interferometer_unified_audit_summary.csv / output/quantum/atom_interferometer_unified_audit_metrics.json / output/quantum/atom_interferometer_unified_audit.png（互換維持: output/quantum/gravity_quantum_interference_delta_predictions.png / .json）。再生成: python -m py_compile scripts/quantum/gravity_quantum_interference_delta_predictions.py, python -B scripts/quantum/gravity_quantum_interference_delta_predictions.py。固定値: channels_n=4, detectable_under_current_n=0, atom_gyroscope_proxy.phi_ref_rad=1720.853。
[work] 2026-02-08T06:57:36Z Phase 7 / Step 7.16.13: 物質波干渉の精密検証を完了（初版）。scripts/quantum/electron_double_slit_interference.py を拡張し、既存の電子二重スリット出力（png/json）を維持したまま、電子/原子/分子を横断する監査I/Fを追加。新規出力として output/quantum/matter_wave_interference_precision_audit_summary.csv / ..._metrics.json / ..._precision_audit.png を生成し、固定値 channels_n=4, atom alpha abs_z=0.588, molecular scaling z_max=2.639, atom precision gap median ratio=7.179e5 を凍結。Part III 4.2.3 に横断I/Fの結果と図説明を追記。
[work] 2026-02-08T07:01:29Z Phase 7 / Step 7.16.13（追補）: Part III 4.2.3 で追加した統合図 output/quantum/matter_wave_interference_precision_audit.png を doc/paper/01_figures_index.md に登録し、paper_lint（manuscript=doc/paper/12_part3_quantum.md）warnings=0 を確認。doc/ROADMAP.md / doc/STATUS.md / doc/AI_CONTEXT_MIN.json の最終更新UTCを同期。
[work] 2026-02-08T07:12:47Z Phase 7 / Step 7.16.14: HOM干渉とスクイーズド光の統合監査を完了（初版）。scripts/quantum/photon_quantum_interference.py を拡張し、既存の photon_quantum_interference 出力を維持したまま output/quantum/hom_squeezed_light_unified_audit_summary.csv / ..._metrics.json / ..._unified_audit.png を生成。固定値: channels_n=5, HOM z(13ns)=37.08, HOM z(1us)=24.35, 遅延差分 z=0.210, squeezing variance ratio=0.100, PSD(10kHz/100kHz)=0.841。Part III 4.2.5 と figures index に統合I/Fを追記。
[work] 2026-02-08T07:26:04Z Phase 7 / Step 7.16.15: 分離エネルギー系統検証を完了（初版）。新規 scripts/quantum/nuclear_separation_energy_systematics_analysis.py を追加し、Step 7.16.3 の per-nucleus 固定I/Fを入力に S_n/S_p/S_2n/S_2p を全核種で再構築。残差、chain-envelope edge（distance<=2）による dripline proxy、magic-gap（gap_n/gap_2n/gap_p/gap_2p）を同一手続きで固定し、output/quantum/nuclear_separation_energy_systematics_full.csv / ..._summary.csv / ..._magic_kink.csv / ..._metrics.json / ..._quantification.png を生成。固定値: n_total_separation_rows=13337, n_total_gap_rows=520。doc/ROADMAP.md（7.16.15 完了、次=7.16.16）/ doc/STATUS.md / doc/AI_CONTEXT_MIN.json を同期更新。
[work] 2026-02-08T07:47:03Z Phase 7 / Step 7.16.16: ベータ崩壊Q値予測（NuDat/ENSDF比較）を完了（初版）。新規 scripts/quantum/nuclear_beta_decay_qvalue_prediction_analysis.py を追加し、Step 7.16.3 の per-nucleus 固定I/F（B_obs/B_pred_before/B_pred_after）と NuDat primary/secondary（qValues: betaMinus/positronEmission）を結合して beta-/beta+ の Q_pred/Q_obs 残差、z指標、半減期相関、崩壊モード整合（Q_pred>0 vs B-/EC/B+ flag）を同一手続きで固定。生成: output/quantum/nuclear_beta_decay_qvalue_prediction_full.csv / ..._summary.csv / ..._representative.csv / ..._metrics.json / ..._quantification.png。固定値: n_rows_total=6265（beta_minus=3145, beta_plus=3120）、median_abs_resid_after_MeV(beta_minus=6.030, beta_plus=5.890)。doc/ROADMAP.md（7.16.16 完了、次=7.16.17）/ doc/STATUS.md / doc/AI_CONTEXT_MIN.json を同期更新。
[work] 2026-02-08T07:52:58Z Phase 7 / Step 7.16.17: 核変形パラメータ予測を完了（初版）。新規 scripts/quantum/nuclear_deformation_parameter_prediction_analysis.py を追加し、NNDC B(E2) adopted の β2（extracted_beta2.json）を Step 7.16.3（pairing per-nucleus）と Step 7.16.6（R4/2）へ結合して、β2予測・回転帯proxy（R4/2）・変形とB.E.残差の相関を同一I/Fで固定。一次固定ソースにβ4の直接観測が無いため運用proxy（β4≈β2^2/3）を分離チャネルとして併記。生成: output/quantum/nuclear_deformation_parameter_prediction_full.csv / ..._summary.csv / ..._representative.csv / ..._metrics.json / ..._quantification.png。固定値: n_rows_joined=428、n_rows_with_r42=414、beta2 median_abs_resid=0.0515、r42 class_match_rate=0.551。doc/ROADMAP.md（7.16.17 完了、次=7.16.18）/ doc/STATUS.md / doc/AI_CONTEXT_MIN.json を同期更新。
[work] 2026-02-08T08:01:24Z Phase 7 / Step 7.16.18: 統計誤差の完全伝播を完了（初版）。新規 scripts/quantum/nuclear_statistical_error_propagation_matrix_analysis.py を追加し、Step 7.16.3（pairing）の k_n/k_p 共分散を起点に、Step 7.16.15（分離エネルギー）/7.16.16（Q値）/7.16.17（β2）へ Monte Carlo（n=100000）誤差伝播を実装。入力共分散・出力共分散・寄与分解（dominant source）を同一I/Fで固定し、output/quantum/nuclear_statistical_error_propagation_input_covariance.csv / ..._output_covariance.csv / ..._output_summary.csv / ..._contribution_matrix.csv / ..._dominant_sources.csv / ..._quantification.png / ..._metrics.json を生成。固定値: k_n=-1.4780、k_p=1.7944、cov(k_n,k_p)=-0.1859、mc_std(be_rms)=0.166 MeV、mc_std(sep_rms)=0.0240 MeV、mc_std(q_beta_minus_rms)=0.0631 MeV、mc_std(q_beta_plus_rms)=0.0570 MeV、mc_std(beta2_rms)=4.29e-4。doc/ROADMAP.md（7.16.18 完了、次=7.16.19）/ doc/STATUS.md / doc/AI_CONTEXT_MIN.json を同期更新。
[work] 2026-02-08T08:16:55Z Phase 7 / Step 7.16.19: 系統誤差の保守的上限を完了（初版）。新規 scripts/quantum/nuclear_systematic_error_upper_bounds_analysis.py を追加し、Step 7.16.18（統計誤差）と Step 7.16.15/16/17（分離エネルギー/Q値/β2要約）を入力に、系統源6項目の組合せ（quadrature/linear worst-case）を監査。`sigma_total=sqrt(sigma_stat^2+sigma_sys^2)` と `z=residual/sigma_total` をチャネル別に再評価し、3σゲート到達に必要な `sigma_sys_required` を固定。生成: output/quantum/nuclear_systematic_error_upper_bounds_full.csv / ..._summary.csv / ..._channel_bounds.csv / ..._quantification.png / ..._metrics.json。固定値: all_sources_linear_worst で n_gate_pass=2, n_gate_fail=3, median_abs_z=3.331, max_abs_z=5.000。doc/ROADMAP.md（7.16.19 完了、次=7.16.20）/ doc/STATUS.md / doc/AI_CONTEXT_MIN.json を同期更新。
[work] 2026-02-08T08:36:43Z Phase 7 / Step 7.16.20: 独立測定による相互検証を完了（初版）。新規 scripts/quantum/nuclear_independent_cross_observable_consistency_analysis.py を追加し、Step 7.16.3/5/15/16 の固定I/Fを (Z,N,A) で統合して B.E./r_ch/S_n/Q_beta の cross-check matrix、不整合核種抽出、精度要件（3σ）を固定。生成: output/quantum/nuclear_independent_cross_observable_consistency_joined.csv / ..._matrix.csv / ..._inconsistent_nuclei.csv / ..._precision_requirements.csv / ..._consistency.png / ..._metrics.json。固定値: n_rows_joined=3556, n_with_all_4_channels=954, n_with_ge_3_channels=3355, n_inconsistent=58, median_improvement_factor(be/radius/sep/q)=3.00。doc/ROADMAP.md（7.16.20 完了、次=Phase 8/Step 8.2）/ doc/STATUS.md / doc/AI_CONTEXT_MIN.json を同期更新。
[work] 2026-02-08T09:03:40Z Phase 8 / Step 8.2: ユーザー指示により全論文生成（full）を実施。`cmd /c output\\summary\\build_materials.bat` を実行し、`output/summary/pmodel_paper.*`、`output/summary/pmodel_paper_part2_astrophysics.*`、`output/summary/pmodel_paper_part3_quantum.*`、`output/summary/pmodel_short_note.*`（HTML/DOCX）を更新。paper_lint は paper/part2/part3/short_note すべて errors=0, warnings=0。run_all の optional job で cosmology BAO 系に警告ログ（optional skip/fail）が出たが、最終ビルドは成功。doc/ROADMAP.md / doc/STATUS.md / doc/AI_CONTEXT_MIN.json を同期更新。
[work] 2026-02-08T09:14:21Z Phase 7 / Step 7.17: ユーザー指定の次作業5項目をロードマップへ統合（重複は新規再固定サイクルとして整理）。doc/ROADMAP.md に Step 7.17（7.17.1 全核種3554系統解析、7.17.2 魔法数kink、7.17.3 pairing再統合、7.17.4 Bell共分散bootstrap n=10000、7.17.5 Bell15系統分解）を追加し、次作業を 7.17.1 へ設定。doc/STATUS.md / doc/AI_CONTEXT_MIN.json を同期更新。
[work] 2026-02-08T09:28:03Z Phase 7 / Step 7.17.1: 全核種系統解析を再固定。scripts/quantum/nuclear_binding_energy_frequency_mapping_ame2020_all_nuclei.py の A帯統計を 6区分→10区分へ更新して再実行し、output/quantum/nuclear_binding_energy_frequency_mapping_ame2020_all_nuclei.csv / ..._a_band_stats.csv / ..._zn_residual_map.png / ..._metrics.json を更新。固定値: n_rows=3556, A_band_count=10。doc/ROADMAP.md（7.17.1 完了・次 7.17.2）/ doc/STATUS.md / doc/AI_CONTEXT_MIN.json を同期更新。
[work] 2026-02-08T09:36:56Z Phase 7 / Step 7.17.2: 魔法数での殻閉殻効果（S2n/S2p kink）を再固定。python -B scripts/quantum/nuclear_magic_shell_closure_kink_analysis.py を再実行し、output/quantum/nuclear_magic_shell_closure_kink_summary.csv / ..._representative4.csv / ..._quantification.png / ..._metrics.json を更新。固定値: n_gap_S2n_rows=110, n_gap_S2p_rows=133, n_representative=4。doc/ROADMAP.md（7.17.2 完了・次 7.17.3）/ doc/STATUS.md / doc/AI_CONTEXT_MIN.json を同期更新。
[work] 2026-02-08T09:41:29Z Phase 7 / Step 7.17.3: pairing効果の系統組み込みを再固定。python -B scripts/quantum/nuclear_pairing_effect_systematics_analysis.py を再実行し、output/quantum/nuclear_pairing_effect_systematics_per_nucleus.csv / ..._summary.csv / ..._quantification.png / ..._metrics.json を更新。固定値: n_nuclei=3556, n_fit_rows=3191, k_n=-1.478, k_p=1.794。doc/ROADMAP.md（7.17.3 完了・次 7.17.4）/ doc/STATUS.md / doc/AI_CONTEXT_MIN.json を同期更新。
[work] 2026-02-08T09:49:19Z Phase 7 / Step 7.17.4-7.17.5: Bell 共分散（cross-dataset covariance; bootstrap n=10000）と系統誤差15項目分解を再固定。python -B scripts/quantum/bell_primary_products.py --overwrite を実行し、output/quantum/bell/cross_dataset_covariance.{json,png}（u_grid_points=81, rank_eps_1e-10=5）、output/quantum/bell/systematics_decomposition_15items.{json,csv,png}（item_catalog_n=15, datasets_n=5）と falsification_pack/longterm_consistency/selection_loophole_quantification を更新。doc/ROADMAP.md（7.17完了）/ doc/STATUS.md / doc/AI_CONTEXT_MIN.json を同期更新。

## 2026-02-08（UTC） Phase 7 / Step 7.17.6（Part III 量子）完了監査（再現・参照出力の存在確認）

目的：
- ロードマップ/Part III が参照する生成物の欠落がないことを機械的に確認し、主要再現コマンドが通ることを確認する。

作業：
- `doc/paper/12_part3_quantum.md` の参照出力（152件）と `doc/ROADMAP.md` の量子参照出力（concrete 526件）の存在確認（missing=0）。
- 主要スクリプト（Bell/nuclear/scoreboard/QC）を再実行し、再生成が完走することを確認。

再生成：
- `python -B scripts/quantum/bell_primary_products.py --overwrite`
- `python -B scripts/quantum/nuclear_binding_energy_frequency_mapping_ame2020_all_nuclei.py`
- `python -B scripts/quantum/nuclear_magic_shell_closure_kink_analysis.py`
- `python -B scripts/quantum/nuclear_pairing_effect_systematics_analysis.py`
- `python -B scripts/quantum/nuclear_binding_energy_frequency_mapping_differential_predictions.py`
- `python -B scripts/quantum/nuclear_binding_energy_frequency_mapping_differential_quantification.py`
- `python -B scripts/quantum/nuclear_binding_energy_frequency_mapping_falsification_pack.py`
- `python -B scripts/summary/quantum_scoreboard.py`
- `python -B scripts/summary/quantum_falsification.py`
- `python -B scripts/summary/paper_qc.py`
- `python -B scripts/summary/paper_lint.py`

結果：
- Part III は参照生成物の欠落なし（missing=0）。
- paper_qc: ok=True、paper_lint: errors=0, warnings=0。
- Bell（固定I/F）：`u_grid_points=81`、`bootstrap n_boot=10000`、`item_catalog_n=15`、`datasets_n=5` を維持。
- Nuclear mapping（固定I/F）：全核種 `3556` 行、A帯 `10` 区分を維持。

[work] 2026-02-08T10:09:37Z Phase 7 / Step 7.17.6: Part III（量子）の参照出力と主要再現コマンドを監査し、欠落なし/再現OKを再確認。doc/ROADMAP.md に 7.17.6 を追記し、paper_qc/paper_lint/quantum_scoreboard/quantum_falsification と Bell/nuclear の主要出力を再生成。

## 2026-02-08（UTC） 次作業の優先度を「現時点で実行可能」へ再整理（データ取得不能は低優先）

目的：
- データ未公開/取得不能（GN-z11、Giustina click log/thesis、XRISM追加obsid）を低優先へ落とし、現時点で回せる作業（QC/回帰）を上位に置く。

変更：
- 更新：`doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`
  - 「次にやること」を `paper_qc/paper_lint`（軽量QC）→ `quantum_scoreboard/quantum_falsification`（量子集約）→ 必要時の Bell/nuclear 再生成 →（任意）`run_all --offline` の順に再整理。

[work] 2026-02-08T10:20:55Z Phase 7 / Step 7.17.6: 次作業の優先順位を「現時点で実行可能」へ再整理し、データ取得不能（GN-z11/Giustina/XRISM）を低優先へ移動。doc/STATUS.md / doc/AI_CONTEXT_MIN.json を更新。

## 2026-02-08（UTC） Part III（量子）に関係する完了Stepの再監査（論文ビルド再実行）

目的：
- Part III（量子）に関係するロードマップの「完了」項目が、現時点でも再現可能（生成・整合が通る）であることを再確認する。

作業：
- Part III の publish 生成（Part III profile）を再実行し、lint/QC が通ることを確認。

再生成：
- `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`
- `python -B scripts/summary/paper_qc.py`

結果：
- `output/summary/pmodel_paper_part3_quantum.html` を再生成し、paper_lint は errors=0, warnings=0。
- paper_qc: ok=True（`output/summary/paper_qc.json`）。

[work] 2026-02-08T10:34:24Z Phase 8 / Step 8.2: Part III（量子）profile の publish 生成（paper_build）を再実行し、paper_lint（errors=0,warnings=0）と paper_qc（ok=True）で「完了」状態を再確認。

## 2026-02-08（UTC） Phase 4 / Step 4.5A.4（BAO）offline回帰の失敗修正（wedge anisotropy / peakfit recon_grid_iso）

目的：
- `python -B scripts/summary/run_all.py --offline --jobs 2` の cosmology（BAO）失敗を解消し、回帰（failed=0）を回復する。

作業：
- wedge anisotropy：`scripts/cosmology/cosmology_bao_catalog_wedge_anisotropy.py` の NPZ loader を堅牢化し、DESI VAC Lyα の multi-component ξ0/ξ2（2D）で停止しないように修正（非1Dは skip）。
- peakfit（recon_grid_iso）：BOSS/CMASS combined で dist 間の推定量仕様（nmu/sector_key）が混在して停止していたため、WSL（Corrfunc, threads=24）で `cosmology_bao_xi_from_catalogs.py` を lcdm/pbg それぞれ再生成し、nmu=120・sector_key=isect に整合。
- 再実行：`python -B scripts/cosmology/cosmology_bao_catalog_peakfit.py --sample cmass --caps combined --out-tag recon_grid_iso` を再実行し、出力を更新。
- 回帰：`python -B scripts/summary/run_all.py --offline --jobs 2` を再実行。

結果：
- `output/summary/run_all_status.json`（generated_utc=2026-02-08T11:32:04Z）：tasks_total=148、ok=140、skipped=8（offline）、failed=0。
- 更新出力（主要）：
  - `output/cosmology/cosmology_bao_catalog_wedge_anisotropy*.{png,json}`
  - `output/cosmology/cosmology_bao_xi_from_catalogs_cmass_combined_{lcdm,pbg}__recon_grid_iso.*`
  - `output/cosmology/cosmology_bao_catalog_peakfit_cmass_combined__recon_grid_iso.{png,json}`

[work] 2026-02-08T11:48:36Z Phase 4 / Step 4.5A.4: BAO（wedge anisotropy/peakfit recon_grid_iso）の回帰失敗を修正し、WSLで xi-from-catalogs（CMASS combined; recon_grid_iso; lcdm/pbg）を再生成して推定量仕様（nmu/sector_key）を整合。run_all --offline --jobs 2 の failed=0 を確認。doc/ROADMAP.md / doc/STATUS.md / doc/AI_CONTEXT_MIN.json を同期更新。

[work] 2026-02-08T12:20:36Z Phase 8 / Step 8.2: Part III（量子）論文のみを再生成（publish; HTML+DOCX）。`python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary` を実行し、`output/summary/pmodel_paper_part3_quantum.html` と `output/summary/pmodel_paper_part3_quantum.docx` を更新（paper_lint errors=0,warnings=0）。

[work] 2026-02-08T12:30:55Z Phase 7 / Step 7.18: Part III（量子）の完成条件を「棚卸し→反証条件パックの論文末尾明記→凍結パラメータ一元管理→機械QA→Conclusion収束」で閉じるため、doc/ROADMAP.md に Step 7.18（7.18.1–7.18.9）を追加。doc/STATUS.md / doc/AI_CONTEXT_MIN.json を同期更新。

[work] 2026-02-08T13:21:47Z Phase 7 / Step 7.18.1: Part III（量子）完成条件の棚卸しを機械化するため、`scripts/summary/part3_completion_inventory.py` を追加し、publish相当（INTERNAL_ONLY除外）で欠落のみを `output/summary/part3_completion_inventory.{json,md}` に固定出力（missing_sections=12）。併せてユーザー指定5項目（Step 7.17.1–7.17.5）の主要出力（全核種残差/魔法数kink/pairing/Bell共分散bootstrap n=10000/15系統分解）が揃っていることを再確認し、doc/ROADMAP.md（7.18.1完了化）/ doc/STATUS.md / doc/AI_CONTEXT_MIN.json を同期更新。

[work] 2026-02-08T13:42:41Z Phase 7 / Step 7.18.2: Part III（量子）の反証条件パック（JSON）を「実体＋論文記載」で閉じるため、Bell/核/物性+熱の pack 固定パス・適用（監査）条件・棄却閾値を `doc/paper/12_part3_quantum.md` の章末尾へ最小追記。物性/熱は baseline metrics の `falsification` を束ねる pack 実体として `scripts/quantum/condensed_falsification_pack.py` を追加し、`output/quantum/condensed_falsification_pack.json` を生成。Part III publish を再生成（`python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary`）し、paper_lint/paper_qc が ok=True を確認。doc/ROADMAP.md（7.18.2完了化）/ doc/STATUS.md / doc/AI_CONTEXT_MIN.json を同期更新。
[work] 2026-02-08T14:05:32Z Phase 7 / Step 7.18.3: Part III（量子）の凍結パラメータ一元管理を閉じるため、既存の確定出力（theory frozen / Bell pack / 核 pack / 物性+熱 pack など）から凍結値＋参照元sha256を集約する `scripts/quantum/frozen_parameters_quantum.py` を整備し、`output/quantum/frozen_parameters_quantum.json` を固定出力として生成。`doc/paper/12_part3_quantum.md`（3.0）で Frozen の参照先を同JSONへ一本化し、Part III publish を再生成して paper_lint（errors=0,warnings=0）/ paper_qc（ok=True）を確認。doc/ROADMAP.md / doc/STATUS.md / doc/AI_CONTEXT_MIN.json を同期更新。
[work] 2026-02-08T14:19:44Z Phase 7 / Step 7.18.4: 図番号/引用/相互参照QAを「一括で通る」形へ固定するため、`scripts/summary/paper_qc.py` を拡張し、Part II/III publish HTML を含む QC（double backslash/draft labels/equation alt/figure numbering）、in-page anchor（href="#..."）解決チェック、`x.x節` の存在チェック（doc/paper見出し番号集合へ照合）、`図xx` 参照の存在チェック（該当profile HTMLの図番号集合へ照合）を追加。`python -B scripts/summary/paper_qc.py` で ok=True を確認。doc/ROADMAP.md / doc/STATUS.md / doc/AI_CONTEXT_MIN.json を同期更新。
[work] 2026-02-08T14:30:09Z Phase 7 / Step 7.18.5: 核I/Fのサブセット自動実行ゲートを追加するため、`scripts/quantum/nuclear_binding_energy_frequency_mapping_ame2020_all_nuclei.py` に `--subset`（`measured_radii` / `measured_radii_neighborhood`）を追加し、サブセット出力を固定名で end-to-end 生成できるように整備。再現：`python -B scripts/quantum/nuclear_binding_energy_frequency_mapping_ame2020_all_nuclei.py --subset measured_radii_neighborhood`。出力：`output/quantum/nuclear_binding_energy_frequency_mapping_ame2020_subset_measured_radii_neighborhood.*`（csv/png/zn_map/a_band/metrics）。doc/ROADMAP.md / doc/STATUS.md / doc/AI_CONTEXT_MIN.json を同期更新。
[work] 2026-02-08T14:42:04Z Phase 7 / Step 7.18.9: Part III Conclusion を「核/Bell/物性+熱」の3段落（凍結＋棄却）へ収束し、`output/quantum/frozen_parameters_quantum.json` と各反証条件パック（Bell/核/物性+熱）の固定パス参照に整合。Part III publish を再生成し、paper_lint（errors=0,warnings=0）/ paper_qc（ok=True）を確認。併せて Step 7.18.10（completion inventory の missing_sections 埋め戻し）を doc/ROADMAP.md に追記して次作業を明示し、doc/STATUS.md / doc/AI_CONTEXT_MIN.json を同期更新。

## 2026-02-08（UTC） Part III 完成条件棚卸しの欠落埋め戻し（missing_sections=0 固定）

目的：
- Part III（量子）の publish 相当で、Table行ごとの `Input / Frozen / Statistic / Reject / Output` が欠けていない状態（missing_sections=0）を固定する。

作業：
- `doc/paper/12_part3_quantum.md` の欠落箇所へ **棄却条件**／**出力**／**指標** の最小行を追加。
- `python -B scripts/summary/part3_completion_inventory.py` を再実行し、`output/summary/part3_completion_inventory.md` が missing_sections=0 であることを確認。
- Part III profile の publish を再生成し、paper_lint strict / paper_qc が通ることを再確認：
  - `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary`
  - `python -B scripts/summary/paper_qc.py`
  - `python -B scripts/summary/paper_lint.py --strict`

結果：
- `output/summary/part3_completion_inventory.md`：`missing_sections=0`（publish相当; INTERNAL_ONLY除外）。
- `output/summary/pmodel_paper_part3_quantum.html` / `output/summary/pmodel_paper_part3_quantum.docx` を更新（paper_lint strict errors=0,warnings=0）。
- `output/summary/paper_qc.json`：ok=True。

[work] 2026-02-08T15:02:50Z Phase 7 / Step 7.18.10: Part III 完成条件棚卸しの欠落（Reject/Output/Statistic）を最小追記で埋め戻し、`part3_completion_inventory` の missing_sections=0 を固定。Part III publish を再生成し、paper_lint strict（errors=0,warnings=0）/ paper_qc（ok=True）を確認。doc/ROADMAP.md（7.18完了化）/ doc/STATUS.md / doc/AI_CONTEXT_MIN.json を同期更新。

## 2026-02-09（UTC） ユーザー要件（核/Bell/干渉/cross-check/誤差）チェックリストをロードマップへ統合（マッピング）

目的：
- ユーザー提示の「Phase 1–5」チェックリスト（核物理/Bell/干渉/cross-check/誤差）を、既存の Phase 7 の完了Stepへ対応付けし、重複タスクを発生させない。

作業：
- `doc/ROADMAP.md` に Step 7.19 を追加し、ユーザーPhase 1–5 を Phase 7 の既存Step（7.5, 7.16, 7.17）へ対応付け。
- 対応先Stepが既に完了であること（固定出力の存在・ロードマップ記載）を再確認。

結果：
- `doc/ROADMAP.md`：Step 7.19 を追加（既存Stepへのマッピング；新規のデータ取得/解析は要求しない）。
- `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json` を同期更新。

[work] 2026-02-09T03:11:25Z Phase 7 / Step 7.19: ユーザー要件（Phase 1–5：核/Bell/干渉/cross-check/誤差）を、Phase 7 の既存Stepへ対応付けしてロードマップに統合（マッピング）。重複を避け、詳細は対応先Stepを正とした。doc/ROADMAP.md / doc/STATUS.md / doc/AI_CONTEXT_MIN.json を更新。

## 2026-02-09（UTC） 追加チェックリスト（詳細拡張）の実施状況確認とロードマップ対応付け

目的：
- ユーザー提示の「核/Bell/干渉/誤差（詳細拡張）」チェックリストが未実施かを確認し、未実施ならロードマップへ追加する。

作業：
- `doc/ROADMAP.md` の Phase 7 記述を点検し、各項目が既存Step（7.13/7.16/7.17）で完了済みであることを確認。
- 未実施の新規解析は追加せず、対応関係のみを Step 7.19（マッピング）へ追記。

結果：
- 全項目は既存Stepで実施済み（新規追加タスクなし）。
- `doc/ROADMAP.md` の Step 7.19 に「詳細拡張」チェックリストの対応付けを追記。

[work] 2026-02-09T04:08:28Z Phase 7 / Step 7.19: 追加チェックリスト（核：中重核/同位体連鎖/Qβ/β2、Bell：共分散/15系統、干渉：COW/原子干渉計/HOM、誤差：MC伝播）の未実施有無を確認し、全項目が既存Stepで完了済みであることを確認。未実施の新規解析は追加せず、対応関係のみを doc/ROADMAP.md（Step 7.19）へ追記。doc/STATUS.md / doc/AI_CONTEXT_MIN.json を同期更新。

## 2026-02-09（UTC） Part III（量子）論文表記の可読性調整（Step表記削除・I/O言語化）

目的：
- Part III（publish）から内部Step表記を除去し、**入力**/**出力**をファイル名列挙ではなく言葉による説明へ統一する。

作業：
- `doc/paper/12_part3_quantum.md`：Step表記を削除し、**入力**/**出力**は言葉で説明する形へ統一（固定パスは `**固定ファイル（監査用）**` に分離）。
- `scripts/summary/paper_html.py`：図caption（`doc/paper/01_figures_index.md` 由来）から publish 出力へ Step が漏れないように strip を追加。
- `scripts/summary/paper_tables.py`：Table 1（量子）の planned 行 metric から Step 表記を除去。
- Part III publish を再生成し QA：
  - `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary`
  - `python -B scripts/summary/paper_qc.py`
  - `python -B scripts/summary/part3_completion_inventory.py`
  - `rg -n "\\bStep\\b" output/summary/pmodel_paper_part3_quantum.html`（no matches）

結果：
- `output/summary/pmodel_paper_part3_quantum.html` / `output/summary/pmodel_paper_part3_quantum.docx` を更新し、HTMLに Step 表記が出ないことを確認。
- `output/summary/part3_completion_inventory.md`：missing_sections=0。
- `output/summary/paper_qc.json`：ok=True。

[work] 2026-02-09T04:58:30Z Phase 7 / Step 7.18.11: Part III（量子）論文の可読性調整（Step表記削除・入力/出力の言語化・固定パス分離）を実施し、publish再生成で HTML に Step 表記が無いことを確認。paper_qc ok=True、completion inventory missing_sections=0。doc/ROADMAP.md / doc/STATUS.md / doc/AI_CONTEXT_MIN.json を同期更新。

## 2026-02-09（UTC） Part III（量子）publish 再生成と回帰（offline）再確認

目的：
- Part III（量子）publish が最新状態で再現でき、QA が維持されていることを再確認する。
- 変更が他領域へ波及していないことを、`run_all --offline` で回帰確認する。

作業：
- Part III publish を再生成し QA：
  - `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary`
  - `python -B scripts/summary/paper_qc.py`
  - `python -B scripts/summary/paper_lint.py --strict`
  - `python -B scripts/summary/part3_completion_inventory.py`
  - `rg -n "\\bStep\\b" output/summary/pmodel_paper_part3_quantum.html`
- 回帰（offline）：
  - `python -B scripts/summary/run_all.py --offline --jobs 2`

結果：
- Part III publish：paper_qc ok=True、paper_lint strict errors=0,warnings=0、completion inventory missing_sections=0、HTML で `Step` は 0件。
- run_all（offline）：`output/summary/run_all_status.json`（generated_utc=2026-02-09T05:12:45.646364+00:00）：tasks_total=148、ok=140、skipped=8、failed=0。

[work] 2026-02-09T05:23:40Z Phase 7: Part III（量子）publish を再生成して QA を再確認し、`run_all --offline --jobs 2` の回帰（ok=140/148; failed=0）を確認。

## 2026-02-09（UTC） Part III（量子）監査証拠の本文埋め込み（核Z–N残差／Bell 15系統バジェット）

目的：
- 核物理：全核種監査の「Z–N平面残差マップ」の観察結果を本文へ明文化し、魔法数と変形核の対比を文章として固定する。
- Bell：15項目の系統誤差バジェット（Systematic Error Budget）の内容を本文へ埋め込み、`S` の“破れ”へ寄与し得る規模を数値で示す。
- 最終化：publish 出力に「Step」タグが残らないことを再確認する。

作業：
- `doc/paper/12_part3_quantum.md`：
  - `4.2.7.3` に「Z–N平面上の結合エネルギー残差マップ」の観察結果（magic 付近で残差増大／変形核で相対的に整合）を追記。
  - `4.2.1` に「15項目の系統誤差バジェット表」を追加し、Weihs/Delft の CHSH `S` での具体的な `ΔS`（および `abs(ΔS)/σ_stat`）を本文に記載。
- Part III publish を再生成し QA：
  - `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary`
  - `python -B scripts/summary/paper_qc.py`
  - `python -B scripts/summary/paper_lint.py --strict`
  - `python -B scripts/summary/part3_completion_inventory.py`
  - `rg -n "\\bStep\\b" output/summary/pmodel_paper_part3_quantum.html`

結果：
- Part III publish：`output/summary/pmodel_paper_part3_quantum.html` / `.docx` を更新。
- QA：paper_qc ok=True、paper_lint strict errors=0,warnings=0、completion inventory missing_sections=0。
- publish HTML：`Step` は 0件（no matches）。

[work] 2026-02-09T07:38:22Z Phase 7: Part III（量子）に核Z–N残差の対比（magic vs deformation）と Bell 15系統バジェット表（`ΔS` 規模）を追記し、publish再生成＋QAで Step 0件を再確認。

## 2026-02-09（UTC） Part III（量子）Bell記述の明確化（装置側vs selection）と物性補遺分割

目的：
- Bell：15項目バジェットの読みを本文で明確化し、「宣言止まり」に見えない形で、装置側要因の ΔS スケールと selection 定義（window/offset/trial）の支配性を一文で固定する。
- 物性：長大な ansatz 試験ログを補遺へ分割し、本文はベースライン＋棄却条件＋要点に絞って可読性を上げる。

作業：
- `doc/paper/12_part3_quantum.md`：
  - `4.2.1` に補足段落を追加（装置側は概ね ΔS≈0.001〜0.07（proxy）／window/offset/trial 定義が支配的）。
  - `4.2.13` に補遺A見出しを追加し、Si 熱膨張 α(T) の詳細 ansatz 試験ログを補遺として分離。
- Part III publish を再生成し QA：
  - `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary`
  - `python -B scripts/summary/paper_qc.py`
  - `python -B scripts/summary/part3_completion_inventory.py`
  - `rg -n "\\bStep\\b" output/summary/pmodel_paper_part3_quantum.html`

結果：
- `output/summary/pmodel_paper_part3_quantum.html` / `output/summary/pmodel_paper_part3_quantum.docx` を更新。
- QA：paper_qc ok=True、completion inventory missing_sections=0、publish HTML で `Step` は 0件（no matches）。
- Bell節（4.2.1）は「バジェット表＋ΔS例＋装置側vs selection 定義の支配」を本文で明示。
- 物性（Si α(T)）の ansatz ログは補遺Aとして独立見出し化され、本文の主線（ベースライン＋棄却条件）が読みやすくなった。

[work] 2026-02-09T08:16:14Z Phase 7 / Step 7.18.11: Part III（量子）の Bell 節に装置側vs selection 定義の補足を追記し、物性（Si α(T)）の詳細ログを補遺へ分割。publish再生成＋paper_qc ok=True を確認。

[work] 2026-02-09T08:27:08Z Phase 7 / Step 7.18.11: Bell補足文の表現を「上の例（Weihs/Delft）」へ微修正し、Part III publish を再生成して paper_qc ok=True（Step 0件）を再確認。

## 2026-02-09（UTC） Part III（量子）論文の可読性・監査サマリ強化（非ブロック作業）

目的：
- Bell：selection 系統の「絶対量（ΔS）」を凍結点と sweep min-max で読める形へ整理し、本文の主張を一段明確化する。
- 核：Z–N残差マップの観察結果（magic vs 非magic vs 変形核）を、外れ率と `median abs(z)` の小表で即読化する。
- 物性：凝縮系（4.2.9–4.2.14）の本文を「最小セット（ベースライン＋棄却条件）」へ寄せ、先頭に統合サマリ表を追加する。

作業：
- `doc/paper/12_part3_quantum.md`：
  - Bell（4.2.1）に ΔS の絶対量サマリ表（S_frozen±σ_stat、sweep min-max、ΔS/σ_stat）を追加。
  - 核（4.2.7.3）に Z–N残差マップの要約表（magic/非magic/変形核の外れ率＋median abs(z)）を追加。
  - 物性（4.2.9）に凝縮系の統合サマリ表（代表値＋棄却条件）を追加。
- Part III publish を再生成し QA：
  - `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary`
  - `python -B scripts/summary/paper_qc.py`
  - `python -B scripts/summary/part3_completion_inventory.py`
  - `rg -n "\\bStep\\b" output/summary/pmodel_paper_part3_quantum.html`

結果：
- `output/summary/pmodel_paper_part3_quantum.html` / `output/summary/pmodel_paper_part3_quantum.docx` を更新。
- QA：paper_qc ok=True、completion inventory missing_sections=0、publish HTML で `Step` は 0件（no matches）。

[work] 2026-02-09T08:59:56Z Phase 7 / Step 7.18.11: Part III（量子）に Bell ΔS 絶対量表／核Z–N残差要約表／凝縮系サマリ表を追加し、publish再生成＋QA（ok=True、Step 0件）を確認。

[work] 2026-02-09T09:09:43Z Phase 7 / Step 7.18.11: Bell（4.2.1）に NIST（CH; J_prob）の ΔJ 絶対量サマリ表を追加し、Part III publish を再生成して paper_qc ok=True（Step 0件、missing_sections=0）を確認。

## 2026-02-09（UTC） Part III（量子）サマリの“即読性”強化（Bell/核/物性；非ブロック作業）

目的：
- Bell：CH（J_prob）に Kwiat/Christensen 2013 を含め、selection凍結点と sweep の min-max を本文で即読できる形へ揃える。
- Bell/核/物性：節末尾に「凍結／棄却／次」の運用3行サマリを置き、結論に必要な最小セットを読みやすくする。

作業：
- `doc/paper/12_part3_quantum.md`：
  - Bell（4.2.1）：CH（J_prob）の ΔJ サマリ表に Kwiat/Christensen 2013 を追加し、window/offsetでの bound crossing の読みを本文に明記。
  - Bell（4.2.1）：節末に「凍結／棄却／次」の3行サマリを追加。
  - 核（4.2.7）：節末に「凍結／棄却／次」の3行サマリを追加。
  - 物性（4.2.14）：凝縮系の節末に「凍結／棄却／次」の3行サマリを追加。
- Part III publish を再生成し QA：
  - `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary`
  - `python -B scripts/summary/paper_qc.py`
  - `python -B scripts/summary/part3_completion_inventory.py`
  - `rg -n "\\bStep\\b" output/summary/pmodel_paper_part3_quantum.html`

結果：
- Part III publish を更新：paper_qc ok=True、completion inventory missing_sections=0、publish HTML で `Step` は 0件（no matches）。

[work] 2026-02-09T09:29:27Z Phase 7 / Step 7.18.11: Part III（量子）の Bell/核/物性に「凍結／棄却／次」サマリを追加し、Bell（CH）にKwiat/Christensen 2013を統合。publish再生成＋QA（ok=True、Step 0件）を確認。

[work] 2026-02-09T09:39:14Z Phase 7 / Step 7.18.11: Bell（4.2.1）の ΔS/ΔJ サマリ表に bound 指標列（`S_frozen−2`,`min−2`,`max(J)`）を追加し即読性を強化。Part III publish を再生成して paper_qc ok=True（Step 0件、missing_sections=0）を確認。

[work] 2026-02-09T12:15:57Z Phase 7 / Step 7.18.11: Part III（量子）の干渉/原子分子/QED 節にも「凍結／棄却／次」3行サマリを追加して本文の主線を統一し、doc/ROADMAP.md の 7.18.11 記述を改訂。Part III publish を再生成して paper_qc ok=True（Step 0件、missing_sections=0）を確認。

[work] 2026-02-09T12:34:27Z Phase 7 / Step 7.18.11: Part III（量子）の熱（黒体：4.2.15–4.2.16）にも「凍結／棄却／次」3行サマリを追加し、凝縮系（Si α(T)）の Debye–Grüneisen 定数モデル評価を補遺Aへ退避して本文をさらに要約化。publish再生成＋paper_qc ok=True（Step 0件、missing_sections=0）を確認。

## 2026-02-09（UTC） Bell cross-dataset統合（pack閉包）と差分予測テーブル増強（Part III 5章）

目的：
- Bell：cross-dataset の統合要約（共分散/15系統/selection-loophole）を falsification pack に同梱し、
  pack単体で監査入口が閉じる状態にする。
- Part III：差分予測章（5章）を Part II 並みの密度へ寄せ、Table 2 の統計族混在（CHSH/CH）を解消したうえで、
  cross-dataset の要約（Table 3）を追加する。

作業：
- `scripts/quantum/bell_primary_products.py`：
  - `output/quantum/bell/falsification_pack.json` を version=1.1 とし、`cross_dataset` を追記
    （covariance/15系統/selection-loophole の要約＋入力sha256＋参照出力）。
- `doc/paper/12_part3_quantum.md`：
  - Table 2（Bell）の CHSH/CH を統計族ごとに分離し、R_sel 範囲と dataset 表記（NIST=CH J_prob）を整合。
  - Table 3 を追加し、cross-dataset の R_sel（min/median/max）、profile corr rank、
    15項目top、項目相関top pair を本文へ固定。
  - 追加図（systematics/covariance）を 5.1 へ参照し、`doc/paper/01_figures_index.md` に caption を登録。
- Part III publish を再生成し QA：
  - `python -B scripts/quantum/bell_primary_products.py`
  - `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary`
  - `python -B scripts/summary/paper_qc.py`
  - `python -B scripts/summary/part3_completion_inventory.py`
  - `rg -n "\\bStep\\b" output/summary/pmodel_paper_part3_quantum.html`

結果：
- Bell pack：`output/quantum/bell/falsification_pack.json`（version=1.1）に `cross_dataset` が含まれ、
  pack単体で横断要約（共分散/15系統/loophole）へ到達できる状態になった。
- Part III publish：`output/summary/pmodel_paper_part3_quantum.html` / `.docx` を更新。
- QA：paper_qc ok=True、completion inventory missing_sections=0、publish HTML で `Step` は 0件（no matches）。

[work] 2026-02-09T13:37:19Z Phase 7 / Step 7.18.2,7.18.11: Bell falsification pack に cross-dataset 統合要約を同梱し、Part III 5章の差分予測テーブル（Table 2/3）を増強。publish再生成＋QA（ok=True、missing_sections=0、Step 0件）を確認。

## 2026-02-10（UTC） Bell ヌルテスト固定（設定シャッフル／時間シフト）と pack v1.2 への同梱

目的：
- Bell の解析I/Fが「壊れるべき操作で壊れる」こと（ヌルテスト）を固定し、実装依存/恣意性の疑いを減らす。

作業：
- `scripts/quantum/bell_primary_products.py`：
  - Phase 7 / Step 7.20.1：ヌルテスト出力（設定シャッフル／時間シフト）を追加。
  - Kwiat/Christensen 2013 の ref-window 遅延サンプルを `delay_signature_ref_samples.npz` として固定出力（ヌルテストの再現入口）。
  - `output/quantum/bell/falsification_pack.json` を version=1.2 とし、`cross_dataset.null_tests_summary` を同梱。
- 再生成：
  - `python -B scripts/quantum/bell_primary_products.py`

結果：
- `output/quantum/bell/null_tests_summary.json` を追加（各datasetのヌルテスト要約）。
- `output/quantum/bell/<dataset>/null_tests.json` を追加（dataset別の固定結果）。
- `output/quantum/bell/kwiat2013_prl111_130406_05082013_15/delay_signature_ref_samples.npz` を追加（delay signature ヌルテスト用）。
- Bell pack：`output/quantum/bell/falsification_pack.json`（version=1.2）にヌルテスト要約が同梱され、pack単体で「ヌル操作で崩れる」証拠へ到達できる状態になった。

[work] 2026-02-10T04:42:36Z Phase 7 / Step 7.20.1: Bell ヌルテスト（設定シャッフル／時間シフト）を固定出力し、falsification pack v1.2 に null_tests_summary を同梱。

[work] 2026-02-10T04:52:56Z Phase 7 / Step 7.20.1: Part III（量子）publish を再生成し、paper_qc ok=True（publish HTML の Step 0件）を確認。

## 2026-02-10（UTC） Bell ブラインド凍結ポリシー（window/offset）固定と pack v1.3 への反映

目的：
- window/offset の凍結点が「統計量（S/J）を見ないで」決まることを、監査可能な JSON として固定する（p-hacking 自由度の追加削減）。

作業：
- `scripts/quantum/bell_primary_products.py`：
  - Phase 7 / Step 7.20.2：ブラインド凍結ポリシーを `output/quantum/bell/freeze_policy.json` として固定出力。
  - `output/quantum/bell/falsification_pack.json` を version=1.3 とし、`policy.blind_freeze` と `cross_dataset.inputs.freeze_policy_json` に参照（sha256）を同梱。
- 再生成：
  - `python -B scripts/quantum/bell_primary_products.py`

結果：
- `output/quantum/bell/freeze_policy.json` を追加（freeze規則＋dataset別適用ルール＋証拠参照）。
- Bell pack：`output/quantum/bell/falsification_pack.json`（version=1.3）にブラインド凍結ポリシーが同梱され、pack単体で「どの規則で freeze されたか」に到達できる状態になった。

[work] 2026-02-10T05:20:26Z Phase 7 / Step 7.20.2: Bell ブラインド凍結ポリシー（freeze_policy.json）を固定し、falsification pack v1.3 に policy/参照sha256 を同梱。

[work] 2026-02-10T05:23:02Z Phase 7 / Step 7.18.3: frozen_parameters_quantum を更新し、Bell pack の新sha256と freeze_policy を inputs/frozen に反映。

## 2026-02-10（UTC） Bell 実装差クロスチェック（pairing）固定と Part III 監査ハーネス（ワンコマンド化）

目的：
- Bell：pairing/推定器の実装差が結論を左右しないことを “系統（sys）” として固定し、falsification pack 単体で監査入口を閉じる。
- Part III：Bell/核/物性+熱の pack 生成→ゲート判定→要約（pass/failと理由）を 1 コマンドで回し、機械可読サマリを固定する。

作業：
- `scripts/quantum/bell_primary_products.py`：
  - Phase 7 / Step 7.20.3：pairing 実装差クロスチェック（初版）を追加。
  - `output/quantum/bell/<dataset>/crosscheck_pairing.json` と `output/quantum/bell/crosscheck_pairing_summary.json` を固定出力。
  - `output/quantum/bell/falsification_pack.json` を version=1.4 とし、`cross_dataset.pairing_crosscheck_summary` を同梱。
- `scripts/summary/part3_audit.py`：
  - Phase 7 / Step 7.20.7：Part III 監査ハーネスを追加（pack 再生成→ゲート判定→要約）。
  - `python -B scripts/summary/part3_audit.py` → `output/summary/part3_audit_summary.json`（固定名）を出力。
- Part III publish を再生成し QA：
  - `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`
  - `python -B scripts/summary/paper_qc.py`
  - `rg -n "\\bStep\\b" output/summary/pmodel_paper_part3_quantum.html`（no matches）

結果：
- Bell pack：`output/quantum/bell/falsification_pack.json`（version=1.4）が
  ヌルテスト＋ブラインド凍結＋pairing 実装差クロスチェックの要約を同梱し、pack 単体で監査入口へ到達できる状態になった。
- Part III 監査ハーネス：`output/summary/part3_audit_summary.json`（ok=True）が固定され、
  Bell/核/物性+熱/棚卸しのゲート状態を 1 コマンドで確認できるようになった。
- Part III publish：`output/summary/pmodel_paper_part3_quantum.html` を更新し、paper_qc ok=True を確認。

[work] 2026-02-10T06:04:17Z Phase 7 / Step 7.20.3,7.20.7: Bell pairing 実装差クロスチェックを固定出力し pack v1.4 へ同梱。Part III 監査ハーネス（part3_audit.py）を追加し、part3_audit_summary.json ok=True と publish 再生成＋paper_qc ok=True を確認。

## 2026-02-10（UTC） Part III 追加監査：核 holdout（領域分割）と物性/熱 holdout（温度帯 split）を固定

目的：
- 核：AME2020 全核種の結合エネルギー残差を、magic/変形/端（dripline proxy）/極端N/Z などの領域に分割し、失敗モードを監査出力として固定する。
- 物性/熱：温度帯 split の holdout を “系統（sys）” として固定し、procedure sensitivity（外挿の弱点）をカタログ化する。

作業：
- `scripts/quantum/nuclear_holdout_audit.py`：
  - `output/quantum/nuclear_holdout_audit_summary.json`（群別統計＋閾値）を固定出力。
  - `output/quantum/nuclear_holdout_audit_groups.csv`（群別）と `output/quantum/nuclear_holdout_audit_outliers.csv`（外れ核）を固定出力。
  - `output/quantum/nuclear_holdout_audit.png`（群別の外れ率/中央値abs(z)）を生成。
- `scripts/quantum/condensed_silicon_thermal_expansion_gruneisen_holdout_splits.py`：
  - Si α(T) の温度帯 split holdout を再生成し、`..._holdout_splits_metrics.json` を更新。
- `scripts/quantum/condensed_holdout_audit.py`：
  - holdout 結果を横断サマリ化し、`output/quantum/condensed_holdout_audit_summary.json`（CSV/PNG）を固定。
- `scripts/summary/part3_audit.py`：
  - 上記 holdout 監査の出力を required artifacts として統合し、`output/summary/part3_audit_summary.json` ok=True を確認。

結果：
- Phase 7 / Step 7.20.4（核 holdout 監査）と Step 7.20.6（物性/熱 holdout 監査）の “監査出力としての固定” を完了（初版）。
- `python -B scripts/summary/part3_audit.py` で、Bell/核/物性+熱/棚卸しが 1 コマンドで監査できる状態を維持（ok=True）。

[work] 2026-02-10T06:26:00Z Phase 7 / Step 7.20.4,7.20.6: 核 holdout 監査（領域分割）と物性/熱の温度帯 holdout を固定出力化し、part3_audit に統合して part3_audit_summary.json ok=True を確認。

## 2026-02-10（UTC） Part III publish 可読性改善（Step削除／ファイル名を8章へ集約）と棚卸しルール更新

目的：
- Part III（量子）の公開版で、Step 番号やファイル名の羅列を避け、結果・棄却条件・凍結だけを本文に残す。
- その上で completion inventory（棚卸し）が「本文に file path が無いと落ちる」状態にならないよう、検出ルールを本文形式に合わせる。

作業：
- `doc/paper/12_part3_quantum.md`：
  - `Step` 表記を除去（本文・公開HTMLで `Step` が出ない状態へ）。
  - 本文中の入出力アーティファクト（`output/quantum/*.json` / `*.csv` 等）の列挙を削除し、8章（Reproducibility）へ集約。
  - Born則の図の導線から `doc/quantum/...` の直接パスを外し、図（フロー）＋本文要点に統一。
  - 8章に主要アーティファクト（固定パス）と最小再現コマンドを追記。
- `scripts/summary/part3_completion_inventory.py`：
  - Output の検出を `**出力**` 行ベースへ更新（legacy 互換で `output/` 参照も許容）。
- 再生成・検証：
  - `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`
  - `python -B scripts/summary/paper_qc.py`
  - `python -B scripts/summary/part3_completion_inventory.py`
  - `python -B scripts/summary/part3_audit.py`

結果：
- publish HTML：`output/summary/pmodel_paper_part3_quantum.html` を更新し、本文に `Step` が出ないことを確認。
- completion inventory：missing_sections=0 を回復（本文の **出力** 行で棚卸しが通る）。
- part3_audit：ok=True（Bell/核/物性+熱/棚卸しの全ゲートpass）。

[work] 2026-02-10T06:59:33Z Phase 7 / Step 7.20.8: Part III publish 可読性改善（Step削除／ファイル名を8章へ集約）を実施し、completion inventory の Output 検出を **出力** 行ベースへ更新。publish再生成＋paper_qc＋part3_audit ok=True を確認。

## 2026-02-10（UTC） Bell pairing crosscheck の supported 拡張（NIST/Kwiat）と Part III 反映

目的：
- Bell：Weihs のみ supported だった pairing/推定器の実装差クロスチェックを、NIST/Kwiat へ拡張し、cross-dataset pack の監査入口を厚くする。
- Part III：本文側にも `Δ_impl/σ_boot`（実装差/統計）の要点を埋め込み、「実装依存」を系統として閉じる。

作業：
- `scripts/quantum/bell_primary_products.py`：
  - NIST：coincidence pairing（greedy vs mutual nearest-neighbor）で `Δ_impl/σ_boot` を固定（chunked 実装）。
  - Kwiat/Christensen 2013：trial-based の凍結点（ref window）の整合（内部一致）を supported として固定。
  - `output/quantum/bell/crosscheck_pairing_summary.json` を更新（supported: Weihs+NIST+Kwiat）。
- `doc/paper/12_part3_quantum.md`：
  - 4.2.1 に pairing/推定器の実装差クロスチェック（`Δ_impl/σ_boot`）の表を追記。
  - 5.1 の Table 3（cross-dataset 要約）に pairing crosscheck max を追加。
- 再生成・検証：
  - `python -B scripts/summary/part3_audit.py`（ok=True）
  - `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`
  - `python -B scripts/summary/paper_qc.py`（ok=True）
  - `python -B scripts/summary/part3_completion_inventory.py`（missing_sections=0）

結果：
- pairing crosscheck（凍結点）：Weihs `Δ_impl/σ_boot≈0.086`、NIST `≈0.021`、Kwiat `=0.000`（max < 1 を維持）。
- Part III publish HTML を更新し、paper_qc ok=True（`Step` 0件）を維持。

[work] 2026-02-10T10:31:34Z Phase 7 / Step 7.20.3: Bell pairing crosscheck を NIST/Kwiat まで supported 拡張し、`Δ_impl/σ_boot` を Part III（4.2.1/5.1）へ反映。part3_audit/paper_build/paper_qc ok=True を確認。

## 2026-02-10（UTC） Part III 追加監査：物性/熱 holdout を Cp/κ へ拡張（Step 7.20.6 改訂）

目的：
- 温度帯 split holdout を α(T) 以外へ拡張し、外挿失敗/ansatz 依存を “手続き系統” として固定する。

作業：
- `scripts/quantum/condensed_silicon_heat_capacity_holdout_splits.py`：
  - JANAF Si Cp(T) を温度帯で train/test split し、Debye 1p / Shomate 5p の外挿崩壊を metrics として固定。
  - `output/quantum/condensed_silicon_heat_capacity_holdout_splits_metrics.json`（CSV/PNG）を生成。
- `scripts/quantum/condensed_ofhc_copper_thermal_conductivity_holdout_splits.py`：
  - NIST TRC OFHC Cu κ(T)（RRR=100,300）を温度帯 split し、ansatz class の差が holdout 合否として現れることを metrics として固定。
  - `output/quantum/condensed_ofhc_copper_thermal_conductivity_holdout_splits_metrics.json`（CSV/PNG）を生成。
- `scripts/quantum/condensed_holdout_audit.py`：
  - α(T)+Cp(T)+κ(T) の複数 metrics を横断集約し、`output/quantum/condensed_holdout_audit_summary.json`（CSV/PNG）を改訂固定。
- `scripts/summary/part3_audit.py`：
  - generator に Cp/κ holdout を追加し、`output/summary/part3_audit_summary.json` ok=True を確認（worst_rc=0）。
- `doc/paper/12_part3_quantum.md`：
  - 凝縮系まとめに holdout 拡張の要点（max |z| のレンジ）を追記。
- 再生成・検証：
  - `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`
  - `python -B scripts/summary/paper_qc.py`

結果：
- Phase 7 / Step 7.20.6 を α(T) のみから Cp(T), κ(T) まで拡張し、holdout の監査出力（横断サマリ）を改訂固定。
- Part III publish HTML を更新し、paper_qc ok=True、publish HTML に `Step` が出ないことを維持。

[work] 2026-02-10T11:53:48Z Phase 7 / Step 7.20.6: 物性/熱 holdout を Si Cp(T) と OFHC Cu κ(T) へ拡張し、condensed_holdout_audit_summary.json へ横断集約。part3_audit ok=True（worst_rc=0）と Part III publish 再生成＋paper_qc ok=True を確認。

## 2026-02-10（UTC） Part III 追加監査：Si α(T) を「holdout-ok 例」まで引き上げ（DOS+γ(ω)基底）し、監査へ統合

目的：
- 物性/熱の温度帯 holdout を「失敗のカタログ」だけでなく、一次拘束を足した最小拡張で holdout を通る例も固定し、監査の説得力（“恣意的レンジ選択”への反証）を上げる。

作業：
- `scripts/quantum/condensed_silicon_thermal_expansion_gruneisen_phonon_dos_mode_gamma_model.py`：
  - phonon DOS 重み＋INS由来の mode-dependent ω(T)（Kim2015 Fig.2）＋体積弾性率 B(T) を一次拘束として凍結し、低次元 γ(ω) 基底（pwlinear_split_leaky; ε=0.24, warp=1.32）で重み付きLSを実行。
  - 出力：`output/quantum/condensed_silicon_thermal_expansion_gruneisen_phonon_dos_mode_gamma_gamma_omega_pwlinear_split_leaky_mode_softening_kim2015_fig2_bulkmodulus_ridge1e-06_leak2p40e-01_warp1p32_model_metrics.json`（strict_ok=True, holdout_ok=True）。
- `scripts/quantum/condensed_holdout_audit.py`：
  - 上記の “holdout_splits + falsification” 形式の metrics JSON を追加で取り込み、横断監査に統合（datasets_n=4）。
  - `condensed_holdout_audit_summary.json` に strict_ok/holdout_ok を併記（このモデルのみ）。
- `scripts/summary/part3_audit.py`：
  - generator に上記 α(T) の DOS+γ(ω) モデルを追加し、1コマンド監査で欠損が出ないようにした（generators_ran=13; worst_rc=0）。
- `doc/paper/12_part3_quantum.md`：
  - 凝縮系まとめの holdout サマリを更新（最小Debye+Einsteinの崩壊と、DOS+γ(ω)基底のholdout-ok例を対比）。
- 再生成・検証：
  - `python -B scripts/summary/part3_audit.py`（ok=True）
  - `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`
  - `python -B scripts/summary/paper_qc.py`（ok=True、publish HTML の `Step` は 0件）

結果：
- Si α(T) について、一次拘束を増やした低次元 γ(ω) 基底で strict+holdout を満たす例を固定し、condensed holdout 監査へ統合した。
- Part III publish にも反映し、監査ハーネス（part3_audit）を ok=True のまま維持。

[work] 2026-02-10T12:21:54Z Phase 7 / Step 7.20.6: Si α(T) を DOS+γ(ω) 基底で holdout-ok 例まで固定し、condensed_holdout_audit と part3_audit へ統合。Part III publish 再生成＋paper_qc ok=True を確認。

## 2026-02-10（UTC） Part III 追加監査：Si Cp(T) に “hybrid frozen” の holdout-ok 例を追加（Debye low-T minimax + WebBook Shomate）

目的：
- Cp(T) の温度帯 holdout を「崩壊カタログ」だけでなく、一次拘束を足した最小拡張で holdout を通る例も固定し、物性/熱監査の説得力（“恣意的レンジ選択”への反証）を上げる。

作業：
- `scripts/quantum/condensed_silicon_heat_capacity_holdout_splits.py`：
  - WebBook condensed Si Shomate（solid; 298–1685 K）を一次拘束として読み込み。
  - 低温帯（100–300 K）で max|z| を最小化する minimax で Debye θ_D を凍結。
  - “debye_lowT_minimax_plus_shomate_frozen” を追加し、両 split で test max|z|≤3 を達成。
- `scripts/quantum/condensed_holdout_audit.py`：
  - Cp(T) の best model が hybrid frozen となるよう横断サマリを更新。
- `doc/paper/12_part3_quantum.md`：
  - 凝縮系 holdout 要約を更新（Cp(T) の holdout-ok 例を追記）。
- 再生成・検証：
  - `python -B scripts/quantum/condensed_silicon_heat_capacity_holdout_splits.py`
  - `python -B scripts/quantum/condensed_holdout_audit.py`
  - `python -B scripts/summary/part3_audit.py`（ok=True）
  - `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`
  - `python -B scripts/summary/paper_qc.py`（ok=True）

結果：
- Si Cp(T) の温度帯 holdout で “hybrid frozen” が両 split で max|z|≤3 を満たすことを固定。
- Part III publish HTML を更新し、paper_qc ok=True（`Step` 0件）を維持。

[work] 2026-02-10T12:57:08Z Phase 7 / Step 7.20.6: Si Cp(T) に Debye low-T minimax + WebBook Shomate の hybrid frozen を追加し、strict+holdout ok 例を固定。condensed_holdout_audit/part3_audit/paper_build/paper_qc ok を確認。

## 2026-02-10（UTC） Part III 追加監査：物性/熱 holdout の運用ゲート統一（audit_gates；minimax推奨モデル＋strict/holdout）

目的：
- 物性/熱の温度帯 holdout 監査を、複数dataset（α/Cp/κ）で同一フォーマットの pass/fail（strict/holdout）へ落とし、論文本文の “holdout-ok” 記述と出力（監査）を一致させる。

作業：
- `scripts/quantum/condensed_holdout_audit.py`：
  - 各datasetについて、split×model の `max|z|` と `reduced χ²` を横断集約し、運用ゲート `max|z|≤3`（補助：`reduced χ²≤9`）で strict/holdout を機械判定できる `audit_gates` を追加。
  - minimax（split横断で worst-case の test max|z| を最小）で推奨モデルを1つ決め、datasetごとの holdout-ok 判定を固定。
  - 出力：`output/quantum/condensed_holdout_audit_summary.json` / `...csv` / `...png` を更新。
- `doc/paper/12_part3_quantum.md`：
  - 凝縮系まとめ（4.2.14）に、holdout-ok の運用ゲート（`max|z|≤3`＋補助 `reduced χ²`）を1行で明記。
- 再生成・検証：
  - `python -B scripts/summary/part3_audit.py`（ok=True）
  - `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`
  - `python -B scripts/summary/paper_qc.py`（ok=True；publish HTML の `Step` は 0件）

結果：
- 物性/熱 holdout 監査に `audit_gates`（運用ゲート＋minimax推奨モデル）を追加し、Part III 本文の “holdout-ok” 記述と監査出力を揃えた。
- Part III publish HTML を再生成し、paper_qc / part3_audit ok=True を維持した。

[work] 2026-02-10T13:37:50Z Phase 7 / Step 7.20.6: condensed_holdout_audit に audit_gates（運用ゲート＋minimax推奨モデル）を追加し、Part III 本文（4.2.14）へ holdout-ok の運用ゲートを明記。part3_audit ok=True と Part III publish 再生成＋paper_qc ok=True を確認。

## 2026-02-10（UTC） Part III 追加監査：物性/熱 holdout の対象を B(T) へ拡張（Si bulk modulus）

目的：
- 温度帯 holdout 監査の対象を拡張し、物性/熱の「レンジ依存（手続き系統）」を追加のターゲットでも固定できる形にする。

作業：
- `scripts/quantum/condensed_silicon_bulk_modulus_holdout_splits.py`：
  - Ioffe の弾性定数（C11/C12）由来の B(T) を参照曲線として用い、温度帯 split（低温→高温／高温→低温）の holdout を追加。
  - 出力：`output/quantum/condensed_silicon_bulk_modulus_holdout_splits_metrics.json`（CSV/PNG）を生成。
- `scripts/quantum/condensed_holdout_audit.py`：
  - B(T) を横断サマリへ追加（datasets_n=5）。
  - minimax 推奨モデルの選択で 0.0 を誤って無限大扱いしてしまう不具合を修正（0.0 を正しく評価）。
- `scripts/summary/part3_audit.py`：
  - generator に B(T) holdout を追加し、監査ハーネスを更新。
- 再生成・検証：
  - `python -B scripts/summary/part3_audit.py`（ok=True）
  - `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`
  - `python -B scripts/summary/paper_qc.py`（ok=True；publish HTML の `Step` は 0件）

結果：
- 物性/熱 holdout 監査に Si B(T) を追加し、横断サマリ（audit_gates）で機械判定できる対象を拡張した。
- Part III publish を再生成し、監査ハーネス（part3_audit）と QA（paper_qc）ok=True を維持した。

[work] 2026-02-10T14:05:43Z Phase 7 / Step 7.20.6: Si B(T) の温度帯 holdout を追加し、condensed_holdout_audit/part3_audit/paper_build/paper_qc の ok を確認（publish HTML の Step 0件を維持）。

## 2026-02-10（UTC） Part I 改稿：Part III 整合のため「contract」化を強化（本文から .json の内部パスを排除）

目的：
- Part III の検証が進んだ現状と矛盾しないよう、Part I を「コア定義＋凍結＋反証条件（contract）」としてシンプルに保つ。
- 公開論文（publish）で `.json` などの内部ファイル名が読者の理解を妨げないよう、本文は言葉による説明へ統一し、内部パスは INTERNAL_ONLY へ退避する。

作業：
- `doc/paper/10_part1_core_theory.md`：
  - 凍結（β）・反証条件・一次ソース/manifest の説明を「凍結パラメータ集／反証条件パック／manifest」として言語化し、本文の `.json` パス表記を削除（INTERNAL_ONLY に退避）。
  - 量子（2.8）を「最小辞書」として整理し、過剰な解釈断定を避けた上で selection を追加。
- `doc/paper/05_definitions.md`：
  - 自由度台帳と β の注記から `.json` パス表記を削除（INTERNAL_ONLY に退避）。
- 再生成・検証：
  - `python -B scripts/summary/paper_build.py --profile paper --mode publish --outdir output/summary --skip-docx`
  - `python -B scripts/summary/paper_qc.py`（ok=True）
  - `rg -n "\\.json" output/summary/pmodel_paper.html`（no matches）

結果：
- Part I（publish）本文から `.json` の内部パス表記を排除し、Part III と同じ方針（本文は意味、パスは再現性/内部）へ統一した。
- Part I の内容が「コア定義＋contract」の位置づけとして読みやすくなり、Part III 側の進展と矛盾しにくい形にした。

[work] 2026-02-10T15:10:01Z Phase 8 / Step 8.2.11: Part I（コア理論）で残っていた .json 内部パス表記を本文表示から除去し、言葉による説明へ統一（INTERNAL_ONLY へ退避）。paper_build（paper）で pmodel_paper.html を再生成し、paper_qc ok=True と .json no matches を確認。

## 2026-02-10（UTC） Part I 改稿：量子（2.8）を「最小辞書」へ圧縮（粒子＋selectionのみ）

目的：
- Part III（量子監査）が成熟した現状で、Part I の量子節が機構的主張や用語定義の過剰を含み、整合性リスクにならないようにする。
- Part I は「コア写像＋凍結＋反証条件（contract）」に徹し、量子の詳細語彙（波動関数/測定/もつれ等）は Part III の監査I/Fと反証条件へ委譲する。

作業：
- `doc/paper/10_part1_core_theory.md`：
  - 2.8 を「接続点：selection」として整理し、Part III への接続語彙を **粒子**（束縛モード）と **selection**（観測手続きが統計母集団を動かし得る入口）に限定。
  - 波動関数/測定/もつれ等の語彙は Part III 側で操作的に定義し、反証条件パックへ落とす方針を明記。
- 再生成・検証：
  - `python -B scripts/summary/paper_build.py --profile paper --mode publish --outdir output/summary --skip-docx`
  - `python -B scripts/summary/paper_qc.py`（ok=True）

結果：
- Part I の量子節を「最小辞書」へ圧縮し、Part III の監査・反証条件と矛盾しにくい形へ寄せた。

[work] 2026-02-10T15:42:27Z Phase 8 / Step 8.2.12: Part I 2.8（量子）を最小辞書（粒子＋selection）へ圧縮し、波動関数/測定/もつれ等は Part III へ委譲。paper_build（paper）再生成＋paper_qc ok=True を確認。

## 2026-02-11（UTC） Si抵抗率（NBS IR 74-496）抽出パース修正＋Bell 系統誤差バジェット（drift vs sweep）の説明補強

目的：
- NBS IR 74-496 Appendix E の抵抗率テーブル抽出で、科学記数法が分割され誤値/欠損が混入していたため、抽出の信頼性を上げる。
- Bell の15項目系統誤差バジェットを「選択自由度（sweep幅）」と「freeze 近傍 drift」の違いが読める形にして、S>2 の議論が「宣言」に留まらないよう補強する。

作業：
- `scripts/quantum/fetch_silicon_resistivity_nbsir74_496_sources.py`：
  - `_parse_range_row()` に数値修復（split scientific notation repair）を追加し、`1. 910-01` / `1.905 -01` / `1.914- 01` 等を正しく解釈できるように修正。
- 再生成：
  - `python -B scripts/quantum/fetch_silicon_resistivity_nbsir74_496_sources.py --offline`（再抽出）
  - `python -B scripts/quantum/condensed_silicon_resistivity_temperature_coefficient_baseline.py`（baseline更新）
  - `python -B scripts/quantum/condensed_falsification_pack.py`（pack更新）
  - `python -B scripts/quantum/frozen_parameters_quantum.py`（sha256参照を更新）
- `doc/paper/12_part3_quantum.md`：
  - Bell 4.2.1 に「sweep幅と drift」を区別する説明と具体例（Weihs 自然窓で `Δ|S|≈0.0013`）を追記。
- 再生成・検証：
  - `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`
  - `python -B scripts/summary/paper_qc.py`（ok=True）
  - `python -B scripts/summary/part3_audit.py`（ok=True）

結果：
- 抵抗率抽出テーブルで `rho_lo/rho_hi` が欠損/誤値になる問題を解消し、baseline と pack を再固定した。
- Part III Bell 節で、selectionノブの自由度（sweep幅）と freeze 近傍 drift の寄与が区別できる説明を追加した。
- Part III publish HTML を再生成し、paper_qc / part3_audit ok=True を確認した。

[work] 2026-02-11T00:34:24Z Phase 7 / Step 7.14.4（改訂）＋Step 7.16.8（改訂）：抵抗率抽出の数値パースを修正して baseline/pack を更新。Part III 4.2.1 に drift vs sweep の読み方（Weihs の例：`Δ|S|≈0.0013`）を追記。part3_audit/paper_qc ok=True を確認。

## 2026-02-11（UTC） Bell 系統誤差バジェットの解釈補強（装置/補正 vs selection を分離）

目的：
- Bell 節が「selection入口を定量化する」という宣言に留まらないよう、15項目バジェットの読み方を補強する。
- window/offset 等の selection ノブと、dead time/効率drift 等の「装置/補正」側を分け、S>2 の議論で何が支配的かを数値で示す。

作業：
- `doc/paper/12_part3_quantum.md`：
  - 4.2.1 に、selection項目を除いた「装置/補正」側の合成寄与（L2/L1）表（Weihs/Delft）を追記。
- 再生成・検証：
  - `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`
  - `python -B scripts/summary/paper_qc.py`（ok=True）
  - `python -B scripts/summary/part3_audit.py`（ok=True）

結果：
- Part III Bell 節で、selection と「装置/補正」側の規模感（L2/L1）を併記し、sweep幅（選択自由度）が支配的になり得ることを明確化した。
- Part III publish HTML を再生成し、paper_qc / part3_audit ok=True を維持した。

[work] 2026-02-11T01:47:49Z Phase 7 / Step 7.16.8（改訂）：Part III 4.2.1 に「装置/補正」側の合成寄与（L2/L1）表を追記し、selection と分離して解釈できる形へ補強。paper_build（part3_quantum）再生成＋paper_qc/part3_audit ok=True を確認。

## 2026-02-11（UTC） Part III 可読性改善（凝縮系の長い ansatz ログを補遺へ退避）

目的：
- 公開版 Part III で、凝縮系の長い ansatz 試験ログを本文から分離し、主線（ベースライン＋棄却条件＋要約）を太くする。
- build/QC が補遺も含めて一括で lint/QC できる形にする。

作業：
- `doc/paper/12_part3_quantum.md`：
  - Si α(T) の詳細 ansatz 試験ログ（旧「補遺A」）を本文から退避し、本文はベースライン＋棄却条件のみを維持。
- `doc/paper/12_part3_quantum_appendix_a.md`：
  - 退避した ansatz 試験ログを「補遺A」として追加。
- `scripts/summary/paper_html.py`：
  - Part III（publish）のHTMLで、補遺Aを本文と分離した付録セクションとして表示するように更新。
- `scripts/summary/paper_build.py` / `scripts/summary/paper_qc.py`：
  - Part III の lint strict 対象に補遺A markdown を追加。
- 再生成・検証：
  - `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`
  - `python -B scripts/summary/paper_qc.py`（ok=True）
  - `python -B scripts/summary/part3_audit.py`（ok=True）

結果：
- Part III publish HTML で凝縮系の詳細ログが本文から分離され、読みやすさを維持したまま監査/再現の補助情報を付録として残せる形になった。
- paper_build/paper_qc の lint が補遺Aも対象になり、引用/図/参照の崩れを機械検出できるようにした。

[work] 2026-02-11T02:15:59Z Phase 7 / Step 7.20.8（改訂）：凝縮系の長い ansatz 試験ログ（Si α(T)）を補遺Aへ退避し、Part III publish HTML を本文と分離した付録セクションへ整理。paper_build/paper_qc/part3_audit ok=True を確認。

## 2026-02-11（UTC） 設計方針変更：論文本文から file/folder/script を排除し、検証用資料へ集約

目的：
- Part I–III の論文（publish）では、具体的なファイル名・フォルダ名・スクリプト名を本文に書かない方針へ変更する。
- その代わり、再現コマンド／固定アーティファクト一覧／監査ゲート等は「検証用資料（Verification Materials）」へ集約し、論文は参照のみを載せる。
- publish HTML に repo-path が混入した場合に機械検出できるよう、QCを強化する。

作業：
- 検証用資料を追加：
  - `doc/verification/VERIFICATION_MATERIALS.md`（再現コマンド・固定アーティファクト一覧・GitHub公開案の集約）
- 論文（Part I–III）本文から file/folder/script 表記を除去し、検証用資料への参照へ置換：
  - `doc/paper/10_part1_core_theory.md`
  - `doc/paper/11_part2_astrophysics.md`
  - `doc/paper/12_part3_quantum.md`
  - `doc/paper/07_llr_appendix.md`（LLR付録の再現コマンドを置換）
- 一次ソース一覧（付録）からローカル固定入力パスを除去（量子核のキャッシュ表記）：
  - `doc/paper/20_data_sources.md`
- 参考文献に Verification Materials の参照キーを追加：
  - `doc/paper/30_references.md`（`[PModelVerificationMaterials]`）
- publish HTML の repo-path 混入を paper_qc で検出：
  - `scripts/summary/paper_qc.py`（`paper_html_no_repo_paths` / `part2_html_no_repo_paths` / `part3_html_no_repo_paths`）
- 再生成・検証：
  - `python -B scripts/summary/paper_build.py --profile paper --mode publish --outdir output/summary --skip-docx`
  - `python -B scripts/summary/paper_build.py --profile part2_astrophysics --mode publish --outdir output/summary --skip-docx`
  - `python -B scripts/summary/paper_build.py --profile part3_quantum --mode publish --outdir output/summary --skip-docx`
  - `python -B scripts/summary/paper_qc.py`（ok=True）
  - `python -B scripts/summary/part3_audit.py`（ok=True）

結果：
- Part I–III の publish HTML から、具体的な repo 内パスや実行コマンドの露出を排除し、検証用資料への参照に統一できた。
- publish HTML に `output/`/`data/`/`scripts/`/`doc/` が混入した場合に `paper_qc` が失敗するため、以後の再発を自動検出できる。

[work] 2026-02-11T02:47:38Z Phase 8 / Step 8.2.13：設計方針変更として、論文本文（publish）から file/folder/script 表記を排除し、`doc/verification/VERIFICATION_MATERIALS.md` へ集約。paper_qc に repo-path 混入検出を追加し、paper_build/paper_qc/part3_audit ok=True を確認。

## 2026-02-11（UTC） ロードマップ追記：Verification Materials の公開参照（URL/DOI）固定

目的：
- 論文（Part I–III）から参照する検証用資料（Verification Materials）の参照先を、URL/DOIで固定できる形にする。
- 参考文献キー `[PModelVerificationMaterials]` の Web 欄が `TBD` のまま残ることを防ぎ、公開時の最終手順をロードマップで明示する。

作業：
- `doc/ROADMAP.md`：
  - 8.2.14（公開参照の固定）を追加（準備中）。
- `doc/STATUS.md` / `doc/AI_CONTEXT_MIN.json`：
  - 次タスクとして 8.2.14 を明示し、状態辞書を同期。

結果：
- 公開先（GitHub Releases / DOI）を決めた段階で、論文側の参照キーと検証用資料の参照先を一括で確定できる状態になった。

[work] 2026-02-11T02:56:28Z Phase 8 / Step 8.2.14（準備中）：Verification Materials の公開先（URL/DOI）固定タスクをロードマップへ追加し、STATUS/AI_CONTEXT を同期。

## 2026-02-11（UTC） GitHub 公開準備：README（英語）追加＋`.gitignore` 整備＋ローカル git 初期化

目的：
- GitHub 上に P-model プロジェクトを作成する前段として、リポジトリの入口（README）を用意し、巨大生成物/データを誤ってコミットしない最小ガード（.gitignore）を入れる。
- 次タスク（Step 8.2.14）で「Verification Materials の参照先（URL/DOI）を固定」できる状態にする。

作業：
- 追加：`README.md`（英語でプロジェクトの意味・位置づけ・再現資料の方針を記述）
- 追加：`.gitignore`（`output/` を原則無視、`output/summary/build_materials.bat` は例外で追跡。`data/` は manifest JSON のみ追跡）
- `git init -b main` を実行し、ローカル git リポジトリを初期化

結果：
- GitHub でリポジトリを作成して remote を設定すれば、そのまま初回 push ができる入口が整った。
- 次は GitHub 側で repo を作成し、`doc/verification/VERIFICATION_MATERIALS.md` と参考文献キー `[PModelVerificationMaterials]` の `TBD` を固定URL/DOIに置換する（Step 8.2.14）。

[work] 2026-02-11T03:11:03Z Phase 8 / Step 8.2.14（進行中）：README（英語）追加＋`.gitignore` 整備＋ローカル git 初期化（main）。次：GitHub repo作成→URL/DOI確定→paper参照キー更新。

## 2026-02-11（UTC） GitHub repo 作成＋Verification Materials 参照先の固定（`TBD` 解消）

目的：
- GitHub 上に P-model プロジェクト（公開repo）を作成し、論文から参照する検証用資料（Verification Materials）の参照先を固定する。

作業：
- GitHub repo を作成：`https://github.com/EnterOgawa/p-model`
  - 初回 commit を push（default branch: `main`）。
- `doc/verification/VERIFICATION_MATERIALS.md`：
  - GitHub / Releases の参照先を固定URLで記載し、`TBD` を解消。
- `doc/paper/30_references.md`：
  - `[PModelVerificationMaterials]` の Web 欄を固定URL（repo + releases）へ更新し、`TBD` を解消。

結果：
- 論文本文（Part I–III）から参照される検証用資料の参照先が固定でき、公開時の引用（URL/将来のDOI）を同一キーで更新できる状態になった。

[work] 2026-02-11T04:47:59Z Phase 8 / Step 8.2.14（完了）：GitHub repo（EnterOgawa/p-model）を作成して初回pushし、Verification Materials と参考文献キー `[PModelVerificationMaterials]` の `TBD` を固定URLへ置換。
