# P-model × ベルテスト：局所P構造・CHSH・棄却条件（メモ）

## 0) 位置づけ

この文書は、Phase 7 の目的（宇宙物理で確立した枠組みを量子の観測手続きへ接続）に沿って、
P-model がベルテスト（CHSH）に対して何を主張し、何を主張しないかを整理する。

- 主張しない：
  - 「非局所性が存在しない」等の断定
  - 量子力学の形式を否定すること
- 主張したい：
  - ベル不等式にデータを代入する前に、time-tag / trial 定義 / post-selection が置く前提を一次データで検証する必要がある
  - P-model（時間波密度P）の立場では、検出時刻（time-tag）に入る時間構造が観測統計を変える入口を提供し得る

---

## 1) 観測される量（ベル実験のデータ構造）

多くのベル実験データは、少なくとも以下を含む：

- 設定：a, b（各サイドの測定条件）
- 結果：x, y（±1、あるいは click/no-click 等）
- 時刻：t_A, t_B（time-tag）、または trial/event-ready を定義する時刻情報
- 選別規則：どのイベントを「ペア」「有効trial」として採用するか（coincidence window / event-ready window / readout window 等）

ここで重要なのは、統計量がしばしば **条件付き集合**で計算される点である。

---

## 2) P-model の最小仮説（量子側に持ち込む形）

P-model の基礎は「時間は物理的実体（場）であり、P(x)（時間波密度）が局所の時間構造を規定する」という仮定である。
量子実験に持ち込むときの最小形は次のように置ける：

- 各サイドの検出時刻は、装置遅延（光路・電子回路・閾値処理）と結合して変動する
- その変動は設定（a,b）に依存し得る（光学角度の変更＝光路差／電子処理分岐など）
- さらに、同期信号や共通の参照（10 MHz, sync pulse 等）により、両サイドの時刻構造には共通成分が入り得る

このとき、（局所モデルであっても）time-tag を用いた選別が中立でない入口が生じる。

---

## 3) 「局所P構造の共有」と「隠れた相関」の最小モデル

最小モデルとして、各サイドの検出時刻を

$$
t_A = t_0 + \\Delta_A(a,\\lambda,\\eta_A), \\quad
t_B = t_0 + \\Delta_B(b,\\lambda,\\eta_B)
$$

と置く。

- t0：共通の参照時刻（source/sync に由来）
- λ：共通原因（source 側の状態、装置のゆっくりしたドリフト、共通参照の位相など）
- η：局所雑音
- Δ_A, Δ_B：設定に依存し得る遅延（装置遅延×局所時間構造の反映）

「局所P構造の共有」は、t0 や λ の中に **共通の時間構造成分**（例：共通クロック、sync pulse のジッタ等）が入ることに相当する。
重要なのは、これは **超光速通信を仮定しない**（共通原因／事前に配布された同期に限る）という点である。

---

## 4) 独立確率仮定が破れる条件（選別関数）

time-tag に基づく選別（coincidence など）を

$$
s = 1\\left[|t_A - t_B - \\delta| < \\Delta\\right]
$$

と置くと、観測される相関は一般に条件付き平均

$$
E_{\\text{obs}}(a,b)=\\mathbb{E}[xy\\mid s=1,a,b]
$$

になる。

このとき、採用確率

$$
w_{ab}(\\lambda) = \\Pr(s=1\\mid a,b,\\lambda)
$$

が (a,b) に依存すると、(a,b) ごとに有効母集団 ρ_ab(λ) が変化し、
CHSH の標準導出が置く「同一母集団」仮定が成立しない（詳細は `doc/quantum/06_chsh_assumptions_and_selection.md`）。

---

## 5) CHSH（S ≤ 2）が “破れる” とは何か（P-model側の言い方）

P-model の立場での要点は、

- “局所モデル + 選別” の観測統計では、CHSH の不等式を適用できる前提が崩れ得る
- したがって、S > 2 を見ても直ちに「非局所性」を結論しない

という整理である。

再現可能な toy として、局所出力 + 局所 time-tag + coincidence 選別で S(Δt) が変化し得る例を固定してある：

- `python -B scripts/quantum/bell_time_tag_selection_sweep.py`

---

## 6) 量子力学の予測（S = 2√2）との整合性

量子力学の標準設定（例：0°, 45°, 22.5°, 67.5°）では、

$$
S_{\\text{QM}} = 2\\sqrt{2}
$$

が得られる。

P-model の量子解釈（このPhaseの狙い）は、これを否定するのではなく、
「観測統計が条件付き集合で計算されるなら、S の値は選別規則に依存し得る」ことを検証対象として取り出す。

実データの入口として、
- NIST belltestdata（time-tag 生ログ）
- Delft/Hensen 2015（trial 定義の表データ）

を本リポジトリに統合している（次節）。

---

## 7) 一次データでの検証（現状）

### 7.1 NIST belltestdata（photon / time-tag）
- 再解析（最小）：PPS整列＋click delay（sync基準）＋window sweep
- 出力：`output/quantum/nist_belltest_time_tag_bias.png`
- 指標：setting による click delay 分布差（KS距離）と、coincidence window 掃引でのペア集合の変化

### 7.2 Delft/Hensen 2015（event-ready / CHSH）
- CHSH S の再現と、event-ready window start の感度（Fig. S3 相当）を固定
- 出力：`output/quantum/delft_hensen2015_chsh.png`

---

## 8) 反証条件（「何が観測されたら棄却か」）

このPhase（量子解釈）の主張は “観測手続き×時間構造の前提検証” にあるため、
反証条件は **選別の入口が無い/効かない**ことを示す方向で定義できる。

代表例（少なくとも一つが強く成立すれば、この解釈は棄却される）：

1. **選別規則を変えても統計量が不変**  
   coincidence window / pairing algorithm / event-ready window / readout window を十分に変えても、S が統計誤差内で不変。
2. **time-tag 分布が設定に依存しない**  
   click delay（sync基準）等の分布が settings に対して差を持たない（KS≈0 かつ十分な統計で上限が小さい）。
3. **trial-based（事前定義のtrial）でも同じ違反が再現**  
   time-tag による “ペアリング” を介さない trial 定義で、S が同等に再現し、かつ選別が設定と独立であることが示される。
4. **遅延挿入テストで予言が外れる**  
   片側に既知の遅延（光路/電子）を挿入し、選別規則に対する依存が出ない（あるいは対称性が破れない）。

これらは “非局所性の有無” を直接論じるものではなく、
P-model による「ベル違反の再解釈」が成立する入口（selection の条件依存）が実験的に否定された、という意味での棄却である。

