{
  "generated_utc": "2026-01-24T03:13:12.286684+00:00",
  "phase": {
    "phase": 6,
    "step": "6.2.2",
    "name": "弱場テスト系統分解テンプレ固定"
  },
  "source_matrix": {
    "path": "output/public/weak_field/weak_field_test_matrix.json",
    "generated_utc": "2026-01-24T02:53:20.477396+00:00"
  },
  "templates": [
    {
      "test_id": "cassini_sce1_doppler",
      "topic": "cassini",
      "name": "Cassini SCE1（太陽会合）: ドップラー y(t)",
      "main_script": {
        "path": "scripts/cassini/cassini_fig2_overlay.py",
        "repro": "python -B scripts/cassini/cassini_fig2_overlay.py --beta <frozen>",
        "role": "main_offline"
      },
      "primary_outputs": [
        "output/public/cassini/cassini_fig2_overlay_full.png",
        "output/public/cassini/cassini_fig2_overlay_zoom10d.png",
        "output/public/cassini/cassini_fig2_residuals.png",
        "output/public/cassini/cassini_fig2_metrics.csv",
        "output/public/cassini/cassini_fig2_run_metadata.json",
        "output/public/cassini/cassini_beta_sweep_rmse.csv",
        "output/public/cassini/cassini_beta_sweep_rmse.png"
      ],
      "systematics": [
        {
          "id": "cassini_band_plasma",
          "title": "周波数帯と太陽プラズマ補正（Ka/X, dual-frequency）",
          "category": "instrument_propagation",
          "status": "supported",
          "knobs": [
            {
              "key": "tdf_downlink_band",
              "type": "categorical",
              "apply": {
                "mode": "cli_flag",
                "flag": "--tdf-downlink-band",
                "script": "scripts/cassini/cassini_fig2_overlay.py"
              },
              "note": "PDS TDF: downlink band filter",
              "values": [
                "ka",
                "x",
                "any"
              ],
              "default": "ka"
            },
            {
              "key": "tdf_plasma_correct",
              "type": "bool",
              "apply": {
                "mode": "cli_flag",
                "flag": "--tdf-plasma-correct/--no-tdf-plasma-correct",
                "script": "scripts/cassini/cassini_fig2_overlay.py"
              },
              "note": "PDS TDF: Ka+X が揃う区間でコロナ（プラズマ）成分を除去",
              "default": true
            },
            {
              "key": "tdf_plasma_fill_mode",
              "type": "categorical",
              "apply": {
                "mode": "cli_flag",
                "flag": "--tdf-plasma-fill-mode",
                "script": "scripts/cassini/cassini_fig2_overlay.py"
              },
              "note": "dual=共通ビンのみ / merged=欠測を単独バンドで補完",
              "values": [
                "dual",
                "merged"
              ],
              "default": "merged"
            }
          ],
          "expected_effect": [
            {
              "observable": "y(t)",
              "metric": "RMSE / residual structure near conjunction",
              "direction": "ambiguous",
              "note": "プラズマ補正やバンド選択により、中心付近の形状・ノイズが変化し得る。"
            }
          ],
          "diagnostics": {
            "outputs": [
              "output/public/cassini/cassini_fig2_metrics.csv",
              "output/public/cassini/cassini_fig2_residuals.png",
              "output/public/cassini/cassini_fig2_overlay_zoom10d.png"
            ],
            "what_to_check": [
              "中心（太陽会合）付近で残差が系統的に曲がる/非対称になるか",
              "βスイープRMSEの最小位置が安定か（ノイズ・選別の付け替えでβが動かないか）"
            ]
          },
          "notes": "Cassini は β 拘束の主力。Phase 6.2 では『バンド/補正/選別』の付け替えで整合を作れないことを確認する。"
        },
        {
          "id": "cassini_data_selection",
          "title": "データ選別（source, 時間窓, station/filter）",
          "category": "data_selection",
          "status": "supported",
          "knobs": [
            {
              "key": "source",
              "type": "categorical",
              "apply": {
                "mode": "cli_flag",
                "flag": "--source",
                "script": "scripts/cassini/cassini_fig2_overlay.py"
              },
              "note": "観測系列の取り方（PDS一次データTDF/ODF or 論文図デジタイズ）",
              "values": [
                "pds_tdf",
                "pds_tdf_raw",
                "pds_odf_raw",
                "digitized"
              ],
              "default": "pds_tdf"
            },
            {
              "key": "tdf_sample_type",
              "type": "categorical",
              "apply": {
                "mode": "cli_flag",
                "flag": "--tdf-sample-type",
                "script": "scripts/cassini/cassini_fig2_overlay.py"
              },
              "note": "high-rate/low-rate Doppler",
              "values": [
                "high",
                "low",
                "any"
              ],
              "default": "high"
            },
            {
              "key": "tdf_stations",
              "type": "string",
              "apply": {
                "mode": "cli_flag",
                "flag": "--tdf-stations",
                "script": "scripts/cassini/cassini_fig2_overlay.py"
              },
              "note": "comma-separated station IDs（未指定=全て）"
            }
          ],
          "expected_effect": [
            {
              "observable": "y(t)",
              "metric": "coverage / RMSE / correlation",
              "direction": "ambiguous",
              "note": "データ系列の定義やフィルタでノイズ/欠測/バイアスが変わる。"
            }
          ],
          "diagnostics": {
            "outputs": [
              "output/public/cassini/cassini_fig2_metrics.csv",
              "output/public/cassini/cassini_fig2_residuals.png",
              "output/public/cassini/cassini_fig2_overlay_zoom10d.png"
            ],
            "what_to_check": [
              "source 切替で形状が本質的に変わるか（digitized は参照用）",
              "station/filter 切替で β 推定が大きく動かないか"
            ]
          },
          "notes": ""
        },
        {
          "id": "cassini_noise_model",
          "title": "ノイズモデル（binning/stat, outlier filters, detrend）",
          "category": "noise_model",
          "status": "supported",
          "knobs": [
            {
              "key": "tdf_bin_seconds",
              "type": "int",
              "apply": {
                "mode": "cli_flag",
                "flag": "--tdf-bin-seconds",
                "script": "scripts/cassini/cassini_fig2_overlay.py"
              },
              "note": "平滑化の時間ビン幅 [秒]",
              "default": 3600
            },
            {
              "key": "tdf_bin_stat",
              "type": "categorical",
              "apply": {
                "mode": "cli_flag",
                "flag": "--tdf-bin-stat",
                "script": "scripts/cassini/cassini_fig2_overlay.py"
              },
              "note": "時間ビン内の代表値",
              "values": [
                "mean",
                "median"
              ],
              "default": "median"
            },
            {
              "key": "tdf_detrend_poly_order",
              "type": "int",
              "apply": {
                "mode": "cli_flag",
                "flag": "--tdf-detrend-poly-order",
                "script": "scripts/cassini/cassini_fig2_overlay.py"
              },
              "note": "デトレンドの多項式次数",
              "default": 0
            },
            {
              "key": "tdf_detrend_exclude_inner_days",
              "type": "float",
              "apply": {
                "mode": "cli_flag",
                "flag": "--tdf-detrend-exclude-inner-days",
                "script": "scripts/cassini/cassini_fig2_overlay.py"
              },
              "note": "中心部を除外してデトレンド（|t|<days）",
              "default": 5.0
            }
          ],
          "expected_effect": [
            {
              "observable": "residuals",
              "metric": "RMSE / residual width",
              "direction": "decrease",
              "note": "binning を強くすると見かけのノイズは減るが、系統形状の破壊にも注意。"
            }
          ],
          "diagnostics": {
            "outputs": [
              "output/public/cassini/cassini_fig2_metrics.csv",
              "output/public/cassini/cassini_fig2_residuals.png",
              "output/public/cassini/cassini_fig2_overlay_zoom10d.png"
            ],
            "what_to_check": [
              "binning や detrend の強さで中心の形状（時間対称性/尖り）が崩れていないか",
              "“良く見せる”方向の付け替えでβが動いていないか"
            ]
          },
          "notes": ""
        }
      ]
    },
    {
      "test_id": "viking_shapiro_peak",
      "topic": "viking",
      "name": "Viking（地球-火星）: Shapiro遅延（代表ピーク）",
      "main_script": {
        "path": "scripts/viking/viking_shapiro_check.py",
        "repro": "python -B scripts/viking/viking_shapiro_check.py --beta <frozen> [--start ... --stop ... --step ...]",
        "role": "main"
      },
      "primary_outputs": [
        "output/public/viking/viking_shapiro_result.csv",
        "output/public/viking/viking_p_model_vs_measured_no_arrow.png",
        "output/public/viking/P_model_Verification_Full.pptx"
      ],
      "systematics": [
        {
          "id": "viking_peak_selection",
          "title": "幾何ピークの選択（start/stop/step のスキャン）",
          "category": "data_selection",
          "status": "supported",
          "knobs": [
            {
              "key": "start",
              "type": "date_string",
              "apply": {
                "mode": "cli_flag",
                "flag": "--start",
                "script": "scripts/viking/viking_shapiro_check.py"
              },
              "note": "スキャン開始日"
            },
            {
              "key": "stop",
              "type": "date_string",
              "apply": {
                "mode": "cli_flag",
                "flag": "--stop",
                "script": "scripts/viking/viking_shapiro_check.py"
              },
              "note": "スキャン終了日"
            },
            {
              "key": "step",
              "type": "string",
              "apply": {
                "mode": "cli_flag",
                "flag": "--step",
                "script": "scripts/viking/viking_shapiro_check.py"
              },
              "note": "サンプリング間隔（例: '4 h'）"
            }
          ],
          "expected_effect": [
            {
              "observable": "peak Shapiro delay",
              "metric": "max_delay_us",
              "direction": "ambiguous",
              "note": "サンプリング分解能が粗いとピークを外し、最大値が下がる（系統的に過小評価）。"
            }
          ],
          "diagnostics": {
            "outputs": [
              "output/public/viking/viking_shapiro_result.csv",
              "output/public/viking/viking_p_model_vs_measured_no_arrow.png"
            ],
            "what_to_check": [
              "step を細かくしたとき最大値が収束するか（ピーク取りの系統）",
              "HORIZONSキャッシュの有無で結果が変わらないか（再現性）"
            ]
          },
          "notes": ""
        },
        {
          "id": "viking_time_sync_baseline",
          "title": "時刻同期/基線の定義（中心系、光行時間反復）",
          "category": "model_assumption",
          "status": "todo",
          "knobs": [
            {
              "key": "light_time_iteration",
              "type": "bool",
              "apply": {
                "mode": "not_parameterized",
                "note": "現状は同時刻位置で近似（往復光行時間の反復は未実装）"
              },
              "note": "厳密には反復で解く必要がある（ただしオーダー確認では小さい）"
            }
          ],
          "expected_effect": [
            {
              "observable": "Shapiro delay",
              "metric": "systematic bias",
              "direction": "ambiguous",
              "note": "同時刻近似によりピーク時刻/最大値がわずかにずれる可能性。"
            }
          ],
          "diagnostics": {
            "outputs": [
              "output/public/viking/viking_shapiro_result.csv",
              "output/public/viking/viking_p_model_vs_measured_no_arrow.png"
            ],
            "what_to_check": [
              "反復光行時間を入れた場合の差（μsオーダーで十分小さいか）"
            ]
          },
          "notes": "Step 6.2.3 の自動バッチ前に、必要なら viking_shapiro_check.py へ追加する。"
        }
      ]
    },
    {
      "test_id": "mercury_perihelion_precession",
      "topic": "mercury",
      "name": "水星：近日点移動（簡易数値積分）",
      "main_script": {
        "path": "scripts/mercury/mercury_precession_v3.py",
        "repro": "python -B scripts/mercury/mercury_precession_v3.py",
        "role": "main_offline"
      },
      "primary_outputs": [
        "output/public/mercury/mercury_orbit.png",
        "output/public/mercury/mercury_precession_metrics.json",
        "output/public/mercury/mercury_perihelion_shifts.csv"
      ],
      "systematics": [
        {
          "id": "mercury_unmodeled_perturbations",
          "title": "未モデル摂動の境界（他惑星/J2/小天体など）",
          "category": "model_assumption",
          "status": "partial",
          "knobs": [
            {
              "key": "unmodeled_perturbations",
              "type": "enum",
              "apply": {
                "mode": "documentation_only",
                "note": "現状の簡易積分は摂動を入れていない（精密暦ではない）"
              },
              "note": "どの摂動が支配的かを分解し、比較の限界を明示する。",
              "values": [
                "planets",
                "solar_J2",
                "asteroids",
                "post_newtonian_higher_order"
              ]
            }
          ],
          "expected_effect": [
            {
              "observable": "perihelion shift",
              "metric": "arcsec/century",
              "direction": "ambiguous",
              "note": "未モデル摂動は追加の近日点移動を与え、P-model/GRの差分をマスクし得る。"
            }
          ],
          "diagnostics": {
            "outputs": [
              "output/public/mercury/mercury_precession_metrics.json",
              "output/public/mercury/mercury_orbit.png"
            ],
            "what_to_check": [
              "『このスクリプト単体では何を言えて、何を言えないか』の境界を固定する"
            ]
          },
          "notes": ""
        },
        {
          "id": "mercury_numerics",
          "title": "数値積分の分解能（dt, integrator）",
          "category": "numerics",
          "status": "todo",
          "knobs": [
            {
              "key": "dt_seconds",
              "type": "float",
              "apply": {
                "mode": "not_parameterized",
                "note": "現状の dt はスクリプト内定数（CLI化は未実装）"
              },
              "note": "dt を変えて近日点移動が収束することを確認する。"
            }
          ],
          "expected_effect": [
            {
              "observable": "perihelion shift",
              "metric": "stability",
              "direction": "ambiguous",
              "note": "dt が粗いと数値誤差が系統として混入する。"
            }
          ],
          "diagnostics": {
            "outputs": [
              "output/public/mercury/mercury_precession_metrics.json",
              "output/public/mercury/mercury_orbit.png"
            ],
            "what_to_check": [
              "dt を半分にして値が変わらないか（収束性）"
            ]
          },
          "notes": ""
        }
      ]
    },
    {
      "test_id": "gps_satellite_clock",
      "topic": "gps",
      "name": "GPS：衛星時計（IGS精密クロック vs BRDC/P-model）",
      "main_script": {
        "path": "scripts/gps/compare_clocks.py",
        "repro": "python -B scripts/gps/compare_clocks.py",
        "role": "main_offline"
      },
      "primary_outputs": [
        "output/public/gps/summary_batch.csv",
        "output/public/gps/gps_clock_residuals_all_31.png",
        "output/public/gps/gps_residual_compare_G01.png",
        "output/public/gps/gps_rms_compare.png",
        "output/public/gps/gps_relativistic_correction_G02.png",
        "output/public/gps/gps_compare_metrics.json"
      ],
      "systematics": [
        {
          "id": "gps_bias_drift_policy",
          "title": "バイアス+ドリフト除去の前提（デトレンドの取り方）",
          "category": "estimator_policy",
          "status": "partial",
          "knobs": [
            {
              "key": "detrend_policy",
              "type": "enum",
              "apply": {
                "mode": "documentation_only",
                "note": "現状 compare_clocks.py は bias+linear drift を除去（固定）"
              },
              "note": "衛星ごとの定数オフセットと周波数オフセットを除去する前提。",
              "values": [
                "none",
                "bias_only",
                "bias_plus_drift"
              ],
              "default": "bias_plus_drift"
            }
          ],
          "expected_effect": [
            {
              "observable": "clock residuals (IGS - model)",
              "metric": "RMS",
              "direction": "decrease",
              "note": "強いデトレンドほど RMS は下がるが、物理的差分も吸収し得る。"
            }
          ],
          "diagnostics": {
            "outputs": [
              "output/public/gps/summary_batch.csv",
              "output/public/gps/gps_rms_compare.png",
              "output/public/gps/gps_compare_metrics.json"
            ],
            "what_to_check": [
              "同じ detrend で BRDC と P-model を比較しているか（片側だけ有利になっていないか）",
              "detrend を弱めた場合に衛星依存が顕在化するか"
            ]
          },
          "notes": "Step 6.2.3 に向け、detrend を CLI 化して感度試験できる形にするのが望ましい。"
        },
        {
          "id": "gps_rotation_corrections",
          "title": "地球自転補正（基準点/衛星速度の ω×r）",
          "category": "model_assumption",
          "status": "supported",
          "knobs": [
            {
              "key": "ref_include_earth_rotation",
              "type": "bool",
              "apply": {
                "mode": "cli_flag",
                "flag": "--ref-include-earth-rotation",
                "script": "scripts/gps/compare_clocks.py"
              },
              "note": "地上基準点速度に自転を含める",
              "default": false
            },
            {
              "key": "no_sat_earth_rotation",
              "type": "bool",
              "apply": {
                "mode": "cli_flag",
                "flag": "--no-sat-earth-rotation",
                "script": "scripts/gps/compare_clocks.py"
              },
              "note": "衛星速度の ω×r 補正を無効化（デバッグ/系統切り分け）",
              "default": false
            }
          ],
          "expected_effect": [
            {
              "observable": "rate_rel(t)",
              "metric": "systematic drift",
              "direction": "ambiguous",
              "note": "速度推定が変わり、P-modelの相対レートに系統が入る可能性。"
            }
          ],
          "diagnostics": {
            "outputs": [
              "output/public/gps/summary_batch.csv",
              "output/public/gps/gps_rms_compare.png",
              "output/public/gps/gps_compare_metrics.json"
            ],
            "what_to_check": [
              "補正ON/OFFで系統的な差がどの衛星で出るか（衛星依存の切り分け）"
            ]
          },
          "notes": ""
        },
        {
          "id": "gps_satellite_dependence",
          "title": "衛星依存（衛星ごとのRMS分布、外れ衛星）",
          "category": "data_selection",
          "status": "supported",
          "knobs": [
            {
              "key": "satellite_selection",
              "type": "enum",
              "apply": {
                "mode": "not_parameterized",
                "note": "現状は共通集合の全G衛星。除外/限定はコード変更が必要。"
              },
              "note": "外れ衛星が支配しない評価指標（中央値/分位）も併用する。"
            }
          ],
          "expected_effect": [
            {
              "observable": "summary_batch",
              "metric": "RMS distribution width",
              "direction": "ambiguous",
              "note": "衛星固有のクロック特性や軌道誤差でRMSが偏る。"
            }
          ],
          "diagnostics": {
            "outputs": [
              "output/public/gps/summary_batch.csv",
              "output/public/gps/gps_rms_compare.png",
              "output/public/gps/gps_compare_metrics.json"
            ],
            "what_to_check": [
              "summary_batch.csv の分布（外れ衛星が結論を支配していないか）",
              "G01など代表衛星の時系列で、位相/季節性/欠測があるか"
            ]
          },
          "notes": ""
        }
      ]
    },
    {
      "test_id": "llr_batch",
      "topic": "llr",
      "name": "LLR：バッチ検証（複数局×複数反射器）",
      "main_script": {
        "path": "scripts/llr/llr_batch_eval.py",
        "repro": "python -B scripts/llr/llr_batch_eval.py --offline --chunk 50",
        "role": "main"
      },
      "primary_outputs": [
        "output/public/llr/llr_batch_summary.json",
        "output/public/llr/llr_batch_metrics.csv",
        "output/public/llr/llr_outliers.csv",
        "output/public/llr/llr_outliers_diagnosis.csv",
        "output/public/llr/llr_residual_distribution.png",
        "output/public/llr/llr_rms_improvement_overall.png",
        "output/public/llr/llr_rms_by_station_target.png"
      ],
      "systematics": [
        {
          "id": "llr_coverage_bias",
          "title": "coverage（年/局/反射器）の偏りとRMSへの影響",
          "category": "data_selection",
          "status": "supported",
          "knobs": [
            {
              "key": "min_points",
              "type": "int",
              "apply": {
                "mode": "cli_flag",
                "flag": "--min-points",
                "script": "scripts/llr/llr_batch_eval.py"
              },
              "note": "station×target グループを含める最小点数",
              "default": 6
            },
            {
              "key": "max_groups",
              "type": "int",
              "apply": {
                "mode": "cli_flag",
                "flag": "--max-groups",
                "script": "scripts/llr/llr_batch_eval.py"
              },
              "note": "グループ数の上限（0=全て）",
              "default": 0
            }
          ],
          "expected_effect": [
            {
              "observable": "RMS metrics",
              "metric": "overall RMS / station-target RMS",
              "direction": "ambiguous",
              "note": "点数が少ないグループは外れ値に敏感で、RMSを不安定化させる。"
            }
          ],
          "diagnostics": {
            "outputs": [
              "output/public/llr/llr_batch_summary.json",
              "output/public/llr/llr_batch_metrics.csv",
              "output/public/llr/llr_data_coverage.csv"
            ],
            "what_to_check": [
              "llr_data_coverage.csv で『どの局/反射器が支配しているか』を固定表示",
              "min_points を上げても結論が変わらないか（サンプル不足の切り分け）"
            ]
          },
          "notes": ""
        },
        {
          "id": "llr_time_tag",
          "title": "時刻タグ解釈（tx/rx/mid/auto）",
          "category": "estimator_policy",
          "status": "supported",
          "knobs": [
            {
              "key": "time_tag_mode",
              "type": "categorical",
              "apply": {
                "mode": "cli_flag",
                "flag": "--time-tag-mode",
                "script": "scripts/llr/llr_batch_eval.py"
              },
              "note": "局別に最適を採るか（auto）/固定か",
              "values": [
                "tx",
                "rx",
                "mid",
                "auto"
              ]
            }
          ],
          "expected_effect": [
            {
              "observable": "range residuals",
              "metric": "bias/RMS",
              "direction": "ambiguous",
              "note": "時刻タグの取り方で幾何と補正の位相が変わり、残差が変化する。"
            }
          ],
          "diagnostics": {
            "outputs": [
              "output/public/llr/llr_batch_summary.json",
              "output/public/llr/llr_batch_metrics.csv",
              "output/public/llr/llr_data_coverage.csv"
            ],
            "what_to_check": [
              "局ごとの time_tag_mode 最適化が一貫しているか（恣意性を排除）"
            ]
          },
          "notes": ""
        },
        {
          "id": "llr_outliers",
          "title": "外れ値ゲート（MAD×sigma と絶対ns閾値）",
          "category": "noise_model",
          "status": "supported",
          "knobs": [
            {
              "key": "outlier_clip_sigma",
              "type": "float",
              "apply": {
                "mode": "cli_flag",
                "flag": "--outlier-clip-sigma",
                "script": "scripts/llr/llr_batch_eval.py"
              },
              "note": "MAD倍率",
              "default": 8.0
            },
            {
              "key": "outlier_clip_ns",
              "type": "float",
              "apply": {
                "mode": "cli_flag",
                "flag": "--outlier-clip-ns",
                "script": "scripts/llr/llr_batch_eval.py"
              },
              "note": "最低絶対閾値 [ns]",
              "default": 100.0
            }
          ],
          "expected_effect": [
            {
              "observable": "RMS",
              "metric": "RMS",
              "direction": "decrease",
              "note": "強い外れ値除外ほど RMS は下がるが、データ品質の違いを隠す危険もある。"
            }
          ],
          "diagnostics": {
            "outputs": [
              "output/public/llr/llr_batch_summary.json",
              "output/public/llr/llr_batch_metrics.csv",
              "output/public/llr/llr_data_coverage.csv"
            ],
            "what_to_check": [
              "llr_outliers.csv が局/年/反射器に偏っていないか",
              "外れ値ポリシーを動かしても“改善の有無”が反転しないか"
            ]
          },
          "notes": ""
        }
      ]
    }
  ],
  "outputs": {
    "weak_field_systematics_templates_json": "output/public/weak_field/weak_field_systematics_templates.json"
  }
}
