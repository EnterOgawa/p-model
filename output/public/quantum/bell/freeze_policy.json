{
  "generated_utc": "2026-02-20T12:38:30.598362+00:00",
  "phase": {
    "phase": 7,
    "step": "7.20.2",
    "name": "Bell blind freeze policy (window/offset)"
  },
  "main_script": {
    "path": "scripts/quantum/bell_primary_products.py",
    "repro": "python -B scripts/quantum/bell_primary_products.py"
  },
  "policy_id": "bell_freeze_policy_v1",
  "policy": {
    "blind_freeze_requirement": "Do not inspect Bell statistics (S/J) when selecting natural window/offset.",
    "plateau_fraction_pairs": 0.99,
    "overrides": {
      "nist_*": "trial_match_pairs_total (match trial-based coincidence total)",
      "kwiat2013_*": "dataset_recommendation (≈18000 timebins; PC-triggered trials)"
    },
    "note": "This policy fixes the operational freeze point for window/offset selection and reduces p-hacking degrees of freedom."
  },
  "rules": [
    {
      "rule_id": "event_ready_protocol_offset_nearest_grid",
      "applies_to": "delft_*",
      "recommended": {
        "start_offset_ps": 0,
        "method": {
          "name": "event_ready_protocol"
        }
      },
      "freeze": {
        "snap_rule": "nearest_grid_to_recommended_start_offset_ps"
      },
      "note": "Use the published event-ready protocol baseline; treat offset sweep as systematic only."
    },
    {
      "rule_id": "time_tag_window_from_dt_peak_then_snap_min_ge",
      "applies_to": "time-tag datasets (e.g., weihs1998_*)",
      "recommended": {
        "method": {
          "name": "dt_peak_hist_signal_fraction",
          "signal_fraction": 0.99
        }
      },
      "freeze": {
        "snap_rule": "min(window in grid where window >= recommended_window_ns); fallback: min grid"
      },
      "note": "Derive recommended window from dt peak width/drift (pairing structure), not from maximizing S/J."
    },
    {
      "rule_id": "nist_trial_match_pairs_total_then_snap_min_ge",
      "applies_to": "nist_*",
      "recommended": {
        "method": {
          "name": "trial_match_pairs_total"
        }
      },
      "freeze": {
        "snap_rule": "min(window in grid where window >= recommended_window_ns); fallback: min grid"
      },
      "note": "Use independent trial-based coincidence total to pick a matching window (blind to S/J)."
    },
    {
      "rule_id": "kwiat_dataset_recommendation_then_snap_min_ge",
      "applies_to": "kwiat2013_*",
      "recommended": {
        "method": {
          "name": "dataset_recommendation",
          "recommended_window_bins": 18000
        }
      },
      "freeze": {
        "snap_rule": "min(window in grid where window >= recommended_window_ns); fallback: min grid"
      },
      "note": "Use public dataset guidance for the coincidence window; do not optimize J over the sweep."
    },
    {
      "rule_id": "fallback_pairs_plateau_then_snap_min_ge",
      "applies_to": "other",
      "recommended": {
        "method": {
          "name": "pairs_plateau",
          "plateau_fraction_pairs": 0.99
        }
      },
      "freeze": {
        "snap_rule": "min(window in grid where window >= recommended_window_ns); fallback: min grid"
      },
      "note": "Fallback: use a pairs-total plateau (not a statistic plateau)."
    }
  ],
  "datasets": [
    {
      "dataset_id": "weihs1998_longdist_longdist1",
      "display_name": "Weihs 1998",
      "selection_knob": "window_ns",
      "recommended": {
        "recommended_window_ns": 22.251267208428718,
        "recommended_start_offset_ps": null,
        "recommended_window_method": {
          "name": "dt_peak_hist_signal_fraction",
          "signal_fraction": 0.99,
          "sample_max": 200000,
          "hist_half_range_ns": 200.0,
          "hist_bin_width_ns": 0.5,
          "background_exclusion_ns": 50.0,
          "background_median_per_bin": 3.0,
          "background_threshold_ksigma": 3.0,
          "peak_center_ns": -4.408291266875841,
          "selected_dt_count": 11322,
          "near_peak_count": 8157,
          "width_ns": 22.0,
          "drift_window_ns": 10.0,
          "drift_half_ns": 0.2512672084287178,
          "time_tag_schema": {
            "schema": "a_t_s/b_t_s",
            "time_unit": "s"
          }
        }
      },
      "frozen": {
        "frozen_window_ns": 25.0,
        "frozen_start_offset_ps": null,
        "snap_rule": "min(window in grid where window >= recommended_window_ns); fallback: min grid"
      },
      "applied_rule_id": "time_tag_window_from_dt_peak_then_snap_min_ge",
      "natural_window_overrides": {
        "nist_*": "trial_match_pairs_total (match trial-based coincidence total)",
        "kwiat2013_*": "dataset_recommendation (≈18000 timebins; PC-triggered trials)"
      },
      "evidence": {
        "natural_window_frozen_json": {
          "path": "output/public/quantum/bell/weihs1998_longdist_longdist1/natural_window_frozen.json",
          "sha256": "3f0c4c705ecef8a284fb700cb11a2241723d7d59da0451cee0938f69f011a9e9"
        },
        "window_sweep_metrics_json": {
          "path": "output/public/quantum/bell/weihs1998_longdist_longdist1/window_sweep_metrics.json",
          "sha256": "412bb942db9e8f97e13e7c3e2cae2b3e2e55e4b826f9c3490ebd1e9bfde52758"
        },
        "offset_sweep_metrics_json": {
          "path": "output/public/quantum/bell/weihs1998_longdist_longdist1/offset_sweep_metrics.json",
          "sha256": "556705251655bed2f83f8d2279c485690dc317373742ae92d70b1801a311618c"
        }
      }
    },
    {
      "dataset_id": "delft_hensen2015",
      "display_name": "Delft (Hensen 2015)",
      "selection_knob": "event_ready_offset_ps",
      "recommended": {
        "recommended_window_ns": null,
        "recommended_start_offset_ps": 0,
        "recommended_window_method": {
          "name": "event_ready_protocol",
          "note": "Use the published event-ready protocol baseline; treat offset sweep as a systematic (not an optimizer)."
        }
      },
      "frozen": {
        "frozen_window_ns": null,
        "frozen_start_offset_ps": -30,
        "snap_rule": "nearest_grid_to_recommended_start_offset_ps"
      },
      "applied_rule_id": "event_ready_protocol_offset_nearest_grid",
      "natural_window_overrides": {
        "nist_*": "trial_match_pairs_total (match trial-based coincidence total)",
        "kwiat2013_*": "dataset_recommendation (≈18000 timebins; PC-triggered trials)"
      },
      "evidence": {
        "natural_window_frozen_json": {
          "path": "output/public/quantum/bell/delft_hensen2015/natural_window_frozen.json",
          "sha256": "fa54b0539e9648c2d19d3b8ceebac416354a9f29f58c4e797f006a89f865fd30"
        },
        "window_sweep_metrics_json": {
          "path": "output/public/quantum/bell/delft_hensen2015/window_sweep_metrics.json",
          "sha256": "cf7a69acc53b81067269cea7962ede2ac735d45fdca6bbe923f2b340cab755b8"
        },
        "offset_sweep_metrics_json": {
          "path": "output/public/quantum/bell/delft_hensen2015/offset_sweep_metrics.json",
          "sha256": "906550312044e4d9d671a5ce088fcfea336161256174809804f7801c0df29d16"
        }
      }
    },
    {
      "dataset_id": "delft_hensen2016_srep30289",
      "display_name": "Delft (Hensen 2016)",
      "selection_knob": "event_ready_offset_ps",
      "recommended": {
        "recommended_window_ns": null,
        "recommended_start_offset_ps": 0,
        "recommended_window_method": {
          "name": "event_ready_protocol",
          "note": "Use the published event-ready protocol baseline; treat offset sweep as a systematic (not an optimizer)."
        }
      },
      "frozen": {
        "frozen_window_ns": null,
        "frozen_start_offset_ps": -30,
        "snap_rule": "nearest_grid_to_recommended_start_offset_ps"
      },
      "applied_rule_id": "event_ready_protocol_offset_nearest_grid",
      "natural_window_overrides": {
        "nist_*": "trial_match_pairs_total (match trial-based coincidence total)",
        "kwiat2013_*": "dataset_recommendation (≈18000 timebins; PC-triggered trials)"
      },
      "evidence": {
        "natural_window_frozen_json": {
          "path": "output/public/quantum/bell/delft_hensen2016_srep30289/natural_window_frozen.json",
          "sha256": "3272ed85874946f20e6ab4a54b52d51ed6f814e0022092c2d1e735b4f43f4370"
        },
        "window_sweep_metrics_json": {
          "path": "output/public/quantum/bell/delft_hensen2016_srep30289/window_sweep_metrics.json",
          "sha256": "0d13c38ee43350e607a410d1cd0a65ceca3b8679117bf9315c78ddaac3d06b4a"
        },
        "offset_sweep_metrics_json": {
          "path": "output/public/quantum/bell/delft_hensen2016_srep30289/offset_sweep_metrics.json",
          "sha256": "9e3aae9b7671dafbfc6eed4fef6d1bb3c46566c96ca116af9c3334f1fd1b6120"
        }
      }
    },
    {
      "dataset_id": "nist_03_43_afterfixingModeLocking_s3600",
      "display_name": "NIST",
      "selection_knob": "window_ns",
      "recommended": {
        "recommended_window_ns": 1000.0,
        "recommended_start_offset_ps": null,
        "recommended_window_method": {
          "name": "trial_match_pairs_total",
          "note": "Recommended window matches the trial-based coincidence total (independent pipeline).",
          "trial_total_coinc": 38158,
          "selected_pairs_total": 40056,
          "abs_delta_pairs": 1898
        }
      },
      "frozen": {
        "frozen_window_ns": 1000.0,
        "frozen_start_offset_ps": null,
        "snap_rule": "min(window in grid where window >= recommended_window_ns); fallback: min grid"
      },
      "applied_rule_id": "nist_trial_match_pairs_total_then_snap_min_ge",
      "natural_window_overrides": {
        "nist_*": "trial_match_pairs_total (match trial-based coincidence total)",
        "kwiat2013_*": "dataset_recommendation (≈18000 timebins; PC-triggered trials)"
      },
      "evidence": {
        "natural_window_frozen_json": {
          "path": "output/public/quantum/bell/nist_03_43_afterfixingModeLocking_s3600/natural_window_frozen.json",
          "sha256": "da16bf5704e3f0682da145f6cdd03e4db4d40b98f6f9c61e53bb707f98e31708"
        },
        "window_sweep_metrics_json": {
          "path": "output/public/quantum/bell/nist_03_43_afterfixingModeLocking_s3600/window_sweep_metrics.json",
          "sha256": "79b617058a8572b147012c8704bd6569ae61b9803781cb3ea8adc92eb41af204"
        },
        "offset_sweep_metrics_json": {
          "path": "output/public/quantum/bell/nist_03_43_afterfixingModeLocking_s3600/offset_sweep_metrics.json",
          "sha256": "554bfb82ac5efa9df094a49466d618804b9216cfdee595bf39b5cf7649d49d7f"
        },
        "trial_based_counts_json": {
          "path": "output/public/quantum/bell/nist_03_43_afterfixingModeLocking_s3600/trial_based_counts.json",
          "sha256": "5e6c9d60a95ed45f560cc2d5758fbd269aab5fa75d9b3a0f9356df8280390e2a"
        }
      }
    },
    {
      "dataset_id": "kwiat2013_prl111_130406_05082013_15",
      "display_name": "Kwiat/Christensen 2013",
      "selection_knob": "window_ns",
      "recommended": {
        "recommended_window_ns": 2812.5,
        "recommended_start_offset_ps": null,
        "recommended_window_method": {
          "name": "dataset_recommendation",
          "recommended_window_bins": 18000,
          "timebins_per_second": 6400000000.0,
          "note": "Use the public dataset guidance (data_organization.txt) to avoid p-hacking optics."
        }
      },
      "frozen": {
        "frozen_window_ns": 2812.5,
        "frozen_start_offset_ps": null,
        "snap_rule": "min(window in grid where window >= recommended_window_ns); fallback: min grid"
      },
      "applied_rule_id": "kwiat_dataset_recommendation_then_snap_min_ge",
      "natural_window_overrides": {
        "nist_*": "trial_match_pairs_total (match trial-based coincidence total)",
        "kwiat2013_*": "dataset_recommendation (≈18000 timebins; PC-triggered trials)"
      },
      "evidence": {
        "natural_window_frozen_json": {
          "path": "output/public/quantum/bell/kwiat2013_prl111_130406_05082013_15/natural_window_frozen.json",
          "sha256": "9099c2618a0591e1483751b42cc71a93b852bc15756cf6c901c4e8b7bff80ffa"
        },
        "window_sweep_metrics_json": {
          "path": "output/public/quantum/bell/kwiat2013_prl111_130406_05082013_15/window_sweep_metrics.json",
          "sha256": "72321ad2de890483d1a8b6833419228bd8c4a1d43213f85f5a3bcd60531c4cf8"
        },
        "trial_based_counts_json": {
          "path": "output/public/quantum/bell/kwiat2013_prl111_130406_05082013_15/trial_based_counts.json",
          "sha256": "132f9d0ebbeb116b8782ba11d5467c3a19dd25fa6d9bdbb41320e9c1f9999967"
        }
      }
    }
  ],
  "inputs": {
    "falsification_pack_json": {
      "path": "output/public/quantum/bell/falsification_pack.json",
      "sha256": "7820256fb2c8943b75b540cc3ae316f1d4a5f885e882dd7636f2e21ae002dcfa"
    }
  },
  "outputs": {
    "freeze_policy_json": "output/public/quantum/bell/freeze_policy.json"
  }
}